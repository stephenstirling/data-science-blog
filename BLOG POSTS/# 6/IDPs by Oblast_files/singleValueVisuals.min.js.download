"use strict";var __extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var a in e)e.hasOwnProperty(a)&&(t[a]=e[a])};return function(e,a){function i(){this.constructor=e}t(e,a),e.prototype=null===a?Object.create(a):(i.prototype=a.prototype,new i)}}(),powerbi;!function(t){var e;!function(e){var a=function(){function a(t){this.mainText=jsCommon.CssConstants.createClassAndSelector("mainText"),this.name=t,this.visualConfiguration={maxFontSize:60}}return a.prototype.getMetaDataColumn=function(t){if(t&&t.metadata&&t.metadata.columns)for(var e=0,a=t.metadata.columns.length;e<a;e++){var i=t.metadata.columns[e];if(i.isMeasure){this.metaDataColumn=i;break}}},a.prototype.getAdjustedFontHeight=function(t,e,a){var i={fontFamily:null,fontSize:null,text:e};return this.getAdjustedFontHeightCore(i,t,a,0)},a.prototype.getAdjustedFontHeightCore=function(e,a,i,r){return r>10?i:(e.fontSize=jsCommon.PixelConverter.toString(i),t.TextMeasurementService.measureSvgTextWidth(e)<a?i:this.getAdjustedFontHeightCore(e,a,.9*i,r+1))},a.prototype.clear=function(){this.svg.select(this.mainText.selector).text("")},a.prototype.doValueTransition=function(t,a,i,r,s,o,n,l){if(o||t!==a||null==a){t||(t=0),l||(l=this.getDefaultDatumTransform());var u=this.svg,p=this.currentViewport,h=p.height,g=p.width,d=this.getSeedFontHeight(g,h),c=this.getTranslateX(g),m=this.getTranslateY(d),v=this.metaDataColumn;n||(n=e.valueFormatter.create({format:this.getFormatString(this.dataPointObjects,v),value:a,displayUnitSystemType:i,formatSingleValues:!0,allowFormatBeautification:!0,columnType:v?v.type:void 0}));var f=String(t),b=String(a);(_.isEmpty(a)||"string"!=typeof a)&&(f=n.format(t),b=n.format(a)),u.classed(this.name,!0);var y=[l.getDatum(a,b)],S=u.selectAll("text").data(y);S.enter().append("text").classed(this.mainText.class,!0);var x=this.getAdjustedFontHeight(g,b,d);m=this.getTranslateY(x+(h-x)/2);var w=S.text(f).attr({"text-anchor":this.getTextAnchor(),"font-size":x,transform:e.SVGUtil.translate(c,m)}).style({fill:this.style.titleText.color.value}).call(e.tooltipUtils.tooltipUpdate,[f]);if(null==a||v&&e.AxisHelper.isDateTime(v.type)||"string"==typeof a)w.text(b).call(e.tooltipUtils.tooltipUpdate,[b]);else{var P=t;w.transition().duration(s).tween("text",function(t){var e=l.getValue(t),a=d3.interpolate(P,e);return function(t){var e=a(t);this.textContent=n.format(e)}})}return e.SVGUtil.flushAllD3TransitionsIfNeeded(r),S}},a.prototype.getDefaultDatumTransform=function(){return{getDatum:function(t,e){return{value:t}},getValue:function(t){return t.value}}},a.prototype.setTextColor=function(t){this.style.titleText.color.value=t},a.prototype.getSeedFontHeight=function(t,e){var a=Math.floor(.75*Math.min(t,e)),i=this.visualConfiguration.maxFontSize;return i?Math.min(i,a):a},a.prototype.getTranslateX=function(t){if(this.visualConfiguration)switch(this.visualConfiguration.align){case"left":return 0;case"right":return t}return t/2},a.prototype.getTranslateY=function(t){return t},a.prototype.getTextAnchor=function(){if(this.visualConfiguration)switch(this.visualConfiguration.align){case"left":return"start";case"right":return"end"}return"middle"},a.prototype.getFormatString=function(t,a){return e.valueFormatter.getFormatStringWithDataPointObjects(t,a,e.StandardObjectPropertyIdentifiers.formatString)},a}();e.AnimatedText=a}(e=t.visuals||(t.visuals={}))}(powerbi||(powerbi={}));var powerbi;!function(t){var e;!function(t){var e=function(e){function a(t,a){var i=e.call(this,"animatedNumber")||this;return t&&(i.svg=t),a&&(i.animator=a),i}return __extends(a,e),a.prototype.init=function(t){this.options=t;var e=t.element;this.svg||(this.svg=d3.select(e.get(0)).append("svg")),this.currentViewport=t.viewport,this.hostServices=t.host,this.style=t.style,this.updateViewportDependantProperties()},a.prototype.updateViewportDependantProperties=function(){var t=this.currentViewport;this.svg.attr("width",t.width).attr("height",t.height)},a.prototype.update=function(t){this.currentViewport=t.viewport;var e=this.dataViews=t.dataViews;if(e&&e[0]){var a=e[0];this.updateViewportDependantProperties(),this.getMetaDataColumn(a);var i=a&&a.single?a.single.value:0;this.updateInternal(i,t.suppressAnimations,!0,this.formatter)}},a.prototype.setFormatter=function(t){this.formatter=t},a.prototype.onDataChanged=function(t){this.update({dataViews:t.dataViews,suppressAnimations:t.suppressAnimations,viewport:this.currentViewport})},a.prototype.onResizing=function(t){this.update({dataViews:this.dataViews,suppressAnimations:!0,viewport:t})},a.prototype.canResizeTo=function(t){return!0},a.prototype.updateInternal=function(e,a,i,r){void 0===i&&(i=!1);var s=this.value,o=t.AnimatorCommon.GetAnimationDuration(this.animator,a);this.doValueTransition(s,e,null,this.options.animation,o,i,r),this.value=e},a}(t.AnimatedText);t.AnimatedNumber=e}(e=t.visuals||(t.visuals={}))}(powerbi||(powerbi={})),define("SingleValueVisuals/animatedNumberModule",["require","exports"],function(t,e){function a(){return new powerbi.visuals.AnimatedNumber}Object.defineProperty(e,"__esModule",{value:!0}),e.createAnimatedNumber=a});var powerbi;!function(t){var e;!function(e){function a(t){return!!t.kpiValue}var i=e.CardUtil.DefaultStyle,r=jsCommon.CssConstants.createClassAndSelector,s=t.visuals.KpiUtil,o=t.visuals.TextUtil,n=function(n){function l(e){var a=n.call(this,l.cardClassName)||this;return a.isScrollable=!1,a.displayUnitSystemType=t.DisplayUnitSystemType.WholeUnits,e&&(a.tooltipsEnabled=e.tooltipsEnabled,a.isScrollable=!!e.isScrollable,e.animator&&(a.animator=e.animator),null!=e.displayUnitSystemType&&(a.displayUnitSystemType=e.displayUnitSystemType),e.cardSmallViewportProperties&&(a.cardSmallViewportProperties=e.cardSmallViewportProperties)),a}return __extends(l,n),l.prototype.init=function(t){this.animationOptions=t.animation;var a=t.element;this.tooltipsEnabled&&(this.tooltipService=e.createTooltipService(t.host)),this.kpiImage=d3.select(a.get(0)).append("div").classed(l.KPIImage.class,!0);var i=this.svg=d3.select(a.get(0)).append("svg");this.graphicsContext=i.append("g"),this.currentViewport=t.viewport,this.hostServices=t.host,this.style=t.style,this.updateViewportProperties(),this.isScrollable&&(i.attr("class",l.cardClassName),this.labelContext=i.append("g"))},l.prototype.onDataChanged=function(a){var i,r,s=a.dataViews[0];if(s){this.getMetaDataColumn(s),s.single&&(i=s.single.value,r=s.single.objects),this.cardFormatSetting=this.getDefaultFormatSettings(this.style);var o=s.metadata;if(o){var n=o.objects;if(n){var l=this.cardFormatSetting.labelSettings,u=n.labels;u&&l&&e.LabelUtils.updateLabelSettingsFromLabelsObject(u,l,void 0,this.style),l.precision!==e.dataLabelUtils.defaultLabelPrecision&&l.precision<0&&(l.precision=0);var p=n.categoryLabels,h=this.cardFormatSetting.categoryLabelSetting;p&&h&&e.LabelUtils.updateLabelSettingsFromLabelsObject(p,h,void 0,this.style),this.cardFormatSetting.wordWrap=t.DataViewObjects.getValue(n,e.cardProps.wordWrap.show,this.cardFormatSetting.wordWrap)}}}this.updateInternal(i,r,!0,!0)},l.prototype.onResizing=function(t){this.currentViewport=t,this.updateViewportProperties(),this.updateInternal(this.value,this.dataPointObjects,!0,!0)},l.prototype.updateViewportProperties=function(){var t=this.currentViewport;this.svg.attr("width",t.width).attr("height",t.height)},l.prototype.setTextProperties=function(t,a){l.cardTextProperties=e.FontProperties.toTextProperties(a,t)},l.prototype.isSmallViewport=function(){return!!(this.cardSmallViewportProperties&&this.currentViewport.width<=this.cardSmallViewportProperties.cardSmallViewportWidth)},l.prototype.getCardPrecision=function(t){return void 0===t&&(t=!1),t?e.dataLabelUtils.defaultLabelPrecision:this.cardFormatSetting.labelSettings.precision},l.prototype.getCardDisplayUnits=function(t){void 0===t&&(t=!1);var e=!this.metaDataColumn||!this.metaDataColumn.type||this.metaDataColumn.type.numeric;return t||!e?0:this.cardFormatSetting.labelSettings.displayUnits},l.prototype.getAdjustedFontHeight=function(t,e,a){var r=n.prototype.getAdjustedFontHeight.call(this,t,e,a);return Math.min(r,i.card.maxFontSize)},l.prototype.clear=function(t){void 0===t&&(t=!1),this.svg.select(l.Value.selector).text(""),t||this.svg.select(l.Label.selector).text(""),n.prototype.clear.call(this)},l.prototype.updateInternal=function(a,r,n,u){void 0===u&&(u=!1);var p=this.value,h=e.AnimatorCommon.GetAnimationDuration(this.animator,n);if(void 0===a)return void(void 0!==p&&this.clear());var g=this.metaDataColumn,d=this.cardFormatSetting.labelSettings,c=this.cardFormatSetting.categoryLabelSetting,m=this.isSmallViewport(),v=this.getCardPrecision(m),f=this.getCardDisplayUnits(m),b=0===f,y=this.getFormatString(r,g),S=e.valueFormatter.create({format:y,value:b?a:f,precision:e.dataLabelUtils.getLabelPrecision(v,y),displayUnitSystemType:b&&v===e.dataLabelUtils.defaultLabelPrecision?this.displayUnitSystemType:t.DisplayUnitSystemType.WholeUnits,formatSingleValues:!!b,allowFormatBeautification:!0,columnType:g?g.type:void 0}),x=this.cardFormatSetting,w=d.fontProperties.size.px;this.setTextProperties(a,this.cardFormatSetting.categoryLabelSetting.fontProperties);var P=c.show?t.TextMeasurementService.estimateSvgTextHeight(l.cardTextProperties):0,V=P+i.label.paddingTop,C=this.currentViewport.width,T=this.currentViewport.height,L=this.getTranslateX(C),A=(T-V-w)/2,D=g&&g.displayName;if(this.isScrollable){if(!u&&p===a)return;var M=s.isKpi(g)&&s.getKpiImageMetadata(g,a,1);if(M)this.graphicsContext.selectAll("text").remove(),this.displayStatusGraphic(M,a,L,A,w);else{var N=void 0;N=_.isEmpty(a)||"string"!=typeof a?S.format(a):a;var F=[{displayName:D,value:N}];this.kpiImage.selectAll("div").remove();var I=this.getTranslateY(w+A),U=this.graphicsContext.attr("transform",e.SVGUtil.translate(L,I)).selectAll("text").data(F);if(U.enter().append("text").attr("class",l.Value.class),U.text(function(t){return t.value}).style({"text-anchor":this.getTextAnchor()}).style(e.FontProperties.toSVGStyle(d.fontProperties)),d.preserveWhitespace?U.style({"white-space":"pre"}):U.style({"white-space":"normal"}),x.wordWrap){var G=U.node();o.wordBreak(G,C,T-V,void 0,!0,d.preserveWhitespace);var k=G.childElementCount;if(k>1){var R=w;w*=k,A=(T-V-w)/2,I=this.getTranslateY(R+A),this.graphicsContext.attr("transform",e.SVGUtil.translate(L,I))}}else U.call(e.AxisHelper.LabelLayoutStrategy.clip,C,t.TextMeasurementService.svgEllipsis);this.addTooltip(U),U.exit().remove()}if(c.show&&D){var j=[D],O=this.getTranslateY(w+V+A),H=this.labelContext.attr("transform",e.SVGUtil.translate(L,O)).selectAll("text").data(j);H.enter().append("text").attr("class",l.Label.class),H.text(function(t){return t}).style(e.FontProperties.toSVGStyle(c.fontProperties)).style({"text-anchor":this.getTextAnchor()}),c.preserveWhitespace?H.style({"white-space":"pre"}):H.style({"white-space":"normal"});var B=H.node();B&&(x.wordWrap?o.wordBreak(B,C,T-O,void 0,!0,c.preserveWhitespace):H.call(e.AxisHelper.LabelLayoutStrategy.clip,C,t.TextMeasurementService.svgEllipsis)),H.append("title").text(function(t){return t}),H.exit().remove()}else this.labelContext.selectAll("text").remove()}else{var M=s.isKpi(g)&&s.getKpiImageMetadata(g,a,1);if(M)this.graphicsContext.selectAll("text").remove(),this.displayStatusGraphic(M,a,L,A,w);else{this.kpiImage.selectAll("div").remove();var W={getDatum:function(t,e){return{displayName:D,value:e,unformattedValue:t}},getValue:function(t){return t.unformattedValue}},U=this.doValueTransition(p,a,this.displayUnitSystemType,this.animationOptions,h,u,S,W);U.classed("value",!0),this.addTooltip(U),this.graphicsContext.call(e.tooltipUtils.tooltipUpdate,[a])}}this.value=a,this.dataPointObjects=r},l.prototype.displayStatusGraphic=function(t,a,i,r,s){this.graphicsContext.selectAll("text").remove();var o=this.kpiImage.select("div");o&&!o.empty()||(o=this.kpiImage.append("div")),o.attr("class",["value",t.class].join(" ")).style("position","absolute").style("font-size",s+"px");var n=o.node().offsetWidth,l=o.node().offsetHeight;o.style("transform",e.SVGUtil.translateWithPixels(i-n/2,this.getTranslateY(s+r)-l));var u={displayName:this.metaDataColumn&&this.metaDataColumn.displayName,kpiValue:{value:a,metadata:this.metaDataColumn.kpi}};o.datum(u),this.addTooltip(o)},l.prototype.getDefaultFormatSettings=function(t){var a=function(a){return e.ColorHelper.getThemeColor(t,a)};return{labelSettings:e.LabelUtils.getDefaultLabelSettings(!0,a(i.value.colorName),i.value.textSize,i.value.fontFamily,t,!0),categoryLabelSetting:e.LabelUtils.getDefaultLabelSettings(!0,a(i.label.colorName),i.label.textSize,i.label.fontFamily,t,!0),wordWrap:!1}},l.prototype.getDataLabelSettingsOptions=function(t,e,a){return{enumeration:t,dataLabelsSettings:e,show:!0,displayUnits:a,precision:a,fontSize:!0,fontFamily:!0,style:this.style,preserveWhitespace:!0}},l.prototype.enumerateObjectInstances=function(t){this.cardFormatSetting||(this.cardFormatSetting=this.getDefaultFormatSettings(this.style));var a=this.cardFormatSetting,i=a.labelSettings,r=a.categoryLabelSetting,s=new e.ObjectEnumerationBuilder;switch(t.objectName){case"categoryLabels":e.LabelUtils.enumerateDataLabels(this.getDataLabelSettingsOptions(s,r,!1));break;case"labels":e.LabelUtils.enumerateDataLabels(this.getDataLabelSettingsOptions(s,i,!0));break;case"wordWrap":s.pushInstance({objectName:"wordWrap",selector:null,properties:{show:a.wordWrap}})}return s.complete()},l.prototype.addTooltip=function(t){var e=this,i=this.hostServices.tooltips();this.tooltipsEnabled&&i&&i.enabled()?this.tooltipService.addTooltip(t,function(t){var e=t.data;return a(e)?[{displayName:e.displayName,kpiValue:e.kpiValue}]:[{displayName:e.displayName,value:e.value}]},function(){return e.getTooltipIdentity()}):t.filter(function(t){return!a(t)}).append("title").text(function(t){return t.value})},l.prototype.getTooltipIdentity=function(){return this.metaDataColumn&&e.SelectionId.createWithMeasure(this.metaDataColumn.queryName)},l.cardClassName="card",l.Label=r("label"),l.Value=r("value"),l.KPIImage=r("caption"),l.cardTextProperties={fontSize:null,text:null,fontFamily:e.LabelUtils.defaultFontProperties.family},l}(e.AnimatedText);e.Card=n}(e=t.visuals||(t.visuals={}))}(powerbi||(powerbi={})),define("SingleValueVisuals/cardModule",["require","exports"],function(t,e){function a(t){return new powerbi.visuals.Card(t)}Object.defineProperty(e,"__esModule",{value:!0}),e.createCard=a});var powerbi;!function(t){var e;!function(e){var a=jsCommon.CssConstants.createClassAndSelector,i=t.data.DataRoleHelper,r="backgroundLight",s="foregroundNeutralSecondary",o=10,n=150,l="gauge",u=function(){function u(t){this.lastAngle=-Math.PI/2,t&&(t.gaugeSmallViewPortProperties&&(this.gaugeSmallViewPortProperties=t.gaugeSmallViewPortProperties),this.animator=t.animator,this.tooltipsEnabled=t.tooltipsEnabled)}return u.prototype.enumerateObjectInstances=function(t){var a=new e.ObjectEnumerationBuilder;switch(t.objectName){case"axis":this.enumerateAxis(a);break;case"labels":var i=this.data?this.data.minLabel.settings:e.GaugeConverter.getDefaultGaugeLabelSettings(this.style);e.LabelUtils.enumerateDataLabels(this.getDataLabelSettingsOptions(a,i));break;case"target":var r=this.data&&this.data.target?this.data.target.label.settings:e.GaugeConverter.getDefaultGaugeLabelSettings(this.style);e.LabelUtils.enumerateDataLabels(this.getDataLabelSettingsOptions(a,r));break;case"calloutValue":var s=e.ColorHelper.getThemeColor(this.style,e.ForegroundColorName),i=this.data?this.data.calloutLabel.settings:e.GaugeConverter.getDefaultGaugeLabelSettings(this.style,s);e.LabelUtils.enumerateDataLabels(this.getDataLabelSettingsOptions(a,i));break;case"dataPoint":this.enumerateDataPoint(a)}return a.complete()},u.prototype.getDataLabelSettingsOptions=function(t,e){return{dataLabelsSettings:e,show:!0,precision:!0,displayUnits:!0,fontSize:!0,fontFamily:!0,enumeration:t,style:this.style}},u.prototype.enumerateAxis=function(t){var e=this.dataView;if(e&&e.metadata){var a=u.getGaugeObjectsProperties(e);t.pushInstance({selector:null,objectName:"axis",properties:a})}},u.prototype.enumerateDataPoint=function(t){var a=this.data?this.data.dataPointSettings:e.GaugeConverter.getDefaultDataPointSettings(this.style),i={};i.fill={solid:{color:a.fillColor}},null!=a.targetColor&&(i.target={solid:{color:a.targetColor}}),t.pushInstance({selector:null,objectName:e.gaugeProps.dataPoint.target.objectName,properties:i})},u.getGaugeObjectsProperties=function(t){var a={},r=t.metadata.objects,s=!!r&&!!r.axis;return i.hasRoleInDataView(t,e.gaugeRoleNames.minValue)||(a.min=s?r.axis.min:void 0),i.hasRoleInDataView(t,e.gaugeRoleNames.maxValue)||(a.max=s?r.axis.max:void 0),i.hasRoleInDataView(t,e.gaugeRoleNames.targetValue)||(a.target=s?r.axis.target:void 0),a},u.prototype.init=function(t){this.element=t.element,this.currentViewport=t.viewport,this.style=t.style,this.options=t,this.settings=u.DefaultStyleProperties,this.tooltipService=e.createTooltipService(t.host),this.labelPosition=0,this.margin={top:0,left:0,right:0,bottom:0},this.color=d3.scale.ordinal().range([e.ColorHelper.getSentimentColor(this.style,"bad"),e.ColorHelper.getSentimentColor(this.style,"neutral"),e.ColorHelper.getSentimentColor(this.style,"good")]),this.hostService=t.host;var a=this.svg=d3.select(this.element.get(0)).append("svg");a.classed(l,!0);var i=this.mainGraphicsContext=a.append("g");i.attr("class",u.MainGaugeGroupClassName),this.initKpiBands();var r=this.backgroundArc=d3.svg.arc().innerRadius(0).outerRadius(0).startAngle(-Math.PI/2).endAngle(Math.PI/2),s=this.foregroundArc=d3.svg.arc().innerRadius(0).outerRadius(0).startAngle(-Math.PI/2);this.backgroundArcPath=i.append("path").classed("backgroundArc",!0).attr("d",r),this.foregroundArcPath=i.append("path").datum({endAngle:-Math.PI/2}).classed("foregroundArc",!0).attr("d",s);var o=this.animatedNumberGrapicsContext=a.append("g");this.animatedNumber=new e.AnimatedNumber(o),this.animatedNumber.init(t),this.interactivityService=e.createInteractivityService(this.hostService);var n=this.gaugeVisualProperties=this.getGaugeVisualProperties(),p=this.getAnimatedNumberProperties(n.radius,n.innerRadiusFactor,n.top,n.left);this.animatedNumberGrapicsContext.attr("transform",p.transformString),this.animatedNumber.onResizing(p.viewport)},u.prototype.update=function(a){if(this.currentViewport=a.viewport,a.dataViews&&a.dataViews[0]){var i=this.dataView=a.dataViews[0],r=t.data.createDataViewCategoricalReaderAdvanced(i);if(a.type&t.VisualUpdateType.Data||!this.data){this.data=e.GaugeConverter.convert(r,this.style);var s=e.getInvalidValueWarnings([i],!1,!1,!1,["Tooltips"]);this.hostService.setWarnings(s)}(a.type&t.VisualUpdateType.Resize||a.type&t.VisualUpdateType.ResizeEnd)&&(a.suppressAnimations=!0),this.dataView.single={value:this.data.calloutLabel.value,column:void 0},this.labels=[this.data.minLabel,this.data.maxLabel],this.showTargetLabel=this.data.target.ratio>=0&&this.data.target.ratio<=1&&this.currentViewport.width>n&&this.showSideNumbersLabelText()&&this.data.target.label.settings.show;var o=u.calculatePosition(this.data,this.showTargetLabel,this.currentViewport,this.gaugeSmallViewPortProperties);this.labelPosition=o.labelPosition,this.margin=o.margin,this.gaugeVisualProperties=this.getGaugeVisualProperties(),this.drawViewPort(this.gaugeVisualProperties),this.updateInternal(a.suppressAnimations),this.updateCalloutValue(a.suppressAnimations)}},u.prototype.updateCalloutValue=function(t){var e=this.data.calloutLabel.settings;if(this.data.calloutLabel.settings.show){var a=this.getAnimatedNumberProperties(this.gaugeVisualProperties.radius,this.gaugeVisualProperties.innerRadiusFactor,this.gaugeVisualProperties.top,this.gaugeVisualProperties.left);this.animatedNumberGrapicsContext.attr("transform",a.transformString),this.animatedNumber.setTextColor(e.fontProperties.color);var i=this.data.calloutLabel.value,r=this.data.calloutLabel.formatter;this.animatedNumber.setFormatter(r),this.animatedNumber.update({viewport:a.viewport,dataViews:[this.dataView],suppressAnimations:t}),this.animatedNumberGrapicsContext.selectAll("title").remove(),this.animatedNumberGrapicsContext.append("title").text([r.format(i)])}else this.animatedNumber.clear(),this.animatedNumberGrapicsContext.selectAll("title").remove()},u.prototype.initKpiBands=function(){if(this.settings.kpiBands.show)for(var t=this.kpiArcs=[],e=this.kpiArcPaths=[],a=this.mainGraphicsContext,i=0;i<3;i++){var r=d3.svg.arc().innerRadius(0).outerRadius(0).startAngle(0).endAngle(0);t.push(r);var s=a.append("path").attr("d",r);e.push(s)}},u.prototype.updateKpiBands=function(t,e,a,i){if(this.settings.kpiBands.show)for(var r=0;r<i.length;r++)this.kpiArcs[r].innerRadius(t*e-(u.KpiBandDistanceFromMainArc+this.settings.kpiBands.thickness)).outerRadius(t*e-u.KpiBandDistanceFromMainArc).startAngle(i[r].start).endAngle(i[r].end),this.kpiArcPaths[r].attr("fill",i[r].fill).attr("d",this.kpiArcs[r]).attr("transform",a)},u.prototype.removeTargetElements=function(){this.targetLine&&(this.targetLine.remove(),this.targetText.remove(),this.targetConnector.remove(),this.targetLine=this.targetConnector=this.targetText=null)},u.prototype.updateTargetLine=function(t,e,a,i){this.targetLine||(this.targetLine=this.mainGraphicsContext.append("line"));var r=this.data.target.ratio*Math.PI,s=i-t*Math.sin(r),o=a-t*Math.cos(r),n=i-e*Math.sin(r),l=a-e*Math.cos(r);this.targetLine.attr({x1:l,y1:n,x2:o,y2:s})},u.prototype.getAnimatedNumberProperties=function(t,a,i,r){var s=Math.PI/4,o=1,n=t*a,l=n-(this.settings.kpiBands.show?u.KpiBandDistanceFromMainArc+this.settings.kpiBands.thickness:0),p=l*Math.cos(s),h=l*Math.sin(s),g=i-h,d=r-p;g*=o,d*=o;var c=2*p;return{transformString:e.SVGUtil.translate(d,g),viewport:{height:h,width:c}}},u.prototype.getGaugeVisualProperties=function(){var t=this.currentViewport,a=this.margin,i=t.width-a.right-a.left,r=i/2,s=t.height-a.top-a.bottom,o=Math.min(r,s),n=u.InnerRadiusFactor,l=a.left+r,p=o+(s-o)/2+a.top;return{radius:o,innerRadiusOfArc:o*n,left:l,top:p,height:s,width:i,margin:a,transformString:e.SVGUtil.translate(l,p),innerRadiusFactor:n}},u.prototype.drawViewPort=function(t){var e=this.settings.kpiBands.separationRadians,a=u.InnerRadiusFactor,i=this.backgroundArc,r=this.color,s=[{fill:r(0),start:-Math.PI/2,end:-Math.PI/2+Math.PI/4-e},{fill:r(1),start:-Math.PI/2+1*Math.PI/4+e,end:-Math.PI/2+3*Math.PI/4-e},{fill:r(2),start:-Math.PI/2+3*Math.PI/4+e,end:Math.PI/2}],o=t.radius,n=t.transformString;this.updateKpiBands(o,a,n,s),i.innerRadius(o*a).outerRadius(o).startAngle(-Math.PI/2).endAngle(Math.PI/2),this.backgroundArcPath.attr("d",i).attr("transform",n);var l=this.foregroundArc;l.innerRadius(o*a).outerRadius(o).startAngle(-Math.PI/2),this.foregroundArcPath.datum({endAngle:this.lastAngle}).attr("transform",n).attr("d",l);var p=t.innerRadiusOfArc,h=t.left,g=t.top,d=t.margin,c=t.height;this.settings.targetLine.show&&$.isNumeric(this.data.target.label.value)?this.data.target.ratio<0||this.data.target.ratio>1?this.removeTargetElements():(this.updateTargetLine(o,p,h,g),this.renderTarget(o,c,t.width,d)):this.removeTargetElements(),this.svg.attr("height",this.currentViewport.height).attr("width",this.currentViewport.width)},u.prototype.updateInternal=function(t){var a=this.gaugeVisualProperties.height,i=this.gaugeVisualProperties.width,r=this.gaugeVisualProperties.radius,s=this.margin,o=e.AnimatorCommon.GetAnimationDuration(this.animator,t),n=this.data,l=this.lastAngle=-Math.PI/2+Math.PI*this.data.ratio;this.foregroundArcPath.transition().ease(this.settings.transition.ease).duration(o).call(this.arcTween,[l,this.foregroundArc]),this.renderMinMaxLabels(this.labels,r,a,i,s),this.interactivityService.bind([],new e.GaugeBehavior,{paths:[this.foregroundArcPath]}),this.updateVisualConfigurations(),this.tooltipsEnabled&&(this.tooltipService.addTooltip(this.foregroundArcPath,function(t){return n.tooltipInfo},function(t){return n.identity}),this.tooltipService.addTooltip(this.backgroundArcPath,function(t){return n.tooltipInfo},function(t){return n.identity})),this.foregroundArcPath.datum().identity=n.identity},u.prototype.updateVisualConfigurations=function(){var t=this.settings,a=this.data.dataPointSettings,i=this.data.strokeSettings;this.mainGraphicsContext.select("line").attr({stroke:a.targetColor,"stroke-width":t.targetLine.thickness}),i&&i.visible&&this.mainGraphicsContext.select("path").style("stroke",i.color).style("stroke-width",i.width),this.backgroundArcPath.style("fill",e.ColorHelper.getThemeColor(this.style,r)),this.foregroundArcPath.style("fill",a.fillColor)},u.prototype.renderMinMaxLabels=function(a,i,r,s,o){if(this.svg.selectAll(u.LabelText.selector).remove(),this.data.minLabel.settings.show)for(var n=this.data.minLabel.settings,l=a.length,p=l-1,h=this.labelPosition,g=n.fontProperties,d=g.size.px,c=this.settings.labels.padding,m=0;m<l;m++){var v=this.gaugeVisualProperties.top,f=e.FontProperties.toTextProperties(g,a[m].text);if(this.showSideNumbersLabelText()){var b=o.left+s/2-i*Math.cos(Math.PI*m/p),y=void 0,S=1===m,x=!1;2===h?(x=!0,v+=c,y=S?"end":"start",f.text=t.TextMeasurementService.getTailoredTextOrDefault(f,i)):(y=S?"start":"end",b+=c*(S?1:-1));var w=this.mainGraphicsContext.append("text").attr({x:b,y:v,dy:x?d:0,class:u.LabelText.class}).style({"text-anchor":y}).style(e.FontProperties.toSVGStyle(g)).text(f.text).append("title").text(f.text);x||this.truncateTextIfNeeded(w,b,S)}}},u.prototype.truncateTextIfNeeded=function(a,i,r){var s=r?this.currentViewport.width-i:i;a.call(e.AxisHelper.LabelLayoutStrategy.clip,s,t.TextMeasurementService.svgEllipsis)},u.prototype.renderTarget=function(t,a,i,r){var n=this.data.target,l=this.data.target.label.settings,p=n.label.value,h=n.ratio,g=t+(a-t)/2+r.top,d=h>.5,c=this.settings.labels.padding,m=d?"start":"end",v=this.data.target.label.formatter,f=Math.asin(o/t)/Math.PI,b=h<f||h>1-f?d?1-f:f:h,y=r.left+i/2-(t+c)*Math.cos(Math.PI*b),S=g-(t+c)*Math.sin(Math.PI*b);this.targetText||(this.targetText=this.mainGraphicsContext.append("text").classed(u.TargetText.class,!0)),this.targetText.attr({x:y,y:S}).style({display:this.showTargetLabel?"":"none","text-anchor":m}).style(e.FontProperties.toSVGStyle(l.fontProperties)).text(v.format(p)),this.truncateTextIfNeeded(this.targetText,y,d),this.targetText.call(e.tooltipUtils.tooltipUpdate,[v.format(p)]),this.targetConnector||(this.targetConnector=this.mainGraphicsContext.append("line").classed(u.TargetConnector.class,!0)),h===b?this.targetConnector.style("display","none"):this.targetConnector.attr({x1:r.left+i/2-t*Math.cos(Math.PI*h),y1:g-t*Math.sin(Math.PI*h),x2:y,y2:S}).style({"stroke-width":this.settings.targetLine.thickness,stroke:e.ColorHelper.getThemeColor(this.style,s),display:""})},u.prototype.arcTween=function(t,e){t.attrTween("d",function(t){var a=d3.interpolate(t.endAngle,e[0]);return function(i){return t.endAngle=a(i),e[1](t)}})},u.calculatePosition=function(t,e,a,i){var r=u.DefaultStyleProperties,s={margin:{top:0,left:0,bottom:0,right:0},labelPosition:0};if(i&&i.smallGaugeMarginsOnSmallViewPort&&a.height<i.MinHeightGaugeSideNumbersVisible){var o=i.GaugeMarginsOnSmallViewPort;return s.margin={top:o,bottom:o,left:o,right:o},s}if(!t)return s;var n=2*r.labels.padding,l=t&&t.minLabel.settings.show;if(e){var p=t.target.ratio<=.5?t.target.ratio:1-t.target.ratio,h=p*Math.PI,g=t.target.label.requiredSpace.width+n,d=(a.width-g)/(Math.cos(h)+1),c=a.width-2*d;c>0&&(t.target.ratio<.5?s.margin.left=c:s.margin.right=c);var m=(a.height-t.target.label.requiredSpace.height-n)/Math.sin(h);c=a.height-m,c>0&&(s.margin.top=c)}if(l){var v=Math.max(s.margin.left,t.minLabel.requiredSpace.width+n),f=Math.max(s.margin.right,t.maxLabel.requiredSpace.width+n),b=t.minLabel.requiredSpace.height+n,y=(a.width-v-f)/2;a.height-s.margin.top-b>y?(s.labelPosition=2,s.margin.bottom=b):(s.labelPosition=1,s.margin={left:v,right:f,top:s.margin.top,bottom:r.labels.padding})}var S=t.strokeSettings;return S&&S.visible&&(s.margin={left:s.margin.left+S.width,right:s.margin.right+S.width,top:s.margin.top+S.width,bottom:s.margin.bottom+S.width}),s},u.prototype.showSideNumbersLabelText=function(){return!(this.gaugeSmallViewPortProperties&&this.gaugeSmallViewPortProperties.hideGaugeSideNumbersOnSmallViewPort&&this.currentViewport.height<this.gaugeSmallViewPortProperties.MinHeightGaugeSideNumbersVisible)},u.DefaultStyleProperties={transition:{ease:"cubic-in-out"},targetLine:{show:!0,thickness:2},labels:{count:2,padding:5,fontSize:e.LabelUtils.DefaultLabelFontSizeInPt},kpiBands:{show:!1,separationRadians:Math.PI/128,thickness:5}},u.InnerRadiusFactor=.7,u.KpiBandDistanceFromMainArc=2,u.MainGaugeGroupClassName="mainGroup",u.LabelText=a("labelText"),u.TargetConnector=a("targetConnector"),u.TargetText=a("targetText"),u}();e.Gauge=u}(e=t.visuals||(t.visuals={}))}(powerbi||(powerbi={}));var powerbi;!function(t){var e;!function(t){var e=function(){function e(){}return e.prototype.bindEvents=function(t,e){var a=this,i=t.paths;if(!_.isEmpty(i))for(var r=0,s=i;r<s.length;r++){var o=s[r];o&&o.on("contextmenu",function(){return a.handleContextMenu(e)})}},e.prototype.renderSelection=function(t){},e.prototype.handleContextMenu=function(e){var a=t.InteractivityUtils.getPositionOfLastInputEvent();d3.event.preventDefault(),t.EventBubblingUtil.markAsHandled(d3.event),t.InteractivityUtils.tryToSelectD3Target(function(t){e.handleContextMenu(t,a)})},e}();t.GaugeBehavior=e}(e=t.visuals||(t.visuals={}))}(powerbi||(powerbi={}));var powerbi;!function(t){var e;!function(e){var a=1,i=0,r="foregroundNeutralSecondary",s=function(){function s(){}return s.getDefaultGaugeLabelSettings=function(t,a){var i=e.LabelUtils.getDefaultLabelSettings(!0,a,e.LabelUtils.minLabelFontSize,void 0,t);return i.position=null,i},s.getDefaultDataPointSettings=function(t){var a=t.colorPalette.dataColors.getAllColors();return{fillColor:e.ColorHelper.getDataColorByIndex(t,0,e.ForegroundColorName),targetColor:a&&a.length>1?e.ColorHelper.getDataColorByIndex(t,1,e.ForegroundColorName):e.ColorHelper.getThemeColor(t,r)}},s.convert=function(t,a){var i,r=t.columns,s=t.objects.getStaticObjects(),o=r.getValueMetadataColumn(e.gaugeRoleNames.y),n=this.parseGaugeData(t),l=this.convertDataLabelSettings(s,"labels",a),u=this.convertDataLabelSettings(s,"target",a),p=e.ColorHelper.getThemeColor(a,e.ForegroundColorName),h=this.convertDataLabelSettings(s,"calloutValue",a,p),g=o&&null!=o.queryName?e.SelectionIdBuilder.builder().withMeasure(o.queryName).createSelectionId():void 0;return a.isHighContrast&&(i={visible:!0,color:e.ColorHelper.getThemeColor(a,e.ForegroundColorName),width:e.CartesianHelper.defaultLineStrokeWidth}),{maxLabel:this.createLabel(n.max,r.getValueMetadataColumn(e.gaugeRoleNames.maxValue),l,o),minLabel:this.createLabel(n.min,r.getValueMetadataColumn(e.gaugeRoleNames.minValue),l,o,n.max),target:{label:this.createLabel(n.target,r.getValueMetadataColumn(e.gaugeRoleNames.targetValue),u,o),ratio:this.getTargetRatio(n)},calloutLabel:this.createLabel(n.value,o,h,o),tooltipInfo:n.tooltipItems,ratio:this.getValueRatio(n),dataPointSettings:this.convertDataPointSettings(s,a),identity:g,strokeSettings:i}},s.parseGaugeData=function(t){var r=t.columns,s=t.objects.getStaticObjects(),o=r.getValueMetadataColumn(e.gaugeRoleNames.y),n=s?s.axis:null,l=t.data.hasValues(e.gaugeRoleNames.y),u=t.data.hasValues(e.gaugeRoleNames.maxValue),p=t.data.hasValues(e.gaugeRoleNames.minValue),h=0,g={max:null,min:null,target:null,value:null,tooltipItems:[]};if(l){g.value=t.data.getValue(e.gaugeRoleNames.y,h);var d=e.converterHelper.formatFromMetadataColumn(g.value,o,this.formatStringProp,!1);g.tooltipItems.push({displayName:t.data.getValueDisplayName(e.gaugeRoleNames.y),value:d})}if(t.data.hasValues(e.gaugeRoleNames.targetValue)){var c=r.getValueMetadataColumn(e.gaugeRoleNames.targetValue);g.target=t.data.getValue(e.gaugeRoleNames.targetValue,h);var d=e.converterHelper.formatFromMetadataColumn(g.target,c,this.formatStringProp,!1);g.tooltipItems.push({displayName:t.data.getValueDisplayName(e.gaugeRoleNames.targetValue),
value:d})}else n&&(g.target=n.target);if(u)g.max=t.data.getValue(e.gaugeRoleNames.maxValue,h);else if(n&&null!=n.max)g.max=n.max;else if(g.max=a,l&&g.value&&0!==g.value){var m=!1;if(o){var v=e.valueFormatter.getFormatString(o,this.formatStringProp,!0);null!=v&&(m=e.valueFormatter.getFormatMetadata(v).hasPercent)}m||(g.max=g.value<0?i:2*g.value)}return p?g.min=t.data.getValue(e.gaugeRoleNames.minValue,h):n&&null!=n.min?g.min=n.min:(g.min=i,l&&null!=g.value&&g.value<0&&(g.min=2*g.value)),e.TooltipBuilder.addTooltipMeasures(t,g.tooltipItems,h,void 0,this.formatStringProp),g},s.createLabel=function(a,i,r,s,o){var n=r?r.fontProperties:e.LabelUtils.defaultFontProperties,l=e.FontProperties.toTextProperties(n),u=this.getFormatter(r,i,s,o||a);return l.text=u.format(a),{value:a,requiredSpace:{width:t.TextMeasurementService.measureSvgTextWidth(l),height:t.TextMeasurementService.estimateSvgTextHeight(l)},text:l.text,formatter:u,settings:r}},s.getFormatter=function(a,i,r,s){var o=0===a.displayUnits?s:null;i&&i.objects&&!_.isEmpty(t.DataViewObjects.getValue(i.objects,this.formatStringProp))||(i=r);var n=e.valueFormatter.getFormatString(i,this.formatStringProp),l=e.dataLabelUtils.getLabelPrecision(a.precision,n),u=e.LabelUtils.getOptionsForLabelFormatter(a,n,o,l);return u.formatSingleValues=!(a.displayUnits>0),0===a.displayUnits&&(u.value=o),e.valueFormatter.create(u)},s.getValueRatio=function(t){if(!_.isNumber(t.value)||!this.isValid(t)||t.value<=t.min)return 0;if(t.value>=t.max)return 1;var e=t.max-t.min;return(t.value-t.min)/e},s.isValid=function(t){return _.isNumber(t.min)&&_.isNumber(t.max)&&t.min<=t.max},s.getTargetRatio=function(t){if(!this.isValid(t)||!_.isNumber(t.target))return-1;var e=t.max-t.min;return 0!==e?(t.target-t.min)/e:0},s.convertDataLabelSettings=function(t,a,i,r){var o=s.getDefaultGaugeLabelSettings(i,r);if(t){var n=t[a];e.LabelUtils.updateLabelSettingsFromLabelsObject(n,o,void 0,i)}return o},s.convertDataPointSettings=function(t,a){var i=s.getDefaultDataPointSettings(a),r=e.ColorHelper.create(a);return{fillColor:r.getColorForPropertyWithDefaultColor(t,e.gaugeProps.dataPoint.fill,i.fillColor),targetColor:r.getColorForPropertyWithDefaultColor(t,e.gaugeProps.dataPoint.target,i.targetColor)}},s.formatStringProp={objectName:"general",propertyName:"formatString"},s}();e.GaugeConverter=s}(e=t.visuals||(t.visuals={}))}(powerbi||(powerbi={})),define("SingleValueVisuals/gaugeModule",["require","exports"],function(t,e){function a(t){return new powerbi.visuals.Gauge(t)}Object.defineProperty(e,"__esModule",{value:!0}),e.createGauge=a});
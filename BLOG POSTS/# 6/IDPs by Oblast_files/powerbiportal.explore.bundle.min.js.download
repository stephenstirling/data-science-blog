'use strict';
"use strict";
this.parseTimeMarkers = this.parseTimeMarkers || {};
var marker = this.parseTimeMarkers['powerbiportal.explore.bundle.min.js'] || {};
marker.startEval = Date.now();
var __extends=this&&this.__extends||(function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}})(),__assign=this&&this.__assign||Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++){t=arguments[r];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e},__awaiter=this&&this.__awaiter||function(e,t,r,i){return new(r||(r=Promise))(function(n,a){function o(e){try{l(i.next(e))}catch(e){a(e)}}function s(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){e.done?n(e.value):new r(function(t){t(e.value)}).then(o,s)}l((i=i.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){function r(e){return function(t){return i([e,t])}}function i(r){if(n)throw new TypeError("Generator is already executing.");for(;l;)try{if(n=1,a&&(o=2&r[0]?a.return:r[0]?a.throw||((o=a.return)&&o.call(a),0):a.next)&&!(o=o.call(a,r[1])).done)return o;switch(a=0,o&&(r=[2&r[0],o.value]),r[0]){case 0:case 1:o=r;break;case 4:return l.label++,{value:r[1],done:!1};case 5:l.label++,a=r[1],r=[0];continue;case 7:r=l.ops.pop(),l.trys.pop();continue;default:if(o=l.trys,!(o=o.length>0&&o[o.length-1])&&(6===r[0]||2===r[0])){l=0;continue}if(3===r[0]&&(!o||r[1]>o[0]&&r[1]<o[3])){l.label=r[1];break}if(6===r[0]&&l.label<o[1]){l.label=o[1],o=r;break}if(o&&l.label<o[2]){l.label=o[2],l.ops.push(r);break}o[2]&&l.ops.pop(),l.trys.pop();continue}r=t.call(e,l)}catch(e){r=[6,e],a=0}finally{n=o=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}var n,a,o,s,l={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:r(0),throw:r(1),return:r(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s},powerbi;!(function(e){var t;!(function(t){function r(r,i,n,a,o,s,l,u,c,p,f,d,h,v,m,g,y,C,x,b){var S=t.CustomerAction(c,p,f,d,h,v,m,g,y,C,x,b),E=j(S.info,{rank:r,type:i,insightType:n,commonColumnCount:a,commonHighlightFilterCount:o,commonQueryFilterCount:s,relevanceScore:l,source:u});return{name:"PBI.Insights.ViewInsightInFocus",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:N(),formatted:function(){return e.extendFormatted({rank:E.rank,type:E.type,insightType:E.insightType,commonColumnCount:E.commonColumnCount,commonHighlightFilterCount:E.commonHighlightFilterCount,commonQueryFilterCount:E.commonQueryFilterCount,relevanceScore:E.relevanceScore,source:E.source},null,S.formatted())},info:E,loggers:t.InsightsViewInsightInFocusLoggers}}function i(r,i,n,a,o,s,l,u,c,p,f,d,h,v,m,g,y,C){var x=t.CustomerAction(l,u,c,p,f,d,h,v,m,g,y,C),b=j(x.info,{insightCount:r,entryPoint:i,contentProviderId:n,hashedModelId:a,isScoped:o,telemetryId:s});return{name:"PBI.Insights.ShowInsights",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:N(),formatted:function(){return e.extendFormatted({insightCount:b.insightCount,entryPoint:b.entryPoint,contentProviderId:b.contentProviderId,hashedModelId:b.hashedModelId,isScoped:b.isScoped,telemetryId:b.telemetryId},null,x.formatted())},info:b,loggers:t.InsightsShowInsightsLoggers}}function n(r,i,n,a,o,s,l,u,c,p,f,d,h,v,m,g,y,C){var x=t.CustomerAction(l,u,c,p,f,d,h,v,m,g,y,C),b=j(x.info,{rank:r,type:i,insightType:n,pinEntryPoint:a,source:o,relevanceScore:s});return{name:"PBI.Insights.PinInsight",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:N(),formatted:function(){return e.extendFormatted({rank:b.rank,type:b.type,insightType:b.insightType,pinEntryPoint:b.pinEntryPoint,source:b.source,relevanceScore:b.relevanceScore},null,x.formatted())},info:b,loggers:t.InsightsPinInsightLoggers}}function a(r,i,n,a,o,s,l,u,c,p,f,d,h,v,m,g){var y=t.CustomerAction(o,s,l,u,c,p,f,d,h,v,m,g),C=j(y.info,{insightCount:r,source:i,errorType:n,telemetryId:a});return{name:"PBI.Insights.GetInsights",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:N(),formatted:function(){return e.extendFormatted({insightCount:C.insightCount,source:C.source,errorType:C.errorType,telemetryId:C.telemetryId},null,y.formatted())},info:C,loggers:t.InsightsGetInsightsLoggers}}function o(r,i,n,a,o,s,l,u,c,p,f,d,h,v,m,g,y){var C=t.CustomerAction(s,l,u,c,p,f,d,h,v,m,g,y),x=j(C.info,{feedback:r,columns:i,filters:n,highlights:a,source:o});return{name:"PBI.Insights.Feedback",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:N(),formatted:function(){return e.extendFormatted({feedback:x.feedback,columns:x.columns,filters:x.filters,highlights:x.highlights,source:x.source},null,C.formatted())},info:x,loggers:t.InsightsFeedbackLoggers}}function s(r,i,n,a,o,s,l,u,c,p,f,d,h,v,m,g,y,C,x){var b=t.CustomerAction(u,c,p,f,d,h,v,m,g,y,C,x),S=j(b.info,{analysisType:r,numberOfInsights:i,source:n,pagesInReport:a,totalVisuals:o,averageVisualsPerPage:s,telemetryId:l});return{name:"PBI.Insights.Explore.InsightRequest",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:N(),formatted:function(){return e.extendFormatted({analysisType:S.analysisType,numberOfInsights:S.numberOfInsights,source:S.source,pagesInReport:S.pagesInReport,totalVisuals:S.totalVisuals,averageVisualsPerPage:S.averageVisualsPerPage,telemetryId:S.telemetryId},null,b.formatted())},info:S,loggers:t.InsightsExploreInsightRequestLoggers}}function l(r,i,n,a,o,s,l,u,c,p,f,d,h,v){var m=t.CustomerAction(n,a,o,s,l,u,c,p,f,d,h,v),g=j(m.info,{visualType:r,displayType:i});return{name:"PBI.EX.ToggleVisualDisplay",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:N(),formatted:function(){return e.extendFormatted({visualType:g.visualType,displayType:g.displayType},null,m.formatted())},info:g,loggers:t.EXToggleVisualDisplayLoggers}}function u(r,i,n,a,o,s,l,u,c,p,f,d,h){var v=t.Verbose(i,n,a,o,s,l,u,c,p,f,d,h),m=j(v.info,{fromCache:r});return{name:"PBI.EX.GetExploration",category:e.TelemetryCategory.Verbose,time:Date.now(),id:N(),formatted:function(){return e.extendFormatted({fromCache:m.fromCache},null,v.formatted())},info:m,loggers:t.EXGetExplorationLoggers}}function c(r,i,n,a,o,s,l,u,c,p,f,d,h,v,m){var g=t.Verbose(a,o,s,l,u,c,p,f,d,h,v,m),y=j(g.info,{explorationVersion:r,length:i,upgraderCount:n});return{name:"PBI.EX.DeserializeExploration",category:e.TelemetryCategory.Verbose,time:Date.now(),id:N(),formatted:function(){return e.extendFormatted({explorationVersion:y.explorationVersion,length:y.length,upgraderCount:y.upgraderCount},null,g.formatted())},info:y,loggers:t.EXDeserializeExplorationLoggers}}function p(r,i,n,a,o,s,l,u,c,p,f,d,h){var v=t.Verbose(i,n,a,o,s,l,u,c,p,f,d,h),m=j(v.info,{code:r});return{name:"PBI.EX.VisualQueryGeneratorWarning",category:e.TelemetryCategory.Verbose,time:Date.now(),id:N(),formatted:function(){return e.extendFormatted({code:m.code},null,v.formatted())},info:m,loggers:t.EXVisualQueryGeneratorWarningLoggers}}function f(r,i,n){var a={code:r,debugInfo:i,message:n};return{name:"PBI.EX.VisualQueryGeneratorError",category:e.TelemetryCategory.CriticalError,time:Date.now(),id:N(),formatted:function(){return e.extendFormatted({code:a.code,debugInfo:a.debugInfo,message:a.message},null)},info:a,loggers:t.EXVisualQueryGeneratorErrorLoggers}}function d(r,i,n,a,o,s,l,u,c,p,f,d,h,v,m,g,y,C,x,b,S,E,w){var F=t.CustomerAction(d,h,v,m,g,y,C,x,b,S,E,w),V=j(F.info,{action:r,editor:i,dataType:n,groupCount:a,totalGroupCount:o,groupedValues:s,groupedValuesMin:l,groupedValuesMax:u,ungroupedValues:c,isOtherEnabled:p,hasGroupOnKeys:f});return{name:"PBI.EX.Groups.GroupsAction",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:N(),formatted:function(){return e.extendFormatted({action:V.action,editor:V.editor,dataType:V.dataType,groupCount:V.groupCount,totalGroupCount:V.totalGroupCount,groupedValues:V.groupedValues,groupedValuesMin:V.groupedValuesMin,groupedValuesMax:V.groupedValuesMax,ungroupedValues:V.ungroupedValues,isOtherEnabled:V.isOtherEnabled,hasGroupOnKeys:V.hasGroupOnKeys},null,F.formatted())},info:V,loggers:t.EXGroupsGroupsActionLoggers}}function h(r,i,n,a,o,s,l,u,c,p,f,d,h,v,m,g,y){var C=t.CustomerAction(s,l,u,c,p,f,d,h,v,m,g,y),x=j(C.info,{action:r,editor:i,sourceDataType:n,binSize:a,binUnit:o});return{name:"PBI.EX.Groups.BinBySizeAction",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:N(),formatted:function(){return e.extendFormatted({action:x.action,editor:x.editor,sourceDataType:x.sourceDataType,binSize:x.binSize,binUnit:x.binUnit},null,C.formatted())},info:x,loggers:t.EXGroupsBinBySizeActionLoggers}}function v(r,i,n,a,o,s,l,u,c,p,f,d,h,v,m,g,y,C){var x=t.CustomerAction(l,u,c,p,f,d,h,v,m,g,y,C),b=j(x.info,{action:r,editor:i,sourceDataType:n,binCount:a,min:o,max:s});return{name:"PBI.EX.Groups.BinByCountAction",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:N(),formatted:function(){return e.extendFormatted({action:b.action,editor:b.editor,sourceDataType:b.sourceDataType,binCount:b.binCount,min:b.min,max:b.max},null,x.formatted())},info:b,loggers:t.EXGroupsBinByCountActionLoggers}}function m(r,i,n,a,o,s,l,u,c,p,f,d,h,v,m,g,y){var C=t.CustomerAction(s,l,u,c,p,f,d,h,v,m,g,y),x=j(C.info,{visualType:r,role:i,sourceRole:n,action:a,groupType:o});return{name:"PBI.EX.Groups.Usage",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:N(),formatted:function(){return e.extendFormatted({visualType:x.visualType,role:x.role,sourceRole:x.sourceRole,action:x.action,groupType:x.groupType},null,C.formatted())},info:x,loggers:t.EXGroupsUsageLoggers}}function g(r,i,n,a){var o={errorType:r,action:i,groupType:n,message:a};return{name:"PBI.EX.Groups.Error",category:e.TelemetryCategory.CriticalError,time:Date.now(),id:N(),formatted:function(){return e.extendFormatted({errorType:o.errorType,action:o.action,groupType:o.groupType,message:o.message},null)},info:o,loggers:t.EXGroupsErrorLoggers}}function y(r,i,n,a,o,s,l,u,c,p,f,d,h){var v=t.CustomerAction(i,n,a,o,s,l,u,c,p,f,d,h),m=j(v.info,{operation:r});return{name:"PBI.EX.ModelChange",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:N(),formatted:function(){return e.extendFormatted({operation:m.operation},null,v.formatted())},info:m,loggers:t.EXModelChangeLoggers}}function C(r,i,n,a,o,s,l,u,c,p,f,d,h,v){var m=t.CustomerAction(n,a,o,s,l,u,c,p,f,d,h,v),g=j(m.info,{message:r,actionId:i});return{name:"PBI.EX.Measures",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:N(),formatted:function(){return e.extendFormatted({message:g.message,actionId:g.actionId},null,m.formatted())},info:g,loggers:t.EXMeasuresLoggers}}function x(r,i,n,a,o,s,l,u,c,p,f,d,h,v){var m=t.CustomerAction(n,a,o,s,l,u,c,p,f,d,h,v),g=j(m.info,{sourceType:r,targetType:i});return{name:"PBI.EX.ReportMeasureDataTypeChange",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:N(),formatted:function(){return e.extendFormatted({sourceType:g.sourceType,targetType:g.targetType},null,m.formatted())},info:g,loggers:t.EXReportMeasureDataTypeChangeLoggers}}function b(r,i,n,a,o,s,l,u,c,p,f,d,h,v){var m=t.CustomerAction(n,a,o,s,l,u,c,p,f,d,h,v),g=j(m.info,{sourceType:r,targetType:i});return{name:"PBI.EX.ReportMeasureDataCategoryChange",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:N(),formatted:function(){return e.extendFormatted({sourceType:g.sourceType,targetType:g.targetType},null,m.formatted())},info:g,loggers:t.EXReportMeasureDataCategoryChangeLoggers}}function S(r,i,n,a,o,s,l,u,c,p,f,d,h,v,m){var g=t.CustomerAction(a,o,s,l,u,c,p,f,d,h,v,m),y=j(g.info,{dataType:r,sourceTypes:i,targetTypes:n});return{name:"PBI.EX.ReportMeasureMoveRoleKind",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:N(),formatted:function(){return e.extendFormatted({dataType:y.dataType,sourceTypes:y.sourceTypes,targetTypes:y.targetTypes},null,g.formatted())},info:y,loggers:t.EXReportMeasureMoveRoleKindLoggers}}function E(r,i,n,a,o,s,l,u,c,p,f,d,h){var v=t.CustomerAction(i,n,a,o,s,l,u,c,p,f,d,h),m=j(v.info,{daxTemplateName:r});return{name:"PBI.EX.QuickCalcMeasureEdited",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:N(),formatted:function(){return e.extendFormatted({daxTemplateName:m.daxTemplateName},null,v.formatted())},info:m,loggers:t.EXQuickCalcMeasureEditedLoggers}}function w(r,i,n,a,o,s,l,u,c,p,f,d,h){var v=t.CustomerAction(i,n,a,o,s,l,u,c,p,f,d,h),m=j(v.info,{daxTemplateName:r});return{name:"PBI.EX.QuickCalcMeasureDeleted",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:N(),formatted:function(){return e.extendFormatted({daxTemplateName:m.daxTemplateName},null,v.formatted())},info:m,loggers:t.EXQuickCalcMeasureDeletedLoggers}}function F(r,i,n,a,o,s,l,u,c,p,f,d,h,v){var m=t.Verbose(n,a,o,s,l,u,c,p,f,d,h,v),g=j(m.info,{visualType:r,fixedRoleByProjectionCount:i});return{name:"PBI.EX.VisualDrillableRoleActiveItemsFixed",category:e.TelemetryCategory.Verbose,time:Date.now(),id:N(),formatted:function(){return e.extendFormatted({visualType:g.visualType,fixedRoleByProjectionCount:g.fixedRoleByProjectionCount},null,m.formatted())},info:g,loggers:t.EXVisualDrillableRoleActiveItemsFixedLoggers}}function V(r,i){var n=t.ErrorWithStackTrace(r,i),a=j(n.info,{});return{name:"PBI.PersistentState.SerializationError",category:e.TelemetryCategory.CriticalError,time:Date.now(),id:N(),formatted:function(){return e.extendFormatted(null,null,n.formatted())},info:a,loggers:t.PersistentStateSerializationErrorLoggers}}function _(r,i,n,a,o){var s=t.ErrorWithStackTrace(a,o),l=j(s.info,{type:r,errorCode:i,details:n});return{name:"PBI.SerializationError",category:e.TelemetryCategory.CriticalError,time:Date.now(),id:N(),formatted:function(){return e.extendFormatted({type:l.type,errorCode:l.errorCode,details:l.details},null,s.formatted())},info:l,loggers:t.SerializationErrorLoggers}}function P(r,i,n,a,o,s,l,u,c,p,f,d){var h=t.Verbose(r,i,n,a,o,s,l,u,c,p,f,d),v=j(h.info,{});return{name:"PBI.EX.EmptyVisualContainerConfig",category:e.TelemetryCategory.Verbose,time:Date.now(),id:N(),formatted:function(){return e.extendFormatted(null,null,h.formatted())},info:v,loggers:t.EXEmptyVisualContainerConfigLoggers}}function D(r,i,n,a,o,s,l,u,c,p,f,d,h){var v=t.CustomerAction(i,n,a,o,s,l,u,c,p,f,d,h),m=j(v.info,{sameReport:r});return{name:"PBI.ClipboardService.Paste",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:N(),formatted:function(){return e.extendFormatted({sameReport:m.sameReport},null,v.formatted())},info:m,loggers:t.ClipboardServicePasteLoggers}}function R(r,i,n,a,o,s,l,u,c,p,f,d,h){var v=t.CustomerAction(i,n,a,o,s,l,u,c,p,f,d,h),m=j(v.info,{dataVersion:r});return{name:"PBI.ClipboardService.UnsupportedVersion",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:N(),formatted:function(){return e.extendFormatted({dataVersion:m.dataVersion},null,v.formatted())},info:m,loggers:t.ClipboardServiceUnsupportedVersionLoggers}}function T(r,i,n,a,o,s,l,u,c,p,f,d,h){var v=t.Verbose(i,n,a,o,s,l,u,c,p,f,d,h),m=j(v.info,{constructorNames:r});return{name:"PBI.EX.LoopingSQExpr",category:e.TelemetryCategory.Verbose,time:Date.now(),id:N(),formatted:function(){return e.extendFormatted({constructorNames:m.constructorNames},null,v.formatted())},info:m,loggers:t.EXLoopingSQExprLoggers}}var N,I=jsCommon.Utility,j=jsCommon.UnionExtensions.mergeUnionType;N=I?I.generateGuid:Function.prototype,t.InsightsViewInsightInFocus=r,t.InsightsShowInsights=i,t.InsightsPinInsight=n,t.InsightsGetInsights=a,t.InsightsFeedback=o,t.InsightsExploreInsightRequest=s,t.EXToggleVisualDisplay=l,t.EXGetExploration=u,t.EXDeserializeExploration=c,t.EXVisualQueryGeneratorWarning=p,t.EXVisualQueryGeneratorError=f,t.EXGroupsGroupsAction=d,t.EXGroupsBinBySizeAction=h,t.EXGroupsBinByCountAction=v,t.EXGroupsUsage=m,t.EXGroupsError=g,t.EXModelChange=y,t.EXMeasures=C,t.EXReportMeasureDataTypeChange=x,t.EXReportMeasureDataCategoryChange=b,t.EXReportMeasureMoveRoleKind=S,t.EXQuickCalcMeasureEdited=E,t.EXQuickCalcMeasureDeleted=w,t.EXVisualDrillableRoleActiveItemsFixed=F,t.PersistentStateSerializationError=V,t.SerializationError=_,t.EXEmptyVisualContainerConfig=P,t.ClipboardServicePaste=D,t.ClipboardServiceUnsupportedVersion=R,t.EXLoopingSQExpr=T})(t=e.telemetry||(e.telemetry={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){function t(e){return void 0!==e.children}function r(e){return!t(e)}e.isBookmarkGroup=t,e.isStateBookmark=r})(t=e.Bookmark||(e.Bookmark={}))})(t=e.contracts||(e.contracts={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(r){function i(e){return void 0===e&&(e=[]),a.extendWithName(a.extendWithId(e))}function n(r){var i=t.constants.DefaultSchemaName;return{type:e.common.constants.dsrDataReaderType,id:r.id,name:i,dsr:{schemaName:i,vsName:r.vsName,dbName:r.dbName,modelId:r.id}}}var a=jsCommon.ArrayExtensions,o=e.data.DataReaderUtils;r.createDataSourceArray=i,r.dataSourceForModel=n;var s;!(function(e){function t(e){return _.includes(Object.keys(e),"extends")}function r(e,t){if(!_.isEmpty(e)){var r,i=o.findSchemas(t);return r=i?_.filter(e,(function(e){return _.includes(i,e.name)})):e,n(r)}}function i(e,r){if(!_.isEmpty(e)){var i=o.findSchemas(r);return i?_.chain(e).filter((function(e){return _.includes(i,e.name)})).map((function(r){return t(r)?_.find(e,(function(e){return e.name===r.extends})):r})).uniq().value():_.filter(e,(function(e){return!t(e)}))}}function n(e){return _.map(e,(function(e){return e[o.readerType(e)]}))}e.isExtension=t,e.referenced=r,e.queried=i,e.dataReaderDataSources=n})(s=r.DataSource||(r.DataSource={}))})(r=t.contracts||(t.contracts={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(r){function i(e,i,a){var o=t.constants,s={};return a.featureSwitches.newVisualContainerHeader&&(s.useStylableVisualContainerHeader=!0),a.featureSwitches.exportDataMode&&(s.exportDataMode=1),a.featureSwitches.reportAnnotationsUI&&(s.isReportAnnotationsEnabled=!0),a.featureSwitches.improvedFilterExperience&&(s.useNewFilterPaneExperience=!0),{themeCollection:{baseTheme:t.util.ThemeUtils.getCurrentBaseThemeMetadata()},id:0,width:o.ExploreCanvasConstants.DefaultCanvasWidth,height:o.ExploreCanvasConstants.DefaultCanvasHeight,dataSources:r.createDataSourceArray(),sections:n.extendWithId([{id:0,name:"ReportSection",displayName:e,visualContainers:i,filters:[],size:{displayOption:1,width:o.ExploreCanvasConstants.DefaultWidescreenWidth,height:o.ExploreCanvasConstants.DefaultWidescreenHeight}}]),settings:_.isEmpty(s)?void 0:s}}var n=jsCommon.ArrayExtensions,a=e.data.createDisplayNameGetter;r.createDefaultExploration=i,r.ExplorationObjectDescriptors={outspacePane:{displayName:a("Exploration_FilterPane"),properties:{expanded:{type:{bool:!0}},visible:{type:{bool:!0}}}}};var o=(function(){function e(e){"string"==typeof e?this.originalExplorationJSON=e:this.originalExploration=e}return e.prototype.value=function(){return!this.originalExploration&&this.originalExplorationJSON&&(this.originalExploration=jsCommon.JsonExtensions.tryParseJSON(this.originalExplorationJSON),this.originalExplorationJSON=void 0),this.originalExploration},e.Empty=new e,e})();r.OriginalExploration=o})(r=t.contracts||(t.contracts={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){e.ObjectType="filter",e.CommonObjectDescriptors={general:{properties:{requireSingleSelect:{type:{bool:!0}}}}}})(t=e.FilterContainer||(e.FilterContainer={}));var r;!(function(e){e[e.Categorical=0]="Categorical",e[e.Range=1]="Range",e[e.Advanced=2]="Advanced",e[e.Passthrough=3]="Passthrough",e[e.Visual=4]="Visual",e[e.TopN=5]="TopN",e[e.Include=6]="Include",e[e.Exclude=7]="Exclude",e[e.RelativeDate=8]="RelativeDate",e[e.Tuple=9]="Tuple"})(r=e.FilterType||(e.FilterType={}))})(t=e.contracts||(e.contracts={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){e[e.Self=1]="Self",e[e.Slicer=2]="Slicer"})(t=e.CollectedFilterSource||(e.CollectedFilterSource={}))})(t=e.contracts||(e.contracts={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){var r,i=e.data.createDisplayNameGetter;!(function(e){function t(e){return _.filter(e,(function(e){return!e.transient}))}e.objectDescriptors={background:{displayName:i("PagePropertyPane_PageBackground"),properties:{color:{displayName:i("PagePropertyPane_PageBackgroundColor"),type:{fill:{solid:{color:!0}}}},image:{type:{image:{}}},transparency:{displayName:i("Transparency"),type:{numeric:!0}}}},outspace:{displayName:i("PagePropertyPane_Outspace"),properties:{color:{displayName:i("PagePropertyPane_PageBackgroundColor"),type:{fill:{solid:{color:!0}}}},image:{type:{image:{}}},transparency:{displayName:i("Transparency"),type:{numeric:!0}}}},outspacePane:{displayName:i("Exploration_FilterPane"),properties:{backgroundColor:{displayName:i("PagePropertyPane_OutspacePane_BackgroundColor"),type:{fill:{solid:{color:!0}}},description:i("PagePropertyPane_OutspacePane_BackgroundColorTooltip")},transparency:{displayName:i("Transparency"),type:{numeric:!0},description:i("PagePropertyPane_OutspacePane_BackgroundTransparencyTooltip")},foregroundColor:{displayName:i("PagePropertyPane_OutspacePane_ForegroundColor"),type:{fill:{solid:{color:!0}}},description:i("PagePropertyPane_OutspacePane_ForegroundColorTooltip")},titleSize:{displayName:i("Visual_AxisTitleTextSize"),type:{integer:!0},description:i("PagePropertyPane_OutspacePane_TitleSizeTooltip")},headerSize:{displayName:i("PagePropertyPane_OutspacePane_HeaderSize"),type:{integer:!0},description:i("PagePropertyPane_OutspacePane_HeaderSizeTooltip")},fontFamily:{displayName:i("Visual_FontFamily"),type:{formatting:{fontFamily:!0}},description:i("PagePropertyPane_OutspacePane_FontFamilyTooltip")},border:{displayName:i("PagePropertyPane_OutspacePane_LeftBorder"),type:{bool:!0},description:i("PagePropertyPane_OutspacePane_LeftBorderTooltip")},borderColor:{displayName:i("PagePropertyPane_OutspacePane_BorderColor"),type:{fill:{solid:{color:!0}}},description:i("PagePropertyPane_OutspacePane_BorderColorTooltip")}}},filterCard:{displayName:i("PagePropertyPane_FilterCards"),properties:{backgroundColor:{displayName:i("PagePropertyPane_OutspacePane_BackgroundColor"),type:{fill:{solid:{color:!0}}},description:i("PagePropertyPane_FilterCards_BackgroundColorTooltip")},transparency:{displayName:i("Transparency"),type:{integer:!0},description:i("PagePropertyPane_FilterCards_BackgroundTransparencyTooltip")},border:{displayName:i("Visual_Border"),type:{bool:!0},description:i("PagePropertyPane_FilterCards_BorderTooltip")},borderColor:{displayName:i("PagePropertyPane_FilterCards_BorderColor"),type:{fill:{solid:{color:!0}}},description:i("PagePropertyPane_FilterCards_BorderColorTooltip")}}}},e.filterTransient=t})(r=t.Section||(t.Section={}))})(r=t.contracts||(t.contracts={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){e.SnapshotReportType="Report";var t;!(function(e){e[e.Static=0]="Static",e[e.Interactive=1]="Interactive"})(t=e.EmbedType||(e.EmbedType={}))})(t=e.contracts||(e.contracts={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){var r,i=e.data.createDisplayNameGetter,n=e.data.DataViewObjectDefinitions;!(function(r){function i(e){return e.type||t.VisualLink.Back}r.Bookmark="Bookmark",r.Back="Back",r.Qna="Qna",r.Type=e.createEnumType([{value:r.Back,displayName:function(e){return e.get("Generic_Back")}},{value:r.Bookmark,displayName:function(e){return e.get("Generic_Bookmark")}},{value:r.Qna,displayName:function(e){return e.get("Generic_Qna")}}]),r.getType=i,r.BookmarkNone=""})(r=t.VisualLink||(t.VisualLink={}));var a;!(function(t){function r(e){return e.type}t.Default="Default",t.Canvas="Canvas",t.Type=e.createEnumType([{value:t.Default,displayName:function(e){return e.get("Default")}},{value:t.Canvas,displayName:function(e){return e.get("ReportPage")}}]),t.getType=r,t.SectionAuto="___AUTO___"})(a=t.VisualTooltip||(t.VisualTooltip={}));var o;!(function(e){function t(e){return!!e&&e.show===!1}e.isHidden=t})(o=t.VisualTitle||(t.VisualTitle={}));var s;!(function(e){function t(e,t){if(e){var r=t.serializeVisualContainer(e);return t.deserializeVisualContainer(r,!0)}}function n(e){return!!e.display&&"hidden"===e.display.mode}function o(e,t){t?e.display={mode:"hidden"}:e.display=void 0}e.EmptyConfig={singleVisual:{visualType:"uninitializedVisual"}},jsCommon.FreezeUtility.deepFreeze(e.EmptyConfig),e.CommonObjectDescriptors={title:{displayName:i("Visual_Title"),description:i("Visual_TitleDescription"),properties:{show:{displayName:i("Visual_Show"),type:{bool:!0}},text:{displayName:i("Visual_Title_Text"),description:i("Visual_Title_TextDescription"),type:{text:!0},suppressFormatPainterCopy:!0},titleWrap:{displayName:i("Visual_Word_Wrap"),type:{bool:!0}},fontColor:{displayName:i("Visual_FontColor"),description:i("Visual_Title_FontColorDescription"),type:{fill:{solid:{color:!0}}}},background:{displayName:i("Background_Color"),description:i("Visual_Title_BackgroundColorDescription"),type:{fill:{solid:{color:{nullable:!0}}}}},alignment:{displayName:i("Visual_Title_Alignment"),description:i("Visual_Title_AlignmentDescription"),type:{formatting:{alignment:!0}}},fontSize:{displayName:i("Visual_TextSize"),description:i("Visual_TextSizeDescription"),type:{formatting:{fontSize:!0}}},fontFamily:{displayName:i("Visual_FontFamily"),type:{formatting:{fontFamily:!0}}}}},background:{displayName:i("Visual_Background"),properties:{show:{displayName:i("Visual_Show"),type:{bool:!0}},color:{displayName:i("Visual_Background_Color"),description:i("Visual_Background_ColorDescription"),type:{fill:{solid:{color:!0}}}},transparency:{displayName:i("Transparency"),description:i("Visual_Background_TransparencyDescription"),type:{numeric:!0}}}},lockAspect:{displayName:i("Visual_BasicShape_LockAspect"),properties:{show:{displayName:i("Visual_Show"),type:{bool:!0}}}},general:{displayName:i("Visual_General_Properties"),properties:{x:{displayName:i("Visual_General_Properties_X_Coordinate"),type:{numeric:!0}},y:{displayName:i("Visual_General_Properties_Y_Coordinate"),type:{numeric:!0}},width:{displayName:i("Visual_General_Properties_Width"),type:{numeric:!0}},height:{displayName:i("Visual_General_Properties_Height"),type:{numeric:!0}},altText:{displayName:i("Visual_General_Properties_Description"),placeHolderText:i("Visual_General_Properties_Description_Placeholder"),type:{formatting:{altText:!0}}},allowBinnedLineSample:{displayName:i("Visual_General_HighDensitySampling"),description:i("Visual_General_HighDensitySamplingDescription"),type:{bool:!0}},allowOverlappingPointsSample:{displayName:i("Visual_General_HighDensitySampling"),description:i("Visual_General_HighDensitySamplingDescription"),type:{bool:!0}}}},border:{displayName:i("Visual_Border"),properties:{show:{displayName:i("Visual_Show"),type:{bool:!0}},color:{displayName:i("Visual_Border_Color"),type:{fill:{solid:{color:!0}}}}}},visualLink:{displayName:i("Visual_VisualLink"),properties:{show:{displayName:i("Visual_Show"),type:{bool:!0}},type:{displayName:i("Type"),description:i("Visual_VisualLink_Type_Description"),type:{enumeration:r.Type}},bookmark:{displayName:i("Generic_Bookmark"),description:i("Visual_VisualLink_Bookmark_Description"),type:{reference:{bookmark:!0}}},tooltip:{displayName:i("Tooltip"),description:i("Visual_VisualLink_Tooltip_Description"),type:{text:!0},suppressFormatPainterCopy:!0}}},visualTooltip:{displayName:i("Tooltip"),properties:{show:{displayName:i("Visual_Show"),type:{bool:!0}},type:{displayName:i("Type"),description:i("Visual_Tooltip_Type_Description"),type:{enumeration:a.Type}},section:{displayName:i("Page"),description:i("Visual_Tooltip_Section_Description"),type:{reference:{section:!0}}}}},stylePreset:{displayName:i("Visual_Table_StylePreset_SliceTitle"),properties:{name:{displayName:i("Visual_Table_StylePreset_SliceTitle"),type:{formatting:{stylePreset:!0}}}}},visualHeader:{displayName:i("Visual_Header"),description:i("VisualHeader_Toggle_Description"),properties:{show:{displayName:i("Visual_Show"),type:{bool:!0}},background:{displayName:i("Background_Color"),description:i("VisualHeader_Background_ColorDescription"),type:{fill:{solid:{color:!0}}}},border:{displayName:i("Visual_Border"),description:i("Visual_Border"),type:{fill:{solid:{color:!0}}}},transparency:{displayName:i("Transparency"),description:i("VisualHeader_Background_TransparencyDescription"),type:{numeric:!0}},foreground:{displayName:i("VisualHeader_Foreground_Color"),description:i("VisualHeader_Foreground_ColorDescription"),type:{fill:{solid:{color:!0}}}},showVisualInformationButton:{displayName:i("VisualHeader_ShowVisualInformationButton"),description:i("VisualHeader_ShowVisualInformationButton_Description"),type:{bool:!0}},showVisualWarningButton:{displayName:i("VisualHeader_ShowVisualWarningButton"),description:i("VisualHeader_ShowVisualWarningButton_Description"),type:{bool:!0}},showVisualErrorButton:{displayName:i("VisualHeader_ShowVisualErrorButton"),description:i("VisualHeader_ShowVisualErrorButton_Description"),type:{bool:!0}},showDrillRoleSelector:{displayName:i("VisualHeader_ShowDrillRoleSelector"),description:i("VisualHeader_ShowDrillRoleSelector_Description"),type:{bool:!0}},showDrillUpButton:{displayName:i("VisualHeader_ShowDrillUpButton"),description:i("VisualHeader_ShowDrillUpButton_Description"),type:{bool:!0}},showDrillToggleButton:{displayName:i("VisualHeader_ShowDrillToggleButton"),description:i("VisualHeader_ShowDrillToggleButton_Description"),type:{bool:!0}},showDrillDownLevelButton:{displayName:i("VisualHeader_ShowDrillDownLevelButton"),description:i("VisualHeader_ShowDrillDownLevelButton_Description"),type:{bool:!0}},showDrillDownExpandButton:{displayName:i("VisualHeader_ShowDrillDownExpandButton"),description:i("VisualHeader_ShowDrillDownExpandButton_Description"),type:{bool:!0}},showPinButton:{displayName:i("VisualHeader_ShowPinButton"),description:i("VisualHeader_ShowPinButton_Description"),type:{bool:!0}},showFilterRestatementButton:{displayName:i("VisualHeader_ShowFilterRestatementButton"),description:i("VisualHeader_ShowFilterRestatementButton_Description"),type:{bool:!0}},showFocusModeButton:{displayName:i("VisualHeader_ShowFocusModeButton"),description:i("VisualHeader_ShowFocusModeButton_Description"),type:{bool:!0}},showSeeDataLayoutToggleButton:{displayName:i("VisualHeader_ShowSeeDataLayoutToggleButton"),description:i("VisualHeader_ShowSeeDataLayoutToggleButton_Description"),type:{bool:!0}},showOptionsMenu:{displayName:i("VisualHeader_ShowOptionsMenu"),description:i("VisualHeader_ShowOptionsMenu_Description"),type:{bool:!0}}}}},e.clone=t,e.isHidden=n,e.setHidden=o})(s=t.VisualContainer||(t.VisualContainer={}));var l;!(function(e){function t(e){if(e){var t={visualType:e.visualType};e.syncGroup&&(t.syncGroup=_.cloneDeep(e.syncGroup)),e.columnProperties&&(t.columnProperties=_.cloneDeep(e.columnProperties)),e.query&&(t.query=e.query.clone()),e.queryOptions&&(t.queryOptions=_.cloneDeep(e.queryOptions)),e.objects&&(t.objects=n.clone(e.objects)),e.vcObjects&&(t.vcObjects=n.clone(e.vcObjects)),e.hasDefaultSort&&(t.hasDefaultSort=e.hasDefaultSort);var r=e.conversionSourceContext;return r&&(t.conversionSourceContext={visualType:r.visualType,query:r.query&&r.query.clone(),syncGroup:r.syncGroup}),t}}function r(e,t){if(!e||!e.getCurrentVisual)return t.resolve();var r=e.getCurrentVisual();return r?r.enumerateObjectRepetitionAsync?r.enumerateObjectRepetitionAsync():r.enumerateObjectRepetition?t.resolve(r.enumerateObjectRepetition()):t.resolve():t.resolve()}e.clone=t,e.enumerateObjectRepetition=r})(l=t.SingleVisualConfig||(t.SingleVisualConfig={}));var u;!(function(e){function t(e){if(e.visualContainer)return e.visualContainer.config.singleVisual.visualType;
}e.getVisualType=t})(u=t.PinData||(t.PinData={}))})(r=t.contracts||(t.contracts={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){function t(e){switch(e){case 0:return"Default";case 1:return"DataFilter";case 2:return"HighlightFilter";case 3:return"NoFilter"}}e.toString=t})(t=e.VisualRelationshipFilterActionUtil||(e.VisualRelationshipFilterActionUtil={}))})(t=e.contracts||(e.contracts={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){var r=jsCommon.ArrayExtensions,i=e.data.ExpansionState,n=e.data.transforms.plugins.KMeansClustering,a=e.data.ProjectionUtils,o=e.data.QueryProjectionCollection,s=e.data.QueryProjectionsByRole,l=e.data.SemanticQuery,u=e.data.transforms.plugins.SpatialClustering,c=e.data.SQExpr,p=e.data.SQExprBuilder,f=(function(){function e(e,t,r){this.defn=e,this.projections=t,this.expansionStates=r||[];for(var i in t)_.isEmpty(t[i].activeProjectionRefs)||this.ensureActiveItems(i)}return e.prototype.ensureExpansionState=function(e){var t=i.findExpansionState(this.expansionStates,e);if(!t){t=new i(e);var r=this.getRolesUniqueProjectionRefs(e),n=this.getRolesUniqueActiveProjectionsRefs(e);t.updateLevels(r,n.length),this.expansionStates.push(t)}return t},e.prototype.add=function(e,t,r){var i=r&&r.exprName,n=r&&r.index,a=this.defn.selectNameOf(e);a||(a=this.addSelect(e,i));var s=this.getRoleProjections(t);s||(s=[],this.projections[t]=new o(s));var l={queryRef:a};return this.resetExpansionStates(),null==n||n>s.length?(s.push(l),s.length-1):(s.splice(n,0,l),this.addNewQueryRefToActiveProjectionRefsIfNeeded(t,a,n),n)},e.prototype.removeExpr=function(t,r,i){if(r){for(var n=this.defn.select(),a=!1,o=n.length-1;o>=0;--o){var s=n[o].expr;if(e.areEqualIgnoringAggregate(s,t,i)){if(!this.removeAllProjectionsForExpr(s))return!1;a=!0}}return a}return this.removeAllProjectionsForExpr(t)},e.prototype.getQueryRef=function(e,t){var r=this.getRoleProjections(e);if(r&&!(t>=r.length))return r[t].queryRef},e.prototype.removeProjection=function(e,t){var r=this.getQueryRef(e,t);if(!r)return!1;var i=this.defn.select().withName(r);if(!i)return!1;var n=i.expr,a=this.getRoleProjections(e);a.splice(t,1);var o=this.projections[e].activeProjectionRefs;return _.pull(o,r),_.isEmpty(a)?delete this.projections[e]:o&&0===o.length&&o.push(a[Math.max(0,t-1)].queryRef),this.isUsed(r)||this.removeExpr(n,!1),this.resetExpansionStates(),!0},e.prototype.moveProjection=function(e,t,r,i){if(t===r)return!1;var n=this.getRoleProjections(e);if(!n||r+i>n.length)return!1;if(t<0||r<0)return!1;var a=this.projections[e].activeProjectionRefs,o=n.splice(t,i);n.splice.apply(n,[r,0].concat(o));var s=r;if(r>t&&(s+=i),a)if(s<a.length){var l=_.take(n,r+1);this.projections[e].activeProjectionRefs=_.map(l,(function(e){return e.queryRef}))}else if(t<a.length){for(var u=0,c=o;u<c.length;u++){var p=c[u];_.pull(a,p.queryRef)}0===a.length&&a.push(n[0].queryRef)}return this.resetExpansionStates(),!0},e.prototype.setAggregate=function(e,t,r){return this.updateExpression(e,t,(function(e){return p.setAggregate(e,r)}))},e.prototype.removeAggregate=function(e,t,r){return this.updateExpression(e,t,(function(e){return p.removeAggregate(e,r)}))},e.prototype.setPercentOfGrandTotal=function(e,t){return this.updateExpression(e,t,(function(e){return p.setPercentOfGrandTotal(e)}))},e.prototype.removePercentOfGrandTotal=function(e,t){return this.updateExpression(e,t,(function(e){return p.removePercentOfGrandTotal(e)}))},e.prototype.setPercentOfRoleTotal=function(e,t,r){return this.updateExpression(t,r,(function(t){return p.setPercentOfRoleTotal(t,e)}))},e.prototype.removePercentOfRoleTotal=function(e,t){return this.updateExpression(e,t,(function(e){return p.removePercentOfRoleTotal(e)}))},e.prototype.orderBy=function(e){this.defn=this.defn.orderBy(e)},e.prototype.removeOrderBy=function(e){this.defn=this.defn.removeOrderBy(e)},e.prototype.removeUnusedOrderBy=function(){for(var e=this.defn,t=e.orderBy(),r=0,i=t;r<i.length;r++){var n=i[r],a=n.expr;e.selectNameOf(a)||(this.defn=e.removeOrderBy(a))}},e.prototype.addTransform=function(e,t,r){for(var i={},a=this.defn.transforms(),o=0,s=a;o<s.length;o++){i[s[o].name]=!0}var l=jsCommon.StringExtensions.findUniqueName(i,e.name),c={algorithm:e.name,name:l,input:{parameters:t},output:void 0};this.defn=this.defn.transforms(a.concat([c]));for(var f=(e.name===n.name||e.name===u.name)&&r.grouping&&r.grouping.cluster,d=0,h=e.outputRoles;d<h.length;d++){var v=h[d],m=v.name;f&&(m=r.grouping.cluster.clusteringRole),this.add(p.transformOutputRoleRef(v.algorithmRole),m,{exprName:v.columnName?v.columnName:v.algorithmRole})}return l},e.prototype.removeTransform=function(e,t){var r=_.find(this.defn.transforms(),(function(e){return e.name===t}));if(r){for(var i=0,n=e.outputRoles;i<n.length;i++){var a=n[i];this.removeExpr(p.transformOutputRoleRef(a.algorithmRole),!1)}this.defn=this.defn.removeTransform(r)}},e.prototype.updateTransform=function(e,t){var r=_.find(this.defn.transforms(),(function(t){return t.name===e}));r&&(r.input.parameters=t)},e.prototype.clone=function(){return new e(this.defn,s.clone(this.projections),i.clone(this.expansionStates))},e.prototype.equals=function(e){return!!l.equals(this.defn,e.defn)&&(_.isEqual(this.projections,e.projections)&&_.isEqual(this.expansionStates,e.expansionStates))},e.prototype.ensureDrillableRoles=function(e){for(var t=[],r=0,i=e;r<i.length;r++){var n=i[r];this.ensureActiveItems(n)&&t.push(n)}return t},e.prototype.ensureActiveItems=function(e){var t=this.projections[e];if(t){var r=t.all();return _.isEmpty(r)||t.activeProjectionRefs?void 0:(t.activeProjectionRefs=[r[0].queryRef],!0)}},e.prototype.toggleShowAll=function(e){var t=this.projections[e];t&&(t.showAll=!t.showAll)},e.prototype.roleContainsExpr=function(e,t){var r=this.projections[e],i=r&&r.all();if(_.isEmpty(i))return!1;for(var n=this.defn.select(),a=0,o=n;a<o.length;a++)for(var s=o[a],l=0,u=i;l<u.length;l++){var p=u[l];if(p.queryRef===s.name&&c.equals(t,s.expr))return!0}return!1},e.prototype.getRoleNameForExpr=function(e){var t=this.projections;for(var r in t){var i=this.tryGetExprs(r);if(i&&i.length>0)for(var n=0,a=i;n<a.length;n++){var o=a[n];if(c.equals(e,o))return r}}},e.prototype.tryGetExpr=function(e,t){var r=this.getRoleProjections(e);if(r){var i=r[t];return a.tryGetExprByProjection(this.defn,i)}},e.prototype.tryGetExprs=function(e){return a.tryGetExprs(this.defn,this.projections,e)},e.prototype.getUniqueQueryRefs=function(){var e=_.values(this.projections);return _.chain(e).map((function(e){return e.all()})).flatten(!0).map((function(e){return e.queryRef})).uniq().value()},e.prototype.currentDrillMode=function(e){var t=this.getRoleProjections(e);if(!_.isEmpty(t)){var r=this.projections[e];if(r){var i=r.activeProjectionRefs;if(!_.isEmpty(i)){if(i.length>1)return 2;if(i[0]!==t[0].queryRef)return 3}}}},e.prototype.addSelect=function(e,t){var r=this.defn;this.defn=r=r.addSelect(e,t);var i=r.select(),n=i.length-1;return i[n].name},e.prototype.removeAllProjectionsForExpr=function(e){var t=this.defn,r=t.selectNameOf(e);if(!r)return!1;var i=this.projections;for(var n in i){for(var a=i[n].all(),o=a.length-1;o>=0;o--){if(a[o].queryRef===r){a.splice(o,1);var s=i[n].activeProjectionRefs;_.pull(s,r),s&&_.isEmpty(s)&&!_.isEmpty(a)&&s.push(a[Math.max(0,o-1)].queryRef)}}0===a.length&&delete i[n]}return this.defn=t.removeSelect(e).removeOrderBy(e),this.resetExpansionStates(),!0},e.prototype.updateExpression=function(e,t,i){var n=this.getRoleProjections(e);if(!n||t>=n.length)return!1;var a=n[t],o=this.defn,s=a.queryRef,l=o.select(),u=r.indexWithName(l,s),c=l[u].expr,p=i(c),f=o.selectNameOf(p);return f?(a.queryRef=f,this.isUsed(s)||(this.defn=o.removeSelect(c)),!0):(this.getUsageCount(s)>1?a.queryRef=this.addSelect(p):this.defn=o.setSelectAt(u,p),!0)},e.prototype.isUsed=function(e){return this.getUsageCount(e)>0},e.prototype.getUsageCount=function(e){var t=0,r=this.projections;for(var i in r){var n=r[i].all();t+=_.filter(n,(function(t){return t.queryRef===e})).length}return t},e.prototype.getRoleProjections=function(e){var t=s.getRole(this.projections,e);if(t)return t.all()},e.prototype.addNewQueryRefToActiveProjectionRefsIfNeeded=function(e,t,r){var i=this.getRoleProjections(e),n=this.projections[e].activeProjectionRefs;n&&(n.length>1&&r<n.length?n.splice(r,0,t):1===n.length&&0===r&&i.length>1&&i[1].queryRef===n[0]&&n.splice(0,1,t))},e.prototype.getRolesProjectionRefs=function(e){for(var t=[],r=0,i=e;r<i.length;r++){var n=i[r],a=this.projections[n];if(a){var o=_.map(a.all(),(function(e){return e.queryRef}));t.push.apply(t,o)}}return t},e.prototype.getRolesUniqueProjectionRefs=function(e){return _.uniq(this.getRolesProjectionRefs(e))},e.prototype.resetExpansionStates=function(){this.expansionStates=[]},e.prototype.getRolesActiveProjectionsRefs=function(e){for(var t=[],r=0,i=e;r<i.length;r++){var n=i[r],a=this.projections[n],o=a.all(),s=a.activeProjectionRefs;if(s&&(t.push.apply(t,s),o.length!==s.length&&_.uniqBy(o,(function(e){return e.queryRef})).length!==_.uniq(s).length))break}return t},e.prototype.getRolesUniqueActiveProjectionsRefs=function(e){return _.uniq(this.getRolesActiveProjectionsRefs(e))},e.areEqualIgnoringAggregate=function(e,t,r){return c.equals(p.removeAggregate(e,r),p.removeAggregate(t,r))},e})();t.VisualQuery=f})(r=t.contracts||(t.contracts={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){e.CurrentExplorationVersion="3.21"})(t=e.upgrade||(e.upgrade={}))})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){var r,i=jsCommon.ArrayExtensions,n=e.data.dsr;!(function(e){function t(e,t){return e.modelExtensions&&e.modelExtensions.withName(t)}function r(e,r){var i=t(e,r);if(!i)throw new Error("Unable to find expected model extension: "+r);return i}function a(e,t,r){e.modelExtensions||(e.modelExtensions=i.createWithName());var n=e.modelExtensions.withName(t);return n||(n=o(t,r),e.modelExtensions.push(n)),n}function o(e,t){return{name:e,extends:t,entities:i.createWithName()}}function s(e,t,r){return c(a(e,t,n.DefaultSchemaName),r)}function l(e,t){return e.entities.withName(t)}function u(e,t,i){var n=r(e,t),a=l(n,i);if(!a)throw new Error("Unable to find expected entity: "+i);return a}function c(e,t){e.entities||(e.entities=i.createWithName());var r=e.entities.withName(t);return r||(r={name:t,extends:t,measures:i.createWithName()},e.entities.push(r)),r}function p(e,t){if(e.measures||(e.measures=i.createWithName()),e.measures.withName(t.name))throw new Error("Measure "+t.name+" already exists and cannot be added");e.measures.push(t)}function f(e,t,r,i){return h(u(e,t,r),i)}function d(e,t){return e.measures.withName(t)}function h(e,t){var r=d(e,t);if(!r)throw new Error("Unable to find expected measure:"+t);return r}function v(e,t,r,i){var n=u(e,t,r),a=h(n,i),o=n.measures.indexOf(a);n.measures.splice(o,1),0===n.measures.length&&(delete n.measures,x(e,t,n))}function m(e,t,r){null===r||void 0===r?y(e,t):g(e,t,r)}function g(e,t,r){e.annotations||(e.annotations=i.createWithName());var n=e.annotations.withName(t);n?n.value=r:(n={name:t,value:r},e.annotations.push(n))}function y(e,t){var r=e.annotations&&e.annotations.withName(t);if(r){var i=e.annotations.indexOf(r);e.annotations.splice(i,1),e.annotations&&0===e.annotations.length&&delete e.annotations}}function C(e,t){var r=e.annotations&&e.annotations.withName(t);if(r)return r.value}function x(e,t,i){if(!S(i)){var n=r(e,t),a=n.entities.indexOf(i);n.entities.splice(a,1),0===n.entities.length&&(delete n.entities,b(e,n))}}function b(e,t){if(!S(t)){var r=e.modelExtensions.indexOf(t);e.modelExtensions.splice(r,1),0===e.modelExtensions.length&&delete e.modelExtensions}}function S(e){var t=Object.keys(e),r=_.chain(t).filter((function(e){return"name"!==e&&"extends"!==e})).filter((function(t){return!(_.isArray(e[t])&&_.isEmpty(e[t]))})).value();return _.some(r)}function E(e){if(e){var t={Version:0,Name:e.name,Extends:e.extends};return e.entities&&(t.Entities=_.map(e.entities,(function(e){return w(e)}))),t}}function w(e){var t={Extends:e.extends,Name:e.name};return e.measures&&(t.Measures=_.map(e.measures,(function(e){return F(e)}))),t}function F(e){var t=e.dataType;return 6!==t&&9!==t||(t=7),{Name:e.name,Expression:e.expression,DataType:t}}e.getOptionalModelExtension=t,e.getExpectedModelExtension=r,e.getOrCreateModelExtension=a,e.createModelExtension=o,e.ensureEntityExists=s,e.findEntity=l,e.getExpectedEntity=u,e.getOrCreateExtendingEntity=c,e.addMeasure=p,e.getExpectedMeasure=f,e.findMeasureFromEntity=d,e.removeMeasure=v,e.setAnnotation=m,e.getAnnotationValue=C,e.toQueryExtensionSchema=E})(r=t.ModelExtensionUtils||(t.ModelExtensionUtils={}))})(r=t.util||(t.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function t(e){this.modelExtension=e,this.visited={}}return t.prototype.visitReference=function(t){if(t.schema===this.modelExtension.name){var r=e.ModelExtensionUtils.findEntity(this.modelExtension,t.entity);if(r){var i=e.ModelExtensionUtils.findMeasureFromEntity(r,t.name);if(i){var n=this.toVisitedKey(t);if(!this.visited[n]){this.visitMeasure(this.modelExtension,r,i),this.visited[n]=!0;for(var a=0,o=i.references.measures;a<o.length;a++){var s=o[a];this.visitReference(s)}}}}}},t.prototype.visitMeasure=function(e,t,r){},t.prototype.toVisitedKey=function(e){return JSON.stringify(e)},t})();e.ModelExtensionDependencyVisitor=t})(t=e.util||(e.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){var r,i=e.visualHost.utils.ResourcePackageUtils;!(function(e){function t(e,t,n){var a=r(e);return i.ensureResourcePackage(a,t,n)}function r(e){var t=e.resourcePackages;return t||(t=[],e.resourcePackages=t),t}function n(e,t){if(!_.isEmpty(t)&&!_.isEmpty(e))for(var r=0,n=t;r<n.length;r++){var a=n[r],o=i.findResourcePackage(e,a.type,a.name);if(o){a.id=o.id;for(var s=0,l=a.items;s<l.length;s++){var u=l[s],c=i.findItemInPackage(o,u.name);c&&(u.id=c.id)}}}}e.ensureResourcePackageType=t,e.ensureResourcePackages=r,e.synchronizePackageIds=n})(r=t.ResourcePackageUtils||(t.ResourcePackageUtils={}))})(r=t.util||(t.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){var r,i=e.explore.services.upgrade.CurrentExplorationVersion,n=e.data.DataViewObjectDefinitions,a=e.explore.contracts.ExplorationObjectDescriptors;!(function(t){function r(t,r,n){return e.getThemeMetadata(t,r,n||i)}function o(){return{name:e.explore.constants.DefaultBaseThemeName,version:i,type:2}}function s(t,r){var i=t.themeCollection,o=e.explore.constants.ExplorationComponentType,s=t.objects,l=r.getVisualObjects(i,o,void 0,a);l&&(s=n.clone(s||{}),n.extend(s,l));var u=r.getVisualStyle(i),c=e.data.createStaticEvalContext(u);t.evaluatedObjects=e.data.DataViewTransform.evaluateMetadataOnceDataViewObjectDefinitions(s,a,c)}t.getThemeMetadata=r,t.getCurrentBaseThemeMetadata=o,t.evaluateObjects=s})(r=t.ThemeUtils||(t.ThemeUtils={}))})(r=t.util||(t.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){function t(t,r,i){t[e.ExplorationDataReaderType]={name:"exploration",extends:"dsr",queryExtensionProvider:e.createExplorationQueryExtensionProvider(),schemaReader:function(){return e.createConceptualSchemaReader(r,i)}}}e.ExplorationDataReaderType="exploration",e.registerExplorationDataReaderExtension=t})(t=e.dataReaderPlugins||(e.dataReaderPlugins={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){function r(){return i}function i(e){return function(t,r){var i={query:t,extensions:void 0};if(1!==e.length)return r?r(t):i;var a=e[0],o=a.getModelExtensions();if(!o)return r?r(t):i;var s=n.toQueryExtensionSchema(u.build(t,o.withName(a.schemaName)));return r?r(t,s):{query:t,extensions:s}}}var n=e.explore.util.ModelExtensionUtils,a=e.explore.util.ModelExtensionDependencyVisitor,o=e.data.SQExpr,s=e.data.SQExprRewriter;t.createExplorationQueryExtensionProvider=r;var l=(function(e){function t(t){var r=e.call(this)||this;return r.dependencyVisitor=t,r}return __extends(t,e),t.prototype.visitMeasureRef=function(e){return o.isEntity(e.source)&&this.dependencyVisitor.visitReference({schema:e.source.schema,entity:e.source.entity,name:e.ref}),e},t})(s),u=(function(e){function t(t){return e.call(this,t)||this}return __extends(t,e),t.build=function(e,r){var i=new t(r);return e.rewrite(new l(i)),i.result},t.prototype.visitMeasure=function(e,t,r){this.result=this.result||n.createModelExtension(e.name,e.extends);var i=n.getOrCreateExtendingEntity(this.result,t.name);n.findMeasureFromEntity(i,r.name)||n.addMeasure(i,r)},t})(a)})(r=t.dataReaderPlugins||(t.dataReaderPlugins={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){var r,i=jsCommon.ArrayExtensions,n=e.data.ConceptualSchema;!(function(t){function r(e,t,r){var a=new n;return a.name=e,a.extends=t,a.capabilities={canEdit:r,discourageQueryAggregateUsage:!1,isExtendable:!1,normalizedFiveStateKpiRange:!1,supportsMedian:!1,supportsPercentile:!1,supportsScopedEval:!1,supportsStringMinMax:!1,supportsMultiTableTupleFilters:!1,supportsTimeIntelligenceQuickMeasures:!1,supportsCalculatedColumns:!1,supportsGrouping:!1,limitMultiColumnFiltersToQueryGroupColumns:!1,supportsBinnedLineSample:!1,supportsOverlappingPointsSample:!1,supportsInsights:!1,supportsQna:!1},a.entities=i.createWithName(),a}function a(t,n){var a=r(t.name,t.extends,n);if(!t.entities)return a;for(var o=0,s=t.entities;o<s.length;o++){var l=s[o],u={name:l.name,extends:l.extends,displayName:l.name,properties:i.createWithName(),hierarchies:i.createWithName(),displayFolders:i.createWithName(),capabilities:{canRefresh:!1,canEditSource:!1,canRename:!1,canDelete:!1,canEditStorageMode:!1,supportsClustering:!1,supportsBinByCount:!1,limitOnNumberOfGroups:null},source:{}};if(a.entities.push(u),l.measures)for(var c=0,p=l.measures;c<p.length;c++){var f=p[c],d={name:f.name,displayName:f.name,type:e.ValueType.fromPrimitiveTypeAndCategory(f.dataType,f.dataCategory),kind:1,hidden:f.hidden,errorMessage:f.errorMessage,queryable:f.errorMessage?1:0,format:f.formatInformation&&f.formatInformation.formatString,measure:{},canDelete:a.capabilities.canEdit,description:f.description};f.measureTemplate&&(d.measure.template={name:f.measureTemplate.daxTemplateName}),u.properties.push(d)}}return a}t.createExtensionSchema=r,t.convertModelExtension=a})(r=t.ExplorationConceptualSchemaFactory||(t.ExplorationConceptualSchemaFactory={}))})(r=t.dataReaderPlugins||(t.dataReaderPlugins={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){function r(e,t){return void 0===t&&(t=!1),new n(e,t)}var i=e.data.FederatedConceptualSchema;t.createConceptualSchemaReader=r;var n=(function(){function e(e,t){this.promiseFactory=e,this.canEditSchemas=t}return e.prototype.execute=function(e){var r=e.dataSources;if(!r||r.length>1)return this.promiseFactory.reject(null);var i=r[0],n=i.exploration;if(!n)return this.promiseFactory.reject(null);var a=[],o=n.getModelExtensions();if(_.isEmpty(o))a.push(t.ExplorationConceptualSchemaFactory.createExtensionSchema(i.name,i.extends,this.canEditSchemas));else for(var s=0,l=o;s<l.length;s++){var u=l[s];a.push(t.ExplorationConceptualSchemaFactory.convertModelExtension(u,this.canEditSchemas))}return this.promiseFactory.resolve({data:{extensionSchemas:a}})},e.prototype.transform=function(e){for(var t=e.data,r={schemas:{}},n=0,a=t.extensionSchemas;n<a.length;n++){var o=a[n];r.schemas[o.name]=o}return{schema:new i(r)}},e})()})(r=t.dataReaderPlugins||(t.dataReaderPlugins={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){function t(e,t){var i=r(e,t);return{added:i.added,updated:i.updated,removed:i.removed,page:t,originalPage:e}}function r(e,t){for(var r=[],i=[],n=e.visualContainers.slice(),a=0,o=t.visualContainers;a<o.length;a++){var s=o[a];if(void 0===s.id)r.push(s);else{var l=jsCommon.ArrayExtensions.findWithId(n,s.id);if(l){var u=n.indexOf(l);n.splice(u,1),jsCommon.JsonComparer.equals(l,s)||i.push(s)}else r.push(s)}}return{added:r,updated:i,removed:n}}function i(e,r){for(var i=[],n=[],a=e.slice(),o=0,s=r.length;o<s;o++){var l=r[o];if(void 0===l.id)i.push(l);else{var u=jsCommon.ArrayExtensions.findWithId(a,l.id);if(u){var c=a.indexOf(u);a.splice(c,1);var p=(e.indexOf(u),t(u,l));n.push(p)}else i.push(l)}}return{added:i,updated:n,removed:a}}function n(e,t){for(var r=[],i=[],n=t||[],a=e?e.slice():[],o=0,s=n;o<s.length;o++){var l=s[o];if(void 0===l.id)r.push(l);else{var u=l.id,c=_.findIndex(a,(function(e){return e.id===u}));c>=0?(i.push({updatedPod:l,originalPod:a[c]}),a.splice(c,1)):r.push(l)}}return{added:r,removed:a,updated:i}}function a(e,t){return{pages:i(e.sections,t.sections),pods:n(e.pods,t.pods)}}e.diff=a})(t=e.ExplorationDiffer||(e.ExplorationDiffer={}))})(t=e.proxies||(e.proxies={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(r){function i(e,t,r,i,n,a){return new u(e,t,r,i,n,a)}var n,a=e.explore.util.ResourcePackageUtils;!(function(e){var t;!(function(e){e.Bookmark="Bookmark",e.Back="Back",e.Qna="Qna"})(t=e.VisualLink||(e.VisualLink={}));var r;!(function(e){e.Canvas="Canvas",e.Default="Default"})(r=e.VisualTooltip||(e.VisualTooltip={}))})(n=r.wireContracts||(r.wireContracts={})),r.createExplorationProxy=i,r.saveExplorationSerializationOptions={withData:!0,excludeHighContrastTheme:!0,forSave:!0};var o="_",s="[0-9]+",l=18e5,u=(function(){function i(e,t,r,i,n,a){this.promiseFactory=e,this.httpService=t,this.serializer=r,this.telemetryService=i,this.featureSwitchService=n,this.cache={},this.uriPrefix=a||"explore/"}return i.prototype.get=function(t){var r=this,n=this.telemetryService,a=n.startEvent(e.telemetry.EXGetExploration,!1),o=t.sectionId,s=t.id,l=t.model,u=t.bookmarkGuid;if(t.allowCache){var c=this.getExplorationFromCache(s,o,l,u);if(c)return a.event.info.fromCache=!0,a.resolve(),c}var p=this.promiseFactory.defer(),f=this.uriPrefix+"reports/"+s+"/exploration";_.isNumber(o)&&(f+="/sections/"+o),_.isEmpty(u)||(f+="?bookmarkGuid="+u);var d=i.getCacheKey(s,o,u);this.cache[d.fullKey]={promise:p.promise};var h=this.httpService.powerbiRequestOptions(a.event,"GetExploration");return h.responseType="text",h.transformResponse=[],this.httpService.get(f,h).then((function(e){var t=e.data,i=jsCommon.JsonExtensions.tryParseJSON(t);a.resolve(),r.onSuccess(i,p,t,l,d)}),(function(t){a.reject(e.errorDetailsHelper.getTelemetryErrorDetails(t.error,t.status)),r.onError(__assign({},t,{data:void 0}),s,p,d)})),p.promise},i.prototype.save=function(e,t,n){var a=this,o=this.promiseFactory.defer(),s=i.getCacheKey(n),l=this.serializer.serializeExploration(t,r.saveExplorationSerializationOptions),u=this.serializer.stringifyExplorationConfigs(l),c=this.cloneExplorationShallowForSave(u);if(null==t.id){var p=this.uriPrefix+"explorations/?reportid="+n;this.httpService.put(p,u,this.httpService.powerbiRequestOptions(null,"SaveExploration")).then((function(e){return a.onSuccess(e.data,o,JSON.stringify(e.data),null,s)}),(function(e){return a.onError(e,n,o,s)}))}else{var f=r.ExplorationDiffer.diff(e,u);this.explorationUpdateDiff(f,t.id,t,c,u).then((function(){o.resolve({wireContractJSON:JSON.stringify(u),exploration:t}),a.updateExplorationCache(s,l)}),(function(e){o.reject(e)}))}return o.promise},i.prototype.getModelsAndExploration=function(e,t,r){var i=this,n=this.promiseFactory.defer(),a=this.uriPrefix+"reports/"+e+"/modelsAndExploration?preferReadOnlySession="+t;return r&&(a+="&bookmarkGuid="+r),this.httpService.get(a,this.httpService.powerbiRequestOptions(null,"GetModelsAndExploration")).then((function(e){var t=e.data.models;i.featureSwitchService.registerFeatureSwitches(e.data.featureSwitches),i.serializer.ensureInitialized().then((function(){var r=i.serializer.deserializeExploration(i.serializer.parseExplorationConfigs(e.data.exploration),[],!0,t);n.resolve({exploration:r,models:t,featureSwitches:e.data.featureSwitches})}))}),(function(e){n.reject(e?{error:e.error,requestId:e.requestId,httpStatusCode:e.status}:{})})),n.promise},i.prototype.cloneExplorationShallowForSave=function(e){return{id:e.id,reportId:e.reportId,config:e.config,filters:e.filters,layoutOptimization:e.layoutOptimization,sections:void 0,resourcePackages:_.cloneDeep(e.resourcePackages)}},i.prototype.explorationUpdateDiff=function(e,t,r,i,n){var o=this,s=this.promiseFactory.defer(),l={};l.exploration=i;var u=-1,c=-1,p=-1,f={},d={},h={};l.addedPods=e.pods.added.map((function(e){return e.id=c--,h[e.name]=e.id,e})),l.deletedPods=e.pods.removed.map((function(e){return e.id})),l.updatedPods=e.pods.updated.reduce((function(e,t){return jsCommon.JsonComparer.equals(t.originalPod,t.updatedPod)||e.push(t.updatedPod),e}),[]),l.addedPages=e.pages.added.map((function(e){if(e.id=u--,f[e.name]=e.id,e.visualContainers)for(var t=0,r=e.visualContainers;t<r.length;t++){var i=r[t];i.id=p--;var n=JSON.parse(i.config);d[o.concatenatePageAndVisualContainerNames(e.name,n.name)]=i.id}return e})),l.deletedPages=e.pages.removed.map((function(e){return e.id})),l.updatedPages=e.pages.updated.reduce((function(e,t){for(var r=0,i=t.added;r<i.length;r++){var n=i[r];n.id=p--;var a=JSON.parse(n.config);d[o.concatenatePageAndVisualContainerNames(t.page.name,a.name)]=n.id}var s=o.getUpdatedPageProperty(t);return _.isEmpty(s.addedVisualContainers)&&_.isEmpty(s.updatedVisualContainers)&&_.isEmpty(s.deletedVisualContainers)&&_.isEmpty(s.pageProperty)||e.push(s),e}),[]);var v=this.uriPrefix+"explorations/savereport/"+t;return this.httpService.post(v,l,this.httpService.powerbiRequestOptions()).then((function(e){var t=e&&e.data,i=t&&t.addedPodIds,l=t&&t.addedSectionIds,u=t&&t.addedVisualContainerIds,c=t&&t.exploration&&t.exploration.resourcePackages;if(c&&a.synchronizePackageIds(o.serializer.deserializeResourcePackages(c),a.ensureResourcePackages(r)),r.pods&&i)for(var p=0,v=r.pods.length;p<v;p++){var m=r.pods[p],g=_.find(i,{oldId:h[m.name]});if(g){var y=n.pods[p];m.id=y.id=g.id}}var C=r.sections,x=n.sections;if(C)for(var p=0,v=C.length;p<v;p++){var b=C[p],S=x[p],g=_.find(l,{oldId:f[b.name]});g&&(b.id=S.id=g.id);var E=b.visualContainers,w=S.visualContainers;if(E&&u)for(var F=0,V=E.length;F<V;F++){var P=_.find(u,{oldId:d[o.concatenatePageAndVisualContainerNames(b.name,E[F].name)]});P&&(E[F].id=w[F].id=P.id)}}s.resolve(r)}),(function(e){return s.reject(e?{error:e.error,requestId:e.requestId,httpStatusCode:e.status}:{})})),s.promise},i.prototype.concatenatePageAndVisualContainerNames=function(e,t){return e+"/"+t},i.prototype.saveAs=function(e,t,i,n,a,o){var s=this,l=this.promiseFactory.defer(),u=this.serializer.stringifyExplorationConfigs(this.serializer.serializeExploration(e,r.saveExplorationSerializationOptions));u.reportId=void 0;var c={modelIds:[i],exploration:u,packageId:o?0:n,folderId:a};t=encodeURIComponent(t);var p=this.uriPrefix+"explorations/?name="+t;return o&&(p+="&personalizedreport=true"),this.httpService.put(p,c,this.httpService.powerbiRequestOptions(null,"SaveExplorationAs")).then((function(e){return s.onSuccess(e.data,l,JSON.stringify(e.data),void 0,void 0)}),(function(e){return s.onError(e,i,l)})),l.promise},i.prototype.saveVisualContainerQueries=function(e,t){var r=this.uriPrefix+"explorations/"+e+"/cache";return this.httpService.post(r,t,this.httpService.powerbiRequestOptions(null,"SaveVisualContainerQueries"))},i.prototype.getUpdatedPageProperty=function(e){var t={pageId:e.page.id};t.addedVisualContainers=e.added,t.updatedVisualContainers=e.updated,t.deletedVisualContainers=e.removed.map((function(e){return e.id}));var r=this.shallowCloneSection(e.originalPage),i=this.shallowCloneSection(e.page);return jsCommon.JsonComparer.equals(r,i)||(t.pageProperty=i),t},i.prototype.shallowCloneSection=function(e){return{config:e.config,displayName:e.displayName,displayOption:e.displayOption,filters:e.filters,height:e.height,id:e.id,name:e.name,objectId:e.objectId,ordinal:e.ordinal,transient:e.transient,visualContainers:void 0,width:e.width}},i.prototype.getExplorationFromCache=function(e,t,r,i){var n=this.findMatch(e,t,i);if(n){var a=n.result;if(a.promise)return a.promise;if(a.data){if(null!=t&&!_.some(a.data.sections,(function(e){return e.id===t})))return;var o=this.promiseFactory.defer(),s=[];return o.resolve({wireContractJSON:JSON.stringify(this.serializer.stringifyExplorationConfigs(a.data)),exploration:this.serializer.deserializeExploration(a.data,s,!0,r)}),o.promise}}},i.prototype.findMatch=function(e,t,r){var n=i.getCacheKey(e,t,r),a=this.cache[n.fullKey];if(a||null!=r||(n=i.getCacheKey(e),a=this.cache[n.fullKey]),a)return{key:n,result:a}},i.prototype.updateExplorationCache=function(e,t){var r=this;if(e){if(!t)return void delete this.cache[e.fullKey];var i=this.cache[e.fullKey];if(i?(i.promise&&delete i.promise,i.data=t):this.cache[e.fullKey]={data:t,promise:null},e.part&&!this.cache[e.part.reportKey]){var n=_.clone(t);n.activeWebBookmark&&delete n.activeWebBookmark,this.cache[e.part.reportKey]={data:n,promise:null}}e.allSectionKey&&_.forOwn(this.cache,(function(t,i){i!==e.fullKey&&null!=i.match(new RegExp("^"+e.fullKey))&&delete r.cache[i]})),this.cacheExpirationTimerId&&clearTimeout(this.cacheExpirationTimerId),this.cacheExpirationTimerId=setTimeout((function(){r.clearCache()}),l)}},i.prototype.clearCache=function(){this.cache={}},i.prototype.logDeserializationErrorsTelemetryEvents=function(r,i){if(_.find(i,(function(e){return 0===e.errorType}))){var n=r.config;this.telemetryService.logEvent(e.telemetry.NewerExplorationVersion,n.version.toString(),t.services.upgrade.CurrentExplorationVersion.toString())}},i.prototype.onSuccess=function(t,r,i,n,a){var o=[],s=this.telemetryService.startEvent(e.telemetry.EXDeserializeExploration,void 0,i.length,0),l=this.serializer.parseExplorationConfigs(t);s.event.info.explorationVersion=l.config.version;var u=this.serializer.deserializeExploration(l,o,!0,n,s.event);s.resolve();var c={wireContractJSON:i,exploration:u};r.resolve(c),this.logDeserializationErrorsTelemetryEvents(l,o),this.updateExplorationCache(a,l)},i.prototype.onError=function(e,t,r,i){r.reject(e?{error:e.error,requestId:e.requestId,httpStatusCode:e.status}:{}),this.updateExplorationCache(i,null)},i.getCacheKey=function(e,t,r){var i;if(i=null!=t?""+e+o+t:""+e+o+s,r){var n=_.cloneDeep(i);return i+=""+o+r,{fullKey:i,allSectionKey:null==t,part:{reportKey:n}}}return{fullKey:i,allSectionKey:null==t}},i})()})(r=t.proxies||(t.proxies={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={})),powerbi.define("Explore/proxies/linguisticSchemaProxy",(function(){var e=(powerbi.explore.proxies.wireContracts,jsCommon.StringExtensions),t=0,r=(function(){function r(e,t){this.promiseFactory=e,this.httpService=t,this.schemas={},this.originalSchemas={}}return r.prototype.init=function(e,r){var i=this,n=this.promiseFactory.defer();if(e=e||t,this.schemas[e]={content:{Entities:[]}},this.originalSchemas[e]={content:{Entities:[]}},e&&r){var a="explore/reports/"+e+"/linguisticschema";this.httpService.get(a,this.httpService.powerbiRequestOptions()).then((function(t){i.schemas[e]=t.data,i.originalSchemas[e]=_.cloneDeep(t.data),n.resolve(null)}),(function(t){i.schemas[e]=null;var r=t?{error:t.error,requestId:t.requestId}:{};n.reject(r)}))}return n.promise},r.prototype.save=function(e){var r=this,i=this.promiseFactory.defer(),n=this.schemas[e],a=this.originalSchemas[e];if(n||(n=this.schemas[t],n&&(this.schemas[t]=null,this.schemas[e]=n,a=this.originalSchemas[t],this.originalSchemas[t]=null,this.originalSchemas[e]=a)),!_.isEqual(n,a)){if(n){
var o="explore/reports/"+e+"/linguisticschema";n.content&&!_.isEmpty(n.content.Entities)?(n.id=void 0,this.httpService.post(o,n,this.httpService.powerbiRequestOptions()).then((function(t){r.originalSchemas[e]=_.cloneDeep(t.data),i.resolve(null)}),(function(e){var t=e?{error:e.error,requestId:e.requestId}:{};i.reject(t)}))):a?this.httpService.delete(o,this.httpService.powerbiRequestOptions()).then((function(){delete r.originalSchemas[e],i.resolve(null)}),(function(e){var t=e?{error:e.error,requestId:e.requestId}:{};i.reject(t)})):(this.originalSchemas[e]=n,i.resolve(null))}return i.promise}},r.prototype.get=function(e,r){e=e||t;var i,n=this.schemas[e];return n&&(i=this.getWordsForPodEntity(n,r)),this.promiseFactory.resolve({podName:r,words:i||[]})},r.prototype.set=function(e,r,i){e=e||t;var n=this.schemas[e];n&&this.setWordsForPodEntity(n,r,i)},r.prototype.getSchema=function(e){return _.cloneDeep(this.schemas[e||t])},r.prototype.setSchema=function(e,r){this.schemas[e||t]=r},r.prototype.getWordsForPodEntity=function(e,t){var r=this.findPodEntity(e,t);if(r&&2!==r.Source)return _.map(_.filter(r.Words,(function(e){return null==e.Source||0===e.Source})),(function(e){return e.Value}))},r.prototype.setWordsForPodEntity=function(t,r,i){var n=this.findPodEntity(t,r);if(_.isEmpty(i)){if(n){var a=t.content.Entities.indexOf(n);t.content.Entities.splice(a,1)}}else{n?2===n.Source&&(n.Source=1):(n={Name:null,ConceptualEntity:r,Source:1},t.content.Entities.push(n));var o=i[0],s=e.deriveClsCompliantName(o,"pod");n.Name=this.makeUniquePodEntityName(s,t.content.Entities,n),n.Words=_.map(i,(function(e){return{Value:e,Source:0}}))}},r.prototype.findPodEntity=function(e,t){if(e.content&&e.content.Entities)return _.find(e.content.Entities,(function(e){return e.ConceptualEntity===t}))},r.prototype.makeUniquePodEntityName=function(t,r,i){for(var n={},a=0,o=r;a<o.length;a++){var s=o[a];s!==i&&(n[s.Name]=!0)}return e.findUniqueName(n,t)},r})();return{create:function(e,t){return new r(e,t)}}}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){function r(t,r,o,s,l,u){var c=t&&t.clientError;if(!c||!c.ignorable){var p,f=t&&t.serviceError,d="PowerBI",h=null;if(f&&(h=f.message&&f.message.replace(/\s/g," "),c=new e.ServiceErrorToClientError(f)),i(f)){var v=u&&u.datasetHost;if(v===n.Dedicated||v===n.ASAzure){var m=void 0,g=void 0;switch(v){case n.Dedicated:m=l.get("ServiceError_CapacityPausedTitle"),g=l.format("ServiceError_CapacityPausedMessage");break;case n.ASAzure:m=l.get("ServiceError_ASAzure_DatasourceNotFoundTitle"),g=l.get("ServiceError_ASAzure_DatasourceNotFoundMessage");break;default:m=l.get("ServiceError_ModelFetchingFailureKey"),g=l.get("ServiceError_ModelFetchingFailureValue")}return void r.error(g,s,{title:m,requestId:t&&t.requestId,displayableErrorInfo:[{errorInfoKey:l.get("ServiceError_CapacityPausedKey"),errorInfoValue:u.capacityObjectId}],source:c.source})}}if(c)p=a.GetErrorDetailsFromClientError(c),d=c.source;else{var y=$.Deferred();y.resolve(null),p=y.promise()}p.then((function(e){var i=e&&e.displayableErrorInfo||[],n=i.shift(),a=n&&n.errorInfoValue||e&&e.message,l={requestId:t&&t.requestId,displayableErrorInfo:i,errorDetails:h,source:e?e.source:null},u=n&&n.errorInfoKey;u&&(l.title=u),r.error(a||o,s,l)}))}}function i(t){return!!t&&1===t.statusCode&&t.errorCode===e.PBI_DatasourceNotFound}var n=e.common.contracts.DatasetHost,a=e.helpers.PowerBIServiceExceptionErrorHelper;t.handleConceptualSchemaError=r})(r=t.util||(t.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){function t(e){var t=e.drilldown;return null!=t?t.roles:[]}function r(e,t,r){return{expr:e.defn.select().withName(t).expr,roleName:r}}function i(e,t,r){if(t)switch(r){case 1:return o(e,t);case 0:var i=t;if(i.expr){for(var s=jsCommon.ArrayExtensions.ensureArray(i.expr),l=[],u=0,c=s;u<c.length;u++){var p=c[u];l.push(a(e,p))}return l}return n(e,t)}}function n(e,t){for(var i=[],n=t.count||1,a=t.role,o=e.projections[a].all(),s=t.index+n-1,l=n-1;l>=0;l--,s--)i.push(r(e,o[s].queryRef,a));return i}function a(e,t){var r=e.defn.selectNameOf(t);return{expr:t,roleName:s(e.projections,r)}}function o(e,t){var i=[],n=e.projections,a=t.sourceCount,o=t.sourceIndex,s=t.sourceRole,l=t.targetRole;if(n[l]){var u=n[l].all(),c=t.targetIndex;c>=o&&s===l&&(c+=a);for(var p=c,f=u.length;p<f;p++)i.push(r(e,u[p].queryRef,l))}if(n[s])for(var d=n[s].all(),p=a-1;p>=0;p--)i.push(r(e,d[o+p].queryRef,s));return i}function s(e,t){for(var r in e){var i=e[r].all();if(_.findIndex(i,(function(e){return e.queryRef===t}))>=0)return r}}e.getDrillableRoles=t,e.getDrillFilterRemovalInfoList=i})(t=e.DrillUtils||(e.DrillUtils={}))})(t=e.util||(e.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(t){function r(e,t,r){t.visitExploration(e),p(e.filters,t);var n=e.bookmarks;if(!_.isEmpty(n))for(var o=0,s=n;o<s.length;o++){var l=s[o];i(l,e.sections,r,t)}var u=e.sections;if(!_.isEmpty(u))for(var c=0,f=u;c<f.length;c++){var d=f[c];a(d,t,r)}}function i(e,t,r,a){if(a.visitBookmark(e),v.isBookmarkGroup(e))for(var o=0,s=e.children;o<s.length;o++){var l=s[o];i(l,t,r,a)}else n(e.explorationState,t,r,a.explorationStateVisitor)}function n(e,t,r,i){e&&(f(e.filters,i),_.forOwn(e.sections,(function(e,n){o(e,_.find(t,(function(e){return e.name===n})),r,i)})))}function a(e,t,r){t.visitSection(e),p(e.filters,t),h(e.linkFields,t);var i=e.visualContainers;if(!_.isEmpty(i))for(var n=0,a=i.length;n<a;n++)s(i[n],t.visualContainerVisitor,r)}function o(e,t,r,i){if(e&&t){i.visitSectionState(e),f(e.filters,i);var n=i.visualContainerStateVisitor,a=t.visualContainers;_.forOwn(e.visualContainers,(function(e,t){l(e,_.find(a,(function(e){return e.name===t})),r,n)}))}}function s(e,r,i){var n;if(r.visitVisualContainer(e),e.config&&(n=e.config.singleVisual)){r.visitSingleVisualConfig(n);var a=n.query;a&&r.visitQuery(a);var o=n.objects;if(o){var s=void 0,l=t.VisualContainerUtils.getVisualCapabilities(e,i);l&&(s=l.objects),s&&r.visitDataViewObjects(o,s),d(o,r)}var u=n.vcObjects&&n.vcObjects.visualLink;u&&r.visitVisualLinks(u)}p(e.filters,r)}function l(e,t,r,i){e&&t&&(i.visitVisualContainerState(e),f(e.filters,i),u(e.highlight,i),c(e&&e.singleVisual,t,r,i))}function u(e,t){if(e){if(!_.isEmpty(e.selection))for(var r=0,i=e.selection;r<i.length;r++){var n=i[r];t.visitSelectorsByColumn(n)}e.filterExpressionMetadata&&t.visitFilterExpressionMetadata(e.filterExpressionMetadata)}}function c(e,r,i,n){if(e){n.visitSingleVisualState(e);var a=e.orderBy;a&&n.visitOrderByStates(a);var o=e.objects;if(o){var s=t.VisualContainerUtils.getVisualCapabilities(r,i);if(s){var l=s.objects;l&&n.visitDataViewObjectDefinitionUpdates(o,l)}var u=o.merge;u&&d(u,n);var c=o.remove;if(!_.isEmpty(c))for(var p=0,f=c;p<f.length;p++){var h=f[p],v=h.selector;v&&n.visitSelector(v)}}var m=e.activeProjections;m&&n.visitActiveProjectionStates(m)}}function p(e,t){if(!_.isEmpty(e))for(var r=0,i=e;r<i.length;r++){var n=i[r];t.visitFilterContainer(n)}}function f(e,t){if(e){var r=e.nameIdentifiedMerges;_.forOwn(r,(function(e){t.visitFilterContainer(e)}));var i=e.exprIdentifiedMerges;if(!_.isEmpty(i))for(var n=0,a=i;n<a.length;n++){var o=a[n];t.visitFilterContainer(o)}}}function d(e,t){_.forOwn(e,(function(e){if(!_.isEmpty(e))for(var r=0,i=e;r<i.length;r++){var n=i[r],a=n.selector;a&&t.visitSelector(a)}}))}function h(e,t){if(!_.isEmpty(e))for(var r=0,i=e;r<i.length;r++){var n=i[r];t.visitLinkField(n)}}var v=e.contracts.Bookmark;t.traverseExploration=r,t.traverseVisualContainer=s})(t=e.util||(e.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(){}return e.prototype.visitVisualContainer=function(e){},e.prototype.visitSingleVisualConfig=function(e){},e.prototype.visitQuery=function(e){},e.prototype.visitDataViewObjects=function(e,t){},e.prototype.visitSelector=function(e){},e.prototype.visitFilterContainer=function(e){},e.prototype.visitVisualLinks=function(e){},e})();e.DefaultVisualContainerVisitor=t;var r=(function(t){function r(e){var r=t.call(this)||this;return r.rewriters=e,r}return __extends(r,t),r.prototype.visitSingleVisualConfig=function(t){t.cachedFilterDisplayItems&&e.rewriteDisplayNameIdentityPairs(t.cachedFilterDisplayItems,this.rewriters)},r.prototype.visitQuery=function(e){if(e.defn)for(var t=this.rewriters,r=0,i=t;r<i.length;r++){var n=i[r];e=n.rewriteQuery(e)}},r.prototype.visitDataViewObjects=function(t,r){e.rewriteFilterOutput(t,r,this.rewriters),e.rewriteDataBoundPropertyDefinitions(t,r,this.rewriters)},r.prototype.visitFilterContainer=function(t){e.rewriteFilterContainer(t,this.rewriters)},r.prototype.visitVisualLinks=function(t){for(var r=0,i=t;r<i.length;r++){var n=i[r];e.rewriteVisualLink(n,this.rewriters)}},r.prototype.visitSelector=function(t){var r=e.rewriteDataRepetitionSelectors(t.data,this.rewriters);r!==t.data&&(t.data=r)},r})(t);e.VisualContainerRewriter=r})(t=e.util||(e.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=jsCommon.DictionaryExtensions,r=(function(){function e(){}return e.prototype.visitActiveProjectionStates=function(e){},e.prototype.visitDataViewObjectDefinitionUpdates=function(e,t){},e.prototype.visitFilterContainer=function(e){},e.prototype.visitOrderByStates=function(e){},e.prototype.visitSelector=function(e){},e.prototype.visitSelectorsByColumn=function(e){},e.prototype.visitSingleVisualState=function(e){},e.prototype.visitVisualContainerState=function(e){},e.prototype.visitFilterExpressionMetadata=function(e){},e})();e.DefaultVisualContainerStateVisitor=r;var i=(function(r){function i(e){var t=r.call(this)||this;return t.rewriters=e,t}return __extends(i,r),i.prototype.visitActiveProjectionStates=function(t){var r=this;_.forOwn(t,(function(i,n){var a=i.map((function(t){return e.rewriteExpr(t,r.rewriters)}));t[n]=a}))},i.prototype.visitFilterContainer=function(t){e.rewriteFilterContainerState(t,this.rewriters)},i.prototype.visitDataViewObjectDefinitionUpdates=function(t,r){var i=t.merge;i&&(e.rewriteFilterOutput(i,r,this.rewriters),e.rewriteDataBoundPropertyDefinitions(i,r,this.rewriters))},i.prototype.visitOrderByStates=function(t){for(var r=0,i=t;r<i.length;r++){var n=i[r];n.expr=e.rewriteExpr(n.expr,this.rewriters)}},i.prototype.visitSelector=function(t){var r=e.rewriteDataRepetitionSelectors(t.data,this.rewriters);r!==t.data&&(t.data=r)},i.prototype.visitSelectorsByColumn=function(r){var i=this,n=t.rewriteDictionary(r.dataMap,(function(t,r){return e.rewriteDataRepetitionSelectors(r,i.rewriters)}));n!==r.dataMap&&(r.dataMap=n)},i.prototype.visitFilterExpressionMetadata=function(t){e.rewriteFilterExpressionMetadata(t,this.rewriters)},i})(r);e.VisualContainerStateRewriter=i})(t=e.util||(e.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(e,t){this.explorationStateVisitor=e,this.visualContainerVisitor=t}return e.prototype.visitBookmark=function(e){},e.prototype.visitFilterContainer=function(e){},e.prototype.visitExploration=function(e){},e.prototype.visitSection=function(e){},e.prototype.visitLinkField=function(e){},e})();e.DefaultExplorationVisitor=t})(t=e.util||(e.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(e){this.visualContainerStateVisitor=e}return e.prototype.visitFilterContainer=function(e){},e.prototype.visitSectionState=function(e){},e})();e.DefaultExplorationStateVisitor=t;var r=(function(t){function r(e,r){var i=t.call(this,r)||this;return i.rewriters=e,i}return __extends(r,t),r.prototype.visitFilterContainer=function(t){e.rewriteFilterContainerState(t,this.rewriters)},r})(t);e.ExplorationStateRewriter=r})(t=e.util||(e.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(r){function i(e,t){var r=e.getMetadata(t);if(r){var i=r.format;return Z.create({format:i,allowFormatBeautification:!0})}}function n(e,r,i,n){var a=e.getMetadata(r);if(a){if(5===i)return t.contracts.FilterType.Categorical;var o=a.type,s=o&&(o.text||o.bool||o.dateTime),l=a.idOnEntityKey&&n&&X.equals(e,n);return!s||$.isMeasure(e)||l?t.contracts.FilterType.Advanced:t.contracts.FilterType.Categorical}}function a(e,r){return $.isMeasure(e)||!r?t.contracts.FilterType.Advanced:t.contracts.FilterType.Categorical}function o(e,t,r,i,n,a,o){if(!e||!t)return!1;var l=J.asFieldPattern(e,t),u=H.toFieldExprEntityItemPattern(l),c=t.schema(u.schema);if(!c)return!1;var p,f,d=c.findProperty(u.entity,H.getPropertyName(l));if(d||(l.hierarchyLevel?(p=c.findHierarchy(u.entity,l.hierarchyLevel.name),p&&(f=p.levels.withName(l.hierarchyLevel.level))):l.columnHierarchyLevelVariation&&(p=c.findHierarchy(l.columnHierarchyLevelVariation.level.entity,l.columnHierarchyLevelVariation.level.name),p&&(f=p.levels.withName(l.columnHierarchyLevelVariation.level.level)))),!d&&!f||!r||!r.container)return!1;if(d&&1===d.kind&&(0!==r.scopeType||c.capabilities.limitMultiColumnFiltersToQueryGroupColumns)&&(!o.featureSwitches.measureDrillthrough||!i))return!1;if(i){var h=void 0,v=d&&d.kind;if(h=o.featureSwitches.measureDrillthrough?!!f||0===v||1===v:!!f||0===v,!h)return!1;var m=!1;if(1===r.scopeType){var g=r.container;g&&!g.transient&&(m=!0)}if(!m)return!1}if(0===r.scopeType){var y=r.container;if(!y||!s(y,n,a))return!1}return!0}function s(e,r,i){var n=t.util.VisualContainerUtils.getVisualType(e);return!i.supportsFilterOutput(e)&&r.isQueryVisual(n)}function l(e){return null!=r.tryGetFilterPropertyIdentifier(e,null,null)}function u(e,t,r){return t&&r&&r.isCustomVisual(t)?q:e?U.findFilterOutput(e.objects):void 0}function c(e,t,r,i){var n=u(e,t,r);if(n)return L.getValue(i,n,void 0)}function p(e,t){e.filters||(e.filters=[]),e.filters.push(t)}function f(e,r,i){if(e){var n={filter:e.filter,name:g(r),type:e.type,restatement:e.restatement,howCreated:i};if(e.type===t.contracts.FilterType.Categorical||e.filterExpressionMetadata&&1===e.filterExpressionMetadata.expressions.length){n.expression=e.filterExpressionMetadata.expressions[0];var a=[];if(!_.isEmpty(e.filterExpressionMetadata.cachedValueItems)){for(var o=0,s=e.filterExpressionMetadata.cachedValueItems;o<s.length;o++){var l=s[o];1===l.identities.length&&a.push({identity:l.identities[0],displayName:l.valueMap[0]})}n.cachedValueItems=a}}else e.filterExpressionMetadata&&(n.filterExpressionMetadata=e.filterExpressionMetadata);return n}}function d(i,n,a,o,s){if(!a)return!1;var l=i.expression;if(!l)return!1;var u=e.data.SQExprUtils.isMeasure(l),c=!_.isEmpty(r.validate(i,n,o)),p=t.util.VisualContainerUtils.hasGrouping(a,n);if(u&&!p&&!c)return!0;var f=l.getTargetEntity().schema,d=n.schema(f);return!(!u||!d.capabilities.limitMultiColumnFiltersToQueryGroupColumns)||(!!t.util.VisualContainerUtils.hasFilterMappingWithNonAggregatableColumns(a,n,s)||!(!t.util.VisualContainerUtils.hasGroupByItemsInQuery(a)||!u))}function h(e,t){var r=e.getMetadata(t);if(r)return r.type}function v(t,r){var i=e.data.SQExprUtils.getDefaultValues(t,r);if(!_.isEmpty(i)){return{isNot:!1,scopeIds:[e.data.createDataViewScopeIdentity(e.data.SQExprUtils.getDataViewScopeIdentityComparisonExpr(t,i))]}}}function m(e,r,i){var n=e.expression,a=e.filter,o=t.util.ModelAuthoringUtility.validate(n,r,i);if(a&&(o=a.validate(r,i,o)),!_.isEmpty(o))return o}function g(e){if(_.isEmpty(e))return ee;for(var t={},r=0,i=e;r<i.length;r++){t[i[r].name]=!0}return Y.findUniqueName(t,ee)}function y(e){return e===t.contracts.FilterType.Categorical||e===t.contracts.FilterType.Visual}function C(e,t,r){var i=e.filters,n=[];if(i)for(var a=0,o=i;a<o.length;a++){var s=o[a],l=s&&s.filter;if(l&&_.isEmpty(l.validate(t,r))&&2===s.howCreated&&x(l.where())){var u=b(e,s.expression);u&&n.push(u)}}return n}function x(e){return!_.isEmpty(e)&&_.every(e,(function(e){if(null==e)return!1;var t=e.condition;return X.isIn(t)?t.values&&1===t.values.length:!!X.isCompareRef(t)&&0===t.comparison}))}function b(e,r){var i=t.util.VisualContainerUtils.getVisualQuery(e);if(i)return i.defn.selectNameOf(r)}function S(e,t){if(t){var r=t.condition,i=new re(e);return r.accept(i),i.values}}function E(t,i,n){var a=[],o=n&&n.Filters&&0!==n.Filters.length?n.Filters:null;o&&o.length!==i.length&&(o=null);for(var s=0,l=i.length;s<l;s++){var u=i[s],c=o&&o[s],p=c&&c.expression&&K.deserializeExpr(c.expression);a.push({name:r.getNextFilterName(a),filter:new e.data.SemanticFilter(t,[u]),restatement:c&&c.Restatement,expression:p,howCreated:0,type:c&&c.type})}return a}function w(e,t){var i=_.filter(e.From,(function(e){return 1!==e.Type})),n={Version:e.Version,From:i,Where:e.Where},a={RemovedIndexes:[]},o=K.deserializeFilter(n,a);if(t&&!_.isEmpty(a.RemovedIndexes)&&(t.Filters=_.filter(t.Filters,(function(e,t){return!_.includes(a.RemovedIndexes,t)}))),o)return r.deriveFromSQFilters(o.from(),o.where(),t)}function F(e,t){_.isEmpty(e.filters)||(t.filters=M(t.filters,e.filters,"explore"),e.filters=[])}function V(e,t,r,i,n){var a=n;if(e.filters=N(t,e.filters,r,i),_.isEmpty(i)&&_.isEmpty(r)||(a=!0),a)for(var o=0,s=e.visualContainers;o<s.length;o++){var l=s[o];l.cachedData=null}}function P(e){if(e){var t=e.dataFilters?e.dataFilters.slice():[];e.highlightFiltersUnmerged&&(t=t.concat(e.highlightFiltersUnmerged));for(var r=[],i=[],n=0,a=t;n<a.length;n++){var o=a[n],s=o.filter.where();if(!_.isEmpty(s)){var l=_.filter(s,(function(e){return 1===Q.run(e.condition)}));if(i.push.apply(i,l),!_.isEmpty(l)){var u=_.filter(s,(function(e){return 1!==Q.run(e.condition)}));if(_.isEmpty(u))continue;o={filter:W.fromSQFromAndSQFilters(o.filter.from(),u)}}r.push(o)}}if(!_.isEmpty(i)){var c=W.fromMeasureFilters(e.query,i);c&&r.push({filter:c})}return r}}function D(e,t,r){if(r&&!_.isEmpty(r.cachedValueItems)){var i=this.findIdentityMapInFilterCache(e,t,r);if(i){var n=[],a=[];for(var o in i.valueMap)n.push(i.valueMap[o]),a.push(r.expressions[o]);return{values:n,columns:a}}}}function R(e,t,r){if(r&&!_.isEmpty(r.cachedValueItems)){var i=this.findIdentityMapInFilterCache(e,t,r);i&&_.remove(r.cachedValueItems,(function(e){return e===i}))}}function T(e,t,r){if(r&&!_.isEmpty(r.cachedValueItems))for(var i=0,n=r.cachedValueItems;i<n.length;i++){for(var a=n[i],o=new G,s=0,l=a.identities;s<l.length;s++){var u=l[s];u.expr.accept(o)}if(o.keys.length===e.length){for(var c=!0,p=function(r){var i=o.keys[r];if(_.findIndex(e,(function(e){return X.equals(e,i)}))<0||t[r].value!==o.values[r].value)return c=!1,"break"},f=0;f<o.keys.length;f++){var d=p(f);if("break"===d)break}if(c)return a}}}function N(e,t,r,i){var n=(t||[]).slice();if(_.isEmpty(i)||e&&!_.isEmpty(e.parameters)&&_.remove(n,(function(t){return _.some(e.parameters,(function(e){return e.boundFilter===t.name}))})),!_.isEmpty(i)||!_.isEmpty(r)){return I(I(i,r),n)}return n}function I(e,t){return _.isEmpty(e)?t:_.isEmpty(t)?e:M(j(e,t)||[],e||[],"param")}function j(e,t){if(_.isEmpty(e)||_.isEmpty(t))return t;var r=B(e);return _.filter(t,(function(e){var t=z(e);return!_.some(t,(function(e){return _.some(r,(function(t){return X.equals(t,e,!1,!0)}))}))}))}function O(e,t){e=e||[],t=t||[];for(var r={},i=[],n=0,a=t;n<a.length;n++){var o=a[n];r[o.name]=o}for(var s=0,l=e;s<l.length;s++){var o=l[s],u=r[o.name];u&&_.isEqual(u,o)||i.push(o)}return i}function M(e,t,r){var i={};e=e||[];for(var n=0,a=e;n<a.length;n++){var o=a[n];i[o.name]=!0}for(var s=0,l=t;s<l.length;s++){var o=l[s];o.name=r+"_"+o.name,i[o.name]||(i[o.name]=!0)}return e.concat(t)}function k(e,t,r,i){return 6!==e&&(!(5===e&&!t&&X.isMeasure(r))&&!!i)}function A(e){return _.some(e.filters,(function(e){return 5===e.howCreated&&!e.isTransient&&(e.isLinkedAsAggregation||e.expression&&X.isMeasure(e.expression))}))}function B(e){return _.flatten(_.map(e,(function(e){return z(e)})))}function z(e){var t=[];if(e.expression&&t.push(e.expression),e.filter)for(var r=0,i=e.filter.conditions();r<i.length;r++){var n=i[r],a=new te;n.accept(a),t=t.concat(a.fields)}return t}var q=e.visualHost.CustomVisualsFilterPropertyIdentifier,L=e.data.DataViewObjectDefinitions,U=e.data.DataViewObjectDescriptors,H=e.data.FieldExprPattern,Q=e.data.FilterKindDetector,G=e.data.ScopeIdentityExtractor.ScopeIdKeysAndValuesExtractorImpl,W=e.data.SemanticFilter,K=e.data.services.SemanticQuerySerializer,X=e.data.SQExpr,J=e.data.SQExprConverter,$=e.data.SQExprUtils,Y=jsCommon.StringExtensions,Z=e.visuals.valueFormatter,ee="Filter";r.getFormatter=i,r.getDefaultFilterType=n,r.getFilterType=a,r.canAdd=o,r.supportsVisualFilters=s,r.supportsFilterOutput=l,r.tryGetFilterPropertyIdentifier=u,r.tryGetFilterProperty=c,r.add=p,r.convertFilterData=f,r.shouldDisableFilter=d,r.getValueType=h,r.getDefaultRetainedValue=v,r.validate=m,r.getNextFilterName=g,r.isCategoricalFilter=y,r.getQueryRefsForSingleItemDrillFilters=C,r.getFilterValuesForColumn=S,r.deriveFromSQFilters=E,r.extractParameterFilters=w,r.mergeExplorationSectionFilters=F,r.applySectionParameterFilters=V,r.getFiltersToApplyFromVisualQueryFilterContext=P,r.findValuesInFilterCache=D,r.removeEntryFromFilterCache=R,r.findIdentityMapInFilterCache=T,r.getNonoverriddenFilters=j,r.extractParameterFiltersFromSection=O,r.mergeFilters=M,r.canExpandManually=k,r.hasMeasureOrAsAggregationLinkField=A;var te=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.fields=[],t}return __extends(t,e),t.prototype.visitColumnRef=function(e){this.fields.push(e)},t.prototype.visitHierarchyLevel=function(e){this.fields.push(e)},t.prototype.visitMeasureRef=function(e){this.fields.push(e)},t.prototype.visitEntity=function(e){this.fields.push(e)},t.prototype.visitAggr=function(){},t})(e.data.DefaultSQExprVisitorWithTraversal),re=(function(e){function t(t){var r=e.call(this)||this;return r.comparisonColumn=t,r.values=[],r}return __extends(t,e),t.prototype.visitCompare=function(e){0===e.comparison&&X.isConstant(e.right)&&X.equals(e.left,this.comparisonColumn)&&this.values.push(e.right)},t.prototype.visitIn=function(e){var t=this;if(!_.isEmpty(e.values)){var r=e.args,i=_.findIndex(r,(function(e){return X.equals(e,t.comparisonColumn)}));if(!(i<0))for(var n=0,a=e.values;n<a.length;n++){var o=a[n];this.values.push(o[i])}}},t})(e.data.DefaultSQExprVisitor)})(r=t.FilterUtils||(t.FilterUtils={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){var r,i=e.data.SQExpr,n=e.data.SQExprBuilder,a=e.data.SQExprConverter,o=e.data.SQExprGroupUtils,s=e.data.SQHierarchyExprUtils;!(function(t){function r(e,t,r,n){if(r&&t&&i.isHierarchyLevel(n)){for(var a=n,l=a.arg,u=s.expandExpr(e,l),c=[],p=function(t){var n=r.tryGetExprs(t.name);if(!n)return"continue";var p=void 0;if(i.isHierarchy(l)&&i.isPropertyVariationSource(l.arg)){var f=l.arg;p=_(o.groupExprs(e,n)).filter((function(e){return e.isHierarchyLevelsGroup&&i.isColumn(e.expr)&&i.equals(e.expr.source,f.arg)&&e.expr.ref===f.property})).reverse().value()}else p=_(o.groupExprs(e,n)).filter((function(e){return i.equals(e.expr,l)})).reverse().value();for(var d=0,h=p;d<h.length;d++){var v=h[d],m=s.getInsertionIndex(u,v.children,a);c.push({expr:a,schema:e,targetRole:t.name,targetIndex:v.selectQueryIndex+m})}},f=0,d=t.dataRoles;f<d.length;f++){p(d[f])}return c}}function l(t,r){if(t&&t.kind===e.VisualDataRoleKind.Measure){var i=s.getHierarchySourceAsVariationSource(r);if(i)return n.columnRef(i.arg,i.property)}}function u(e,t,r,n,a,o){var s=e.singleVisual.query.tryGetExprs(t)||[],u=s.slice(r,r+n);if(!_.isEmpty(u)){var c;if(c=_.isEmpty(o)?u[0]:o[0],i.isHierarchyLevel(c)){var p=l(a,c);if(p)return[p]}return _.isEmpty(o)?u:o}}function c(e,t){return i.isHierarchyLevel(e)&&i.isHierarchyLevel(t)&&i.equals(e.arg,t.arg)}function p(e,t){var r=a.asFieldPattern(t),i=r.hierarchyLevel;if(i){var n=e.findHierarchy(i.entity,i.name);return n?_.findIndex(n.levels,(function(e){return e.name===i.level})):void 0}}function f(e){_.isEmpty(e)||e.sort(d)}function d(e,t){return e.displayName.localeCompare(t.displayName,void 0,{sensitivity:"base"})}t.getOptionsToAddHierarchyLevelToExistingHierarchies=r,t.getHierarchyReplacementExpressions=u,t.hierarchyLevelComparer=c,t.findHierarchyLevelIndex=p,t.sortHierarchies=f})(r=t.HierarchyUtils||(t.HierarchyUtils={}))})(r=t.util||(t.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){var r,i=e.data.DataViewMatrixUtils,n=e.visuals.matrixRoleNames,a=e.data.SQExprUtils;!(function(e){function t(e,t,i,a,l,u){if(e.matrix){for(var c=[],f=[],d=[],h=[],v=e.matrix,m=0,g=t;m<g.length;m++){var y=g[m],C=__assign({},y);C.roles={},c.push(C)}var x=function(e){if(u&&u.featureSwitches.showGeneratedColumnsInDetailView)return!0;var r=t[e.index];return!r||!_.isEmpty(r.roles)};if(r(v.rows,c,f,n.rows)&&r(v.columns,c,d,n.columns,(function(e){return!e.isMeasure}))&&o(v.valueSources,c,i,h,n.values,x)){var b=e;s(a,l,f,d,h),i&&i.length>1&&(b=p(e,i,t));var S={};f.length>0&&(S[n.rows]=f),d.length>0&&(S[n.columns]=d),h.length>0&&(S[n.values]=h);return{transformActions:{selects:c,roles:{ordering:S}},dataView:b}}}}function r(e,t,r,i,n){if(!e||_.isEmpty(e.levels))return!0;for(var a=0,s=e.levels;a<s.length;a++){if(!o(s[a].sources,t,[],r,i,n))return!1}return!0}function o(e,t,r,i,n,a){if(_.isEmpty(e))return!0;for(var o=f(r,t),s=function(r){if(!a||a(r)){if(null==r.index&&_.some(e,(function(e){return e.formatSource&&e.formatSource.formatString===r})))return"continue";if(o[r.index]||i.push(r.index),!t[r.index])return{value:!1};t[r.index].roles[n]=!0}},l=0,u=e;l<u.length;l++){var c=u[l],p=s(c);if("object"==typeof p)return p.value}return!0}function s(e,t,r,i,n){if(!_.isEmpty(e)&&t){var a=r.length>=2,o=i.length>=2,s=n.length>=2;if(a||o||s){var c=l(e,t);c&&(a&&u(r,c),o&&u(i,c),s&&u(n,c))}}}function l(e,t){var r=_.chain(e).map((function(e){return t[e]})).flatten().filter((function(e){return _.isNumber(e)})).value(),i=_.reduce(r,(function(e,t,r){return void 0===e[t]&&(e[t]=r),e}),{});return Object.keys(i).length>=2?i:void 0}function u(e,t){e.sort((function(e,r){return c(e,t)-c(r,t)}))}function c(e,t,r){return void 0===r&&(r=Number.MAX_VALUE),_.isNumber(t[e])?t[e]:r}function p(e,t,r){var i=(e.matrix,f(t,r)),n=e;return _.isEmpty(Object.keys(i))||_.isEmpty(e.matrix.columns.root.children)||_.isEmpty(e.matrix.rows.root.children)||(n=_.cloneDeep(e),v(n.matrix,i),d(n,i)),n}function f(e,t){var r={};if(e&&e.length>1){var i=!1;for(var n in e[0].selects){var o=t[n];if(o.expr&&a.isMeasure(o.expr)){i=!0;break}}if(i)for(var n in e[1].selects){var o=t[n];o.expr&&a.isMeasure(o.expr)&&(r[n]=!0)}}return r}function d(e,t){var r=e.matrix,n=0,a=r.columns.root;_.isEmpty(r.columns.root.children)?n=_.filter(r.valueSources,(function(e){return!t[e.index]})).length:i.forEachLeafNode(a,(function(){return n++}));for(var o=r.columns.levels[0],s=0,l=r.valueSources;s<l.length;s++){var u=l[s];if(t[u.index]){o.sources.push(u);var c={level:0,levelSourceIndex:o.sources.length-1};a.children.push(c)}}var p=h(e,t),f=0;i.forEachLeafNode(e.matrix.rows.root,(function(e){var t=n;for(var r in p){var i=p[r];e.values[t]={value:i[f],valueSourceIndex:parseInt(r,10)},t++}f++}))}function h(e,t){for(var r={},i=function(i){if(i.source&&t[i.source.index]){r[_.findIndex(e.matrix.valueSources,(function(e){return e.index===i.source.index}))]=i.values}},n=0,a=e.categorical.values;n<a.length;n++){i(a[n])}return r}function v(e,t){for(var r={},i=[],n=0;n<e.valueSources.length;n++){var a=e.valueSources[n];if(t[a.index]&&(r[n]=!0,i.push(a),a&&a.formatSource&&a.formatSource.formatString)){var o=a.formatSource.formatString;r[e.valueSources.indexOf(o)]=!0,i.push(o),delete a.formatSource}}m(e.columns,r),e.valueSources=g(e.rows,r,e.valueSources);var s=_.last(e.columns.levels);s.sources=s.sources.filter((function(e){return!_.find(i,(function(t){return t===e}))}))}function m(e,t){for(var r=i.getLeafNodesPath(e.root),n=0,a=r;n<a.length;n++){var o=a[n],s=o.length-2,l=o[s];l.children=_.filter(l.children,(function(e){return!t[e.levelSourceIndex||0]})),l.children&&null!=l.level&&1===l.children.length&&delete l.children}}function g(e,t,r){if(!_.isEmpty(e.root.children)){var n=r.filter((function(e,r){return e&&!t[r]})),a=n.length;return n.push.apply(n,r.filter((function(e,r){return e&&null!=e.index&&t[r]}))),i.forEachLeafNode(e.root,(function(e){var r={},i=0;for(var n in e.values){var o=e.values[n];if(!t[o.valueSourceIndex||0]){var s=i%a;0===s?delete o.valueSourceIndex:o.valueSourceIndex=s,r[i]=o,i++}}e.values=r})),n}}e.generate=t,e.fixMeasuresGroupedByRowHierarchy=p})(r=t.MatrixVisualDataViewConverter||(t.MatrixVisualDataViewConverter={}))})(r=t.util||(t.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){var r,i=e.data.FieldExprPattern,n=e.data.SQExpr,a=e.data.SQExprBuilder,o=e.data.SQExprConverter;!(function(e){function t(e,t,r){if(e){var n=o.asFieldPattern(e),a=i.toFieldExprEntityItemPattern(n),s=""===a.entity?null:a.entity;d({itemShowHide:{schema:a.schema,entity:s,property:v(n),objectType:h(n),makeHidden:t}},r)}}function r(e,t,r){if(e){var i=o.asFieldPattern(e),n=i.hierarchyLevel;if(n){d({hierarchyLevelMove:{schema:n.schema,entity:n.entity,hierarchy:n.name,level:n.level,index:t}},r)}}}function s(e,t){var r=i.toFieldExprEntityItemPattern(e);d({entityRefresh:{schema:r.schema,entity:r.entity}},t)}function l(e,t,r){if(e){var n,a=o.asFieldPattern(e),s=i.toFieldExprEntityItemPattern(a);if(a.hierarchyLevel){var l=a.hierarchyLevel;n={hierarchyLevelRename:{schema:l.schema,entity:l.entity,hierarchy:l.name,before:l.level,after:t}}}else i.hasFieldExprName(a)?n={propertyRename:{schema:s.schema,entity:s.entity,objectType:h(a),before:v(a),after:t}}:a.hierarchy?n={propertyRename:{schema:s.schema,entity:s.entity,objectType:h(a),before:i.getHierarchyName(a),after:t}}:s.entity&&(n={entityRename:{schema:s.schema,before:s.entity,after:t}});return d(n,r)}}function u(e,t){if(!_.isEmpty(e)){for(var r,i=[],a=0,s=e;a<s.length;a++){var l=s[a],u=o.asFieldPattern(l),c=u.column||u.groupingColumn;if(!c)return;if(r){if(!n.equals(l.source,r))return}else r=l.source;i.push(c.name)}d({hierarchyCreate:{schema:r.schema,entity:r.entity,name:null,properties:i}},t)}}function c(e,t,r,i){if(e){var n=o.asFieldPattern(e),a=n.column||n.groupingColumn;if(a){d({hierarchyLevelCreate:{schema:a.schema,entity:a.entity,hierarchy:t,property:a.name,index:r}},i)}}}function p(e){if(null!=e&&!_.isEmpty(e.changes)){var t=_.filter(e.changes,(function(e){return e.newMeasureCreated||e.newCalculatedColumnCreated||e.measureMove||e.newCalculatedTableCreated||e.newBins||e.newGroups}));if(0!==t.length){var r,i,n,o,s=t[t.length-1];return s.newMeasureCreated?(r=s.newMeasureCreated.schema,i=s.newMeasureCreated.entity,o=s.newMeasureCreated.name,a.measureRef(a.entity(r,i),o)):s.newCalculatedColumnCreated?(r=s.newCalculatedColumnCreated.schema,i=s.newCalculatedColumnCreated.entity,n=s.newCalculatedColumnCreated.name,a.columnRef(a.entity(r,i),n||o)):s.newCalculatedTableCreated?(r=s.newCalculatedTableCreated.schema,i=s.newCalculatedTableCreated.entity,a.entity(r,i)):s.measureMove?(r=s.measureMove.schema,i=s.measureMove.destination,o=s.measureMove.property,a.measureRef(a.entity(r,i),o)):s.newBins?(r=s.newBins.schema,i=s.newBins.entity,n=s.newBins.name,a.columnRef(a.entity(r,i),n)):s.newGroups?(r=s.newGroups.schema,i=s.newGroups.entity,n=s.newGroups.name,a.columnRef(a.entity(r,i),n)):void 0}}}function f(e,t,r){var i=[];if(e&&(i=e.validate(t,r,i)),!_.isEmpty(i))return i}function d(e,t){return t.apply({changes:[e]})}function h(e){if(v(e)){if(e.column||e.groupingColumn)return"Column";if(e.measure)return"Measure";if(e.hierarchy)return"Hierarchy"}return"Table"}function v(e){return i.getPropertyName(e)||i.getHierarchyName(e)}function m(e,t,r){var n,a=o.asFieldPattern(e);if(a.hierarchyLevel){var s=a.hierarchyLevel;n={setDescription:{schema:s.schema,topLevelObjectName:s.entity,tableItemName:s.name,levelName:s.level,objectType:"Level",description:t}
}}else{var l=i.toFieldExprEntityItemPattern(a);n={setDescription:{schema:l.schema,topLevelObjectName:l.entity,tableItemName:v(a),objectType:h(a),description:t}}}d(n,r)}e.hide=t,e.move=r,e.refreshEntity=s,e.rename=l,e.createHierarchy=u,e.createHierarchyLevel=c,e.getSelectedItemFromModelChange=p,e.validate=f,e.getObjectTypeForSchemaChange=h,e.getFieldExprReferenceNameInEntity=v,e.setDescription=m})(r=t.ModelAuthoringUtility||(t.ModelAuthoringUtility={}))})(r=t.util||(t.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){function t(e,t){return new i(e,t)}var r;!(function(e){e[e.None=0]="None",e[e.DuplicatedName=1]="DuplicatedName",e[e.EmptyName=2]="EmptyName",e[e.NameTooLong=3]="NameTooLong"})(r=e.NameValidationError||(e.NameValidationError={})),e.createNameValidator=t;var i=(function(){function e(e,t){this.federatedConceptualSchema=e,this.localizationService=t,this.MaximumNameLength=512}return e.prototype.validateMeasureName=function(t,i){if(!t||0===t.trim().length)return{error:r.EmptyName,reason:this.localizationService.get("NameValidationFailedEmptyName")};if(t.length>this.MaximumNameLength)return{error:r.NameTooLong,reason:this.localizationService.format("NameValidationFailedLongName",[t,this.MaximumNameLength])};var n=e.normalizeModelItemName(t);return i&&e.normalizeModelItemName(i)===n?{error:r.None}:this.validateColumnAndMeasureNameUniqueness(n)},e.prototype.validateExistingMeasureName=function(t){var r=e.normalizeModelItemName(t.name);return this.validateColumnAndMeasureNameUniqueness(r,(function(e,r){return r!==t}))},e.prototype.makeValidMeasureName=function(e){var t=this;return this.makeValidName(e,(function(e){return t.validateMeasureName(e).error}))},e.prototype.makeValidName=function(e,t){var i,n=e,a=t(n);if(a===r.DuplicatedName)i=2;else{if(a===r.None)return e;i=0}for(;;){var o=void 0;switch(o=i?n+" "+i:n,a=t(o)){case r.None:return o;case r.DuplicatedName:i++,1===i&&(i=2);continue;case r.NameTooLong:n=n.slice(0,Math.min(this.MaximumNameLength,n.length-1)),i=0;continue;default:throw new Error("MakeValidName encountered a problem it can't fix.")}}},e.prototype.validateColumnAndMeasureNameUniqueness=function(t,i){for(var n=0,a=this.federatedConceptualSchema.schemas;n<a.length;n++)for(var o=a[n],s=0,l=o.entities;s<l.length;s++)for(var u=l[s],c=0,p=u.properties;c<p.length;c++){var f=p[c];if((!i||i(u,f))&&e.normalizeModelItemName(f.name)===t){var d=f.measure?"NameValidationFailedCollisionMeasure":"NameValidationFailedCollisionColumn";return{error:r.DuplicatedName,reason:this.localizationService.format(d,[f.name,u.name])}}}return{error:r.None}},e.normalizeModelItemName=function(e){return jsCommon.StringExtensions.normalizeCase(e)},e})()})(t=e.util||(e.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){function r(e,t,r,i){return new o(e,t,r,i)}var i=e.data.QueryProjectionCollection,n=e.data.QueryProjectionsByRole,a=(function(){function e(e,t,r){this.plugin=e,this.initialize(t,r)}return Object.defineProperty(e,"ValuesRoleName",{get:function(){return e.ValuesRole},enumerable:!0,configurable:!0}),e.getProjection=function(e,t){var r=n.getRole(e,t);return r||(e[t]=r=new i([])),r.all()},e.addCategoryRole=function(t,r){e.getProjection(t,e.CategoryRole).push(r.projection)},e.addValuesRole=function(t,r){e.getProjection(t,e.ValuesRole).push(r.projection)},e.addSeriesRole=function(t,r){e.getProjection(t,e.SeriesRole).push(r.projection)},e.addBreakdownRole=function(t,r){e.getProjection(t,e.BreakdownRole).push(r.projection)},e.addGroupRole=function(t,r){e.getProjection(t,e.GroupRole).push(r.projection)},e.addDetailsRole=function(t,r){e.getProjection(t,e.DetailsRole).push(r.projection)},e.addYRole=function(t,r){e.getProjection(t,e.YRole).push(r.projection)},e.addTargetValueRole=function(t,r){e.getProjection(t,e.TargetValueRole).push(r.projection)},e.addMinValueRole=function(t,r){e.getProjection(t,e.MinValueRole).push(r.projection)},e.addMaxValueRole=function(t,r){e.getProjection(t,e.MaxValueRole).push(r.projection)},e.addXRole=function(t,r){e.getProjection(t,e.XRole).push(r.projection)},e.addSizeRole=function(t,r){e.getProjection(t,e.SizeRole).push(r.projection)},e.addGradientRole=function(t,r){e.getProjection(t,e.GradientRole).push(r.projection)},e.addTooltipRole=function(t,r){e.getProjection(t,e.TooltipRole).push(r.projection)},e.addRowsRole=function(t,r){e.getProjection(t,e.RowsRole).push(r.projection)},e.addColumnsRole=function(t,r){e.getProjection(t,e.ColumnsRole).push(r.projection)},e.prototype.initialize=function(e,t){var r=e.select();this.projectionsInfo=[];for(var i=0,n=r.length;i<n;i++){var a=r[i];this.projectionsInfo.push({projection:{queryRef:a.name},metadata:a.expr.getMetadata(t)})}},e.ValuesRole="Values",e.SeriesRole="Series",e.BreakdownRole="Breakdown",e.CategoryRole="Category",e.GroupRole="Group",e.DetailsRole="Details",e.YRole="Y",e.XRole="X",e.SizeRole="Size",e.GradientRole="Gradient",e.PlayRole="Play",e.RowsRole="Rows",e.ColumnsRole="Columns",e.MinValueRole="MinValue",e.MaxValueRole="MaxValue",e.TargetValueRole="TargetValue",e.TooltipRole="Tooltips",e})();t.QueryProjectionBuilder=a;var o=(function(e){function t(t,r,i,n){var a=e.call(this,t,i,n)||this;return a.dataRoles=r,a}return __extends(t,e),t.prototype.validatePlugin=function(){return!0},t.prototype.build=function(){for(var e={},t=0,r=this.dataRoles.length;t<r;t++){var i=this.dataRoles[t],n=this.projectionsInfo[i.Projection];if(n&&(a.getProjection(e,i.Name).push(n.projection),i.isActive)){e[i.Name].addActiveQueryReference(n.projection.queryRef)}}return e},t})(a);t.DataRolesQueryProjectionBuilder=o,t.createProjectionBuilderFromDataRoles=r})(r=t.QueryProjectionBuilderCoreUtils||(t.QueryProjectionBuilderCoreUtils={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){function r(t,r,i){var n=e.createJQueryPromiseFactory().defer(),a=d(t,r);return a===-1?n.resolve(void 0):i.get(t.reportId,t.pods[a].name).then((function(e){var t=e&&e.words.slice();if(_.isEmpty(t))n.resolve(void 0);else{t.shift();var r={altNames:t};n.resolve(r)}})),n.promise}function i(e,t,r){var i=d(e,t);i>-1&&(r.set(e.reportId,e.pods[i].name,[]),e.pods.splice(i,1))}function n(e,t,r){return a(e,t.name,t.displayName,r)}function a(e,t,r,i){var n=d(e,t);n===-1&&(n=v(e,t));var a=e.pods[n];return i.get(e.reportId,a.name).then((function(t){var n=t&&t.words;_.isEmpty(n)?n=[r]:n[0]=r,i.set(e.reportId,a.name,n)}))}function o(e,t,r,i){var n=d(e,t.name);n===-1&&(n=v(e,t.name)),r.unshift(t.displayName),i.set(e.reportId,e.pods[n].name,r)}function s(e,t,r){var i=d(e,t);i===-1&&(i=v(e,t));var n=e.pods[i];n.parameters||(n.parameters=[]),n.parameters.push({name:"Param_"+r,boundFilter:r})}function l(e,t,r,i){var n=d(e,t);if(n>-1){var a=e.pods[n],o=h(a,r);o>-1&&(a.parameters.splice(o,1),m(e,n,i))}}function u(e,t,r){var i=d(e,t);return i!==-1&&h(e.pods[i],r)!==-1}function c(e,t,r,i){var n=d(e,t);(n!==-1||r)&&(n===-1&&(n=v(e,t)),e.pods[n].cortanaEnabled=r,m(e,n,i))}function p(e,t){if(e&&e.pods){var r=e.pods,i=_.findIndex(r,(function(e){return e.name===t}));return i!==-1?i:void 0}}function f(t,r,i,n){var a=d(t,t.sections[i].name);if(a===-1)return e.createJQueryPromiseFactory().resolve();var o=v(t,r.name),s=t.pods[o],l=t.pods[a];return s.cortanaEnabled=l.cortanaEnabled,s.parameters=_.cloneDeep(l.parameters),y(t.reportId,r,s,l,n)}function d(e,t){return e&&e.pods?_.findIndex(e.pods,(function(e){return e.boundSection===t})):-1}function h(e,t){return e&&e.parameters?_.findIndex(e.parameters,(function(e){return e.boundFilter===t})):-1}function v(e,t){return e.pods||(e.pods=[]),e.pods.push({name:g(e.pods),boundSection:t,parameters:[]}),e.pods.length-1}function m(e,t,r){var i=e.pods[t];!i.cortanaEnabled&&_.isEmpty(i.parameters)&&r.get(e.reportId,i.name).then((function(r){r&&!_.isEmpty(r.words)||(e.pods.splice(t,1),0===e.pods.length&&(e.pods=void 0))}))}function g(e){for(var t={},r=0,i=e;r<i.length;r++){t[i[r].name]=!0}return C.findUniqueName(t,x)}function y(e,t,r,i,n){return n.get(e,i.name).then((function(i){var a=i&&i.words.slice();_.isEmpty(a)||(a.shift(),a.unshift(t.displayName),n.set(e,r.name,a))}))}var C=jsCommon.StringExtensions,x="Pod";t.getLinguisticMetadata=r,t.deletePod=i,t.ensurePod=n,t.updateLinguisticPrimaryName=a,t.updateLinguisticAltNames=o,t.addParameter=s,t.deleteParameter=l,t.hasParameter=u,t.setCortanaEnabled=c,t.findPodIndexForPodName=p,t.duplicatePod=f,t.findPodIndexForSectionName=d})(r=t.PodUtils||(t.PodUtils={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){function t(){return{automaticallyImport:!1,sandboxProperties:[2,3,1,0],visualTypeOptions:r()}}function r(){return{class:"powerApps"}}e.createPowerAppsVisualRegisterOptions=t})(t=e.PowerAppsVisualHelper||(e.PowerAppsVisualHelper={}))})(t=e.utils||(e.utils={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(r){function i(r){for(var i=[],n=0,a=r;n<a.length;n++){var o=a[n];o.measureMove&&i.push(new p(e.data.createMoveMeasureRewriter(o.measureMove),t.util.BindingRewrite.createMeasureMoveRewriter(o.measureMove))),o.entityRename&&i.push(new p(e.data.createEntityRenameRewriter(o.entityRename),t.util.BindingRewrite.createEntityRenameRewriter(o.entityRename))),o.propertyRename&&i.push(new p(e.data.createPropertyRenameRewriter(o.propertyRename),t.util.BindingRewrite.createPropertyRenameRewriter(o.propertyRename))),o.hierarchyLevelRename&&i.push(new p(e.data.createHierarchyLevelRenameRewriter(o.hierarchyLevelRename),t.util.BindingRewrite.createHierarchyLevelRenameRewriter(o.hierarchyLevelRename))),o.removeVariation&&i.push(new f(new c(o.removeVariation),o.removeVariation))}return i}function n(e,t){var r=l.asFieldPattern(e);return r.columnHierarchyLevelVariation&&r.columnHierarchyLevelVariation.source.entity===t.entity&&r.columnHierarchyLevelVariation.source.schema===t.schema&&r.columnHierarchyLevelVariation.source.name===t.property&&r.columnHierarchyLevelVariation.variationName===t.name}var a=e.data.SQColumnRefExpr,o=e.data.SQEntityExpr,s=e.data.SQExpr,l=e.data.SQExprConverter,u=e.data.SQExprRewriter;r.createSchemaChangeRewriters=i;var c=(function(e){function t(t){var r=this;return r=e.call(this)||this,r.change=t,r}return __extends(t,e),t.prototype.visitHierarchyLevel=function(e){return n(e,this.change)?new a(new o(this.change.schema,this.change.entity),this.change.property):e},t})(u),p=(function(){function e(e,t){this.exprRewriter=e,this.spanRewriter=t}return e.prototype.rewriteQuery=function(e){var t=this,r=e.defn;return r=r.rewrite(this.exprRewriter),e.defn=r,e.expansionStates=_.map(e.expansionStates,(function(e){return e.rewrite(t.exprRewriter)})),e},e.prototype.rewriteFilter=function(e){return e.rewrite(this.exprRewriter)},e.prototype.rewriteExpr=function(e){return e.accept(this.exprRewriter)},e.prototype.rewriteSpan=function(e){return this.spanRewriter?this.spanRewriter.rewriteSpan(e):e},e})();r.VisualQueryExprRewriter=p;var f=(function(){function e(e,t){this.exprRewriter=e,this.change=t}return e.prototype.rewriteQuery=function(e){var t=this;this.removeDuplicateSQHierarchyLevelExpr(e);var r=e.defn;return r=r.rewrite(this.exprRewriter),e.defn=r,e.expansionStates=_.map(e.expansionStates,(function(e){return e.rewrite(t.exprRewriter)})),e},e.prototype.rewriteFilter=function(e){return e.rewrite(this.exprRewriter)},e.prototype.rewriteExpr=function(e){return e.accept(this.exprRewriter)},e.prototype.rewriteSpan=function(e){return e},e.prototype.removeDuplicateSQHierarchyLevelExpr=function(e){for(var t=e.defn.select(),r=0;r<t.length;){var i=t[r];if(r++,s.isHierarchyLevel(i.expr)&&n(i.expr,this.change))for(;r<t.length&&s.isHierarchyLevel(t[r].expr)&&s.equals(i.expr.arg,t[r].expr.arg);)e.removeExpr(t[r].expr,!1),r++}},e})()})(r=t.schemaRewriterUtils||(t.schemaRewriterUtils={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){function t(e,t){var r=[];if(!e||!e.visualContainers)return r;for(var i=0,n=e.visualContainers;i<n.length;i++){var a=n[i];t.addScriptVisualId(a,r)}return r}function r(e,r){var i={totalVisualsCount:0,scriptVisualsUniqueIds:[]};if(!e||!e.sections)return i;for(var n=0,a=e.sections;n<a.length;n++){var o=a[n];if(o.visualContainers){var s=t(o,r);i.scriptVisualsUniqueIds=i.scriptVisualsUniqueIds.concat(s),i.totalVisualsCount+=o.visualContainers.length}}return i}function i(e,r,i,n,a){var o=[];switch(e){case 0:if(!n)return o;a.addScriptVisualId(n,o);break;case 1:o=t(i,a);break;case 2:if(!r)return o;for(var s=0,l=r.sections;s<l.length;s++){var u=l[s],c=t(u,a);o=o.concat(c)}break;default:return o}return o}function n(e,t){for(var r=0,i=e;r<i.length;r++){var n=i[r];if(n&&n.config&&n.config.singleVisual){var a=n.config.singleVisual.visualType;if(a&&t.isScriptVisual(a))return!0}}return!1}function a(e,t,r,i,n,a){var o=e.control(),s=t.get("SettingsDataset_RDataSource_RefreshConfirmationDialog_OkButton"),l=t.get("SettingsDataset_RDataSource_RefreshConfirmationDialog_CancelButton"),u=[new InJs.ModalDialogAction(s,function(){o.hideDialog(),n()}),new InJs.ModalDialogAction(l,function(){o.hideDialog(),a()})],c=t.get("SettingsDataset_RDataSource_RefreshConfirmationDialog_Title"),p=t.get("SettingsDataset_RDataSource_RefreshConfirmationDialog_WarningMessage"),f="<div><span>"+t.get("SettingsDataset_RDataSource_RefreshConfirmationDialog_ActionMessagePart1")+' </span><a href= "https://go.microsoft.com/fwlink/?LinkId=821887" target= "_blank">'+t.get("SettingsDataset_RDataSource_RefreshConfirmationDialog_ActionMessageLink1")+"</a><span> "+t.get("SettingsDataset_RDataSource_RefreshConfirmationDialog_ActionMessagePart2")+"</span><br/><span>"+t.get("SettingsDataset_RDataSource_RefreshConfirmationDialog_ActionMessagePart3")+' </span><a href= "https://go.microsoft.com/fwlink/?LinkId=821886" target= "_blank">'+t.get("SettingsDataset_RDataSource_RefreshConfirmationDialog_ActionMessageLink2")+"</a></div>";i.message=p;var d={dialogName:c,isDismissable:!1,scope:i,template:"<custom-modal-dialog></custom-modal-dialog>",dialogCssClass:"customModalDialog",dialogActions:u,notificationType:jsCommon.ModalDialogNotificationType.SecurityWarning,notificationText:p,htmlMessageText:f,focusOnFirstButton:!1,noActiveButtons:!0,flipContentAndNotificationOrder:!0};r.showLegacyWebModalDialog(d)}function o(e){switch(e){case"scriptVisual":return 0;case"pythonVisual":return 1;default:return null}}function s(e){switch(e){case 0:return"scriptVisual";case 1:return"pythonVisual";default:return null}}e.defaultScript="##############################",e.getScriptVisualIdsInSection=t,e.getVisualStasInExploration=r,e.getScriptVisualIds=i,e.visualContainerHasScriptVisuals=n,e.confirmRefreshForRDataSource=a,e.getScriptVisualType=o,e.getScriptVisualTypeName=s})(t=e.ScriptVisualsUtil||(e.ScriptVisualsUtil={}))})(t=e.util||(e.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(e,t,r){void 0===r&&(r=!0),this.containerSelector=e,this.itemsSelector=t,this.includeDescendants=r}return Object.defineProperty(e.prototype,"position",{get:function(){},set:function(e){},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"max",{get:function(){},enumerable:!0,configurable:!0}),e.prototype.scrollItemIntoView=function(e,t,r){var i=this.getContainer(),n=this.getRange(i),a=this.getItems(),o=a[e];if(o){var s=0===e,l=e===a.length-1,u=this.getRange($(o),!0);if(s?t=0:l?t=r||0:null!==t&&void 0!==t||(t=this.getDefaultOverscroll()),n&&u){var c=this.calculatePositionDelta(n,u,t);this.position=this.position+c}}},e.prototype.getPageDownItemIndex=function(e){var t=this.getRange(this.getContainer());if(t){var r=this.getItems();if(0===r.length)return-1;for(var i=0,n=e;n<r.length-1;n++){if(i+=this.getRange(r.eq(n)).size,i>t.size)return n}return r.length-1}return-1},e.prototype.getPageUpItemIndex=function(e){var t=this.getRange(this.getContainer());if(t){var r=this.getItems();if(0===r.length)return-1;for(var i=0,n=e;n>0;n--){if(i+=this.getRange(r.eq(n)).size,i>t.size)return n}return 0}return-1},e.prototype.retainPosition=function(e){var t=this.position;try{e()}finally{this.position=t}},e.prototype.handleKeyDown=function(e,t,r){var i=!0,n=e,a=this.getItems(),o=a.length-1;switch(t.keyCode){case $.ui.keyCode.PAGE_UP:var s=this.getPageUpItemIndex(e);n=Math.max(s,0);break;case $.ui.keyCode.PAGE_DOWN:var l=this.getPageDownItemIndex(e);n=Math.min(l,o);break;case $.ui.keyCode.END:n=o;break;case $.ui.keyCode.HOME:n=0;break;default:n=this.getNewIndexOnKeyDown(e,o,t),i=void 0!==n}return void 0!==n&&n!==e&&(r(n),this.scrollItemIntoView(n)),i},e.prototype.onScroll=function(e){var t=this;this.getContainer().scroll((function(){e(t.position/t.max)}))},e.prototype.getNewIndexOnKeyDown=function(e,t,r){},e.prototype.getRange=function(e,t){void 0===t&&(t=!1)},e.prototype.getDefaultOverscroll=function(){},e.prototype.getContainer=function(){return $(this.containerSelector)},e.prototype.getItems=function(){return this.retrieveItems()},e.prototype.retrieveItems=function(){return this.includeDescendants?this.getContainer().find(this.itemsSelector):this.getContainer().children(this.itemsSelector)},e.prototype.calculatePositionDelta=function(e,t,r){return t.min<e.min?-(e.min-t.min+r):t.max>e.max?t.max-e.max+r:0},e})();e.BaseScrollHelper=t;var r=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),Object.defineProperty(t.prototype,"position",{get:function(){return this.getContainer().scrollTop()},set:function(e){var t=this.getContainer();t.scrollTop()!==e&&t.scrollTop(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"max",{get:function(){var e=this.getContainer()[0];return e?e.scrollHeight:void 0},enumerable:!0,configurable:!0}),t.prototype.getNewIndexOnKeyDown=function(e,t,r){switch(r.keyCode){case $.ui.keyCode.UP:return r.scrollHandled=!0,Math.min(Math.max(e-1,0),t);case $.ui.keyCode.DOWN:return Math.min(e+1,t)}},t.prototype.getRange=function(e,t){void 0===t&&(t=!1);var r=e.offset();if(r){var i=t?e.outerHeight():e.innerHeight();return{min:r.top,max:r.top+i,size:i}}return null},t.prototype.getDefaultOverscroll=function(){return 0},t})(t);e.VerticalScrollHelper=r;var i=(function(e){function t(t,r,i,n){void 0===i&&(i=!1),void 0===n&&(n=!0);var a=e.call(this,t,r,n)||this;return a.isRtl=i,a}return __extends(t,e),Object.defineProperty(t.prototype,"position",{get:function(){return this.getContainer().scrollLeft()},set:function(e){var t=this.getContainer();t.scrollLeft()!==e&&t.scrollLeft(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"max",{get:function(){var e=this.getContainer()[0];return e?e.scrollWidth:void 0},enumerable:!0,configurable:!0}),t.prototype.getNewIndexOnKeyDown=function(e,t,r){var i=0;switch(r.keyCode){case $.ui.keyCode.LEFT:i=-1;break;case $.ui.keyCode.RIGHT:i=1}if(this.isRtl&&(i=-i),0!==i)return e+=i,e<0&&(e=0),e>t&&(e=t),e},t.prototype.getRange=function(e,t){void 0===t&&(t=!1);var r=e.offset();if(r){var i=t?e.outerWidth():e.innerWidth();return{min:r.left,max:r.left+i,size:i}}return null},t.prototype.getDefaultOverscroll=function(){return 16},t.prototype.calculatePositionDelta=function(t,r,i){var n=e.prototype.calculatePositionDelta.call(this,t,r,i);return this.isRtl?-n:n},t})(t);e.HorizontalScrollHelper=i;var n=(function(){function e(e,t,r){this.lastScrollLeft=0,this.lastScrollTop=0,this.scrollPanel=e,this.syncedPanel=t,this.syncOptions=r,this.onScroll=this.onScroll.bind(this),this.scrollPanel.addEventListener("scroll",this.onScroll)}return e.prototype.dispose=function(){this.scrollPanel.removeEventListener("scroll",this.onScroll)},e.prototype.onScroll=function(){var e=this;this.syncOptions.syncDelay?(clearTimeout(this.timeoutId),this.timeoutId=setTimeout((function(){e.syncScrollPositions()}),this.syncOptions.syncDelay)):this.syncScrollPositions()},e.prototype.syncScrollPositions=function(){if(this.syncOptions.syncX){var e=this.scrollPanel.scrollLeft;e!==this.lastScrollLeft&&(this.syncedPanel.scrollLeft=e,this.lastScrollLeft=e)}if(this.syncOptions.syncY){var t=this.scrollPanel.scrollTop;t!==this.lastScrollTop&&(this.syncedPanel.scrollTop=t,this.lastScrollTop=t)}},e})();e.ScrollSyncHelper=n})(t=e.utils||(e.utils={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function t(t,r,i,n){void 0===n&&(n=!0),this._hasFocus=!1,this.selection=e.createTreeSelectionManager(t),this.scrollHelper=new e.VerticalScrollHelper(r,i),this.getVisibleNodes=t,this.allowMultiSelect=n}return t.prototype.hasFocus=function(){return this._hasFocus},t.prototype.onNodeClick=function(e,t){if(t.ctrlKey)this.selection.toggle(e);else if(t.shiftKey&&this.selection.lastSelected){var r=this.selection.lastSelected;this.selection.clear(),this.selection.selectRange(this.getNodesRange(r,e))}else{var i=500;this.lastNodeClickTime&&t.timeStamp-this.lastNodeClickTime>i&&_.isEqual(this.selection.getSelectedItems(),[e])?this.selection.toggle(e):(this.focus(e),this.selection.clear(),this.selection.select(e)),this.lastNodeClickTime=t.timeStamp}t.stopPropagation()},t.prototype.onBackgroundClick=function(e){this.selection.clear(),e.stopPropagation()},t.prototype.onFocus=function(){this.focus(this.getFocusedNode()||this.getVisibleNodes()[0]),this._hasFocus=!0},t.prototype.onBlur=function(){this.getVisibleNodes().map((function(e){return e.isFocused=!1})),this._hasFocus=!1},t.prototype.onKeyDown=function(e){var t=this,r=this.getVisibleNodes(),i=!1,n=this.selection.lastSelected;e.ctrlKey&&65===e.keyCode&&this.allowMultiSelect&&(this.selection.selectAll(),i=!0),e.keyCode===$.ui.keyCode.ESCAPE&&(this.selection.clear(),i=!0),e.keyCode===$.ui.keyCode.LEFT&&n&&(n.isExpanded?n.isExpanded=!1:n.parent&&this.selectAndScrollTo([n.parent]),i=!0),e.keyCode===$.ui.keyCode.RIGHT&&n?(n.children&&(n.isExpanded?n.children.length>0&&this.selectAndScrollTo([n.children[0]]):n.isExpanded=!0),i=!0):i=this.scrollHelper.handleKeyDown(r.indexOf(this.selection.lastSelected),e,(function(i){t.allowMultiSelect&&(e.ctrlKey||e.shiftKey)||t.selection.clear(),t.focus(r[i]),t.selection.select(r[i])})),i&&(e.stopPropagation(),e.preventDefault())},t.prototype.toggleExpandCollapse=function(e,t){e.isExpanded=!e.isExpanded,t&&t.stopPropagation()},t.prototype.selectAndScrollTo=function(e){var t=this;this.selection.clear(),this.selection.selectRange(e),requestAnimationFrame((function(){var r=t.getVisibleNodes(),i=r.indexOf(e[0]);t.scrollHelper.scrollItemIntoView(i,30)}))},t.prototype.getNodesRange=function(e,t){var r,i=this.getVisibleNodes(),n=i.indexOf(e),a=i.indexOf(t),o=Math.min(n,a),s=Math.max(n,a);if(o>-1){r=[];for(var l=o;l<=s;l++)r.push(i[l])}return r},t.prototype.focus=function(e){e&&(this.getVisibleNodes().map((function(e){return e.isFocused=!1})),e.isFocused=!0)},t.prototype.getFocusedNode=function(){var e=this.getVisibleNodes(),t=_.find(e,(function(e){return e.isSelected}));return null!=t?t:_.find(e,(function(e){return e.isFocused}))},t})();e.TreeHelper=t})(t=e.utils||(e.utils={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){function t(e){return new r(e)}e.createTreeSelectionManager=t;var r=(function(){function e(e){this.selectedItems=[],this.getItems=e}return Object.defineProperty(e.prototype,"lastSelected",{get:function(){return _.last(this.selectedItems)},enumerable:!0,configurable:!0}),e.prototype.getSelectedItems=function(){return this.selectedItems.slice()},e.prototype.select=function(e){e.isSelected||(e.isSelected=!0,this.selectedItems.push(e))},e.prototype.selectRange=function(e){for(var t=0,r=e;t<r.length;t++){var i=r[t];this.select(i)}},e.prototype.selectAll=function(){this.selectRange(this.getItems())},e.prototype.toggle=function(e){e.isSelected?(e.isSelected=!1,this.selectedItems.splice(this.selectedItems.indexOf(e),1)):(e.isSelected=!0,this.selectedItems.push(e))},e.prototype.clear=function(){for(var e=0,t=this.selectedItems;e<t.length;e++){t[e].isSelected=!1}this.selectedItems.splice(0)},e})()})(t=e.utils||(e.utils={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){var r;!(function(t){function r(t,r){return{automaticallyImport:!0,sandboxProperties:[2,1,0,3],providers:{blocker:{blockedInCluster:_.noopTrue,blockedInTenant:_.noopTrue},validator:{getErrorDetails:function(){return{message:r.get("VisualContainer_EsriNotSupportedInEmbed"),errorType:1,displayableErrorInfo:[],helpLink:e.models.EsriLearnMoreUrl}}}},visualTypeOptions:i(),registerVisualConsentOptions:{consentDialogProvider:{showConsentDialog:function(){return t.reject("Esri is not supported in Embedded scenario.")}},consentPersistencyProvider:{loadConsent:function(){return t.reject("Esri is not supported in Embedded scenario.")},saveConsent:function(e){return t.reject("Esri is not supported in Embedded scenario.")}}}}}function i(){return{class:e.visualHost.EsriVisual,titleKey:"ArcGISMapsForPowerBI",watermarkKey:"map"}}function n(e){return{blockedInCluster:function(){return!e.featureSwitches.esriEnabled},blockedInTenant:function(){return!e.featureSwitches.esriVisualEnabled}}}t.createEmbedRegisterTrustedVisualOptions=r,t.createBlocker=n})(r=t.EsriVisualHelper||(t.EsriVisualHelper={}))})(r=t.utils||(t.utils={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){function t(e){var t=[2,3,1,0];return e&&t.push(4),{automaticallyImport:!1,sandboxProperties:t,visualTypeOptions:r()}}function r(){return{watermarkKey:"visioVisual"}}e.createVisioVisualRegisterOptions=t})(t=e.VisioVisualHelper||(e.VisioVisualHelper={}))})(t=e.utils||(e.utils={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){function t(){return{automaticallyImport:!1,sandboxProperties:[2,0]}}e.createGlobeMapVisualRegisterOptions=t})(t=e.GlobeMapVisualHelper||(e.GlobeMapVisualHelper={}))})(t=e.utils||(e.utils={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){function t(){return{automaticallyImport:!1,sandboxProperties:[2,0]}}e.createMapboxVisualRegisterOptions=t})(t=e.MapboxVisualHelper||(e.MapboxVisualHelper={}))})(t=e.utils||(e.utils={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){function t(){return{automaticallyImport:!1,sandboxProperties:[2,0]}}e.createDEMatrixV2VisualRegisterOptions=t})(t=e.PowerOnDEMatrixV2VisualHelper||(e.PowerOnDEMatrixV2VisualHelper={}))})(t=e.utils||(e.utils={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){function t(){return{automaticallyImport:!1,sandboxProperties:[2,0]}}e.createDEMatrixV3VisualRegisterOptions=t})(t=e.PowerOnDEMatrixV3VisualHelper||(e.PowerOnDEMatrixV3VisualHelper={}))})(t=e.utils||(e.utils={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){function t(){return{automaticallyImport:!1,sandboxProperties:[2,0,1]}}e.createDetailReportVisualRegisterOptions=t})(t=e.PowerOnDetailReportVisualHelper||(e.PowerOnDetailReportVisualHelper={}))})(t=e.utils||(e.utils={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){function t(){return{automaticallyImport:!1,sandboxProperties:[2,0]}}e.createSmartFilterVisualRegisterOptions=t})(t=e.PowerOnSmartFilterVisualHelper||(e.PowerOnSmartFilterVisualHelper={}))})(t=e.utils||(e.utils={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){function t(){return{automaticallyImport:!1,sandboxProperties:[2,0,1]}}e.createTableEditorVisualRegisterOptions=t})(t=e.PowerOnTableEditorVisualHelper||(e.PowerOnTableEditorVisualHelper={}))})(t=e.utils||(e.utils={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){function t(){return{automaticallyImport:!1,sandboxProperties:[2,0,1]}}e.createTableEditorV2VisualRegisterOptions=t})(t=e.PowerOnTableEditorV2VisualHelper||(e.PowerOnTableEditorV2VisualHelper={}))})(t=e.utils||(e.utils={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){function t(){return{automaticallyImport:!1,sandboxProperties:[2,0]}}e.createForecasterVisualRegisterOptions=t})(t=e.PowerOnForecasterVisualHelper||(e.PowerOnForecasterVisualHelper={}))})(t=e.utils||(e.utils={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){function r(e,t){return _.isEmpty(e)?e:x.rewriteArray(e,(function(e){return V.isScopeIdentity(e)?i(e,t):V.isScopeWildcard(e)?n(e,t):V.isRoleWildcard(e)||V.isWildcard(e)?e:V.isScopeTotal(e)?a(e,t):e}))}function i(e,t){var r=m(e.expr,t);return r!==e.expr?b(r):e}function n(e,t){var r=x.rewriteArray(e.exprs,(function(e){return m(e,t)}));return r!==e.exprs?F.fromExprs(r):e}function a(e,t){var r=x.rewriteArray(e.exprs,(function(e){return m(e,t)}));return r!==e.exprs?w.fromExprs(r):e}function o(e,t){if(e){var r=e.properties.qna;if(r){var i=r.suggestedUtterances;if(i)for(var n=function(e){var r=e.spans;r&&r.forEach((function(r,i){e.spans[i]=s(r,t)}))},a=0,o=i;a<o.length;a++){var l=o[a];n(l)}}}}function s(e,t){return _.reduce(t,(function(e,t){return t.rewriteSpan(e)}),e)}function l(e,t){d(e,t)}function u(e,t){d(e,t)}function c(t,r,i){var n=E.findFilterOutput(r);if(n){var a=e.data.DataViewObjectDefinitions.getPropertyContainer(t,n,null);if(a){var o=n.propertyName,s=a[o];if(s){for(var l=0,u=i;l<u.length;l++){s=u[l].rewriteFilter(s)}a[o]=s}}}}function p(e,t,r){e&&t&&S.visitPropertyDefinitions(e,t,(function(e,t,i,n){var a=e[t];if(a instanceof P)for(var o=0,s=r;o<s.length;o++){var l=s[o];a=l.rewriteExpr(a)}else{var u=n.type,c=a,p=a;if(u.fill&&u.fill.solid&&u.fill.solid.color){if(!c.solid||!c.solid.color)return;for(var d=c.solid.color,h=d,v=0,m=r;v<m.length;v++){var l=m[v];d=l.rewriteExpr(d)}d!==h&&(a={solid:{color:d}})}else if(u.paragraphs&&!_.isEmpty(p)){if(!f(p,r))return;a=_.map(p,(function(e){return{horizontalTextAlignment:e.horizontalTextAlignment,textRuns:_.map(e.textRuns,(function(e){var t=e.value;if(t instanceof P)for(var i=0,n=r;i<n.length;i++){var a=n[i];t=a.rewriteExpr(t)}return{textStyle:e.textStyle,url:e.url,value:t}}))}}))}}e[t]=a}))}function f(e,t){for(var r=0,i=e;r<i.length;r++)for(var n=i[r],a=n.textRuns,o=0,s=a;o<s.length;o++){var l=s[o],u=l.value;if(u instanceof P)for(var c=u,p=0,f=t;p<f.length;p++){var d=f[p];if(c=d.rewriteExpr(c),c!==u)return!0}}return!1}function d(e,t){var r=e.expression,i=e.filter,n=e.cachedValueItems;r&&(e.expression=m(r,t)),i&&(e.filter=v(i,t)),n&&h(n,t)}function h(e,t){for(var r=0,n=e;r<n.length;r++){var a=n[r],o=i(a.identity,t);o!==a.identity&&(a.identity=o)}}function v(e,t){return _.reduce(t,(function(e,t){return t.rewriteFilter(e)}),e)}function m(e,t){return _.reduce(t,(function(e,t){return t.rewriteExpr(e)}),e)}function g(e,t){var r=e.fieldExpr;e.fieldExpr=m(r,t)}function y(e,t){for(var r=0,n=e;r<n.length;r++){var a=n[r];a.identities=x.rewriteArray(a.identities,(function(e){return i(e,t)}))}}function C(e,t){e.expressions=x.rewriteArray(e.expressions,(function(e){return m(e,t)})),e.cachedValueItems&&y(e.cachedValueItems,t)}var x=jsCommon.ArrayExtensions,b=e.data.createDataViewScopeIdentity,S=e.data.DataViewObjectDefinitions,E=e.data.DataViewObjectDescriptors,w=e.data.DataViewScopeTotal,F=e.data.DataViewScopeWildcard,V=e.data.Selector,P=e.data.SQExpr;
t.rewriteDataRepetitionSelectors=r,t.rewriteVisualLink=o,t.rewriteFilterContainer=l,t.rewriteFilterContainerState=u,t.rewriteFilterOutput=c,t.rewriteDataBoundPropertyDefinitions=p,t.rewriteDisplayNameIdentityPairs=h,t.rewriteSemanticFilter=v,t.rewriteExpr=m,t.rewriteLinkField=g,t.rewriteFilterExpressionMetadata=C})(r=t.util||(t.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(r){function i(r,i,a,o,s,l,u){var c=[],p=i.where(c,new e.data.SQFrom),f={expr:[],visualType:s.plugin.name,schema:l,query:new t.contracts.VisualQuery(p,s.build(o),[])};return n(r,i,a,u.create(f).singleVisual)}function n(e,r,i,n){return{name:e,config:{singleVisual:n},filters:t.FilterUtils.deriveFromSQFilters(r.from(),r.where(),i),layouts:jsCommon.ArrayExtensions.extendWithId([{id:0,position:null}])}}r.create=i,r.createWithSingleVisualConfig=n})(r=t.VisualContainerFactory||(t.VisualContainerFactory={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(r){var i,n=jsCommon.CssConstants,a=e.data.DataViewObjectDefinitions,o=e.data.services.DataViewObjectSerializer,s=e.data.DataViewTransform,l=e.common.utils.IdUtility,u=jsCommon.PixelConverter,c=e.data.SQExpr,p=e.data.SQExprUtils,f=t.contracts.VisualContainer;!(function(r){function i(e){if(e&&e.config&&e.config.singleVisual)return e.config.singleVisual.visualType}function d(e){return e&&e.config&&e.config.singleVisual?e.config.singleVisual.query:null}function h(e){var t=e.config;if(t){var r=t.singleVisual;if(r&&r.query){return r.query.defn.select()}}}function v(e,t){if(e&&t){var r=t.getPlugin(e);if(r)return r.capabilities}}function m(e,t){return v(e&&e.config&&e.config.singleVisual?e.config.singleVisual.visualType:null,t)}function g(e,t){return v(r.getVisualType(e),t)}function y(e,t){var r=g(e,t);if(r&&!_.isEmpty(r.dataRoles))return r.dataRoles}function C(e){if(e){var t=e.capabilities;if(t&&!_.isEmpty(t.dataRoles))return t.dataRoles}}function x(t,r,i){var n=g(t,r);if(n){var a=d(t);if(a){return e.requireSync("Explore/services/visualCapabilitiesHelper").create(n,i).getNumberRangesForRoles(a)}}}function b(e,t){var i=r.getVisualType(e);return t&&t.isScriptVisual(i)}function S(e){return e.config&&e.config.singleVisual&&e.config.singleVisual.objects}function E(e){return e.config&&e.config.singleVisual&&e.config.singleVisual.vcObjects}function w(e,t,r){var i=e.config.singleVisual.query.projections[t],n=i.all(),a=n[r];return a.queryRef}function F(t,r,i,n,a,o){if(i){var s=i.defn.select(),l=i.projections,u=[],f=[],d=Y(i),h=e.DataViewAnalysis.chooseDataViewMappings(i.projections,a.dataViewMappings,d),v=h.supportedMappings;if(v){for(var m=0,g=v;m<g.length;m++){var y=g[m],C=v.length>1?P(y):null,x=[];for(var b in l)if(null==C||_.includes(C,b))for(var S=l[b],E=0,w=S.all();E<w.length;E++){var F=w[E],V=fe.indexWithName(s,F.queryRef),T=s[V];if(!c.isTransformOutputRoleRef(T.expr)){var N=T.expr.getMetadata(r),I={Restatement:t.getDisplayName(T.expr,r,a,T.name,n),Name:F.queryRef,Type:D(N.type)},j=p.getKpiMetadata(T.expr,r);j&&(I.kpi=j);var O=F.format||N.format;O&&(I.Format=O);var M=R(N.type);M&&(I.DataCategory=M),u[V]=I,x.push({Name:b,Projection:V,isActive:_.includes(S.activeProjectionRefs,F.queryRef)})}}f.push({DataRoles:x})}return{queryMetadata:{Select:u,Filters:o},visualElements:f}}}}function V(e,t){var r=e;if(r.role)return void t.push(r.role);var i=e;if(i.bind)return void(i.bind.to&&t.push(i.bind.to));var n=e;if(n.for)return void(n.for.in&&t.push(n.for.in));var a=e;if(a.group){if(a.group.by&&t.push(a.group.by),a.group.select)for(var o=0,s=a.group.select;o<s.length;o++){var l=s[o];V(l,t)}}else{var u=e;if(u.composite)for(var c=0,p=u.composite;c<p.length;c++){var f=p[c];V(f,t)}else{var d=e;if(d.select)for(var h=0,v=d.select;h<v.length;h++){var l=v[h];V(l,t)}}}}function P(e){var t=[];return e&&(e.categorical&&(e.categorical.categories&&V(e.categorical.categories,t),e.categorical.values&&V(e.categorical.values,t)),e.table&&e.table.rows&&V(e.table.rows,t),e.single&&V(e.single,t),e.tree&&(e.tree.nodes&&V(e.tree.nodes,t),e.tree.values&&V(e.tree.values,t)),e.matrix&&(e.matrix.columns&&V(e.matrix.columns,t),e.matrix.rows&&V(e.matrix.rows,t),e.matrix.values&&V(e.matrix.values,t))),t=_.uniq(t)}function D(e){switch(e.extendedType){case 66048:return 67;case 131584:return 35}switch(e.primitiveType){case 1:return 2048;case 2:case 3:return 1;case 4:return 3;case 5:return 4096;case 6:return 20;case 7:return 4;case 9:return 8}}function R(t){return e.data.conceptualDataCategoryFromString(t.categoryString)}function T(e,t){if(e&&e.config&&e.config.singleVisual&&e.config.singleVisual.query&&e.config.singleVisual.query.defn){var r=e.config.singleVisual.query.projections,i=e.config.singleVisual.query.defn.select();if(r&&i.length>0)for(var n in r)for(var a=r[n],o=0,s=a.all();o<s.length;o++){var l=s[o],u=jsCommon.ArrayExtensions.findItemWithName(i,l.queryRef);if(u){var c=u.expr,p=c.getMetadata(t);if(p&&0===p.kind&&null==p.aggregate)return!0}}return!1}}function N(e){return function(t){return e===t}}function I(e){return function(t){return e!==t}}function j(e,t,r,i){return function(n){return e===n||3!==(r&&r.relationshipFilterAction(t,e,n,i))}}function O(t,r){t.publishToChannel(e.explore.services.events.dataSelectionChanged,{affectContainer:function(e){return e===r}})}function M(t,i,n,a,s,l,u,c){if(l){var p,f=t.capabilities(l.visualType);if(f){var d=r.describeForPinning(i,s,l.query,l.columnProperties,f,u);if(d){var h=o.serializeObjects(l.objects,f.objects);p=a.transforms&&f&&f.objects?e.data.services.DataViewTransformActionsSerializer.serializeDataViewTransformActions(a.transforms,f.objects):{objects:h},p.objects=p.objects||h,p.visualElements=d.visualElements,p.queryMetadata=d.queryMetadata}}return{queryObject:a.options.query.command,dataObject:n,transformsObject:p,dataUpdatedTime:c}}}function k(e){for(var t={},r=0,i=e;r<i.length;r++){var n=i[r];t[n.name]=!0}return A(t)}function A(e){return l.generateUniqueId(e)}function B(t,r){t.publishToChannel(e.explore.services.events.visualContainerChanged,{affectContainer:function(e){return e!==r}})}function z(t,r){_.isEmpty(r)||t.publishToChannel(e.explore.services.events.visualContainerChanged,{affectContainer:function(e){return _.includes(r,e)}})}function q(t){return _.some(t,(function(t){return t.dsr&&t.dsr.vsName===e.common.constants.onPremiseVSName}))}function L(e){return e&&null!=e.fontSize?u.fromPoint(e.fontSize):u.toString(r.DefaultTitleFontSizeInPixel)}function U(t){var i=L(t),n={fontFamily:t&&t.fontFamily||r.DefaultTitleFontFamily,fontSize:i};return e.TextMeasurementService.estimateSvgTextHeight(n)}function H(r,i,n){var o=n.config.singleVisual.visualType,l=n.config.singleVisual.vcObjects,u=a.getValue(l,{objectName:"stylePreset",propertyName:"name"},void 0),c=i.getVisualObjects(r,o,u&&u.value,t.contracts.VisualContainer.CommonObjectDescriptors);c&&(l=a.clone(l||{}),a.extend(l,c));var p=i.getVisualStyle(r),f=e.data.createStaticEvalContext(p),d=s.evaluateMetadataOnceDataViewObjectDefinitions(l,t.contracts.VisualContainer.CommonObjectDescriptors,f),h=a.getObjectDefinition(l,"visualLink",void 0);return h&&(d.visualLink.qna=h.properties.qna),d}function Q(e,t,r,i){var a={},o=null!=t;return a[n.transformProperty]=o?"scale("+t+")":"",a[n.widthProperty]=o?e.width:"",a[n.heightProperty]=o?e.height:"",a[n.borderProperty]=i||"",a[n.backgroundColorProperty]=r||"",a}function G(t){if(t&&t.show){var r=e.visuals.visualBackgroundHelper.getDefaultValues();return(t.transparency||0===t.transparency)&&(r.transparency=t.transparency),t.color&&(r.color=t.color),e.common.utils.ColorUtility.hexToRGBString(r.color.solid.color,(100-r.transparency)/100)}}function W(e){return null!=e&&null!=e.metadata&&null!=e.metadata.segment}function K(e){if(e&&e.defn){var t=e.defn.groupBy();return!_.isEmpty(t)}return!1}function X(e){return K(r.getVisualQuery(e))}function J(e,t,i){var n=r.getDataRolesForVisual(e,t),a=d(e);if(a&&!_.isEmpty(n)){var o=n[0].name,s=a.tryGetExprs(o);return!_.isEmpty(s)&&_.some(s,(function(e){var t=e.getMetadata(i);if(t)return t.type.text}))}}function $(e,t,r){var i=ae(e,r);if(_.isEmpty(i))return!1;for(var n=0,a=i;n<a.length;n++){var o=a[n];if(1===p.getAggregateBehavior(o,t))return!0}return!1}function Y(t){for(var r={},i=t.defn.select(),n=0,a=i;n<a.length;n++){var o=a[n],s=void 0;s=p.isMeasure(o.expr)?e.VisualDataRoleKind.Measure:e.VisualDataRoleKind.Grouping,r[o.name]=s}return r}function Z(e){for(var t=0,r=e.sections;t<r.length;t++){ee(r[t])}}function ee(e){for(var t=0,r=e.visualContainers;t<r.length;t++){var i=r[t];delete i.cachedData,i.disableCacheOnServerForInitialLoad=!0}}function te(e){for(var t=0,r=e.sections;t<r.length;t++)for(var i=r[t],n=0,a=i.visualContainers;n<a.length;n++){var o=a[n];o.disableCacheOnServerForInitialLoad=!0}}function re(e){var t=e.activeSectionIndex;(!_.isInteger(t)||t<0||t>=e.sections.length)&&(t=0);var r=e.sections[t],i=r&&r.visualContainers||[],n={};i=_.reject(i,(function(e){return f.isHidden(e.config.singleVisual)}));for(var a=0,o=i;a<o.length;a++){var s=o[a],l=s.config.singleVisual.visualType;n[l]||(n[l]=0),n[l]++}return n}function ie(e,i,n,a,o){if(t.FilterUtils.supportsVisualFilters(e,i,n)){var s=function(e){var r=0;return{name:void 0,expression:e,expanded:!1,howCreated:r,type:t.FilterUtils.getDefaultFilterType(e,a,r),isHiddenInViewMode:!0}},l=r.getSelectExprs(e);if(l)return _.chain(l).map((function(e){return e.expr})).filter((function(e){return p.isExprValidForFiltering(e)&&_.isEmpty(e.validate(a,o))})).map((function(e){return s(e)})).value()}}function ne(e,t,r,i){var n=r.getDrillCrossFiltersToApply(e,t,i),a=function(e){return{name:void 0,type:e.type,filter:e.filter,expression:e.expression,expanded:!1,howCreated:6,precedence:e.precedence}};return _.map(n,(function(e){return a(e)}))}function ae(t,r){var i=d(t);if(i){var n=g(t,r);if(n&&n.filterMappings&&n.filterMappings.measureFilter&&n.filterMappings.measureFilter.targetRoles){for(var a=n.filterMappings.measureFilter.targetRoles,o=_.chain(n.dataRoles).filter((function(t){return t.kind===e.VisualDataRoleKind.Grouping})).map((function(e){return e.name})).difference(a).value(),s=[],l=0,u=o;l<u.length;l++){var c=u[l];i.projections[c]&&s.push.apply(s,i.projections[c].all())}var p=h(t);return _.isEmpty(s)?void 0:_.chain(p).filter((function(e){return _.some(s,(function(t){return t.queryRef===e.name}))})).map((function(e){return e.expr})).value()}}}function oe(e,t){for(var r=0,i=0,n=e.sections;i<n.length;i++)for(var a=n[i],o=0,s=a.visualContainers;o<s.length;o++){var l=s[o];l.config.singleVisual.visualType===t.name&&++r}return r}function se(e){var t=e.resourcePackages;if(!t)return!1;for(var r=0,i=e.sections;r<i.length;r++){var n=i[r];if(n.visualContainers)for(var a=n.visualContainers,o=0,s=t;o<s.length;o++)for(var l=s[o],u=0,c=a;u<c.length;u++){var p=c[u];if(p.config&&p.config.singleVisual&&p.config.singleVisual.visualType){var f=p.config.singleVisual.visualType;if(l.name===f)return!0}}}return!1}function le(e){var t=e.objects;if(t&&t.outspacePane){var r=a.getValue(t,{objectName:"outspacePane",propertyName:"expanded"},null);return r&&r.value}}function ue(e){var t=e.objects;if(t&&t.outspacePane){var r=a.getValue(t,{objectName:"outspacePane",propertyName:"visible"},null);return r&&r.value}}function ce(e,t){var r=e.settings&&e.settings.useNewFilterPaneExperience;if(r){var i={usingImprovedFilterExperience:r,viewMode:0===t};if(!r)return i;var n=le(e);_.isUndefined(n)||(i.isOutspacePaneExpanded=n);var a=ue(e);return _.isUndefined(a)||(i.isOutspacePaneVisible=a),i}}function pe(e,t){return e.id&&!t}var fe=jsCommon.ArrayExtensions;r.DefaultTitleFontSizeInPixel=12,r.DefaultTitleFontFamily="'Segoe UI', wf_segoe-ui_normal, helvetica, arial, sans-serif",r.DefaultTitleFontSizeInPoints=jsCommon.PixelConverter.toPoint(r.DefaultTitleFontSizeInPixel),r.getVisualType=i,r.getVisualQuery=d,r.getSelectExprs=h,r.getFilterCapabilities=m,r.getVisualCapabilities=g,r.getDataRolesForVisual=y,r.getDataRolesForVisualPlugin=C,r.getNumberRangesForRoles=x,r.isScriptVisual=b,r.getObjectDefinitions=S,r.getContainerObjectDefinitions=E,r.getQueryName=w,r.describeForPinning=F,r.getRolesForDataViewMapping=P,r.toSemanticType=D,r.toConceptualDataCategory=R,r.hasGrouping=T,r.contractEqualityComparator=N,r.contractUnEqualityComparator=I,r.filterAffects=j,r.clearDataSelection=O,r.createCacheEntry=M,r.uniqueName=k,r.nextUniqueName=A,r.notifyVisualContainersExceptSource=B,r.notifyVisualContainers=z,r.hasOnPremDataSource=q,r.getTitleFontSize=L,r.getTitleHeight=U,r.evaluateObjectDefinitions=H,r.getVisualStyleAttributes=Q,r.getVisualBackgroundRGBColor=G,r.isSegment=W,r.hasGroupByItems=K,r.hasGroupByItemsInQuery=X,r.containSearchableField=J,r.hasFilterMappingWithNonAggregatableColumns=$,r.createRoleKindByQueryRef=Y,r.clearExplorationQueryCaches=Z,r.clearSectionQueryCaches=ee,r.markInitialLoadQueriesDirty=te,r.getVisualTypesAndCountsFromActiveSection=re,r.getAutoVisualFilterContainers=ie,r.getAutoCrossDrillVisualFilterContainers=ne,r.getVisualContainerCount=oe,r.containsCustomVisuals=se,r.getImprovedFilterExperienceTelemetry=ce,r.shouldUseQueryCache=pe})(i=r.VisualContainerUtils||(r.VisualContainerUtils={}))})(r=t.util||(t.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(r){var i,n=e.data.SQExpr,a=e.data.SQExprConverter,o=jsCommon.StringExtensions,s=e.explore.util.VisualContainerUtils;!(function(r){function i(e,r,i){if(!r||!r.column||!r.column.groupingMetadata)return t.services.GroupMode.None;if(i){var n=i.getGroupingDesignState(e,r.name);if(!n)return t.services.GroupMode.Basic;if(n.partitionTable)return t.services.GroupMode.Clustering;if(n.binItem)return t.services.GroupMode.Binning}return t.services.GroupMode.Basic}function l(e,r,n){var a=i(e,r,n);return a===t.services.GroupMode.Basic||a===t.services.GroupMode.Binning}function u(e,r,n){return i(e,r,n)===t.services.GroupMode.Clustering}function c(e,t,r){if(!t||!t.column||!t.column.groupingMetadata)return!1;var i=r.getGroupingDesignState(e,t.name);return!(!i||!i.groupItems&&!i.partitionTable)}function p(e,t){if(t&&f(e,t)&&(n.isColumn(t)||n.isGroupRef(t))){return d(t.getConceptualProperty(e))}return!1}function f(e,t){return S(e,t).capabilities.canEdit}function d(e){return e&&!!(e.type.dateTime||e.type.integer||e.type.numeric||e.type.text)}function h(e,t){return o.constructNameFromList(e,t.get("GroupDefinition_And"),j)}function v(e){if(e&&e.column&&e.column.keys){var t=e.column.keys;return 1===t.length&&t[0].name!==e.name||t.length>1}return!1}function m(e,t){var r=t&&t.defn.select();if(r&&r.length>0&&e)for(var i=0,n=e;i<n.length;i++){var a=n[i];if(!a||!a.dataMap)return;var o=Object.keys(a.dataMap),s=_.size(o);if(2===s){var l=r.withName(o[0]),u=r.withName(o[1]);if(l&&u)return N(l.expr,u.expr)}}}function g(e,t){_.some(e,(function(e){return e.blankDefaultPlaceholder}))||e.splice(0,0,{name:t.get("NullValue"),blankDefaultPlaceholder:!0})}function y(e){return _.filter(e,(function(e){return!e.blankDefaultPlaceholder}))}function C(t,r,i){var n=[],a=s.getVisualCapabilities(t,r);if(a&&a.grouping)for(var o=s.getVisualQuery(t),l=o.projections,u=s.createRoleKindByQueryRef(o),c=_.filter(a.grouping.groupingRules,(function(e){return e.kind===i})),p=0,f=c;p<f.length;p++){var d=f[p],h=e.DataViewAnalysis.checkForConditionErrors(l,d.condition,u,!1);_.isEmpty(h)&&n.push(d)}return n}function x(t,r,i){var n=a.asFieldPattern(t);if(n.groupingColumn)return _.map(n.groupingColumn.groupedColumns,(function(t){return e.data.SQExprBuilder.fieldExpr(t)}));if(n.column){var o=r.schema(n.column.schema),s=o.findProperty(n.column.entity,n.column.name);if(c(n.column.entity,s,i)){var l=t.getTargetEntity();return b(s.column.groupingMetadata,l)}}}function b(t,r){return _.map(t.groupedColumns,(function(t){if(R(t))return e.data.SQExprBuilder.columnRef(r,t.name)}))}function S(t,r){var i=e.data.FieldExprPattern.getSchema(a.asFieldPattern(r));return t.schema(i)}function E(e,t){var r=t&&t.defn.select();if(!_.isEmpty(r)&&!_.isEmpty(e)){for(var i=0,a=e;i<a.length;i++){var o=a[i];if(!o||!o.dataMap)return!1;var s=Object.keys(o.dataMap),l=_.size(o.dataMap);if(l>2)return!1;if(2===l){var u=r.withName(s[0]),c=r.withName(s[1]);if(u&&c&&!T(u.expr,c.expr))return!1}else if(1===l){var p=r.withName(s[0]);if(p&&!n.isColumn(p.expr)&&!n.isGroupRef(p.expr))return!1}}return!0}return!1}function w(e){return e.dateTime?t.services.GroupDataType.DateTime:e.numeric?t.services.GroupDataType.Number:t.services.GroupDataType.Category}function F(e){switch(e){case 4:return 3;case 6:return 2;case 8:return 0;case 9:return 7;case 10:return 6;case 11:return 5}}function V(e){switch(e){case 3:return 4;case 2:return 6;case 0:return 8;case 7:return 9;case 6:return 10;case 5:return 11}}function P(e){if(!e.get()){var r,i={dbName:"dbName",id:1,vsName:"vsName"},n=[{type:"dsr",id:i.id,name:r,dsr:{schemaName:r,vsName:i.vsName,dbName:i.dbName}}],a=t.contracts.createDataSourceArray(n);e.set(a)}}function D(t,r){var i=r.getDetails(e.common.localize);t.error(i.message,"GroupDialog",{debugErrorInfo:i.debugErrorInfo,displayableErrorInfo:i.displayableErrorInfo,helpLink:i.helpLink})}function R(e){return 0===e.kind}function T(e,t){return!!N(e,t)}function N(e,t){if(n.isGroupRef(e)&&n.isColumn(t)&&I(e,t))return e;if(n.isGroupRef(t)&&n.isColumn(e)&&I(t,e))return t;if(n.isGroupRef(e)&&n.isGroupRef(t)){if(I(e,t))return e;if(I(t,e))return t}}function I(t,r){return e.data.SQExprUtils.sequenceEqual(t.groupedExprs,[r])}var j=50;r.getGroupMode=i,r.isGroupOrBinColumn=l,r.isClusteringColumn=u,r.isGroupOrClusteringColumn=c,r.canExprBeGrouped=p,r.canEditSchema=f,r.canPropertyBeGrouped=d,r.generateGroupDisplayName=h,r.hasGroupOnKeys=v,r.findGroupingColumn=m,r.ensureBlankDefaultPlaceholder=g,r.filterOutBlankDefaultPlaceholder=y,r.getValidGroupingRules=C,r.getGroupedColumns=x,r.getGroupedColumnsFromMetadata=b,r.getConceptualSchema=S,r.canGroup=E,r.getGroupDataType=w,r.convertToTimeUnit=F,r.convertToBinUnit=V,r.ensureDataSources=P,r.showQueryError=D})(i=r.GroupUtils||(r.GroupUtils={}))})(r=t.utils||(t.utils={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){var r=e.data.SQExpr,i=(function(){function e(e){this.key=[],this.value=[],this.comparer=e}return e.prototype.add=function(e,t){this.key.push(e),this.value.push(t)},e.prototype.get=function(e){if(r.isHierarchyLevel(e))for(var t=0;t<this.key.length;t++)if(this.comparer(this.key[t],e))return this.value[t]},e})();t.SQExprToRoleDictionary=i})(r=t.utils||(t.utils={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){function t(){return{getFormatInfo:function(){return r},getAllCurrencySymbolCustomFormatItemsInfo:function(){return[]},getAllDateTimeFormatItemsInfo:function(){return[]}}}e.createCultureService=t;var r={lcid:1033,displayName:"English (United States)",currencyDecimalDigits:2,numberDecimalDigits:2,percentDecimalDigits:2,percentSymbol:"%",percentPositivePattern:0,percentNegativePattern:0,currencySymbol:"$",currencyPositivePattern:0,currencyNegativePattern:0,shortDatePattern:"M/d/yyyy",longDatePattern:"dddd, MMMM d, yyyy",fullDateTimePattern:"dddd, MMMM d, yyyy h:mm:ss tt",monthDayPattern:"MMMM d",rfc1123Pattern:"ddd, dd MMM yyyy HH':'mm':'ss 'GMT'",sortableDateTimePattern:"yyyy'-'MM'-'dd'T'HH':'mm':'ss",shortTimePattern:"h:mm tt",longTimePattern:"h:mm:ss tt",universalSortableDateTimePattern:"yyyy'-'MM'-'dd HH':'mm':'ss'Z'",yearMonthPattern:"MMMM yyyy"}})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){function t(){return new r}e.createDataSourcesService=t;var r=(function(){function e(){}return e.prototype.set=function(e){this.dataSources=e},e.prototype.get=function(){return this.dataSources},e})()})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){function t(e){return new r(e)}e.createDaxParserService=t;var r=(function(){function e(e){this.promiseFactory=e}return e.prototype.getMeasureReferences=function(e,t){var r=_.isArray(t)?_.map(t,(function(){return{measures:[],unrecognizedReferences:!1}})):[];return this.promiseFactory.resolve(r)},e.prototype.renameMeasureReferences=function(e,t,r,i){var n=_.map(t,(function(e){return e.expression}));return this.promiseFactory.resolve(n)},e.prototype.renameMovedMeasureTableReference=function(e,t,r,i,n){var a=_.map(t,(function(e){return e.expression}));return this.promiseFactory.resolve(a)},e})()})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(r){function i(e,t,r){return new v(e,t,r)}function n(e,t,r,i){if(!r||!r.includeDefaultAggregate)return i.defaultAggregate(e,t,!1)===e.func}function a(e,t,r,i){var n=s(t,r),a=i.aggregateDisplayNames[n];return p.format(a,[e])}function o(e,t,r){if(!_.isEmpty(e)){if(1===e.length)return e[0];var i=e.pop();return h.format(r.stringResourceProvider.get(t),e.length>1?e.join(r.stringResourceProvider.get("ListJoin_Separator")):e[0],i)}return null}function s(t,r){var i=e.data.aggregateFunctionName(t);return(3===t||4===t)&&r&&r.type&&(r.type.dateTime?i="Date"+i:r.type.text&&(i="String"+i)),i}var l=e.data.DataViewObjectDefinitions,u=e.data.FieldExprPattern,c=e.data.FilterPattern,p=e.formattingService,f=e.data.SQExpr,d=e.data.SQExprBuilder,h=jsCommon.StringExtensions;r.createDisplayNameService=i;var v=(function(){function i(e,t,r){this.locOptions=e,this.aggrOps=t,this.featureSwitches=r}return i.prototype.getOriginalDisplayName=function(t,r,i,n){if(e.data.SQExprConverter.asFieldPattern(t,r))return u.visit(t,new m(r,this.locOptions,this.aggrOps,i,n),r)},i.prototype.getDisplayName=function(e,t,r,i,n,a){if(n&&i){var o=n[i];if(o&&o.displayName)return o.displayName}return this.getOriginalDisplayName(e,t,r,a)},i.prototype.getQualifiedDisplayName=function(t,r,i,n){if(e.data.SQExprConverter.asFieldPattern(t,r))return g.run(t,r,this.locOptions,this.aggrOps,i,n)},i.prototype.getFilterRestatement=function(t,i,n,a){var o=e.data.SQFilterConverter.asFilterPattern(t,i);if(o&&o[0])return c.visit(o[0],new r.FilterRestatementVisitor(i,this.locOptions,this.aggrOps,n,a))},i.prototype.getFilterRestatementForOverlay=function(t,i,n,a,o){var s=this,l=e.data.SQFilterConverter.asFilterPattern(t.filter,i);if(l&&l[0])return l.map((function(e){return e.condition&&e.condition.complex&&t.restatement?{fieldName:"",restatements:[t.restatement],fieldNameToolTip:""}:c.visit(e,new r.FilterOverlayRestatementVisitor(i,s.locOptions,s.aggrOps,n,a,t,null,o,s.featureSwitches))}))},i.prototype.getQualifiedFilterRestatement=function(t,i,n,a){var o=e.data.SQFilterConverter.asFilterPattern(t,i);if(o&&o[0])return c.visit(o[0],new r.FilterRestatementVisitor(i,this.locOptions,this.aggrOps,n,a,(!0)))},i.prototype.getVisualTitle=function(r,i,n,a){var o=e.Prototype.inherit(r||{show:a&&!a.suppressDefaultTitle});if(t.contracts.VisualTitle.isHidden(o))return r;if(null==o.show&&(o.show=!(!a||a.suppressDefaultTitle)),void 0!==o.text)return o;var s=o.titleComponents=this.getRawTitleComponents(i,n,a);return o.text=this.getTitleText(i,n,a,s),this.formatTitleComponents(s),o},i.prototype.getTitleText=function(e,t,r,i){var n;return i=i||this.getRawTitleComponents(e,t,r),n=i.subtitle?h.format(this.locOptions.stringResourceProvider.get("VisualTitle_By_Template"),i.title,i.subtitle):i.title},i.prototype.getTitleComponents=function(e,t,r){var i=this.getRawTitleComponents(e,t,r);return this.formatTitleComponents(i),i},i.prototype.formatTitleComponents=function(e){e.subtitle&&(e.subtitle=h.format(this.locOptions.stringResourceProvider.get("VisualTitle_By_Template"),"",e.subtitle).trim())},i.prototype.getRawTitleComponents=function(e,t,r){var i=l.getValue(e.vcObjects,{objectName:"title",propertyName:"text"},void 0);if(i)return{title:i.value};var n=[],a=[];if(e&&e.query){var s=e.query;if(s.projections&&r&&!r.suppressDefaultTitle&&r.dataRoles)for(var u=0,c=r.dataRoles;u<c.length;u++){var p=c[u];this.populateDisplayNamesByDataRole(p,s,t,r,e.columnProperties,n,a)}}var f={},d="AndConjunction";return n.length>0?(f.title=o(n,d,this.locOptions),a.length>0&&(f.subtitle=o(a,d,this.locOptions))):a.length>0&&(f.title=o(a,d,this.locOptions)),f},i.prototype.getDescription=function(e,t){return y.run(e,t)},i.prototype.populateDisplayNamesByDataRole=function(t,r,n,a,o,s,l){var u=r.defn.select(),c=r.projections[t.name];if(c)for(var p=_.isEmpty(c.activeProjectionRefs)?_.map(c.all(),(function(e){return e.queryRef})):c.activeProjectionRefs,f=0,d=p;f<d.length;f++){var h=d[f],v=u.withName(h);if(v&&v.expr){var m=this.getDisplayName(v.expr,n,a,h,o);t.kind===e.VisualDataRoleKind.Grouping?l.push(m):t.kind===e.VisualDataRoleKind.Measure?s.push(m):i.isRoleUsedAsGroup(t,r,n)?l.push(m):s.push(m)}}},i.isRoleUsedAsGroup=function(e,t,r){var i=t.projections[e.name];if(i){var n=_.head(i.all()),a=t.defn.select().withName(n.queryRef).expr,o=a.getMetadata(r);if(o)return 0===o.kind}return!1},i})(),m=(function(){function t(e,t,r,i,n){this.schema=e,this.locOptions=t,this.aggrOps=r,this.visualCapabilities=i,this.displayOptions=n}return t.prototype.visitColumn=function(e){return t.getDisplayNameForProperty(e,this.schema)},t.prototype.visitColumnAggr=function(e){return t.getDisplayNameForSQAggregate(e,d.fromColumnAggr(e),this.schema,this.locOptions,this.visualCapabilities,this.aggrOps,this.displayOptions)},t.prototype.visitGroupingColumn=function(e){return t.getDisplayNameForProperty(e,this.schema)},t.prototype.visitGroupingColumnAggr=function(e){return t.getDisplayNameForSQAggregate(e,d.fromGroupingColumnAggr(e),this.schema,this.locOptions,this.visualCapabilities,this.aggrOps,this.displayOptions)},t.prototype.visitColumnHierarchyVariation=function(e){return t.getVariationHierarchyName(e,this.schema,this.displayOptions,this.locOptions.stringResourceProvider)},t.prototype.visitColumnHierarchyLevelVariation=function(e){return t.getVariationLevelName(e,this.schema,this.displayOptions,this.locOptions.stringResourceProvider)},t.prototype.visitEntity=function(e){return t.getDisplayNameForEntity(e,this.schema)},t.prototype.visitEntityAggr=function(e){return t.getDisplayNameForSQAggregate(e,d.fromEntityAggr(e),this.schema,this.locOptions,this.visualCapabilities,this.aggrOps,this.displayOptions)},t.prototype.visitHierarchy=function(e){return t.getDisplayNameForHierarchy(e,this.schema)},t.prototype.visitHierarchyLevel=function(e){return t.getDisplayNameForHierarchyLevel(e,this.schema,this.displayOptions,this.locOptions.stringResourceProvider)},t.prototype.visitHierarchyLevelAggr=function(e){return t.getDisplayNameForSQAggregate(e,d.fromHierarchyLevelAggr(e),this.schema,this.locOptions,this.visualCapabilities,this.aggrOps,this.displayOptions)},t.prototype.visitMeasure=function(e){return t.getDisplayNameForProperty(e,this.schema)},t.prototype.visitSelectRef=function(e){},t.prototype.visitPercentile=function(e){var t=this.locOptions.showValueAsDisplayNames;return p.format(e.exclusive?t.PercentileExclusive:t.PercentileInclusive,[u.visit(e.arg,this),e.k])},t.prototype.visitPercentOfGrandTotal=function(e){return p.format(this.locOptions.showValueAsDisplayNames.PercentOfGrandTotal,[u.visit(e.baseExpr,this)])},t.prototype.visitPercentOfRoleTotal=function(t){if(this.visualCapabilities&&this.visualCapabilities.dataRoleTotals){var r=this.visualCapabilities.dataRoleTotals,i=_.find(r,(function(e){return _.isEqual(t.roles,e.roles)}));if(i){var n=e.data.getDisplayName(i.shortDisplayName,this.locOptions.stringResourceProvider);return p.format(n,[u.visit(t.baseExpr,this)])}}},t.prototype.visitTransformOutputRoleRef=function(e){return e.expressionName},t.prototype.visitFilteredEval=function(e){for(var t=this.locOptions.stringResourceProvider.get("VisualTitle_For_Template"),i=u.visit(e.baseExpr,this),n=new r.FilterRestatementVisitor(this.schema,this.locOptions,this.aggrOps,this.visualCapabilities,this.displayOptions),a=[],s=0,l=e.filters;s<l.length;s++){var f=l[s],d=c.visit(f,n);null!=d&&a.push(d)}if(!_.isEmpty(a)){var h=o(a,"FilterRestatement_CompoundAnd",this.locOptions);return p.format(t,[i,h])}},t.getDisplayNameForEntity=function(e,t){var r=t.schema(e.schema).entities.withName(e.entity);if(r)return r.displayName},t.getDisplayNameForProperty=function(e,t){var r=t.schema(e.schema),i=r.findProperty(e.entity,e.name);if(i)return i.displayName},t.getDisplayNameForHierarchyLevel=function(e,t,r,i){var n=t.schema(e.schema),a=n.findHierarchy(e.entity,e.name);if(a){var o=a.levels.withName(e.level);if(o){var s=o.displayName||o.column.displayName;if(r&&r.includeHierarchyName&&i){var l=a.displayName;s=h.format(i.get("IncludeVariationSourceDisplayName"),l,s)}return s}}},t.getDisplayNameForHierarchy=function(e,t){var r=t.schema(e.schema),i=r.findHierarchy(e.entity,e.name);if(i)return i.displayName},t.getVariationHierarchyName=function(e,t,r,i){var n=t.schema(e.source.schema).findProperty(e.source.entity,e.source.name);if(n)for(var a=n.column.variations,o=0,s=a;o<s.length;o++){var l=s[o],u=l.defaultHierarchy;if(l.name===e.variationName&&u&&u.name===e.hierarchy.name){var c=u.displayName;return r&&r.includeVariationSource&&i?h.format(i.get("IncludeVariationSourceDisplayName"),n.displayName,c):c}}},t.getVariationLevelName=function(e,t,r,i){var n=t.schema(e.source.schema).findProperty(e.source.entity,e.source.name);if(n)for(var a=n.column.variations,o=0,s=a;o<s.length;o++){var l=s[o];if(l.name===e.variationName)for(var u=0,c=l.defaultHierarchy.levels;u<c.length;u++){var p=c[u];if(p.name===e.level.level){var f=p.column.displayName;return r&&r.includeVariationSource&&i?h.format(i.get("IncludeVariationSourceDisplayName"),n.displayName,f):f}}}},t.getDisplayNameForSQAggregate=function(e,r,i,o,s,l,c){var p=i.schema(e.schema).entities.withName(e.entity);if(p){var f=u.visit(r.arg,new t(i,o,l,s,c));return f?n(r,i,c,l)?f:a(f,r.func,r.arg.getMetadata(i),o):a(p.displayName,r.func,r.arg.getMetadata(i),o)}},t})();r.DisplayNameServiceVisitor=m;var g=(function(){function t(e,t,r,i,n){this.schema=e,this.locOptions=t,this.aggrOps=r,this.visualCapabilities=i,this.displayOptions=n}return t.run=function(e,r,i,n,a,o){return new t(r,i,n,a,o).accept(e,r)},t.prototype.accept=function(e,t){var r=e;if(f.isAggregation(r)){var i=u.visit(r.arg,this);return n(r,this.schema,this.displayOptions,this.aggrOps)?i:a(i,r.func,r.arg.getMetadata(this.schema),this.locOptions)}return u.visit(e,this,t)},t.prototype.visitEntity=function(e){var t=m.getDisplayNameForEntity(e,this.schema);return this.formatWithEntity(t,e)},t.prototype.visitColumn=function(e){var t=m.getDisplayNameForProperty(e,this.schema);return this.formatWithEntity(t,e)},t.prototype.visitColumnAggr=function(e){},t.prototype.visitGroupingColumn=function(e){var t=m.getDisplayNameForProperty(e,this.schema);return this.formatWithEntity(t,e)},t.prototype.visitGroupingColumnAggr=function(e){},t.prototype.visitColumnHierarchyVariation=function(e){var t=m.getVariationHierarchyName(e,this.schema,this.displayOptions,this.locOptions.stringResourceProvider);return this.formatWithEntity(t,e.source)},t.prototype.visitColumnHierarchyLevelVariation=function(e){var t=m.getVariationLevelName(e,this.schema,this.displayOptions,this.locOptions.stringResourceProvider);return this.formatWithEntity(t,e.source)},t.prototype.visitEntityAggr=function(e){var t=m.getDisplayNameForSQAggregate(e,d.fromEntityAggr(e),this.schema,this.locOptions,this.visualCapabilities,this.aggrOps,this.displayOptions);return this.formatWithEntity(t,e)},t.prototype.visitHierarchy=function(e){var t=m.getDisplayNameForHierarchy(e,this.schema);return this.formatWithEntity(t,e)},t.prototype.visitHierarchyLevel=function(e){var t=m.getDisplayNameForHierarchyLevel(e,this.schema,this.displayOptions,this.locOptions.stringResourceProvider);return this.formatWithEntity(t,e)},t.prototype.visitHierarchyLevelAggr=function(e){},t.prototype.visitMeasure=function(e){
var t=this.locOptions.qualifiedDisplayNameTemplate,r=m.getDisplayNameForProperty(e,this.schema),i=m.getDisplayNameForEntity(e,this.schema);return i?h.format(t,i,r):r},t.prototype.visitSelectRef=function(e){},t.prototype.visitPercentile=function(e){var t=this.locOptions.showValueAsDisplayNames;return p.format(e.exclusive?t.PercentileExclusive:t.PercentileInclusive,[this.accept(d.fieldExpr(e.arg)),e.k])},t.prototype.visitPercentOfGrandTotal=function(e){return p.format(this.locOptions.showValueAsDisplayNames.PercentOfGrandTotalTooltip,[this.accept(d.fieldExpr(e.baseExpr))])},t.prototype.visitPercentOfRoleTotal=function(t){var r=this.visualCapabilities.dataRoleTotals,i=_.find(r,(function(e){return _.isEqual(t.roles,e.roles)})),n=e.data.getDisplayName(i.tooltip,this.locOptions.stringResourceProvider);return p.format(n,[this.accept(d.fieldExpr(t.baseExpr))])},t.prototype.visitTransformOutputRoleRef=function(e){return e.expressionName},t.prototype.visitFilteredEval=function(e){for(var t=this.locOptions.stringResourceProvider.get("VisualTitle_For_Template"),i=this.accept(d.fieldExpr(e.baseExpr)),n=[],a=new r.FilterRestatementVisitor(this.schema,this.locOptions,this.aggrOps,this.visualCapabilities,this.displayOptions,(!0)),s=0,l=e.filters;s<l.length;s++){var u=l[s],f=c.visit(u,a);null!=f&&n.push(f)}if(!_.isEmpty(n)){var h=o(n,"FilterRestatement_CompoundAnd",this.locOptions);return p.format(t,[i,h])}},t.prototype.formatWithEntity=function(e,t){var r=this.locOptions.qualifiedDisplayNameTemplate,i=m.getDisplayNameForEntity(t,this.schema);return i?h.format(r,i,e):e},t})();r.QualifiedDisplayNameVisitor=g;var y=(function(){function e(e){this.schema=e}return e.run=function(t,r){var i=new e(r);return u.visit(t,i)},e.prototype.visitColumn=function(e){return this.getPropertyDescription(e)},e.prototype.visitColumnAggr=function(e){return this.getPropertyDescription(e)},e.prototype.visitGroupingColumn=function(e){return this.getPropertyDescription(e)},e.prototype.visitGroupingColumnAggr=function(e){return this.getPropertyDescription(e)},e.prototype.visitColumnHierarchyVariation=function(e){var t=e.hierarchy,r=this.findHierarchy(t);if(r)return r.description},e.prototype.visitColumnHierarchyLevelVariation=function(e){return this.getHierarchyLevelDescription(e.level)},e.prototype.visitEntity=function(e){return this.getEntityDescription(e)},e.prototype.visitEntityAggr=function(e){return this.getEntityDescription(e)},e.prototype.visitHierarchy=function(e){var t=this.findHierarchy(e);if(t)return t.description},e.prototype.visitHierarchyLevel=function(e){return this.getHierarchyLevelDescription(e)},e.prototype.visitHierarchyLevelAggr=function(e){return this.getHierarchyLevelDescription(e)},e.prototype.visitMeasure=function(e){return this.getPropertyDescription(e)},e.prototype.visitPercentile=function(e){return u.visit(e.arg,this)},e.prototype.visitPercentOfGrandTotal=function(e){return u.visit(e.baseExpr,this)},e.prototype.visitPercentOfRoleTotal=function(e){return u.visit(e.baseExpr,this)},e.prototype.visitSelectRef=function(e){},e.prototype.visitTransformOutputRoleRef=function(e){},e.prototype.visitFilteredEval=function(e){},e.prototype.getPropertyDescription=function(e){var t=this.schema.schema(e.schema);if(t){var r=t.findProperty(e.entity,e.name);return r&&r.description}},e.prototype.getEntityDescription=function(e){var t=this.schema.schema(e.schema);if(t){var r=t.entities.withName(e.entity);return r&&r.description}},e.prototype.getHierarchyLevelDescription=function(e){var t=this.findHierarchy(e);if(t){var r=t.levels.withName(e.level);return r&&r.description}},e.prototype.findHierarchy=function(e){var t=this.schema.schema(e.schema);if(t)return t.findHierarchy(e.entity,e.name)},e})();r.concatStrings=o,r.getAggregateKey=s})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){e[e.Unknown=0]="Unknown",e[e.Swipe=1]="Swipe"})(t=e.SectionNavigationAction||(e.SectionNavigationAction={}));var r;!(function(e){e.explorationLoaded={type:1,name:"explorationLoaded"},e.explorationUnloaded={type:1,name:"explorationUnloaded"},e.explorationSlowDataSourceSettingsLoaded={type:1,name:"explorationSlowDataSourceSettingsLoaded"},e.explorationSettingsLoaded={type:1,name:"explorationSettingsLoaded"},e.filterContainerChanged={type:2,name:"filterContainerChanged"},e.topNFilterOrderByChanged={type:2,name:"topNFilterOrderByChanged"},e.explorationFiltersContainerChanged={type:1,name:"explorationFiltersContainerChanged"},e.sectionFiltersContainerChanged={type:1,name:"sectionFiltersContainerChanged"},e.sectionDrillthroughLinkChanged={type:1,name:"sectionDrillthroughLinkChanged"},e.formFactorChanged={type:1,name:"formFactorChanged"},e.canvasLayoutChanged={type:1,name:"canvasLayoutChanged"},e.modelChanged={type:0,name:"modelChanged"},e.enableEditing={type:1,name:"enableEditing"},e.visualRelationshipsModeChanged={type:2,name:"visualRelationshipsModeChanged"},e.schemaItemActivationChanged={type:0,name:"schemaItemActivationChanged"},e.selectionChanged={type:2,name:"selectionChanged"},e.dataPointsSelected={type:2,name:"dataPointsSelected"},e.undoRedoStackUpdated={type:1,name:"undoRedoStackUpdated"},e.undoRedoStackCleared={type:1,name:"undoRedoStackCleared"},e.onReportChanged={type:1,name:"onReportChanged"},e.clipboardDataUpdated={type:1,name:"clipboardDataUpdated"},e.dataSelectionChanged={type:2,name:"dataSelectionChanged"},e.drillModeChanged={type:2,name:"drillModeChanged"},e.refreshExploration={type:2,name:"refreshExploration"},e.clearAnnotations={type:2,name:"clearAnnotations"},e.saveReportCompleted={type:0,name:"saveReportCompleted"},e.customSaveAsTriggered={type:0,name:"customSaveAsTriggered"},e.markAsDateTable={type:0,name:"markAsDateTable"},e.editDateTable={type:0,name:"editDateTable"},e.sectionLayoutRemoved={type:1,name:"sectionLayoutRemoved"},e.canvasChanged={type:1,name:"canvasChanged"},e.visualContainerChanged={type:2,name:"visualContainerChanged"},e.visualContainerDataRendered={type:2,name:"visualContainerDataRendered"},e.visualContainerPositionChanged={type:2,name:"visualContainerPositionChanged"},e.visualContainerLoadingStarted={type:2,name:"visualContainerLoadingStarted"},e.visualContainerLoadingStopped={type:2,name:"visualContainerLoadingStopped"},e.visualConversion={type:2,name:"visualConversion"},e.canvasSizeChangedEvent={type:2,name:"canvasSizeChanged"},e.visualPluginsChanged={type:2,name:"visualPluginsChanged"},e.addCustomVisual={type:2,name:"addCustomVisual"},e.deleteCustomVisual={type:2,name:"deleteCustomVisual"},e.modelingContextChanged={type:0,name:"modelingContextChanged"},e.changeViewMode={type:2,name:"changeViewMode"},e.requestViewModeChange={type:2,name:"requestViewModeChange"},e.changeEditMode={type:2,name:"changeEditMode"},e.saveKeyPressedEvent={type:1,name:"saveEventViaCtrlS"},e.highContrastModeChanged={type:1,name:"highContrastModeChanged"},e.canvasDisplayChanged={type:1,name:"canvasDisplayChanged"},e.canvasDimensionChanged={type:1,name:"canvasDimensionChanged"},e.canvasBackgroundChanged={type:1,name:"canvasBackgroundChanged"},e.explorationObjectsLoaded={type:3,name:"explorationObjectsLoaded"},e.explorationObjectsChanged={type:3,name:"explorationObjectsChanged"},e.visibilityChanged={type:2,name:"visibilityChanged"},e.align={type:1,name:"align"},e.deleteSectionInitiated={type:1,name:"deleteSectionInitiated"},e.sectionNameChanged={type:1,name:"sectionNameChanged"},e.sectionDeleted={type:1,name:"sectionDeleted"},e.renameSection={type:1,name:"renameSection"},e.sectionChanged={type:1,name:"sectionChanged"},e.podParameterChanged={type:1,name:"podParameterChanged"},e.missingTableRelationship={type:2,name:"missingTableRelationship"},e.addVisualContainer={type:1,name:"addVisualContainer"},e.deleteVisualContainer={type:2,name:"deleteVisualContainer"},e.addInsightContainer={type:1,name:"addInsightContainer"},e.addQnaContainer={type:1,name:"addQnaContainer"},e.showQnaPopout={type:1,name:"showQnaPopoutEventArgs"},e.canvasPinched={name:"canvasPinched",type:1},e.changeFormFactor={name:"changeFormFactor",type:1},e.arrangeVisualsOrder={type:1,name:"arrangeVisualsOrder"},e.createImage={type:1,name:"createImage"},e.createBasicShape={type:1,name:"createBasicShape"},e.createActionButton={type:1,name:"createActionButton"},e.createTextbox={type:1,name:"createTextbox"},e.importVisual={type:1,name:"importVisual"},e.installVisual={type:1,name:"installVisual"},e.downloadVisual={type:1,name:"downloadVisual"},e.visualContainerQueryBlocked={type:2,name:"visualContainerQueryBlocked"},e.newQueryCacheResultAvailable={type:2,name:"newQueryCacheResultAvailable"},e.exportVisualData={type:2,name:"exportVisualData"},e.reportSlidesChanged={type:1,name:"reportSlidesChanged"},e.createSection={type:1,name:"createSection"},e.deleteSection={type:1,name:"deleteSection"},e.duplicateSection={type:1,name:"duplicateSection"},e.copyTable={type:1,name:"copyDataTable"},e.showEnableScriptVisualsDialog={type:2,name:"showEnableScriptVisualsDialog"},e.CanvasResized={type:1,name:"canvasResized"},e.bookmarkApplied={type:1,name:"bookmarkApplied"},e.reportVisualError={name:"ReportVisualError"},e.removeVisualContainerFromLayout={name:"removeVisualContainerFromLayout"},e.toggleSortVisualContainer={name:"toggleSortVisualContainer"},e.filterValueChanged={name:"filterValueChanged"},e.reorderSection={name:"reorderSection"},e.saveAsExploration={name:"saveAsExploration"},e.generateReportQR={name:"generateReportQR"},e.saveExploration={name:"saveExploration"},e.switchSection={name:"switchSection"},e.pauseQueriesChanged={name:"pauseQueriesChanged"},e.redo={name:"redo"},e.undo={name:"undo"},e.deleteVisual={name:"deleteVisual"},e.deleteCustomVisuals={name:"deleteCustomVisuals"},e.exportToPowerPoint={name:"exportToPowerPoint"},e.exportAsImage={name:"exportAsImage"},e.getClusters={name:"getClusters"},e.resetPersistentUserState={name:"resetPersistentUserState"},e.reloadPersistenState={name:"reloadPersistenState"},e.togglePaneVisibility={type:1,name:"togglePaneVisibility"},e.visualDrillFilterOtherVisualsSettingChanged={type:2,name:"visualDrillFilterOtherVisualsSettingChanged"},e.emulationChanged={type:0,name:"emulationChanged"},e.focusGroupChanged={type:0,name:"focusGroupChanged"},e.showOtherBookmarks={type:3,name:"showOtherBookmarks"},e.parentExpandCollapseAction={type:2,name:"parentExpandCollapseAction"},e.bookmarkViewStateChanged={type:3,name:"bookmarkViewStateChanged"},e.visualContainerOptionsMenuOpened={type:2,name:"visualContainerOptionsMenuOpened"}})(r=e.events||(e.events={}))})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(r){function i(e,t){return new s(e,t)}var n=e.data.ExpansionState,a=e.data.Selector,o=t.util.VisualContainerUtils;r.createExpandCollapseService=i;var s=(function(){function t(e,t){this.visualPlugin=e,this.featureSwitch=t}return t.prototype.getExpandCollapseRoles=function(t){e.contract.checkValue(t,"visual should have a value");var r=this.visualPlugin.capabilities(o.getVisualType(t));if(r&&r.expandCollapse&&!_.isEmpty(r.expandCollapse.roles))return r.expandCollapse.roles},t.prototype.isSupported=function(e,t,r){if(!(this.featureSwitch.featureSwitches.expandCollapse&&t&&e&&e.supportsInstanceFilters))return!1;var i=o.getVisualQuery(t);return!!i&&!(!_.isEmpty(r)&&_.some(r,(function(e){return 3===i.currentDrillMode(e)})))},t.prototype.isEnabled=function(t,r){if(e.contract.checkValue(t,"visual should have a value"),_.isEmpty(r))return!1;if(!this.featureSwitch.featureSwitches.expandCollapse)return!1;var i=this.getExpandCollapseRoles(t);return!_.isEmpty(i)&&!_.some(r,(function(e){return _.indexOf(i,e)===-1}))},t.prototype.getMaximumExpansionDepth=function(e,t){if(this.isEnabled(e,t)){var r=o.getVisualQuery(e);if(r){var i=r.getRolesProjectionRefs(t);return i.length}}},t.prototype.getAllowedActions=function(e,t,r){var i=o.getVisualQuery(e);if(i&&this.isEnabled(e,t)&&!_.isEmpty(r)&&1===r.length){var s=r[0];if(s&&s.dataMap&&!_.isEmpty(s.dataMap)){var l=a.toScopeIdentities(a.convertSelectorsByColumnToSelector(s));if(!_.isEmpty(l)){var u=i.getRolesUniqueProjectionRefs(t),c=i.getRolesUniqueActiveProjectionsRefs(t),p=c.length===u.length,f=_.some(t,(function(e){return 3===i.currentDrillMode(e)}));if(1===u.length||f)return{};var d=this.getSelectorRefs(s);if(!_.some(d,(function(e){return!_.includes(c,e)}))){var h=l.length,v=h===u.length,m=h===c.length,g=n.findExpansionState(i.expansionStates,t);if(g){var y=g.getNodeLevelState(l,g.root,0);return{expandNode:!v&&!!y.isNodeCollapsed,collapseNode:!m&&!y.isNodeCollapsed,expandLevel:!v&&(y.levelHasToggledNodes||!!y.isNodeCollapsed),collapseLevel:!m&&(y.levelHasToggledNodes||!y.isNodeCollapsed),expandHierarchy:!p||!g.isHierarchyExpanded(),collapseHierarchy:!g.isWholeLevelCollapsed(0)}}return{expandNode:!v&&m,collapseNode:!m,expandLevel:!v&&m,collapseLevel:!m,expandHierarchy:!p,collapseHierarchy:c.length>1}}}}}},t.prototype.getSelectorRefs=function(e){if(e&&e.dataMap&&!_.isEmpty(e.dataMap)){var t=[];for(var r in e.dataMap)t.push(r);return t}},t.prototype.expandNode=function(e,t,r){var i=this.setNodeState(e,t,r,!1);if(i){var n=this.ensureExpansionState(e,t),a=this.getSelectorRefs(r),s=a.length-1,l=this.getVisibleDescendentsDepth(n,i,s),u=o.getVisualQuery(e);if(u){l>u.getRolesUniqueActiveProjectionsRefs(t).length&&this.setActiveProjections(e,t,l)}}},t.prototype.collapseNode=function(e,t,r){this.setNodeState(e,t,r,!0);var i=this.ensureExpansionState(e,t),n=this.getVisibleDescendentsDepth(i,i.root,-1);this.setActiveProjections(e,t,n)},t.prototype.expandLevel=function(e,t,r,i){void 0===i&&(i=!1),this.setLevelState(e,t,r,!1,i);var n=this.ensureExpansionState(e,t),a=this.getVisibleDescendentsDepth(n,n.root,-1);this.setActiveProjections(e,t,a)},t.prototype.collapseLevel=function(e,t,r,i){void 0===i&&(i=!1),this.setLevelState(e,t,r,!0,i),this.setActiveProjections(e,t,r+1)},t.prototype.expandAll=function(e,t){this.setAllLevelsState(e,t,!1);var r=this.ensureExpansionState(e,t),i=r.levels.length;this.setActiveProjections(e,t,i)},t.prototype.collapseAll=function(e,t){this.setAllLevelsState(e,t,!0),this.setActiveProjections(e,t,1)},t.prototype.setNodeState=function(e,t,r,i){var n=this.ensureExpansionState(e,t);this.getSelectorRefs(r);return n.setNodeState(a.convertSelectorsByColumnToSelector(r),i)},t.prototype.setLevelState=function(e,t,r,i,n){var a=this.ensureExpansionState(e,t);if(n)for(var o=0;o<r;o++)a.setLevelState(o,!1);a.setLevelState(r,i)},t.prototype.setAllLevelsState=function(e,t,r){for(var i=this.ensureExpansionState(e,t),n=i.levels,a=0;a<n.length-1;a++)i.setLevelState(a,r)},t.prototype.ensureExpansionState=function(e,t){var r=o.getVisualQuery(e),i=r.ensureExpansionState(t);return i},t.prototype.getVisibleDescendentsDepth=function(e,t,r){for(var i=e.levels,n=i.length,a=[t];;){if(r===n-1)return r+1;for(var o=i[r]&&i[r].isCollapsed,s=void 0,l=[],u=0,c=a;u<c.length;u++){var p=c[u];!o==!p.isToggled&&(l.push.apply(l,p.children),s=!0)}if(s&&r++,!(l.length>0))break;a=l}for(;r<n-1&&(r===-1||!i[r].isCollapsed);)r++;return r+1},t.prototype.setActiveProjections=function(e,t,r){for(var i=o.getVisualQuery(e),n=i.projections,a=0,s=t;a<s.length;a++){var l=s[a];if(r>0){var u=n[l]&&n[l].all(),c=_.uniqBy(u,(function(e){return e.queryRef})),p=c.length,f=void 0;f=r>=p?c:_.take(c,r),n[l].activeProjectionRefs=_.map(f,(function(e){return e.queryRef})),r-=f.length}else n[l].activeProjectionRefs=[]}},t})()})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(t){function r(e){return new i(e)}t.createFederatedSchemaValidator=r;var i=(function(){function t(e){this.localization=e}return t.prototype.validate=function(t){if(t)for(var r=e.util.createNameValidator(t,this.localization),i=0,n=t.schemas;i<n.length;i++){var a=n[i];if(a.isExtensionSchema)for(var o=t.schema(a.extends),s=0,l=a.entities;s<l.length;s++){var u=l[s],c=!1,p=o.entities.withName(u.name);if(!p){c=!0,u.errorMessage=this.localization.get("ReportMeasuresMissingTableErrorMessage"),u.queryable=1;var f=u;f.isAbandoned=!0}for(var d=0,h=u.properties;d<h.length;d++){var v=h[d];if(1===v.kind){var m=r.validateExistingMeasureName(v);m.error===e.util.NameValidationError.DuplicatedName?(v.errorMessage=m.reason,v.queryable=1):c&&(v.errorMessage=this.localization.get("ReportMeasuresMissingTableMeasureErrorMessage"),v.queryable=1)}}}}},t})()})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(r){function i(e,t,r,i,n,a,o,s,l){return new d(e,t,r,i,n,a,o,s,l)}var n=e.explore.contracts.CollectedFilterSource,a=e.data.DataViewObjectDescriptors,o=e.data.FilterKindDetector,s=e.visuals.plugins,l=e.explore.util.ScriptVisualsUtil,u=e.data.Selector,c=e.data.services.SemanticQuerySerializer,p=e.data.SQExprUtils,f=e.explore.util.VisualContainerUtils;r.createFilterGenerator=i;var d=(function(){function i(e,t,r,i,n,a,o,s,l){this.eventBridge=e,this.visualPlugins=t,this.aggrOps=r,this.relationshipService=i,this.hostFilters=n,this.telemetryService=a,this.scriptVisuals=o,this.featureSwitchService=s,this.filterCapabilitiesService=l}return i.prototype.collectVisualContainerFilters=function(e,t,i){var n=new r.FilterCollector(this.visualPlugins);n.collectFilters(i.filters,0,i),t&&(n.collectFilters(t.filters,1),this.collectCrossFilter(n,t,i)),this.collectSelfFilter(n,i,null),e&&n.collectFilters(e.filters,2);var a=this.hostFilters.getSelectedHostFilters();return a&&n.collectFilters(a.filters,1),n.getCollectedFilters()},i.prototype.collectVisualContainerDrillFilters=function(e){var t=new r.FilterCollector(this.visualPlugins),i=_.filter(e.filters,(function(e){return 2===e.howCreated}));return t.collectFilters(i,0,e),t.getCollectedFilters()},i.prototype.addVisualContainerFilters=function(e,t,r,i,n,a){void 0===a&&(a=!1),e.addCollectedFilters(this.collectVisualContainerFilters(t,r,i),!0,this.getShouldApplyFilter(i,n,r,a)),r&&(this.addHighlightFilter(e,r,i,n),this.addCrossDrillFilters(e,r,i,n))},i.prototype.calculateVisualContainerFilter=function(e,i,n,a,o,s){void 0===o&&(o=!1),void 0===s&&(s=!1);var l=new r.FilterBuilder(n);this.addVisualContainerFilters(l,e,i,n,a,o);var u=l.getFilters(s);return u.queryRefsForSingleItemDrillFilters=t.FilterUtils.getQueryRefsForSingleItemDrillFilters(n,a,this.aggrOps),u},i.prototype.calculateDetailVisualFilter=function(e,i,n,a,o){var s=new r.FilterBuilder(n);this.addVisualContainerFilters(s,e,i,n,a),0===o&&(o=1);var l=s.getHighlightFilters();l&&(s.clearHighlightFilters(),s.mergeHighlightFiltersBasedOnRelationship(l,o));var u=s.getFilters();return u.queryRefsForSingleItemDrillFilters=t.FilterUtils.getQueryRefsForSingleItemDrillFilters(n,a,this.aggrOps),u},i.prototype.clearCrossHighlight=function(e){var t=this.clearCrossHighlightOperation(e);f.notifyVisualContainers(this.eventBridge,t)},i.prototype.clearCrossHighlightForVisualContainers=function(e,t){var r=this.clearCrossHighlightForVisualContainersOperation(e,t);f.notifyVisualContainers(this.eventBridge,r)},i.prototype.clearCrossHighlightForVisualContainersOperation=function(e,t){var r=e.crossFilterSource&&e.crossFilterSource.highlight;if(!_.isEmpty(r)){for(var i=_.chain(r).map((function(e){return e.sourceVisualContainer})).filter((function(e){return _.includes(t,e)})).valueOf(),n=[],a=0,o=i;a<o.length;a++){var s=o[a],l=this.setCrossHighlightOperation(null,null,e,!0,s);n.push.apply(n,l)}return _.uniq(n)}},i.prototype.clearFiltersFromVisualContainers=function(e,t){var r=this,i=e&&e.crossFilterSource,n=i&&i.drill,a=i&&i.highlight,o=[];if(!_.isEmpty(a)&&_.some(t,(function(e){return e===a[0].sourceVisualContainer}))&&(o=this.clearCrossHighlightOperation(e)),!_.isEmpty(n)){var s=this.clearCrossDrillFromVisualContainersOperation(e,t);o=_.union(o,s)}_.some(t,(function(e){return r.supportsFilterOutput(e)}))?f.notifyVisualContainers(this.eventBridge,e.visualContainers):_.isEmpty(o)||f.notifyVisualContainers(this.eventBridge,o)},i.prototype.updateCrossHighlightCollectedFilters=function(e,t,r){var i=e&&e.crossFilterSource&&e.crossFilterSource.highlight;if(i){var n=_.find(i,(function(e){return e.sourceVisualContainer===r}));n&&!_.isEmpty(n.selection)&&(n.collectedFilters=this.collectVisualContainerFilters(t,e,r),f.notifyVisualContainersExceptSource(this.eventBridge,r))}},i.prototype.calculateFilterContainerInputFilter=function(e,t,i,n,a){if(i&&t&&a){var o;0===a.scopeType&&(o=a.container);var s=new r.FilterCollector(this.visualPlugins);if(e&&s.collectFiltersForFilterContainer(e.filters,2,i),1===a.scopeType){var l=5===i.howCreated?_.filter(t.filters,(function(e){return 5===e.howCreated})):t.filters;s.collectFiltersForFilterContainer(l,1,i)}else 2!==a.scopeType&&s.collectFiltersForFilterContainer(t.filters,1,i);this.collectSelfFilter(s,null,i),o&&(s.collectFiltersForFilterContainer(o.filters,0,i,o),this.collectCrossFilter(s,t,o));var u=new r.FilterBuilder(o,i);return u.addCollectedFilters(s.getCollectedFilters(),!1,this.getShouldApplyFilterContainerInputFilter(i,o,n,t)),u.getFilters()}},i.prototype.getVisualContainerCrossFilters=function(e,t,i){var n=new r.FilterCollector(this.visualPlugins);this.collectCrossFilter(n,e,t);var a=new r.FilterBuilder(t);return a.addCollectedFilters(n.getCollectedFilters(),!1,this.getShouldApplyFilter(t,i,e)),this.addHighlightFilter(a,e,t,i),this.addCrossDrillFilters(a,e,t,i),{dataFilters:a.getCrossFilters()||[],highlightFilters:a.getHighlightFilters()}},i.prototype.logRFilterTelemetry=function(e,t,r){var i=l.getScriptVisualIdsInSection(t,this.scriptVisuals);_.isEmpty(i)||this.telemetryService.logEvent(e,r,JSON.stringify(i))},i.prototype.setCrossHighlightOperation=function(t,r,i,n,a,o){var s=i.crossFilterSource&&i.crossFilterSource.highlight,l=!1;if(a){l=!0,i.crossFilterSource||(i.crossFilterSource={highlight:[]}),i.crossFilterSource.highlight||(i.crossFilterSource.highlight=[]);var c=i.crossFilterSource.highlight,p=void 0;n&&this.featureSwitchService.featureSwitches.multiVisualSelection&&this.newAndPreviousSelectionsSupportMultiVisualSelection(a,c)?(p=_.findIndex(c,(function(e){return e.sourceVisualContainer===a})),p===-1&&(p=c.length)):(i.crossFilterSource.highlight=c=[],p=0),c[p]={sourceVisualContainer:a,selection:r,selectorFilter:u.filterFromSelectorsByColumn(r),collectedFilters:_.isEmpty(r)?[]:this.collectVisualContainerFilters(t,i,a),filterExpressionMetadata:o},this.logRFilterTelemetry(e.telemetry.EXCrossFilterScriptVisual,i,"Highlight")}else s&&(l=!0,i.crossFilterSource.highlight=void 0);if(l){var d=i.crossFilterSource&&i.crossFilterSource.highlight;if(!_.isEmpty(s)){for(var h=function(e){_.findIndex(d,(function(t){return t.sourceVisualContainer===e.sourceVisualContainer}))===-1&&f.clearDataSelection(v.eventBridge,e.sourceVisualContainer)},v=this,m=0,g=s;m<g.length;m++){var y=g[m];h(y)}for(var C=function(e){if(e.sourceVisualContainer!==a){if(!(_.findIndex(d,(function(t){return t.sourceVisualContainer===e.sourceVisualContainer}))!==-1))return a=null,"break"}},x=0,b=s;x<b.length;x++){var y=b[x];if("break"===C(y))break}}return _.filter(i.visualContainers,(function(e){return e!==a}))}},i.prototype.newAndPreviousSelectionsSupportMultiVisualSelection=function(e,t){return!!this.supportsMultiVisualSelection(e)&&!(1===t.length&&!this.supportsMultiVisualSelection(t[0].sourceVisualContainer))},i.prototype.supportsMultiVisualSelection=function(e){var t=f.getVisualCapabilities(e,this.visualPlugins);return t&&t.supportsMultiVisualSelection},i.prototype.clearCrossHighlightOperation=function(e){if(e.crossFilterSource&&e.crossFilterSource.highlight)return this.setCrossHighlightOperation(null,null,e)},i.prototype.clearCrossDrillFromVisualContainersOperation=function(e,t){if(!_.isEmpty(t)){for(var r=[],i=0,n=t;i<n.length;i++){var a=n[i],o=this.updateCrossDrillFromVisualContainerOperation(e,a,!0);r=_.union(r,o)}return r}},i.prototype.updateCrossDrillFromVisualContainerOperation=function(e,t,r){var i,n=e.crossFilterSource&&e.crossFilterSource.drill,a=!1;if(!r){var o=this.collectVisualContainerDrillFilters(t);_.isEmpty(o)||(i={sourceVisualContainer:t,collectedFilters:o})}var s=_.findIndex(n,(function(e){return e.sourceVisualContainer===t}));if(s>=0?(a=!0,i?n[s]=i:n.splice(s,1)):i&&(a=!0,e.crossFilterSource||(e.crossFilterSource={}),(e.crossFilterSource.drill||(e.crossFilterSource.drill=[])).push(i)),a)return _.filter(e.visualContainers,(function(e){return e!==t}))},i.prototype.collectSelfFilter=function(e,t,r){var i,a=this;!t?(i=this.getFilterFromFilterPropertyInFilterContainer(r,(function(e){return a.tryGetSelfFilterProperty(e)})),i&&e.collectFilter(i,r,null,0,n.Self)):(i=this.getFilterFromFilterPropertyInVisualContainer(t,(function(e){return a.tryGetSelfFilterProperty(e)})),i&&e.collectFilter(i,null,t,0,n.Self))},i.prototype.collectCrossFilter=function(e,t,r){for(var i=this,a=0,o=t.visualContainers;a<o.length;a++){var s=o[a];if(s!==r){var l=this.getFilterFromFilterPropertyInVisualContainer(s,(function(e,t){return i.tryGetFilterPropertyIdentifier(e,t)}));l&&e.collectFilter(l,null,s,0,n.Slicer)}}},i.prototype.getFilterFromFilterPropertyUtil=function(t,r,i){var n=i(t,r&&r.visualType);if(n){var a=r.objects;if(a){return e.data.DataViewObjectDefinitions.getValue(a,n,null)}}},i.prototype.getFilterFromFilterPropertyInVisualContainer=function(e,t){var r=f.getVisualCapabilities(e,this.visualPlugins),i=e.config&&e.config.singleVisual;return this.getFilterFromFilterPropertyUtil(r,i,t)},i.prototype.getFilterFromFilterPropertyInFilterContainer=function(e,t){var r=f.getFilterCapabilities(e,this.visualPlugins),i=e.config&&e.config.singleVisual;return this.getFilterFromFilterPropertyUtil(r,i,t)},i.prototype.addHighlightFilter=function(e,t,r,i){var n=t.crossFilterSource&&t.crossFilterSource.highlight;if(!_.isEmpty(n)&&f.getVisualType(r)!==s.slicer.name)for(var a=0,o=n;a<o.length;a++){var l=o[a];if(l.sourceVisualContainer!==r){var u=this.buildHighlightFiltersForRelatedTargets(l,i,t);if(u){var c=this.relationshipService.relationshipFilterAction(t,l.sourceVisualContainer,r,i),p=f.getVisualCapabilities(r,this.visualPlugins);e.mergeHighlightFiltersBasedOnRelationship(u,c,!p.supportsHighlight)}}}},i.prototype.addCrossDrillFilters=function(e,t,i,n){var a=t.crossFilterSource&&t.crossFilterSource.drill;if(!_.isEmpty(a)){for(var o=[],s=0,l=a;s<l.length;s++){var u=l[s],c=u.sourceVisualContainer;if(this.relationshipService.shouldApplyCrossDrill(t,c,i,n)){var p=new r.FilterBuilder(c);p.addCollectedFilters(u.collectedFilters,!1,this.getShouldApplyDrillCrossFilter(c,n,t));var f=p.getUnmergedDrillCrossFilter();if(f)for(var d=function(t){e.addCrossFilter(t);var r=_.find(u.collectedFilters,(function(e){return e.filter===t.filter}));r&&o.push(r.filterContainer)},h=0,v=f;h<v.length;h++){var m=v[h];d(m)}}}return o}},i.prototype.buildHighlightFiltersForRelatedTargets=function(e,i,n){var a=new r.FilterBuilder(e.sourceVisualContainer);return e.selectorFilter&&a.setSelectorFilter({filter:e.selectorFilter,filterExpressionMetadata:e.filterExpressionMetadata,type:t.contracts.FilterType.Include}),a.addCollectedFilters(e.collectedFilters,!1,this.getShouldApplyHighlightFilter(e.sourceVisualContainer,i,n)),a.getCrossHighlightFilters()},i.prototype.getShouldApplyFilterContainerInputFilter=function(e,t,r,i){var n=this;return function(a,o,s){return n.shouldApplyFilterContainerInputFilter(a,o,s,e,t,r,i)}},i.prototype.shouldApplyFilterContainerInputFilter=function(e,t,r,i,n,a,s){if(t===i)return!0;if(!this.shouldApplyFilter(e,t,r,n,a,s))return!1;var l=t&&t.expression;return(!l||!p.isMeasure(l))&&!_.some(e.conditions(),(function(e){return 3===o.run(e)}))},i.prototype.getShouldApplyHighlightFilter=function(e,t,r){var i=this;return function(n,a,o){return i.shouldApplyHighlightFilter(n,a,o,e,t,r)}},i.prototype.getShouldApplyDrillCrossFilter=function(e,t,r){var i=this;return function(n,a,o){return i.shouldApplyDrillCrossFilter(n,a,o,e,t,r)}},i.prototype.shouldApplyHighlightFilter=function(e,t,r,i,n,a){return!!this.shouldApplyFilter(e,t,r,i,n,a)&&!_.some(e.conditions(),(function(e){return 1===o.run(e)}))},i.prototype.shouldApplyDrillCrossFilter=function(e,t,r,i,n,a){return!!this.shouldApplyFilterForCrossDrill(e,t,r,i,n,a)&&!_.some(e.conditions(),(function(e){return 1===o.run(e)}))},i.prototype.getShouldApplyFilter=function(e,t,r,i){var n=this;return void 0===i&&(i=!1),function(a,o,s){return n.shouldApplyFilter(a,o,s,e,t,r,i)}},i.prototype.shouldApplyFilter=function(e,t,r,i,n,a,o){var s=this;void 0===o&&(o=!1);var l=o?function(){return 1}:function(e,t,r,i){return s.relationshipService.relationshipFilterAction(e,t,r,i)};return this.shouldApplyFilterInternal(e,t,r,i,n,a,l)},i.prototype.shouldApplyFilterForCrossDrill=function(e,t,r,i,n,a){var o=this,s=function(e,t,r,i){return o.relationshipService.drillRelationshipFilterAction(e,t,r,i)};return this.shouldApplyFilterInternal(e,t,r,i,n,a,s)},i.prototype.shouldApplyFilterInternal=function(e,r,i,n,a,o,s){if(r&&t.FilterUtils.shouldDisableFilter(r,a,i,this.aggrOps,this.visualPlugins))return!1;if(!(_.isEmpty(e.validate(a,this.aggrOps))||i&&i===n))return!1;if(i&&n&&i!==n){if(3===s(o,i,n,a))return!1;var l=i.config.singleVisual.syncGroup,u=n.config.singleVisual.syncGroup;if(l&&u&&l.groupName===u.groupName)return!1}return!0},i.prototype.generateFilterMetadata=function(e){if(!_.isEmpty(e)){for(var t=[],r=0,i=e;r<i.length;r++){var n=i[r],a={Restatement:n.restatement,type:n.type};n.expression&&(a.expression=c.serializeExpr(n.expression)),t.push(a)}return t}},i.prototype.setMultipleFiltersOnSelectData=function(e,t,r){for(var i=this.clearCrossHighlightOperation(t),n=0,a=r;n<a.length;n++){var o=a[n];i=_.union(i,this.setCrossHighlightOperation(e,o.selection,t,!0,o.sourceVisualContainer,o.filterExpressionMetadata))}f.notifyVisualContainers(this.eventBridge,i)},i.prototype.setFilterOnSelectData=function(t,r,i,n,a,o){if(this.supportsFilterOutput(n))this.logRFilterTelemetry(e.telemetry.EXCrossFilterScriptVisual,i,"Data");else{var s=this.setCrossHighlightOperation(t,r,i,a,n,o);f.notifyVisualContainers(this.eventBridge,s)}},i.prototype.updateCrossFilterOnDrill=function(e,t){var r=this.updateCrossDrillFromVisualContainerOperation(e,t,!1);f.notifyVisualContainers(this.eventBridge,r)},i.prototype.updateCrossDrillFromVisualContainers=function(e,t){var r=this.updateCrossDrillFromVisualContainersOperation(e,t);f.notifyVisualContainers(this.eventBridge,r)},i.prototype.updateCrossDrillFromVisualContainersOperation=function(e,t){if(!_.isEmpty(t)){for(var r=[],i=0,n=t;i<n.length;i++){var a=n[i],o=this.updateCrossDrillFromVisualContainerOperation(e,a,!1);r=_.union(r,o)}return r}},i.prototype.updateCrossDrillOfSection=function(e){var t=this.updateCrossDrillOfSectionOperation(e);f.notifyVisualContainers(this.eventBridge,t)},i.prototype.updateCrossDrillOfSectionOperation=function(e){return this.updateCrossDrillFromVisualContainersOperation(e,e.visualContainers)},i.prototype.getDrillCrossFiltersToApply=function(e,t,i){var n=new r.FilterBuilder(t);return this.addCrossDrillFilters(n,e,t,i)},i.prototype.supportsFilterOutput=function(e){return t.FilterUtils.supportsFilterOutput(f.getVisualCapabilities(e,this.visualPlugins))},i.prototype.tryGetFilterPropertyIdentifier=function(e,r){return t.FilterUtils.tryGetFilterPropertyIdentifier(e,r,this.visualPlugins)},i.prototype.tryGetSelfFilterEnabledProperty=function(e){if(e)return a.findSelfFilterEnabled(e.objects)},i.prototype.tryGetSelfFilterProperty=function(e){if(e)return a.findSelfFilter(e.objects)},i.prototype.resolveFilterTargets=function(e,t,i,n,a){var o={dataRoles:i,mappings:n,queryProjections:t.projections,select:t.defn.select(),schema:e},s=new r.VisualFilterMappingResolver(o),l=t.defn;return a&&(l=l.addSemanticFilter(a)),s.resolveSemanticQuery(l)},i.prototype.applyFilterOutput=function(e){this.supportsFilterOutput(e)&&f.notifyVisualContainersExceptSource(this.eventBridge,e)},i})()})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));
var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){function r(e,t,r,i,a,o,s,l){return new n(e,t,r,i,a,o,s,l)}var i=2;t.createClipboardService=r;var n=(function(){function r(e,t,r,i,n,a,o,s){this.eventBridge=e,this.popOutService=t,this.undoRedoService=r,this.visualStylePresetService=i,this.rootScope=n,this.telemetryService=a,this.staticResourceReferences=o,this.clipboardStorageService=s,o.addReferenceSource(this)}return r.prototype.getReferences=function(){var e=this.clipboardStorageService.getData();return e&&e.referencedStaticResources},r.prototype.restoreMissingResources=function(){return this.staticResourceReferences.restoreReferences(this.getReferences())},r.prototype.copySelectedVisuals=function(t){return __awaiter(this,void 0,e.Promise,(function(){var e,r;return __generator(this,(function(n){switch(n.label){case 0:return e=this.handler.getSelectionResources(),this.clipboardStorageService.supportsMultipleReports()?[4,this.staticResourceReferences.loadItemsContent(e)]:[3,2];case 1:n.sent(),n.label=2;case 2:return r={version:i,sourceAction:t,sourceSectionName:this.handler.getSelectionSectionName()},[4,this.handler.serializeSelection()];case 3:return[2,(r.visuals=n.sent(),r.referencedStaticResources=e,r.sessionId=this.telemetryService.sessionId,r)]}}))}))},r.prototype.copy=function(){return __awaiter(this,void 0,e.Promise,(function(){var e,r;return __generator(this,(function(i){switch(i.label){case 0:return r=(e=this.clipboardStorageService).setData,[4,this.copySelectedVisuals(0)];case 1:return r.apply(e,[i.sent()]),this.eventBridge.publishToChannel(t.events.clipboardDataUpdated),[2]}}))}))},r.prototype.cut=function(){return __awaiter(this,void 0,e.Promise,(function(){var e,r=this;return __generator(this,(function(i){switch(i.label){case 0:return[4,this.copySelectedVisuals(1)];case 1:return e=i.sent(),this.rootScope.$evalAsync((function(){r.undoRedoService.register("Cut",(function(){r.clipboardStorageService.setData(e),r.eventBridge.publishToChannel(t.events.clipboardDataUpdated),r.handler.deleteSelection()}))})),[2]}}))}))},r.prototype.paste=function(){var t=this;if(this.canPaste()){var r=this.clipboardStorageService.getData();if(r.version!==i)return void this.telemetryService.logEvent(e.telemetry.ClipboardServiceUnsupportedVersion,r.version);var n=r.sessionId===this.telemetryService.sessionId;this.telemetryService.logEvent(e.telemetry.ClipboardServicePaste,n),this.restoreMissingResources().then((function(){t.rootScope.$evalAsync((function(){t.undoRedoService.register("Paste",(function(){t.staticResourceReferences.addItemsContent(r.referencedStaticResources),t.handler.deserializeAndDuplicateData(r.sourceAction,r.sourceSectionName,r.visuals,n)}))}))}))}},r.prototype.canPaste=function(){return Boolean(null==this.popOutService.get()&&this.clipboardStorageService.canPaste())},r.prototype.setHandler=function(e){this.handler=e},r.prototype.getFormatData=function(){return this.formatData},r.prototype.setFormatData=function(e){this.formatData=e,this.eventBridge.publishToChannel(t.events.clipboardDataUpdated)},r.prototype.clearFormatData=function(){this.formatData=void 0,this.eventBridge.publishToChannel(t.events.clipboardDataUpdated)},r.prototype.copyFormat=function(){return __awaiter(this,void 0,e.Promise,(function(){var e,t,r;return __generator(this,(function(n){switch(n.label){case 0:return[4,this.handler.serializeSelection()];case 1:return e=n.sent(),1===e.length&&(t=e[0],r={version:i,sourceAction:0,sourceSectionName:this.handler.getSelectionSectionName(),visuals:[t]},this.setFormatData(r)),[2]}}))}))},r.prototype.tryPasteFormat=function(){var e=this;this.canPasteFormat()&&this.rootScope.$evalAsync((function(){e.undoRedoService.register("PasteFormat",(function(){var t=e.getFormatData(),r=e.handler.deserializeVisualContainer(t.visuals[0]).config.singleVisual;e.handler.pasteVisualFormat(r,e.visualStylePresetService),e.clearFormatData()}))}))},r.prototype.canPasteFormat=function(){return!(!this.formatData||!this.formatData.visuals)},r})()})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){function t(){return new r}e.createWebClipboardStorageService=t;var r=(function(){function e(){}return e.prototype.canPaste=function(){return Boolean(this.data&&this.data.visuals)},e.prototype.setData=function(e){this.data=e},e.prototype.getData=function(){return this.data},e.prototype.clearData=function(){this.data=void 0},e.prototype.supportsMultipleReports=function(){return!1},e})()})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){var r,i=e.data.DataViewObjectDefinition,n=e.data.DataViewObjectDefinitions,a=e.explore.contracts.VisualContainer;!(function(e){function r(e,r){var i=t.selectionUtils.getSelectedVisual(e);if(i){var n=i.config.singleVisual.visualType;if(!r.isCustomVisual(n))return i.config.singleVisual}}function o(e,r,i){var n=t.selectionUtils.getSelectedVisual(e);if(n&&i){var o=n.config.singleVisual,l=r.capabilities(o.visualType),u=r.capabilities(i.visualType);l&&u&&(o.objects=s(l.objects,u.objects,i.objects,o.objects));var c=a.CommonObjectDescriptors;return o.vcObjects=s(c,c,i.vcObjects,o.vcObjects),n}}function s(e,t,r,a){if(r===a)return a;a=a||{};for(var o in e){var s=e[o],l=t[o];if(l&&!s.suppressFormatPainterCopy&&!l.suppressFormatPainterCopy){var u=r&&r[o],c=a&&a[o];for(var p in s.properties){var f=s.properties[p],d=l.properties[p];if(d&&!f.suppressFormatPainterCopy&&!d.suppressFormatPainterCopy&&_.isEqual(f.type,d.type)){if(c)for(var h=0,v=c;h<v.length;h++){var m=v[h];i.deleteSingleProperty(m,p)}if(u)for(var g=0,y=u;g<y.length;g++){var m=y[g];if(m.properties[p]){var C=n.ensure(a,o,m.selector);C.properties[p]=m.properties[p]}}}}}}return n.reduce(a)}e.copyFormatVisualConfig=r,e.pasteFormatVisualConfig=o})(r=t.FormatPainter||(t.FormatPainter={}))})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(r){function i(e,t,r,i,n,a,s,l,u,c){return new o(e,t,r,i,n,a,s,l,u,c)}var n=t.contracts.DataSource,a=e.explore.util.VisualContainerUtils;r.createModelChangeHandler=i;var o=(function(){function t(e,t,i,n,a,o,s,l,u,c){var p=this;this.conceptualSchemaProxy=e,this.dataProxy=t,this.dataSources=n,this.eventBridge=a,this.undoRedoService=o,this.visualPluginService=s,this.promiseFactory=l,this.lazy=u,this.pbiLazyLoad=c,this.handlerTokens=[];var f=a.createChannelSubscriptionManager().subscribe(r.events.explorationLoaded,(function(e,t){return p.currentExplorationContract=t}));i.$on("$destroy",(function(){return f.unsubscribeAll()}))}return t.prototype.applyChange=function(t){var i=this,o=t.providerType;o||(o="dsr");var s=this.dataSources.get();if(n.referenced(s,null)){var l=n.dataReaderDataSources(n.queried(s,null)),u=this.conceptualSchemaProxy,c=this.dataProxy;u.stopCommunication(new e.IgnorableClientError),u.clearCache(),c.stopCommunication(o);var p=_.find(s,(function(e){return!n.isExtension(e)}));p&&this.pbiLazyLoad.isLoaded("powerbi.insights")&&this.lazy("insightsCache").then((function(e){e.clearForModel(p.dsr.modelId)})),t.change.then((function(n){n.hasQueryImpact&&(c.clearCache(o,l),i.currentExplorationContract&&a.clearExplorationQueryCaches(i.currentExplorationContract));var s;n&&(s=n.changes)&&!_.isEmpty(s)&&(n.hasQueryImpact||"dsr"!==o||e.data.dsr.createQueryCacheHandler().apply(c,l,s),i.currentExplorationContract&&r.createSchemaChangeHandler(i.visualPluginService).apply(i.currentExplorationContract,s)),i.conceptualSchemaProxy.resumeCommunication();var u=[];try{for(var p=0,f=i.handlerTokens;p<f.length;p++){var d=f[p];u.push(d.handle(n))}}finally{i.promiseFactory.all(u).finally((function(){i.dataProxy.resumeCommunication(o),t.leaveUndo||(i.undoRedoService.canUndo()||i.undoRedoService.canRedo())&&(i.undoRedoService.clear(),i.eventBridge.publishToChannel(r.events.undoRedoStackCleared));var e=i.eventBridge;e.publishToChannel(r.events.enableEditing),e.publishToChannel(r.events.modelChanged,n),e.publishToChannel(r.events.visualContainerChanged,{affectContainer:function(){return!0},cacheResponseOnServer:t.cacheResponseOnServer})}))}}),(function(){return i.resumeCommunication(o)}))}},t.prototype.register=function(e){var t=this,r={handle:e,stopHandling:function(){var e=t.handlerTokens.indexOf(r);e>-1&&t.handlerTokens.splice(e,1)}};return this.handlerTokens.push(r),r},t.prototype.resumeCommunication=function(e){this.conceptualSchemaProxy.resumeCommunication(),this.dataProxy.resumeCommunication(e)},t})()})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){function t(){return new r}e.createRunningVisualService=t;var r=(function(){function e(){this.runningVisuals={}}return e.prototype.getVisual=function(e){var t=this.runningVisuals[e.name];return t&&t.visual},e.prototype.setVisual=function(e,t){this.runningVisuals[e.name]={contract:e,visual:t}},e.prototype.removeVisual=function(e){delete this.runningVisuals[e.name]},e})()})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){function t(){return new r}e.createServicePauser=t;var r=(function(){function e(){this.isPaused=!1}return e.prototype.register=function(e){var t=jQuery.extend(!0,{},e);return this.updateService(t),t},e.prototype.pause=function(){this.isPaused=!0},e.prototype.resume=function(){this.isPaused=!1},e.prototype.updateService=function(e){var t=function(t){if(_.isFunction(e[t])){var i=e[t],n=r;e[t]=function(){if(!n.isPaused)return i.apply(e,arguments)}}},r=this;for(var i in e)t(i)},e})()})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){function r(e,t,r,i,n){return new u(e,t,r,i,n)}var i=e.data.DataViewObjectDefinitions,n=e.visualHost.ResourcePackageReferenceResolver,a=e.visualHost.utils.ResourcePackageUtils,o=e.data.SQExpr,s=jsCommon.UrlUtils;t.createStaticResourceReferenceService=r;var l;!(function(e){function t(e,t,r,s){e&&i.visitPropertyExprs({definitions:e,descriptors:t,visitor:function(e){if(o.isResourcePackageItem(e)){var t=a.findResourcePackage(r,e.packageType,e.packageName),i=a.findItemInPackage(t,e.itemName);i&&n(s,t.name,t.type,i.name,i.type)}}})}function r(e,t,r){return e[t]||(e[t]={items:{},name:t,type:r}),e[t]}function n(e,t,i,n,a){var o=r(e,t,i).items;return o[n]=o[n]||{name:n,type:a}}function s(e,t,r){var i=e[t];return i&&i.items&&i.items[r]}function l(e,t,r){var i=e[t];if(i){var n=i.items;delete n[r],0===_.size(n)&&delete e[t]}}function u(e,t){for(var r in e){var i=e[r];for(var n in i.items)t(i,i.items[n])}}e.addObjectsReferences=t,e.ensurePackageReference=r,e.addItemReference=n,e.findItem=s,e.eraseItem=l,e.visitItemReferences=u})(l=t.StaticResourceReferences||(t.StaticResourceReferences={}));var u=(function(){function e(e,t,r,i,n){this.promiseFactory=e,this.resourceLoader=t,this.explorationNavigation=r,this.explorationSerializer=i,this.resourceRegistration=n,this.restorableReferenceSources=[],this.preservedReferences={}}return e.prototype.addReferenceSource=function(e){this.restorableReferenceSources.push(e)},e.prototype.removeReferenceSource=function(e){_.pull(this.restorableReferenceSources,e)},e.prototype.garbageCollectUnreferencedStaticResources=function(){var e=this.explorationNavigation.getCurrentExploration(),t=e&&e.resourcePackages;if(t){for(var r=this.explorationSerializer.getReferencedStaticResources(e),i=this.getRestorableReferences(),n=[],o=t.length-1;o>=0;o--){var s=t[o];a.isStaticResource(s)&&(this.garbageCollectItems(s,r,this.preservedReferences,i,n),_.isEmpty(s.items)&&_.pull(t,s))}return _.isEmpty(t)&&delete e.resourcePackages,this.cleanPreservedReferences(r,i),n}},e.prototype.cleanPreservedReferences=function(e,t){var r=this;l.visitItemReferences(this.preservedReferences,(function(i,n){!l.findItem(e,i.name,n.name)&&l.findItem(t,i.name,n.name)||l.eraseItem(r.preservedReferences,i.name,n.name)}))},e.prototype.getRestorableReferences=function(){for(var e={},t=0,r=this.restorableReferenceSources;t<r.length;t++){var i=r[t];l.visitItemReferences(i.getReferences(),(function(t,r){l.addItemReference(e,t.name,t.type,r.name,r.type)}))}return e},e.prototype.garbageCollectItems=function(e,t,r,i,n){for(var a=e.items,o=e.name,s=_.size(a)-1;s>=0;s--){var u=a[s],c=u.name;l.findItem(t,o,c)||(l.findItem(i,o,c)&&this.preserveItem(e,c,u.type),n.push(o+"/"+u.path),_.pull(a,u))}},e.prototype.preserveItem=function(e,t,r){var i=l.addItemReference(this.preservedReferences,e.name,e.type,t,r);i.uri||(i.uri=n.loadAndResolveContent(e,t,this.resourceLoader,this.promiseFactory).then((function(e){return s.isDataUri(e)||(e=s.makeJsonDataUri(e)),e})))},e.prototype.loadItemsContent=function(e){var t=[],r=this.explorationNavigation.getCurrentExploration(),i=r&&r.resourcePackages;for(var a in e){var o=e[a];if(1===o.type){var s=o.items,l=function(e){var r=s[e];t.push(n.loadRegisteredResourceAsDataUri(u.promiseFactory,u.resourceLoader,i,r.name).then((function(e){r.content=e})))},u=this;for(var c in s)l(c)}}return this.promiseFactory.all(t).then((function(){}))},e.prototype.addItemsContent=function(e){var t=this.explorationNavigation.getCurrentExploration();for(var r in e){var i=e[r],n=i.items;for(var a in n){var o=n[a];this.addResource(t.resourcePackages,r,i.type,o.name,o.type,o.content)}}},e.prototype.needingRestore=function(e){var t=this;if(!_.isEmpty(e)){var r=this.explorationNavigation.getCurrentExploration();if(r){var i=r&&r.resourcePackages;if(!_.isEmpty(i)){var n={};return l.visitItemReferences(e,(function(e,r){var o=e.name,s=r.name,u=l.findItem(t.preservedReferences,o,s);if(u&&!a.findItemInPackages(i,e.type,r.name,o)){l.ensurePackageReference(n,o,e.type).items[s]=u}})),n}}}},e.prototype.addResource=function(e,t,r,i,n,o){a.findItemInPackages(e,r,i,t)||this.resourceRegistration.add(i,r,n,{content:o,skipUniqueName:!0})},e.prototype.restoreReferences=function(e){var t=this,r=this.needingRestore(e),i=[];return l.visitItemReferences(r,(function(e,r){i.push(r.uri.then((function(i){t.resourceRegistration.restore(r.name,e.type,r.type,i)})))})),this.promiseFactory.all(i).then((function(){}))},e})()})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){function r(e,t,r,i){return new p(e,t,r,i)}var i=jsCommon.FileUtils,n=e.contracts.ResourcePackageItemType,a=e.visualHost.ResourcePackageReferenceResolver,o=e.explore.util.ResourcePackageUtils,s=e.visualHost.utils.ResourcePackageUtils,l=e.data.SQExprBuilder,u=jsCommon.UrlUtils;t.createResourceRegistrationService=r;var c={};c[n.BaseTheme]=function(e){return"BaseThemes/"+e+".json"},c[n.CustomTheme]=function(e){return"BuiltInThemes/"+e+".json"},c[n.HighContrastTheme]=function(e){return"HighContrastThemes/"+e+".json"},c[n.Image]=function(e){return"Images/"+e},c[n.ShapeMap]=function(e){return"Shapemaps/"+e+".json"};var p=(function(){function e(e,t,r,i){this.explorationNavigationService=e,this.promiseFactory=t,this.resourceLoader=r,this.resourcePublishingService=i}return e.prototype.addResource=function(e,t,r,i){var n,o=this;if(1===e.type?n={type:r,path:t,name:t,content:i}:2===e.type&&(s.findItemInPackage(e,t)||(n={type:r,path:c[r](t),name:t,content:i})),n){e.items.push(n);var p=void 0;p=_.isEmpty(i)?a.loadAndResolveContent(e,t,this.resourceLoader,this.promiseFactory).then((function(e){return u.isDataUri(e)||(e=u.utoa(e)),e})):this.promiseFactory.resolve(u.getBase64ContentFromDataUri(i)),p.then((function(t){o.resourcePublishingService.publish(e.name,n.path,t)}))}return l.resourcePackageItem(e.name,e.type,t)},e.prototype.restore=function(e,t,r,i){var n=this.ensureResourcePackageExists(t);_.find(n.items,(function(t){return t.name===e}))||this.addResource(n,e,r,i)},e.prototype.add=function(e,t,r,i){var n=this.ensureResourcePackageExists(t);return 1!==t||i&&i.skipUniqueName||(e=this.getUniqueName(e,n)),this.addResource(n,e,r,i&&i.content)},e.prototype.getUniqueName=function(e,t){var r=e.replace(/[^a-zA-Z0-9:@\-._~!$&'()*+,;=]/g,"_"),n=i.getFileWithoutExtension(r),a=i.getFileExtension(r);a&&(a="."+a);for(var o;;){if(o=n+Math.random().toString().substr(2)+a,!_.find(t.items,(function(e){return e&&e.name&&e.name.toUpperCase()===o.toUpperCase()})))break}return o},e.prototype.ensureResourcePackageExists=function(e){var t=this.explorationNavigationService.getCurrentExploration();return o.ensureResourcePackageType(t,e)},e})()})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){function t(){return{publish:_.noop}}e.createResourcePublishingService=t})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(r){var i;!(function(r){function i(e){return x[e]||f.v3_6}function n(e,t){var r=b[e.kind]||g.ZeroStr,i=t;return i&&i.fill&&i.fill.solid&&i.fill.solid.color&&(r=g.max(r,a(e))),r}function a(e){if(m.isFillRule(e)&&e.input&&!m.isSelectRef(e.input))return S.ConditionalFormattingSource;if(m.isConditional(e)){var t=function(e){return m.isCompare(e)&&!m.isSelectRef(e.left)},r=function(e){return!!t(e)||!(!m.isAnd(e)||!t(e.left)&&!t(e.right))};if(_.some(e.cases,(function(e){return r(e.condition)})))return S.ConditionalFormattingSource}return m.isMeasure(e)||m.isAggregation(e)?S.ConditionalFormattingByValue:g.ZeroStr}function o(e){if(e instanceof v)return!!_.find(w,(function(t){return t===e.value}));if(e instanceof Object&&!(e instanceof Function))for(var t=Object.keys(e),r=0,i=t;r<i.length;r++){var n=i[r];if(o(e[n]))return!0}return!1}function s(e,t){return{added:c(e),renamed:l(t)}}function l(e){for(var t={},r=0,i=e.length;r<i;r++){var n=e[r];if(null!=n.types)for(var a=0,o=n.types;a<o.length;a++){var s=o[a];u(s,n,t)}else{u(d,n,t);for(var s in t)u(s,n,t)}}return t}function u(e,t,r){var i=r[e];r[e]||(i=r[e]={});var n=t.currentId.objectName,a=i[n];a||(a=i[n]={});var o=t.previousId,s=function(e,t){var r=e&&e[t.objectName];return r&&r[t.propertyName]},l=s(i,o)||s(r[d],o);a[t.currentId.propertyName]=__assign({},t,{previous:l})}function c(e){for(var t={},r=0;r<e.length;r++){var i=e[r];if(null!=i.types)for(var n=0,a=i.types;n<a.length;n++){var o=a[n];p(o,i,t)}else p(d,i,t)}return t}function p(e,t,r){var i=r[e];r[e]||(i=r[e]={});var n=t.property.objectName,a=i[n];a||(a=i[n]={});var o=t.property.propertyName,s=a[o];s||(s=a[o]=[]),s.push(t)}var f,d=e.data.ObjectPropertyVersionWildcard,h=e.data.Selector,v=e.data.SQConstantExpr,m=e.data.SQExpr,g=jsCommon.Version,y=t.contracts.VisualLink,C=t.contracts.VisualTooltip;!(function(e){e.v1_0="1.0",e.v2_0="2.0",e.v2_2="2.2",e.v2_3="2.3",e.v2_5="2.5",e.v3_0="3.0",e.v3_1="3.1",e.v3_2="3.2",e.v3_3="3.3",e.v3_4="3.4",e.v3_5="3.5",e.v3_6="3.6",e.v3_6_1="3.6.1",e.v3_7="3.7",e.v3_8="3.8",e.v3_9="3.9",e.v3_10="3.10",e.v3_11="3.11",e.v3_12="3.12",e.v3_12_1="3.12.1",e.v3_13="3.13",e.v3_14="3.14",e.v3_14_1="3.14.1",e.v3_15="3.15",e.v3_16="3.16",e.v3_17="3.17",e.v3_18="3.18",e.v3_19="3.19",e.v3_20="3.20",e.v3_21="3.21"})(f=r.ExplorationVersions||(r.ExplorationVersions={}));var x={CY17SU10:f.v3_6,CY17SU12:f.v3_7,CY18SU04:f.v3_12},b={};b[40]=f.v3_7,b[32]=f.v3_8,r.getVersionForBaseTheme=i,r.getVersionForSQExpr=n;var S;!(function(e){e.bookmarks=f.v3_6,e.visualHidden=f.v3_6,e.slowDataSource=f.v3_7,e.ExplorationState_v1_1=f.v3_8,e.description=f.v3_8,e.BookmarkOptions=f.v3_8,e.SectionCrossDrill=f.v3_8,e.SectionVisibility=f.v3_9,e.ExplorationState_v1_2=f.v3_10,e.VisualSyncGroup=f.v3_11,e.ExplorationSettings=f.v3_11,e.CanvasTooltips=f.v3_12,e.ActionButton=f.v3_13,e.QnaLink=f.v3_13,e.ConditionalFormattingSource=f.v3_14,e.MeasureDrillthrough=f.v3_14,e.OutspaceFormatting=f.v3_15,e.StylableVisualContainerHeader=f.v3_15,e.BookmarkGroup=f.v3_17,e.ConditionalFormattingByValue=f.v3_17,e.BuiltInThemes=f.v3_18,e.DotPlotVisual=f.v3_18,e.ExportDataMode=f.v3_19,e.ExpandCollapse=f.v3_20,e.CartesianConditionalFormatting=f.v3_20,e.FilterContainerVisibilityControl=f.v3_20,e.OutspacePaneFormatting=f.v3_20,e.ExplorationState_v1_3=f.v3_20,e.NewFilterPaneExperience=f.v3_20,e.VisualTabOrders=f.v3_21,e.VisualLinkTooltip=f.v3_21,e.FilterRequireSingleSelect=f.v3_21,e.ReportAnnotations=r.CurrentExplorationVersion,e.TitleWordWrap=r.CurrentExplorationVersion})(S=r.ExplorationFeatureVersions||(r.ExplorationFeatureVersions={})),r.DefaultCategoryColorVisualsToUpgrade=["barChart","clusteredBarChart","clusteredColumnChart","columnChart","comboChart","dataDotClusteredColumnComboChart","dataDotStackedColumnComboChart","funnel","hundredPercentStackedBarChart","hundredPercentStackedColumnChart","lineStackedColumnComboChart","lineClusteredColumnComboChart","map","filledMap","shapeMap","scatterChart"];var E=[{property:{objectName:"general",propertyName:"altText"},version:f.v3_1},{property:{objectName:"visualLink",propertyName:"type"},version:f.v3_5},{property:{objectName:"visualLink",propertyName:"type",matchByContents:function(e){return e.value===y.Bookmark}},version:S.bookmarks},{property:{objectName:"labels",propertyName:"enableBackground"},version:f.v3_9},{property:{objectName:"labels",propertyName:"backgroundColor"},version:f.v3_9},{property:{objectName:"labels",propertyName:"backgroundTransparency"},version:f.v3_9},{property:{objectName:"categoryLabels",propertyName:"labelEnableBackground"},version:f.v3_9},{property:{objectName:"categoryLabels",propertyName:"labelBackgroundColor"},version:f.v3_9},{property:{objectName:"categoryLabels",propertyName:"labelBackgroundTransparency"},version:f.v3_9},{property:{objectName:"dateRange",propertyName:"anchorDate"},version:f.v3_9},{property:{objectName:"categoryAxis",propertyName:"maxMarginFactor"},version:f.v3_9},{property:{objectName:"categoryAxis",propertyName:"innerPadding"},version:f.v3_9},{property:{objectName:"columnFormatting",propertyName:"labelDisplayUnits"},version:f.v3_12},{property:{objectName:"columnFormatting",propertyName:"labelPrecision"},version:f.v3_12},{property:{objectName:"visualTooltip",propertyName:"type",matchByContents:function(e){return e.value===C.Canvas}},version:S.CanvasTooltips},{property:{objectName:"lineStyles",propertyName:"lineStyle"},version:f.v3_13,types:[e.visuals.plugins.lineClusteredColumnComboChart.name,e.visuals.plugins.lineStackedColumnComboChart.name]},{property:{objectName:"legend",propertyName:"legendMarkerRendering"},version:f.v3_13,types:[e.visuals.plugins.lineClusteredColumnComboChart.name,e.visuals.plugins.lineStackedColumnComboChart.name]},{property:{objectName:"legend",propertyName:"defaultToCircle"},version:f.v3_13,types:[e.visuals.plugins.lineClusteredColumnComboChart.name,e.visuals.plugins.lineStackedColumnComboChart.name]},{property:{objectName:"legend",propertyName:"matchLineColor"},version:f.v3_13,types:[e.visuals.plugins.lineClusteredColumnComboChart.name,e.visuals.plugins.lineStackedColumnComboChart.name]},{property:{objectName:"visualLink",propertyName:"type",matchByContents:function(e){return e.value===y.Qna}},version:S.QnaLink},{property:{objectName:"labels",propertyName:"funnelLabelStyle"},version:f.v3_14,types:[e.visuals.plugins.funnel.name]},{property:{objectName:"dataPoint",propertyName:"fillRule",matchByContents:o},version:f.v3_15},{property:{objectName:"values",propertyName:"backColor",matchByContents:o},version:f.v3_15},{property:{objectName:"values",propertyName:"fontColor",matchByContents:o},version:f.v3_15},{property:{objectName:"outspace",propertyName:d},version:S.OutspaceFormatting,types:["page"]},{property:{objectName:"visualHeader",propertyName:d},version:S.StylableVisualContainerHeader},{property:{objectName:"visualTooltip",propertyName:"show"},version:f.v3_16},{property:{objectName:"categoryAxis",propertyName:"axisType",matchByContents:function(t){return t.value===e.visuals.axisType.categorical}},version:S.DotPlotVisual,types:[e.visuals.plugins.scatterChart.name]},{property:{objectName:"searchBox",propertyName:d},version:f.v3_19,types:[e.visuals.plugins.slicer.name]},{property:{objectName:"rowHeaders",propertyName:"showExpandCollapseButtons"},version:S.ExpandCollapse,types:[e.visuals.plugins.pivotTable.name]},{property:{objectName:"dataPoint",propertyName:"fill",matchByContents:function(e,t){return t&&t.data&&1===t.data.length&&h.isWildcard(t.data[0])}},version:S.CartesianConditionalFormatting,types:r.DefaultCategoryColorVisualsToUpgrade},{property:{objectName:"filterCard",propertyName:d},version:S.OutspacePaneFormatting,types:["page"]},{property:{objectName:"outspacePane",propertyName:d},version:S.OutspacePaneFormatting,types:["page"]},{property:{objectName:"outspacePane",propertyName:"expanded"},version:S.OutspacePaneFormatting,types:["report"]},{property:{objectName:"outspacePane",propertyName:"visible"},version:S.OutspacePaneFormatting,types:["report"]},{property:{objectName:"visualLink",propertyName:"tooltip"},version:S.VisualLinkTooltip},{property:{objectName:"general",propertyName:"requireSingleSelect"},version:S.FilterRequireSingleSelect,types:["filter"]},{property:{objectName:"title",propertyName:"titleWrap"},version:S.TitleWordWrap}],w=["minColor","midColor","maxColor","nullColor"],F=[{currentId:{objectName:"dataPoint",propertyName:"fill"},previousId:{objectName:"dataPoint",propertyName:"defaultCategoryColor"},version:f.v3_19,types:r.DefaultCategoryColorVisualsToUpgrade}];r.ObjectVersioning=s(E,F);var V;!(function(e){e.v1_0="1.0",e.v1_1="1.1",e.v1_2="1.2",e.v1_3="1.3"})(V=r.ExplorationStateVersions||(r.ExplorationStateVersions={}));var P;!(function(e){e.v1_0="1.0"})(P=r.UtteranceDefinitionVersions||(r.UtteranceDefinitionVersions={}))})(i=r.upgrade||(r.upgrade={}))})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){function t(){return new i}var r=jsCommon.Version;e.createExplorationDowngrader=t;var i=(function(){function t(){this.downgraders=[new e.SectionLinkFieldDowngrader,new e.visualContainerProperties.VisualContainerConfigDowngrader,new e.explorationConfig.ExplorationConfigDowngrader]}return t.prototype.getFinalExplorationVersion=function(e,t){for(var i=0,n=this.downgraders;i<n.length;i++){var a=n[i];t=r.max(t,a.getMinDowngradeVersionForContract(e))}return t},t.prototype.downgrade=function(e,t){for(var r=0,i=this.downgraders;r<i.length;r++){i[r].downgrade(e,t)}},t})();e.ExplorationDowngrader=i})(t=e.downgrade||(e.downgrade={}))})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){var r;!(function(t){var r;!(function(t){var r=e.explore.services.upgrade.ExplorationFeatureVersions,i=e.explore.services.upgrade.ExplorationVersions,n=jsCommon.Version,a=(function(){function e(){}return e.prototype.getMinDowngradeVersionForContract=function(e){var t=e.themeCollection;if(t.customTheme&&2===t.customTheme.type)return r.BuiltInThemes;for(var a in t)if(n.gt(t[a].version,i.v3_18))return i.v3_18;return n.ZeroStr},e.prototype.downgrade=function(e,t){if(n.lt(t,i.v3_18)){var r=e.config;r.themeCollection.customTheme&&(e.theme=r.themeCollection.customTheme.name),r.themeCollection.baseTheme&&(r.baseTheme=r.themeCollection.baseTheme.name),delete r.themeCollection}},e})();t.ExplorationConfigDowngrader=a})(r=t.explorationConfig||(t.explorationConfig={}))})(r=t.downgrade||(t.downgrade={}))})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){var r;!(function(t){var r=e.explore.services.upgrade.ExplorationVersions,i=jsCommon.Version,n=jsCommon.JsonExtensions,a=(function(){function e(){}return e.prototype.getMinDowngradeVersionForContract=function(e){for(var t=i.ZeroStr,n=0,a=e.sections;n<a.length;n++){var o=a[n];if(1===o.type){if(!o.acceptsAllFiltersWhenLinked){t=r.v3_14;break}var s=o.filters;if(_.some(s,(function(e){return 5===e.howCreated&&!e.isTransient&&e.filter}))){t=r.v3_14;break}t=r.v3_13}}return t},e.prototype.downgrade=function(e,t){if(i.lt(t,r.v3_14))for(var n=0,a=e.sections;n<a.length;n++){var o=a[n];this.tryDowngradeSection(o)}},e.prototype.tryDowngradeSection=function(e){var t=e.config,r=e.filters?n.tryParseJSON(e.filters):[];1===t.type&&r&&(t.linkFields=_.remove(r,(function(e){return 5===e.howCreated})).map((function(e){return{fieldExpr:e.expression,asAggregation:e.isLinkedAsAggregation}})),e.filters=JSON.stringify(r))},e})();t.SectionLinkFieldDowngrader=a})(r=t.downgrade||(t.downgrade={}))})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(r){var i;!(function(r){var i;!(function(r){var i=e.data.services.wireContracts.DataViewObjectDefinitions,n=e.explore.services.upgrade.ExplorationVersions,a=e.data.PrimitiveValueEncoding,o=e.explore.services.upgrade,s=jsCommon.Version,l=(function(){function r(){}return r.prototype.getMinDowngradeVersionForContract=function(e){for(var t=0,r=e.sections;t<r.length;t++)for(var i=r[t],a=0,o=i.visualContainers;a<o.length;a++){var l=o[a],u=l.config.singleVisual.vcObjects;if(this.checkObjectsForThemeRelative(u))return n.v3_15}return s.ZeroStr},r.prototype.checkObjectsForThemeRelative=function(r){var i=!1;if(r){var n=function(t){e.data.SQExpr.isThemeDataColor(t)&&(i=!0)};e.data.DataViewObjectDefinitions.visitPropertyExprs({definitions:r,descriptors:t.contracts.VisualContainer.CommonObjectDescriptors,visitor:n})}return i},r.prototype.downgrade=function(e,t){if(s.lt(t,n.v3_19))for(var r=0,a=e.sections;r<a.length;r++)for(var l=a[r],u=0,c=l.visualContainers;u<c.length;u++){var p=c[u],f=p.config,d=f&&f.singleVisual,h=d&&d.vcObjects;if(h&&s.lt(t,n.v3_15)){if(h.background){var v=i.getObjectDefinitionProperties(h,"background");d.background={color:this.getValueFromExpr(v.color),show:this.getValueFromExpr(v.show),transparency:this.getValueFromExpr(v.transparency)}}if(h.border){var m=i.getObjectDefinitionProperties(h,"border");d.border={color:this.getValueFromExpr(m.color),show:this.getValueFromExpr(m.show)}}if(h.general){var g=i.getObjectDefinitionProperties(h,"general");d.altText=this.getValueFromExpr(g.altText)}if(h.lockAspect){var y=i.getObjectDefinitionProperties(h,"lockAspect");d.aspectRatio={show:this.getValueFromExpr(y.show)}}if(h.stylePreset){var C=i.getObjectDefinitionProperties(h,"stylePreset");d.stylePresetName=this.getValueFromExpr(C.name)}if(h.title){var x=i.getObjectDefinitionProperties(h,"title");d.title={alignment:this.getValueFromExpr(x.alignment),background:this.getValueFromExpr(x.background),fontColor:this.getValueFromExpr(x.fontColor),fontFamily:this.getValueFromExpr(x.fontFamily),fontSize:this.getValueFromExpr(x.fontSize),show:this.getValueFromExpr(x.show),text:this.getValueFromExpr(x.text)}}if(h.visualLink){var b=i.getObjectDefinitionProperties(h,"visualLink");d.visualLink={type:this.getValueFromExpr(b.type),bookmark:this.getValueFromExpr(b.bookmark),qna:b.qna,show:this.getValueFromExpr(b.show)}}if(h.visualTooltip){var S=i.getObjectDefinitionProperties(h,"visualTooltip");d.visualTooltip={section:this.getValueFromExpr(S.section),type:this.getValueFromExpr(S.type)}}delete d.vcObjects}var E=d&&d.objects,w=d&&d.visualType;if(E&&_.includes(o.DefaultCategoryColorVisualsToUpgrade,w)&&s.lt(t,n.v3_19)){var F=i.getObjectDefinitionProperties(E,"dataPoint"),V=F&&F.fill;V&&(F.defaultCategoryColor=F.fill,delete F.fill)}}},r.prototype.getValueFromExpr=function(e){if(null!=e){var t=e,r=e;if(t.solid&&t.solid.color&&(r=t.solid.color),r.expr&&r.expr.Literal)return a.parseTypeEncodedValue(r.expr.Literal.Value)}},r})();r.VisualContainerConfigDowngrader=l})(i=r.visualContainerProperties||(r.visualContainerProperties={}))})(i=r.downgrade||(r.downgrade={}))})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(r){
function i(e,t,r){return new O(e,t,r)}function n(t){if(t.visualType!==e.visuals.plugins.scatterChart.name)return!1;var r=e.visuals.scatterRoleNames.x,i=t.query,n=i?i.getRolesProjectionRefs([r]):void 0,a=_.size(n);if(a>1)return!0;if(1===a){var o=i.tryGetExpr(r,0);if(o&&!F.isMeasure(o))return!0}return!1}var a=jsCommon.ArrayExtensions,o=e.explore.contracts.Bookmark,s=e.explore.contracts,l=e.explore.services.upgrade.CurrentExplorationVersion,u=e.common.contracts.DataCacheModeType,c=e.data.DataViewObjectDefinitions,p=e.data.services.DataViewObjectSerializer,f=e.data.ExpansionState,d=e.data.services.ExpansionStateSerializer,h=e.explore.services.upgrade.ExplorationFeatureVersions,v=e.explore.services.upgrade.ExplorationStateVersions,m=e.explore.services.upgrade.ExplorationVersions,g=s.FilterContainer.ObjectType,y=s.FilterContainer.CommonObjectDescriptors,C=jsCommon.JsonExtensions,x=e.data.QueryProjectionCollection,b=e.contracts.ResourcePackageItemType,S=e.visualHost.utils.ResourcePackageUtils,E=e.data.services.SemanticQuerySerializer,w=e.data.SQExpr,F=e.data.SQExprUtils,V=jsCommon.StringExtensions,P=e.visualHost.ThemeUtils,D=jsCommon.Version,R=s.VisualContainer,T=t.util.VisualContainerUtils,N=s.VisualQuery,I="Gradient",j="Size";r.createExplorationSerializer=i;var O=(function(){function i(e,t,i){this.visualPlugins=e,this.telemetryService=t,this.explorationUpgrader=r.upgrade.createExplorationUpgrader(i),this.explorationDowngrader=r.downgrade.createExplorationDowngrader()}return i.prototype.deepCopyExploration=function(e,t){return this.deserializeExploration(this.serializeExploration(e,t),[],!0)},i.prototype.ensureInitialized=function(){return this.visualPlugins.ensureBuiltInPlugins()},i.prototype.deserializeExploration=function(t,r,i,n,a){var o,l=this;if(t){var c=this.explorationUpgrader.upgrade(t,r,i,a);if(!c)return;var f=c.config;if(o={id:c.id,width:void 0,height:void 0,sections:void 0,dataSources:void 0,reportId:c.reportId,themeCollection:P.cloneThemeCollection(f.themeCollection),bookmarks:[]},f.tags&&(o.tags=_.cloneDeep(f.tags)),f.slowDataSourceSettings&&(o.slowDataSourceSettings=_.cloneDeep(f.slowDataSourceSettings)),f.settings&&(o.settings=_.cloneDeep(f.settings)),f.objects&&(o.objects=p.deserializeObjects(f.objects,s.ExplorationObjectDescriptors)),f.bookmarks&&this.defineProperty(o,"bookmarks",(function(){var e=l.deserializeBookmarks(f.bookmarks);return e})),c.userState&&(o.userState=this.deserializeUserState(c.userState)),c.activeWebBookmark&&(o.activeWebBookmark=this.deserializeWebBookmark(c.activeWebBookmark,i)),c.sections){var d=_.sortBy(c.sections,(function(e){return void 0!==e.ordinal?e.ordinal:0}));if(o.sections=_.map(d,(function(e){return l.deserializePage(e)})),o.filters=this.deserializeFilterContainers(c.filters),o.dataSources=s.createDataSourceArray(),c.resourcePackages&&(o.resourcePackages=this.deserializeResourcePackages(c.resourcePackages)),c.pods&&(o.pods=_.map(c.pods,(function(e){return l.deserializePod(e)}))),_.isNumber(f.activeSectionIndex)&&f.activeSectionIndex<c.sections.length&&(o.activeSectionIndex=f.activeSectionIndex),f.modelExtensions&&(o.modelExtensions=this.deserializeModelExtensions(f.modelExtensions)),n)if(n.lastTimeAModelChangeWasDetectedInTheCluster&&!_.isEmpty(n.onPremModelConnectionString)){var h=jsCommon.DateExtensions.deserializeDate(n.lastTimeAModelChangeWasDetectedInTheCluster);this.updateVisualContainerCachingOptions(o,h,(function(e){e.useInitialCachedQuery=!0}),(function(e){e.useInitialCachedQuery=!1}))}else if(_.isEmpty(n.onPremModelConnectionString)&&n.dataCacheMode===u.Import&&n.lastRefreshTime){var h=jsCommon.DateExtensions.deserializeDate(n.lastRefreshTime);this.updateVisualContainerCachingOptions(o,h,(function(e){e.disableCacheOnServerForInitialLoad=!0}),(function(e){e.disableCacheOnServerForInitialLoad=!1}))}}c.report&&(o.report=e.Prototype.inherit(c.report),c.report.linguisticSchemaId&&(o.reportHasLinguisticSchema=!0)),null!=f.defaultDrillFilterOtherVisuals&&(o.defaultDrillFilterOtherVisuals=f.defaultDrillFilterOtherVisuals)}return o},i.prototype.defineProperty=function(e,t,r){var i;Object.defineProperty(e,t,{get:function(){return i||(i=r()),i},set:function(e){i=e},enumerable:!0,configurable:!0})},i.prototype.updateVisualContainerCachingOptions=function(e,t,r,i){for(var n=0,a=e.sections;n<a.length;n++)for(var o=a[n],s=0,l=o.visualContainers;s<l.length;s++){var u=l[s];if(u.cachedData&&u.cachedData.dataUpdatedTime&&u.cachedData.data){var c=+u.cachedData.dataUpdatedTime-+t;c>=0?r(u):i(u)}else i(u)}},i.prototype.deserializeResourcePackages=function(e){for(var t=[],r=0,i=e;r<i.length;r++){var n=i[r];this.upgradeResourcePackage(n.resourcePackage),t.push(n.resourcePackage)}for(var a=0;a<t.length;++a)if(t[a])for(var o=t.length;--o>a;)t[o]&&t[a].name===t[o].name&&(t[o].id>t[a].id&&(t[a]=t[o]),t.splice(o,1));return t},i.prototype.deserializeLinkField=function(e){var t=E.deserializeExpr(e.fieldExpr);return{asAggregation:e.asAggregation,fieldExpr:t}},i.prototype.deserializePage=function(e){var r=this;if(e){var i={id:e.id,objectId:e.objectId,name:e.name,displayName:e.displayName,visualContainers:void 0,size:{displayOption:void 0!==e.displayOption?e.displayOption:0,height:e.height||t.constants.ExploreCanvasConstants.DefaultCanvasHeight,width:e.width||t.constants.ExploreCanvasConstants.DefaultCanvasWidth},filters:this.deserializeFilterContainers(e.filters)};e.transient&&(i.transient=e.transient);var n=e.config;if(i.acceptsAllFiltersWhenLinked=n.acceptsAllFiltersWhenLinked,n.objects&&(i.objects=p.deserializeObjects(n.objects,s.Section.objectDescriptors)),null!=n.visibility&&(i.visibility=n.visibility),null!=n.type&&(i.type=n.type),_.isEmpty(n.linkFields)||(i.linkFields=_.map(n.linkFields,(function(e){return r.deserializeLinkField(e)}))),e.visualContainers){i.visualContainers=[];for(var a=0,o=e.visualContainers;a<o.length;a++){var l=o[a],u=this.deserializeVisualContainer(l);u&&i.visualContainers.push(u)}this.ensureNames(i.visualContainers),n.relationships&&(i.relationships=this.deserializeRelationships(n.relationships,i.visualContainers))}return i}},i.prototype.deserializePod=function(e){if(e)return{id:e.id,name:e.name,boundSection:e.boundSection,parameters:this.deserializePodParameters(e.parameters),cortanaEnabled:e.cortanaEnabled}},i.prototype.deserializeRelationships=function(e,t){if(!_.isEmpty(e)){for(var r,i=0,n=e;i<n.length;i++){var a=n[i],o=this.deserializeRelationship(a,t);o&&(r||(r=[])).push(o)}return r}},i.prototype.deserializeBookmarks=function(e){var t=this;if(e)return _.map(e,(function(e){if(t.isBookmarkGroup(e)){return{displayName:e.displayName,name:e.name,children:t.deserializeBookmarks(e.children)}}var i=e.explorationState,n={displayName:e.displayName,name:e.name,explorationState:r.ExplorationState.deserialize(i)};return e.options&&(n.options=t.deserializeBookmarkOptions(e.options)),n}))},i.prototype.deserializeBookmarkOptions=function(e){return e},i.prototype.deserializeUserState=function(t){if(!V.isNullOrUndefinedOrWhiteSpaceString(t)){var i=C.tryParseJSON(t);if(i)try{return r.UserState.deserialize(i)}catch(t){return t&&this.telemetryService.logEvent(e.telemetry.PersistentStateSerializationError,t.stack,t.message),{explorationState:null}}}},i.prototype.deserializeWebBookmark=function(t,i){var n=r.WebBookmark.deserialize(t);if(n.errors&&!i)for(var a=0,o=n.errors;a<o.length;a++){var s=o[a];this.telemetryService.logEvent(e.telemetry.SerializationError,"WebBookmark",s.code,void 0,s.stack,s.message)}return n.contract},i.prototype.deserializeModelExtensions=function(e){var t=this;return a.extendWithName(_.map(e,(function(e){var r={name:e.name,extends:e.extends};return e.entities&&(r.entities=t.deserializeModelExtensionEntities(e.entities)),r})))},i.prototype.deserializeModelExtensionEntities=function(e){var t=this;return a.extendWithName(_.map(e,(function(e){var r;return r=e.extends?{name:e.name,extends:e.extends}:{name:e.name},e.measures&&(r.measures=t.deserializeModelExtensionMeasures(e.measures)),r})))},i.prototype.deserializeModelExtensionMeasures=function(e){var t=this;return a.extendWithName(_.map(e,(function(e){var r={name:e.name,dataCategory:e.dataCategory,dataType:e.dataType,expression:e.expression,errorMessage:e.errorMessage,hidden:e.hidden,references:t.deserializeExpressionReferences(e.references),formulaOverride:e.formulaOverride,formatInformation:e.formatInformation};return e.annotations&&(r.annotations=t.deserializeModelExtensionAnnotations(e.annotations)),e.measureTemplate&&(r.measureTemplate={daxTemplateName:e.measureTemplate.daxTemplateName,version:e.measureTemplate.version}),e.description&&(r.description=e.description),r})))},i.prototype.deserializeExpressionReferences=function(e){return e?{unrecognizedReferences:!!e.unrecognizedReferences,measures:e.measures||[]}:{unrecognizedReferences:!1,measures:[]}},i.prototype.deserializeModelExtensionAnnotations=function(e){return a.extendWithName(_.map(e,(function(e){return{name:e.name,value:e.value}})))},i.prototype.deserializeFilterCollection=function(e,t,r){if(e){var i=this.explorationUpgrader.upgradeFilterCollection(e,t,r);if(i)return this.deserializeFilterContainers(i.filters)}},i.prototype.deserializeFilterContainer=function(e){return{name:e.name,type:s.FilterType[e.type],expression:e.expression?E.deserializeExpr(e.expression):void 0,filter:e.filter&&e.filter.Where?E.deserializeFilter(e.filter):void 0,restatement:e.restatement,cachedValueItems:r.DisplayNameSerializer.deserializeFilterLabelIdPairs(e.cachedDisplayNames),howCreated:e.howCreated,isLinkedAsAggregation:e.isLinkedAsAggregation,isTransient:e.isTransient,isHiddenInViewMode:e.isHiddenInViewMode,objects:e.objects?p.deserializeObjects(e.objects,y):void 0,isLockedInViewMode:e.isLockedInViewMode}},i.prototype.deserializeVisualContainer=function(t,r,i){var n,o=t.config;if(!o||!o.singleVisual)return void this.telemetryService.logEvent(e.telemetry.EXEmptyVisualContainerConfig);var s={name:i||o.name,id:r?void 0:t.id,layouts:a.createWithId(),config:{singleVisual:this.deserializeSingleVisual(o.singleVisual,t.prototypeQuery)}};null!=t.visibility&&(s.visibility=t.visibility),null!=t.detailVisualLayout&&(s.detailVisualLayout=t.detailVisualLayout),void 0===t.dataBinaryBase64Encoded&&void 0===t.query&&void 0===t.dataTransforms||(s.cachedData={data:t.dataBinaryBase64Encoded,query:t.query,transforms:t.dataTransforms,dataUpdatedTime:t.dataUpdatedTime?jsCommon.DateExtensions.parseUtcDate(t.dataUpdatedTime):void 0}),s.filters=this.deserializeFilterContainers(t.filters);var l=o.singleVisual.drillFilterOtherVisuals;return null!=l&&(s.drillFilterOtherVisuals=l),(n=s.layouts).push.apply(n,_.cloneDeep(o.layouts)),s},i.prototype.deserializeRelationship=function(e,t){var r=a.findItemWithName(t,e.source),i=a.findItemWithName(t,e.target);if(0!==e.type&&r&&i)return{source:r,target:i,type:e.type}},i.prototype.deserializeFilterContainers=function(e){var t=this;if(!V.isNullOrUndefinedOrWhiteSpaceString(e)){var r=[],i=C.tryParseJSON(e);return i&&(r=i.map((function(e){return t.deserializeFilterContainer(e)}))),r}},i.prototype.deserializePodParameters=function(e){var t=this,r=[];if(!V.isNullOrUndefinedOrWhiteSpaceString(e)){var i=C.tryParseJSON(e);i&&(r=i.map((function(e){return t.deserializePodParameter(e)})))}return r},i.prototype.deserializePodParameter=function(e){return{name:e.name,boundFilter:e.boundFilter}},i.prototype.deserializeVisualQuery=function(e,t,r,i,n){var a=new N(t,this.convertProjections(r,t.select(),n),d.deserializeExpansionStates(i));this.upgradeVisualQuery(a,e.visualType),e.query=a},i.prototype.deserializeSingleVisual=function(e,t){var i={visualType:e.visualType||e.visualConfig.visualType},n=e.visualConfig?e.visualConfig.projections:void 0,a=e.projections||{};if(n)for(var o=0,s=n;o<s.length;o++){var l=s[o],u=a[l.role];u||(u=[],a[l.role]=u),u.push(l)}else if(a&&a.length>0){n=a,a={};for(var f=0,d=n;f<d.length;f++){var l=d[f],u=a[l.role];u||(u=[],a[l.role]=u),u.push(l)}}var h=e.prototypeQuery?e.prototypeQuery:t?C.tryParseJSON(t):null;if(h){var v=E.deserializeQuery(h);this.deserializeVisualQuery(i,v,a,e.expansionStates,e.showAllRoles)}var m=e.display;null!=e.display&&(i.display=m),e.columnProperties&&(i.columnProperties=_.cloneDeep(e.columnProperties));var g=e.queryOptions;g&&(i.queryOptions=_.cloneDeep(g));var y=e.syncGroup;null!=y&&(i.syncGroup=_.cloneDeep(y));var x=e.hasDefaultSort;null!=x&&(i.hasDefaultSort=x);var b=this.visualPlugins.capabilities(i.visualType);if(b&&e.objects)i.objects=p.deserializeObjects(e.objects,b.objects);else{var S=e.objects;S&&(i.objects=p.deserializeObjects(S,null))}if(e.vcObjects){i.vcObjects=p.deserializeObjects(e.vcObjects,R.CommonObjectDescriptors);var w=c.getObjectDefinition(i.vcObjects,"visualLink",void 0);if(w){var F=e.vcObjects.visualLink[0].properties.qna,V=F&&F.suggestedUtterances;_.isEmpty(V)||(w.properties.qna={suggestedUtterances:_.map(V,(function(e){return r.UtteranceDefinitionSerializer.deserialize(e)}))})}}return e.cachedFilterDisplayItems&&(i.cachedFilterDisplayItems=r.DisplayNameSerializer.deserializeFilterLabelIdPairs(e.cachedFilterDisplayItems)),i},i.prototype.isBookmarkGroup=function(e){return void 0!==e.children},i.prototype.ensureNames=function(e){for(var t,r=e.length,i={},n=0;n<r;n++){var a=e[n].name;_.isEmpty(a)?t=!0:i[a]=!0}if(t)for(var n=0;n<r;n++){var o=e[n],s=o.name;_.isEmpty(s)&&(o.name=T.nextUniqueName(i),i[o.name]=!0)}},i.prototype.convertProjections=function(e,t,r){var i={};for(var n in e){var a=_.includes(r,n);i[n]=this.convertProjectionArray(e[n],t,a)}return i},i.prototype.convertProjectionArray=function(e,t,r){for(var i,n=[],a=0,o=e;a<o.length;a++){var s=o[a],l=this.convertProjection(s,t);s.active&&(i=i||[],i.push(l.queryRef)),n.push(l)}return new x(n,i,r)},i.prototype.convertProjection=function(e,t){var r=e.queryRef;_.isNumber(e.queryRef)&&(r=t[e.queryRef].name);var i={queryRef:r};return e.format&&(i.format=e.format),i},i.prototype.serializeExploration=function(e,t){return new M(this.visualPlugins,this.explorationDowngrader,this.telemetryService).serializeExploration(e,t)},i.prototype.serializeModelExtensions=function(e){return new M(this.visualPlugins,this.explorationDowngrader,this.telemetryService).serializeModelExtensions(e)},i.prototype.serializePage=function(e,t,r){return new M(this.visualPlugins,this.explorationDowngrader,this.telemetryService).serializePage(e,t,r)},i.prototype.serializePageShallow=function(e,t,r){return new M(this.visualPlugins,this.explorationDowngrader,this.telemetryService).serializePageShallow(e,t,r)},i.prototype.serializeVisualContainer=function(e,t){return new M(this.visualPlugins,this.explorationDowngrader,this.telemetryService).serializeVisualContainer(e,t)},i.prototype.serializePod=function(e){return new M(this.visualPlugins,this.explorationDowngrader,this.telemetryService).serializePod(e)},i.prototype.serializeFilterCollection=function(e){return new M(this.visualPlugins,this.explorationDowngrader,this.telemetryService).serializeFilterCollection(e)},i.prototype.serializeResourcePackages=function(e){return new M(this.visualPlugins,this.explorationDowngrader,this.telemetryService).serializeResourcePackages(e)},i.prototype.upgradeVisualQuery=function(r,i){if(i===e.visuals.plugins.filledMap.name&&r.projections[I]){var n=r.projections[I],a=r.projections[j];if(a&&a.all.length>0)for(var o=a.all().length,s=o-1;s>=0;s--)r.removeProjection(j,s);r.projections[j]=n,delete r.projections[I]}var l=this.visualPlugins.capabilities(i);if(l){var u=t.util.DrillUtils.getDrillableRoles(l),c=r.ensureDrillableRoles(u);if(!_.isEmpty(c)){for(var p={},f=0,d=c;f<d.length;f++){var h=d[f],v=r.projections[h],m=0;v&&(m=_.size(v.all())),p[h]=m}this.telemetryService.logEvent(e.telemetry.EXVisualDrillableRoleActiveItemsFixed,i,JSON.stringify(p))}}},i.prototype.upgradeResourcePackage=function(e){void 0===e.type&&(e.type=0)},i.prototype.getReferencedStaticResources=function(e){var t={},i=e.themeCollection.customTheme,n=e.themeCollection.baseTheme;if(this.addItemReference(t,e.resourcePackages,i&&i.type,i&&i.name),this.addItemReference(t,e.resourcePackages,n&&n.type,n&&n.name),!_.isEmpty(e.sections))for(var a=0,o=e.sections;a<o.length;a++){var l=o[a];if(r.StaticResourceReferences.addObjectsReferences(l.objects,s.Section.objectDescriptors,e.resourcePackages,t),!_.isEmpty(l.visualContainers))for(var u=0,c=l.visualContainers;u<c.length;u++){var p=c[u],f=p.config.singleVisual,d=f.objects,h=this.visualPlugins.capabilities(f.visualType);r.StaticResourceReferences.addObjectsReferences(d,h&&h.objects,e.resourcePackages,t)}}return t},i.prototype.addItemReference=function(e,t,i,n){if(n&&i){var a=S.findItemInPackages(t,i,n);if(a){var o=S.ensurePackageName(i);r.StaticResourceReferences.addItemReference(e,o,i,n,a.type)}}},i.prototype.parseExplorationConfigs=function(e){var t=this;if(e){var r=this.parseConfig(e);return r.sections=_.map(e.sections,(function(e){return t.parsePageConfigs(e)})),r}},i.prototype.parseConfig=function(e){var t=_.clone(e);return t.config=C.tryParseJSON(e.config)||{},t},i.prototype.parsePageConfigs=function(e){var t=this,r=this.parseConfig(e);return r.visualContainers=_.map(e.visualContainers,(function(e){return t.parseConfig(e)})),r},i.prototype.stringifyExplorationConfigs=function(e){var t=this,r=this.stringifyConfig(e);return r.sections=_.map(e.sections,(function(e){return t.stringifyPageConfigs(e)})),r},i.prototype.stringifyConfig=function(e){var t=_.clone(e);return t.config=JSON.stringify(e.config),t},i.prototype.stringifyPageConfigs=function(e){var t=this,r=this.stringifyConfig(e);return r.visualContainers=_.map(e.visualContainers,(function(e){return t.stringifyConfig(e)})),r},i.prototype.parseFilterCollectionConfig=function(e){if(e)return this.parseConfig(e)},i.prototype.stringifyFilterCollectionConfig=function(e){if(e)return this.stringifyConfig(e)},i})();r.OldestSaveVersion=m.v3_14;var M=(function(){function t(e,t,i){this.visualPlugins=e,this.explorationDowngrader=t,this.telemetryService=i,this.version=r.OldestSaveVersion}return t.prototype.serializeExploration=function(e,t){var r=this,i=e.sections;t&&t.withTransientPages||(i=s.Section.filterTransient(i));var n,a=_.map(i,(function(e,i){return r.serializePage(e,i,t)}));_.isEmpty(e.pods)||(n=_.map(e.pods,(function(e){return r.serializePod(e)})));var o=this.serializeExplorationShallowWithResourcePackages(e,t);return o.sections=a,o.pods=n,t&&t.forSave&&this.explorationDowngrader.downgrade(o,this.version),o},t.prototype.serializeBookmarks=function(e,t){var i=this;if(e){var n=v.v1_0,a=_.map(e,(function(e){if(o.isBookmarkGroup(e)){var a={displayName:e.displayName,name:e.name,children:i.serializeBookmarks(e.children,t)};return i.version=D.max(i.version,h.BookmarkGroup),a}r.ExplorationState.clearUnusedReferences(e.explorationState,t);var s={displayName:e.displayName,name:e.name,explorationState:r.ExplorationState.serialize(e.explorationState)};return n=D.max(s.explorationState.version,n),e.options&&(s.options=i.serializeBookmarkOptions(e.options),i.version=D.max(i.version,h.BookmarkOptions)),s}));switch(n){case v.v1_0:this.version=D.max(this.version,h.bookmarks);break;case v.v1_1:this.version=D.max(this.version,h.ExplorationState_v1_1);break;case v.v1_2:this.version=D.max(this.version,h.ExplorationState_v1_2);break;case v.v1_3:this.version=D.max(this.version,h.ExplorationState_v1_3)}return a}},t.prototype.serializeBookmarkOptions=function(e){return e},t.prototype.serializeQnaAction=function(e){if(e){var t=e.suggestedUtterances;if(!_.isEmpty(t)){return{suggestedUtterances:_.map(t,(function(e){return r.UtteranceDefinitionSerializer.serialize(e)}))}}}},t.prototype.serializeExplorationShallowWithResourcePackages=function(e,t){var i=e.activeSectionIndex,n=this.createVersionedElementConfig(r.OldestSaveVersion);if(this.version=D.max(this.version,n.version),n.themeCollection=P.cloneThemeCollection(e.themeCollection),_.isNumber(i)&&(n.activeSectionIndex=i),_.isEmpty(e.modelExtensions)||(this.version=D.max(this.version,m.v3_0),n.modelExtensions=this.serializeModelExtensions(e.modelExtensions)),!_.isEmpty(e.bookmarks)){var a=this.serializeBookmarks(e.bookmarks,e);n.bookmarks=a}t&&t.excludeHighContrastTheme&&delete n.themeCollection.highContrastTheme;var o=e.themeCollection.baseTheme;if(o&&(this.version=D.max(this.version,r.upgrade.getVersionForBaseTheme(o.name))),e.tags&&(n.tags=e.tags),null!=e.defaultDrillFilterOtherVisuals&&(n.defaultDrillFilterOtherVisuals=e.defaultDrillFilterOtherVisuals,e.defaultDrillFilterOtherVisuals&&(this.version=D.max(this.version,h.SectionCrossDrill))),e.slowDataSourceSettings){var u=_.cloneDeep(e.slowDataSourceSettings);(u.isCrossHighlightingDisabled||u.isFieldWellButtonEnabled||u.isFilterSelectionsButtonEnabled||u.isSlicerSelectionsButtonEnabled)&&(this.version=D.max(this.version,h.slowDataSource)),n.slowDataSourceSettings=u}if(e.settings){var c=_.cloneDeep(e.settings);(c.isPersistentUserStateDisabled||c.hideVisualContainerHeader)&&(this.version=D.max(this.version,h.ExplorationSettings)),c.useStylableVisualContainerHeader&&(this.version=D.max(this.version,h.StylableVisualContainerHeader)),void 0!==c.exportDataMode&&0!==c.exportDataMode&&(this.version=D.max(this.version,h.ExportDataMode)),c.useNewFilterPaneExperience&&(this.version=D.max(this.version,h.NewFilterPaneExperience)),c.isReportAnnotationsEnabled===!1&&(this.version=D.max(this.version,h.ReportAnnotations)),n.settings=c}e.objects&&(n.objects=this.serializeObjects(e.objects,s.ExplorationObjectDescriptors,"report")),t&&t.forSave?this.version=this.explorationDowngrader.getFinalExplorationVersion(e,this.version):this.version=l;var p=this.serializeFilterContainers(e.filters);return n.version=this.version,{id:e.id,reportId:e.reportId,theme:e.themeCollection.customTheme&&e.themeCollection.customTheme.name,filters:p,resourcePackages:this.serializeResourcePackages(e.resourcePackages,t),sections:void 0,config:n,layoutOptimization:this.getLayoutOptimizations(e)}},t.prototype.serializeLinkField=function(e){var t=e.fieldExpr;return{asAggregation:e.asAggregation,fieldExpr:E.serializeExpr(t)}},t.prototype.serializeFilterCollection=function(e){if(!_.isEmpty(e)){var t=this.createVersionedElementConfig(r.OldestSaveVersion);return{filters:this.serializeFilterContainers(e),config:t}}},t.prototype.serializePage=function(e,t,r){var i=this.serializePageShallow(e,t,r);i.visualContainers=[];for(var n=0,a=e.visualContainers;n<a.length;n++){var o=a[n];i.visualContainers.push(this.serializeVisualContainer(o,r))}return i},t.prototype.isRegularPageUsingMeasureDrillthrough=function(e){var t=!1,r=!1;return e.type&&0!==e.type||(t=e.acceptsAllFiltersWhenLinked,r=_.some(e.filters,(function(e){return 5===e.howCreated&&!e.isTransient&&(e.isLinkedAsAggregation||e.expression&&w.isMeasure(e.expression))}))),t||r},t.prototype.serializePageShallow=function(e,t,r){var i=this,n={id:e.id,name:e.name,displayName:e.displayName,filters:this.serializeFilterContainers(e.filters,r),ordinal:t,visualContainers:void 0,transient:e.transient,objectId:e.objectId,config:{}};e.size&&(n.displayOption=e.size.displayOption,n.width=e.size.width,n.height=e.size.height);var a=n.config;return _.isEmpty(e.relationships)||(a.relationships=this.serializeRelationships(e.relationships),r&&r.featureUsage&&(r.featureUsage.hasVisualRelationships=!0)),e.objects&&(a.objects=this.serializeObjects(e.objects,s.Section.objectDescriptors,"page")),null!=e.visibility&&(a.visibility=e.visibility,this.version=D.max(this.version,h.SectionVisibility)),null!=e.type&&(a.type=e.type,this.version=D.max(this.version,h.CanvasTooltips)),a.acceptsAllFiltersWhenLinked=e.acceptsAllFiltersWhenLinked,this.isRegularPageUsingMeasureDrillthrough(e)&&(this.version=D.max(this.version,h.MeasureDrillthrough)),_.isEmpty(e.linkFields)||(a.linkFields=_.map(e.linkFields,(function(e){return i.serializeLinkField(e)})),this.version=D.max(this.version,h.CanvasTooltips)),n},t.prototype.serializePod=function(e){var t=this.serializePodParameters(e.parameters);return{id:e.id,name:e.name,boundSection:e.boundSection,parameters:_.isEmpty(t)?void 0:JSON.stringify(t),cortanaEnabled:e.cortanaEnabled?e.cortanaEnabled:void 0}},t.prototype.serializeVisualContainer=function(t,r){var i,n=this.serializeVisualContainerConfig(t,r),a=t.layouts&&t.layouts.withId(0);return i=a?{id:t.id,x:a.position.x,y:a.position.y,z:a.position.z,width:a.position.width,height:a.position.height,config:n,filters:this.serializeFilterContainers(t.filters)}:{id:t.id,config:n,filters:this.serializeFilterContainers(t.filters)},r&&r.withVisibility&&(null!=t.visibility&&(i.visibility=t.visibility),null!=t.detailVisualLayout&&(i.detailVisualLayout=t.detailVisualLayout)),r&&t.cachedData&&((r.withQuery||r.withData)&&(i.query=t.cachedData.queryObject?JSON.stringify(t.cachedData.queryObject):t.cachedData.query,i.dataTransforms=t.cachedData.transformsObject?e.data.services.DataViewTransformActionsSerializer.serializeTransformActions(t.cachedData.transformsObject):t.cachedData.transforms,i.dataUpdatedTime=t.cachedData.dataUpdatedTime?t.cachedData.dataUpdatedTime.toISOString():void 0),r.withData&&(i.dataBinaryBase64Encoded=t.cachedData.dataObject?jsCommon.GzipUtility.compress(JSON.stringify(t.cachedData.dataObject)):t.cachedData.data)),i},t.prototype.serializeModelExtensions=function(e){var t=this;if(e)return _.map(e,(function(e){return{name:e.name,extends:e.extends,entities:t.serializeModelExtensionEntities(e.entities)}}))},t.prototype.serializeRelationship=function(e){return{source:e.source.name,target:e.target.name,type:e.type}},t.prototype.serializeVisualContainerConfig=function(t,i){var a=t.config&&t.config.singleVisual,o=a.query,s={name:t.name,layouts:_.cloneDeep(t.layouts),singleVisual:{visualType:a.visualType,projections:this.serializeQueryProjections(o?o.projections:void 0),prototypeQuery:o?E.serializeQuery(o.defn):void 0}};if(_.some(t.layouts,(function(e){return e.position&&void 0!==e.position.tabOrder}))&&(this.version=D.max(this.version,h.VisualTabOrders)),o&&f.hasExpansionState(o.expansionStates)){var l=d.serializeExpansionStates(o.expansionStates);_.isEmpty(l)||(s.singleVisual.expansionStates=l,this.version=D.max(this.version,h.ExpandCollapse))}var u=a.columnProperties;if(u&&!_.isEmpty(u)&&(this.version=D.max(this.version,m.v3_4),s.singleVisual.columnProperties=_.cloneDeep(u)),a.queryOptions&&(null!=a.queryOptions.allowBinnedLineSample&&(this.version=D.max(this.version,m.v3_3)),null!=a.queryOptions.allowOverlappingPointsSample&&(this.version=D.max(this.version,m.v3_5)),s.singleVisual.queryOptions=_.cloneDeep(a.queryOptions)),a.display&&(this.version=D.max(this.version,h.visualHidden),s.singleVisual.display=_.cloneDeep(a.display)),o&&o.defn){var p=o.defn.select();_.some(p,(function(e){return w.isFilteredEval(e.expr)}))&&(this.version=D.max(this.version,m.v3_5))}var v=this.serializeShowAllRoles(o?o.projections:void 0);if(_.isEmpty(v)||(s.singleVisual.showAllRoles=v,i&&i.featureUsage&&(i.featureUsage.hasShowAllEnabled=!0)),a.visualType===e.visuals.plugins.ribbonChart.name&&(this.version=D.max(this.version,m.v3_5)),a.visualType===e.visuals.plugins.actionButton.name&&(this.version=D.max(this.version,h.ActionButton)),a.visualType===e.visuals.plugins.pythonVisual.name&&(this.version=D.max(this.version,m.v3_17)),a.syncGroup&&(s.singleVisual.syncGroup=_.cloneDeep(a.syncGroup),this.version=D.max(this.version,h.VisualSyncGroup)),null!=t.drillFilterOtherVisuals&&(s.singleVisual.drillFilterOtherVisuals=t.drillFilterOtherVisuals,this.version=D.max(this.version,h.SectionCrossDrill)),a.hasDefaultSort&&(s.singleVisual.hasDefaultSort=a.hasDefaultSort),a.objects){var g=this.visualPlugins.capabilities(a.visualType);s.singleVisual.objects=this.serializeObjects(a.objects,g&&g.objects,a.visualType)}var y=a.vcObjects;if(y){s.singleVisual.vcObjects=this.serializeObjects(y,R.CommonObjectDescriptors,"visualContainer");var C=c.getObjectDefinition(y,"visualLink",void 0),x=C&&C.properties.qna;x&&(s.singleVisual.vcObjects.visualLink[0].properties.qna=this.serializeQnaAction(x))}return a.cachedFilterDisplayItems&&(s.singleVisual.cachedFilterDisplayItems=r.DisplayNameSerializer.serializeFilterLabelIdPairs(a.cachedFilterDisplayItems)),this.version<h.DotPlotVisual&&n(a)&&(this.version=h.DotPlotVisual),s},t.prototype.serializeObjects=function(e,t,r){var i=p.serializeObjects(e,t);return this.setVersionForObjectDefinitions(e,t,r),i},t.prototype.isAtLatestVersion=function(){return this.version===l},t.prototype.setVersionForObjectDefinitions=function(t,i,n){var a=this;this.isAtLatestVersion()||(c.visitPropertyExprs({definitions:t,descriptors:i,visitor:function(e,t,i,n){a.version=D.max(r.upgrade.getVersionForSQExpr(e,n),a.version)}}),c.visitPropertyDefinitions(t,i,(function(t,i,o,s,l){a.version=D.max(a.version,e.data.DataViewObjectVersioning.getVersionForDefinition(r.upgrade.ObjectVersioning.added,t[i],o,n,l,i,a.version))})))},t.prototype.serializeShowAllRoles=function(e){if(e){var t=_.pickBy(e,(function(e){return e.showAll===!0}));return _.keys(t)}},t.prototype.serializeQueryProjections=function(e){if(e){var t={};for(var r in e){var i=e[r].all(),n=e[r].activeProjectionRefs;if(i.length>0){t[r]=[];for(var a=0,o=i;a<o.length;a++){var s=o[a],l=s.queryRef,u={queryRef:l};s.format&&(u.format=s.format),_.includes(n,l)&&(u.active=!0),t[r].push(u)}}}return t}},t.prototype.serializeModelExtensionEntities=function(t){var r=this;if(e.contract)return _.map(t,(function(e){var t={name:e.name};return e.extends&&(t.extends=e.extends),e.measures&&(t.measures=r.serializeModelExtensionMeasures(e.measures)),t}))},t.prototype.serializeExpressionReferences=function(e){if(e&&(e.unrecognizedReferences||!_.isEmpty(e.measures))){var t={unrecognizedReferences:e.unrecognizedReferences};return _.isEmpty(e.measures)||(t.measures=e.measures),t}},t.prototype.serializeModelExtensionAnnotations=function(e){if(e)return _.map(e,(function(e){return{name:e.name,value:e.value}}))},t.prototype.serializeModelExtensionMeasures=function(e){var t=this;if(e)return _.map(e,(function(e){var r={name:e.name,dataType:e.dataType,dataCategory:e.dataCategory,expression:e.expression,errorMessage:e.errorMessage,hidden:e.hidden,references:t.serializeExpressionReferences(e.references),formulaOverride:e.formulaOverride,formatInformation:e.formatInformation};return e.annotations&&(r.annotations=t.serializeModelExtensionAnnotations(e.annotations)),e.measureTemplate&&(r.measureTemplate={daxTemplateName:e.measureTemplate.daxTemplateName,version:e.measureTemplate.version}),e.description&&(r.description=e.description,t.version=D.max(t.version,h.description)),r}))},t.prototype.serializeFilterContainers=function(e,t){if(e){for(var i=[],n=0,a=e;n<a.length;n++){var o=a[n];(0!==o.howCreated||o.filter||o.objects||o.isHiddenInViewMode===!1)&&(!o.isTransient||t&&t.withTransientFilters)&&(5===o.howCreated&&(this.version=D.max(this.version,m.v3_5)),o.isHiddenInViewMode&&(this.version=D.max(this.version,h.FilterContainerVisibilityControl)),o.isLockedInViewMode&&(this.version=D.max(this.version,h.FilterContainerVisibilityControl)),i.push({name:o.name,expression:o.expression?E.serializeExpr(o.expression):void 0,filter:o.filter?E.serializeFilter(o.filter):void 0,type:s.FilterType[o.type],restatement:o.restatement,cachedDisplayNames:r.DisplayNameSerializer.serializeFilterLabelIdPairs(o.cachedValueItems),howCreated:o.howCreated,isLinkedAsAggregation:o.isLinkedAsAggregation,isTransient:o.isTransient,objects:o.objects?this.serializeObjects(o.objects,y,g):void 0,isHiddenInViewMode:o.isHiddenInViewMode,isLockedInViewMode:o.isLockedInViewMode}))}return JSON.stringify(i)}},t.prototype.createVersionedElementConfig=function(e){return{version:e}},t.prototype.serializeResourcePackages=function(e,t){if(!_.isEmpty(e)){for(var r=[],i=function(e){var i=_.find(e.items,(function(e){return e.type===b.CustomVisualMetadata}));if(i&&void 0!==i.content){var n=_.isString(i.content)?jsCommon.JsonExtensions.tryParseJSON(i.content):i.content;n&&(n.content=void 0,i.content=JSON.stringify(n))}var a=e.items;if(a){var o=["contentBlob","contentBlobUrl","promise"];t&&t.excludeResourceItemContent&&o.push("content"),
a=_.map(a,(function(e){return _.omit(e,o)}))}r.push({resourcePackage:{id:e.id,name:e.name,type:e.type,items:a,disabled:!!e.disabled}})},n=0,a=e;n<a.length;n++){i(a[n])}return r}},t.prototype.getLayoutOptimizations=function(e){var t=this.getDistinctLayouts(e);return this.getLayoutOptimizationFromLayouts(t)},t.prototype.getLayoutOptimizationFromLayouts=function(e){for(var t=0,r=0,i=e;r<i.length;r++){switch(i[r].id){case 1:t|=1}}return t},t.prototype.getDistinctLayouts=function(e){for(var t=e.sections,r=a.createWithId(),i=0,n=t;i<n.length;i++)for(var o=n[i],s=0,l=o.visualContainers;s<l.length;s++)for(var u=l[s],c=0,p=u.layouts;c<p.length;c++){var f=p[c];r.withId(f.id)||r.push(f)}return r},t.prototype.serializePodParameters=function(e){if(!_.isEmpty(e)){for(var t=[],r=0,i=e;r<i.length;r++){var n=i[r];t.push({name:n.name,boundFilter:n.boundFilter})}return t}},t.prototype.serializeRelationships=function(e){if(!_.isEmpty(e)){for(var t,r=0,i=e;r<i.length;r++){var n=i[r],a=this.serializeRelationship(n);a&&(t||(t=[])).push(a)}return t}},t})()})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){function t(e){return new n(e)}var r=jsCommon.Version,i=jsCommon.JsonExtensions;e.createExplorationUpgrader=t;var n=(function(){function t(t){this.versionUpgraders=[e.v1_0.createVersionUpgrader(),e.v2_0.createVersionUpgrader(),e.v2_2.createVersionUpgrader(),e.v2_3.createVersionUpgrader(),e.v2_5.createVersionUpgrader(),e.v3_6_1.createVersionUpgrader(),e.v3_12_1.createVersionUpgrader(),e.v3_14.createVersionUpgrader(t),e.v3_14_1.createVersionUpgrader(),e.v3_15.createVersionUpgrader(),e.v3_18.createVersionUpgrader(),e.v3_19.createVersionUpgrader(),e.v3_20.createVersionUpgrader(t)]}return t.prototype.upgrade=function(e,t,r,i){if(this.upgradeElement(e,t,r,(function(e,t){return e.upgrade(t)}),i))return e},t.prototype.upgradeFilterCollection=function(e,t,r){if(this.upgradeElement(e,t,r,(function(e,t){return e.upgradeFilterCollection(t)})))return e},t.prototype.getVersionUpgraders=function(){return this.versionUpgraders},t.prototype.upgradeElement=function(t,i,n,a,o){var s=this.getVersionedElementConfig(t),l=s.version&&_.isString(s.version)?s.version:r.ZeroStr;if(r.gt(l,e.CurrentExplorationVersion)){if(i.push({errorType:0}),!n)return}else{for(var u=0,c=this.versionUpgraders;u<c.length;u++){var p=c[u],f=p.getVersion();(r.lt(f,"2.2")||r.gt(f,l))&&(a(p,t),o&&o.info.upgraderCount++)}t.config.version=e.CurrentExplorationVersion}return t},t.prototype.getVersionedElementConfig=function(e){return _.isString(e.config)&&(e.config=i.tryParseJSON(e.config)),e.config||(e.config={version:r.ZeroStr}),e.config},t})()})(t=e.upgrade||(e.upgrade={}))})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){var r;!(function(t){var r;!(function(r){function i(){return new p}var n=e.data.services.DataViewObjectSerializer,a=e.visuals.GradientUtils,o=jsCommon.JsonExtensions,s=e.visuals.labelStyle,l=e.visuals.plugins,u=e.data.services.SemanticQuerySerializer,c=e.data.SQExprBuilder;r.createVersionUpgrader=i;var p=(function(){function r(){}return r.prototype.upgrade=function(e){if(e&&(e.filters=this.upgradeFilterContainers(e.filters),e.sections))for(var t=0,r=e.sections;t<r.length;t++){var i=r[t];if(i.filters=this.upgradeFilterContainers(i.filters),i.visualContainers)for(var n=0,a=i.visualContainers;n<a.length;n++){var o=a[n];o.filters=this.upgradeFilterContainers(o.filters);var s=o.config.singleVisual;if(s){var l=s.visualType||s.visualConfig.visualType;s.objects=this.upgradeVisualObjects(s.objects,l)}}}},r.prototype.upgradeFilterCollection=function(e){e&&e.filters&&(e.filters=this.upgradeFilterContainers(e.filters))},r.prototype.getVersion=function(){return t.ExplorationVersions.v1_0},r.prototype.upgradeFilterContainers=function(e){if(!_.isEmpty(e)){var t=o.tryParseJSON(e);if(t)for(var r=0,i=t;r<i.length;r++){var n=i[r];this.upgradeFilterContainer(n)}return JSON.stringify(t)}},r.prototype.upgradeFilterContainer=function(e){if(!e.expression&&e.field){var t=f.fieldDef(e.field);t&&(e.expression=u.serializeExpr(t))}void 0===e.howCreated&&(e.howCreated=e.autoGenerated?0:1)},r.prototype.upgradeVisualObjects=function(e,t){switch(this.dropMalformedSelectors(e),t){case l.filledMap.name:return this.upgradeObjectsFilledMap(e);case l.card.name:return this.upgradeObjectsCard(e);case l.donutChart.name:case l.pieChart.name:return this.upgradeObjectsDonutChart(e)}return e},r.prototype.dropMalformedSelectors=function(e){if(e)for(var t in e){var r=e[t];if(r)for(var i=r.length-1;i>=0;i--){var n=r[i],a=n.selector;a&&(a.metadata||delete a.metadata,_.isEmpty(Object.keys(a))&&r.splice(i,1))}}},r.prototype.upgradeObjectsFilledMap=function(t){var r="dataPoint",i="fillRule";t||(t={});var o=t[r];o||(t[r]=o=[]);for(var s,l=0,u=o;l<u.length;l++){var c=u[l];if(!c.selector){s=c;break}}return s||(s={selector:null,properties:{}},o.push(s)),null==s.properties[i]&&(s.properties[i]=n.serializeObjectProperty(a.getDefaultFillRuleDefinition(),e.visuals.getFilledMapCapabilities().objects[r].properties[i])),t},r.prototype.upgradeObjectsCard=function(e){var t="cardTitle";if(e){var r=e[t];r&&(e.categoryLabels=r,delete e[t])}return e},r.prototype.upgradeObjectsDonutChart=function(t){var r="categoryLabels",i="labels",a="labelStyle",o="show";if(t){var l,p=this.getMetadataOnceObjectDefn(t,i),f=this.getPropertyExpr(p,o),d=!!f&&u.deserializeExpr(f).value,h=this.getMetadataOnceObjectDefn(t,r);if(h){var v=this.getPropertyExpr(h,o),m=!!v&&u.deserializeExpr(v).value;d&&m?l=s.categoryAndData:d&&!m?l=s.data:!d&&m&&(l=s.category),delete t[r]}else{p&&p.properties[a]||(l=d?s.categoryAndData:s.category)}if(null!=l){var g=e.visuals.donutChartCapabilities.objects[i].properties;if(!p){var y=t[i];y||(t[i]=y=[]),p=_.find(y,(function(e){return!e.selector})),p||(p={properties:{}},y.push(p))}p.properties[o]=n.serializeObjectProperty(c.boolean(!0),g[o]),p.properties[a]=n.serializeObjectProperty(c.text(l),g[a])}return t}},r.prototype.getMetadataOnceObjectDefn=function(e,t){if(e){var r=e[t];if(!_.isEmpty(r))return _.find(r,(function(e){return!e.selector}))}},r.prototype.getPropertyExpr=function(e,t){if(e){var r=e.properties[t];if(r)return r.expr}},r})();r.VersionUpgrader=p;var f;!(function(e){function t(e){return r(e)||i(e)||n(e)||a(e)}function r(e){var t=e.aggregate;if(void 0!==t){var r=i(e)||a(e);if(r)return c.aggregate(r,t)}}function i(e){var t=e.column;if(t){var r=a(e);if(r)return c.columnRef(r,t)}}function n(e){var t=e.measure;if(t){var r=a(e);if(r)return c.measureRef(r,t)}}function a(e){return c.entity(e.schema,e.entity,e.entityVar)}e.fieldDef=t})(f||(f={}))})(r=t.v1_0||(t.v1_0={}))})(r=t.upgrade||(t.upgrade={}))})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(t){function r(){return new i}t.createVersionUpgrader=r;var i=(function(){function t(){}return t.prototype.upgrade=function(e){if(e&&e.sections)for(var t=0,r=e.sections;t<r.length;t++){var i=r[t];if(i.visualContainers)for(var n=0,a=i.visualContainers;n<a.length;n++){var o=a[n],s=o.config;if(!s.layouts){var l={x:o.x,y:o.y,z:o.z,width:o.width,height:o.height};s.layouts=[{id:0,position:l}]}}}},t.prototype.upgradeFilterCollection=function(e){},t.prototype.getVersion=function(){return e.ExplorationVersions.v2_0},t})()})(t=e.v2_0||(e.v2_0={}))})(t=e.upgrade||(e.upgrade={}))})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(t){function r(){return new n}var i=jsCommon.JsonExtensions;t.createVersionUpgrader=r;var n=(function(){function t(){}return t.prototype.upgrade=function(e){},t.prototype.upgradeFilterCollection=function(e){e&&e.filters&&(e.filters=this.upgradeFilterContainers(e.filters))},t.prototype.upgradeFilterContainers=function(e){if(!_.isEmpty(e)){var t=i.tryParseJSON(e);if(t)for(var r=0,n=t;r<n.length;r++){var a=n[r];this.upgradeFilterContainer(a)}return JSON.stringify(t)}},t.prototype.upgradeFilterContainer=function(e){2!==e.howCreated||e.precedence||(e.precedence=0)},t.prototype.getVersion=function(){return e.ExplorationVersions.v2_2},t})()})(t=e.v2_2||(e.v2_2={}))})(t=e.upgrade||(e.upgrade={}))})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){var r;!(function(t){var r;!(function(r){function i(){return new u}var n=e.data.DataViewObjectDefinitions,a=e.data.services.DataViewObjectSerializer,o=e.visuals.plugins,s=e.visuals.slicerMode,l=e.data.SQExprBuilder;r.createVersionUpgrader=i;var u=(function(){function r(){}return r.prototype.upgrade=function(e){if(e&&e.sections)for(var t=0,r=e.sections;t<r.length;t++){var i=r[t];if(i.visualContainers)for(var n=0,a=i.visualContainers;n<a.length;n++){var o=a[n],s=o.config.singleVisual;if(s){var l=s.visualType||s.visualConfig.visualType;s.objects=this.upgradeVisualObjects(s.objects,l)}}}},r.prototype.upgradeFilterCollection=function(e){},r.prototype.getVersion=function(){return t.ExplorationVersions.v2_3},r.prototype.upgradeVisualObjects=function(e,t){return t===o.slicer.name?this.upgradeSlicerObjects(e):e},r.prototype.upgradeSlicerObjects=function(t){var r="data",i="mode";t||(t={});var o=n.ensure(t,r,null),u=e.visuals.slicerCapabilities.objects[r].properties;return null==o.properties[i]&&(o.properties[i]=a.serializeObjectProperty(l.text(s.basic),u[i])),t},r})();r.VersionUpgrader=u})(r=t.v2_3||(t.v2_3={}))})(r=t.upgrade||(t.upgrade={}))})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){var r;!(function(t){var r;!(function(r){function i(){return new o}var n=e.data.DataViewObjectDefinitions,a=e.visuals.plugins;r.createVersionUpgrader=i;var o=(function(){function e(){}return e.prototype.upgrade=function(e){if(e&&e.sections)for(var t=0,r=e.sections;t<r.length;t++){var i=r[t];if(i.visualContainers)for(var n=0,a=i.visualContainers;n<a.length;n++){var o=a[n],s=o.config.singleVisual;if(s){var l=s.visualType||s.visualConfig.visualType;s.objects=this.upgradeVisualObjects(s.objects,l)}}}},e.prototype.upgradeFilterCollection=function(e){},e.prototype.getVersion=function(){return t.ExplorationVersions.v2_5},e.prototype.upgradeVisualObjects=function(e,t){return t===a.gauge.name?this.upgradeGaugeTarget(e):e},e.prototype.upgradeGaugeTarget=function(e){var t="labels",r="target",i=["show","labelDisplayUnits","labelPrecision","color"];e||(e={});var a=n.getObjectDefinition(e,t,null);if(!a)return e;for(var o=n.ensure(e,r,null),s=0,l=i;s<l.length;s++){var u=l[s];null!=a.properties[u]&&(o.properties[u]=a.properties[u])}return e},e})();r.VersionUpgrader=o})(r=t.v2_5||(t.v2_5={}))})(r=t.upgrade||(t.upgrade={}))})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){var r;!(function(t){var r;!(function(r){function i(){return new s}var n=e.GeoJsonTypes,a=e.visualHost.utils.ResourcePackageUtils,o=e.contracts.ResourcePackageItemType;r.createVersionUpgrader=i;var s=(function(){function e(){}return e.prototype.upgrade=function(e){if(e){var t=e.resourcePackages||[],r=_.find(t,(function(e){return 2===e.resourcePackage.type})),i=!r;r=r||{resourcePackage:{id:void 0,items:[],name:a.ensurePackageName(2),type:2}};var n=r.resourcePackage.items;if(e.sections)for(var s=0,l=e.sections;s<l.length;s++){var u=l[s];if(u.visualContainers)for(var c=0,p=u.visualContainers;c<p.length;c++){var f=p[c],d=f.config.singleVisual;d&&this.upgradeSharedResourcePackages(d.objects,n)}}var h=e.config&&e.config.baseTheme;h&&(_.find(n,(function(e){return e.name===h}))||n.push({name:h,type:o.BaseTheme,path:"BaseThemes/"+h+".json"})),i&&r.resourcePackage.items.length>0&&(t.push(r),e.resourcePackages||(e.resourcePackages=t))}},e.prototype.upgradeFilterCollection=function(){},e.prototype.getVersion=function(){return t.ExplorationVersions.v3_6_1},e.prototype.upgradeSharedResourcePackages=function(e,t){for(var r in e)for(var i=0,a=e[r];i<a.length;i++){var s=a[i],l=function(e){var r=s.properties[e],i=r&&r.geoJson;if(i){var a=i.type.expr,l=a.Literal&&a.Literal.Value;if(l&&u.removeQuotes(l)===n.shared){var c=u.removeQuotes(i.name.expr.Literal.Value);_.find(t,(function(e){return e.name===c}))||t.push({name:c,type:o.ShapeMap,path:"Shapemaps/"+c+".json"})}}},u=this;for(var c in s.properties)l(c)}},e.prototype.removeQuotes=function(e){return e.substr(1,e.length-2)},e})();r.VersionUpgrader=s})(r=t.v3_6_1||(t.v3_6_1={}))})(r=t.upgrade||(t.upgrade={}))})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(t){function r(e){return new n(e)}var i=jsCommon.JsonExtensions;t.createVersionUpgrader=r;var n=(function(){function t(e){this.featureSwitchService=e}return t.prototype.upgrade=function(e){if(e&&this.featureSwitchService.featureSwitches.measureDrillthrough&&e.sections)for(var t=0,r=e.sections;t<r.length;t++){var n=r[t],a=n.config,o=i.tryParseJSON(n.filters)||[];1===a.type?this.upgradeTooltipPage(o,a):0!==a.type&&null!==a.type||this.upgradeRegularPage(o,a),n.filters=JSON.stringify(o)}},t.prototype.upgradeFilterCollection=function(){},t.prototype.getVersion=function(){return e.ExplorationVersions.v3_14},t.prototype.upgradeTooltipPageLinkFields=function(e,t){var r=_.map(t.linkFields,(function(e){return{howCreated:5,isTransient:!1,isLinkedAsAggregation:e.asAggregation,expression:e.fieldExpr}}));e.push.apply(e,r),t.linkFields=[]},t.prototype.upgradeTooltipPage=function(e,t){t.acceptsAllFiltersWhenLinked=!0,this.upgradeTooltipPageLinkFields(e,t)},t.prototype.upgradeRegularPage=function(e,t){if(t.acceptsAllFiltersWhenLinked=!1,e)for(var r=0,i=e;r<i.length;r++){var n=i[r];n.isLinkedAsAggregation=!1}},t})();t.VersionUpgrader=n})(t=e.v3_14||(e.v3_14={}))})(t=e.upgrade||(e.upgrade={}))})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(t){function r(){return new i}t.createVersionUpgrader=r;var i=(function(){function t(){}return t.prototype.upgrade=function(e){if(e&&e.sections)for(var t=0,r=e.sections;t<r.length;t++){var i=r[t];if(i.visualContainers)for(var n=0,a=i.visualContainers;n<a.length;n++){var o=a[n],s=o.config.singleVisual;s&&this.upgradeSQExprToInt(s.objects)}}},t.prototype.upgradeFilterCollection=function(){},t.prototype.getVersion=function(){return e.ExplorationVersions.v3_14_1},t.prototype.upgradeSQExprToInt=function(e){for(var t in e)if("labels"===t||"bubbles"===t||"categoryLabels"===t)for(var r=0,i=e[t];r<i.length;r++){var n=i[r];for(var a in n.properties)if("bubbleSize"===a||"labelDensity"===a||"backgroundTransparency"===a){var o=n.properties[a],s=o&&o.expr&&o.expr.Literal;s&&/^'\d+(\.\d+)?'$/.test(s.Value)&&(s.Value=this.convertLiteralSQTextIntoNumber(s.Value)+"L")}}},t.prototype.convertLiteralSQTextIntoNumber=function(e){return Math.floor(_.parseInt(e.substr(1,e.length-2)))},t})();t.VersionUpgrader=i})(t=e.v3_14_1||(e.v3_14_1={}))})(t=e.upgrade||(e.upgrade={}))})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){var r;!(function(t){var r;!(function(r){function i(){return new o}var n=e.data.services.SemanticQuerySerializer,a=e.data.SQExprBuilder;r.createVersionUpgrader=i;var o=(function(){function e(){}return e.prototype.upgrade=function(e){if(e&&e.sections)for(var t=0,r=e.sections;t<r.length;t++){var i=r[t];if(i.visualContainers)for(var n=0,o=i.visualContainers;n<o.length;n++){var s=o[n],l=s.config.singleVisual;if(l){var u={};if(l.altText&&(u.general=[{properties:{altText:this.toExpr(a.text(l.altText))}}],delete l.altText),l.aspectRatio){var c=l.aspectRatio;u.lockAspect=[{properties:{show:null!=c.show?this.toExpr(a.boolean(c.show)):void 0}}],delete l.aspectRatio}if(l.background){var p=l.background;u.background=[{properties:{color:null!=p.color?{solid:{color:this.toExpr(a.text(p.color))}}:void 0,show:null!=p.show?this.toExpr(a.boolean(p.show)):void 0,transparency:null!=p.transparency?this.toExpr(a.integer(p.transparency)):void 0}}],delete l.background}if(l.border){var f=l.border;u.border=[{properties:{color:null!=f.color?{solid:{color:this.toExpr(a.text(f.color))}}:void 0,show:null!=f.show?this.toExpr(a.boolean(f.show)):void 0}}],delete l.border}if(l.stylePresetName&&(u.stylePreset=[{properties:{name:this.toExpr(a.text(l.stylePresetName))}}],delete l.stylePresetName),l.title){var d=l.title;d.show=null!=d.hidden?!d.hidden:d.show,u.title=[{properties:{alignment:null!=d.alignment?this.toExpr(a.text(d.alignment)):void 0,background:null!=d.background?{solid:{color:this.toExpr(a.text(d.background))}}:void 0,fontColor:null!=d.fontColor?{solid:{color:this.toExpr(a.text(d.fontColor))}}:void 0,fontFamily:null!=d.fontFamily?this.toExpr(a.text(d.fontFamily)):void 0,fontSize:null!=d.fontSize?this.toExpr(a.integer(d.fontSize)):void 0,show:null!=d.show?this.toExpr(a.boolean(d.show)):void 0,text:null!=d.text?this.toExpr(a.text(d.text)):void 0}}],delete l.title}if(l.visualLink){var h=l.visualLink;u.visualLink=[{properties:{bookmark:null!=h.bookmark?this.toExpr(a.text(h.bookmark)):void 0,qna:h.qna,show:null!=h.show?this.toExpr(a.boolean(h.show)):void 0,type:null!=h.type?this.toExpr(a.text(h.type)):void 0}}],delete l.visualLink}if(l.visualTooltip){var v=l.visualTooltip;u.visualTooltip=[{properties:{section:null!=v.section?this.toExpr(a.text(v.section)):void 0,type:null!=v.type?this.toExpr(a.text(v.type)):void 0}}],delete l.visualTooltip}this.clearUndefinedPropertiesVCObjects(u),_.isEmpty(u)||(l.vcObjects=u)}}}},e.prototype.toExpr=function(e){return{expr:n.serializeExpr(e)}},e.prototype.clearUndefinedPropertiesVCObjects=function(e){for(var t in e){var r=e[t][0].properties;for(var i in r)r[i]||delete r[i];_.isEmpty(r)&&delete e[t]}},e.prototype.upgradeFilterCollection=function(){},e.prototype.getVersion=function(){return t.ExplorationVersions.v3_15},e})();r.VersionUpgrader=o})(r=t.v3_15||(t.v3_15={}))})(r=t.upgrade||(t.upgrade={}))})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){var r;!(function(t){var r;!(function(r){function i(){return new a}var n=e.explore.util.ThemeUtils;r.createVersionUpgrader=i;var a=(function(){function e(){}return e.prototype.upgrade=function(e){if(e){var t={},r=e.config;r.themeCollection=t,e.theme&&(t.customTheme=n.getThemeMetadata(e.theme,1,this.getVersion()),delete e.theme),r.baseTheme&&(t.baseTheme=n.getThemeMetadata(r.baseTheme,2,this.getVersion()),delete r.baseTheme)}},e.prototype.upgradeFilterCollection=function(){},e.prototype.getVersion=function(){return t.ExplorationVersions.v3_18},e})();r.VersionUpgrader=a})(r=t.v3_18||(t.v3_18={}))})(r=t.upgrade||(t.upgrade={}))})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(t){function r(){return new o}function i(e){var t="dataPoint",r="defaultCategoryColor";if(e&&e[t])for(var i=0,n=e[t];i<n.length;i++){var a=n[i];null==a.selector&&a.properties[r]&&(a.properties.fill=a.properties[r],delete a.properties[r])}}function n(t){return _.includes(e.DefaultCategoryColorVisualsToUpgrade,t)}var a=jsCommon.JsonExtensions;t.createVersionUpgrader=r;var o=(function(){function t(){}return t.prototype.upgrade=function(e){if(e)for(var t=0,r=e.sections;t<r.length;t++)for(var o=r[t],s=0,l=o.visualContainers;s<l.length;s++){var u=l[s],c=u.config.singleVisual;if(c){var p=c.objects,f=c.visualType;if(!n(f))continue;i(p);var d=a.tryParseJSON(u.dataTransforms);if(d){var h=d.objects;i(h),u.dataTransforms=JSON.stringify(d)}}}},t.prototype.upgradeFilterCollection=function(){},t.prototype.getVersion=function(){return e.ExplorationVersions.v3_19},t})();t.VersionUpgrader=o,t.upgradeDefaultCategoryColorToFill=i,t.needsToUpgradeDefaultCategoryColor=n})(t=e.v3_19||(e.v3_19={}))})(t=e.upgrade||(e.upgrade={}))})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){var r;!(function(t){function r(e){var t={Version:u.v1_0,Utterance:e.utterance};return _.isEmpty(e.spans)||(t.Spans=_.map(e.spans,(function(e){return n(e)}))),t}function i(e){var t={utterance:e.Utterance};return _.isEmpty(e.Spans)||(t.spans=_.map(e.Spans,(function(e){return o(e)}))),t}function n(e){var t={StartIndex:e.StartIndex,Length:e.Length};return e.Binding&&(t.Binding=a(e.Binding)),t}function a(e){var t={};return e.Table&&(t.Table=e.Table),e.Pod&&(t.Pod=e.Pod),e.Property&&(t.Property=e.Property),e.Value&&(t.Value=e.Value),e.Range&&(t.Range=e.Range),null!=e.VisType&&(t.VisType=e.VisType),e.Composite&&(t.Composite=e.Composite),e.Core&&(t.Core=e.Core),_.isEmpty(t)?void 0:t}function o(e){var t={StartIndex:e.StartIndex,Length:e.Length};return e.Binding&&(t.Binding=s(e.Binding)),t.Source=1,t}function s(e){return __assign({},e)}var l=e.explore,u=l.services.upgrade.UtteranceDefinitionVersions;t.serialize=r,t.deserialize=i})(r=t.UtteranceDefinitionSerializer||(t.UtteranceDefinitionSerializer={}))})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(t){function r(t){var r={};if(t.explorationState)r.explorationState=e.ExplorationState.serialize(t.explorationState);else{var i=r.bookmarkRef={};t.bookmarkRef.ref?i.ref=t.bookmarkRef.ref:i.bookmark=e.WebBookmark.serialize(t.bookmarkRef.bookmark)}return r}function i(t){var r={};if(t.explorationState)r.explorationState=e.ExplorationState.deserialize(t.explorationState);else{var i=r.bookmarkRef={};if(t.bookmarkRef.ref)i.ref=t.bookmarkRef.ref;else{var n=e.WebBookmark.deserialize(t.bookmarkRef.bookmark);if(n.errors)return;i.bookmark=n.contract}}return r}t.serialize=r,t.deserialize=i})(t=e.UserState||(e.UserState={}))})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){function t(e){return new r(e)}e.createSchemaItemActivationService=t;var r=(function(){function t(e){this.eventBridge=e}return t.prototype.setActiveItem=function(e){_.isEqual(this.activeItems,e)||(this.activeItems=e,this.raiseEvent())},t.prototype.clearActiveItem=function(){this.activeItems&&(this.activeItems=null,this.raiseEvent())},t.prototype.getActiveItem=function(){return this.activeItems},t.prototype.raiseEvent=function(){this.eventBridge.publishToChannel(e.events.schemaItemActivationChanged)},t})()})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){var r,i=e.data.FieldExprPattern,n=e.data.SQExprConverter;!(function(e){function t(e,t,r){var o=n.asFieldPattern(t,r),s=i.toFieldExprEntityItemPattern(o),l=s.schema,u=s.entity,c=a.createActiveSchemaItem(l,u,o);e.setActiveItem(c)}e.setActiveSchemaItem=t})(r=t.schemaItemActivationUtils||(t.schemaItemActivationUtils={}));var a;!(function(e){function t(e,t,r){return{schema:e,entity:t,property:i.getPropertyName(r),hierarchy:i.getHierarchyName(r)||r.hierarchyLevel&&r.hierarchyLevel.name,hierarchyLevel:r.hierarchyLevel&&r.hierarchyLevel.level}}e.createActiveSchemaItem=t})(a=t.ActiveSchemaItemFactory||(t.ActiveSchemaItemFactory={}))})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(r){function i(e){return new a(e)}var n=e.explore.schemaRewriterUtils;r.createSchemaChangeHandler=i;var a=(function(){function e(e){this.visualPluginService=e}return e.prototype.apply=function(e,r){var i=n.createSchemaChangeRewriters(r),a=new o(i);t.util.traverseExploration(e,a,this.visualPluginService)},e})(),o=(function(e){function r(r){var i=this,n=new t.util.VisualContainerStateRewriter(r),a=new t.util.ExplorationStateRewriter(r,n),o=new s(r);return i=e.call(this,a,o)||this,i.rewriters=r,i}return __extends(r,e),r.prototype.visitFilterContainer=function(e){e&&t.util.rewriteFilterContainer(e,this.rewriters)},r.prototype.visitLinkField=function(e){e&&t.util.rewriteLinkField(e,this.rewriters)},r})(t.util.DefaultExplorationVisitor),s=(function(e){function t(t){var r=this;return r=e.call(this,t)||this}return __extends(t,e),t.prototype.visitSingleVisualConfig=function(t){e.prototype.visitSingleVisualConfig.call(this,t),t.conversionSourceContext=void 0},t})(t.util.VisualContainerRewriter);r.SchemaChangeVisualContainerRewriter=s})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){function t(e,t,r){return new n(e,t,r)}e.createReportTileService=t;var r=10,i=2,n=(function(){function e(e,t,r){this.promiseFactory=e,this.explorationProxy=t,this.timeout=r,this.explorationJobsQueue=[],this.inProgressJobsQueue=[]}return e.prototype.getExploration=function(e,t){var r=this.promiseFactory.defer();return this.explorationJobsQueue.push({reportId:e,sectionId:t,deferred:r}),this.scheduleLoadExploration(),r.promise},e.prototype.scheduleLoadExploration=function(){var e=this;this.delayTimeout&&this.timeout.cancel(this.delayTimeout),this.delayTimeout=this.timeout((function(){e.loadExplorations()}),r)},e.prototype.loadExplorations=function(){var e=this,t=this.explorationJobsQueue;if(!_.isEmpty(t)){var r=t.shift();this.inProgressJobsQueue.push(r);var i=this.shouldRequestForAllSection(r.reportId,r.sectionId),n=r.reportId,a=i?null:r.sectionId;i&&(this.inProgressJobsQueue=this.inProgressJobsQueue.concat(_.remove(t,(function(e){return e.reportId===n}))));var o={id:n,sectionId:a,allowCache:!0};this.explorationProxy.get(o).then((function(t){e.processResult(o.id,o.sectionId,t)}),(function(){e.processResult(o.id,o.sectionId,null)})),this.loadExplorations()}},e.prototype.processResult=function(e,t,r){for(var i=[],n=0,a=this.inProgressJobsQueue;n<a.length;n++){var o=a[n];o.reportId!==e||_.isNumber(t)&&t!==o.sectionId?i.push(o):r?o.deferred.resolve(r):o.deferred.reject(r)}this.inProgressJobsQueue=i},e.prototype.shouldRequestForAllSection=function(e,t){if(null==t)return!0;var r=this.explorationJobsQueue;if(_.isEmpty(r))return!1;for(var n=0,a=0,o=r;a<o.length;a++){var s=o[a];if(s.reportId===e){if(null==s.sectionId)return!0;if(s.sectionId!==t&&n++,n>=i)return!0}}return!1},e})();e.ReportTileService=n})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){function t(e,t,i){var n=r.createSelectableVisualContainer(e);t.selectElement(n,i)}function i(e,t){var r=o(t);_.includes(r,e)&&n(_.without(r,e),t)}function n(e,t){var i=_.map(e,(function(e){return r.createSelectableVisualContainer(e)}));t.selectElements(i)}function a(e,t){var r=o(t);return _.includes(r,e)}function o(e){return _.chain(e.getSelectedElements()).map((function(e){return e.visualContainer})).compact().value()}function s(e){return o(e).length>1}function l(e){var t=o(e);if(1===t.length)return t[0]}function u(e){var t=o(e);if(t.length>1)for(var r=t[0].config.singleVisual.visualType,i=1,n=t.length;i<n;i++)if(t[i].config.singleVisual.visualType!==r)return null;return t[0]}e.selectVisualContainer=t,e.unselectVisualContainer=i,e.selectVisualContainers=n,e.isVisualContainerSelected=a,e.getSelectedVisuals=o,e.hasMultipleVisualContainerSelection=s,e.getSelectedVisual=l,e.getDefaultSelectedVisualInSingleOrMultiCase=u})(t=e.selectionUtils||(e.selectionUtils={}));var r;!(function(e){function t(e){return n.createFromVisualContainer(e)}e.createSelectableVisualContainer=t})(r=e.SelectableItemFactory||(e.SelectableItemFactory={}));var i;!(function(e){function t(e,t){if(e.length!==t.length)return!1;for(var r=0,i=e.length;r<i;r++)if(!n.equals(e[r],t[r]))return!1;return!0}e.equals=t})(i=e.SelectableUtils||(e.SelectableUtils={}));var n=(function(){function e(){}return Object.defineProperty(e.prototype,"id",{get:function(){if(this._visualContainer)return this._visualContainer.id},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"visualContainer",{get:function(){return this._visualContainer},enumerable:!0,configurable:!0}),e.createFromVisualContainer=function(t){var r=new e;return r._visualContainer=t,r},e.equals=function(e,t){return e=e||null,t=t||null,e===t||!e==!t&&(e.id===t.id&&e.visualContainer===t.visualContainer)},e})()})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){function r(e,t,r,i,n,o){return new a(e,t,r,i,n,o)}var i=e.common.contracts.TenantType,n=e.explore.util.VisualContainerUtils;t.createScriptVisualsService=r;var a=(function(){function e(e,t,r,i,n,a){this.services={visualPlugin:e,featureSwitchService:t,localizationService:r,userInfo:i,embedModeService:n,licenseServiceExtend:a}}return e.prototype.addScriptVisualId=function(e,t){var r=n.getVisualType(e);this.services.visualPlugin.isScriptVisual(r)&&e.id&&t.push(e.id)},e.prototype.showEnableScriptVisualDialogIfRequired=function(e,t,r){return!1},e.prototype.getScriptVisualErrorDetails=function(e,t){var r,i=this,n=this.services.localizationService,a=this.services.featureSwitchService.featureSwitches,o=0===e&&!a.scriptVisualEnabled,s=1===e&&!a.pythonSupportEnabled;return n.ensureLocalization((function(){if(o||s)r=i.buildErrorDetails(n.get(i.getLocalizationKey("Error_VisualsNotSupported",e)));else{if(i.services.embedModeService.isAnonymousLiveEmbed())return void(a.scriptVisualAnonymousEmbeddingEnabled||(r=i.buildErrorDetails(n.get(i.getLocalizationKey("Error_VisualsNotSupportedInEmbedReports",e)))));var l=i.getUserInfoForErrorDetails();if(l&&l.isViralTenant)r=i.buildErrorDetails(n.get(i.getLocalizationKey("Error_VisualsNotSupportedForViralTenant",e)));else if(a.rScriptVisualEnabled===!1)r=i.buildErrorDetails(n.get(i.getLocalizationKey("Error_VisualsDisabledByAdmin",e)));else{var u=!1;!i.services.licenseServiceExtend||Array.isArray(i.services.licenseServiceExtend)||i.services.embedModeService.isReportEmbedScenario()||(u=t&&i.services.licenseServiceExtend.isReportInPremiumCapacity(t)),!l||l.isPremiumUser||u||(r=i.buildErrorDetails(n.get(i.getLocalizationKey("Error_VisualsIsProFeature",e))))}}})),r},e.prototype.overrideEmbeddedErrorDetails=function(e,t){var r=this.services.embedModeService.isAppTokenEmbed()||this.services.embedModeService.isSaasEmbed()||this.services.embedModeService.isSecurePublishToWeb(),i=this.services&&this.services.localizationService;if(r&&t){var n=t;return n.helpLink="",n.message=i.get(this.getLocalizationKey("Error_VisualsEmbeddedText",e)),n.displayableErrorInfo=[{errorInfoKey:i.get(this.getLocalizationKey("Error_VisualsEmbeddedText",e)),errorInfoValue:i.get(this.getLocalizationKey("Error_VisualsErrorInEmbedReports",e))}],n}},e.prototype.getLocalizationKey=function(e,t){var r;switch(t){case 0:r="R";break;case 1:r="Py";break;default:r=""}return r+e},e.prototype.shouldBlockScriptVisual=function(e,t){var r=this.services.featureSwitchService.featureSwitches,i=this.getUserInfoForErrorDetails();switch(e){case 0:if(this.services.embedModeService.isAnonymousLiveEmbed())return!r.scriptVisualAnonymousEmbeddingEnabled||!r.scriptVisualEnabled;var n=!1;return!this.services.licenseServiceExtend||Array.isArray(this.services.licenseServiceExtend)||this.services.embedModeService.isReportEmbedScenario()||(n=t&&this.services.licenseServiceExtend.isReportInPremiumCapacity(t)),!n&&(!r.scriptVisualEnabled||i&&i.isViralTenant||!r.rScriptVisualEnabled||i&&!i.isPremiumUser);case 1:return this.services.embedModeService.isAnonymousLiveEmbed()?!r.scriptVisualAnonymousEmbeddingEnabled||r.pythonSupportEnabled===!1:(!this.services.licenseServiceExtend||Array.isArray(this.services.licenseServiceExtend)||this.services.embedModeService.isReportEmbedScenario()||(n=t&&this.services.licenseServiceExtend.isReportInPremiumCapacity(t)),
!n&&(r.pythonSupportEnabled===!1||i&&i.isViralTenant||i&&!i.isPremiumUser))}},e.prototype.canLaunchExternalIDE=function(){return!1},e.prototype.launchExternalIDE=function(e){return null},e.prototype.openOptionsDialog=function(){return null},e.prototype.refreshScriptCustomVisuals=function(e){},e.prototype.buildErrorDetails=function(e){return{message:e,displayableErrorInfo:[],helpLink:"https://go.microsoft.com/fwlink/?linkid=829101",errorType:1}},e.prototype.getUserInfoForErrorDetails=function(){var e=this.services.userInfo;if(e&&!Array.isArray(e)&&!this.services.embedModeService.isReportEmbedScenario()){return{isViralTenant:e.userMetadata&&e.userMetadata.tenantMetadata&&e.userMetadata.tenantMetadata.tenantType===i.ViralTenant,isPremiumUser:e.isPremiumUser}}},e})()})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){function t(e){return new i(e)}var r=jsCommon.ArrayExtensions;e.createSelectionService=t;var i=(function(){function t(e){this.eventBridge=e,this.selectedElements=r.createWithId()}return t.prototype.selectElement=function(e,t){this.selectElements([e],t)},t.prototype.selectElements=function(t,r){if(!e.SelectableUtils.equals(t,this.selectedElements)){if(r||this.clearSelectionCore(!1),this.selectedElements.length){for(var i=this.selectedElements.length,n=0;n<i;n++)if(this.selectedElements[n]===t[0]){this.selectedElements.splice(n,1);break}i===this.selectedElements.length&&this.addISelectable(t)}else this.addISelectable(t);this.raiseEvent()}},t.prototype.clearSelection=function(){this.clearSelectionCore(!0)},t.prototype.addISelectable=function(e){this.selectedElements=r.extendWithId(this.selectedElements.concat(e))},t.prototype.clearSelectionCore=function(e){this.selectedElements=r.createWithId(),e&&this.raiseEvent()},t.prototype.getSelectedElements=function(){return this.selectedElements},t.prototype.raiseEvent=function(){this.eventBridge.publishToChannel(e.events.selectionChanged)},t})()})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){function r(e,t,r,i,n){return new l(e,r,t,new u(e,i,n))}var i=e.visuals.PivotTableOptions,n=e.visualHost.utils.ResourcePackageUtils,a=e.visuals.TableExOptions,o=e.visuals.TooltipManager,s=e.visualHost.visualPluginServiceHelpers.VisualPluginStorage;t.createExplorationVisualPluginService=r;var l=(function(){function t(t,r,i,n){var a=this;this.asyncFeatureSwitchService=t,this.resourceLoader=r,this.promiseFactory=i,this.resourceLoader=r,this.promiseFactory=i,this.trustedConvertibleVisualTypes=[],this.customConvertibleVisualTypes=[],this.globalConvertibleVisualTypes=[],this.storage=new s,this.initBuiltInPlugins=this.asyncFeatureSwitchService.getFeatureSwitches().then((function(r){n=n||new u(t),a.globalConvertibleVisualTypes=a.getConvertibleCoreVisualTypeNames(r);for(var i in e.visuals.plugins)a.storage.loadPlugin(i,n.getPlugin(i))}))}return t.prototype.getConvertibleCoreVisualTypeNames=function(t){var r=[e.visuals.plugins.barChart.name,e.visuals.plugins.columnChart.name,e.visuals.plugins.clusteredBarChart.name,e.visuals.plugins.clusteredColumnChart.name,e.visuals.plugins.hundredPercentStackedBarChart.name,e.visuals.plugins.hundredPercentStackedColumnChart.name,e.visuals.plugins.lineChart.name,e.visuals.plugins.areaChart.name,e.visuals.plugins.stackedAreaChart.name,e.visuals.plugins.lineStackedColumnComboChart.name,e.visuals.plugins.lineClusteredColumnComboChart.name,e.visuals.plugins.ribbonChart.name];return t&&t.dataDotChartEnabled&&r.push.apply(r,[e.visuals.plugins.dataDotClusteredColumnComboChart.name,e.visuals.plugins.dataDotStackedColumnComboChart.name]),r.push.apply(r,[e.visuals.plugins.waterfallChart.name,e.visuals.plugins.scatterChart.name,e.visuals.plugins.pieChart.name,e.visuals.plugins.donutChart.name]),t&&t.sunburstVisualEnabled&&r.push(e.visuals.plugins.sunburst.name),r.push.apply(r,[e.visuals.plugins.treemap.name,e.visuals.plugins.map.name,e.visuals.plugins.filledMap.name]),t&&t.shapeMapVisualEnabled&&r.push(e.visuals.plugins.shapeMap.name),r.push.apply(r,[e.visuals.plugins.funnel.name,e.visuals.plugins.gauge.name,e.visuals.plugins.card.name,e.visuals.plugins.multiRowCard.name,e.visuals.plugins.kpi.name,e.visuals.plugins.slicer.name]),t&&t.pivotTableVisualEnabled?(r.push(e.visuals.plugins.tableEx.name),r.push(e.visuals.plugins.pivotTable.name)):(r.push(e.visuals.plugins.table.name),r.push(e.visuals.plugins.matrix.name)),t&&t.scriptVisualEnabled&&t.scriptVisualAuthoringEnabled&&r.push(e.visuals.plugins.scriptVisual.name),t&&t.pythonSupportEnabled&&r.push(e.visuals.plugins.pythonVisual.name),t&&t.keyDrivers&&r.push(e.visuals.plugins.keyDriversVisual.name),e.localStorageService.getData("VISUAL_DEVELOPER_MODE_ENABLED")&&r.push(e.visuals.plugins.debugVisual.name),r},t.prototype.getVisuals=function(){return this.storage.getLoadedPlugins()},t.prototype.getConvertibleVisuals=function(){for(var e=this,t=[],r=0,i=this.globalConvertibleVisualTypes;r<i.length;r++){var n=i[r];this.storage.hasPlugin(n)&&t.push(n)}for(var a=0,o=this.trustedConvertibleVisualTypes;a<o.length;a++){var s=o[a];this.storage.hasPlugin(s)&&t.push(s)}for(var l=0,u=this.customConvertibleVisualTypes;l<u.length;l++){var c=u[l];this.storage.hasPlugin(c)&&t.push(c)}return t.map((function(t){return e.storage.getLoadedPlugin(t)}))},t.prototype.ensureBuiltInPlugins=function(){return this.initBuiltInPlugins},t.prototype.ensureTrustedVisualPlugins=function(e){s.ensureTrustedVisualPlugins(this.storage,e);for(var t=0,r=e;t<r.length;t++){var i=r[t];this.addTrustedConvertibleVisualType(i.name)}},t.prototype.ensurePlugins=function(e,t){var r=this,i=[];if(e&&e.length)for(var a=function(e){if(n.isCustomVisualResourcePackage(e)){var a=o.ensurePlugin(e,t).then((function(){return r.addCustomConvertibleVisualType(e.name)}));i.push(a)}},o=this,s=0,l=e;s<l.length;s++){var u=l[s];a(u)}return this.promiseFactory.allSettled(i)},t.prototype.ensurePlugin=function(e,t){return s.ensurePlugin(this.storage,this.promiseFactory,this.resourceLoader,e,t)},t.prototype.addTrustedConvertibleVisualType=function(e){this.trustedConvertibleVisualTypes.indexOf(e)<0&&this.trustedConvertibleVisualTypes.push(e)},t.prototype.addCustomConvertibleVisualType=function(e){this.customConvertibleVisualTypes.indexOf(e)<0&&this.customConvertibleVisualTypes.push(e)},t.prototype.capabilities=function(e){var t=this.getPlugin(e);return t?t.capabilities:void 0},t.prototype.removeAllCustomVisuals=function(){for(var e=0,t=this.customConvertibleVisualTypes;e<t.length;e++){var r=t[e];this.storage.unloadPlugin(r)}this.customConvertibleVisualTypes=[]},t.prototype.removePlugin=function(e){this.getPlugin(e)&&(this.storage.unloadPlugin(e),_.remove(this.customConvertibleVisualTypes,(function(t){return t===e})))},t.prototype.getTelemetryHostInformation=function(){return{name:"Exploration"}},t.prototype.isCustomVisual=function(t){return e.visualHost.utils.isCustomVisual(this.getPlugin(t),t)},t.prototype.isScriptVisual=function(t){return e.visualHost.utils.isScriptVisual(this.getPlugin(t))},t.prototype.isScriptVisualQueryable=function(t){return e.visualHost.utils.isScriptVisualQueryable(t,this.asyncFeatureSwitchService.featureSwitches)},t.prototype.isLightWeightRenderingVisual=function(t){return e.visualHost.utils.isLightWeightRenderingVisual(this.getPlugin(t))},t.prototype.getInteractivityOptions=function(){return{overflow:"hidden",isVisualInteractive:!0}},t.prototype.loadPluginByNameIfAny=function(t){if(!this.getPlugin(t))return this.storage.hasPlugin(t)?void this.storage.loadPlugin(t):void(e.visuals.plugins[t]&&this.storage.loadPlugin(t,e.visuals.plugins[t]))},t.prototype.getPlugin=function(e){return this.storage.getLoadedPlugin(e)},t.prototype.getStorage=function(){return this.storage},t})();t.ExplorationVisualPluginService=l;var u=(function(){function t(e,t,r){this.featureSwitchService=e,this.mapControlFactory=t,this.visualSandbox=r;var i=this.featureSwitchService.featureSwitches;o.ShowTouchScreenOptimizedTooltips=i&&i.touchScreenOptimizedTooltips}return t.prototype.getPlugin=function(t){var r=this,n=this.featureSwitchService.featureSwitches?_.clone(this.featureSwitchService.featureSwitches):{},o=n.numericSlicerEnabled,s=n.whatIf;e.visuals.SlicerHelper.NumericSlicerEnabled=o,e.visuals.SlicerHelper.SingleValueSlicer=s;var l=n.binnedLineSampling,u=n.steppedLine,c=n.cartesianConditionalFormatting;switch(t){case e.visuals.plugins.barChart.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.barChart,(function(e){var t=e.module;return t.createCartesianChart({chartType:6,isScrollable:!0,animator:t.createWebColumnChartAnimator(),tooltipsEnabled:!0,behavior:t.createCartesianChartBehavior([t.createColumnChartWebBehavior()]),isLabelInteractivityEnabled:n&&n.isLabelInteractivityEnabled})}),n);case e.visuals.plugins.card.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.card,(function(t){return t.module.createCard({isScrollable:!0,animator:new e.visuals.BaseAnimator,tooltipsEnabled:!0})}),n);case e.visuals.plugins.clusteredBarChart.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.clusteredBarChart,(function(e){var t=e.module;return t.createCartesianChart({chartType:5,isScrollable:!0,tooltipsEnabled:!0,animator:t.createWebColumnChartAnimator(),behavior:t.createCartesianChartBehavior([t.createColumnChartWebBehavior()]),isLabelInteractivityEnabled:n&&n.isLabelInteractivityEnabled})}),n);case e.visuals.plugins.clusteredColumnChart.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.clusteredColumnChart,(function(e){var t=e.module;return t.createCartesianChart({chartType:3,isScrollable:!0,tooltipsEnabled:!0,animator:t.createWebColumnChartAnimator(),behavior:t.createCartesianChartBehavior([t.createColumnChartWebBehavior()]),isLabelInteractivityEnabled:n&&n.isLabelInteractivityEnabled})}),n);case e.visuals.plugins.columnChart.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.columnChart,(function(e){var t=e.module;return t.createCartesianChart({chartType:4,isScrollable:!0,tooltipsEnabled:!0,animator:t.createWebColumnChartAnimator(),behavior:t.createCartesianChartBehavior([t.createColumnChartWebBehavior()]),isLabelInteractivityEnabled:n&&n.isLabelInteractivityEnabled})}),n);case e.visuals.plugins.dataDotClusteredColumnComboChart.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.dataDotClusteredColumnComboChart,(function(e){var t=e.module;return t.createCartesianChart({chartType:16,isScrollable:!0,tooltipsEnabled:!0,animator:t.createWebColumnChartAnimator(),behavior:t.createCartesianChartBehavior([t.createColumnChartWebBehavior(),t.createDataDotChartWebBehavior()]),isLabelInteractivityEnabled:n&&n.isLabelInteractivityEnabled})}),n);case e.visuals.plugins.dataDotStackedColumnComboChart.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.dataDotStackedColumnComboChart,(function(e){var t=e.module;return t.createCartesianChart({chartType:17,isScrollable:!0,tooltipsEnabled:!0,animator:t.createWebColumnChartAnimator(),behavior:t.createCartesianChartBehavior([t.createColumnChartWebBehavior(),t.createDataDotChartWebBehavior()]),isLabelInteractivityEnabled:n&&n.isLabelInteractivityEnabled})}),n);case e.visuals.plugins.donutChart.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.donutChart,(function(){return new e.visuals.DonutChart({animator:new e.visuals.WebDonutChartAnimator,isScrollable:!0,tooltipsEnabled:!0,behavior:new e.visuals.DonutChartWebBehavior})}),n);case e.visuals.plugins.funnel.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.funnel,(function(){return new e.visuals.FunnelChart({animator:new e.visuals.WebFunnelAnimator,behavior:new e.visuals.FunnelWebBehavior,tooltipsEnabled:!0})}),n);case e.visuals.plugins.gauge.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.gauge,(function(t){return t.module.createGauge({animator:new e.visuals.BaseAnimator,tooltipsEnabled:!0})}),n);case e.visuals.plugins.hundredPercentStackedBarChart.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.hundredPercentStackedBarChart,(function(e){var t=e.module;return t.createCartesianChart({chartType:7,isScrollable:!0,tooltipsEnabled:!0,animator:t.createWebColumnChartAnimator(),behavior:t.createCartesianChartBehavior([t.createColumnChartWebBehavior()]),isLabelInteractivityEnabled:n&&n.isLabelInteractivityEnabled})}),n);case e.visuals.plugins.hundredPercentStackedColumnChart.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.hundredPercentStackedColumnChart,(function(e){var t=e.module;return t.createCartesianChart({chartType:8,isScrollable:!0,tooltipsEnabled:!0,animator:t.createWebColumnChartAnimator(),behavior:t.createCartesianChartBehavior([t.createColumnChartWebBehavior()]),isLabelInteractivityEnabled:n&&n.isLabelInteractivityEnabled})}),n);case e.visuals.plugins.lineChart.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.lineChart,(function(t){var r=t.module;return r.createCartesianChart({chartType:0,isScrollable:!0,tooltipsEnabled:!0,animator:new e.visuals.BaseAnimator,behavior:r.createCartesianChartBehavior([r.createLineChartWebBehavior()]),isLabelInteractivityEnabled:n&&n.isLabelInteractivityEnabled,binnedLineSamplingSupported:l,steppedLine:u})}),n);case e.visuals.plugins.areaChart.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.areaChart,(function(t){var r=t.module;return r.createCartesianChart({chartType:1,isScrollable:!0,tooltipsEnabled:!0,animator:new e.visuals.BaseAnimator,behavior:r.createCartesianChartBehavior([r.createLineChartWebBehavior()]),isLabelInteractivityEnabled:n&&n.isLabelInteractivityEnabled,binnedLineSamplingSupported:l,steppedLine:u})}),n);case e.visuals.plugins.stackedAreaChart.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.stackedAreaChart,(function(t){var r=t.module;return r.createCartesianChart({chartType:2,isScrollable:!0,tooltipsEnabled:!0,animator:new e.visuals.BaseAnimator,behavior:r.createCartesianChartBehavior([r.createLineChartWebBehavior()]),binnedLineSamplingSupported:l,steppedLine:u})}),n);case e.visuals.plugins.lineClusteredColumnComboChart.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.lineClusteredColumnComboChart,(function(e){var t=e.module;return t.createCartesianChart({chartType:14,isScrollable:!0,tooltipsEnabled:!0,animator:t.createWebColumnChartAnimator(),behavior:t.createCartesianChartBehavior([t.createColumnChartWebBehavior(),t.createLineChartWebBehavior()]),isLabelInteractivityEnabled:n&&n.isLabelInteractivityEnabled,steppedLine:u})}),n);case e.visuals.plugins.lineStackedColumnComboChart.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.lineStackedColumnComboChart,(function(e){var t=e.module;return t.createCartesianChart({chartType:15,isScrollable:!0,tooltipsEnabled:!0,animator:t.createWebColumnChartAnimator(),behavior:t.createCartesianChartBehavior([t.createColumnChartWebBehavior(),t.createLineChartWebBehavior()]),isLabelInteractivityEnabled:n&&n.isLabelInteractivityEnabled,steppedLine:u})}),n);case e.visuals.plugins.pieChart.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.pieChart,(function(){return new e.visuals.DonutChart({sliceWidthRatio:0,animator:new e.visuals.WebDonutChartAnimator,isScrollable:!0,tooltipsEnabled:!0,behavior:new e.visuals.DonutChartWebBehavior})}),n);case e.visuals.plugins.ribbonChart.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.ribbonChart,(function(e){var t=e.module;return t.createCartesianChart({chartType:9,isScrollable:!0,tooltipsEnabled:!0,animator:t.createWebColumnChartAnimator(),behavior:t.createCartesianChartBehavior([t.createColumnChartWebBehavior()]),isLabelInteractivityEnabled:n&&n.isLabelInteractivityEnabled})}),n);case e.visuals.plugins.scatterChart.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.scatterChart,(function(t){var r=t.module;return r.createCartesianChart({chartType:10,isScrollable:!0,tooltipsEnabled:!0,animator:new e.visuals.BaseAnimator,behavior:r.createCartesianChartBehavior([r.createScatterChartWebBehavior()]),isLabelInteractivityEnabled:n&&n.isLabelInteractivityEnabled,lassoSelectEnabled:n&&n.lassoSelectEnabled,scatterWithMatrixDV:n&&n.scatterWithMatrixDV,scatterXYGrouping:n&&n.scatterXYGrouping})}),n);case e.visuals.plugins.treemap.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.treemap,(function(e){var t=e.module;return new t.Treemap({animator:t.webAnimator(),isScrollable:!0,behavior:t.webBehavior(),tooltipsEnabled:!0,cartesianConditionalFormatting:c})}),n);case e.visuals.plugins.filterSlicer.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.filterSlicer,(function(){return new e.visuals.Slicer({behavior:new e.visuals.SlicerWebBehavior,lockKeyboardNavigation:!1})}),n);case e.visuals.plugins.accessibleTable.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.accessibleTable,(function(e){return new e.module.AccessibleTable}),n);case e.visuals.plugins.sunburst.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.sunburst,(function(e){var t=e.module;return new t.Sunburst({isScrollable:!0,behavior:t.behavior()})}),n);case e.visuals.plugins.waterfallChart.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.waterfallChart,(function(e){var t=e.module;return t.createCartesianChart({chartType:13,isScrollable:!0,tooltipsEnabled:!0,behavior:t.createCartesianChartBehavior([t.createWaterfallChartWebBehavior()]),isLabelInteractivityEnabled:n&&n.isLabelInteractivityEnabled,waterfallBreakdown:n&&n.waterfallBreakdown})}),n);case e.visuals.plugins.map.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.map,(function(){return new e.visuals.Map({behavior:new e.visuals.MapBehavior,tooltipsEnabled:!0,isLegendScrollable:!0,mapControlFactory:r.mapControlFactory})}),n);case e.visuals.plugins.filledMap.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.filledMap,(function(){return new e.visuals.Map({filledMap:!0,behavior:new e.visuals.MapBehavior,tooltipsEnabled:!0,filledMapDataLabelsEnabled:n&&n.filledMapDataLabelsEnabled,isLegendScrollable:!0,mapControlFactory:r.mapControlFactory})}),n);case e.visuals.plugins.shapeMap.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.shapeMap,(function(e){var t=e.module;return new t.ShapeMap({behavior:new t.ShapeMapBehavior,tooltipsEnabled:!0})}),n);case e.visuals.plugins.slicer.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.slicer,(function(){return new e.visuals.Slicer({behavior:new e.visuals.SlicerWebBehavior})}),n);case e.visuals.plugins.matrix.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.matrix,(function(){return new e.visuals.Matrix({})}),n);case e.visuals.plugins.table.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.table,(function(){return new e.visuals.Table({})}),n);case e.visuals.plugins.pivotTable.name:var p=i.createDefaultConstructorOptions();return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.pivotTable,(function(){return new e.visuals.PivotTable(p,n)}),n);case e.visuals.plugins.tableEx.name:var f=a.createDefaultConstructorOptions();return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.tableEx,(function(){return new e.visuals.TableEx(f,n)}),n);case e.visuals.plugins.scriptVisual.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.scriptVisual,(function(e){return new e.module.ScriptVisual}),n);case e.visuals.plugins.pythonVisual.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.pythonVisual,(function(e){return new e.module.ScriptVisual}),n);case e.visuals.plugins.debugVisual.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.debugVisual,(function(){return new e.visuals.system.DebugVisual(r.visualSandbox)}),n);case e.visuals.plugins.textbox.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.textbox,(function(e){return e.module.createTextbox()}),n);case e.visuals.plugins.keyDriversVisual.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.keyDriversVisual,(function(e){return e.module.createAnalysisVisual()}),n);default:return e.Prototype.inherit(e.visuals.plugins[t])}},t})();t.ExplorationVisualPluginProvider=u})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){function r(e,t,r,i,n,a,o,s,l,u,c,p){return new m(e,t,r,o,s,u,a,i,n,l,c,p)}function i(t,r,i){return __awaiter(this,void 0,e.Promise,(function(){var e,n,a,o,s,l,u,p,f,d,h;return __generator(this,(function(v){switch(v.label){case 0:for(e=[],n=[],a=c.getExpectedModelExtension(t,r),o=0,s=a.entities;o<s.length;o++)for(l=s[o],u=0,p=l.measures;u<p.length;u++)f=p[u],f.references.unrecognizedReferences&&(n.push(f),e.push({context:{schema:a.name,entity:l.name,property:f.name},expression:f.expression}));return _.some(e)?[4,i.getMeasureReferences(t.modelExtensions,e)]:[2];case 1:for(d=v.sent(),h=0;h<d.length;h++)n[h].references={unrecognizedReferences:d[h].unrecognizedReferences,measures:d[h].measures};return[2]}}))}))}function n(t,r,i,n,a){return __awaiter(this,void 0,e.Promise,(function(){var e;return __generator(this,(function(o){switch(o.label){case 0:return[4,a.getMeasureReferences(t.modelExtensions,{context:{schema:r,entity:i,property:n.name},expression:n.expression})];case 1:return e=o.sent(),n.references={unrecognizedReferences:e.unrecognizedReferences,measures:e.measures},[2]}}))}))}function a(t,r,i,n){return __awaiter(this,void 0,e.Promise,(function(){var e,a,o,s,l,u,c,p,f,d,h;return __generator(this,(function(v){switch(v.label){case 0:for(e=[],a=[],o=0,s=t.entities;o<s.length;o++)for(l=s[o],u=0,c=l.measures;u<c.length;u++)p=c[u],f=_.findIndex(p.references.measures,r),f!==-1&&(a.push(p),e.push({context:{schema:t.name,entity:l.name,property:p.name},expression:p.expression}),i?p.references.measures[f]=i:p.references.measures.splice(f,1));return n?[4,n(e)]:[3,2];case 1:for(d=v.sent(),h=0;h<d.length;h++)a[h].expression=d[h];v.label=2;case 2:return[2]}}))}))}var o=e.data.dsr,s=e.explore.util,l=e.explore.util.FormatUtils,u=e.common.dialog.MessageDialogBuilder,c=e.explore.util.ModelExtensionUtils,p=e.explore.util.NameValidationError,f=e.data.contracts.primitiveTypeFromDataType,d=jsCommon.Utility,h={changes:[],hasQueryImpact:!1};t.createModelAuthoringService=r;var v;!(function(e){e.isNew="43dbc3e8-3a1c-4b6f-9923-b49ff7d6691c"})(v||(v={}));var m=(function(){function t(e,t,r,i,n,a,o,s,l,u,c,p){this.promiseFactory=e,this.telemetryService=t,this.modelChangeHandler=r,this.dataSourcesService=i,this.conceptualSchemaProxy=n,this.explorationSerializer=a,this.explorationNavigationService=o,o&&(this.services={cultureService:c,daxParserService:u,localizationService:l,promiseFactory:this.promiseFactory,telemetryService:this.telemetryService,modelAuthoringDialogService:new g(s,p)})}return t.prototype.apply=function(t){return __awaiter(this,void 0,e.Promise,(function(){var e;return __generator(this,(function(r){switch(r.label){case 0:return[4,this.tryApply(t)];case 1:return e=r.sent(),[2]}}))}))},t.prototype.tryApply=function(e){var r=this;return this.lastChange=t.continueTaskUnconditionally(this.lastChange,(function(){return r.tryApplyCore(e)})),this.lastChange},t.prototype.tryApplyCore=function(r){return __awaiter(this,void 0,e.Promise,(function(){var e,i,n,a,o,s,l,u,c=this;return __generator(this,(function(p){switch(p.label){case 0:return this.services?(e=_.map(r.changes,(function(e){return c.getSchemaChangeExecutor(e)})),e=_.filter(e,(function(e){return e&&e.canExecute()})),e.length>0?(i=r.changes[0],n=e[0],this.logTelemetry(i),[4,this.conceptualSchemaProxy.get(this.dataSourcesService.get())]):[3,7]):[3,7];case 1:a=p.sent(),o=this.explorationNavigationService.getCurrentExploration(),s=void 0,o.modelExtensions&&(s=this.explorationSerializer.serializeModelExtensions(o.modelExtensions)),this.onBeginModelChange(),l=h,p.label=2;case 2:return p.trys.push([2,4,5,7]),[4,n.execute(this.services,a,o)];case 3:return l=p.sent(),[2,!0];case 4:if(u=p.sent(),o.modelExtensions=s?this.explorationSerializer.deserializeModelExtensions(s):void 0,t.isHandledAuthoringError(u))return[2,!0];throw d.ensureError(u);case 5:return[4,this.onEndModelChange(l)];case 6:return p.sent(),[7];case 7:return[2,!1]}}))}))},t.prototype.onBeginModelChange=function(){this.pendingModelChangeDefer=this.promiseFactory.defer(),this.modelChangeHandler.applyChange({change:this.pendingModelChangeDefer.promise})},t.prototype.onEndModelChange=function(t){return __awaiter(this,void 0,e.Promise,(function(){var e;return __generator(this,(function(r){switch(r.label){case 0:return this.pendingModelChangeDefer.resolve(t),this.pendingModelChangeDefer=null,e=this.promiseFactory.defer(),e.resolve(void 0),[4,e.promise];case 1:return r.sent(),[2]}}))}))},t.prototype.getSchemaChangeExecutor=function(e){return e.newMeasure?new C(e.newMeasure):e.newQuickCalc?new x(e.newQuickCalc):e.copyFormatting?new T(e.copyFormatting):e.propertyRename?new b(e.propertyRename):e.itemDelete?new S(e.itemDelete):e.updateCalculation?new E(e.updateCalculation):e.measureMove?new w(e.measureMove):e.setAnnotation?new F(e.setAnnotation):e.itemShowHide?new V(e.itemShowHide):e.setDataType?new P(e.setDataType):e.setDataCategory?new D(e.setDataCategory):e.setFormatting?new R(e.setFormatting):e.toggleThousandsSeparator?new N(e.toggleThousandsSeparator):e.setDecimalPlaces?new j(e.setDecimalPlaces):e.setDateTimeFormatInfo?new O(e.setDateTimeFormatInfo):e.setCurrencyFormatInfo?new M(e.setCurrencyFormatInfo):e.setDescription?new I(e.setDescription):void 0},t.prototype.logTelemetry=function(t){var r=Object.getOwnPropertyNames(t);this.telemetryService.logEvent(e.telemetry.EXModelChange,r[0])},t.createHandledAuthoringError=function(){var e=new Error;return e.suppressExceptionHandler=!0,e},t.isHandledAuthoringError=function(e){return e.suppressExceptionHandler},t.continueTaskUnconditionally=function(t,r){return __awaiter(this,void 0,e.Promise,(function(){var e;return __generator(this,(function(i){switch(i.label){case 0:if(!t)return[3,4];i.label=1;case 1:return i.trys.push([1,3,,4]),[4,t];case 2:return i.sent(),[3,4];case 3:return e=i.sent(),[3,4];case 4:return[4,r()];case 5:return[2,i.sent()]}}))}))},t})();t.ModelAuthoringService=m;var g=(function(){function t(e,t){this.modalDialogService=e,this.uiBlockingService=t}return t.prototype.showDialog=function(t){return __awaiter(this,void 0,e.Promise,(function(){var e;return __generator(this,(function(r){switch(r.label){case 0:this.uiBlockingService.beginAllowModalDialogs(),r.label=1;case 1:return r.trys.push([1,,3,4]),e=new u(this.modalDialogService),[4,e.show("model authoring message",t)];case 2:return[2,r.sent()];case 3:return this.uiBlockingService.endAllowModalDialogs(),[7];case 4:return[2]}}))}))},t})(),y=(function(){function e(e){this.schemaChangeBase=e}return e.prototype.canExecute=function(){return!!this.schemaChangeBase.schema},e.prototype.showMessage=function(e,t,r){var i={okButtonText:"OK_ButtonText",titleText:t,messageText:r};return e.modelAuthoringDialogService.showDialog(i)},e})(),C=(function(t){function r(e){var r=t.call(this,e)||this;return r.schemaChange=e,r}return __extends(r,t),r.prototype.execute=function(t,r,n){return __awaiter(this,void 0,e.Promise,(function(){var a,s,u,p,f,d,h,m,g;return __generator(this,(function(y){if(a=r.schema(o.DefaultSchemaName),!a||!a.capabilities.isExtendable)throw new Error("Attempting to extend a non-existent or non-extendable schema");return s=c.ensureEntityExists(n,this.schemaChange.schema,this.schemaChange.entity),u=e.explore.util.createNameValidator(r,t.localizationService),p=u.makeValidMeasureName(t.localizationService.get("NewMeasureName")),f={name:p,dataType:3,references:{unrecognizedReferences:!1,measures:[]},expression:"",hidden:!1},c.addMeasure(s,f),i(n,this.schemaChange.schema,t.daxParserService),d=new l(t.cultureService.getFormatInfo()),f.formatInformation=d.updateFormatUponDataTypeChange(f.dataType,f.formatInformation),h={schema:this.schemaChange.schema,objectType:"Measure",topLevelObjectName:s.name,property:f.name,annotationName:v.isNew,value:"true"},m=F.setAnnotation(h,n),g={schema:this.schemaChange.schema,entity:this.schemaChange.entity,name:f.name,expression:f.expression},[2,{changes:[{newMeasureCreated:g},m],hasQueryImpact:!0}]}))}))},r})(y),x=(function(t){function r(e){var r=t.call(this,e)||this;return r.schemaChange=e,r}return __extends(r,t),r.prototype.execute=function(t,r,i){return __awaiter(this,void 0,e.Promise,(function(){var e,n,a,o,l,u,p,f,d,h;return __generator(this,(function(v){switch(v.label){case 0:return e={newMeasure:{schema:this.schemaChange.schema,entity:this.schemaChange.entity}},n=new C(e.newMeasure),[4,n.execute(t,r,i)];case 1:return a=v.sent(),o=_.find(a.changes,(function(e){return e.newMeasureCreated})),l=s.createNameValidator(r,t.localizationService),u=l.makeValidMeasureName(this.schemaChange.name),p={updateCalculation:{schema:this.schemaChange.schema,entity:this.schemaChange.entity,property:o.newMeasureCreated.name,expression:this.schemaChange.expression,anonymizedExpression:"",newName:u}},f=new E(p.updateCalculation),[4,f.execute(t,r,i)];case 2:return v.sent(),d=c.getExpectedMeasure(i,this.schemaChange.schema,this.schemaChange.entity,u),d.measureTemplate={daxTemplateName:this.schemaChange.daxTemplateName,version:0},h={schema:this.schemaChange.schema,entity:this.schemaChange.entity,name:u,expression:this.schemaChange.expression},[2,{changes:[{newMeasureCreated:h}],hasQueryImpact:!0}]}}))}))},r})(y),b=(function(t){function r(e){var r=t.call(this,e)||this;return r.schemaChange=e,r}return __extends(r,t),r.prototype.execute=function(t,r,n){return __awaiter(this,void 0,e.Promise,(function(){var a,o,l;return __generator(this,(function(u){switch(u.label){case 0:return a=c.getExpectedMeasure(n,this.schemaChange.schema,this.schemaChange.entity,this.schemaChange.before),o=s.createNameValidator(r,t.localizationService),l=o.validateMeasureName(this.schemaChange.after,this.schemaChange.before),l.error===p.None?[3,2]:[4,this.showMessage(t,t.localizationService.get("RenameMeasureErrorTitle"),l.reason)];case 1:throw u.sent(),m.createHandledAuthoringError();case 2:return[4,this.fixupUponMeasureRename(t.daxParserService,n)];case 3:return u.sent(),a.name=this.schemaChange.after,[4,i(n,this.schemaChange.schema,t.daxParserService)];case 4:return u.sent(),a.measureTemplate&&t.telemetryService.logEvent(e.telemetry.EXQuickCalcMeasureEdited,a.measureTemplate.daxTemplateName),[2,{changes:[{propertyRename:this.schemaChange
}],hasQueryImpact:!0}]}}))}))},r.prototype.fixupUponMeasureRename=function(e,t){var r=this,i={schema:this.schemaChange.schema,entity:this.schemaChange.entity,name:this.schemaChange.before},n={schema:this.schemaChange.schema,entity:this.schemaChange.entity,name:this.schemaChange.after},o=c.getExpectedModelExtension(t,this.schemaChange.schema);return debug&&c.getExpectedMeasure(t,i.schema,i.entity,i.name),a(o,i,n,(function(i){return e.renameMeasureReferences(t.modelExtensions,i,r.schemaChange.before,r.schemaChange.after)}))},r})(y),S=(function(t){function r(e){var r=t.call(this,e)||this;return r.schemaChange=e,r}return __extends(r,t),r.prototype.execute=function(t,r,i){return __awaiter(this,void 0,e.Promise,(function(){var r;return __generator(this,(function(n){switch(n.label){case 0:return r=c.getExpectedMeasure(i,this.schemaChange.schema,this.schemaChange.entity,this.schemaChange.property),c.removeMeasure(i,this.schemaChange.schema,this.schemaChange.entity,this.schemaChange.property),[4,this.fixupMeasureReferences(c.getOptionalModelExtension(i,this.schemaChange.schema))];case 1:return n.sent(),r.measureTemplate&&t.telemetryService.logEvent(e.telemetry.EXQuickCalcMeasureDeleted,r.measureTemplate.daxTemplateName),[2,{changes:[{itemDelete:this.schemaChange}],hasQueryImpact:!0}]}}))}))},r.prototype.showDeleteConfirmationDialog=function(e){var t={okButtonText:"ModalDialogButtonText_Delete",cancelButtonText:"ModalDialogButtonText_Cancel",titleText:"DeleteMeasurePromptTitle",messageText:e.localizationService.format("DeleteMeasurePrompt",[this.schemaChange.property])};return e.modelAuthoringDialogService.showDialog(t)},r.prototype.fixupMeasureReferences=function(t){return __awaiter(this,void 0,e.Promise,(function(){var e;return __generator(this,(function(r){switch(r.label){case 0:return t?(e={schema:this.schemaChange.schema,entity:this.schemaChange.entity,name:this.schemaChange.property},[4,a(t,e,void 0)]):[2];case 1:return r.sent(),[2]}}))}))},r})(y),E=(function(t){function r(e){var r=t.call(this,e)||this;return r.schemaChange=e,r}return __extends(r,t),r.prototype.execute=function(t,r,i){return __awaiter(this,void 0,e.Promise,(function(){var a,o,s,l,u,p,f,d;return __generator(this,(function(h){switch(h.label){case 0:return a=c.getExpectedMeasure(i,this.schemaChange.schema,this.schemaChange.entity,this.schemaChange.property),a.expression=this.schemaChange.expression,a.formulaOverride=this.schemaChange.expressionOverride&&this.schemaChange.expressionOverride.formula,a.errorMessage=this.schemaChange.errorMessage,t.telemetryService.logEvent(e.telemetry.EXMeasures,this.schemaChange.anonymizedExpression||"","ReportModelOperationUpdateMeasure"),a.formulaOverride&&(o={expression:a.formulaOverride,formula:a.formulaOverride}),s={updateExpression:{schema:this.schemaChange.schema,entity:this.schemaChange.entity,property:this.schemaChange.property,expression:this.schemaChange.expression,errorMessage:this.schemaChange.errorMessage,expressionOverride:o}},[4,n(i,this.schemaChange.schema,this.schemaChange.entity,a,t.daxParserService)];case 1:return h.sent(),l=[s],this.schemaChange.newName===this.schemaChange.property?[3,3]:(u={propertyRename:{schema:this.schemaChange.schema,objectType:"Measure",entity:this.schemaChange.entity,before:this.schemaChange.property,after:this.schemaChange.newName}},p=new b(u.propertyRename),[4,p.execute(t,r,i)]);case 2:f=h.sent(),l.push.apply(l,f.changes),h.label=3;case 3:return a.measureTemplate&&t.telemetryService.logEvent(e.telemetry.EXQuickCalcMeasureEdited,a.measureTemplate.daxTemplateName),d={schema:this.schemaChange.schema,objectType:"Measure",topLevelObjectName:this.schemaChange.entity,property:this.schemaChange.newName,annotationName:v.isNew,value:null},l.push(F.setAnnotation(d,i)),[2,{changes:l,hasQueryImpact:!0}]}}))}))},r})(y),w=(function(t){function r(e){var r=t.call(this,e)||this;return r.schemaChange=e,r}return __extends(r,t),r.prototype.execute=function(t,r,n){return __awaiter(this,void 0,e.Promise,(function(){var e,r,a;return __generator(this,(function(o){switch(o.label){case 0:return e=c.getExpectedModelExtension(n,this.schemaChange.schema),r=c.getExpectedMeasure(n,this.schemaChange.schema,this.schemaChange.source,this.schemaChange.property),a=c.getOrCreateExtendingEntity(e,this.schemaChange.destination),[4,this.fixupUponMeasureMove(t.daxParserService,n)];case 1:return o.sent(),c.removeMeasure(n,this.schemaChange.schema,this.schemaChange.source,this.schemaChange.property),c.addMeasure(a,r),[4,i(n,this.schemaChange.schema,t.daxParserService)];case 2:return o.sent(),[2,{changes:[{measureMove:this.schemaChange}],hasQueryImpact:!0}]}}))}))},r.prototype.fixupUponMeasureMove=function(e,t){var r=this,i=c.getExpectedModelExtension(t,this.schemaChange.schema),n={schema:this.schemaChange.schema,entity:this.schemaChange.source,name:this.schemaChange.property},o={schema:this.schemaChange.schema,entity:this.schemaChange.destination,name:this.schemaChange.property};return debug&&c.getExpectedMeasure(t,n.schema,n.entity,n.name),a(i,n,o,(function(i){return e.renameMovedMeasureTableReference(t.modelExtensions,i,r.schemaChange.property,r.schemaChange.source,r.schemaChange.destination)}))},r})(y),F=(function(t){function r(e){var r=t.call(this,e)||this;return r.schemaChange=e,r}return __extends(r,t),r.setAnnotation=function(e,t){var r=c.getExpectedMeasure(t,e.schema,e.topLevelObjectName,e.property);return c.setAnnotation(r,e.annotationName,e.value),{setAnnotation:e}},r.prototype.execute=function(t,i,n){return __awaiter(this,void 0,e.Promise,(function(){var e;return __generator(this,(function(t){return e=r.setAnnotation(this.schemaChange,n),[2,{changes:[e],hasQueryImpact:!1}]}))}))},r})(y),V=(function(t){function r(e){var r=t.call(this,e)||this;return r.schemaChange=e,r}return __extends(r,t),r.prototype.execute=function(t,r,i){return __awaiter(this,void 0,e.Promise,(function(){var e,t,r,n,a,o,s,e;return __generator(this,(function(l){if(this.schemaChange.property)e=c.getExpectedMeasure(i,this.schemaChange.schema,this.schemaChange.entity,this.schemaChange.property),e.hidden=this.schemaChange.makeHidden;else if(t=c.getOptionalModelExtension(i,this.schemaChange.schema))for(r=0,n=t.entities;r<n.length;r++)for(a=n[r],o=0,s=a.measures;o<s.length;o++)e=s[o],e.hidden=this.schemaChange.makeHidden;return[2,{changes:[{itemShowHide:this.schemaChange}],hasQueryImpact:!1}]}))}))},r})(y),P=(function(t){function r(e){var r=t.call(this,e)||this;return r.schemaChange=e,r}return __extends(r,t),r.prototype.execute=function(t,r,i){return __awaiter(this,void 0,e.Promise,(function(){var r,n,a;return __generator(this,(function(o){return r=c.getExpectedMeasure(i,this.schemaChange.schema,this.schemaChange.entity,this.schemaChange.property),n=r.dataType,r.dataType=f(this.schemaChange.dataType),a=new l(t.cultureService.getFormatInfo()),r.formatInformation=a.updateFormatUponDataTypeChange(r.dataType,r.formatInformation),t.telemetryService.logEvent(e.telemetry.EXReportMeasureDataTypeChange,e.PrimitiveTypeStrings[n],e.PrimitiveTypeStrings[r.dataType]),[2,{changes:[{setDataType:this.schemaChange}],hasQueryImpact:!0}]}))}))},r})(y),D=(function(t){function r(e){var r=t.call(this,e)||this;return r.schemaChange=e,r}return __extends(r,t),r.prototype.execute=function(t,r,i){return __awaiter(this,void 0,e.Promise,(function(){var r,n;return __generator(this,(function(a){return r=c.getExpectedMeasure(i,this.schemaChange.schema,this.schemaChange.entity,this.schemaChange.property),n=r.dataCategory,"Uncategorized"===this.schemaChange.dataCategory&&(this.schemaChange.dataCategory=void 0),r.dataCategory=this.schemaChange.dataCategory,t.telemetryService.logEvent(e.telemetry.EXReportMeasureDataCategoryChange,n,r.dataCategory),[2,{changes:[{setDataCategory:this.schemaChange}],hasQueryImpact:!1}]}))}))},r})(y),R=(function(t){function r(e){var r=t.call(this,e)||this;return r.schemaChange=e,r}return __extends(r,t),r.prototype.execute=function(t,r,i){return __awaiter(this,void 0,e.Promise,(function(){var e,r;return __generator(this,(function(n){return e=c.getExpectedMeasure(i,this.schemaChange.schema,this.schemaChange.entity,this.schemaChange.property),r=new l(t.cultureService.getFormatInfo()),e.formatInformation=r.changeFormat(e.dataType,e.formatInformation,this.schemaChange.format),[2,{changes:[{setFormatting:this.schemaChange}],hasQueryImpact:!1}]}))}))},r})(y),T=(function(t){function r(e){var r=t.call(this,e)||this;return r.schemaChange=e,r}return __extends(r,t),r.prototype.execute=function(t,r,i){return __awaiter(this,void 0,e.Promise,(function(){var e,n,a;return __generator(this,(function(o){switch(o.label){case 0:return this.schemaChange.sourceSchema?(e=c.getExpectedMeasure(i,this.schemaChange.sourceSchema,this.schemaChange.sourceEntity,this.schemaChange.sourceProperty),n={setFormatting:{schema:this.schemaChange.schema,entity:this.schemaChange.targetEntity,property:this.schemaChange.targetProperty,format:e.formatInformation.format}},a=new R(n.setFormatting),[4,a.execute(t,r,i)]):[3,2];case 1:o.sent(),o.label=2;case 2:return[2,{changes:[{copyFormatting:this.schemaChange}],hasQueryImpact:!1}]}}))}))},r})(y),N=(function(t){function r(e){var r=t.call(this,e)||this;return r.schemaChange=e,r}return __extends(r,t),r.prototype.execute=function(t,r,i){return __awaiter(this,void 0,e.Promise,(function(){var e,r;return __generator(this,(function(n){return e=c.getExpectedMeasure(i,this.schemaChange.schema,this.schemaChange.entity,this.schemaChange.property),r=new l(t.cultureService.getFormatInfo()),e.formatInformation=r.toggleThousandsSeparator(e.dataType,e.formatInformation),[2,{changes:[{toggleThousandsSeparator:this.schemaChange}],hasQueryImpact:!1}]}))}))},r})(y),I=(function(t){function r(e){var r=t.call(this,e)||this;return r.schemaChange=e,r}return __extends(r,t),r.prototype.execute=function(t,r,i){return __awaiter(this,void 0,e.Promise,(function(){var e,t;return __generator(this,(function(r){return e=this.schemaChange,t=c.getExpectedMeasure(i,e.schema,e.topLevelObjectName,e.tableItemName),t.description=e.description,[2,{changes:[{setDescription:e}],hasQueryImpact:!1}]}))}))},r})(y),j=(function(t){function r(e){var r=t.call(this,e)||this;return r.schemaChange=e,r}return __extends(r,t),r.prototype.execute=function(t,r,i){return __awaiter(this,void 0,e.Promise,(function(){var e,r;return __generator(this,(function(n){return e=c.getExpectedMeasure(i,this.schemaChange.schema,this.schemaChange.entity,this.schemaChange.property),r=new l(t.cultureService.getFormatInfo()),e.formatInformation=r.setAccuracy(e.dataType,e.formatInformation,this.schemaChange.decimalPlaces),[2,{changes:[{setDecimalPlaces:this.schemaChange}],hasQueryImpact:!1}]}))}))},r})(y),O=(function(t){function r(e){var r=t.call(this,e)||this;return r.schemaChange=e,r}return __extends(r,t),r.prototype.execute=function(t,r,i){return __awaiter(this,void 0,e.Promise,(function(){var e,r;return __generator(this,(function(n){return e=c.getExpectedMeasure(i,this.schemaChange.schema,this.schemaChange.entity,this.schemaChange.property),r=new l(t.cultureService.getFormatInfo()),e.formatInformation=r.setDateTimeFormat(e.dataType,e.formatInformation,this.schemaChange.format,this.schemaChange.dateTimeCustomFormatGroup,this.schemaChange.formatString),[2,{changes:[{setDateTimeFormatInfo:this.schemaChange}],hasQueryImpact:!1}]}))}))},r})(y),M=(function(t){function r(e){var r=t.call(this,e)||this;return r.schemaChange=e,r}return __extends(r,t),r.prototype.execute=function(t,r,i){return __awaiter(this,void 0,e.Promise,(function(){var e,r;return __generator(this,(function(n){return e=c.getExpectedMeasure(i,this.schemaChange.schema,this.schemaChange.entity,this.schemaChange.property),r=new l(t.cultureService.getFormatInfo()),e.formatInformation=r.setCurrencyFormat(e.dataType,e.formatInformation,this.schemaChange.format,this.schemaChange.lcid,this.schemaChange.displayName,this.schemaChange.currencySymbol,this.schemaChange.positivePattern,this.schemaChange.negativePattern),[2,{changes:[{setCurrencyFormatInfo:this.schemaChange}],hasQueryImpact:!1}]}))}))},r})(y)})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){function t(){return{getGroupingDesignState:function(){return null}}}e.createGroupingDesignStateService=t})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(r){function i(e){return new s(e)}var n;!(function(e){e[e.None=0]="None",e[e.Basic=1]="Basic",e[e.Binning=2]="Binning",e[e.Clustering=3]="Clustering"})(n=r.GroupMode||(r.GroupMode={}));var a;!(function(e){e[e.Category=0]="Category",e[e.Number=1]="Number",e[e.DateTime=2]="DateTime"})(a=r.GroupDataType||(r.GroupDataType={}));var o;!(function(e){e[e.BySize=0]="BySize",e[e.ByCount=1]="ByCount"})(o=r.BinMode||(r.BinMode={})),r.createDisabledGroupAuthoringService=i;var s=(function(){function e(e){this.visual=new l,this.dialog=new u,this.telemetry=new c(e)}return e})(),l=(function(){function e(){}return e.prototype.canGroup=function(e,t,r){return!1},e.prototype.group=function(e,t,r,i,n){return null},e})(),u=(function(){function e(){}return e.prototype.showDialog=function(e){return null},e})(),c=(function(){function r(e){this.telemetryService=e}return r.prototype.logGroupActionTelemetry=function(e,t,r,i,n){},r.prototype.logBinBySizeActionTelemetry=function(e,t,r,i,n){},r.prototype.logBinByCountActionTelemetry=function(e,t,r,i,n,a){},r.prototype.logGroupsErrorTelemetry=function(e,t,r,i){},r.prototype.logGroupsDeleteTelemetry=function(e,t,r){},r.prototype.logGroupsUsageTelemetry=function(r,i,a,o,s,l){var u=this;r.then((function(r){var c=i.getConceptualProperty(r);if(c){var p=i.getTargetEntity().entity,f=t.utils.GroupUtils.getGroupMode(p,c,null);if(f!==n.None){var d=f===n.Binning?"Bin":"List";u.telemetryService.logEvent(e.telemetry.EXGroupsUsage,a,o,s,l,d)}}}))},r})()})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){function t(e){return new r(e)}e.createUIBlockingService=t;var r=(function(){function e(e){this.promiseFactory=e}return e.prototype.waitTillUnblocked=function(){return this.promiseFactory.resolve()},e.prototype.beginBlockUI=function(){},e.prototype.endBlockUI=function(){},e.prototype.beginAllowModalDialogs=function(){},e.prototype.endAllowModalDialogs=function(){},e})()})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(){}return e.prototype.register=function(e,t){var r=e();return{actionResult:r,succeeded:!(_.isBoolean(r)&&!r)}},e.prototype.getTopUndoFrame=function(){},e.prototype.canRedo=function(){return!1},e.prototype.canUndo=function(){return!1},e.prototype.canClear=function(){return!1},e.prototype.undo=function(){return!1},e.prototype.redo=function(){return!1},e.prototype.clear=function(){return!1},e.prototype.getReferences=function(){return{}},e})();e.UndoRedoNoOp=t})(t=e.undoRedoStrategy||(e.undoRedoStrategy={}))})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){function r(e,r,i,a,o){return void 0===o&&(o=new t.undoRedoStrategy.UndoRedoNoOp),new n(e,r,i,a,o)}var i=e.common.constants;t.createUndoRedoService=r;var n=(function(){function e(e,t,r,i,n){this.$rootScope=e,this.$timeout=t,this.eventBridge=r,this.loggerService=i,this.strategy=n}return e.prototype.setStrategy=function(e){this.strategy=e,this.clear()},e.prototype.undo=function(){var e=this;this.verifyStrategy()&&this.canUndo()&&this.$timeout((function(){e.strategy&&e.strategy.undo()&&(e.runSideEffects(),e.fireEvents())}))},e.prototype.redo=function(){var e=this;this.verifyStrategy()&&this.canRedo()&&this.$timeout((function(){e.strategy&&e.strategy.redo()&&(e.runSideEffects(),e.fireEvents())}))},e.prototype.registerSideEffect=function(e){this.sideEffects||(this.sideEffects=[]),this.sideEffects.push(e)},e.prototype.clear=function(){this.verifyStrategy()&&(this.strategy.canClear()&&this.strategy.clear(),this.eventBridge.publishToChannel(t.events.undoRedoStackUpdated))},e.prototype.canRedo=function(){return this.verifyStrategy()&&this.strategy.canRedo()},e.prototype.canUndo=function(){return this.verifyStrategy()&&this.strategy.canUndo()},e.prototype.getTopUndoFrame=function(){return this.verifyStrategy()&&this.strategy.getTopUndoFrame()},e.prototype.undoRedoPostProcessing=function(e){this.loggerService.addUserAction({message:e,type:"UndoRedo"}),this.$rootScope.$applyAsync()},e.prototype.register=function(e,t,r){var i,n=!1;if(this.verifyStrategy()){var a=this.strategy.register(t,r);i=a.actionResult,n=a.succeeded}else i=t(),n=!(_.isBoolean(i)&&!i);return n&&(this.runSideEffects(e),this.fireEvents(e)),this.undoRedoPostProcessing(e),i},e.prototype.fireEvents=function(e){this.$rootScope.$emit(i.onReportChangedEventName,!0,e),this.eventBridge.publishToChannel(t.events.onReportChanged,{explorationContentChanged:!0}),this.eventBridge.publishToChannel(t.events.undoRedoStackUpdated)},e.prototype.runSideEffects=function(e){if(!_.isEmpty(this.sideEffects))for(var t=0,r=this.sideEffects;t<r.length;t++){var i=r[t];i.run(e)}},e.prototype.verifyStrategy=function(){return!!this.strategy},e})()})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){var t=jsCommon.CircularStack,r=30,i=(function(){function e(e,i){this.handler=e,this.staticResourceReferences=i,this.undoStack=new t(r),this.redoStack=new t(r),this.staticResourceReferences.addReferenceSource(this)}return e.prototype.register=function(e,t){var r=this.captureUndoFrame(this.handler);r.recurringActionInfo=t;var i=this.canMergeWithTopFrame(t),n=this.startTransaction(r),a=e(),o=!(_.isBoolean(a)&&!a);return o?this.endTransaction(n,i):this.cancelTransaction(n),{succeeded:o,actionResult:a}},e.prototype.getReferences=function(){return this.addStackReferences(this.undoStack,this.addStackReferences(this.redoStack))},e.prototype.addStackReferences=function(e,t){t=t||{};for(var r=e.length;r-- >0;)_.merge(t,e.item(r).getReferences());return t},e.prototype.undo=function(){return!!this.canUndo()&&this.rollbackTop(this.undoStack,this.redoStack)},e.prototype.redo=function(){return!!this.canRedo()&&this.rollbackTop(this.redoStack,this.undoStack)},e.prototype.clear=function(){return this.undoStack.clear(),this.redoStack.clear(),!0},e.prototype.canRedo=function(){return this.redoStack.length>0},e.prototype.canUndo=function(){return this.undoStack.length>0},e.prototype.canClear=function(){return!0},e.prototype.getTopUndoFrame=function(){var e=this.undoStack.peek();return e?e.getFrame():void 0},e.prototype.canMergeWithTopFrame=function(e){if(!e)return!1;if(this.canUndo()){var t=this.getTopUndoFrame();if(t&&void 0!==t.recurringActionInfo&&t.recurringActionInfo.equals(e))return!0}return!1},e.prototype.rollbackTop=function(e,t){var r=e.pop();if(r){var i=r.rollbackFrame(),n=this.validTransactionCheck(i);return n&&t.push(i),n}},e.prototype.isIPromise=function(e){return e&&e.finally},e.prototype.startTransaction=function(e){var t=new a;return this.currentTransaction||(this.currentTransaction=t,this.currentTransaction.addUndoFrame(e)),this.currentTransaction},e.prototype.endTransaction=function(e,t){if(!t){this.redoStack.clear();this.validTransactionCheck(this.currentTransaction)&&this.undoStack.push(this.currentTransaction)}this.currentTransaction=void 0},e.prototype.cancelTransaction=function(e){this.currentTransaction=void 0},e.prototype.captureUndoFrame=function(e){return new n(e)},e.prototype.validTransactionCheck=function(e){return!!e},e})();e.UndoRedoStack=i;var n=(function(){function e(e,t){this.handler=e,this.snapshot=this.handler.takeSnapshot(t)}return e.prototype.rollbackFrame=function(){var t=new e(this.handler,this.snapshot);return this.handler.rollback(this.snapshot),t},e.prototype.getReferences=function(){return this.snapshot.getReferences&&this.snapshot.getReferences()},e})(),a=(function(){function e(e){this.frames=e||[]}return e.prototype.addUndoFrame=function(e){this.frames.push(e)},e.prototype.rollbackFrame=function(){return new e(_.map(this.frames,(function(e){if(e)return e.rollbackFrame()})))},e.prototype.getFrame=function(){return this.frames[0]},e.prototype.getReferences=function(){for(var e={},t=0,r=this.frames;t<r.length;t++){var i=r[t];_.merge(e,i.getReferences())}return e},e})()})(t=e.undoRedoStrategy||(e.undoRedoStrategy={}))})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={})),powerbi.define("Explore/services/columnPropertiesAuthoring",(function(){function e(e,t){var r=[];if(t.columnProperties)for(var i=0,n=e;i<n.length;i++){var a=n[i],o=t.query.defn.selectNameOf(a),s=t.columnProperties[o];s&&r.push({originalExpr:a,columnProperty:s})}return r}function t(e,t,r,i){var n=_.find(i,(function(t){return t.originalExpr===e}));if(n){var a=r.query.defn.selectNameOf(t);r.columnProperties[a]||(r.columnProperties[a]=n.columnProperty)}}return{getColumnPropertiesForExprs:e,applyColumnPropertiesByExpr:t}}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(r){function i(e,t,r,i){return new D(e,t,r,i)}function n(e,t,r,i){function n(e,t,r,n){i&&i(e.objectName,e.selector,t,r,n,n&&e.properties&&e.properties[t])}if(!e)return!1;var l=!1;if(e.replace)for(var u=0,c=e.replace;u<c.length;u++){var p=c[u],f=s.ensure(r,p.objectName,p.selector),d={};for(var h in p.properties)o.isValidPropertyName(h)&&(d[h]=a(p,h,t));var v=f.properties;if(!s.allPropertiesAreEqual(v,d)){l=!0;for(var m=s.getUnequalProperties(v,d),g=0,y=m;g<y.length;g++){var h=y[g];n(p,h,v[h],d[h])}f.properties=d}}if(e.merge)for(var C=0,x=e.merge;C<x.length;C++){var p=x[C],f=s.ensure(r,p.objectName,p.selector);for(var h in p.properties)if(o.isValidPropertyName(h)){var b=a(p,h,t);s.propertiesAreEqual(f.properties[h],b)||(l=!0,n(p,h,f.properties[h],b),f.properties[h]=b)}}if(e.remove)for(var S=0,E=e.remove;S<E.length;S++){var p=E[S],f=s.getObjectDefinition(r,p.objectName,p.selector);if(f)for(var h in p.properties)o.isValidPropertyName(h)&&f.properties.hasOwnProperty(h)&&(l=!0,n(p,h,f.properties[h],void 0),delete f.properties[h])}if(e.removeObject)for(var w=0,F=e.removeObject;w<F.length;w++){var p=F[w],f=s.getObjectDefinition(r,p.objectName,p.selector);if(f){if(i)for(var h in f.properties)n(p,h,f.properties[h],void 0);l=s.deleteObjectDefinition(r,p.objectName,p.selector)||l}}return l}function a(e,t,r){var i,n=e.properties[t];return r&&r[e.objectName]&&r[e.objectName].properties[t]&&(i=r[e.objectName].properties[t].type),s.encodePropertyValue(n,i||{})}var o=e.data.DataViewObjectDefinition,s=e.data.DataViewObjectDefinitions,l=e.data.DataViewObjectDescriptors,u=e.data.DataViewRoleWildcard,c=e.explore.util.DrillUtils,p=e.data.FieldExprPattern,f=e.visuals.GradientUtils,d=t.util.HierarchyUtils,h=jsCommon.JsonComparer,v=e.data.QueryProjectionCollection,m=e.data.QueryProjectionsByRole,g=e.data.ScopeIdentityExtractor,y=e.data.Selector,C=e.data.SemanticQuery,x=t.contracts.SingleVisualConfig,b=e.data.SQExpr,S=e.data.SQExprBuilder,E=e.data.SQExprConverter,w=e.explore.utils.SQExprToRoleDictionary,F=e.data.SQExprUtils,V=e.data.SQHierarchyExprUtils,P=t.contracts.VisualQuery;r.createVisualAuthoringCore=i,r.applyPropertyChanges=n;var D=(function(){function i(e,t,i,n){this.visualPluginService=e,this.geoTaggingService=t,this.aggrOps=i,this.visualAuthoringCustomizeOperations=r.createVisualAuthoringCustomizeOperations(this.visualPluginService,n)}return i.prototype.create=function(t){var r=this.visualPluginService.capabilities(t.visualType),i=e.requireSync("Explore/services/visualCapabilitiesHelper").create(r,this.geoTaggingService);if(i){var n=t.query||new P(C.create(),{},[]),a={visualType:t.visualType,query:n};this.visualAuthoringCustomizeOperations.customizeOptions(a,t.schema);for(var o in a.query.projections)this.ensureDependentObjectDefn(i.objectDescs,o,a);if(_.isEmpty(t.expr)||this.tryAdd(i,a,t))return{singleVisual:a}}},i.prototype.add=function(t,r){var n=r.singleVisual;if(!n)return!1;var a=this.visualPluginService.capabilities(n.visualType),o=e.requireSync("Explore/services/visualCapabilitiesHelper").create(a,this.geoTaggingService);return!!o&&(n.query||(n.query=new P(C.create(),{},[])),!!this.tryAdd(o,n,t)&&(this.visualAuthoringCustomizeOperations.customizeOptions(n,t.schema),i.clearConversionSourceContext(n),!0))},i.prototype.remove=function(e,t,r){var n=t.singleVisual;return!!n&&(!!this.tryRemove(n.query,n.columnProperties,e,r)&&(i.clearConversionSourceContext(n),!0))},i.prototype.replace=function(e,t){var r=t.singleVisual;if(!r)return!1;if(e.sourceRole===e.targetRole&&!e.replacementExpressions)return!!r.query.moveProjection(e.targetRole,e.sourceIndex,e.targetIndex,e.sourceCount)&&(i.clearConversionSourceContext(r),!0);for(var n=[],a=0;a<e.sourceCount;a++)if(n[a]=r.query.tryGetExpr(e.sourceRole,e.sourceIndex+a),!n[a])return!1;return this.replaceProjectionCore(t,n,e.sourceRole,e.targetRole,e.sourceIndex,e.targetIndex,e.replacementExpressions,e.schema,e.allowPartialReplace)},i.prototype.convert=function(t){var r=t.source;if(!r||r.visualType===t.target)return!1;var i=r.conversionSourceContext;i||(i=r.conversionSourceContext=this.createConversionSourceContext(r.query,r.visualType,r.syncGroup));var n=this.visualPluginService.capabilities(i.visualType),a=this.visualPluginService.capabilities(t.target);if(!n||!a||_.isEmpty(a.dataRoles))return!1;if(h.equals(n,a)){var o=this.visualPluginService.capabilities(r.visualType);return this.convertRoleWildCardProperties(o,a,r.objects),r.query=i.query,r.visualType=t.target,r.visualType===t.target&&a.supportsSynchronizingFilterState&&(r.syncGroup=i.syncGroup),!0}var s=t.schema,l=this.convertDrillableRoles(i.query,n,a,s),u=l.query,p=c.getDrillableRoles(a),f=i.query.getUniqueQueryRefs();f=_.difference(f,l.drillableRoleProjectionQueryRefs);var d=i.query.defn.select(),v=_.map(f,(function(e){return d.withName(e).expr})),g=e.requireSync("Explore/services/visualCapabilitiesHelper").create(a,this.geoTaggingService),y=e.requireSync("Explore/services/visualCapabilitiesHelper").create(n,this.geoTaggingService);g.orderByRolePreferences(s,v);var C=m.clone(u.projections),x=this.getExpressionRoleMappings(r.query,v),b=this.getConversionExprRoleList(x,y,g,s,C,p);if(_.isEmpty(b)&&_.isEmpty(u.projections))return!1;for(var S=0,E=b;S<E.length;S++){var w=E[S];u.add(w.expr,w.roleName),this.ensureDependentObjectDefn(g.objectDescs,w.roleName,r)}var F,V,P=c.getDrillableRoles(this.visualPluginService.capabilities(r.visualType));_.isEmpty(P)?(F=c.getDrillableRoles(n),V=i.query):(F=P,V=r.query);for(var D=0,R=p;D<R.length;D++){var T=R[D];if(u.projections[T]){u.ensureActiveItems(T);for(var N=0,I=F;N<I.length;N++){var j=I[N];V.projections[j]&&(u.projections[T].activeProjectionRefs=V.projections[j].activeProjectionRefs)}}}return this.updateTargetShowAllInfo(i,u,g),u.removeUnusedOrderBy(),u.resetExpansionStates(),this.convertRoleWildCardProperties(n,a,r.objects),this.upgradePivotTableProperties(r.objects,r.visualType,t.target),r.query=u,r.visualType=t.target,this.visualAuthoringCustomizeOperations.customizeOptions(r,s),!0},i.prototype.convertRoleWildCardProperties=function(t,r,i){if(!_.isEmpty(i)){var n=_.chain(t.dataRoles).filter((function(t){return t.kind!==e.VisualDataRoleKind.Measure})).map((function(e){return e.name})).value(),a=_.chain(r.dataRoles).filter((function(t){return t.kind!==e.VisualDataRoleKind.Measure})).map((function(e){return e.name})).value();if(!_.isEmpty(n)&&!_.isEmpty(a))for(var o in i){var s=i[o];if(!_.isEmpty(s))for(var l=0,c=s;l<c.length;l++){var p=c[l],f=p.selector;if(f&&!_.isEmpty(f.data))for(var d=0,h=f.data.length;d<h;d++){var v=f.data[d];y.isRoleWildcard(v)&&_.isEqual(_.sortBy(v.roles),_.sortBy(n))&&(f.data[d]=u.fromRoles(a))}}}}},i.prototype.upgradePivotTableProperties=function(e,t,r){"matrix"!==t&&"table"!==t||"pivotTable"!==r&&"tableEx"!==r||(s.moveProperty(e,"general",void 0,"textSize","grid"),s.moveProperty(e,"general",void 0,"autoSizeColumnWidth","columnHeaders")),"matrix"===t&&"pivotTable"===r&&(s.moveProperty(e,"general",void 0,"columnSubtotals","subTotals"),s.moveProperty(e,"general",void 0,"rowSubtotals","subTotals")),"table"===t&&"tableEx"===r&&s.moveProperty(e,"general",void 0,"totals","total")},i.prototype.setAggregate=function(e,t){return!!t.singleVisual.query.setAggregate(e.role,e.index,e.newAggregate)&&(i.clearConversionSourceContext(t.singleVisual),!0)},i.prototype.removeAggregate=function(e,t){return!!t.singleVisual.query.removeAggregate(e.role,e.index)&&(i.clearConversionSourceContext(t.singleVisual),!0)},i.prototype.setPercentOfGrandTotal=function(e,t){return!!t.singleVisual.query.setPercentOfGrandTotal(e.role,e.index)&&(i.clearConversionSourceContext(t.singleVisual),!0)},i.prototype.removePercentOfGrandTotal=function(e,t){return!!t.singleVisual.query.removePercentOfGrandTotal(e.role,e.index)&&(i.clearConversionSourceContext(t.singleVisual),!0)},i.prototype.setPercentOfRoleTotal=function(e,t){return!!t.singleVisual.query.setPercentOfRoleTotal(e.roleRefs,e.role,e.index)&&(i.clearConversionSourceContext(t.singleVisual),!0)},i.prototype.removePercentOfRoleTotal=function(e,t){return!!t.singleVisual.query.removePercentOfRoleTotal(e.role,e.index)&&(i.clearConversionSourceContext(t.singleVisual),!0)},i.prototype.toggleShowAll=function(e,t){t.singleVisual.query.toggleShowAll(e),i.clearConversionSourceContext(t.singleVisual)},i.prototype.changeActiveProjection=function(e,t,r){var n=t.query.projections[e];if(n){var a,o=_.uniqBy(n.all(),(function(e){return e.queryRef})),s=_.uniq(n.activeProjectionRefs);_.isEmpty(s)||(a=s.length);var l=a&&_.findIndex(o,(function(e){return e.queryRef===s[a-1]}));if(!(null==l||l<0)){if(1===r){if(!(l>=1))return;s.pop(),1!==a&&s[a-2]===o[l-1].queryRef||s.push(o[l-1].queryRef)}else{if(3===r&&(s.length=0),!(o.length>l+1))return;s.push(o[l+1].queryRef)}return i.clearConversionSourceContext(t),n.activeProjectionRefs=s,s}}},i.prototype.addDrillFilter=function(e,t,r,i,n){this.addFilters(e,t,r,i,n,2,!0)},i.prototype.addDrillToDetailsFilter=function(e,t,r,i,n){this.addFilters(e,t,r,i,n,0,!1)},i.prototype.addFilters=function(r,i,n,a,o,s,l){if(i&&n&&!_.isEmpty(a)&&o)for(var u=function(a){var u=n.defn.select().withName(a).expr,c=o.expr,p=b.isNot(c);p&&(c=c.arg);var f=g.getInExpr(c),d=[],h=void 0,v=u.getKeyColumns(r);if(!_.isEmpty(f.values))for(var m=function(e){var t=f.args[e];if(t&&F.indexOfExpr(v,t)!==-1){d.push(t);var r=_.map(f.values,(function(t){return[t[e]]}));h=_.isEmpty(h)?r:_.chain(h).zip(r).map((function(e){return _.flatten(e)})).value()}},y=0;y<f.args.length;y++)m(y);if(!_.isEmpty(d)&&!_.isEmpty(h)){var C=S.inValues(d,h||[]);p&&(C=S.not(C));var x=e.DataViewScopeIdentity.filterFromIdentity([{kind:1,expr:C,key:o.key}]),E=_.filter(i,(function(e){return b.equals(u,e.expression)})),w=void 0;if(l&&(w=_.find(E,(function(e){return e.howCreated===s}))),w=w||_.find(E,(function(e){return!e.filter&&2!==e.howCreated})))w.filter=x,w.howCreated=s,w.precedence=0;else{var V={name:null,expression:u,filter:x,type:t.contracts.FilterType.Categorical,howCreated:s,precedence:0};i.push(V)}}},c=0,p=a;c<p.length;c++){var f=p[c];u(f)}},i.prototype.removeDrillFilter=function(e,t){if(!e)return!1;for(var r,i=0,n=e.length;i<n;i++){var a=e[i];if(2===a.howCreated&&b.equals(t,a.expression)){r=i;break}}return void 0!==r&&(e.splice(r,1),!0)},i.prototype.replaceProjectionCore=function(t,r,n,a,o,u,c,p,f){var d=t.singleVisual;if(!d||!d.query)return!1;for(var h=x.clone(d),v=h.query.defn.orderBy(),m=c||r,g=e.requireSync("Explore/services/columnPropertiesAuthoring"),y=g.getColumnPropertiesForExprs(m,h),C=r.length,b=0;b<C;b++)if(!this.tryRemove(h.query,h.columnProperties,{role:n,index:o},p))return!1;v.length>0&&h.query.orderBy(v);var S=this.visualPluginService.capabilities(d.visualType),E=e.requireSync("Explore/services/visualCapabilitiesHelper").create(S,this.geoTaggingService);
if(!E)return!1;var w=E.roles.withName(a);if(!w)return!1;for(var b=0;b<m.length;b++){var F=m[b];m[b]=this.aggregateIfNecessary(m[b],w,p);var V={expr:m[b],schema:p,targetRole:a,targetIndex:u+b};if(!this.tryAdd(E,h,V)){if(b>0&&f)break;return!1}if(d.query.projections[n].showAll){var _=m[b].getMetadata(p);this.isShowAllRole(w.kind)&&_&&1!==_.kind&&(h.query.projections[a].showAll=!0)}g.applyColumnPropertiesByExpr(F,m[b],h,y)}if(t.singleVisual=h,this.visualAuthoringCustomizeOperations.customizeOptions(t.singleVisual,p),i.clearConversionSourceContext(t.singleVisual),t.singleVisual.objects){var P=l.findFilterOutput(E.objectDescs);P&&s.deleteProperty(t.singleVisual.objects,P.objectName,null,P.propertyName)}return!0},i.prototype.aggregateIfNecessary=function(t,r,i){return null!=p.getAggregate(t,i)||r.kind!==e.VisualDataRoleKind.Measure||F.discourageAggregation(t,i)?r.kind===e.VisualDataRoleKind.Grouping?S.removeAggregate(t,i):t:this.aggrOps.createExprWithAggregate(t,i,!0,r.requiredTypes)},i.clearConversionSourceContext=function(e){e.conversionSourceContext=null},i.prototype.getConversionExprRoleList=function(e,t,r,i,n,a){var o=this,s=this.getCompatRolesForExprs(e,t,r,i,!1,n,a);if(_.isEmpty(s)){var l=_.map(e,(function(e){var t=e.expr;return{expr:F.isMeasure(t)?t:o.aggrOps.createExprWithAggregate(t,i,!0,null)}}));s=this.getCompatRolesForExprs(l,t,r,i,!0,n,a)}if(_.isEmpty(s)){var u=_.map(e,(function(e){var t=e.expr;return{expr:F.isMeasure(t)?S.removeAggregate(t,i):t}}));s=this.getCompatRolesForExprs(u,t,r,i,!0,n,a)}return s},i.prototype.getCompatRolesForExprs=function(e,t,r,i,n,a,o){for(var s=[],l=a?a:{},u=new w(d.hierarchyLevelComparer),c=0,p=e;c<p.length;c++){var f=p[c],h=this.getTargetRoleForConversion(f,t,r),v=r.findCompatibleRole({queryProjections:l,schema:i,expr:f.expr,targetRole:h,preferDrillableRoles:!1,roleToExprMap:u,useStrict:!0});if(v){this.updateProjections(l,v.name,o);var m=r.getNumberRangesForRoles(l),g=m[v.name];if(this.shouldUseVariation(f.expr,i,v.name,o,g,_.size(e))){var y=V.getSourceVariationExpr(f.expr);return s.push({expr:y,roleName:v.name}),s}if(s.push({expr:f.expr,roleName:v.name}),n)return s}}return s},i.prototype.shouldUseVariation=function(e,t,r,i,n,a){if(!_.includes(i,r)&&n&&n.max<a){var o=E.asFieldPattern(e,t);if(o&&o.columnHierarchyLevelVariation)return!0}return!1},i.prototype.getExpressionRoleMappings=function(e,t){return _.map(t,(function(t){return{expr:t,roleName:e.getRoleNameForExpr(t)}}))},i.prototype.getTargetRoleForConversion=function(e,t,r){var i=t.roles.withName(e.roleName),n=r.roles.withName(e.roleName);if(i&&n){var a=this.getDataViewMappingConditions(t.capabilities),o=this.getDataViewMappingConditions(r.capabilities),s=e.roleName,l=a&&o&&_.isEqual(a[s],o[s])||!a&&!o;return!r.hasPreferredTypes()&&l&&_.isEqual(i.kind,n.kind)?s:void 0}},i.prototype.getDataViewMappingConditions=function(e){var t=e.dataViewMappings&&e.dataViewMappings[0];return t&&t.conditions},i.prototype.updateProjections=function(e,t,r){var i={queryRef:t},n=m.getRole(e,t);n||(e[t]=n=new v([]));var a=n.all();a.push(i),_.includes(r,t)&&n.addActiveQueryReference(a[0].queryRef)},i.prototype.createConversionSourceContext=function(e,t,r){return{query:e,visualType:t,syncGroup:r}},i.prototype.convertDrillableRoles=function(e,t,r,i){var n=new P(e.defn.select([]),{},[]),a=c.getDrillableRoles(t);return _.isEmpty(a)?{query:n,drillableRoleProjectionQueryRefs:[]}:{query:n,drillableRoleProjectionQueryRefs:this.populateQueryForDrillableProjections(r,e,i,a,n)}},i.prototype.populateQueryForDrillableProjections=function(e,t,r,i,n){for(var a=c.getDrillableRoles(e),o=t.projections,s=t.defn.select(),l=[],u=0,p=i;u<p.length;u++){var f=p[u],d=o[f];if(d){var h=_.map(d.all(),(function(e){return e.queryRef})),v=_.map(h,(function(e){return s.withName(e)}));if(this.convertDrillableExprs(v,r,e,n),l=_.union(l,h),_.isEmpty(a))break}}return n.ensureDrillableRoles(a),l},i.prototype.convertDrillableExprs=function(t,r,i,n){for(var a=e.requireSync("Explore/services/visualCapabilitiesHelper").create(i,this.geoTaggingService),o=a.getNumberRangesForRoles(n),s=c.getDrillableRoles(i),l=_.isEmpty(s),u=new w(d.hierarchyLevelComparer),p=0,f=t;p<f.length;p++){var h=f[p],v=h.expr,m=h.name,g=a.findCompatibleRole({queryProjections:n.projections,schema:r,expr:v,preferDrillableRoles:!0,roleToExprMap:u,useStrict:!0});if(g){var y=g.name,C=o[y];if(this.shouldUseVariation(h.expr,r,g.name,s,C,_.size(t))){var x=V.getSourceVariationExpr(h.expr);return void n.add(x,y,{exprName:m})}if(n.add(v,y,{exprName:m}),l){var b=n.projections[y].all().length;if(C&&C.max&&C.max<=b)return}}}},i.prototype.tryRemove=function(e,t,r,i){var n=r;if(n&&n.expr){if(_.isArray(n.expr)){for(var a=!1,o=0,s=n.expr;o<s.length;o++){var l=s[o];a=e.removeExpr(l,!!n.ignoreAggregates,i)||a}return a}return e.removeExpr(n.expr,!!n.ignoreAggregates,i)}var u=r;if(u&&u.role&&$.isNumeric(u.index)){var c=e.getQueryRef(u.role,u.index),p=e.removeProjection(u.role,u.index);return c&&!e.isUsed(c)&&t&&t[c]&&delete t[c],p}return!1},i.prototype.tryAdd=function(e,t,r){var i=r.expr,n=new w(d.hierarchyLevelComparer),a=!1,o=r.targetIndex;if(_.isArray(i))for(var s=0,l=i;s<l.length;s++){var u=l[s];a=null!=this.tryAddQuery(e,t,r,u,o,n)||a,null!=o&&o++}else if(null==this.tryAddQuery(e,t,r,i,o,n))return!1;var p=c.getDrillableRoles(e.capabilities);return t.query.ensureDrillableRoles(p),!_.isArray(i)||a},i.prototype.tryAddQuery=function(e,t,r,i,n,a){var o=e.findCompatibleRole({queryProjections:t.query.projections,schema:r.schema,expr:i,preferDrillableRoles:!1,roleToExprMap:a,targetRole:r.targetRole});if(o){var s=o.name,l=t.query.add(i,s,{index:n});return this.ensureDependentObjectDefn(e.objectDescs,s,t),a.add(i,o),l}},i.prototype.ensureDependentObjectDefn=function(e,t,r){if(e)for(var i in e){var n=e[i];for(var a in n.properties){var o=n.properties[a];if(o.rule&&o.rule.inputRole===t){var l=r.objects;l||(l=r.objects={});var u=s.ensure(l,i,null);u.properties[a]||(u.properties[a]=this.createDefaultDefinition(o.type))}}}},i.prototype.createDefaultDefinition=function(e){if(e.fillRule){return f.getDefaultFillRuleDefinition()}},i.prototype.getSourceShowAllInfo=function(e){for(var t={},r=0,i=_.values(e);r<i.length;r++)for(var n=i[r],a=n.showAll,o=0,s=n.all();o<s.length;o++){var l=s[o];t[l.queryRef]=a}return t},i.prototype.updateTargetShowAllInfo=function(e,t,r){for(var i=this.getSourceShowAllInfo(e.query.projections),n=0,a=_.keys(t.projections);n<a.length;n++){var o=a[n],s=r.roles.withName(o).kind;if(this.isShowAllRole(s))for(var l=0,u=t.projections[o].all();l<u.length;l++){var c=u[l],p=i[c.queryRef];p&&(t.projections[o].showAll=p)}}},i.prototype.isShowAllRole=function(t){return t===e.VisualDataRoleKind.Grouping||t===e.VisualDataRoleKind.GroupingOrMeasure},i})()})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){function r(e,t){return new n(e,t)}var i=e.data.DataViewTransform;t.createVisualAuthoringCustomizeOperations=r;var n=(function(){function r(e,t){this.visualPluginService=e,this.featureSwitchService=t}return r.prototype.customizeOptions=function(r,n){var a=r.visualType,o=this.visualPluginService.getPlugin(a);if(o&&o.customizeVisualAuthoringOperations){var s=this.visualPluginService.capabilities(a),l=e.data.createStaticEvalContext(e.visuals.visualStyles.create()),u=i.evaluateMetadataOnceDataViewObjectDefinitions(r.objects,s.objects,l),c=e.data.compileDataView({mappings:s.dataViewMappings,queryDefn:r.query.defn,queryProjections:r.query.projections,schema:n,objectDescriptors:s.objects,objectDefinitions:r.objects,roles:s.dataRoles}),p=o.customizeVisualAuthoringOperations({objects:u,dataViewMappings:c});r.objects||(r.objects={}),t.applyPropertyChanges(p,s.objects,r.objects)}},r})()})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(r){function i(e,t,r){return new c(e,t,r)}var n=e.DataViewMapping,a=e.data.QueryProjectionsByRole,o=e.data.SQExpr,s=e.data.SQExprUtils,l=e.explore.util.VisualContainerUtils,u=t.contracts.VisualQuery;r.createSortService=i;var c=(function(){function r(e,t,r){this.displayNameService=e,this.featureSwitches=t,this.visualPluginService=r}return r.prototype.getSortableFields=function(e){var t=e.visualType,r=e.query,i=r.projections,n=e.schema,a=this.visualPluginService.capabilities(t);if(a&&this.isVisualSortable(a)){if(a.sorting){var o=this.visualPluginService.getPlugin(t);if(o&&o.getSortableRoles){var s={dataViewMappings:e.compiledMappings};return this.getSortableFieldsFromAllowedRoles(i,r,n,a,o.getSortableRoles(s),e.columnProperties)}return this.getDefaultSortableFields(i,r,n,a,e.columnProperties)}return this.getDefaultSortableFields(i,r,n,a,e.columnProperties)}return[]},r.prototype.addSort=function(e,t){e&&e.defn&&t&&(e.defn=e.defn.orderBy(t))},r.prototype.removeSort=function(e,t){if(e&&e.defn&&t)for(var r=0,i=t;r<i.length;r++){var n=i[r];e.defn=e.defn.removeOrderBy(n.expr)}},r.prototype.resetSort=function(e){if(e&&e.defn){var t=e.defn.orderBy();this.removeSort(e,t)}},r.prototype.applyImplicitSort=function(e,t){if(!t)return e;var r=e.defn;if(!r)return e;for(var i=t.clauses,n=r.select(),o=[],s=0,l=i;s<l.length;s++){var c=l[s],p=a.getRole(e.projections,c.role);if(p){var f=c.direction;o.push.apply(o,_.map(p.all(),(function(e){return{expr:n.withName(e.queryRef).expr,direction:f}})))}}return _.isEmpty(o)?e:new u(r.orderBy(o),e.projections,e.expansionStates)},r.prototype.shouldApplyDefaultSort=function(e,t){return this.featureSwitches.featureSwitches.defaultSortMethodology&&!(t.sorting&&(t.sorting.custom||t.sorting.implicit))&&(e.hasDefaultSort||_.isEmpty(e.query.defn.orderBy()))},r.prototype.ensureValidSorting=function(e){var t=this.getSortableFields(e),r=_.chain(t).map((function(e){return e.exprs})).flatten().map((function(e){return e.name})).value(),i=e.query,n=i.defn;if(!n)return i;for(var a=n.orderBy(),o=!1,s=a.length-1;s>=0;s--){var l=n.selectNameOf(a[s].expr);_.includes(r,l)||(a.splice(s,1),o=!0)}return o?new u(n.orderBy(a),i.projections,i.expansionStates):i},r.prototype.isVisualSortable=function(t){return _.some(t.dataRoles,(function(t){return t.kind!==e.VisualDataRoleKind.Measure}))},r.prototype.getDefaultSortableFields=function(e,t,r,i,n){return this.getSortableFieldsFromProjections(e,t,r,i,n)},r.prototype.getSortableFieldsFromAllowedRoles=function(e,t,r,i,n,a){return n&&0!==n.length?this.getSortableFieldsFromProjections(e,t,r,i,a,n):[]},r.prototype.findSortExpressionIndex=function(e,r){if(e&&r)for(var i=0,n=r.length;i<n;i++)if(o.equals(e,r[i].expr))return i;return t.constants.invalidSortExprIndex},r.prototype.getSortableFieldsFromProjections=function(r,i,o,u,c,p){var f=[],d=i.defn.select(),h=i.defn.orderBy();if(u.dataRoles)for(var v=0,m=u.dataRoles;v<m.length;v++){var g=m[v];if(!(p&&_.indexOf(p,g.name)<0)){var y=a.getRole(r,g.name);if(y){var C=y.activeProjectionRefs;if(_.isEmpty(C))for(var x=0,b=y.all();x<b.length;x++){var S=b[x],E=d.withName(S.queryRef),w=E&&E.expr;if(w&&s.isExprValidForSorting(w)){var F=S.displayName||this.displayNameService.getDisplayName(w,o,u,S.queryRef,c),V=this.findSortExpressionIndex(w,h),P=V!==t.constants.invalidSortExprIndex;f.push({displayName:F,exprs:[{name:S.queryRef,expr:w}],active:P,orderByIndex:P?V:void 0,sortDirection:P?h[V].direction:void 0})}}else{var D=l.createRoleKindByQueryRef(i),R=e.DataViewAnalysis.chooseDataViewMappings(r,u.dataViewMappings,D);if(R.supportedMappings){var T=n.targetDataViewKinds(R.supportedMappings),N=0!==(1&T);f.push.apply(f,this.getSortableFieldsFromActiveProjections(o,d,C,h,u,c,N))}}}}}return f},r.prototype.getSortableFieldsFromActiveProjections=function(e,r,i,n,a,s,l){for(var u,c=!1,p=Number.MAX_VALUE,f=[],d=[],h=0,v=i;h<v.length;h++){var m=v[h],g=r.withName(m),y=g&&g.expr;if(y&&!o.isFilteredEval(y)){var C=this.findSortExpressionIndex(y,n);if(C!==t.constants.invalidSortExprIndex&&(p=Math.min(p,C)),l)c=c||C!==t.constants.invalidSortExprIndex,c&&!u&&(u=n[C].direction),d.push({name:m,expr:y});else{c=C!==t.constants.invalidSortExprIndex,u=c?n[C].direction:void 0;var x=this.getDisplayNameFromQueryRef(e,r,m,a,s);f.push({displayName:x,exprs:[g],active:c,orderByIndex:c?C:void 0,sortDirection:u})}}}if(l){var x=this.concatDisplayNamesForActiveItems(e,r,i,a,s);return[{displayName:x,exprs:d,active:c,orderByIndex:c?p:void 0,sortDirection:c?u:void 0}]}return f},r.prototype.concatDisplayNamesForActiveItems=function(e,t,r,i,n){var a=this;return _.map(r,(function(r){return a.getDisplayNameFromQueryRef(e,t,r,i,n)})).join(" ")},r.prototype.getDisplayNameFromQueryRef=function(e,t,r,i,n){var a=t.withName(r),o=a&&a.expr;return o?this.displayNameService.getDisplayName(o,e,i,r,n):""},r})();r.SortService=c})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={})),powerbi.define("Explore/services/visualCapabilitiesHelper",(function(){function e(e){return e&&e.geography&&(e.geography.latitude||e.geography.longitude)}function t(t){return _.some(t.preferredTypes,(function(t){return e(t)||t.numeric}))}function r(e){return 0===e.cartesianKind||1===e.cartesianKind}var i=powerbi,n=i.data,a=i.explore,o=a.contracts,s=a.util,l=jsCommon.ArrayExtensions,u=i.DataViewMapping,c=i.DataViewAnalysis,p=s.DrillUtils,f=jsCommon.MathExtensions,d=n.SQExpr,h=n.SQExprConverter,v=o.VisualQuery,m=i.ValueType,g=(function(){function e(e,t,r,i){this.capabilities=e,this.roles=t,this.objectDescs=r,this.roleMappings=i}return e.prototype.findCompatibleRole=function(e){var t=e.expr,r=e.roleToExprMap,i=e.targetRole,n=e.preferDrillableRoles;if(d.isHierarchyLevel(t)){n=!0;var a=this.getExistingTargetRoleForHierarchyLevelIfAny(t,r);if(a){if(i&&i!==a.name)return;i=a.name}}var o,s=h.asFieldPattern(t,e.schema);s&&(o=s.column||s.columnAggr||s.groupingColumn||s.groupingColumnAggr||s.measure);var l={projections:e.queryProjections,metadata:t.getMetadata(e.schema),columnName:o?o.name:void 0,preferDrillableRoles:n,targetRole:i,useStrict:e.useStrict},u=this.findRole(l);return u||(l.preferDrillableRoles=!e.preferDrillableRoles,u=this.findRole(l)),u&&r&&r.add(t,u),u},e.prototype.findRole=function(e){var t=this.roleMappings;if(!_.isEmpty(t))for(var r=t[0].getValueType(e.metadata?e.metadata.type:void 0,e.columnName),i=this.roles.allRolesWithPreference(r?r.extendedType:void 0,e.projections,e.preferDrillableRoles,e.useStrict),n=e.targetRole?[e.targetRole]:i,a=0,o=n;a<o.length;a++)for(var s=o[a],l=0,u=t;l<u.length;l++){var c=u[l],p=c.checkRoleCompatibility(e,s,i);if(p)return p}},e.prototype.getExistingTargetRoleForHierarchyLevelIfAny=function(e,t){return t.get(e)},e.prototype.orderByRolePreferences=function(e,t){for(var r=this.roles.defns,i=0,n=t.length,a=0,o=r.length;a<o;a++){var s=r[a].preferredTypes;if(!_.isEmpty(s))for(var l=i;l<n;l++){var u=t[l],c=u.getMetadata(e);if(c){var p=c.type;if(p)for(var f=0,d=s.length;f<d;f++)if(p.extendedType===m.fromDescriptor(s[f]).extendedType){t.splice(l,1),t.splice(i,0,u),i++;break}}}}},e.prototype.getNumberRangesForRoles=function(e){var t,r=_.map(this.roles.defns,(function(e){return e.name}));t=e instanceof v?e.projections:e;for(var i={},n=0,a=r;n<a.length;n++){var o=a[n];i[o]={min:1/0,max:0}}for(var s=_.filter(this.roleMappings,(function(e){return e.projectionsAreCompatible({projections:t,roleNames:r,preferDrillableRoles:!0,ignoreMin:!0})})),l=0,u=s;l<u.length;l++)for(var c=u[l],p=c.getCondition(),d=0,h=r;d<h.length;d++){var o=h[d],m=p&&p[o],g=void 0;g=m?{min:f.max(m.min,0),max:f.min(m.max,1/0)}:{min:0,max:1/0};var y=i[o];y.min=Math.min(g.min,y.min),y.max=Math.max(g.max,y.max)}for(var C=0,x=_.values(i);C<x.length;C++){var y=x[C];y.min=Math.min(y.min,y.max)}return i},e.prototype.getNonLatLongRoles=function(){var e=this.getLatLongRoleNames();return this.getFilteredRoleNames(e)},e.prototype.getNonCartesianGroupingOrMeasureRoleNames=function(){var e=this.getCartesianGroupingOrMeasureRoleNames();return this.getFilteredRoleNames(e)},e.prototype.getFilteredRoleNames=function(e){for(var t=this.capabilities,r=t.dataViewMappings,i=[],n=0,a=r;n<a.length;n++){var o=a[n];o.categorical&&u.visitCategoricalCategories(o.categorical.categories,{visitRole:function(e){i.push(e)}}),o.matrix&&u.visitMatrixRows(o.matrix.rows,{visitRole:function(e){i.push(e)}})}return _.without.apply(_,[_.uniq(i)].concat(e))},e.prototype.getLatLongRoleNames=function(){return this.getRoleNames((function(e){return t(e)}))},e.prototype.getCartesianGroupingOrMeasureRoleNames=function(){return this.getRoleNames((function(e){return r(e)}))},e.prototype.getRoleNames=function(e){return _.chain(this.capabilities.dataRoles).filter(e).map((function(e){return e.name})).value()},e.prototype.hasPreferredTypes=function(){return _.some(this.capabilities.dataRoles,(function(e){return!_.isEmpty(e.preferredTypes)}))},e})(),y=(function(){function e(e,t,r,i){this.roles=e,this.geoTaggingService=t,this.condition=i,this.drillableRoles=r}return e.prototype.getCondition=function(){return this.condition},e.prototype.checkRoleCompatibility=function(e,t,r){if(e.metadata){var i=this.roles.withName(t);if(i&&this.exprIsCompatible(i,e.metadata,c.getPropertyCount(t,e.projections)+1,e.preferDrillableRoles)){if(!this.projectionsAreCompatible({projections:e.projections,roleNames:_.without(r,t),preferDrillableRoles:e.preferDrillableRoles,ignoreMin:!1}))return;return i}}},e.prototype.getValueType=function(e,t){if(e&&null==e.categoryString){var r=t&&this.geoTaggingService.getFieldType(t);null!=r&&(e=m.fromPrimitiveTypeAndCategory(e.primitiveType,r))}return e},e.prototype.projectionsAreCompatible=function(e){for(var t=0,r=e.roleNames;t<r.length;t++){var i=r[t],n=this.roles.withName(i);if(!n)return!1;var a=c.getPropertyCount(i,e.projections);if(!this.isCardinalityValid({count:a,roleName:n.name,preferDrillableRoles:e.preferDrillableRoles,ignoreMin:e.ignoreMin}))return!1}return!0},e.prototype.exprIsCompatible=function(e,t,r,n){if(!this.isCardinalityValid({count:r,roleName:e.name,preferDrillableRoles:n,ignoreMin:!1}))return!1;var a=e.kind;if(1===t.kind){if(a===i.VisualDataRoleKind.Grouping)return!1}else if(a===i.VisualDataRoleKind.Measure)return!1;var o=e.requiredTypes;return!(o&&!m.isCompatibleTo(t.type,o))},e.prototype.isRoleDrillable=function(e){return _.includes(this.drillableRoles,e)&&(!this.condition[e]||void 0===this.condition[e].max||1===this.condition[e].max)},e.prototype.isCardinalityValid=function(e){if(this.condition&&(!e.preferDrillableRoles||!this.isRoleDrillable(e.roleName))){var t=this.condition[e.roleName];return!t||null==c.validateRange(e.count,t,e.ignoreMin)}return!0},e})(),C=(function(){function e(e){this.defns=e}return e.prototype.withName=function(e){return l.findItemWithName(this.defns,e)},e.prototype.allRolesWithPreference=function(e,t,r,i){var n=this,a=_.map(this.defns,(function(e){return e.name}));return this.promoteAndPenalize(a,(function(t){return n.getTypeWeightForRole(e,t.preferredTypes)}),i),this.promoteAndPenalize(a,(function(e){return n.getProjectionWeightForRole(e,t,r)})),a},e.prototype.promoteAndPenalize=function(t,r,i){for(var n=0,a=0,o=this.defns;a<o.length;a++){var s=o[a],l=r(s);if(null!=l){var u=t.splice(t.indexOf(s.name),1)[0];l!==e.penalize||i?l===e.promote&&t.splice(n++,0,u):t.push(u)}}},e.prototype.getTypeWeightForRole=function(t,r){if(r){for(var i=e.penalize,n=0,a=r;n<a.length;n++){var o=a[n];if(t===m.fromDescriptor(o).extendedType){i=e.promote;break}}return i}},e.prototype.getProjectionWeightForRole=function(t,r,i){var n=r[t.name];if(!i&&n&&t.kind!==powerbi.VisualDataRoleKind.Measure)return e.penalize},e.penalize=-1,e.promote=1,e})();return{create:function(e,t){if(e&&!_.isEmpty(e.dataRoles)){for(var r=e.dataViewMappings,i=new C(e.dataRoles),n=[],a=0,o=r;a<o.length;a++){var s=o[a],l=s.conditions;if(_.isEmpty(l))n.push(new y(i,t,p.getDrillableRoles(e)));else for(var u=0,c=l;u<c.length;u++){var f=c[u];n.push(new y(i,t,p.getDrillableRoles(e),f))}}return new g(e,i,e.objects,n)}},dataRoleWrapper:function(e){return new C(e)},isValueTypeDescriptorLatLong:e,isRoleCompatibleWithLatLong:t,isRoleCompatibleWithScatterXY:r}}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(r){function i(e){return new H(e.dataReaders,e.displayNameService,e.plugin,e.pluginOps,e.sortService,e.filterGenerator,e.aggrOps,e.featureSwitchService,e.transformPluginService,e.telemetryService)}function n(e,t){if(_.isEmpty(t))return{queryForTransformActions:e,internalToPublicSelectNameMappingsByRole:{}};for(var r=e.clone(),i=0,n=t;i<n.length;i++){var a=n[i];if(a.selectExprAdded){var o=r.defn.select(),s=a.selectExprAdded;o[s.selectIndex]=s.namedSQExpr,r.defn=r.defn.select(o)}else if(a.projectionQueryRefChanged){var s=a.projectionQueryRefChanged,l=r.projections[s.role];l.replaceQueryRef(s.oldQueryRef,s.newInternalQueryRef)}else a.aggregatesAdded}return{queryForTransformActions:r,internalToPublicSelectNameMappingsByRole:_.reduce(t,(function(e,t){var r=t.projectionQueryRefChanged;if(r){var i=e[r.role];i||(i={},e[r.role]=i),i[r.newInternalQueryRef]=r.oldQueryRef}return e}),{})}}function a(e,t){if(t)for(var r=0,i=t;r<i.length;r++){var n=i[r],a=n.projectionQueryRefChanged;if(a){var o=a.newInternalQueryRef;if(o===e)return a.oldQueryRef}}return e}function o(e,t,r,i,o,p,f,d,h,v,m,g,y,C,b,S){var E=S?S.dataFilter:null,w={};h&&(w.objects=h),v&&(w.splits=v),_.isEmpty(i.expansionStates)||(w.expansionStates=i.expansionStates);var F={options:e,transforms:w,warnings:g,compiledMappings:y},V=n(i,m),P=V.queryForTransformActions,D=V.internalToPublicSelectNameMappingsByRole,R=P.defn.select(),T=P.defn.orderBy(),N=P.projections;if(E){var I=E.where();if(_.some(I,(function(e){return e.condition&&!_.isEmpty(e.condition.validate(t,f))})))return F.error=new G("Broken_Filters"),F}if(F.filterContext={dataFilters:S.dataFiltersUnmerged,highlightFilters:S.highlightFilter,highlightFiltersUnmerged:S.highlightFiltersUnmerged,query:o},N){var j=[],O={},M=void 0;for(var k in N){var A=O[k]=[],B=N[k];_.isEmpty(B.activeProjectionRefs)||(M||(M={}),M[k]=_.map(B.activeProjectionRefs,(function(e){return{queryRef:e}})));for(var q=0,L=B.all();q<L.length;q++){var U=L[q],H=x.indexWithName(R,U.queryRef);j.push({queryRef:U.queryRef,format:U.format,queryIndex:H,roleName:k,displayName:U.displayName}),A.push(H)}}w.selects=[];for(var Q,W=[],K=P.defn.transforms(),X=!_.isEmpty(K),J=function(e,i){var n=l(j,e),o=R[e],s=void 0,c=b&&b[o.name];if(!X||c){if(c&&(o=c),!_.isEmpty(o.expr.validate(t,f)))return W.push(o.expr),"continue";var h=o.expr.getMetadata(t);s={type:h.type,expr:o.expr};var v=z.getKpiMetadata(o.expr,t);v&&(s.kpi=v);var g=a(o.name,m),y=_.find(n,(function(e){return e.queryRef===o.name&&e.displayName}));s.displayName=y?y.displayName:p.getDisplayName(o.expr,t,d,g,r);var C=n[0];if(C){var x=C.format||h.format;x&&(s.format=x)}}else s={expr:o.expr,displayName:o.name};s.roles||(s.roles={});for(var S=0,E=n;S<E.length;S++){var F=E[S];F&&F.roleName&&(s.roles[F.roleName]=!0)}Q=o.name,s.queryName=_.chain(Object.keys(s.roles)).map((function(e){return D[e]&&D[e][Q]})).filter(_.isString).value()[0]||Q;var V=u(T,o.expr);if(V!==-1){var P=T[V];s.sort=P.direction,s.sortOrder=V}var N=z.getDefaultValue(o.expr,t);if(N){s.defaultValue={value:N};var I=o.expr.getKeyColumns(t);s.defaultValue.identityFieldsValues=z.getDefaultValues(I,t)}1===z.getAggregateBehavior(o.expr,t)&&(s.discourageAggregationAcrossGroups=!0);var O=z.getParameterMetadata(o.expr,t);O&&(s.parameter=O),w.selects.push(s)},$=0,Y=R.length;$<Y;$++)J($,Y);if(m)for(var Z=0,ee=m;Z<ee.length;Z++){var te=ee[Z];te.aggregatesAdded&&c(w.selects,te.aggregatesAdded)}w.roles={ordering:O},M&&(w.roles.activeItems=M,s(w,C)),F.error=G.create(W,t)}return F}function s(e,t){var r=e&&e.roles,i=r&&r.activeItems;if(i)for(var n in i)for(var a=i[n],o=0,s=a;o<s.length;o++){var l=s[o];l.suppressConcat=_.includes(t,l.queryRef)}}function l(e,t){return _.chain(e).compact().filter((function(e){return e.queryIndex===t})).value()}function u(e,t){return _.findIndex(e,(function(e){return k.equals(e.expr,t)}))}function c(e,t){for(var r=0,i=e;r<i.length;r++){var n=i[r];if(n.queryName===t.originalQueryRef){var a={},o=t.aggregates;o.min&&(a.min=p(o.min)),o.max&&(a.max=p(o.max)),n.aggregateSources=a;break}}var s=t.aggregates;f(e,s.min),f(e,s.max)}function p(e){return{index:e.index}}function f(e,t){if(t){var r=t.index;e[r]||(e[r]={displayName:"",queryName:t.queryName,expr:t.expr})}}function d(e,t){return{code:t,getDetails:function(){return{displayableErrorInfo:[],message:e}}}}function h(t,r){var i,n=[];switch(t.name){case e.visuals.plugins.map.name:i=v(r);break;case e.visuals.plugins.scatterChart.name:i=m(r)}if(!i&&1===_.size(r)){var a=r[0];switch(a.code){case V.conditionRangeTooLarge:i="DataViewMappingError_ConditionRangeTooLarge";break;case V.conditionRangeTooSmall:i="DataViewMappingError_ConditionRangeTooSmall";break;case V.conditionKindExpectedMeasure:i="DataViewMappingError_ConditionKindExpectedMeasure";break;case V.conditionKindExpectedGrouping:i="DataViewMappingError_ConditionKindExpectedGrouping"}n=[a.roleName]}if(i){return d(e.common.localize.format(i,n),i)}}function v(e){var t=_.some(e,(function(e){return"Category"===e.roleName&&e.code===V.conditionRangeTooLarge})),r=_.some(e,(function(e){return"X"===e.roleName&&e.code===V.conditionKindExpectedGrouping})),i=_.some(e,(function(e){return"Y"===e.roleName&&e.code===V.conditionKindExpectedGrouping}));return t?"DataViewMappingError_LocationAndLatLongGroup":r||i?"DataViewMappingError_LatLongAggregateWithNoLocation":void 0}function m(t){var r=_.some(t,(function(t){return t.roleName===e.visuals.scatterRoleNames.category&&t.code===V.conditionRangeTooLarge})),i=_.some(t,(function(t){return t.roleName===e.visuals.scatterRoleNames.play&&t.code===V.conditionRangeTooLarge})),n=_.some(t,(function(t){return t.roleName===e.visuals.scatterRoleNames.x&&(t.code===V.conditionKindExpectedGrouping||t.code===V.conditionKindExpectedMeasure)}));return r?"DataViewMappingError_ScatterGroupingDetails":i?"DataViewMappingError_ScatterGroupingPlayAxis":n?"DataViewMappingError_ScatterXMismatchType":void 0}function g(e,t){for(var r=0,i=e;r<i.length;r++){var n=i[r];t&&t.allowBinnedLineSample===!1&&y(n),t&&t.allowOverlappingPointsSample===!1&&C(n)}}function y(e){var t=e.categorical;if(t&&t.dataReductionAlgorithm&&t.dataReductionAlgorithm.binnedLineSample&&(t.dataReductionAlgorithm=void 0,t.categories&&(t.categories.dataReductionAlgorithm={sample:{}}),t.values)){var r=t.values;r.group&&(r.group.dataReductionAlgorithm={top:{}})}}function C(e){var t=e.categorical,r=e.matrix;if(t&&t.dataReductionAlgorithm&&t.dataReductionAlgorithm.overlappingPointsSample){var i=t.dataReductionAlgorithm.overlappingPointsSample.count;t.dataReductionAlgorithm={sample:{}},i&&(t.dataReductionAlgorithm.sample.count=i)}else if(r&&r.rows&&r.rows.dataReductionAlgorithm&&r.rows.dataReductionAlgorithm.overlappingPointsSample){var i=r.rows.dataReductionAlgorithm.overlappingPointsSample.count;r.rows.dataReductionAlgorithm={sample:{}},i&&(r.rows.dataReductionAlgorithm.sample.count=i)}}var x=jsCommon.ArrayExtensions,b=e.ClientErrorStrings,S=e.data.CompiledDataViewMapping,E=e.data.DataBoundObjectQueryExtender,w=e.data.DataReaderUtils,F=e.explore.contracts.DataSource,V=e.DataViewAnalysis.DataViewMappingMatchErrorCode,P=e.data.DataViewObjectDefinitions,D=e.data.DataViewObjectDescriptors,R=e.data.services.DataViewObjectSerializer,T=e.data.DataViewRoleWildcard,N=e.data.FieldExprPattern,I=e.data.FilterKindDetector,j=e.data.ScalarKeyUtils,O=e.data.SemanticFilter,M=e.data.SemanticQuery,k=e.data.SQExpr,A=e.data.SQExprBuilder,B=e.data.SQExprConverter,z=e.data.SQExprUtils,q=jsCommon.StringExtensions,L=t.util.VisualContainerUtils;r.createVisualQueryGenerator=i;var U,H=(function(){function r(e,t,r,i,n,a,o,s,l,u){this.dataReaders=e,this.displayNames=t,this.visualPluginService=r,this.pluginOps=i,this.sortService=n,this.filterGenerator=a,this.aggrOps=o,this.featureSwitchService=s,this.transformPluginService=l,this.telemetryService=u}return r.prototype.shouldExecute=function(e,t){if(!e||_.isEmpty(t))return!1;var r=e.visualType,i=this.visualPluginService.capabilities(r);return!(!i||this.pluginOps.isQueryDisabled(r,i))&&(!!this.getQueryGenerator(t,e)&&(null==e.query?E.needsToExtend(M.create(),i.objects,e.objects):this.pluginOps.isQueryVisual(r)&&!this.pluginOps.isAnalysisVisual(r)))},r.prototype.execute=function(e){var t=e.config,i=e.dataSources;if(!_.isEmpty(i)){var n=w.findTypes(i,t.query&&t.query.defn);if(!_.isEmpty(n)){var a=this.dataReaders.queryGenerator(n),s=this.getCompileMappingsResult(t,t&&t.visualType,e.schema,a,e.additionalFilters,e.dataViewMappingsOverride),l=this.dataReaders.queryExtensionLookup(i);if(s){if(s.error)return{options:null,error:s.error};var u=s.compiled;if(u){var c;if(u.query&&u.query.defn&&!_.isEmpty(u.query.defn.select())&&!_.isEmpty(u.query.defn.transforms())){c={};for(var p=0,f=u.query.defn.select();p<f.length;p++){var d=f[p];k.isTransformOutputRoleRef(d.expr)||(c[d.name]=d)}}var h=this.getVisualCapabilities(e.config.visualType),v=r.compileFilters(e.additionalFilters,h),m=this.generateQuery(a,e.schema,u,h.dataRoles,h.filterMappings,v.dataFilter,v.highlightFilter,e.restartToken,e.dataWindow,null,l),g=m.result,y=m.query,C=m.resolvedQuery,x=e.additionalFilters?e.additionalFilters.queryRefsForSingleItemDrillFilters:void 0,b=this.dataReaders.readerType(n);if(b){var S=F.queried(e.dataSources,C),E={type:b,query:{dataSources:F.dataReaderDataSources(S),command:g.command,cacheOptions:e.cacheOptions,cacheResponseOnServer:e.cacheResponseOnServer,allowCache:e.allowCache,allowClientSideFilters:this.getAllowClientSideFiltersOrDefault(e,h),ignoreViewportForCache:e.ignoreViewportForCache},perfId:e.config.visualType};return E.kinds=this.pluginOps.targetedDataViewKinds(e.config.visualType,this.featureSwitchService,y),o(E,e.schema,t.columnProperties,y,C,this.displayNames,this.aggrOps,h,u.objectDefinitions,g.splits,g.queryRewrites,s.warnings,u.mappings,x,c,v)}}}}}},r.prototype.executeForFlattenedQuery=function(e,t){var i=e.config,n=this.getQueryGenerator(e.dataSources,i);if(n){var a=this.getCompileMappingsResult(i,i&&i.visualType,e.schema,n,e.additionalFilters,e.dataViewMappingsOverride);if(a&&!a.error){var o=a.compiled;if(o){var s=this.getVisualCapabilities(e.config.visualType),l=r.compileFilters(e.additionalFilters,s);return this.generateFlattenedQuery(n,e.schema,o,s.dataRoles,s.filterMappings,l.dataFilter,l.highlightFilter,e.restartToken,e.dataWindow,t)}}}},r.prototype.getQueryGenerator=function(e,t){if(!_.isEmpty(e)){var r=t.query,i=w.findTypes(e,r&&r.defn);if(i)return this.dataReaders.queryGenerator(i)}},r.prototype.getVisualCapabilities=function(e){if(e){var t=this.visualPluginService.getPlugin(e);return t&&t.capabilities}},r.prototype.getCompileMappingsResult=function(t,r,i,n,a,o){if(t&&r&&i){var s=this.visualPluginService.getPlugin(r);if(s){var l,u=this.getVisualCapabilities(r),c=o||u.dataViewMappings,p=t.query,f=u.sorting?u.sorting.implicit:null,d=p?L.createRoleKindByQueryRef(p):{};if(c&&p){var v=e.DataViewAnalysis.chooseDataViewMappings(p.projections,c,d,u.objects,t.objects);if(!v.supportedMappings){var m=h(s,v.mappingErrors);if(m)return{error:m,compiled:null};var g=e.data.QueryProjectionsByRole.clone(p.projections);for(var y in g){var C=g[y];C.activeProjectionRefs=_.map(C.activeProjectionRefs,(function(t){return"select"+e.obfuscate(t)}));for(var x=0,b=C.all();x<b.length;x++)b[x]?b[x]={queryRef:"select"+e.obfuscate(b[x].queryRef)}:b[x]=null}var S=new G("ClientError_NoSupportedDataViewMappingFound");return S.addDebugInfo("VisualType",r),S.addDebugInfo("QueryProjectionsByRole",JSON.stringify(g)),this.telemetryService.logEvent(e.telemetry.EXVisualQueryGeneratorError,r,JSON.stringify(S.getDetails(e.common.localize).debugErrorInfo)),{error:S,compiled:null}}l=this.compileMappingsWithProperties(r,i,p,v.supportedMappings,d,u.dataRoles,u,t.queryOptions,t.columnProperties,t.objects,s.customizeQuery,f,n,a)}else l=this.compileNoMappingsWithProperties(i,p,d,c,u.dataRoles,u.objects,t.objects);var E=[];if(l){if(l.error)return{error:l.error,compiled:null};E.push.apply(E,Q.validateAndAdjustRolesIfNecessary(l.mappings,l.query,i,this.displayNames,u)||[]),
E.push.apply(E,W.validateAndAdjustHighlightIfNecessary(a)||[]);for(var w=0,F=E;w<F.length;w++){var V=F[w];this.telemetryService.logEvent(e.telemetry.EXVisualQueryGeneratorWarning,V.code)}}return{compiled:l,warnings:E}}}},r.compileFilters=function(e,t){var r,i,n,a;return e&&(i=e.dataFilter,n=e.dataFiltersUnmerged,r=e.highlightFilter,a=e.highlightFiltersUnmerged),{dataFilter:i,dataFiltersUnmerged:n,highlightFilter:r,highlightFiltersUnmerged:a}},r.prototype.getAllowClientSideFiltersOrDefault=function(e,t){return _.isBoolean(e.allowClientSideFilters)?e.allowClientSideFilters:!!D.findSelfFilter(t.objects)},r.prototype.compileMappingsWithProperties=function(r,i,n,a,o,s,l,u,c,p,f,h,v,m){_.isEmpty(n.defn.transforms())&&(n=t.TransformGeneratorUtils.addTransforms(p,a,n,this.transformPluginService,l));var y=e.data.compileDataView({mappings:a,queryDefn:n.defn,queryProjections:n.projections,schema:i,objectDescriptors:l.objects,objectDefinitions:p,roles:s});if(f){var C=this.getSorts(y),x=f({dataViewMappings:y,preferHigherDataVolume:this.featureSwitchService.featureSwitches.preferHigherDataVolume});if(x&&x.error){var b=x.error.code;return{error:d(e.common.localize.get(b),b),query:void 0,mappings:void 0,additionalProjections:void 0,objectDefinitions:void 0}}if(!_.isEmpty(n.expansionStates)){var S=void 0,w=y[0].matrix;if(w){var F=w.rows;F.for&&(S=_.map(F.for.in.items,(function(e){return e})))}for(var V=0,P=n.expansionStates;V<P.length;V++){var D=P[V];if(!_.isEmpty(D.root.children))for(var R=0,T=D.levels.length;R<T;R++)for(var N=D.levels[R],I=0,j=S;I<j.length;I++){var O=j[I];O.queryName===N.queryRefs[0]&&2!==O.subtotalType&&(O.subtotalType=1)}}}var M=this.getSorts(y);n=this.updateSorts(n,C,M)}g(y,u),n=t.TransformGeneratorUtils.removeUnsupportedTransforms(this.transformPluginService,n,y),n=this.sortService.applyImplicitSort(n,h),n=this.sortService.ensureValidSorting({query:n,schema:i,visualType:r,columnProperties:c,compiledMappings:y});var k=U.setProperties(i,y,n,p,l.objects),A=k.modifiedObjectDefinitions,B=k.addedScalarKeys;A=this.setFilteredToUniqueValueProperties(m,v,i,y,n,A);var z,q,L=this.getQueryRefsByRole(n,s),H=E.extend(n.defn,i,l.objects,A,L,n.projections,o);if(H){z=new t.contracts.VisualQuery(H.queryDefn,n.projections,n.expansionStates),q=H.additionalProjections;for(var Q=0,G=B;Q<G.length;Q++){var W=G[Q],K=z.defn.selectNameOf(W.expr);W.roleItem.scalarKeyInfo||(W.roleItem.scalarKeyInfo={}),W.roleItem.scalarKeyInfo.scalarKeyQueryName=K}}return{query:z||n,mappings:y,additionalProjections:q,objectDefinitions:A}},r.prototype.getSorts=function(e){for(var t=[],r=0,i=e;r<i.length;r++){for(var n=i[r],a=[],o=0,s=n.metadata.columns;o<s.length;o++){var l=s[o];l.sort&&a.push({queryName:l.queryName,sort:l.sort,sortOrder:l.sortOrder})}t.push(a)}return t},r.prototype.updateSorts=function(e,r,i){if(_.isEqual(r,i))return e;for(var n=[],a=e.defn.select(),o=0,s=i;o<s.length;o++)for(var l=s[o],u=_.sortBy(l,(function(e){return e.sortOrder})),c=0,p=u;c<p.length;c++){var f=p[c],d=a.withName(f.queryName);n.push({direction:f.sort,expr:d.expr})}return new t.contracts.VisualQuery(e.defn.orderBy(n),e.projections,e.expansionStates)},r.prototype.getQueryRefsByRole=function(e,t){var r={};if(_.isEmpty(t))return r;for(var i=0,n=t;i<n.length;i++){var a=n[i],o=e.tryGetExprs(a.name);r[a.name]=_.map(o,(function(t){return e.defn.selectNameOf(t)}))}return r},r.prototype.setFilteredToUniqueValueProperties=function(e,t,r,i,n,a){var o=this;if(!e||!e.dataFilter)return a;for(var s,l=n.defn.select(),u=e.dataFilter.where(),c=e.queryRefsForSingleItemDrillFilters,p=0,f=i;p<f.length;p++){var d=f[p];d&&d.categorical&&d.categorical.categories&&S.visitCategoricalCategories(d.categorical.categories,{visitRole:function(e){if(!_.isEmpty(e.items))for(var i=0,n=e.items;i<n.length;i++){var p=n[i],f=p.queryName;if(p.filteredToUniqueValueProperty&&_.includes(c,f)){var d=l.withName(f),h=o.isColumnFilteredToUniqueValue(d.expr,u,r,t);h&&(s||(s=a?P.clone(a):{}),o.setFilteredToUniqueValueProperty(h,p,s))}}}})}return s||a},r.prototype.isColumnFilteredToUniqueValue=function(e,r,i,n){if(!n||!n.hasAmbiguousEqualitySemantics)return!0;var a=e.getKeyColumns(i);return _.every(a,(function(e){return _.some(r,(function(r){var i=t.FilterUtils.getFilterValuesForColumn(e,r);if(1===_.size(i)){var a=i[0];if(k.isConstant(a)&&!n.hasAmbiguousEqualitySemantics(a))return!0}return!1}))}))},r.prototype.setFilteredToUniqueValueProperty=function(e,t,r){var i=t.filteredToUniqueValueProperty,n=A.boolean(e),a={metadata:t.queryName};P.setValue(r,i,a,n)},r.prototype.compileNoMappingsWithProperties=function(r,i,n,a,o,s,l){if(!i&&_.isEmpty(a)){i=new t.contracts.VisualQuery(M.create(),{},[]);var u=this.getQueryRefsByRole(i,o),c=E.extend(i.defn,r,s,l,u,i.projections,n);if(c){var p=new t.contracts.VisualQuery(c.queryDefn,i.projections,i.expansionStates),f=c.additionalProjections,d=e.data.compileDataView({mappings:[{table:{rows:{for:{in:"*"}}}}],queryDefn:i.defn,queryProjections:i.projections,schema:r,objectDescriptors:s,objectDefinitions:l,roles:o});return{query:p||i,mappings:d,additionalProjections:f,objectDefinitions:l}}}},r.prototype.generateQuery=function(e,t,r,i,n,a,o,s,l,u,c){var p=this.getQueryGeneratorOptions(t,r,i,n,a,o,s,l,u,c);return{result:e.execute(p),query:r.query,resolvedQuery:p.query}},r.prototype.generateFlattenedQuery=function(e,t,r,i,n,a,o,s,l,u){var c=this.getQueryGeneratorOptions(t,r,i,n,a,o,s,l,u);return e.executeForQueryOnly?e.executeForQueryOnly(c):c.query},r.prototype.getQueryGeneratorOptions=function(e,r,i,n,a,o,s,l,u,c){var p=r.query,f=t.TransformGeneratorUtils.rewriteTransform(this.transformPluginService,p,i,this.getQueryRefsByRole(r.query,i),r.additionalProjections,r.mappings),d=this.filterGenerator.resolveFilterTargets(e,f,i,n,a);return{query:u?u(d):d,queryExtensionLookup:c,mappings:r.mappings,additionalProjections:r.additionalProjections,highlightFilter:o,restartToken:s,dataWindow:l,highVolumeOverride:this.featureSwitchService&&this.featureSwitchService.featureSwitches.highVolume,expansionStates:r.query.expansionStates}},r})();!(function(t){function r(e,t,r,n,a){for(var o,s=[],l=0,u=t;l<u.length;l++){var c=u[l];S.visitMapping(c,{visitRole:function(t){if(t.items)for(var l=0,u=t.items;l<u.length;l++){var c=u[l];if(c.scalarKeyInfo&&c.scalarKeyInfo.scalarKeyMinProperty){if(!o)if(n){var p=R.serializeObjects(n,a);o=R.deserializeObjects(p,a)}else o={};s.push(i(e,r,t,c,o))}}}})}return{modifiedObjectDefinitions:o||n,addedScalarKeys:s}}function i(t,r,i,n,a){var o=n.scalarKeyInfo.scalarKeyMinProperty;e.contract.check(n.scalarKeyInfo.hasScalarKey,"Scalar key requested when not available");var s=r.defn.select().withName(n.queryName).expr,l=A.aggregate(j.getScalarKeyExpr(s,t),3),u={data:[T.fromRoles([i.role])]};return P.setValue(a,o,u,l),{roleItem:n,expr:l}}t.setProperties=r})(U||(U={})),r.getDataViewMappingErrorFromFailures=h;var Q,G=(function(){function t(t,r){this.messageId="VisualContainer_FailedToLoadVisual",this.displayableErrorInfo=[{errorInfoKey:"",errorInfoValue:""}],this.errorCode=t,"Missing_References"===t?(this.displayableErrorInfo[0].errorInfoKey="Missing_References_Details_Title",this.displayableErrorInfo[0].errorInfoValue=r,this.detailsMessageFormat="Missing_References_Details_Message",this.messageId="Missing_References_Message",this.errorSource="User"):"Broken_Filters"===t?(this.displayableErrorInfo[0].errorInfoKey="ServiceError_CannotLoadVisual",this.displayableErrorInfo[0].errorInfoValue=e.common.localize.get("Broken_Filters_Details_Message"),this.messageId="Broken_Filters_Message"):"ClientError_NoSupportedDataViewMappingFound"===t&&(this.displayableErrorInfo[0].errorInfoKey="VisualDisplayError_Title",this.displayableErrorInfo[0].errorInfoValue=e.common.localize.get("ClientError_NoSupportedDataViewMappingFound_Message"),this.messageId="ClientError_NoSupportedDataViewMappingFound_Message")}return t.create=function(e,r){if(!_.isEmpty(e)){for(var i=[],n=0,a=e;n<a.length;n++){var o=a[n],s=B.asFieldPattern(o),l=N.toFieldExprEntityItemPattern(s),u=N.getPropertyName(s);s.hierarchy&&(u=s.hierarchy.name),s.hierarchyLevel&&(u=s.hierarchyLevel.name+"."+s.hierarchyLevel.level);var c="("+l.entity+") "+u,p=r.schema(l.schema),f=p&&p.findProperty(l.entity,u);f&&f.errorMessage&&(c+=": "+f.errorMessage),i.push(c)}return new t("Missing_References",i.join(", "))}},Object.defineProperty(t.prototype,"code",{get:function(){return this.errorCode},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"source",{get:function(){return this.errorSource},enumerable:!0,configurable:!0}),t.prototype.addDebugInfo=function(e,t){this.debugErrorInfo||(this.debugErrorInfo=[]),this.debugErrorInfo.push({errorInfoKey:e,errorInfoValue:t})},t.prototype.getDetails=function(e){var t,r=e.get(this.displayableErrorInfo[0].errorInfoKey),i=this.displayableErrorInfo[0].errorInfoValue;return this.detailsMessageFormat&&(i=q.format(e.get(this.detailsMessageFormat),i)),{message:e.get(this.messageId),displayableErrorInfo:[{errorInfoKey:r,errorInfoValue:i}],debugErrorInfo:(t=[{errorInfoKey:b.ClientErrorCode,errorInfoValue:this.code}]).concat.apply(t,this.debugErrorInfo)}},t})();!(function(e){function t(e,t,i,n,a){for(var o=new r(t.defn,i,n,a),s=0,l=e;s<l.length;s++){var u=l[s];S.visitMapping(u,o)}return o.warnings}e.validateAndAdjustRolesIfNecessary=t;var r=(function(){function e(e,t,r,i){this.displayNameService=r,this.incompatibleExprInfo=[];for(var n=0,a=e.select();n<a.length;n++){var o=a[n],s=B.asFieldPattern(o.expr);s&&s.percentOfGrandTotal&&this.incompatibleExprInfo.push({basePropertyName:N.getPropertyName(s),fieldDisplayName:this.displayNameService.getQualifiedDisplayName(o.expr,t,i)})}this.warnings=[]}return e.prototype.visitRole=function(e){e.showAll&&this.incompatibleExprInfo.length>0&&(e.showAll=!1,this.warnings.push(new i(this.incompatibleExprInfo)))},e})(),i=(function(){function e(e){this.errorInfos=e}return Object.defineProperty(e.prototype,"code",{get:function(){return"ShowAllDiabledWarning"},enumerable:!0,configurable:!0}),e.prototype.getDetails=function(e){var t=e.get("ShowAllDisabledWarning_Value"),r=_.map(this.errorInfos,(function(e){return e.fieldDisplayName})).join(", ");return{message:e.get("ShowAllDisabledWarning_Message"),displayableErrorInfo:[{errorInfoKey:e.get("ShowAllDiabledWarning_ErrorInfoKey"),errorInfoValue:q.format(t,r)}]}},e})()})(Q||(Q={}));var W;!(function(e){function t(e){if(e&&e.highlightFilter){var t=e.highlightFilter.where(),i=_.find(t,(function(e){return 3===I.run(e.condition)})),n=_.find(t,(function(e){return k.isExists(e.condition)}));if(i||n)return e.dataFilter=e.dataFilter?O.merge([e.dataFilter,e.highlightFilter]):e.highlightFilter,e.highlightFilter=void 0,[new r(i?0:1)]}}e.validateAndAdjustHighlightIfNecessary=t;var r=(function(){function e(e){this.highlightDisableType=e}return Object.defineProperty(e.prototype,"code",{get:function(){switch(this.highlightDisableType){case 0:return"HighlightWithTOPNDisabledWarning";case 1:return"HighlightWithExistsFiltersDisabledWarning"}},enumerable:!0,configurable:!0}),e.prototype.getDetails=function(e){var t=0===this.highlightDisableType,r=t?"HighlightWithTOPNDisabledWarning_Message":"HighlightWithExistFiltersDisabledWarning_Message",i=t?"HighlightWithTOPNDisabledWarning_ErrorInfoKey":"HighlightWithExistFiltersDisabledWarning_ErrorInfoKey",n=t?"HighlightWithTOPNDisabledWarning_Value":"HighlightWithExistFiltersDisabledWarning_Value";return{message:e.get(r),displayableErrorInfo:[{errorInfoKey:e.get(i),errorInfoValue:e.get(n)}]}},e})()})(W||(W={}))})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(r){function i(e,t,r,i,n){return new o(e,t,r,i,n)}var n=e.visuals.plugins,a=t.util.VisualContainerUtils;r.createVisualRelationshipService=i;var o=(function(){function r(e,t,r,i,n){this.visualPluginService=e,this.pluginOps=t,this.explorationNavigationService=r,this.featureSwitchService=i,this.filterCapabilitiesService=n}return r.prototype.relationship=function(e,t,r){return this.getRelationship(e.relationships,t,r)},r.prototype.drillRelationship=function(e,t,r){var i=this.getRelationship(e.relationships,t,r);if(i){var n=i;return 2===i.type&&(n={source:i.source,target:i.target,type:1}),n}},r.prototype.getRelationship=function(e,t,r){return _.find(e,(function(e){return e.source===t&&e.target===r}))},r.prototype.getIsCrossHighlightingDisabled=function(){if(!this.featureSwitchService||!this.featureSwitchService.featureSwitches.slowDataSourceModeEnabled)return!1;var e=this.explorationNavigationService&&this.explorationNavigationService.getCurrentExploration(),t=e&&e.slowDataSourceSettings;return t&&t.isCrossHighlightingDisabled},r.prototype.relationshipFilterAction=function(e,t,r,i){var n=this.relationship(e,t,r);return this.getRelationshipFilterAction(n,t,r,i)},r.prototype.drillRelationshipFilterAction=function(e,t,r,i){if(!t.drillFilterOtherVisuals)return 3;var n=this.drillRelationship(e,t,r),a=this.getRelationshipFilterAction(n,t,r,i);return a},r.prototype.shouldApplyCrossDrill=function(e,t,r,i){if(t===r)return!1;if(a.getVisualType(r)===n.slicer.name)return!1;var o=this.drillRelationshipFilterAction(e,t,r,i);if(1===o)return!0;if(0===o){if(1===this.defaultDrillFilterAction(t,r))return!0}return!1},r.prototype.getRelationshipFilterAction=function(t,r,i,n){if(t&&this.supportsFilterActionTarget(r,i,t.type))return t.type;var a=i&&i.config&&i.config.singleVisual,o=a&&i.config.singleVisual.visualType,s=this.visualPluginService.capabilities(o);if(this.getIsCrossHighlightingDisabled()&&!this.isSlicer(s,o)){var l=r&&r.config&&r.config.singleVisual,u=l&&r.config.singleVisual.visualType,c=this.visualPluginService.capabilities(u);if(!this.isFilter(c,u,l&&l.objects))return 3}if(s){var p=a.query;if(p){var f=this.visualPluginService.getPlugin(o);if(f&&f.isCrossFilteredByDefault){var d=a.objects,h={mappings:s.dataViewMappings,queryDefn:p.defn,queryProjections:p.projections,schema:n,objectDescriptors:s.objects,objectDefinitions:d,roles:s.dataRoles},v=e.data.compileDataView(h),m={dataViewMappings:v};if(f.isCrossFilteredByDefault(m))return 3}}}return 0},r.prototype.isSlicer=function(e,r){return!!t.FilterUtils.tryGetFilterPropertyIdentifier(e,r,this.visualPluginService)},r.prototype.isFilter=function(e,r,i){return e?this.isSlicer(e,r):null!=t.FilterUtils.tryGetFilterProperty(e,r,this.visualPluginService,i)},r.prototype.supportsFilterActionTarget=function(e,t,r){var i=a.getVisualType(t),n=a.getVisualType(e);if(!_.isEmpty(n)&&!_.isEmpty(i)){var o=this.visualPluginService.capabilities(i),s=this.pluginOps.isQueryVisual(i),l=!o||o.supportsHighlight;switch(r){case 1:return s;case 2:return l&&!this.filterCapabilitiesService.hasFilterCapabilities(n);case 3:return s||l}}return!1},r.prototype.supportsAnyFilterAction=function(e){var t=a.getVisualType(e);if(_.isEmpty(t)||!this.pluginOps.isQueryVisual(t))return!1;var r=this.visualPluginService.capabilities(t);return!r||r.supportsSelection!==!1},r.prototype.defaultFilterAction=function(e,t){return this.supportsFilterActionTarget(e,t,2)?2:this.supportsFilterActionTarget(e,t,1)?1:void 0},r.prototype.defaultDrillFilterAction=function(e,t){var r=this.defaultFilterAction(e,t);return 2===r&&(r=1),r},r})()})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){function r(e,t,r,i){return new s(e,t,r,i)}var i=e.data.SemanticFilter,n=e.data.SemanticQuery,a=e.data.services.SemanticQuerySerializer,o=e.data.SQExprBuilder;t.createHostFiltersService=r;var s=(function(){function e(e,t,r,i){this.conceptualSchemaProxy=e,this.dataProxyFactory=t,this.promiseFactory=r,this.eventBridge=i,this.filtersDictionary={}}return e.prototype.getHostAvailableCategories=function(e,t){var r=this;return this.conceptualSchemaProxy.get(e).then((function(e){var i=_.filter(e.schemas,(function(e){return!e.isExtensionSchema})),n=_.flatten(_.map(i,(function(e){return e.entities}))),a=_.flatten(_.map(n,(function(e){return e.properties}))),o=_.filter(t,(function(e){return 1===r.typeWithinSchemaCount(a,e)}));if(o.length>0){return{categories:o}}return{categories:[]}}))},e.prototype.typeWithinSchemaCount=function(e,t){return _.filter(e,(function(e){return e.type.extendedType===t.extendedType})).length},e.prototype.addOrUpdateHostFilters=function(e,t,r){var i=this;return this.conceptualSchemaProxy.get(t).then((function(n){return i.promiseFactory.all(_.map(e,(function(e){return i.addOrUpdateHostFilter(t,n,e,r)})))}))},e.prototype.removeHostFilters=function(e){for(var t=0,r=e;t<r.length;t++){var i=r[t];void 0!==this.filtersDictionary[i]&&delete this.filtersDictionary[i]}},e.prototype.selectHostFilters=function(e){for(var t=0,r=e;t<r.length;t++){var i=r[t],n=this.filtersDictionary[i];n&&(n.selected=!0)}},e.prototype.deselectHostFilters=function(e){for(var t=0,r=e;t<r.length;t++){var i=r[t];this.filtersDictionary[i]&&(this.filtersDictionary[i].selected=!1)}},e.prototype.applySelectedHostFilters=function(){this.eventBridge.publishToChannel(t.events.visualContainerChanged,{affectContainer:function(){return!0},allowCache:!0})},e.prototype.getSelectedHostFilters=function(){var e=[];for(var t in this.filtersDictionary){var r=this.filtersDictionary[t];r.selected&&e.push(r.filterContainer)}return{filters:e}},e.prototype.addOrUpdateHostFilter=function(e,t,r,a){if(r.type&&r.value){for(var s=r.value.toString(),l={hostFilterValue:{value:s,type:r.type},filterValue:s,filterKey:r.type.categoryString,filterCanExecute:!1,filterReturnNonEmptyResults:!1},u=[],c=_.filter(t.schemas,(function(e){return!e.isExtensionSchema})),p=0,f=c;p<f.length;p++)for(var d=f[p],h=0,v=d.entities;h<v.length;h++)for(var m=v[h],g=0,y=m.properties;g<y.length;g++){var C=y[g];C.type.extendedType===r.type.extendedType&&u.push({schema:d,entity:m,property:C})}if(1===u.length){var x=u[0].schema,b=u[0].entity,S=u[0].property,E=o.entity(x.name,b.name),w=o.columnRef(E,S.name),F=r.alternativeValues?r.alternativeValues.concat(r.value):[r.value],V=o.inValues([w],_.map(F,(function(e){return[o.typedConstant(e,r.type)]}))),P=i.fromSQExpr(V),D={name:l.filterKey,expression:E,filter:P};if(l.filterCanExecute=!0,this.filtersDictionary[l.filterKey]={filterContainer:D,selected:!1},a){var R=n.create().addSelect(w).addSemanticFilter(P);if(R)return this.testHostFilterForNonEmptyResults(e,l,R)}}return this.promiseFactory.resolve(l)}},e.prototype.testHostFilterForNonEmptyResults=function(e,t,r){if(t.filterCanExecute&&r&&e){var i=_.compact(_.map(e,(function(e){return e.dsr}))),n={type:"dsr",query:{dataSources:i,command:{Commands:[{SemanticQueryDataShapeCommand:{Query:a.serializeQuery(r)}}]},allowCache:!0,cacheResponseOnServer:!0}};return this.dataProxyFactory.create().execute(n).then((function(e){return e.dataReaderResult.dataView.table.rows.length>0&&(t.filterReturnNonEmptyResults=!0),t}),(function(){return t}))}this.promiseFactory.reject()},e})()})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){function r(e,t){return new o(e,t)}var i=e.data.SemanticFilter,n=e.data.SQExprConverter,a=e.data.SQExprUtils;t.createAnalyzedFilter=r;var o=(function(){function t(e,t){this.filter=e.filter,this.isNotFilter=!1,this.analyze(e,t)}return t.prototype.analyze=function(t,r){if(!i.isAnyFilter(this.filter)){var o=t.fieldSQExprs,s=i.isDefaultFilter(this.filter);if(this.filter&&!s){var l=n.asScopeIdsContainer(this.filter,o);l&&(this.isNotFilter=l.isNot,this.selectedIdentities=l.scopeIds)}if(this.defaultValue=this.getDataViewDefaultValue(t.dataView,t.defaultValuePropertyId),this.defaultValue&&!r&&(this.filter||(this.filter=i.getDefaultValueFilter(o),s=!0),s)){var u=e.data.createDataViewScopeIdentity(a.getDataViewScopeIdentityComparisonExpr(o,this.defaultValue.identityFieldsValues));this.isNotFilter=!1,this.selectedIdentities=[u]}}},t.prototype.getDataViewDefaultValue=function(t,r){if(t&&t.metadata&&!_.isEmpty(t.metadata.columns))return e.DataViewObjects.getValue(t.metadata.columns[0].objects,r)},t})();t.FilterAnalyzer=o})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){var r=e.explore.util.VisualContainerUtils,i=(function(){function e(e){this.visualPlugins=e,this.collectedFilters=[]}return e.prototype.collectFilters=function(e,t,r){if(e)for(var i=0,n=e;i<n.length;i++){var a=n[i];a.filter&&this.collectFilter(a.filter,a,r,t)}},e.prototype.collectFiltersForFilterContainer=function(e,t,r,i){if(e)for(var n=0,a=e;n<a.length;n++){var o=a[n];o.filter&&o!==r&&this.collectFilter(o.filter,o,i,t)}},e.prototype.collectFilter=function(e,t,i,n,a){if(e){var o;i&&(o=r.getVisualCapabilities(i,this.visualPlugins)),this.collectedFilters.push({filter:e,filterContainer:t,sourceVisualContainer:i,sourceVisualContainerCapabilities:o,scopeType:n,collectedFilterSource:a})}},e.prototype.getCollectedFilters=function(){return this.collectedFilters},e})();t.FilterCollector=i})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(r){function i(e,r,i,a,s,l,u){var c={filter:e,scope:r,filterExpressionMetadata:u};if(i)c.restatement=i.restatement,c.type=i.type,c.isHidden=!!i.isHiddenInViewMode,c.filterExpressionMetadata=i.expression?{expressions:[i.expression]}:void 0,i.cachedValueItems&&c.filterExpressionMetadata?c.filterExpressionMetadata.cachedValueItems=n(i.cachedValueItems,0):i.filterExpressionMetadata&&(c.filterExpressionMetadata=i.filterExpressionMetadata);else if(a&&t.FilterUtils.supportsFilterOutput(s)&&a.config.singleVisual.query){var p=a.config.singleVisual.query.defn.select(),f=a.config.singleVisual.cachedFilterDisplayItems;if(1===p.length&&f&&l===o.Slicer)c.filterExpressionMetadata={expressions:[p[0].expr],cachedValueItems:n(f,0)};else{c.filterExpressionMetadata={expressions:[]};for(var d=0,h=p;d<h.length;d++){var v=h[d];c.filterExpressionMetadata.expressions.push(v.expr)}}}return c}function n(e,t){for(var r=[],i=0,n=e;i<n.length;i++){var a=n[i],o={identities:[a.identity],valueMap:{}};o.valueMap[t]=a.displayName,r.push(o)}return r}var a=jsCommon.ArrayExtensions,o=e.explore.contracts.CollectedFilterSource,s=e.data.SemanticFilter,l=e.data.services.SemanticQuerySerializer,u=e.data.SubqueryRewriter,c=e.data.TopNFilterPruner,p=t.util.VisualContainerUtils;r.toFilterData=i;var f=(function(){function e(e,t){if(this.visualContainer=e,this.filterContainer=t,e){var r=p.getVisualQuery(e);r&&(this.visualSemanticQuery=r.defn)}this.needToEnsurePrecedence=!1,this.shouldPruneUnnecessaryFilters=!1}return e.prototype.setSelectorFilter=function(e){this.selectorFilter=e,this.shouldPruneUnnecessaryFilters=!0},e.prototype.addDrillFilter=function(e){this.drillFilters=this.drillFilters||[],this.drillFilters.push(e)},e.prototype.addVisualFilter=function(e){this.visualSemanticQuery&&(e.filter=u.rewriteSubqueriesForContainingQuery(e.filter,this.visualSemanticQuery)),this.visualFilters=this.visualFilters||[],this.visualFilters.push(e),this.needToEnsurePrecedence=!0,this.shouldPruneUnnecessaryFilters=!0},e.prototype.addDrillthroughFilter=function(e){this.drillthroughFilters=this.drillthroughFilters||[],this.drillthroughFilters.push(e),this.needToEnsurePrecedence=!0},e.prototype.addSectionFilter=function(e){this.sectionFilters=this.sectionFilters||[],this.sectionFilters.push(e),this.needToEnsurePrecedence=!0},e.prototype.addReportFilter=function(e){this.reportFilters=this.reportFilters||[],this.reportFilters.push(e),this.needToEnsurePrecedence=!0},e.prototype.addCrossFilter=function(e){this.crossFilters=this.crossFilters||[],this.crossFilters.push(e),this.needToEnsurePrecedence=!0},e.prototype.addHighlight=function(e){this.highlightFilters=this.highlightFilters||[],this.highlightFilters.push(e)},e.prototype.addCollectedFilters=function(e,t,r){for(var n=0,a=e;n<a.length;n++){var o=a[n],s=o.filter,u=o.filterContainer,c=o.sourceVisualContainer;if(!r||r(s,u,c)){var p=u;o.filterContainer&&o.filterContainer===this.filterContainer&&(p=null);var f=i(s,o.scopeType,p,c,o.sourceVisualContainerCapabilities,o.collectedFilterSource);if(!u||2!==u.howCreated&&0!==u.precedence?o.sourceVisualContainer?o.sourceVisualContainer===this.visualContainer?this.addVisualFilter(f):this.addCrossFilter(f):5===u.howCreated?this.addDrillthroughFilter(f):1===o.scopeType?this.addSectionFilter(f):2===o.scopeType?this.addReportFilter(f):o.filterContainer&&o.filterContainer===this.filterContainer&&this.addVisualFilter(f):this.addDrillFilter(f),t&&u){var d=u.expression&&l.serializeExpr(u.expression);this.metadata=this.metadata||[],this.metadata.push({Restatement:u.restatement,expression:d,type:u.type})}}}},e.prototype.mergeHighlightFiltersBasedOnRelationship=function(e,t,r){var i=this;switch(t){case 0:case 2:if(!r){_.each(e,(function(e){return i.addHighlight(e)}));break}case 1:e&&_.each(e,(function(e){return i.addCrossFilter(e)}));break;case 3:}},e.prototype.getFilters=function(e){var t=this.getFilterData(e),r=this.highlightFilters&&s.merge(this.highlightFilters.map((function(e){return e.filter})));return{dataFilter:t?s.merge(_.map(t,(function(e){return e.filter}))):void 0,dataFiltersUnmerged:t,highlightFilter:r,highlightFiltersUnmerged:this.highlightFilters,filterMetadata:this.metadata}},e.prototype.getFilterData=function(e){if(this.pruneUnnecessaryFilters(),e||this.ensurePrecedence(),this.drillFilters||this.sectionFilters||this.reportFilters||this.visualFilters||this.crossFilters||this.drillthroughFilters){var t=this.drillFilters||[],r=this.visualFilters||[],i=this.sectionFilters||[],n=this.drillthroughFilters||[],a=this.reportFilters||[],o=this.crossFilters||[];return t.concat(r).concat(o).concat(i).concat(n).concat(a)}},e.prototype.getCrossHighlightFilters=function(){if(this.pruneUnnecessaryFilters(),this.ensurePrecedence(),this.selectorFilter||this.visualFilters){var e=this.selectorFilter?[this.selectorFilter]:[],t=this.visualFilters||[];return e.concat(t)}},e.prototype.getHighlightFilters=function(){return this.highlightFilters},e.prototype.clearHighlightFilters=function(){this.highlightFilters=void 0},e.prototype.getUnmergedDrillCrossFilter=function(){return this.pruneUnnecessaryFilters(),this.ensurePrecedence(),this.drillFilters},e.prototype.getCrossFilters=function(){return this.crossFilters},e.prototype.ensurePrecedence=function(){if(this.needToEnsurePrecedence){if(this.visualFilters){var e={visualFilters:this.visualFilters,crossFilters:this.crossFilters,reportFilters:this.reportFilters,drillThroughFilters:this.drillthroughFilters,sectionFilters:this.sectionFilters};this.visualFilters=r.FilterPrecedenceResolver.resolve(e)}this.needToEnsurePrecedence=!1}},e.prototype.pruneUnnecessaryFilters=function(){var e=this;this.shouldPruneUnnecessaryFilters&&(this.visualFilters&&this.selectorFilter&&this.visualFilters&&this.selectorFilter&&(this.visualFilters=a.filterArray(this.visualFilters,(function(t,r){return t.filter=c.removeUnnecessaryTopNFilters(t.filter,e.selectorFilter.filter),t.filter.where().length>0}))),this.shouldPruneUnnecessaryFilters=!1)},e})();r.FilterBuilder=f})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){var r,i=e.data.FilterKindDetector,n=e.data.SemanticFilter,a=e.data.SubqueryRewriter;!(function(e){function t(e){if(_.isEmpty(e.visualFilters))return e.visualFilters;for(var t=!1,o=[],s=0,l=e.visualFilters;s<l.length;s++){var u=l[s],c=u.filter.where(),p=c.filter((function(e){return 0===i.run(e.condition)}));t=t||r([u]),o.push.apply(o,p.map((function(e){return n.fromSQExpr(e.condition)})))}if(!t)return e.visualFilters;for(var f=[],d=0,h=e.visualFilters;d<h.length;d++){var u=h[d],v=u;if(r([u])){var m=u.filter;_.isEmpty(o)||(m=a.makeSubqueriesLowerPrecedenceThanSpecificFilters(m,o)),_.isEmpty(e.crossFilters)||(m=a.makeSubqueriesLowerPrecedenceThanSpecificFilters(m,e.crossFilters.map((function(e){return e.filter})))),_.isEmpty(e.sectionFilters)||(m=a.makeSubqueriesLowerPrecedenceThanSpecificFilters(m,e.sectionFilters.map((function(e){return e.filter})))),_.isEmpty(e.drillThroughFilters)||(m=a.makeSubqueriesLowerPrecedenceThanSpecificFilters(m,e.drillThroughFilters.map((function(e){return e.filter})))),_.isEmpty(e.reportFilters)||(m=a.makeSubqueriesLowerPrecedenceThanSpecificFilters(m,e.reportFilters.map((function(e){return e.filter})))),v={filter:m}}f.push(v)}return f}function r(e){if(_.isEmpty(e))return!1;for(var t=0,r=e;t<r.length;t++){var n=r[t];if(_.some(n.filter.where(),(function(e){return 3===i.run(e.condition)})))return!0}return!1}e.resolve=t})(r=t.FilterPrecedenceResolver||(t.FilterPrecedenceResolver={}))})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){var r=e.data.FilterKindDetector,i=e.data.SQScopedEvalExpr,n=(function(){function t(e){this.options=e}return t.prototype.resolveSemanticQuery=function(e){return e?e.where(this.resolveFilters(e.where()),e.from()):null},t.prototype.resolveFilters=function(e){var t=this;return e?_.map(e,(function(e){return t.resolveFilter(e)})):null},t.prototype.resolveFilter=function(e){if(!e)return null;if(e.target)return e;if(e.condition){switch(r.run(e.condition)){case 0:return this.resolveColumnFilter(e);case 2:return this.resolveExistsFilter(e);case 1:return this.resolveMeasureFilter(e);case 3:return this.resolveSubqueryFilter(e);default:return}}},t.prototype.resolveColumnFilter=function(e){return{condition:e.condition}},t.prototype.resolveMeasureFilter=function(e){var t=null;this.options.mappings&&this.options.mappings.measureFilter&&(t=this.options.mappings.measureFilter.targetRoles),t||(t=this.getDefaultMeasureFilterTargetRoles());var r,i,n=e.condition;if(t){for(var o=0,s=t;o<s.length;o++){var l=s[o],u=this.options.queryProjections[l];if(u)for(var c=0,p=u.all();c<p.length;c++){var f=p[c],d=this.options.select.filter((function(e){return e.name===f.queryRef})),h=d[0].expr,v=d[0].name,m=h.getMetadata(this.options.schema),g=r&&r[v];m&&1!==m.kind&&!g&&(i||(i=[],r={}),i.push(h),r[v]=!0)}}n=a.rewrite(n,t)}return{target:i,condition:n}},t.prototype.resolveExistsFilter=function(e){return e},t.prototype.resolveSubqueryFilter=function(e){return{condition:e.condition}},t.prototype.getDefaultMeasureFilterTargetRoles=function(){return(this.options.dataRoles?this.options.dataRoles.filter((function(t){return t.kind===e.VisualDataRoleKind.Grouping||t.kind===e.VisualDataRoleKind.GroupingOrMeasure})):[]).map((function(e){return e.name}))},t})();t.VisualFilterMappingResolver=n;var a=(function(t){function r(e){var r=t.call(this)||this;return r.filterTargetRoles=e,r}return __extends(r,t),r.rewrite=function(e,t){var i=new r(t);return e.accept(i)},r.prototype.visitScopedEval=function(t){var r=this,n=_.filter(t.scope,(function(t){return!e.data.SQExpr.isRoleRef(t)||_.includes(r.filterTargetRoles,t.role)}));return n.length===t.scope.length?t:new i(t.expression,n)},r})(e.data.SQExprRewriter)})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){function t(e){return new c(e)}function r(e){return new p(e)}function i(e){return new f(e)}function n(e){return new d(e)}function a(e,t){if(_.isEmpty(t))return t;var r=[];return t.forEach((function(t){r.push(o(e,t))})),r}function o(e,t){if(_.isEmpty(t))return t;var r={};return t.Table&&(r.Table=e.visitTableBinding(t.Table)),t.Pod&&(r.Pod=e.visitPodBinding(t.Pod)),t.Property&&(r.Property=e.visitPropertyBinding(t.Property)),t.Value&&(r.Value=e.visitValueBinding(t.Value)),t.Range&&(r.Range=e.visitRangeBinding(t.Range)),t.VisType&&(r.VisType=e.visitVisualizationTypeBinding(t.VisType)),t.Composite&&(r.Composite=e.visitCompositeBinding(t.Composite)),t.Core&&(r.Core=e.visitCoreTermBinding(t.Core)),t.AnyEntity&&(r.AnyEntity=e.visitAnyEntityBinding(t.AnyEntity)),r}function s(e,t){if(_.isEmpty(t))return t;var r={StartIndex:t.StartIndex,
Length:t.Length};return null!=t.Unrecognized&&(r.Unrecognized=t.Unrecognized),null!=t.Source&&(r.Source=t.Source),t.Binding&&(r.Binding=o(e,t.Binding)),t.AlternateBindings&&(r.AlternateBindings=a(e,t.AlternateBindings)),t.PhraseCompletions&&(r.PhraseCompletions=a(e,t.PhraseCompletions)),t.SuggestedReplacements&&(r.SuggestedReplacements=a(e,t.SuggestedReplacements)),r}function l(e,t){return(e||"")===(t||"")}e.createMeasureMoveRewriter=t,e.createEntityRenameRewriter=r,e.createPropertyRenameRewriter=i,e.createHierarchyLevelRenameRewriter=n;var u=(function(){function e(){}return e.prototype.visitBinding=function(e){return e},e.prototype.visitEntityBinding=function(e){var t=e.EntityText,r=this.visitBinding(e),i=__assign({},r);return null!=t&&(i.EntityText=t),i},e.prototype.visitAnyEntityBinding=function(e){return this.visitEntityBinding(e)},e.prototype.visitModelEntityBinding=function(e){var t=e.ConceptualEntity,r=e.ConceptualSchema,i=this.visitEntityBinding(e),n=__assign({},e,i);return n.ConceptualEntity=t,null!=r&&(n.ConceptualSchema=r),n},e.prototype.visitTableBinding=function(e){return this.visitModelEntityBinding(e)},e.prototype.visitPodBinding=function(e){return this.visitModelEntityBinding(e)},e.prototype.visitPropertyBaseBinding=function(e){var t=e.ConceptualProperty,r=e.ConceptualHierarchy,i=e.ConceptualHierarchyLevel,n=this.visitModelEntityBinding(e),a=__assign({},n);return null!=t&&(a.ConceptualProperty=t),null!=r&&(a.ConceptualHierarchy=r),null!=i&&(a.ConceptualHierarchyLevel=i),a},e.prototype.visitPropertyBinding=function(e){return this.visitPropertyBaseBinding(e)},e.prototype.visitValueBinding=function(e){return this.visitPropertyBaseBinding(e)},e.prototype.visitRangeBinding=function(e){var t=e.LowerBoundTerm,r=e.UpperBoundTerm,i=this.visitPropertyBaseBinding(e),n=__assign({},i);return t&&(n.LowerBoundTerm=this.rewriteSpan(t)),r&&(n.UpperBoundTerm=this.rewriteSpan(r)),n},e.prototype.visitCoreTermBaseBinding=function(e){return this.visitBinding(e)},e.prototype.visitCoreTermBinding=function(e){return this.visitCoreTermBaseBinding(e)},e.prototype.visitVisualizationTypeBinding=function(e){var t=e.Type,r=this.visitCoreTermBaseBinding(e),i=__assign({},e,r);return i.Type=t,i},e.prototype.visitCompositeBinding=function(e){var t=this,r=e.Terms,i=this.visitBinding(e),n=__assign({},e,i);return n.Terms=r,_.isEmpty(r)||(n.Terms=[],r.forEach((function(e){n.Terms.push(t.rewriteSpan(e))}))),n},e.prototype.rewriteSpan=function(e){return s(this,e)},e})(),c=(function(e){function t(t){var r=e.call(this)||this;return r.change=t,r}return __extends(t,e),t.prototype.visitPropertyBaseBinding=function(e){var t=this.change;if(l(e.ConceptualSchema,t.schema)&&e.ConceptualEntity===t.source&&e.ConceptualProperty===t.property){var r=_.cloneDeep(e);return r.ConceptualEntity=t.destination,r}return e},t})(u),p=(function(e){function t(t){var r=e.call(this)||this;return r.change=t,r}return __extends(t,e),t.prototype.visitModelEntityBinding=function(e){var t=this.change;if(l(e.ConceptualSchema,t.schema)&&e.ConceptualEntity===t.before){var r=_.cloneDeep(e);return r.ConceptualEntity=t.after,r}return e},t})(u),f=(function(e){function t(t){var r=e.call(this)||this;return r.change=t,r}return __extends(t,e),t.prototype.visitPropertyBaseBinding=function(e){var t=this.change;if(l(e.ConceptualSchema,t.schema)&&t.entity===e.ConceptualEntity&&t.before===e.ConceptualProperty){var r=_.cloneDeep(e);return r.ConceptualProperty=t.after,r}return e},t})(u),d=(function(e){function t(t){var r=e.call(this)||this;return r.change=t,r}return __extends(t,e),t.prototype.visitPropertyBaseBinding=function(e){var t=this.change;if(l(e.ConceptualSchema,t.schema)&&t.entity===e.ConceptualEntity&&t.before===e.ConceptualHierarchyLevel){var r=_.cloneDeep(e);return r.ConceptualHierarchyLevel=t.after,r}return e},t})(u)})(t=e.BindingRewrite||(e.BindingRewrite={}))})(t=e.util||(e.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){function t(e,t,r){var i=t.capabilities(e);return!(!i||!r.isQueryVisual(e))&&(!i.disableVisualDetails&&_.some(i.dataViewMappings,(function(e){return e.categorical||e.matrix||e.table||e.tree})))}function r(t,r){var i,n,a=r||1;return 1===a?(i=t.width-2*e.DetailVisualBorder,n=t.height-e.DetailVisualBorder):(i=t.width-e.DetailVisualBorder,n=t.height-2*e.DetailVisualBorder),{width:Math.max(i,0),height:Math.max(n,0),scale:t.scale}}e.DetailVisualBorder=10,e.supportsVisualDetails=t,e.getDetailVisualViewport=r})(t=e.DetailVisualUtils||(e.DetailVisualUtils={}))})(t=e.util||(e.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(r){function i(t,r,i,n,o){if(!t)return i;var s=[],l=o.objects,u=function(e){var r=l[e],n=function(n){if(r.properties[n].type.queryTransform){var o=_.filter(t[e],(function(e){return a(e,i)}));s.push.apply(s,_.map(o,(function(t){return{objectName:e,propertyName:n,object:t}})))}};for(var o in r.properties)n(o)};for(var c in l)u(c);if(_.isEmpty(s))return i;for(var p=i.clone(),f=0,v=s;f<v.length;f++){var m=v[f],g=d.getValue(t,{objectName:m.objectName,propertyName:m.propertyName},m.object.selector);if(!g)return i;if(g.algorithm!==h.name||_.some(r,e.DataViewMapping.isForecastDefined)){var y=n.getTransformPlugin(g.algorithm);p.addTransform(y,g.parameters,o)}}return p}function n(t,r,i){var n=r.defn.transforms();if(_.isEmpty(n))return r;for(var a=r.clone(),o=0,s=n;o<s.length;o++){var l=s[o];if(l.algorithm===e.data.transforms.plugins.Forecast.name&&!_.some(i,e.DataViewMapping.isForecastDefined)){var u=t.getTransformPlugin(l.algorithm);a.removeTransform(u,l.name)}}return a}function a(e,t){if(!e.selector||!_.isString(e.selector.metadata))return!0;var r=t.projections;if(!r)return!1;for(var i in r){var n=r[i];if(n){var a=n.all();if(a)for(var o=0,s=a;o<s.length;o++){var l=s[o];if(l.queryRef===e.selector.metadata)return!0}}}return!1}function o(e,t,r,i,n,a){var o=t.defn.transforms();if(_.isEmpty(o))return t;var c=t.defn.select();if(_.isEmpty(c))return t;for(var p=u(t,r,i,n),f=p.transformSelects,d=p.topLevelSelects,h=[],g=0;g<o.length;g++){var y=o[g],x=e.getTransformPlugin(y.algorithm),b="input"+g,S="output"+g,E={algorithm:y.algorithm,name:y.name,input:{parameters:y.input.parameters,table:{name:b,columns:s(f,i,r,x,a)}},output:{table:{name:S,columns:l(f,b,t.projections)}}};f=_.map(E.output.table.columns,(function(e){var t=m.columnRef(m.transformTableRef(S),e.expression.name);return{name:e.expression.name,expr:t}})),h.push(E)}var w,F=_.last(h),V=t.defn.orderBy();F&&!_.isEmpty(V)&&(w=_.map(V,(function(e){var t=_.find(c,(function(t){return v.equals(t.expr,e.expr)})),r=m.columnRef(m.transformTableRef(F.output.table.name),t.name);return{direction:e.direction,expr:r}})));var P=t.defn.transforms(h);if(!_.isEmpty(d))for(var D=function(e){var t=_.findIndex(c,(function(t){return t.name===e.name}));f.splice(t,0,e)},R=0,T=d;R<T.length;R++){var N=T[R];D(N)}return P=P.select(f),w&&(P=P.orderBy(w)),new C(P,t.projections,t.expansionStates)}function s(e,t,r,i,n){var a=_.filter(e,(function(e){return!v.isTransformOutputRoleRef(e.expr)})),o=c(n),s=Object.keys(t);return _.map(a,(function(e){var n=_.find(s,(function(r){return _.includes(t[r],e.name)}));if(!n)return{role:"X",expression:e};var a=_.find(r,(function(e){return e.name===n}));return{role:o&&0===a.cartesianKind?void 0:p(e.expr,i,a),expression:e}}))}function l(e,t,r){for(var i={},n=0,a=e;n<a.length;n++){var o=a[n];v.isTransformOutputRoleRef(o.expr)||(i[o.name]=!0)}return _.map(e,(function(e){var n,a,o;if(v.isTransformOutputRoleRef(e.expr)){var s=void 0;for(var l in r){var u=r[l].all();_.some(u,(function(t){return t.queryRef===e.name}))&&(s=l)}n=s,a=e.expr,o=y.findUniqueName(i,e.name)}else a=m.columnRef(m.transformTableRef(t),e.name),o=e.name;return{role:n,expression:{name:o,expr:a}}}))}function u(e,t,r,i){for(var n=[],a=[],o=e.defn.select(),s=function(t){if(v.isTransformOutputRoleRef(t.expr))return n.push(t),"continue";var o=Object.keys(r),s=_.filter(o,(function(e){return _.includes(r[e],t.name)}));if(!_.isEmpty(s)){for(var l=!1,u=0,c=s;u<c.length;u++){var p=c[u];if(!e.projections[p].activeProjectionRefs||_.includes(e.projections[p].activeProjectionRefs,t.name)){n.push(t),l=!0;break}}return l||a.push(t),"continue"}if(!_.isEmpty(i)){var f=_.find(i,(function(e){return e.queryName===t.name}));f&&f.selector&&f.selector.data?n.push(t):a.push(t)}},l=0,u=o;l<u.length;l++){s(u[l])}return{transformSelects:n,topLevelSelects:a}}function c(e){for(var t=!1,r=0,i=e;r<i.length;r++){var n=i[r];if(n.categorical){var a=n.categorical.categories;_.isEmpty(a)||f.visitCategoricalCategories(a,{visitRole:function(e){_.some(e.items,(function(e){return e.scalarKeyInfo&&e.scalarKeyInfo.scalarKeyMinProperty}))&&(t=!0)}})}if(t)break}return t}function p(e,t,r){var i=_.find(t.inputRoles,(function(t){var i=t.visualDataRoleMatching;return!i||(void 0===i.cartesianKind||i.cartesianKind===r.cartesianKind)&&((void 0===i.matchGrouping||i.matchGrouping!==g.isMeasure(e))&&((void 0===i.matchMeasure||i.matchMeasure===g.isMeasure(e))&&(!i.skipJoinPredicateNone||0!==r.joinPredicate)))}));if(i)return i.name}var f=e.data.CompiledDataViewMapping,d=e.data.DataViewObjectDefinitions,h=e.data.transforms.plugins.Forecast,v=e.data.SQExpr,m=e.data.SQExprBuilder,g=e.data.SQExprUtils,y=jsCommon.StringExtensions,C=t.contracts.VisualQuery;r.addTransforms=i,r.removeUnsupportedTransforms=n,r.rewriteTransform=o})(r=t.TransformGeneratorUtils||(t.TransformGeneratorUtils={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){t.invalidSortExprIndex=-1,t.DefaultSchemaName=e.data.dsr.DefaultSchemaName,t.ExplorationSchemaName="extension",t.DefaultBaseThemeName="CY18SU07",t.DefaultDrillFilterOtherVisuals=!0,t.SectionComponentType="page",t.ExplorationComponentType="report";var r;!(function(e){function t(){return{color:e.DefaultCanvasBackgroundColor,transparency:e.DefaultCanvasBackgroundTransparency}}function r(){return{color:e.DefaultCanvasOutspaceColor,transparency:e.DefaultCanvasOutspaceTransparency}}e.DefaultCanvasWidth=960,e.DefaultCanvasHeight=720,e.DefaultCanvasBackgroundColor="#FFFFFF",e.DefaultCanvasOutspaceColor="#EAEAEA",e.DefaultCanvasOutspaceTransparency=0,e.DefaultOutspacePaneTransparency=0,e.DefaultOutspacePaneBackgroundColor="#FFFFFF",e.DefaultForegroundColor="#333333",e.DefaultControlForegroundColor="#000000",e.DefaultControlBackgroundColor="#ffffff",e.DefaultOutspacePaneBorder=!0,e.DefaultOutspacePaneBorderColor="#C8C8C8",e.DefaultOutspacePaneTitleSizePx=24,e.DefaultOutspacePaneHeaderSizePx=14,e.DefaultOutspacePaneFontFamily="Segoe UI",e.DefaultAppliedFilterCardBackgroundColor="#F1F1F1",e.DefaultAppliedFilterCardTransparency=0,e.DefaultAvailableFilterCardBackgroundColor="#FFFFFF",e.DefaultAvailableFilterCardTransparency=0,e.DefaultFilterCardBorder=!0,e.DefaultFilterCardBorderColor="#C8C8C8",e.DefaultCanvasBackgroundTransparency=0,e.DefaultWidescreenWidth=1280,e.DefaultWidescreenHeight=720,e.DefaultCortanaWidth=296,e.DefaultCortanaHeight=592,e.DefaultLetterWidth=816,e.DefaultLetterHeight=1056,e.DefaultTooltipWidth=320,e.DefaultTooltipHeight=240,e.CanvasGutterSize=10,e.getDefaultCanvasBackground=t,e.getDefaultCanvasOutspace=r})(r=t.ExploreCanvasConstants||(t.ExploreCanvasConstants={}))})(r=t.constants||(t.constants={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={})),powerbi.define("Explore/services/explorationState",(function(e){function t(e,t,r,i,n,a){return new V(e,t,r,i,n,a)}function r(e,t){if(!_.isEmpty(e)){for(var r={},n=0,l=e;n<l.length;n++){var u=l[n];u.isLinkedAsAggregation||(a(u)?(r.transientFilters||(r.transientFilters=[]),r.transientFilters.push(i(u))):o(u)?(r.exprIdentifiedMerges||(r.exprIdentifiedMerges=[]),r.exprIdentifiedMerges.push(i(u))):s(u)?(r.typeIdentifiedMerges||(r.typeIdentifiedMerges=[]),r.typeIdentifiedMerges.push(i(u))):(_.isEmpty(u.name)&&(u.name=b.getNextFilterName(e)),r.nameIdentifiedMerges||(r.nameIdentifiedMerges={}),r.nameIdentifiedMerges[u.name]=i(u)))}if(!_.isEmpty(r))return r}}function i(e){return{name:e.name,type:e.type,filter:e.filter,expression:e.expression,restatement:e.restatement,howCreated:e.howCreated,isTransient:e.isTransient,cachedValueItems:e.cachedValueItems}}function n(e){return{name:e.name,type:e.type,filter:e.filter,expression:e.expression,restatement:e.restatement,howCreated:e.howCreated,isTransient:e.isTransient,cachedValueItems:e.cachedValueItems}}function a(e){return!!e.isTransient}function o(e){return!!e.expression}function s(e){return 3===e.howCreated||4===e.howCreated}function l(e,t){return!!e&&!!t}function u(e,t,r){if(t.filterState)return!0;var i=g.findFilterOutput(r),n=[i];return _.some(n,e)}function c(e){var t=[{objectName:"outspacePane",propertyName:"expanded"},{objectName:"outspacePane",propertyName:"visible"}];return _.some(t,e)}var p=powerbi,f=p.data,d=p.explore,h=d.contracts,v=(powerbi.explore.services,jsCommon.ArrayExtensions),m=f.DataViewObjectDefinitions,g=f.DataViewObjectDescriptors,y=p.DataViewObjectProperty,C=f.DataViewTransform,x=powerbi.explore.contracts.ExplorationObjectDescriptors,b=d.FilterUtils,S=f.SemanticFilter,E=f.SQExpr,w=h.VisualContainer,F=d.util.VisualContainerUtils,V=(function(){function e(e,t,r,i,n,a){this.expandCollapse=e,this.filterGenerator=t,this.plugins=r,this.visualPluginOps=i,this.aggrOps=n,this.featureSwitchService=a}return e.prototype.capture=function(e,t,i){var n=e.sections[e.activeSectionIndex],a={activeSection:n.name,filters:r(e.filters,2),sections:{}};if(e.objects&&(a.objects=this.captureExplorationObjects(e.objects)),i.captureAllSections)for(var o=0,s=e.sections;o<s.length;o++){var l=s[o];a.sections[l.name]=this.captureSection(l,t)}else a.sections[n.name]=this.captureSection(n,t);return a},e.prototype.captureExplorationObjects=function(e){return this.captureObjects(x,e,c)},e.prototype.captureFilterState=function(e){var t=this.captureFilterStateObjects(e.visualType,e.objects);return{visualType:e.visualType,objects:t,cachedFilterDisplayItems:e.cachedFilterDisplayItems}},e.prototype.captureSection=function(e,t){var i=e.crossFilterSource&&e.crossFilterSource.highlight;return{filters:r(e.filters,1),visualContainers:this.captureVisualContainers(e.visualContainers,i,t)}},e.prototype.captureVisualContainers=function(e,t,i){for(var n={},a=function(e){var a=e.config.singleVisual;if(!a)return"continue";var s=void 0;if(!_.isEmpty(t)){var l=_.find(t,(function(e){return e.sourceVisualContainer.config.singleVisual===a&&!_.isEmpty(e.selection)}));l&&(s={selection:l.selection,filterExpressionMetadata:l.filterExpressionMetadata?l.filterExpressionMetadata:void 0})}var u=_.union(e.filters,o.getAdditionalVisualFiltersToCapture(e,i)),c={filters:r(u,0),singleVisual:{visualType:a.visualType,objects:o.captureVisualObjects(a.visualType,a.objects),cachedFilterDisplayItems:a.cachedFilterDisplayItems},highlight:s},p=e.visibility;null!=p&&0!==p&&(c.visibility=p),w.isHidden(a)&&(c.singleVisual.hidden=!0);var d=a.query;d&&d.defn&&(c.singleVisual.orderBy=d.defn.orderBy()),d&&d.projections&&(c.singleVisual.activeProjections=o.captureActiveProjections(d)),d&&d.expansionStates&&(c.singleVisual.expansionStates=f.ExpansionState.clone(d.expansionStates)),n[e.name]=c},o=this,s=0,l=e;s<l.length;s++){a(l[s])}return n},e.prototype.captureActiveProjections=function(e){var t,r=e.defn.select();for(var i in e.projections){var n=e.projections[i],a=n.activeProjectionRefs;if(!_.isEmpty(a)){var o=_.map(a,(function(e){return r.withName(e).expr}));t||(t={}),t[i]=o}}return t},e.prototype.captureVisualObjects=function(e,t){return this.captureFilterStateObjects(e,t)},e.prototype.captureFilterStateObjects=function(e,t){var r=this.plugins.capabilities(e);return r&&r.objects?this.captureObjects(r.objects,t,u):{}},e.prototype.captureObjects=function(e,t,r){var i={},n=null;for(var a in e){var o=e[a];for(var s in o.properties){var l=o.properties[s],u={objectName:a,propertyName:s};if(r(u,l,e)){var c=m.getValue(t,u,n);c&&m.setValue(i,u,n,c)}}}var p={};return _.isEmpty(i)||(p.merge=i),p},e.prototype.apply=function(e,t,r,i){var n={visualContainers:[]};i.suppressActiveSection||this.applyActiveSection(e.activeSection,t,n),i.suppressData||i.targetVisualNames||this.applyFilters(e.filters,t,2,n,i.clearUnmatchedData,[],void 0,r),e.objects&&this.applyExplorationObjects(e.objects,t,n,i);for(var a in e.sections){var o=v.findItemWithName(t.sections,a);if(o){var s=e.sections[a],l=!i.suppressActiveSection||this.isActiveSection(o.name,t);this.applySection(s,o,r,n,i,l)}}if(n.activeSection&&null!=n.filterScope){var u=t.sections[t.activeSectionIndex];F.clearSectionQueryCaches(u)}return n},e.prototype.applyExplorationObjects=function(e,t,r,i){var n={};e&&e.merge&&(n.merge=m.clone(e.merge));var a=t.objects||{};for(var o in n.merge)for(var s=0,l=n.merge[o];s<l.length;s++){var u=l[s],c=m.ensure(a,o,u.selector);for(var p in u.properties){var f=u.properties[p];this.shouldApplyExplorationProperty(o,i)&&!m.propertiesAreEqual(c.properties[p],f)&&(r.objects=!0,c.properties[p]=f)}}return r.objects&&!t.objects&&(t.objects=a),r},e.prototype.isDisplayOptions=function(e){return void 0!==e&&void 0!==e.outspacePane&&void 0!==e.visuals},e.prototype.shouldApplyExplorationProperty=function(e,t){return"outspacePane"===e&&this.isDisplayOptions(t.suppressDisplay)?!t.suppressDisplay.outspacePane:!t.suppressDisplay},e.prototype.applyFilterState=function(e,t){for(var r={visualContainers:[]},i=0,n=e;i<n.length;i++){var a=n[i],o=a.visual,s=a.state,l=o.config.singleVisual,u=this.plugins.capabilities(l.visualType),c=this.applyObjects(l,s.objects,u.objects,t,r);c=this.applyCachedFilterDisplayItems(s,l)||c,c&&!_.includes(r.visualContainers,o)&&r.visualContainers.push(o)}return r},e.prototype.isActiveSection=function(e,t){return e===t.sections[t.activeSectionIndex].name},e.prototype.applyActiveSection=function(e,t,r){if(!this.isActiveSection(e,t)){var i=v.indexWithName(t.sections,e);i>=0&&(t.activeSectionIndex=i,r.activeSection=!0)}},e.prototype.applyFilters=function(e,t,r,i,n,a,o,s){var l=!1,u=[],c={nameIdentifiedMerges:_.clone(e&&e.nameIdentifiedMerges||{}),exprIdentifiedMerges:(e&&e.exprIdentifiedMerges||[]).slice(),typeIdentifiedMerges:(e&&e.typeIdentifiedMerges||[]).slice(),transientFilters:(e&&e.transientFilters||[]).slice()};if(l=this.applyRemainingFilters(c,t,0===r,i,u,a,o,s)||l,n&&t.filters)for(var p=t.filters.length-1;p>=0;p--){var f=t.filters[p];f.type!==h.FilterType.Passthrough&&(_.includes(u,f)||(2===f.howCreated?(t.filters.splice(p,1),this.addImpactCrossDrillSourceUpdate(o,t,0===r,i)):(f.filter=void 0,f.cachedValueItems=void 0),l=!0))}return l&&this.setMinimumFilterScope(i,r),l},e.prototype.applyRemainingFilters=function(e,t,r,i,n,a,o,s){var l=this.applyTransientFilters(e,t,n);l=this.applyMatchingFilterByName(e,t,n)||l,l=this.applyMatchingFilterByExpr(e,t,r,n,s)||l,l=this.applyMatchingFilterByType(e,t,n)||l;var u=this.applyDrillFilters(e,t,n,a);return l=u||l,u&&this.addImpactCrossDrillSourceUpdate(o,t,r,i),l},e.prototype.addImpactCrossDrillSourceUpdate=function(e,t,r,i){if(l(t,r)){var n=t,a=this.filterGenerator.updateCrossDrillFromVisualContainersOperation(e,[n]);i.visualContainers=_.union(i.visualContainers,a)}},e.prototype.applyMatchingFilterByName=function(e,t,r){if(_.isEmpty(e)||_.isEmpty(e.nameIdentifiedMerges)||_.isEmpty(t.filters))return!1;var i=!1,a=[],o=function(o){var s=e.nameIdentifiedMerges[o],l=_.findIndex(t.filters,(function(e){return e.howCreated===s.howCreated&&!_.includes(r,e)&&e.name===o}));l!==-1&&(S.isSameFilter(t.filters[l].filter,s.filter)||(t.filters[l]=n(s),i=!0),a.push(o),r.push(t.filters[l]))};for(var s in e.nameIdentifiedMerges)o(s);return a.forEach((function(t){delete e.nameIdentifiedMerges[t]})),i},e.prototype.applyMatchingFilterByExpr=function(e,t,r,i,a){if(_.isEmpty(e)||_.isEmpty(e.exprIdentifiedMerges))return!1;for(var o,s,l=!1,u=!1,c=e.exprIdentifiedMerges.slice(),p=function(){var p=s.howCreated;if(2===p)return c.splice(0,1),"continue";var d=_.remove(c,(function(e){return e===s||e.howCreated===p&&E.equals(e.expression,s.expression)})),h=[];if((t.filters||[]).forEach((function(e,t){e.howCreated!==p||_.includes(i,e)||e.isLinkedAsAggregation||!E.equals(e.expression,s.expression)||h.push(t)})),_.isEmpty(h)&&r&&0===p)if(s.filter){u||(u=!0,o=F.getAutoVisualFilterContainers(t,f.visualPluginOps,f.filterGenerator,a,f.aggrOps));var v=_.find(o,(function(e){return E.equals(e.expression,s.expression)}));v&&((t.filters||(t.filters=[])).push(v),h.push(t.filters.length-1))}else _.remove(e.exprIdentifiedMerges,s),_.remove(d,s);if(h.length>0){for(var m=Math.min(d.length,h.length);d.length>m;){var g=_.findIndex(d,(function(e){return _.isEmpty(e.filter)}));if(g===-1)break;d.splice(g,1)}for(var y=0;y<m;y++){var C=h[y];S.isSameFilter(t.filters[C].filter,d[y].filter)||(t.filters[C].filter=d[y].filter,t.filters[C].type=d[y].type,t.filters[C].cachedValueItems=d[y].cachedValueItems,l=!0),i.push(t.filters[C])}for(var y=m;y<d.length;y++){var x=n(d[y]);(t.filters||(t.filters=[])).push(x),i.push(x),l=!0}for(var y=m;y<h.length;y++){var C=h[y];t.filters[C].filter=void 0,t.filters[C].cachedValueItems=void 0,l=!0}e.exprIdentifiedMerges=_.difference(e.exprIdentifiedMerges,d)}},f=this;s=_.head(c);)p();return l},e.prototype.applyDrillFilters=function(e,t,r,i){var a=!1;if(_.isEmpty(i)||_.isEmpty(e)||_.isEmpty(e.exprIdentifiedMerges))return a;for(var o=[],s=function(e){if(2!==e.howCreated)return"continue";if(!_.find(i,(function(t){return E.equals(e.expression,t)})))return"continue";var s=_.find(t.filters,(function(t){return 2===t.howCreated&&!_.includes(r,t)&&E.equals(t.expression,e.expression)}));if(s)S.isSameFilter(s.filter,e.filter)||(s.filter=e.filter,s.cachedValueItems=e.cachedValueItems,a=!0),r.push(s);else{var l=n(e);(t.filters||(t.filters=[])).push(l),r.push(l),a=!0}o.push(e)},l=0,u=e.exprIdentifiedMerges;l<u.length;l++){s(u[l])}return e.exprIdentifiedMerges=_.difference(e.exprIdentifiedMerges,o),a},e.prototype.applyMatchingFilterByType=function(e,t,r){var i=!1;if(_.isEmpty(e)||_.isEmpty(e.typeIdentifiedMerges))return i;for(var a=[],o=function(e){var o=_.find(t.filters,(function(t){return t.howCreated===e.howCreated&&!_.includes(r,t)}));if(o)o.filter=e.filter,o.cachedValueItems=e.cachedValueItems,r.push(o);else{var s=n(e);(t.filters||(t.filters=[])).push(s),r.push(s)}a.push(e),i=!0},s=0,l=e.typeIdentifiedMerges;s<l.length;s++){o(l[s])}return e.typeIdentifiedMerges=_.difference(e.typeIdentifiedMerges,a),i},e.prototype.applyTransientFilters=function(e,t,r){var i=!1;if(!_.isEmpty(e)&&!_.isEmpty(e.transientFilters)){for(var a=function(e){var a=_.find(t.filters,(function(t){return t.isTransient&&!_.includes(r,t)&&S.isSameFilter(t.filter,e.filter)}));if(a)a.filter=e.filter,a.cachedValueItems=e.cachedValueItems,r.push(a);else{var o=n(e);(t.filters||(t.filters=[])).push(o),r.push(o)}i=!0},o=0,s=e.transientFilters;o<s.length;o++){a(s[o])}e.transientFilters=[]}var l=_.remove(t.filters,(function(e){return e.isTransient&&!_.includes(r,e)}));return i=i||!_.isEmpty(l)},e.prototype.applySection=function(e,t,r,i,n,a){var o;n.suppressData||n.targetVisualNames||this.applyFilters(e.filters,t,1,i,n.clearUnmatchedData,[],t,r);for(var s=0,l=t.visualContainers;s<l.length;s++){var u=l[s],c=u.name;if(!n.targetVisualNames||_.includes(n.targetVisualNames,c)){var p=e.visualContainers&&e.visualContainers[c],f=void 0;if(null!=p)f=this.applyVisualState(p,t,u,r,i,n,a),p.highlight&&!n.suppressData&&a&&this.isSelectionValid(p.highlight.selection,u.config.singleVisual,r)&&(null==i.pendingHighlights&&(i.pendingHighlights=[]),i.pendingHighlights.push({selection:p.highlight.selection,sourceVisualContainer:u,filterExpressionMetadata:p.highlight.filterExpressionMetadata}));else if(n.clearUnmatchedData){var d={};f=this.applyVisualState(d,t,u,r,i,n,a)}if(!_.isEmpty(f)){var h=_.without.apply(_,[f].concat(i.visualContainers));(o=i.visualContainers).push.apply(o,h)}}}},e.prototype.applyVisualState=function(e,t,r,i,n,a,o){var s=!1,l=e.singleVisual;if(!a.suppressData){var u=this.plugins.capabilities(r.config.singleVisual.visualType),c=l&&l.objects;u&&u.objects&&(s=this.applyObjects(r.config.singleVisual,c,u.objects,i,n)||s);var p=l&&l.orderBy;s=this.applySort(r.config.singleVisual,p,a.clearUnmatchedData)||s;var f=l&&l.activeProjections;s=this.applyActiveProjections(r.config.singleVisual,f,a.clearUnmatchedData)||s;var d=this.collectValidDrillExprs(r.config.singleVisual);l&&(s=this.applyCachedFilterDisplayItems(e.singleVisual,r.config.singleVisual)||s),s=this.applyFilters(e.filters,r,0,n,a.clearUnmatchedData,d,t,i)||s;var h=l&&l.expansionStates;s=this.applyExpansionStates(r,h,a.clearUnmatchedData)||s}var v=[];if(this.isDisplayOptions(a.suppressDisplay)&&!a.suppressDisplay.visuals||!a.suppressDisplay){var m=e.visibility;null!=m&&o&&(n.visibility={visual:r,mode:m});var g=l&&l.hidden;v.push.apply(v,this.applyHidden(!!g,r,t))}return s&&!_.includes(v,r)&&v.push(r),v},e.prototype.applyCachedFilterDisplayItems=function(e,t){if(!t.cachedFilterDisplayItems&&!e.cachedFilterDisplayItems)return!1;if(!t.cachedFilterDisplayItems&&e.cachedFilterDisplayItems||t.cachedFilterDisplayItems&&!e.cachedFilterDisplayItems)return t.cachedFilterDisplayItems=e.cachedFilterDisplayItems,!0;if(t.cachedFilterDisplayItems.length!==e.cachedFilterDisplayItems.length)return t.cachedFilterDisplayItems=e.cachedFilterDisplayItems,!0;for(var r=function(r){if(!_.find(t.cachedFilterDisplayItems,(function(e){return e.displayName===r.displayName&&powerbi.DataViewScopeIdentity.equals(r.identity,e.identity)})))return t.cachedFilterDisplayItems=e.cachedFilterDisplayItems,{value:!0}},i=0,n=e.cachedFilterDisplayItems;i<n.length;i++){var a=n[i],o=r(a);if("object"==typeof o)return o.value}return!1},e.prototype.applyHidden=function(e,t,r){var i=t.config.singleVisual;if(e!==w.isHidden(i)){w.setHidden(i,e);var n=[t];return e&&(n.push.apply(n,this.filterGenerator.clearCrossHighlightForVisualContainersOperation(r,[t])),n=_.uniq(n)),n}},e.prototype.collectValidDrillExprs=function(e){var t=e.query;if(!t)return[];var r=t.defn.select();if(_.isEmpty(r))return[];var i=[];for(var n in t.projections)for(var a=t.projections[n],o=a.activeProjectionRefs||[],s=0;s<o.length-1;s++){var l=o[s],u=r.withName(l);i.push(u.expr)}return i},e.prototype.applyActiveProjections=function(e,t,r){var i=e.query;if(!i)return!1;var n=i.defn.select(),a=this.plugins.capabilities(e.visualType),o=a&&a.drilldown&&a.drilldown.roles||[],s=!1,l={},u=function(e){if(!_.includes(o,e))return"continue";var r=t[e];l[e]||(l[e]=[]);var a=i.projections[e];if(!a)return s=!0,"continue";var u=a.all();if(_.isEmpty(u))return s=!0,"continue";if(r.length>u.length)return s=!0,"continue";if(1===r.length){var c=r[0],p=_.find(u,(function(e){var t=n.withName(e.queryRef);return E.equals(t.expr,c)}));if(!p)return s=!0,"continue";l[e].push(p.queryRef)}else for(var f=0;f<r.length;f++){var d=r[f],h=u[f],v=n.withName(h.queryRef);E.equals(v.expr,d)?l[e].push(h.queryRef):s=!0}};for(var c in t)u(c);if(s)for(var c in i.projections)l[c]=[];var p=!1;for(var c in i.projections)if(_.includes(o,c)){var f=i.projections[c],d=l[c];if(_.isEmpty(d)){if(!r)continue;var h=f.all();_.isEmpty(h)||(d=[_.head(h).queryRef])}v.sequenceEqual(f.activeProjectionRefs,d,(function(e,t){return e===t}))||(f.activeProjectionRefs=d,p=!0)}return p},e.prototype.applySort=function(e,t,r){var i=e.query;if(!i)return!1;var n=i.defn.orderBy()||[];return!(!t&&!r)&&(t=t||[],!v.sequenceEqual(n,t,f.SQUtils.sqSortDefinitionEquals)&&(i.orderBy(t),!0))},e.prototype.applyObjects=function(e,t,r,i,n){var a={};t&&(t.merge&&(a.merge=m.clone(t.merge)),t.remove&&(a.remove=t.remove.slice()));var o,s=e.objects||{},l=g.findFilterOutput(r),u=this.plugins.getPlugin(e.visualType);this.applyPluginUpdateSemantics(u,a,s,r),a.remove||(a.remove=this.getVisualPropertiesToRemove(e.visualType,s,a.merge));var c=this.mergeObjects(e,a.merge,s,n,i,l);return o=o||c.visualImpacted,a.remove=a.remove.concat(c.removeList),o=this.removeObjects(s,a.remove,n,l)||o},e.prototype.applyExpansionStates=function(e,t,r){var i=this,n=e.config.singleVisual,a=n.query;if(!a)return!1;var o=a.expansionStates||[];return!(!t&&!r)&&(t=t||[],!f.ExpansionState.areEqual(o,t)&&(a.expansionStates=f.ExpansionState.clone(_.filter(t,(function(t){var r=a.projections[t.roles[0]],n=r&&r.all()||[];return!(!i.expandCollapse.isEnabled(e,t.roles)||1!==t.roles.length||n.length<t.levels.length)&&_.every(t.levels,(function(e,t){return n[t].queryRef===e.queryRefs[0]}))}))),!0))},e.prototype.applyPluginUpdateSemantics=function(e,t,r,i){if(t&&e&&e.mergeObjects){var n=f.createStaticEvalContext(powerbi.visuals.visualStyles.create()),a=C.evaluateMetadataOnceDataViewObjectDefinitions(r,i,n),o=C.evaluateMetadataOnceDataViewObjectDefinitions(t.merge||{},i,n),s=e.mergeObjects({objects:a,changes:o});if(s){if(s.merge){t.merge={};for(var l=0,u=s.merge;l<u.length;l++){var c=u[l];for(var p in c.properties){var d=e.capabilities.objects[c.objectName].properties[p].type,h=m.encodePropertyValue(c.properties[p],d);m.setValue(t.merge,{objectName:c.objectName,propertyName:p},c.selector,h)}}}if(s.remove){t.remove=[];for(var v=0,g=s.remove;v<g.length;v++){var c=g[v];for(var p in c.properties)t.remove.push({object:c.objectName,property:p,selector:c.selector})}}}}},e.prototype.mergeObjects=function(e,t,r,i,n,a){var o={visualImpacted:!1,removeList:[]};if(_.isEmpty(t))return o;for(var s in t)for(var l=0,u=t[s];l<u.length;l++){var c=u[l],p=m.ensure(r,s,c.selector);for(var f in c.properties){var d=c.properties[f];if(!m.propertiesAreEqual(p.properties[f],d)){if(a&&y.propertyIdentifiersEqual(a,{objectName:s,propertyName:f})){if(!this.isFilterValid(d,e,n)){o.removeList.push({object:a.objectName,property:a.propertyName,selector:null});continue}this.setMinimumFilterScope(i,1)}p.properties[f]=d,o.visualImpacted=!0,e.objects||(e.objects=r)}}}return o},e.prototype.removeObjects=function(e,t,r,i){if(_.isEmpty(t))return!1;for(var n=!1,a=0,o=t;a<o.length;a++){var s=o[a],l=s.selector,u=s.object,c=s.property;m.deleteProperty(e,u,l,c)&&(n=!0,i&&y.propertyIdentifiersEqual(i,{objectName:u,propertyName:c})&&this.setMinimumFilterScope(r,1))}return n},e.prototype.getVisualPropertiesToRemove=function(e,t,r){var i=this.plugins.capabilities(e),n=null;if(!i||!i.objects)return[];var a=g.findFilterOutput(i.objects),o=[];for(var s in i.objects){var l=i.objects[s];for(var u in l.properties){if(l.properties[u].filterState||a&&y.propertyIdentifiersEqual(a,{objectName:s,propertyName:u})){var c={objectName:s,propertyName:u},p=m.getValue(r,c,n);m.getValue(t,c,n)&&!p&&o.push({object:s,property:u,selector:n})}}}return o},e.prototype.isFilterValid=function(e,t,r){var i=t.query;if(!i)return!1;var n=new P(i.defn,r);return e.rewrite(n),n.valid},e.prototype.isSelectionValid=function(e,t,r){var i=f.Selector.filterFromSelectorsByColumn(e);return i=new S(new f.SemanticQueryRewriter(f.SQExprRemoveEntityVariablesRewriter.instance).rewriteFrom(i.from()),_.map(i.where(),(function(e){return{condition:e.condition.accept(f.SQExprRemoveEntityVariablesRewriter.instance)}}))),this.isFilterValid(i,t,r)},e.prototype.setMinimumFilterScope=function(e,t){return e.filterScope?void(e.filterScope=Math.max(t,e.filterScope)):void(e.filterScope=t)},e.prototype.getAdditionalVisualFiltersToCapture=function(e,t){for(var r=[],i=F.getAutoVisualFilterContainers(e,this.visualPluginOps,this.filterGenerator,t,this.aggrOps)||[],n=function(t){_.find(e.filters,(function(e){return E.equals(e.expression,t.expression)}))||r.push(t)},a=0,o=i;a<o.length;a++){n(o[a])}return r},e})(),P=(function(e){function t(t,r){var i=this;return i=e.call(this)||this,i.valid=!0,i.query=t,i.schema=r,i}return __extends(t,e),t.prototype.visitColumnRef=function(e){return this.valid=this.valid&&this.exprInSelects(e),e},t.prototype.exprInSelects=function(e){var t=_.some(this.query.select(),(function(t){return E.equals(t.expr,e,!0,!0)}));if(t)return!0;if(!this.schema)return t;for(var r=this.query.select(),i=0,n=r;i<n.length;i++){var a=n[i],o=a.expr.getKeyColumns(this.schema);if(_.some(o,(function(t){return E.equals(e,t,!0,!0);
})))return!0}return!1},t})(f.SQExprRewriter);return{create:t,convertToFilterContainerState:i}})),define("Explore/services/explorationStateDiffer",["require","exports"],(function(e,t){function r(e,t){var r=t.activeSection!==e.activeSection,a={activeSection:r?t.activeSection:void 0},o=n(e.sections,t.sections);_.isEmpty(o)||(a.sections=o);var l=s(e.filters,t.filters);_.isEmpty(l)||(a.filters=l);var u=i(e.objects,t.objects);if(_.isEmpty(u)||(a.objects=u),!(_.isEmpty(o)&&_.isEmpty(l)&&_.isEmpty(u))||r)return a}function i(e,t){var r={};e=e||{merge:{}},t=t||{merge:{}};for(var i in t.merge)for(var n=0,a=t.merge[i];n<a.length;n++){var o=a[n],s=d.clone(e.merge),l=d.ensure(s,i,o.selector);for(var u in o.properties){var c=o.properties[u];d.propertiesAreEqual(l.properties[u],c)||(r.merge=r.merge||{},d.setValue(r.merge,{objectName:i,propertyName:u},null,c))}}return r}function n(e,t){if(e&&t){var r={};for(var i in t){var n=t[i],o=e[i];if(o){var s=a(o,n);s&&(r[i]=s)}}return r}}function a(e,t){var r={},i=o(e.visualContainers,t.visualContainers);_.isEmpty(i)||(r.visualContainers=i);var n=s(e.filters,t.filters);if(_.isEmpty(n)||(r.filters=n),!_.isEmpty(i)||!_.isEmpty(n))return r}function o(e,t){if(e&&t){var r={};for(var i in t){var n={},a=t[i],o=e[i];if(o){var l=s(o.filters,a.filters);_.isEmpty(l)||(n.filters=l),o.highlight!==a.highlight&&(n.highlight=a.highlight),o.visibility!==a.visibility&&(n.visibility=a.visibility);var u=h.serializeSingleVisual(o.singleVisual,n.visibility),c=h.serializeSingleVisual(a.singleVisual,n.visibility);m.equals(u,c)||(n.singleVisual=a.singleVisual),_.isEmpty(n)||(r[i]=n)}}return r}}function s(e,t){if(!e)return t;t=t||{};var r={},i=l(e.nameIdentifiedMerges,t.nameIdentifiedMerges);_.isEmpty(i)||(r.nameIdentifiedMerges=i);var n=function(e,t){return g.equals(t.expression,e.expression)},a=u(e.exprIdentifiedMerges,t.exprIdentifiedMerges,n);_.isEmpty(a)||(r.exprIdentifiedMerges=a);var o=function(e,t){return t.type===e.type},s=u(e.typeIdentifiedMerges,t.typeIdentifiedMerges,o);return _.isEmpty(s)||(r.typeIdentifiedMerges=s),r}function l(e,t){if(_.isEmpty(e))return t;var r={},i=_.clone(t||{});for(var n in e){var a=e[n],o=i[n];if(delete i[n],o){var s=c(a,o);if(!s)continue;r[n]=s}else{var l=p(a);if(!l)continue;r[n]=l}}return r}function u(e,t,r){if(_.isEmpty(e))return t;t=t||[];for(var i=[],n=t.slice(),a=function(e){var t=_.findIndex(n,(function(t){return r(e,t)})),a=n[t];if(_.pullAt(n,t),a){var o=c(e,a);if(!o)return"continue";i.push(o)}else{var s=p(e);if(!s)return"continue";i.push(s)}},o=0,s=e;o<s.length;o++){a(s[o])}return i}function c(e,t){return e&&m.equals(e,t)?void 0:t}function p(e){if(e&&e.type!==v.Passthrough)return{name:e.name,type:e.type,expression:e.expression,howCreated:e.howCreated}}Object.defineProperty(t,"__esModule",{value:!0});var f=powerbi.explore.contracts,d=powerbi.data.DataViewObjectDefinitions,h=powerbi.explore.services.ExplorationState,v=f.FilterType,m=jsCommon.JsonComparer,g=powerbi.data.SQExpr;t.diff=r}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){function r(e){return new n(e)}var i=e.data.DataViewObjectDescriptors;t.createFilterCapabilitiesService=r;var n=(function(){function e(e){this.visualPlugins=e}return e.prototype.hasFilterCapabilities=function(e){var t=this.visualPlugins.getPlugin(e);return!!(t&&t.capabilities&&t.capabilities.objects&&i.findFilterOutput(t.capabilities.objects))},e})()})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(r){var i=e.data.SQExprBuilder,n=jsCommon.StringExtensions,a=e.visuals.valueFormatter,o=(function(){function o(e,t,i,n,a,o,s,l,u){this.schema=e,this.locOptions=t,this.aggrOps=i,this.visualCapabilities=n,this.displayOptions=a,this.filterData=o,this.isQualified=s,this.visualConfig=l,this.featureSwitches=u,this.displayNameService=r.createDisplayNameService(this.locOptions,this.aggrOps,this.featureSwitches)}return o.prototype.visitIn=function(a){var o=this,s=a.args;if(s.length>1||this.filterData.type===t.contracts.FilterType.Include||this.filterData.type===t.contracts.FilterType.Exclude){var l=this.formatMultiColumnBasic(a),u=this.getDisplayNameForMultiColumn(a.not,l.length);return{fieldName:u,restatements:l,fieldNameToolTip:u}}var c,p,f;if(this.filterData&&this.filterData.filterExpressionMetadata&&!_.isEmpty(this.filterData.filterExpressionMetadata.cachedValueItems)){var d=this.filterData.filterExpressionMetadata.expressions[0],h=this.visualConfig&&this.visualConfig.query&&this.visualConfig.query.defn.selectNameOf(d);p=this.displayNameService.getDisplayName(d,this.schema,this.visualCapabilities,h,this.visualConfig&&this.visualConfig.columnProperties),f=this.displayNameService.getQualifiedDisplayName(d,this.schema,this.visualCapabilities),c=[];for(var v=0,m=this.filterData.filterExpressionMetadata.cachedValueItems;v<m.length;v++){var g=m[v];c.push(g.valueMap[0])}}else p=this.getFieldName(s[0]),f=this.getQualifiedFieldName(s[0]),c=_.map(a.values,(function(t){return _.map(t,(function(t,r){var n=i.fieldExpr(s[r]),a=n&&n.getMetadata(o.schema);return e.visuals.valueFormatter.format(t.value,a&&a.format)})).join(" ")}));var y;return y=c&&c.length>2?r.concatStrings(c,"FilterRestatement_CompoundOrForMoreThanTwo",this.locOptions):r.concatStrings(c,"FilterRestatement_CompoundOr",this.locOptions),y=a.not?n.format(e.common.localize.get("FilterRestatement_NotEqual"),y):n.format(e.common.localize.get("FilterRestatement_Equal"),y),{fieldName:p,restatements:[y],fieldNameToolTip:f}},o.prototype.visitComposite=function(e){for(var t=[],r=0,i=e.filters;r<i.length;r++){var n=i[r];n.in?t.push.apply(t,this.formatMultiColumnBasic(n.in)):n.compareOperator?t.push.apply(t,this.visitCompare(n.compareOperator).restatements):n.advancedOperator?t.push.apply(t,this.visitAdvanced(n.advancedOperator).restatements):t.push.apply(t,this.visitComposite(n.composite).restatements)}var a=this.getDisplayNameForMultiColumn(e.not,t.length);return this.filterData&&this.filterData.filterExpressionMetadata,{fieldName:a,restatements:t,fieldNameToolTip:a}},o.prototype.formatMultiColumnBasic=function(r){var a,o=this,s=e.common.localize.get("MultiColumn_Join_Separator"),l=e.common.localize.get("NamePattern_Bracket"),u=[],c=r.args,p=_.map(c,(function(e){return i.fieldExpr(e)})),f=_.map(p,(function(e){return p&&e.getMetadata(o.schema)}));a=_.map(c,(function(e){return o.getFieldName(e)}));for(var d=function(r){var i=_.map(r,(function(t,r){var i=f[r];return e.visuals.valueFormatter.format(t.value,i&&i.format)})),c=a;if(h.filterData&&h.filterData.filterExpressionMetadata){var d=t.FilterUtils.findValuesInFilterCache(p,r,h.filterData.filterExpressionMetadata);d&&(c=_.map(d.columns,(function(e){return o.getFieldName(e)})),i=d.values)}var v=_.map(i,(function(e,t){return n.format(l,e,c[t])})).join(s);u.push(v)},h=this,v=0,m=r.values;v<m.length;v++){d(m[v])}return u},o.prototype.getDisplayNameForMultiColumn=function(e,t){var r;return r=e?this.locOptions.stringResourceProvider.get("FilterPane_Exclude"):this.locOptions.stringResourceProvider.get("Include_Label"),n.format(this.locOptions.stringResourceProvider.get("NamePattern_Bracket"),r,String(t))},o.prototype.visitBetween=function(e){return{fieldName:this.getFieldName(e.arg),restatements:[r.filterRestatementUtil.visitBetweenHelper(e)],fieldNameToolTip:this.getQualifiedFieldName(e.arg)}},o.prototype.visitRelativeDateRange=function(e){return{fieldName:this.getFieldName(e.arg),restatements:[r.filterRestatementUtil.visitRelativeDateRangeHelper(e)],fieldNameToolTip:this.getQualifiedFieldName(e.arg)}},o.prototype.visitTopN=function(e){if(null!=e.itemCount){var t,r=a.format(e.itemCount,"#,###"),i=e.orderByField,o=e.isTop;if(i){var s=e.orderByField,l=this.getFieldName(s),u=this.locOptions.stringResourceProvider.get(o?"FilterRestatement_TopNBy":"FilterRestatement_BottomNBy");t=n.format(u,r,l)}else{var u=this.locOptions.stringResourceProvider.get(o?"FilterRestatement_TopN":"FilterRestatement_BottomN");t=n.format(u,r)}return{fieldName:this.getFieldName(e.fieldBeingFiltered),restatements:[t],fieldNameToolTip:this.getQualifiedFieldName(e.fieldBeingFiltered)}}},o.prototype.visitCompare=function(e){return{fieldName:this.getFieldName(e.arg),restatements:[r.filterRestatementUtil.visitComparisonFilterPatternHelper(e,this.schema)],fieldNameToolTip:this.getQualifiedFieldName(e.arg)}},o.prototype.visitAdvanced=function(e){var t=this.getFieldName(e.left.arg);return{fieldName:t,restatements:[r.filterRestatementUtil.visitAdvancedFilterPatternHelper(e,this.schema)],fieldNameToolTip:this.getQualifiedFieldName(e.left.arg)}},o.prototype.visitComplex=function(e){var t=this,i=r.concatStrings(_.map(e.args,(function(e){return t.getFieldName(e)})),"AndConjunction",this.locOptions);return{fieldName:i,restatements:[this.locOptions.stringResourceProvider.get("FilterRestatement_Complex")],fieldNameToolTip:i}},o.prototype.getFieldName=function(e){var t=i.fieldExpr(e),r=this.visualConfig&&this.visualConfig.query&&this.visualConfig.query.defn.selectNameOf(t);return this.displayNameService.getDisplayName(t,this.schema,this.visualCapabilities,r,this.visualConfig&&this.visualConfig.columnProperties)},o.prototype.getQualifiedFieldName=function(e){var t=i.fieldExpr(e);this.visualConfig&&this.visualConfig.query&&this.visualConfig.query.defn.selectNameOf(t);return this.displayNameService.getQualifiedDisplayName(t,this.schema,this.visualCapabilities)},o})();r.FilterOverlayRestatementVisitor=o})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(r){var i;!(function(r){function i(e){var t=e.lower.value,r=e.upper.value,i={min:t,max:r};return l.getDateRangeRestatement(i)}function n(e){return l.getRestatement(e.options)}function a(r,i){var n=u.fieldExpr(r.arg),a=t.FilterUtils.getFormatter(n,i);if(r.condition.defaultValue)return e.data.RestatementHelper.fromDefault(a.format(r.condition.defaultValue.value));if(r.condition.anyValue)return"Any";var o=s(r.condition);return e.data.RestatementHelper.fromCondition([new e.data.Condition(r.filterOperator,o,a)],2)}function o(r,i){var n=u.fieldExpr(r.left.arg),a=u.fieldExpr(r.right.arg),o=t.FilterUtils.getFormatter(n,i),l=t.FilterUtils.getFormatter(a,i),c=[new e.data.Condition(r.left.filterOperator,s(r.left.condition),o),new e.data.Condition(r.right.filterOperator,s(r.right.condition),l)];return e.data.RestatementHelper.fromCondition(c,r.logicalOperator)}function s(e){return e.constant?e.constant.value:e.dateSpan?e.dateSpan.value:void 0}var l=e.data.RelativeDateRangeHelper,u=e.data.SQExprBuilder;r.visitBetweenHelper=i,r.visitRelativeDateRangeHelper=n,r.visitComparisonFilterPatternHelper=a,r.visitAdvancedFilterPatternHelper=o})(i=r.filterRestatementUtil||(r.filterRestatementUtil={}))})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){var r=e.data.FieldExprPattern,i=e.data.SQExprBuilder,n=jsCommon.StringExtensions,a=(function(){function a(e,r,i,n,a,o){this.schema=e,this.locOptions=r,this.aggrOps=i,this.visualCapabilities=n,this.displayOptions=a,this.isQualified=o,this.displayNameServiceVisitor=this.isQualified?new t.QualifiedDisplayNameVisitor(this.schema,this.locOptions,this.aggrOps,this.visualCapabilities,this.displayOptions):new t.DisplayNameServiceVisitor(this.schema,this.locOptions,this.aggrOps,this.visualCapabilities,this.displayOptions)}return a.prototype.visitIn=function(a){var o=this,s=a.args,l=a.values,u=_.map(l,(function(t){return _.map(t,(function(t,r){var n=i.fieldExpr(s[r]),a=n&&n.getMetadata(o.schema);return e.visuals.valueFormatter.format(t.value,a&&a.format)})).join(" ")})),c=t.concatStrings(u,"FilterRestatement_CompoundOr",this.locOptions);if(this.displayOptions&&this.displayOptions.includeFieldNamesInFilter){var p=a.args,f=_.map(p,(function(e){return r.visit(e,o.displayNameServiceVisitor)})).join(" ");return n.format(this.locOptions.stringResourceProvider.get("VisualTitle_Is_Template"),f,c)}return c},a.prototype.visitBetween=function(e){return t.filterRestatementUtil.visitBetweenHelper(e)},a.prototype.visitRelativeDateRange=function(e){return t.filterRestatementUtil.visitRelativeDateRangeHelper(e)},a.prototype.visitTopN=function(e){},a.prototype.visitCompare=function(e){return t.filterRestatementUtil.visitComparisonFilterPatternHelper(e,this.schema)},a.prototype.visitAdvanced=function(e){return t.filterRestatementUtil.visitAdvancedFilterPatternHelper(e,this.schema)},a.prototype.visitComplex=function(e){},a})();t.FilterRestatementVisitor=a})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(r){function i(e,t,r,i){return new s(e,t,r,i)}function n(e){switch(e){case 1:return"Maximized";case 2:return"MaximizedWithData";case 8:return"MaximizedWithAccessibleData";case 4:return"Spotlight";default:return"Normal"}}function a(e,t){return e=e||null,t=t||null,e===t||!e==!t&&(e.visualContainer===t.visualContainer&&e.visibility===t.visibility)}var o=t.util.VisualContainerUtils;r.createVisibilityService=i;var s=(function(){function t(e,t,i,n){var a=this;this.telemetryService=e,this.eventBridge=t,this.selectionService=i,this.explorationNavigation=n,this.eventBridge=t,this.selectionService=i,t.createChannelSubscriptionManager().subscribe(r.events.selectionChanged,(function(){return a.updatePopOutMode()}))}return t.prototype.get=function(e){var t=this.explorationNavigation.getCurrentSection(),r=t&&t.poppedOutElement;if(r)return e||(e=11),e&r.visibility?r.visualContainer:void 0},t.prototype.set=function(e,t,i){if(void 0===i&&(i=!0),0===t)return void this.clearInternal(!0,i);r.selectionUtils.selectVisualContainer(e,this.selectionService);var n={visualContainer:e,visibility:t},o=this.explorationNavigation.getCurrentSection();if(o){a(n,o&&o.poppedOutElement)||(this.clearInternal(!1,!1),this.setMode(n,t,i),o.poppedOutElement=n,this.raiseEvent())}},t.prototype.clear=function(){this.clearInternal()},t.prototype.clearForVisualContainers=function(e){var t=this.explorationNavigation.getCurrentSection(),r=t&&t.poppedOutElement;if(r)for(var i=0,n=e;i<n.length;i++){var a=n[i];if(r.visualContainer===a){this.clearInternal();break}}},t.prototype.clearInternal=function(e,t){void 0===e&&(e=!0),void 0===t&&(t=!0);var r=this.explorationNavigation.getCurrentSection(),i=r&&r.poppedOutElement;i&&(this.setMode(i,0,t),r.poppedOutElement=void 0,e&&this.raiseEvent())},t.prototype.isSeeDataMode=function(e){return e&&(2===e||8===e)},t.prototype.updatePopOutMode=function(){var e=r.selectionUtils.getDefaultSelectedVisualInSingleOrMultiCase(this.selectionService);e&&null!=e.visibility&&0!==e.visibility?this.set(e,e.visibility,!1):this.clearInternal(!0,!1)},t.prototype.raiseEvent=function(){this.eventBridge.publishToChannel(r.events.visibilityChanged)},t.prototype.setMode=function(t,r,i){var a=t.visualContainer;if(i){var s=n(r);this.telemetryService.logEvent(e.telemetry.EXToggleVisualDisplay,o.getVisualType(a),s)}a.visibility=r},t})()})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(r){function i(e){return new o(e)}var n=e.data.DataViewObjectDescriptors,a=t.util.VisualContainerUtils;r.createVisualPluginOps=i;var o=(function(){function t(e){this.plugins=e}return t.prototype.canEdit=function(t,r){var i=this.plugins.capabilities(t);switch(i&&i.advancedEditModeSupport){case 1:return!0;case 2:return r;default:return t===e.visualHost.EsriVisual||t===e.visualHost.SandDanceVisual}},t.prototype.dataViewKinds=function(t,r){if(t){var i=this.plugins.capabilities(t);if(i){var n=i.dataViewMappings,o=e.DataViewMapping.targetDataViewKinds(n);if(r){var s=a.createRoleKindByQueryRef(r),l=e.DataViewAnalysis.chooseDataViewMappings(r.projections,n,s);o=e.DataViewMapping.targetDataViewKinds(l.supportedMappings),"map"===t&&1&o&&e.visuals.MapPluginMethods.mightRequireMatrixForUnpivot(r.projections,l.supportedMappings)&&(o|=2)}return o?o:void 0}}},t.prototype.targetedDataViewKinds=function(e,t,r){var i=31;return t.featureSwitches.dataViewTargeted&&!this.plugins.isCustomVisual(e)&&(i=this.dataViewKinds(e,r)||31),i},t.prototype.supportsFocusMode=function(e){var t=this.plugins.capabilities(e);return t&&t.dataViewMappings&&!t.disableFocusMode},t.prototype.isSupportedVisual=function(e){var t=a.getVisualType(e);return!!t&&!!this.plugins.getPlugin(t)},t.prototype.canConvertVisual=function(e){if(!e)return!1;var t=a.getVisualType(e);return!!t&&(this.isQueryVisual(t)&&!a.hasGroupByItemsInQuery(e))},t.prototype.canFormatVisual=function(e){return!!e&&!a.hasGroupByItemsInQuery(e)},t.prototype.isQueryVisual=function(e){var t=this.plugins.capabilities(e);return!t||!this.isQueryDisabled(e,t)&&null!=t.dataViewMappings},t.prototype.isQueryDisabled=function(t,r){return!!e.visualHost.utils.shouldDisableVisual(t,e.common.localize.shouldDisableMap())||(r&&e.ScriptResultUtil.findScriptResultMapping(r.dataViewMappings)?!this.plugins.isScriptVisualQueryable(t):void 0)},t.prototype.supportVisualSearch=function(e){var t=this.plugins.capabilities(e);return!(!t||!this.isQueryVisual(e))&&!!n.findSelfFilter(t.objects)},t.prototype.isAnalysisVisual=function(t){return t===e.visuals.plugins.keyDriversVisual.name},t})()})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){function r(e){return new n(e)}var i=e.explore.contracts.createDataSourceArray;t.createDataSourceSerializer=r;var n=(function(){function e(e){this.explorationSerializer=e}return e.prototype.deserializeDataSources=function(e){var t=this;if(e)return i(_.map(e,(function(e){return t.deserializeDataSource(e)})))},e.prototype.deserializeDataSource=function(e){if(e){var t={id:e.id,name:e.name};return e.type&&(t.type=e.type),e.packageId&&(t.packageId=e.packageId),e.extends&&(t.extends=e.extends),e.dsr&&(t.dsr=this.deserializeExecuteSemanticQueryDataSource(e.dsr)),e.exploration&&(t.exploration=this.deserializeExplorationDataReaderDataSource(e.exploration)),t}},e.prototype.deserializeExecuteSemanticQueryDataSource=function(e){if(e){var t={schemaName:e.schemaName};return e.vsName&&(t.vsName=e.vsName),e.dbName&&(t.dbName=e.dbName),e.modelId&&(t.modelId=e.modelId),t}},e.prototype.deserializeExplorationDataReaderDataSource=function(e){if(e){var t=this.explorationSerializer.deserializeModelExtensions(e.modelExtensions);return{extends:e.extends,schemaName:e.schemaName,getModelExtensions:function(){return t}}}},e.prototype.serializeDataSources=function(e){var t=this;if(e)return _.map(e,(function(e){return t.serializeDataSource(e)}))},e.prototype.serializeDataSource=function(e){if(e){var t={id:e.id,name:e.name};return e.type&&(t.type=e.type),e.packageId&&(t.packageId=e.packageId),e.extends&&(t.extends=e.extends),e.dsr&&(t.dsr=this.serializeExecuteSemanticQueryDataSource(e.dsr)),e.exploration&&(t.exploration=this.serializeExplorationDataReaderDataSource(e.exploration)),t}},e.prototype.serializeExecuteSemanticQueryDataSource=function(e){if(e){var t={schemaName:e.schemaName};return e.vsName&&(t.vsName=e.vsName),e.dbName&&(t.dbName=e.dbName),e.modelId&&(t.modelId=e.modelId),t}},e.prototype.serializeExplorationDataReaderDataSource=function(e){if(e)return{extends:e.extends,schemaName:e.schemaName,modelExtensions:this.explorationSerializer.serializeModelExtensions(e.getModelExtensions())}},e})();t.DataSourceSerializer=n})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){var r,i=e.data.services.DataViewObjectSerializer;!(function(e){function t(e){if(e&&!(e.length<1)){for(var t=[],r=0,n=e;r<n.length;r++){var a=n[r];if(a.identity&&a.identity.expr){var o=i.serializeScopeIdentity(a.identity);o&&t.push({id:o,displayName:a.displayName})}}return t}}function r(e){if(e&&!(e.length<1)){for(var t=[],r=0,n=e;r<n.length;r++){var a=n[r];if(a.id){var o=i.deserializeScopeIdentity(a.id);o&&t.push({identity:o,displayName:a.displayName})}}return t}}function n(e){if(e&&!(e.length<1)){for(var t=[],r=0,n=e;r<n.length;r++){var a=n[r];if(!_.isEmpty(a.identities)){var o=_.map(a.identities,(function(e){return i.serializeScopeIdentity(e)}));o&&t.push({identities:o,valueMap:a.valueMap})}}return t}}function a(e){if(e&&!(e.length<1)){for(var t=[],r=0,n=e;r<n.length;r++){var a=n[r];if(!_.isEmpty(a.identities)){var o=_.map(a.identities,(function(e){return i.deserializeScopeIdentity(e)}));o&&t.push({identities:o,valueMap:a.valueMap})}}return t}}e.serializeFilterLabelIdPairs=t,e.deserializeFilterLabelIdPairs=r,e.serializeIdentityValueMap=n,e.deserializeIdentityValueMap=a})(r=t.DisplayNameSerializer||(t.DisplayNameSerializer={}))})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){var r;!(function(r){function i(e,t){for(var r={},i=0,n=t.sections;i<n.length;i++)for(var a=n[i],o=0,s=a.visualContainers;o<s.length;o++){var l=s[o];r[l.name]=!0}for(var u in e.sections){var a=e.sections[u];for(var c in a.visualContainers)r[c]||delete a.visualContainers[c]}}function n(e){return c(x(e,null))}function a(e){var t={activeSection:e.activeSection,filters:o(e.filters),sections:_.mapValues(e.sections,l)};return e.objects&&(t.objects=f(e.objects)),t}function o(e){if(e){var t={};return e.byName&&(t.nameIdentifiedMerges=_.mapValues(e.byName,s)),e.byExpr&&(t.exprIdentifiedMerges=_.map(e.byExpr,s)),e.byType&&(t.typeIdentifiedMerges=_.map(e.byType,s)),e.byTransientState&&(t.transientFilters=_.map(e.byTransientState,s)),t}}function s(e){return{name:e.name,type:w.FilterType[e.type],filter:e.filter?R.deserializeFilter(e.filter):void 0,expression:e.expression?R.deserializeExpr(e.expression):void 0,restatement:e.restatement,howCreated:e.howCreated,precedence:e.precedence,isTransient:e.isTransient,cachedValueItems:t.DisplayNameSerializer.deserializeFilterLabelIdPairs(e.cachedDisplayNames)}}function l(e){return{filters:o(e.filters),visualContainers:_.mapValues(e.visualContainers,u)}}function u(e){var t=c(e.singleVisual);return{filters:o(e.filters),singleVisual:t,visibility:e.singleVisual?m(e.singleVisual.display):void 0,highlight:e.highlight?h(e.highlight):void 0}}function c(e){if(e){var r={visualType:e.visualType};return e.objects&&(r.objects=f(e.objects)),e.orderBy&&(r.orderBy=R.deserializeSortDefinitions(e.orderBy,null)),e.activeProjections&&(r.activeProjections=p(e.activeProjections)),e.display&&"hidden"===e.display.mode&&(r.hidden=!0),e.cachedFilterDisplayItems&&(r.cachedFilterDisplayItems=t.DisplayNameSerializer.deserializeFilterLabelIdPairs(e.cachedFilterDisplayItems)),e.expansionStates&&(r.expansionStates=F.deserializeExpansionStates(e.expansionStates)),r}}function p(e){var t;for(var r in e){var i=e[r];_.isEmpty(i)||(t||(t={}),t[r]=_.map(i,(function(e){return R.deserializeExpr(e)})))}return t}function f(e){var t={};return e.merge&&(t.merge=D.deserializeObjects(e.merge,null)),e.remove&&(t.remove=_.map(e.remove,d)),t}function d(e){return{object:e.object,property:e.property,selector:D.deserializeSelector(e.selector)}}function h(e){return{selection:_.map(e.selection,(function(e){return D.deserializeSelectorsByColumn(e)})),filterExpressionMetadata:e.filterExpressionMetadata?v(e.filterExpressionMetadata):void 0}}function v(e){return{expressions:e.expressions?_.map(e.expressions,(function(e){return R.deserializeExpr(e)})):void 0,cachedValueItems:e.cachedValueItems?t.DisplayNameSerializer.deserializeIdentityValueMap(e.cachedValueItems):void 0}}function m(e){if(e&&e.mode)switch(e.mode){case"maximize":switch(e.maximizedOptions&&e.maximizedOptions.dataTable){case"accessible":return 8;case"normal":return 2;default:return 1}case"spotlight":return 4}}function g(e){var t=new T,r={version:void 0,activeSection:e.activeSection,filters:t.serializeFilters(e.filters),sections:_.mapValues(e.sections,(function(e){return t.serializeSection(e)}))};return e.objects&&(r.objects=t.serializeObjects(e.objects),t.version=P.max(t.version,V.v1_3)),r.version=t.version,r}function y(e){return(new T).serializeFilterContainer(e)}function C(e){return(new T).serializeHighlightState(e)}function x(e,t){return(new T).serializeSingleVisual(e,t)}function b(e){switch(e){case 1:return{mode:"maximize"};case 2:return{mode:"maximize",maximizedOptions:{dataTable:"normal"}};case 8:return{mode:"maximize",maximizedOptions:{dataTable:"accessible"}};case 4:return{mode:"spotlight"}}}var S=e,E=S.explore,w=E.contracts,F=e.data.services.ExpansionStateSerializer,V=E.services.upgrade.ExplorationStateVersions,P=jsCommon.Version,D=S.data.services.DataViewObjectSerializer,R=S.data.services.SemanticQuerySerializer;r.clearUnusedReferences=i,r.cloneSingleVisual=n,r.deserialize=a,r.serialize=g,r.serializeFilterContainer=y,r.serializeHighlightState=C,r.serializeSingleVisual=x;var T=(function(){function e(){this.version=V.v1_0}return e.prototype.serializeFilters=function(e){var t=this;if(e){var r={};return e.nameIdentifiedMerges&&(r.byName=_.mapValues(e.nameIdentifiedMerges,(function(e){return t.serializeFilterContainer(e)}))),e.exprIdentifiedMerges&&(r.byExpr=_.map(e.exprIdentifiedMerges,(function(e){return t.serializeFilterContainer(e)}))),e.typeIdentifiedMerges&&(r.byType=_.map(e.typeIdentifiedMerges,(function(e){return t.serializeFilterContainer(e)}))),e.transientFilters&&(r.byTransientState=_.map(e.transientFilters,(function(e){return t.serializeFilterContainer(e)}))),r}},e.prototype.serializeFilterContainer=function(e){return{name:e.name,type:null!=e.type?w.FilterType[e.type]:void 0,filter:e.filter?R.serializeFilter(e.filter):void 0,expression:e.expression?R.serializeExpr(e.expression):void 0,restatement:e.restatement,howCreated:e.howCreated,isTransient:e.isTransient,cachedDisplayNames:t.DisplayNameSerializer.serializeFilterLabelIdPairs(e.cachedValueItems)}},e.prototype.serializeSection=function(e){var t=this;return _.chain(e.visualContainers).values().sumBy((function(e){return null==e.highlight?0:1})).value()>1&&(this.version=P.max(this.version,V.v1_2)),{filters:this.serializeFilters(e.filters),visualContainers:_.mapValues(e.visualContainers,(function(e){return t.serializeVisualContainer(e)}))}},e.prototype.serializeVisualContainer=function(e){return e.highlight&&(this.version=P.max(this.version,V.v1_1)),{filters:this.serializeFilters(e.filters),singleVisual:this.serializeSingleVisual(e.singleVisual,e.visibility),highlight:e.highlight?this.serializeHighlightState(e.highlight):void 0}},e.prototype.serializeSingleVisual=function(e,r){if(e){var i={visualType:e.visualType};return e.objects&&(i.objects=this.serializeObjects(e.objects)),e.orderBy&&(i.orderBy=R.serializeSortDefinitions(e.orderBy,!0)),e.activeProjections&&(i.activeProjections=this.serializeActiveProjections(e.activeProjections)),e.cachedFilterDisplayItems&&(i.cachedFilterDisplayItems=t.DisplayNameSerializer.serializeFilterLabelIdPairs(e.cachedFilterDisplayItems)),_.isEmpty(e.expansionStates)||(i.expansionStates=F.serializeExpansionStates(e.expansionStates)),e.hidden?i.display={mode:"hidden"}:r&&(i.display=b(r)),i}},e.prototype.serializeActiveProjections=function(e){var t;for(var r in e){var i=e[r];_.isEmpty(i)||(t||(t={}),t[r]=_.map(i,(function(e){return R.serializeExpr(e)})))}return t},e.prototype.serializeObjects=function(e){var t=this,r={};return e.merge&&(r.merge=D.serializeObjects(e.merge,null)),e.remove&&(r.remove=_.map(e.remove,(function(e){return t.serializeObjectPropSelector(e)}))),r},e.prototype.serializeObjectPropSelector=function(e){return{object:e.object,property:e.property,selector:D.serializeSelector(e.selector)||null}},e.prototype.serializeHighlightState=function(e){return e.filterExpressionMetadata&&(this.version=P.max(this.version,V.v1_3)),{selection:_.map(e.selection,(function(e){return D.serializeSelectorsByColumn(e)})),filterExpressionMetadata:e.filterExpressionMetadata?this.serializeFilterExpressionMetadata(e.filterExpressionMetadata):void 0}},e.prototype.serializeFilterExpressionMetadata=function(e){return{expressions:e.expressions?_.map(e.expressions,(function(e){return R.serializeExpr(e)})):void 0,cachedValueItems:e.cachedValueItems?t.DisplayNameSerializer.serializeIdentityValueMap(e.cachedValueItems):void 0}},e})()})(r=t.ExplorationState||(t.ExplorationState={}))})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(t){function r(t){var r=[],i={objectId:t.objectId,name:t.objectId,type:t.type};t.creationTime&&(i.creationTime=new Date(Date.parse(t.creationTime))),t.expirationTime&&(i.expirationTime=new Date(Date.parse(t.expirationTime))),t.displayName&&(i.displayName=t.displayName),t.isDefault&&(i.isDefault=t.isDefault),null!=t.id&&(i.id=t.id);try{var n=void 0;t.explorationState&&(n=jsCommon.JsonExtensions.tryParseJSON(t.explorationState),n||r.push({code:0})),n&&(i.explorationState=e.ExplorationState.deserialize(n))}catch(e){r.push({code:1,message:e.message,stack:e.stack})}var a={contract:i};return _.isEmpty(r)||(a.errors=r),a}function i(t){var r={objectId:t.objectId,type:t.type};if(t.creationTime&&(r.creationTime=t.creationTime.toISOString()),t.expirationTime&&(r.expirationTime=t.expirationTime.toISOString()),t.displayName&&(r.displayName=t.displayName),t.isDefault&&(r.isDefault=t.isDefault),null!=t.id&&(r.id=t.id),t.explorationState){var i=e.ExplorationState.serialize(t.explorationState);r.explorationState=JSON.stringify(i)}return r}t.deserialize=r,t.serialize=i})(t=e.WebBookmark||(e.WebBookmark={}))})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){var r;!(function(t){var r;!(function(r){function i(){return new o}var n=e.data.DataViewObjectDefinitions,a=e.visuals.plugins;r.createVersionUpgrader=i;var o=(function(){function e(){}return e.prototype.upgrade=function(e){if(e&&e.sections)for(var t=0,r=e.sections;t<r.length;t++){var i=r[t];if(i.visualContainers)for(var n=0,a=i.visualContainers;n<a.length;n++){var o=a[n],s=o.config.singleVisual;if(s){var l=s.visualType||s.visualConfig.visualType;s.objects=this.upgradeVisualObjects(s.objects,l)}}}},e.prototype.upgradeFilterCollection=function(e){},e.prototype.getVersion=function(){return t.ExplorationVersions.v3_12_1},e.prototype.upgradeVisualObjects=function(e,t){return t===a.slicer.name?this.upgradeSlicerObjects(e):e},e.prototype.upgradeSlicerObjects=function(e){var t="general",r="filter";e||(e={});var i=n.getObjectDefinition(e,t,null),a=i&&i.properties[r],o=a&&a.filter;if(o&&this.isAndFilter(o)){var s="data",l=n.getObjectDefinition(e,s,null);if(l){var u=l.properties.startDate,c=l.properties.endDate,p=l.properties.numericStart,f=l.properties.numericEnd;(u&&!c||p&&!f)&&this.BetweenToBeforeOrAfterFilter(o,1),(c&&!u||f&&!p)&&this.BetweenToBeforeOrAfterFilter(o,0)}}return e},e.prototype.isAndFilter=function(e){if(1===e.Where.length){var t=e.Where[0].Condition;if(t&&t.And)return!0}return!1},e.prototype.BetweenToBeforeOrAfterFilter=function(e,t){var r=e.Where[0].Condition;return 0===t?e.Where[0].Condition=r.And.Right:e.Where[0].Condition=r.And.Left,e},e})();r.VersionUpgrader=o})(r=t.v3_12_1||(t.v3_12_1={}))})(r=t.upgrade||(t.upgrade={}))})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){var r;!(function(t){var r;!(function(r){function i(e){return new C(e)}function n(e,t,r){var i=a(r),n=t&&!_.isEmpty(t[i]);if("scatterChart"===r&&n){null==h.getObjectDefinitionProperties(e,"fillPoint")&&(e||(e={}),e.fillPoint=[{properties:{show:{expr:g.serializeExpr(y.boolean(!0))}}}])}return e}function a(e){switch(e){case"filledMap":return"Size";case"barChart":case"clusteredBarChart":case"clusteredColumnChart":case"columnChart":case"funnel":case"hundredPercentStackedBarChart":case"hundredPercentStackedColumnChart":case"map":case"treemap":
case"scatterChart":return"Gradient"}}function o(e){switch(e){case"filledMap":case"barChart":case"clusteredBarChart":case"clusteredColumnChart":case"columnChart":case"funnel":case"hundredPercentStackedBarChart":case"hundredPercentStackedColumnChart":case"map":case"treemap":case"scatterChart":return"Tooltips"}}function s(e,t){return"filledMap"===e&&t&&!_.isEmpty(t.Series)&&!_.isEmpty(t.Size)}function l(t,r,i){var n=a(i);if(n){var l=r.getQueryRef(n,0);if(l){var u=r.defn.select().withName(l),c=t&&t.dataPoint;if(!_.isEmpty(c))for(var p=0,f=c;p<f.length;p++){var d=f[p],h=d.properties.fillRule;if(null==d.selector&&h){if(s(i,r.projections)||c.push({selector:{data:[v.create(1)]},properties:{fill:{solid:{color:e.data.SQExprBuilder.fillRule(u.expr,h)}}}}),c.splice(c.indexOf(d),1),1===r.getUsageCount(l)){var m=r.tryGetExpr(n,0),g=o(i);r.add(m,g)}r.removeProjection(n,0);break}}}}}function u(e,t,r,i){var n,l,u="fillRule",p=a(r);if(p){var f=t&&t[p];if(!_.isEmpty(f)){var h=f[0].queryRef;if(h){var v=_.cloneDeep(_.find(i&&i.Select,(function(e){return e.Name===h})));if(v){delete v.Name;var m=v.Aggregation||v.Measure;if(m){var g=m.Expression.Column&&m.Expression.Column.Expression.SourceRef||m.Expression.SourceRef;if(g){var y=_.find(i.From,(function(e){return e.Name===g.Source}));if(y){g.Entity=y.Entity,delete g.Source;var C=e&&e.dataPoint;if(!_.isEmpty(C))for(var x=0,b=C;x<b.length;x++){var S=b[x];if(null==S.selector&&S.properties[u]){if(!s(r,t)){var E=_.cloneDeep(S.properties[u]);C.push({selector:{data:[{dataViewWildcard:{matchingOption:1}}]},properties:(n={},n.fill={solid:{color:{expr:{FillRule:{FillRule:d(E),Input:v}}}}},n)})}if(C.splice(C.indexOf(S),1),delete t[p],!c(h,t)){var w=o(r);t[w]||(t[w]=[]),(l=t[w]).push.apply(l,f)}break}}}}}}}}}}function c(e,t){for(var r in t){var i=t[r];if(_.some(i,(function(t){return t.queryRef===e})))return!0}return!1}function p(e){e.color&&(e.color=e.color.expr);var t=e;t.value&&(t.value=t.value.expr);var r=e;r.strategy&&(r.strategy=r.strategy.expr)}function f(e){p(e.min),p(e.max),e.mid&&p(e.mid),e.nullColoringStrategy&&p(e.nullColoringStrategy)}function d(e){return e.linearGradient2&&f(e.linearGradient2),e.linearGradient3&&f(e.linearGradient3),e}var h=e.data.services.wireContracts.DataViewObjectDefinitions,v=e.data.DataViewWildcard,m=jsCommon.JsonExtensions,g=e.data.services.SemanticQuerySerializer,y=e.data.SQExprBuilder;r.createVersionUpgrader=i;var C=(function(){function e(e){this.featureSwitchService=e}return e.prototype.upgrade=function(e){if(e)for(var t=0,r=e.sections;t<r.length;t++)for(var i=r[t],a=0,o=i.visualContainers;a<o.length;a++){var s=o[a],l=s.config.singleVisual;if(l){var c=l.visualType,p=l.projections;this.featureSwitchService.featureSwitches.cartesianConditionalFormatting&&(l.objects=n(l.objects,p,c),u(l.objects,p,c,l.prototypeQuery));var f=m.tryParseJSON(s.dataTransforms);f&&(this.featureSwitchService.featureSwitches.cartesianConditionalFormatting&&(f.objects=n(f.objects,p,c),u(f.objects,p,c,l.prototypeQuery)),s.dataTransforms=JSON.stringify(f))}}},e.prototype.upgradeFilterCollection=function(){},e.prototype.getVersion=function(){return t.ExplorationFeatureVersions.CartesianConditionalFormatting},e})();r.VersionUpgrader=C,r.getFillRuleInputRoleFromVisualType=a,r.upgradeGradientOnObjectDef=l,r.upgradeGradientOnWireContractObjectDef=u})(r=t.v3_20||(t.v3_20={}))})(r=t.upgrade||(t.upgrade={}))})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){function t(){return{automaticallyImport:!1,sandboxProperties:[2,0]}}e.createDraggableChartVisualRegisterOptions=t})(t=e.PowerOnDraggableChartVisualHelper||(e.PowerOnDraggableChartVisualHelper={}))})(t=e.utils||(e.utils={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r=e.formattingService,i=jsCommon.Lazy,n=jsCommon.StringExtensions,a=(function(){function e(e,t,r){this.op=e,this.onOperatorChanged(),this.isCalendarShown=!1,this.value=new o(t,r)}return Object.defineProperty(e.prototype,"operator",{get:function(){return this.op},set:function(e){this.op!==e&&(this.op=e,this.onOperatorChanged())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"valueRequired",{get:function(){return this.valRequired},enumerable:!0,configurable:!0}),e.prototype.accept=function(e){return e.visit(this)},e.empty=function(){return new e(0)},e.equals=function(e,t){return e=e||null,t=t||null,e===t||!e==!t&&(e.operator===t.operator&&o.equals(e.value,t.value))},e.prototype.onOperatorChanged=function(){this.valRequired=s.getValueRequired(this.operator),this.valRequired||(this.value=void 0)},e})();t.Condition=a;var o=(function(){function e(e,t){null!=e&&(e instanceof Date&&(this.dateValue=e),this.value=e,this.formatter=t,this.stringValue=this.formatter?this.formatter.format(this.value):this.value.toString()),this.initialTime=this.dateValue,this.dateValue||(this.initialTime=new Date,this.initialTime.setHours(0,0,0,0))}return Object.defineProperty(e.prototype,"isDate",{get:function(){return null!=this.dateValue},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasValue",{get:function(){return null!=this.dateValue||!jsCommon.StringExtensions.isNullOrUndefinedOrWhiteSpaceString(this.stringValue)},enumerable:!0,configurable:!0}),e.prototype.isValidDate=function(){return this.isDate&&(!_.isString(this.value)||null!==r.parseDate(this.value))},Object.defineProperty(e.prototype,"timePickerValue",{get:function(){return this.dateValue||this.initialTime},set:function(e){this.dateValue=e},enumerable:!0,configurable:!0}),e.equals=function(t,r){return t=t||null,r=r||null,t===r||!t==!r&&(e.compareDateTimeValue(t,r)&&t.stringValue===r.stringValue)},e.compareDateTimeValue=function(e,t){return(e.dateValue?e.dateValue.valueOf():0)===(t.dateValue?t.dateValue.valueOf():0)},e})();t.ConditionValue=o;var s;!(function(t){function r(e){return 11!==e&&12!==e&&0!==e}function n(e){return e.text?o.getValue():e.integer||e.numeric?s.getValue():e.dateTime?a.getValue():void 0}var a=new i(function(){var t=[];return t.push({value:9,label:e.common.localize.get("FilterOperator_Is")}),t.push({value:10,label:e.common.localize.get("FilterOperator_IsNot")}),t.push({value:3,label:e.common.localize.get("FilterOperator_GreaterThan_DT")}),t.push({value:4,label:e.common.localize.get("FilterOperator_GreaterThanOrEqual_DT")}),t.push({value:1,label:e.common.localize.get("FilterOperator_LessThan_DT")}),t.push({value:2,label:e.common.localize.get("FilterOperator_LessThanOrEqual_DT")}),t.push({value:11,label:e.common.localize.get("FilterOperator_IsBlank")}),t.push({value:12,label:e.common.localize.get("FilterOperator_IsNotBlank")}),t}),o=new i(function(){var t=[];return t.push({value:5,label:e.common.localize.get("FilterOperator_Contains")}),t.push({value:6,label:e.common.localize.get("FilterOperator_DoesNotContain")}),t.push({value:7,label:e.common.localize.get("FilterOperator_StartsWith")}),t.push({value:8,label:e.common.localize.get("FilterOperator_DoesNotStartWith")}),t.push({value:9,label:e.common.localize.get("FilterOperator_Is")}),t.push({value:10,label:e.common.localize.get("FilterOperator_IsNot")}),t.push({value:11,label:e.common.localize.get("FilterOperator_IsBlank")}),t.push({value:12,label:e.common.localize.get("FilterOperator_IsNotBlank")}),t}),s=new i(function(){var t=[];return t.push({value:1,label:e.common.localize.get("FilterOperator_LessThan")}),t.push({value:2,label:e.common.localize.get("FilterOperator_LessThanOrEqual")}),t.push({value:3,label:e.common.localize.get("FilterOperator_GreaterThan")}),t.push({value:4,label:e.common.localize.get("FilterOperator_GreaterThanOrEqual")}),t.push({value:9,label:e.common.localize.get("FilterOperator_Is")}),t.push({value:10,label:e.common.localize.get("FilterOperator_IsNot")}),t.push({value:11,label:e.common.localize.get("FilterOperator_IsBlank")}),t.push({value:12,label:e.common.localize.get("FilterOperator_IsNotBlank")}),t});t.getValueRequired=r,t.getFilterOperators=n})(s=t.OperatorHelper||(t.OperatorHelper={}));var l;!(function(r){function i(e,t,r){for(var i,n=new u(t,r),a=0,o=e;a<o.length;a++){var s=o[a];null!=s.operator&&0!==s.operator&&(i=s.accept(n))}return i}function a(t,r){var i;if(t.length>0){for(var a=[],o=0,s=t;o<s.length;o++){var l=s[o];a.push(c(l))}i=e.visuals.valueFormatter.formatListOr(a),i=r?n.format(e.common.localize.get("FilterRestatement_NotEqual"),i):n.format(e.common.localize.get("FilterRestatement_Equal"),i)}return i}function o(e,t,r){for(var i=[],n=0,o=e;n<o.length;n++){var l=o[n];i.push(s(l,r))}return a(i,t)}function s(e,r){var i=t.SQExprConverter.getFirstComparandValue(e);return r?r.format(i):i}function l(t){if(null!=t)return n.format(e.common.localize.get("FilterRestatement_IsDefault"),c(t))}function c(e){return null===e?null:_.isString(e)?e:e.displayName?e.displayName:"function"!=typeof e||"object"!=typeof e?e:void 0}r.fromCondition=i,r.fromLabels=a,r.fromDataViewScopeIdentities=o,r.getLabelFromScopeId=s,r.fromDefault=l})(l=t.RestatementHelper||(t.RestatementHelper={}));var u=(function(){function t(t,r){0===t?this.logicalOperatorResourceId=e.common.localize.get("FilterRestatement_CompoundAnd"):1===t&&(this.logicalOperatorResourceId=e.common.localize.get("FilterRestatement_CompoundOr")),this.formatter=r}return t.prototype.visit=function(e){var t=this.conditionToString(e);if(t)return _.isEmpty(this.result)?this.result=t:this.result=n.format(this.logicalOperatorResourceId,this.result,t),this.result},t.prototype.conditionToString=function(t){var r=t.value;if(!s.getValueRequired(t.operator)||r&&r.hasValue){var i;switch(r&&(i=this.formatter?this.formatter.format(r.value||r.stringValue):r.stringValue),t.operator){case 9:return n.format(e.common.localize.get("FilterRestatement_Equal"),i);case 10:return n.format(e.common.localize.get("FilterRestatement_NotEqual"),i);case 3:return r.isDate?n.format(e.common.localize.get("FilterRestatement_GreaterThan_DT"),i):n.format(e.common.localize.get("FilterRestatement_GreaterThan"),i);case 4:return r.isDate?n.format(e.common.localize.get("FilterRestatement_GreaterThanOrEqual_DT"),i):n.format(e.common.localize.get("FilterRestatement_GreaterThanOrEqual"),i);case 1:return r.isDate?n.format(e.common.localize.get("FilterRestatement_LessThan_DT"),i):n.format(e.common.localize.get("FilterRestatement_LessThan"),i);case 2:return r.isDate?n.format(e.common.localize.get("FilterRestatement_LessThanOrEqual_DT"),i):n.format(e.common.localize.get("FilterRestatement_LessThanOrEqual"),i);case 5:return n.format(e.common.localize.get("FilterRestatement_Contains"),i);case 6:return n.format(e.common.localize.get("FilterRestatement_DoesNotContain"),i);case 7:return n.format(e.common.localize.get("FilterRestatement_StartWith"),i);case 8:return n.format(e.common.localize.get("FilterRestatement_DoesNotStartWith"),i);case 11:return e.common.localize.get("FilterOperator_IsBlank");case 12:return e.common.localize.get("FilterOperator_IsNotBlank");default:return""}}},t})()})(t=e.data||(e.data={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){function r(e,r,i){if(!_.isEmpty(e)&&o(e,r)){var n=u.getDataPointsDescription(i,e);return t.convertToFilterExpressionMetadata(n)}}function i(e,t,i){if(_.isEmpty(e)){return r(_.map(e,(function(e){return s.convertSelectorsByColumnToSelector(e)})),t,i)}}function n(e,t){if(!e||!t)return e||t;for(var r={expressions:t.expressions.slice(),cachedValueItems:_.isEmpty(t.cachedValueItems)?[]:t.cachedValueItems.slice()},i={},n=function(n){var a=e.expressions[n],o=_.findIndex(r.expressions,(function(e){return e===a||l.equals(e,a)}));o===-1&&(o=t.expressions.length,r.expressions.push(a)),i[n]=o},a=0;a<e.expressions.length;a++)n(a);if(!_.isEmpty(e.cachedValueItems))for(var o=0,s=e.cachedValueItems;o<s.length;o++){var u=s[o],c={};for(var p in u.valueMap)c[i[p]]=u.valueMap[p];r.cachedValueItems.push({identities:u.identities,valueMap:c})}return r}function a(t){if(!_.isEmpty(t)){for(var r={expressions:[],cachedValueItems:[]},i=0,n=t;i<n.length;i++){for(var a=n[i],o={identities:[],valueMap:[]},s=0,l=a.selector.data;s<l.length;s++){var u=l[s];1===u.kind&&o.identities.push(u)}for(var c=0,p=a.values;c<p.length;c++){var f=p[c];if(f.expr instanceof e.data.SQColumnRefExpr){var d=_.indexOf(r.expressions,f.expr);d<0&&(r.expressions.push(f.expr),d=r.expressions.length-1),o.valueMap[d]=f.formattedValue}}_.isEmpty(o.valueMap)||r.cachedValueItems.push(o)}return r}}function o(t,r){if(!_.isEmpty(t)&&r&&r.query)for(var i=r.query.defn.select(),n=0,a=t;n<a.length;n++)for(var o=a[n],u=s.toScopeIdentities(o),c=0,p=u;c<p.length;c++)for(var f=p[c],d=f.expr,h=e.data.ScopeIdentityExtractor.getKeys(d),v=0,m=h;v<m.length;v++)for(var g=m[v],y=0,C=i;y<C.length;y++){var x=C[y];if(!l.equals(g,x.expr))return!0}}var s=e.data.Selector,l=e.data.SQExpr,u=e.data.DataViewQueryEngine;t.getSelectorsMetadata=r,t.getSelectorsByColumnMetadata=i,t.mergeFilterExpressionMetadata=n,t.convertToFilterExpressionMetadata=a,t.hasGroupOnKeys=o})(r=t.FilterExpressionMetadataUtils||(t.FilterExpressionMetadataUtils={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));;"use strict";var __extends=this&&this.__extends||(function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}})(),__awaiter=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))(function(o,n){function a(e){try{l(r.next(e))}catch(e){n(e)}}function s(e){try{l(r.throw(e))}catch(e){n(e)}}function l(e){e.done?o(e.value):new i(function(t){t(e.value)}).then(a,s)}l((r=r.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){function i(e){return function(t){return r([e,t])}}function r(i){if(o)throw new TypeError("Generator is already executing.");for(;l;)try{if(o=1,n&&(a=2&i[0]?n.return:i[0]?n.throw||((a=n.return)&&a.call(n),0):n.next)&&!(a=a.call(n,i[1])).done)return a;switch(n=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return l.label++,{value:i[1],done:!1};case 5:l.label++,n=i[1],i=[0];continue;case 7:i=l.ops.pop(),l.trys.pop();continue;default:if(a=l.trys,!(a=a.length>0&&a[a.length-1])&&(6===i[0]||2===i[0])){l=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){l.label=i[1];break}if(6===i[0]&&l.label<a[1]){l.label=a[1],a=i;break}if(a&&l.label<a[2]){l.label=a[2],l.ops.push(i);break}a[2]&&l.ops.pop(),l.trys.pop();continue}i=t.call(e,l)}catch(e){i=[6,e],n=0}finally{o=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}var o,n,a,s,l={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s},__assign=this&&this.__assign||Object.assign||function(e){for(var t,i=1,r=arguments.length;i<r;i++){t=arguments[i];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e},powerbi;!(function(e){var t;!(function(t){function i(i,r,o,n,a,s,l,c,u,p,d,h,v,g,f,y,m,S,w,C,b,x,F,D,V,M,P,E,T,A,I,_,k,L,O){var R=t.CustomerAction(D,V,M,P,E,T,A,I,_,k,L,O),B=_e(R.info,{reportGuid:i,originalReportGuid:r,appGuid:o,isDirectQuery:n,isCancelled1:a,isOnPrem:s,source:l,isUsageMetrics:c,groupObjectId:u,visualTypesAndCounts:p,tags:d,isReadonlyGroup:h,permissions:v,scrubUserInfo:g,isB2B:f,enterpriseCapacitySkuTier:y,bookmarkObjectId:m,datasetHost:S,modelId:w,dataCacheMode:C,improvedFilterExperienceState:b,capacityObjectId:x,dbName:F});return{name:"PBI.EX.OpenExploration",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ae(),formatted:function(){return e.extendFormatted({reportGuid:B.reportGuid,originalReportGuid:B.originalReportGuid,appGuid:B.appGuid,isDirectQuery:B.isDirectQuery,isCancelled1:B.isCancelled1,isOnPrem:B.isOnPrem,source:B.source,visualTypesAndCounts:B.visualTypesAndCounts,permissions:B.permissions,datasetHost:B.datasetHost,modelId:B.modelId,dataCacheMode:B.dataCacheMode,improvedFilterExperienceState:B.improvedFilterExperienceState,capacityObjectId:B.capacityObjectId,dbName:B.dbName},{isUsageMetrics:B.isUsageMetrics,groupObjectId:B.groupObjectId,tags:B.tags,isReadonlyGroup:B.isReadonlyGroup,scrubUserInfo:B.scrubUserInfo,isB2B:B.isB2B,enterpriseCapacitySkuTier:B.enterpriseCapacitySkuTier,bookmarkObjectId:B.bookmarkObjectId},R.formatted())},info:B,loggers:t.EXOpenExplorationLoggers,defaultTimeoutSec:600}}function r(i,r,o,n,a,s,l,c,u,p,d,h,v,g){var f=t.CustomerAction(o,n,a,s,l,c,u,p,d,h,v,g),y=_e(f.info,{reportGuid:i,sectionIndex:r});return{name:"PBI.EX.RefreshReport",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ae(),formatted:function(){return e.extendFormatted({reportGuid:y.reportGuid,sectionIndex:y.sectionIndex},null,f.formatted())},info:y,loggers:t.EXRefreshReportLoggers}}function o(i,r,o,n,a,s,l,c,u,p,d,h,v,g){var f=t.CustomerAction(o,n,a,s,l,c,u,p,d,h,v,g),y=_e(f.info,{isSaveAs:i,source:r});return{name:"PBI.EX.SaveExploration",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ae(),formatted:function(){return e.extendFormatted({isSaveAs:y.isSaveAs,source:y.source},null,f.formatted())},info:y,loggers:t.EXSaveExplorationLoggers}}function n(i,r,o,n,a,s,l,c,u,p,d,h,v,g){var f=t.Verbose(o,n,a,s,l,c,u,p,d,h,v,g),y=_e(f.info,{sourceVisualType:i,targetVisualType:r});return{name:"PBI.EX.InteractionVisualConversion",category:e.TelemetryCategory.Verbose,time:Date.now(),id:Ae(),formatted:function(){return e.extendFormatted({sourceVisualType:y.sourceVisualType,targetVisualType:y.targetVisualType},null,f.formatted())},info:y,loggers:t.EXInteractionVisualConversionLoggers}}function a(i,r,o,n,a,s,l,c,u,p,d,h,v,g){var f=t.CustomerAction(o,n,a,s,l,c,u,p,d,h,v,g),y=_e(f.info,{sourceVisualType:i,isInlineHierarchyEnabled:r});return{name:"PBI.EX.InteractionExpand",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ae(),formatted:function(){return e.extendFormatted({sourceVisualType:y.sourceVisualType,isInlineHierarchyEnabled:y.isInlineHierarchyEnabled},null,f.formatted())},info:y,loggers:t.EXInteractionExpandLoggers}}function s(i,r,o,n,a,s,l,c,u,p,d,h,v,g){var f=t.CustomerAction(o,n,a,s,l,c,u,p,d,h,v,g),y=_e(f.info,{sourceVisualType:i,isDrillDown:r});return{name:"PBI.EX.InteractionDrill",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ae(),formatted:function(){return e.extendFormatted({sourceVisualType:y.sourceVisualType,isDrillDown:y.isDrillDown},null,f.formatted())},info:y,loggers:t.EXInteractionDrillLoggers}}function l(i,r,o,n,a,s,l,c,u,p,d,h,v,g){var f=t.CustomerAction(o,n,a,s,l,c,u,p,d,h,v,g),y=_e(f.info,{sourceVisualType:i,targetExprKind:r});return{name:"PBI.EX.DrillToDetails",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ae(),formatted:function(){return e.extendFormatted({sourceVisualType:y.sourceVisualType,targetExprKind:y.targetExprKind},null,f.formatted())},info:y,loggers:t.EXDrillToDetailsLoggers}}function c(i,r,o,n,a,s,l,c,u,p,d,h,v,g,f,y,m){var S=t.CustomerAction(s,l,c,u,p,d,h,v,g,f,y,m),w=_e(S.info,{filterType:i,filterScopeType:r,fieldKind:o,drillToDetailsMode:n,viewMode:a});return{name:"PBI.EX.AddFilter",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ae(),formatted:function(){return e.extendFormatted({filterType:w.filterType,filterScopeType:w.filterScopeType,fieldKind:w.fieldKind,drillToDetailsMode:w.drillToDetailsMode,viewMode:w.viewMode},null,S.formatted())},info:w,loggers:t.EXAddFilterLoggers}}function u(i,r,o,n,a,s,l,c,u,p,d,h,v,g,f,y){var m=t.CustomerAction(a,s,l,c,u,p,d,h,v,g,f,y),S=_e(m.info,{filterType:i,filterScopeType:r,fieldKind:o,viewMode:n});return{name:"PBI.EX.ClearFilter",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ae(),formatted:function(){return e.extendFormatted({filterType:S.filterType,filterScopeType:S.filterScopeType,fieldKind:S.fieldKind,viewMode:S.viewMode},null,m.formatted())},info:S,loggers:t.EXClearFilterLoggers}}function p(i,r,o,n,a,s,l,c,u,p,d,h,v,g,f,y){var m=t.CustomerAction(a,s,l,c,u,p,d,h,v,g,f,y),S=_e(m.info,{filterType:i,filterScopeType:r,fieldKind:o,viewMode:n});return{name:"PBI.EX.RemoveFilter",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ae(),formatted:function(){return e.extendFormatted({filterType:S.filterType,filterScopeType:S.filterScopeType,fieldKind:S.fieldKind,viewMode:S.viewMode},null,m.formatted())},info:S,loggers:t.EXRemoveFilterLoggers}}function d(i,r,o,n,a,s,l,c,u,p,d,h,v,g,f,y){var m=t.CustomerAction(a,s,l,c,u,p,d,h,v,g,f,y),S=_e(m.info,{filterType:i,filterScopeType:r,fieldKind:o,isFilterHidden:n});return{name:"PBI.EX.HideFilter",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ae(),formatted:function(){return e.extendFormatted({filterType:S.filterType,filterScopeType:S.filterScopeType,fieldKind:S.fieldKind,isFilterHidden:S.isFilterHidden},null,m.formatted())},info:S,loggers:t.EXHideFilterLoggers}}function h(i,r,o,n,a,s,l,c,u,p,d,h,v,g,f,y){var m=t.CustomerAction(a,s,l,c,u,p,d,h,v,g,f,y),S=_e(m.info,{filterType:i,filterScopeType:r,fieldKind:o,isFilterLocked:n});return{name:"PBI.EX.LockFilter",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ae(),formatted:function(){return e.extendFormatted({filterType:S.filterType,filterScopeType:S.filterScopeType,fieldKind:S.fieldKind,isFilterLocked:S.isFilterLocked},null,m.formatted())},info:S,loggers:t.EXLockFilterLoggers}}function v(i,r,o,n,a,s,l,c,u,p,d,h,v,g,f){var y=t.CustomerAction(n,a,s,l,c,u,p,d,h,v,g,f),m=_e(y.info,{paneType:i,expanded:r,viewMode:o});return{name:"PBI.EX.TogglePaneExpanded",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ae(),formatted:function(){return e.extendFormatted({paneType:m.paneType,expanded:m.expanded,viewMode:m.viewMode},null,y.formatted())},info:m,loggers:t.EXTogglePaneExpandedLoggers}}function g(i,r,o,n,a,s,l,c,u,p,d,h,v,g,f,y,m){var S=t.CustomerAction(s,l,c,u,p,d,h,v,g,f,y,m),w=_e(S.info,{filterType:i,filterScopeType:r,fieldKind:o,expanded:n,viewMode:a});return{name:"PBI.EX.ToggleFilterCardExpanded",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ae(),formatted:function(){return e.extendFormatted({filterType:w.filterType,filterScopeType:w.filterScopeType,fieldKind:w.fieldKind,expanded:w.expanded,viewMode:w.viewMode},null,S.formatted())},info:w,loggers:t.EXToggleFilterCardExpandedLoggers}}function f(i,r,o,n,a,s,l,c,u,p,d,h,v,g,f){var y=t.CustomerAction(n,a,s,l,c,u,p,d,h,v,g,f),m=_e(y.info,{isVisualFilter:i,filterType:r,viewMode:o});return{name:"PBI.EX.FilterPaneAdvancedFilterApplied",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ae(),formatted:function(){return e.extendFormatted({isVisualFilter:m.isVisualFilter,filterType:m.filterType,viewMode:m.viewMode},null,y.formatted())},info:m,loggers:t.EXFilterPaneAdvancedFilterAppliedLoggers}}function y(i,r,o,n,a,s,l,c,u,p,d,h,v,g,f,y,m){var S=t.CustomerAction(s,l,c,u,p,d,h,v,g,f,y,m),w=_e(S.info,{isTop:i,itemCount:r,atGrain:o,onVisualMeasure:n,viewMode:a});return{name:"PBI.EX.FilterPaneTopNFilterApplied",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ae(),formatted:function(){return e.extendFormatted({isTop:w.isTop,itemCount:w.itemCount,atGrain:w.atGrain,onVisualMeasure:w.onVisualMeasure,viewMode:w.viewMode},null,S.formatted())},info:w,loggers:t.EXFilterPaneTopNFilterAppliedLoggers}}function m(i,r,o,n,a,s,l,c,u,p,d,h,v,g,f,y,m,S){var w=t.CustomerAction(l,c,u,p,d,h,v,g,f,y,m,S),C=_e(w.info,{relativeQualifier:i,duration:r,relativeUnit:o,includeToday:n,isCalendarPeriod:a,viewMode:s});return{name:"PBI.EX.FilterPaneRelativeDateFilterApplied",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ae(),formatted:function(){return e.extendFormatted({relativeQualifier:C.relativeQualifier,duration:C.duration,relativeUnit:C.relativeUnit,includeToday:C.includeToday,isCalendarPeriod:C.isCalendarPeriod,viewMode:C.viewMode},null,w.formatted())},info:C,loggers:t.EXFilterPaneRelativeDateFilterAppliedLoggers}}function S(i,r,o,n,a,s,l,c,u,p,d,h,v,g,f){var y=t.CustomerAction(n,a,s,l,c,u,p,d,h,v,g,f),m=_e(y.info,{filterScopeType:i,fieldKind:r,viewMode:o});return{name:"PBI.EX.FilterPaneBasicFilterChanged",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ae(),formatted:function(){return e.extendFormatted({filterScopeType:m.filterScopeType,fieldKind:m.fieldKind,viewMode:m.viewMode},null,y.formatted())},info:m,loggers:t.EXFilterPaneBasicFilterChangedLoggers}}function w(i,r,o,n,a,s,l,c,u,p,d,h){var v=t.CustomerAction(i,r,o,n,a,s,l,c,u,p,d,h),g=_e(v.info,{});return{name:"PBI.EX.FilterPaneFilterDefaultRestored",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ae(),formatted:function(){return e.extendFormatted(null,null,v.formatted())},info:g,loggers:t.EXFilterPaneFilterDefaultRestoredLoggers}}function C(i,r,o,n,a,s,l,c,u,p,d,h){var v=t.CustomerAction(i,r,o,n,a,s,l,c,u,p,d,h),g=_e(v.info,{});return{name:"PBI.EX.FilterPaneFilterCleared",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ae(),formatted:function(){return e.extendFormatted(null,null,v.formatted())},info:g,loggers:t.EXFilterPaneFilterClearedLoggers}}function b(i,r,o,n,a,s,l,c,u,p,d,h){var v=t.CustomerAction(i,r,o,n,a,s,l,c,u,p,d,h),g=_e(v.info,{});return{name:"PBI.EX.FilterPaneFilterDeleted",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ae(),formatted:function(){return e.extendFormatted(null,null,v.formatted())},info:g,loggers:t.EXFilterPaneFilterDeletedLoggers}}function x(i,r,o,n,a,s,l,c,u,p,d,h,v){var g=t.CustomerAction(r,o,n,a,s,l,c,u,p,d,h,v),f=_e(g.info,{enabled:i});return{name:"PBI.EX.ImprovedFilterExperience.ToggleReportSetting",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ae(),formatted:function(){return e.extendFormatted({enabled:f.enabled},null,g.formatted())},info:f,loggers:t.EXImprovedFilterExperienceToggleReportSettingLoggers}}function F(i,r,o,n,a,s,l,c,u,p,d,h,v,g){var f=t.CustomerAction(o,n,a,s,l,c,u,p,d,h,v,g),y=_e(f.info,{expanded:i,viewMode:r});return{name:"PBI.EX.ImprovedFilterExperience.ToggleOutspacePaneExpansion",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ae(),formatted:function(){return e.extendFormatted({expanded:y.expanded,viewMode:y.viewMode},null,f.formatted())},info:y,loggers:t.EXImprovedFilterExperienceToggleOutspacePaneExpansionLoggers}}function D(i,r,o,n,a,s,l,c,u,p,d,h,v){var g=t.CustomerAction(r,o,n,a,s,l,c,u,p,d,h,v),f=_e(g.info,{visible:i});return{name:"PBI.EX.ImprovedFilterExperience.ToggleOutspacePaneVisibility",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ae(),formatted:function(){return e.extendFormatted({visible:f.visible},null,g.formatted())},info:f,loggers:t.EXImprovedFilterExperienceToggleOutspacePaneVisibilityLoggers}}function V(i,r,o,n,a,s,l,c,u,p,d,h,v,g){var f=t.CustomerAction(o,n,a,s,l,c,u,p,d,h,v,g),y=_e(f.info,{isHover:i,numOfFiltersShown:r});return{name:"PBI.EX.ImprovedFilterExperience.ShowRestatement",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ae(),formatted:function(){return e.extendFormatted({isHover:y.isHover,numOfFiltersShown:y.numOfFiltersShown},null,f.formatted())},info:y,loggers:t.EXImprovedFilterExperienceShowRestatementLoggers}}function M(i){var r={message:i};return{name:"PBI.EX.LoadFilterError",category:e.TelemetryCategory.CriticalError,time:Date.now(),id:Ae(),formatted:function(){return e.extendFormatted({message:r.message},null)},info:r,loggers:t.EXLoadFilterErrorLoggers}}function P(i,r,o,n,a,s,l,c,u,p,d,h,v,g){var f=t.CustomerAction(o,n,a,s,l,c,u,p,d,h,v,g),y=_e(f.info,{source:i,visualType:r});return{name:"PBI.EX.CreateVisual",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ae(),formatted:function(){return e.extendFormatted({source:y.source,visualType:y.visualType},null,f.formatted())},info:y,loggers:t.EXCreateVisualLoggers}}function E(i,r,o,n,a,s,l,c,u,p,d,h,v,g,f,y,m,S){var w=t.Verbose(l,c,u,p,d,h,v,g,f,y,m,S),C=_e(w.info,{source:i,targetVisualType:r,fieldKind:o,drillToDetailsMode:n,success:a,quickMeasureTemplateName:s});return{name:"PBI.EX.AddField",category:e.TelemetryCategory.Verbose,time:Date.now(),id:Ae(),formatted:function(){return e.extendFormatted({source:C.source,targetVisualType:C.targetVisualType,fieldKind:C.fieldKind,drillToDetailsMode:C.drillToDetailsMode,success:C.success,quickMeasureTemplateName:C.quickMeasureTemplateName},null,w.formatted())},info:C,loggers:t.EXAddFieldLoggers}}function T(i,r,o,n,a,s,l,c,u,p,d,h,v,g,f,y){var m=t.Verbose(a,s,l,c,u,p,d,h,v,g,f,y),S=_e(m.info,{loadType:i,onPrem:r,loadTypeWarnings:o,whereVisualIsLoaded:n});return{name:"PBI.EX.VisualFirstLoad",category:e.TelemetryCategory.Verbose,time:Date.now(),id:Ae(),formatted:function(){return e.extendFormatted({loadType:S.loadType,onPrem:S.onPrem,loadTypeWarnings:S.loadTypeWarnings,whereVisualIsLoaded:S.whereVisualIsLoaded},null,m.formatted())},info:S,loggers:t.EXVisualFirstLoadLoggers}}function A(i,r,o,n,a,s,l,c,u,p,d,h,v,g){var f=t.CustomerAction(o,n,a,s,l,c,u,p,d,h,v,g),y=_e(f.info,{original:i,target:r});return{name:"PBI.EX.ChangeQuickCalc",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ae(),formatted:function(){return e.extendFormatted({original:y.original,target:y.target},null,f.formatted())},info:y,loggers:t.EXChangeQuickCalcLoggers}}function I(i,r,o,n,a,s,l,c,u,p,d,h,v,g,f){var y=t.CustomerAction(n,a,s,l,c,u,p,d,h,v,g,f),m=_e(y.info,{visualType:i,diverging:r,userValueSpecified:o});return{name:"PBI.EX.SetConditionalFormatting",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ae(),formatted:function(){return e.extendFormatted({visualType:m.visualType,diverging:m.diverging,userValueSpecified:m.userValueSpecified},null,y.formatted())},info:m,loggers:t.EXSetConditionalFormattingLoggers}}function _(i,r,o,n,a,s,l,c,u,p,d,h,v,g,f){var y=t.Verbose(n,a,s,l,c,u,p,d,h,v,g,f),m=_e(y.info,{visualType:i,userValueSpecified:r,fromPropertyPane:o});return{name:"PBI.EX.SetDataBars",category:e.TelemetryCategory.Verbose,time:Date.now(),id:Ae(),formatted:function(){return e.extendFormatted({visualType:m.visualType,userValueSpecified:m.userValueSpecified,fromPropertyPane:m.fromPropertyPane},null,y.formatted())},info:m,loggers:t.EXSetDataBarsLoggers}}function k(i,r,o,n,a,s,l,c,u,p,d,h,v,g,f,y){var m=t.CustomerAction(a,s,l,c,u,p,d,h,v,g,f,y),S=_e(m.info,{totalVisuals:i,numberOfScriptVisuals:r,visualIds:o,userLicense:n});return{name:"PBI.EX.ExplorationRefresh",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ae(),formatted:function(){return e.extendFormatted({totalVisuals:S.totalVisuals,numberOfScriptVisuals:S.numberOfScriptVisuals,visualIds:S.visualIds,userLicense:S.userLicense},null,m.formatted())},info:S,loggers:t.EXExplorationRefreshLoggers}}function L(i,r,o,n,a,s,l,c,u,p,d,h,v){var g=t.CustomerAction(r,o,n,a,s,l,c,u,p,d,h,v),f=_e(g.info,{reportObjectId:i});return{name:"PBI.EX.SnapshotEmbedCreate",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ae(),formatted:function(){return e.extendFormatted({reportObjectId:f.reportObjectId},null,g.formatted())},info:f,loggers:t.EXSnapshotEmbedCreateLoggers}}function O(i,r,o,n,a,s,l,c,u,p,d,h,v){var g=t.CustomerAction(r,o,n,a,s,l,c,u,p,d,h,v),f=_e(g.info,{reportObjectId:i});return{name:"PBI.EX.PublicEmbedCreate",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ae(),formatted:function(){return e.extendFormatted({reportObjectId:f.reportObjectId},null,g.formatted())},info:f,loggers:t.EXPublicEmbedCreateLoggers}}function R(i,r,o,n,a,s,l,c,u,p,d,h){var v=t.CustomerAction(i,r,o,n,a,s,l,c,u,p,d,h),g=_e(v.info,{});return{name:"PBI.EX.SnapshotEmbedDelete",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ae(),formatted:function(){return e.extendFormatted(null,null,v.formatted())},info:g,loggers:t.EXSnapshotEmbedDeleteLoggers}}function B(i,r,o,n,a,s,l,c,u,p,d,h){var v=t.CustomerAction(i,r,o,n,a,s,l,c,u,p,d,h),g=_e(v.info,{});return{name:"PBI.EX.SnapshotEmbedUpdate",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ae(),formatted:function(){return e.extendFormatted(null,null,v.formatted())},info:g,loggers:t.EXSnapshotEmbedUpdateLoggers}}function N(i,r,o,n,a,s,l,c,u,p,d,h,v,g,f){var y=t.CustomerAction(n,a,s,l,c,u,p,d,h,v,g,f),m=_e(y.info,{fileName:i,resourcePackageId:r,resourcePackageName:o});return{name:"PBI.EX.ImportCustomViz",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ae(),formatted:function(){return e.extendFormatted({fileName:m.fileName,resourcePackageId:m.resourcePackageId,resourcePackageName:m.resourcePackageName},null,y.formatted())},info:m,loggers:t.EXImportCustomVizLoggers}}function z(i,r,o,n,a,s,l,c,u,p,d,h,v){var g=t.CustomerAction(r,o,n,a,s,l,c,u,p,d,h,v),f=_e(g.info,{customVisualName:i});return{name:"PBI.EX.DeleteCustomViz",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ae(),formatted:function(){return e.extendFormatted({customVisualName:f.customVisualName},null,g.formatted())},info:f,loggers:t.EXDeleteCustomVizLoggers}}function H(i,r,o,n,a,s,l,c,u,p,d,h,v){var g=t.CustomerAction(r,o,n,a,s,l,c,u,p,d,h,v),f=_e(g.info,{whereVisualIsLoaded:i});return{name:"PBI.EX.EnableCustomViz",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ae(),formatted:function(){return e.extendFormatted({whereVisualIsLoaded:f.whereVisualIsLoaded},null,g.formatted())},info:f,loggers:t.EXEnableCustomVizLoggers}}function $(i,r,o,n,a,s,l,c,u,p,d,h,v,g,f){var y=t.CustomerAction(n,a,s,l,c,u,p,d,h,v,g,f),m=_e(y.info,{sourceVisualType:i,targetVisualType:r,filterAction:o});return{name:"PBI.EX.VisualRelationshipOverride",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ae(),formatted:function(){return e.extendFormatted({sourceVisualType:m.sourceVisualType,targetVisualType:m.targetVisualType,filterAction:m.filterAction},null,y.formatted())},info:m,loggers:t.EXVisualRelationshipOverrideLoggers}}function U(i,r,o,n,a,s,l,c,u,p,d,h){var v=t.CustomerAction(i,r,o,n,a,s,l,c,u,p,d,h),g=_e(v.info,{});return{name:"PBI.EX.CodePaneUserRunScript",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ae(),formatted:function(){return e.extendFormatted(null,null,v.formatted())},info:g,loggers:t.EXCodePaneUserRunScriptLoggers}}function j(i,r,o,n,a,s,l,c,u,p,d,h){var v=t.CustomerAction(i,r,o,n,a,s,l,c,u,p,d,h),g=_e(v.info,{});return{name:"PBI.EX.CodePaneUserEditScriptWithExternalIDE",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ae(),formatted:function(){return e.extendFormatted(null,null,v.formatted())},info:g,loggers:t.EXCodePaneUserEditScriptWithExternalIDELoggers}}function G(i,r,o,n,a,s,l,c,u,p,d,h){var v=t.CustomerAction(i,r,o,n,a,s,l,c,u,p,d,h),g=_e(v.info,{});return{name:"PBI.EX.CodePaneUserOpenOptionsDialog",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ae(),formatted:function(){return e.extendFormatted(null,null,v.formatted())},info:g,loggers:t.EXCodePaneUserOpenOptionsDialogLoggers}}function Q(i,r){var o={launchExternalIDEFailureType:i,message:r};return{name:"PBI.EX.CodePaneLaunchExternalIDEFailed",category:e.TelemetryCategory.CriticalError,time:Date.now(),id:Ae(),formatted:function(){return e.extendFormatted({launchExternalIDEFailureType:o.launchExternalIDEFailureType,message:o.message},null)},info:o,loggers:t.EXCodePaneLaunchExternalIDEFailedLoggers}}function W(i,r,o,n,a,s,l,c,u,p,d,h){var v=t.CustomerAction(i,r,o,n,a,s,l,c,u,p,d,h),g=_e(v.info,{});return{name:"PBI.EX.CodePaneLaunchExternalIDESucceeded",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ae(),formatted:function(){return e.extendFormatted(null,null,v.formatted())},info:g,loggers:t.EXCodePaneLaunchExternalIDESucceededLoggers}}function X(i,r){var o={warningKey:i,message:r};return{name:"PBI.EX.CodePaneShowWarning",category:e.TelemetryCategory.CriticalError,time:Date.now(),id:Ae(),formatted:function(){return e.extendFormatted({warningKey:o.warningKey,message:o.message},null)},info:o,loggers:t.EXCodePaneShowWarningLoggers}}function q(i,r,o,n,a,s,l,c,u,p,d,h,v,g,f,y,m,S,w){var C=t.CustomerAction(c,u,p,d,h,v,g,f,y,m,S,w),b=_e(C.info,{visualType:i,source:r,isPartialResult:o,dest:n,isPremiumUser:a,isDrillToDetailsMode:s,dataType:l});return{name:"PBI.EX.ExportVisualData",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ae(),formatted:function(){return e.extendFormatted({visualType:b.visualType,source:b.source,isPartialResult:b.isPartialResult,dest:b.dest,isPremiumUser:b.isPremiumUser,isDrillToDetailsMode:b.isDrillToDetailsMode,dataType:b.dataType},null,C.formatted())},info:b,loggers:t.EXExportVisualDataLoggers}}function K(i,r,o,n,a,s,l,c,u,p,d,h,v,g,f,y){var m=t.CustomerAction(a,s,l,c,u,p,d,h,v,g,f,y),S=_e(m.info,{countTotalVisuals:i,countScriptVisuals:r,visualIds:o,userLicense:n});return{name:"PBI.EX.LoadReportWithScriptVis",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ae(),formatted:function(){return e.extendFormatted({countTotalVisuals:S.countTotalVisuals,countScriptVisuals:S.countScriptVisuals,visualIds:S.visualIds,userLicense:S.userLicense},null,m.formatted())},info:S,loggers:t.EXLoadReportWithScriptVisLoggers}}function J(i,r,o,n,a,s,l,c,u,p,d,h,v,g,f,y,m,S,w,C){var b=t.Verbose(u,p,d,h,v,g,f,y,m,S,w,C),x=_e(b.info,{reportId:i,reportGuid:r,sectionIndex:o,sectionGuid:n,groupObjectId:a,isReadonlyGroup:s,permissions:l,scrubUserInfo:c});return{name:"PBI.ExploreHost.ChangeReportPage",category:e.TelemetryCategory.Verbose,time:Date.now(),id:Ae(),formatted:function(){return e.extendFormatted({reportId:x.reportId,reportGuid:x.reportGuid,sectionIndex:x.sectionIndex,permissions:x.permissions},{sectionGuid:x.sectionGuid,groupObjectId:x.groupObjectId,isReadonlyGroup:x.isReadonlyGroup,scrubUserInfo:x.scrubUserInfo},b.formatted())},info:x,loggers:t.ExploreHostChangeReportPageLoggers}}function Y(i,r,o,n,a,s,l,c,u,p,d,h,v,g){var f=t.CustomerAction(o,n,a,s,l,c,u,p,d,h,v,g),y=_e(f.info,{reportId:i,numberOfVisualsRemoved:r});return{name:"PBI.EX.RemoveMobileCanvasVisuals",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ae(),formatted:function(){return e.extendFormatted({reportId:y.reportId,numberOfVisualsRemoved:y.numberOfVisualsRemoved},null,f.formatted())},info:y,loggers:t.EXRemoveMobileCanvasVisualsLoggers}}function Z(i,r,o,n,a,s,l,c,u,p,d,h,v){var g=t.Verbose(r,o,n,a,s,l,c,u,p,d,h,v),f=_e(g.info,{reportGuid:i});return{name:"PBI.EX.LoadReportContainer",category:e.TelemetryCategory.Verbose,time:Date.now(),id:Ae(),formatted:function(){return e.extendFormatted({reportGuid:f.reportGuid},null,g.formatted())},info:f,loggers:t.EXLoadReportContainerLoggers}}function ee(i,r,o,n,a,s,l,c,u,p,d,h,v,g,f,y,m,S,w){var C=t.Verbose(c,u,p,d,h,v,g,f,y,m,S,w),b=_e(C.info,{reportGuid:i,datasetId:r,packageId:o,isNew:n,permissions:a,packageType:s,httpStatusCode:l});return{name:"PBI.EX.LoadReportContainerDatasetMissing",category:e.TelemetryCategory.Verbose,time:Date.now(),id:Ae(),formatted:function(){return e.extendFormatted({reportGuid:b.reportGuid,datasetId:b.datasetId,packageId:b.packageId,isNew:b.isNew,permissions:b.permissions,packageType:b.packageType,httpStatusCode:b.httpStatusCode},null,C.formatted())},info:b,loggers:t.EXLoadReportContainerDatasetMissingLoggers}}function te(i,r,o,n,a,s,l,c,u,p,d,h,v,g,f,y){var m=t.Verbose(a,s,l,c,u,p,d,h,v,g,f,y),S=_e(m.info,{reportGuid:i,isDirectQuery:r,isOnPrem:o,dataCacheMode:n});return{name:"PBI.EX.InitExploration",category:e.TelemetryCategory.Verbose,time:Date.now(),id:Ae(),formatted:function(){return e.extendFormatted({reportGuid:S.reportGuid,isDirectQuery:S.isDirectQuery,isOnPrem:S.isOnPrem,dataCacheMode:S.dataCacheMode},null,m.formatted())},info:S,loggers:t.EXInitExplorationLoggers}}function ie(i,r,o,n,a,s,l,c,u,p,d,h){var v=t.Verbose(i,r,o,n,a,s,l,c,u,p,d,h),g=_e(v.info,{});return{name:"PBI.EX.LoadExplorationVisuals",category:e.TelemetryCategory.Verbose,time:Date.now(),id:Ae(),formatted:function(){return e.extendFormatted(null,null,v.formatted())},info:g,loggers:t.EXLoadExplorationVisualsLoggers}}function re(i,r,o,n,a,s,l,c,u,p,d,h,v){var g=t.Verbose(r,o,n,a,s,l,c,u,p,d,h,v),f=_e(g.info,{visualType:i});return{name:"PBI.EX.RenderExplorationVisual",category:e.TelemetryCategory.Verbose,time:Date.now(),id:Ae(),formatted:function(){return e.extendFormatted({visualType:f.visualType},null,g.formatted())},info:f,loggers:t.EXRenderExplorationVisualLoggers,logRatio:.01}}function oe(i,r,o,n,a,s,l,c,u,p,d,h,v){var g=t.Verbose(r,o,n,a,s,l,c,u,p,d,h,v),f=_e(g.info,{reportGuid:i});return{name:"PBI.EX.FetchExploration",category:e.TelemetryCategory.Verbose,time:Date.now(),id:Ae(),formatted:function(){return e.extendFormatted({reportGuid:f.reportGuid},null,g.formatted())},info:f,loggers:t.EXFetchExplorationLoggers}}function ne(i,r,o,n,a,s,l,c,u,p,d,h,v,g,f){var y=t.CustomerAction(n,a,s,l,c,u,p,d,h,v,g,f),m=_e(y.info,{sourceLayout:i,targetLayout:r,viewMode:o});return{name:"PBI.EX.ChangeCanvasLayout",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ae(),formatted:function(){return e.extendFormatted({sourceLayout:m.sourceLayout,targetLayout:m.targetLayout,viewMode:m.viewMode},null,y.formatted())},info:m,loggers:t.EXChangeCanvasLayoutLoggers}}function ae(i,r,o,n,a,s,l,c,u,p,d,h,v,g,f,y,m){var S=t.CustomerAction(s,l,c,u,p,d,h,v,g,f,y,m),w=_e(S.info,{numberOfClusters:i,visualType:r,numberOfMeasures:o,numberOfDimensions:n,numberOfFilters:a});return{name:"PBI.EX.Clustering.AddClustering",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ae(),formatted:function(){return e.extendFormatted({numberOfClusters:w.numberOfClusters,visualType:w.visualType,numberOfMeasures:w.numberOfMeasures,numberOfDimensions:w.numberOfDimensions,numberOfFilters:w.numberOfFilters},null,S.formatted())},info:w,loggers:t.EXClusteringAddClusteringLoggers}}function se(i,r,o,n,a,s,l,c,u,p,d,h,v,g,f,y,m){var S=t.CustomerAction(s,l,c,u,p,d,h,v,g,f,y,m),w=_e(S.info,{updatedName:i,updatedDescription:r,updatedClusterNames:o,updatedNumberOfClusters:n,newNumberOfClusters:a});return{name:"PBI.EX.Clustering.EditClustering",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ae(),formatted:function(){return e.extendFormatted({updatedName:w.updatedName,updatedDescription:w.updatedDescription,updatedClusterNames:w.updatedClusterNames,updatedNumberOfClusters:w.updatedNumberOfClusters,newNumberOfClusters:w.newNumberOfClusters},null,S.formatted())},info:w,loggers:t.EXClusteringEditClusteringLoggers}}function le(i,r,o,n,a,s,l,c,u,p,d,h,v,g){var f=t.CustomerAction(o,n,a,s,l,c,u,p,d,h,v,g),y=_e(f.info,{entryPoint:i,numberOfSelects:r});return{name:"PBI.EX.QuickMeasures.OpenDialog",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ae(),formatted:function(){return e.extendFormatted({entryPoint:y.entryPoint,numberOfSelects:y.numberOfSelects},null,f.formatted())},info:y,loggers:t.EXQuickMeasuresOpenDialogLoggers}}function ce(i,r,o,n,a,s,l,c,u,p,d,h,v,g){var f=t.CustomerAction(o,n,a,s,l,c,u,p,d,h,v,g),y=_e(f.info,{selectedQuickMeasure:i,connectionType:r});return{name:"PBI.EX.QuickMeasures.DialogResult",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ae(),formatted:function(){return e.extendFormatted({selectedQuickMeasure:y.selectedQuickMeasure,connectionType:y.connectionType},null,f.formatted())},info:y,loggers:t.EXQuickMeasuresDialogResultLoggers}}function ue(i,r,o,n,a,s,l,c,u,p,d,h,v,g){var f=t.CustomerAction(o,n,a,s,l,c,u,p,d,h,v,g),y=_e(f.info,{selectedQuickMeasure:i,isLast:r});return{name:"PBI.EX.QuickMeasures.OnMeasureChange",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ae(),formatted:function(){return e.extendFormatted({selectedQuickMeasure:y.selectedQuickMeasure,isLast:y.isLast},null,f.formatted())},info:y,loggers:t.EXQuickMeasuresOnMeasureChangeLoggers}}function pe(i,r,o,n,a,s,l,c,u,p,d,h,v){var g=t.CustomerAction(r,o,n,a,s,l,c,u,p,d,h,v),f=_e(g.info,{entryPoint:i});return{name:"PBI.EX.Drillthrough.GotoTarget",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ae(),formatted:function(){return e.extendFormatted({entryPoint:f.entryPoint},null,g.formatted())},info:f,loggers:t.EXDrillthroughGotoTargetLoggers}}function de(i,r,o,n,a,s,l,c,u,p,d,h,v,g){var f=t.CustomerAction(o,n,a,s,l,c,u,p,d,h,v,g),y=_e(f.info,{type:i,countOfCurrentPageDrillthroughFilters:r});return{name:"PBI.EX.Drillthrough.FilterUpdate",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ae(),formatted:function(){return e.extendFormatted({type:y.type,countOfCurrentPageDrillthroughFilters:y.countOfCurrentPageDrillthroughFilters},null,f.formatted())},info:y,loggers:t.EXDrillthroughFilterUpdateLoggers}}function he(i,r,o,n,a,s,l,c,u,p,d,h,v){var g=t.CustomerAction(r,o,n,a,s,l,c,u,p,d,h,v),f=_e(g.info,{visualType:i});return{name:"PBI.EX.RefreshHostData",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ae(),formatted:function(){return e.extendFormatted({visualType:f.visualType},null,g.formatted())},info:f,loggers:t.EXRefreshHostDataLoggers}}function ve(i,r,o,n,a,s,l,c,u,p,d,h){var v=t.CustomerAction(i,r,o,n,a,s,l,c,u,p,d,h),g=_e(v.info,{});return{name:"PBI.EX.BookmarkAdd",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ae(),
formatted:function(){return e.extendFormatted(null,null,v.formatted())},info:g,loggers:t.EXBookmarkAddLoggers}}function ge(i,r,o,n,a,s,l,c,u,p,d,h){var v=t.CustomerAction(i,r,o,n,a,s,l,c,u,p,d,h),g=_e(v.info,{});return{name:"PBI.EX.BookmarkUpdate",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ae(),formatted:function(){return e.extendFormatted(null,null,v.formatted())},info:g,loggers:t.EXBookmarkUpdateLoggers}}function fe(i,r,o,n,a,s,l,c,u,p,d,h){var v=t.CustomerAction(i,r,o,n,a,s,l,c,u,p,d,h),g=_e(v.info,{});return{name:"PBI.EX.BookmarkDelete",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ae(),formatted:function(){return e.extendFormatted(null,null,v.formatted())},info:g,loggers:t.EXBookmarkDeleteLoggers}}function ye(i,r,o,n,a,s,l,c,u,p,d,h){var v=t.CustomerAction(i,r,o,n,a,s,l,c,u,p,d,h),g=_e(v.info,{});return{name:"PBI.EX.BookmarkPlay",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ae(),formatted:function(){return e.extendFormatted(null,null,v.formatted())},info:g,loggers:t.EXBookmarkPlayLoggers}}function me(i,r,o,n,a,s,l,c,u,p,d,h,v,g){var f=t.CustomerAction(o,n,a,s,l,c,u,p,d,h,v,g),y=_e(f.info,{keepSynced:i,visualGroupCount:r});return{name:"PBI.EX.CopyPasteSyncGroup",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ae(),formatted:function(){return e.extendFormatted({keepSynced:y.keepSynced,visualGroupCount:y.visualGroupCount},null,f.formatted())},info:y,loggers:t.EXCopyPasteSyncGroupLoggers}}function Se(i,r,o,n,a,s,l,c,u,p,d,h,v,g){var f=t.CustomerAction(o,n,a,s,l,c,u,p,d,h,v,g),y=_e(f.info,{entryPoint:i,action:r});return{name:"PBI.EX.CustomDateTableOpenDialog",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ae(),formatted:function(){return e.extendFormatted({entryPoint:y.entryPoint,action:y.action},null,f.formatted())},info:y,loggers:t.EXCustomDateTableOpenDialogLoggers}}function we(i,r,o,n,a,s,l,c,u,p,d,h,v,g){var f=t.CustomerAction(o,n,a,s,l,c,u,p,d,h,v,g),y=_e(f.info,{entryPoint:i,action:r});return{name:"PBI.EX.CustomDateTableCommit",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ae(),formatted:function(){return e.extendFormatted({entryPoint:y.entryPoint,action:y.action},null,f.formatted())},info:y,loggers:t.EXCustomDateTableCommitLoggers}}function Ce(i,r,o,n,a,s,l,c,u,p,d,h,v){var g=t.CustomerAction(r,o,n,a,s,l,c,u,p,d,h,v),f=_e(g.info,{errors:i});return{name:"PBI.EX.CustomDateTableValidationResult",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ae(),formatted:function(){return e.extendFormatted({errors:f.errors},null,g.formatted())},info:f,loggers:t.EXCustomDateTableValidationResultLoggers}}function be(i,r,o,n,a,s,l,c,u,p,d,h){var v=t.CustomerAction(i,r,o,n,a,s,l,c,u,p,d,h),g=_e(v.info,{});return{name:"PBI.EX.NavigateBack",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ae(),formatted:function(){return e.extendFormatted(null,null,v.formatted())},info:g,loggers:t.EXNavigateBackLoggers}}function xe(i,r,o,n,a,s,l,c,u,p,d,h,v,g,f,y,m,S){var w=t.Verbose(l,c,u,p,d,h,v,g,f,y,m,S),C=_e(w.info,{targetSectionIndex:i,forceUpdate:r,suppressHistory:o,canvasLayout:n,clearSelection:a,isCancelled1:s});return{name:"PBI.EX.UpdateActiveSection",category:e.TelemetryCategory.Verbose,time:Date.now(),id:Ae(),formatted:function(){return e.extendFormatted({targetSectionIndex:C.targetSectionIndex,canvasLayout:C.canvasLayout},{forceUpdate:C.forceUpdate,suppressHistory:C.suppressHistory,clearSelection:C.clearSelection,isCancelled1:C.isCancelled1},w.formatted())},info:C,loggers:t.EXUpdateActiveSectionLoggers}}function Fe(i,r,o,n,a,s,l,c,u,p,d,h){var v=t.Verbose(i,r,o,n,a,s,l,c,u,p,d,h),g=_e(v.info,{});return{name:"PBI.EX.ExplorationStateApplyImpact",category:e.TelemetryCategory.Verbose,time:Date.now(),id:Ae(),formatted:function(){return e.extendFormatted(null,null,v.formatted())},info:g,loggers:t.EXExplorationStateApplyImpactLoggers}}function De(i,r,o,n,a,s,l,c,u,p,d,h,v){var g=t.CustomerAction(r,o,n,a,s,l,c,u,p,d,h,v),f=_e(g.info,{nextPage:i});return{name:"PBI.EX.SwitchToAdjacentSection",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ae(),formatted:function(){return e.extendFormatted({nextPage:f.nextPage},null,g.formatted())},info:f,loggers:t.EXSwitchToAdjacentSectionLoggers}}function Ve(i,r,o,n,a,s,l,c,u,p,d,h,v,g){var f=t.CustomerAction(o,n,a,s,l,c,u,p,d,h,v,g),y=_e(f.info,{index:i,canvasLayout:r});return{name:"PBI.EX.SwitchSection",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ae(),formatted:function(){return e.extendFormatted({index:y.index,canvasLayout:y.canvasLayout},null,f.formatted())},info:y,loggers:t.EXSwitchSectionLoggers}}function Me(i,r,o,n,a,s,l,c,u,p,d,h){var v=t.Verbose(i,r,o,n,a,s,l,c,u,p,d,h),g=_e(v.info,{});return{name:"PBI.EX.VisualContainerApplyUpdate",category:e.TelemetryCategory.Verbose,time:Date.now(),id:Ae(),formatted:function(){return e.extendFormatted(null,null,v.formatted())},info:g,loggers:t.EXVisualContainerApplyUpdateLoggers,logRatio:0}}function Pe(i,r,o,n,a,s,l,c,u,p,d,h){var v=t.Verbose(i,r,o,n,a,s,l,c,u,p,d,h),g=_e(v.info,{});return{name:"PBI.EX.VisualDataChanged",category:e.TelemetryCategory.Verbose,time:Date.now(),id:Ae(),formatted:function(){return e.extendFormatted(null,null,v.formatted())},info:g,loggers:t.EXVisualDataChangedLoggers,logRatio:0}}function Ee(i,r,o,n,a,s,l,c,u,p,d,h){var v=t.CustomerAction(i,r,o,n,a,s,l,c,u,p,d,h),g=_e(v.info,{});return{name:"PBI.EX.ApplySlicer",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ae(),formatted:function(){return e.extendFormatted(null,null,v.formatted())},info:g,loggers:t.EXApplySlicerLoggers}}function Te(i,r,o,n,a,s,l,c,u,p,d,h){var v=t.CustomerAction(i,r,o,n,a,s,l,c,u,p,d,h),g=_e(v.info,{});return{name:"PBI.EX.SelectDataPoint",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ae(),formatted:function(){return e.extendFormatted(null,null,v.formatted())},info:g,loggers:t.EXSelectDataPointLoggers}}var Ae,Ie=jsCommon.Utility,_e=jsCommon.UnionExtensions.mergeUnionType;Ae=Ie?Ie.generateGuid:Function.prototype;var ke;!(function(e){e.Normal="Normal",e.EmailSubscription="EmailSubscription",e.ReportInvitation="ReportInvitation",e.SubscribeOthers="SubscribeOthers",e.SmartAlerts="SmartAlerts",e.Invalid="Invalid"})(ke=t.OpenExplorationSource||(t.OpenExplorationSource={})),t.EXOpenExploration=i,t.EXRefreshReport=r,t.EXSaveExploration=o,t.EXInteractionVisualConversion=n,t.EXInteractionExpand=a,t.EXInteractionDrill=s,t.EXDrillToDetails=l,t.EXAddFilter=c,t.EXClearFilter=u,t.EXRemoveFilter=p,t.EXHideFilter=d,t.EXLockFilter=h,t.EXTogglePaneExpanded=v,t.EXToggleFilterCardExpanded=g,t.EXFilterPaneAdvancedFilterApplied=f,t.EXFilterPaneTopNFilterApplied=y,t.EXFilterPaneRelativeDateFilterApplied=m,t.EXFilterPaneBasicFilterChanged=S,t.EXFilterPaneFilterDefaultRestored=w,t.EXFilterPaneFilterCleared=C,t.EXFilterPaneFilterDeleted=b,t.EXImprovedFilterExperienceToggleReportSetting=x,t.EXImprovedFilterExperienceToggleOutspacePaneExpansion=F,t.EXImprovedFilterExperienceToggleOutspacePaneVisibility=D,t.EXImprovedFilterExperienceShowRestatement=V,t.EXLoadFilterError=M,t.EXCreateVisual=P,t.EXAddField=E,t.EXVisualFirstLoad=T,t.EXChangeQuickCalc=A,t.EXSetConditionalFormatting=I,t.EXSetDataBars=_,t.EXExplorationRefresh=k,t.EXSnapshotEmbedCreate=L,t.EXPublicEmbedCreate=O,t.EXSnapshotEmbedDelete=R,t.EXSnapshotEmbedUpdate=B,t.EXImportCustomViz=N,t.EXDeleteCustomViz=z,t.EXEnableCustomViz=H,t.EXVisualRelationshipOverride=$,t.EXCodePaneUserRunScript=U,t.EXCodePaneUserEditScriptWithExternalIDE=j,t.EXCodePaneUserOpenOptionsDialog=G,t.EXCodePaneLaunchExternalIDEFailed=Q,t.EXCodePaneLaunchExternalIDESucceeded=W,t.EXCodePaneShowWarning=X,t.EXExportVisualData=q,t.EXLoadReportWithScriptVis=K,t.ExploreHostChangeReportPage=J,t.EXRemoveMobileCanvasVisuals=Y,t.EXLoadReportContainer=Z,t.EXLoadReportContainerDatasetMissing=ee,t.EXInitExploration=te,t.EXLoadExplorationVisuals=ie,t.EXRenderExplorationVisual=re,t.EXFetchExploration=oe,t.EXChangeCanvasLayout=ne,t.EXClusteringAddClustering=ae,t.EXClusteringEditClustering=se,t.EXQuickMeasuresOpenDialog=le,t.EXQuickMeasuresDialogResult=ce,t.EXQuickMeasuresOnMeasureChange=ue,t.EXDrillthroughGotoTarget=pe,t.EXDrillthroughFilterUpdate=de,t.EXRefreshHostData=he,t.EXBookmarkAdd=ve,t.EXBookmarkUpdate=ge,t.EXBookmarkDelete=fe,t.EXBookmarkPlay=ye,t.EXCopyPasteSyncGroup=me,t.EXCustomDateTableOpenDialog=Se,t.EXCustomDateTableCommit=we,t.EXCustomDateTableValidationResult=Ce,t.EXNavigateBack=be,t.EXUpdateActiveSection=xe,t.EXExplorationStateApplyImpact=Fe,t.EXSwitchToAdjacentSection=De,t.EXSwitchSection=Ve,t.EXVisualContainerApplyUpdate=Me,t.EXVisualDataChanged=Pe,t.EXApplySlicer=Ee,t.EXSelectDataPoint=Te})(t=e.telemetry||(e.telemetry={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=e.data.Condition,o=e.data.OperatorHelper,n=e.data.RestatementHelper,a=(function(){function e(e){this.field=e,this.conditions=[],this.operators=[],this.logicalOperator=2,this.logicalAndOperator=0,this.logicalOrOperator=1}return e.prototype.toSQExpr=function(e){var t=this.field,r=t.getMetadata(e);if(r){var o=r.type;return i.FilterCardConverter.toSQExpr(t,o,this.conditions,this.logicalOperator)}},e.prototype.getRestatement=function(e){return n.fromCondition(this.conditions,this.logicalOperator,e)},e.prototype.areConditionsValid=function(e){var t=this.conditions;if(_.isEmpty(t))return!1;for(var i=0,r=t.length;i<r;i++){var n=t[i];if(null!=n.operator&&0!==n.operator){if(n.value&&n.value.hasValue){if(o.getValueRequired(n.operator)&&n.value&&!n.value.hasValue)return!1;if(e&&!this.isConditionValid(e,n))return!1}}else if(i<r-1)return!1}return!0},e.prototype.loadOperators=function(e,t){var i=this.field;if(_.isEmpty(i.validate(e,t))){var r=i.getMetadata(e);this.operators=o.getFilterOperators(r.type)}},e.prototype.ensureConditions=function(){var e=this.operators;this.conditions||(this.conditions=[]);var t=this.conditions;for(_.isEmpty(this.conditions)&&!_.isEmpty(e)&&t.push(new r(e[0].value));t.length<2;)this.logicalOperator=0,t.push(r.empty())},e.prototype.isConditionValid=function(e,r){if(!e)return!1;var o=r.value;if(o&&o.isDate&&!o.isValidDate())return!1;var n=this.field,a=t.FilterUtils.getValueType(n,e);return!!a&&i.FilterCardConverter.isConditionValid(n,a,r)},e})();i.AdvFilterCard=a})(i=t.viewModels||(t.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i,r=e.data.Condition,o=e.data.ConditionValue,n=e.data.SQAndExpr,a=e.data.SQBetweenExpr,s=e.data.SQCompareExpr,l=e.data.SQConstantExpr,c=e.data.SQContainsExpr,u=e.data.SQDateSpanExpr,p=e.data.SQExpr,d=e.data.SQExprBuilder,h=e.data.SQInExpr,v=e.data.SQNotExpr,g=e.data.SQOrExpr,f=e.data.SQStartsWithExpr,y=/[0-9]*\.?[0-9]+%/;!(function(e){function t(e,t,i){return e.accept(new m(t,i))}function i(e,t,i,r){void 0===r&&(r=0);for(var o,n=new S(e,t,r),a=0,s=i;a<s.length;a++){var l=s[a];null!=l.operator&&0!==l.operator&&(o=l.accept(n))}return o}function r(e,t,i){var r=new S(e,t,(void 0));return null!=i.accept(r)}e.createAdvFilter=t,e.toSQExpr=i,e.isConditionValid=r})(i=t.FilterCardConverter||(t.FilterCardConverter={}));var m=(function(e){function i(t,i){var r=e.call(this)||this;return r.supportsCategorical=!0,r.context={isNegative:!1,allowNot:!0,logicalOperator:2},r.formatter=t,r.field=i,r}return __extends(i,e),i.prototype.visitColumnRef=function(e){if(null==this.field||p.equals(this.field,e))return this.createFilterCard(e)},i.prototype.visitGroupRef=function(e){if(null==this.field||p.equals(this.field,e))return this.createFilterCard(e)},i.prototype.visitMeasureRef=function(e){return this.createFilterCard(e)},i.prototype.visitAggr=function(e){return this.createFilterCard(e)},i.prototype.visitArithmetic=function(e){return this.createFilterCard(e)},i.prototype.visitHierarchyLevel=function(e){return this.supportsCategorical=!1,this.createFilterCard(e)},i.prototype.visitEntity=function(e){return this.createFilterCard(e)},i.prototype.visitIn=function(e){if(!e.table&&e.args&&1===e.args.length){e.args[0].accept(this);var t=this.filter;if(null==t&&null!=this.field)return this.createFilterCard(this.field);for(var i=this.context,o=0,n=e.values;o<n.length;o++){var a=n[o];i.condition=new r(i.isNegative?10:9),a[0].accept(this),t.conditions.push(i.condition)}if(2!==t.logicalOperator)return;var s=i.isNegative?0:1;return t.logicalOperator=s,t}},i.prototype.visitBetween=function(e){this.supportsCategorical=!1,e.arg.accept(this);var t=this.filter,i=this.context;if(i.condition=new r(i.isNegative?1:4),e.lower.accept(this),t.conditions.push(i.condition),i.condition=new r(i.isNegative?3:2),e.upper.accept(this),t.conditions.push(i.condition),2===t.logicalOperator)return t.logicalOperator=0,t},i.prototype.visitAnd=function(e){this.supportsCategorical=!1;var t=this.context,i=t.isNegative?1:0;if(2===t.logicalOperator)t.logicalOperator=i;else if(t.logicalOperator!==i)return;if(e.left.accept(this)&&e.right.accept(this))return this.filter},i.prototype.visitOr=function(e){var t=this.context,i=t.isNegative?0:1;if(2===t.logicalOperator)t.logicalOperator=i;else if(t.logicalOperator!==i)return;if(e.left.accept(this)&&e.right.accept(this))return this.filter},i.prototype.visitCompare=function(e){var t=this.context,i=this.getFilterOperator(e,t.isNegative);if(void 0!==i&&0!==i){t.condition=new r(this.getFilterOperator(e,t.isNegative));var o=t.allowNot;if(t.allowNot=!1,e.left.accept(this)&&e.right.accept(this)&&(e.right instanceof l||e.right instanceof u)){var n=this.filter;return n.conditions.push(this.context.condition),n.conditions.length>1&&2===n.logicalOperator&&(n.logicalOperator=0),t.allowNot=o,t.condition=null,n}}},i.prototype.visitNot=function(e){var t=this.context,i=e.arg;if((i instanceof s||i instanceof h||i instanceof a||t.allowNot&&(i instanceof n||i instanceof g||i instanceof c||i instanceof f||i instanceof v))&&(t.isNegative=!t.isNegative,e.arg.accept(this)))return t.isNegative=!t.isNegative,this.filter},i.prototype.visitConstant=function(e){if(this.context.condition){var t=this.context.condition;return 0!==e.type.primitiveType&&(t.value=new o(e.value,this.formatter)),this.filter}},i.prototype.visitDateSpan=function(e){if(this.supportsCategorical=!1,5===e.unit){var t=this.context,i=t.allowNot;t.allowNot=!1;var r=e.arg.accept(this);return t.allowNot=i,r}},i.prototype.visitContains=function(e){this.supportsCategorical=!1;var t=this.context;t.condition=new r(t.isNegative?6:5);var i=t.allowNot;if(t.allowNot=!1,e.left.accept(this)&&e.right.accept(this)){var o=this.filter;return o.conditions.push(this.context.condition),t.allowNot=i,o}},i.prototype.visitStartsWith=function(e){this.supportsCategorical=!1;var t=this.context;t.condition=new r(t.isNegative?8:7);var i=t.allowNot;if(t.allowNot=!1,e.left.accept(this)&&e.right.accept(this)){var o=this.filter;return o.conditions.push(this.context.condition),t.allowNot=i,o}},i.prototype.getFilterOperator=function(e,t){switch(this.supportsCategorical=this.supportsCategorical&&0===e.comparison,e.comparison){case 3:return t?4:1;case 4:return t?3:2;case 1:return t?2:3;case 2:return t?1:4;case 0:return e.right instanceof l&&0===e.right.type.primitiveType?t?12:11:t?10:9}},i.prototype.createFilterCard=function(e){return this.filter||(this.filter=new t.AdvFilterCard(e),this.filter.supportsCategorical=this.supportsCategorical,this.filter.logicalOperator=this.context.logicalOperator),this.filter},i})(e.data.DefaultSQExprVisitor),S=(function(){function t(e,t,i){this.propertyExpr=e,this.dataType=t,this.logicalOperator=i}return t.prototype.visit=function(e){var t=this.expandExpr(e);return t&&(this.result?0===this.logicalOperator?this.result=d.and(this.result,t):1===this.logicalOperator&&(this.result=d.or(this.result,t)):this.result=t),this.result},t.prototype.expandExpr=function(e){var t,i=11!==e.operator&&12!==e.operator;if(i&&(t=this.getValueExpr(e)),t||!i)switch(e.operator){case 9:return d.compare(0,this.propertyExpr,t);case 10:return d.not(d.compare(0,this.propertyExpr,t));case 11:return d.compare(0,this.propertyExpr,d.nullConstant());case 12:return d.not(d.compare(0,this.propertyExpr,d.nullConstant()));case 5:return d.contains(this.propertyExpr,t);case 6:return d.not(d.contains(this.propertyExpr,t));case 7:return d.startsWith(this.propertyExpr,t);case 8:return d.not(d.startsWith(this.propertyExpr,t));case 3:return d.compare(1,this.propertyExpr,t);case 4:return d.compare(2,this.propertyExpr,t);case 1:return d.compare(3,this.propertyExpr,t);case 2:return d.compare(4,this.propertyExpr,t)}},t.prototype.getValueExpr=function(t){var i=this.dataType;if(t.value){var r=t.value.stringValue;if((i.integer||i.numeric)&&r){var o=e.formattingService.parseFloat(r);if(isNaN(o))return;return r.match(y)&&(o/=100),2===i.primitiveType?d.decimal(o):d.double(o)}if(i.text&&r)return d.text(r);if(i.dateTime){var n=t.value.dateValue;if(n)return d.dateSpan(5,d.dateTime(n))}}},t})()})(i=t.viewModels||(t.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(e,t){this._contract=e,this._state=t}return Object.defineProperty(e.prototype,"contract",{get:function(){return this._contract},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"readOnlyState",{get:function(){return this._state},enumerable:!0,configurable:!0}),e.prototype.updateViewState=function(){this.updateViewStateCore(this._state)},e.prototype.updateViewStateCore=function(e){},e})();e.ViewModel=t})(t=e.viewModels||(e.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i,r=e.common.utils.ColorUtility,o=e.visuals.ColorHelper,n=jsCommon.CssConstants.createClassAndSelector,a=jsCommon.CssConstants,s=e.data.DataViewObjectDefinitions,l=e.explore.constants.ExploreCanvasConstants,c=e.explore.services,u=e.visualHost.ResourcePackageReferenceResolver;!(function(t){function i(e,i,r,o){var n=i.get(0).getBoundingClientRect(),s=v(i,N),c=s.get(0).getBoundingClientRect(),u=i.find(".displayAreaViewport").get(0).getBoundingClientRect();if(n.width>u.width){var h=n.width-u.width;null!=t.scrollWidth&&Math.abs(t.scrollWidth-h)>.01&&jsCommon.Trace.error("Multiple scroll bar widths detected, "+t.scrollWidth+" -> "+h),t.scrollWidth=h}i.scrollTop(0).scrollLeft(0);var m=2*l.CanvasGutterSize,S=n.width-m,w=n.height-m,C=d(e,S,o),b=i.find(t.DisplayAreaNameSelector.selector);C.height<=w?(e.canvasViewStyle=2,i.css(a.overflowXProperty,a.hiddenValue).css(a.overflowYProperty,a.hiddenValue),g(b,u,C)):(m=3*l.CanvasGutterSize/2+(t.scrollWidth||8),S=n.width-m,C=d(e,S,o),e.canvasViewStyle=1,i.css(a.overflowXProperty,a.hiddenValue).css(a.overflowYProperty,a.scrollValue),y(b));var F=S/e.viewModel.width,D=0,V=p(c,e.viewModel.width,e.viewModel.height,e.canvasOptions.scrollbarOffset,D);r.setDisplayAreaScaleFactor(F),r.setWallpaperScaleFactor(V),x(e,C.width,C.height),b.attr("class",t.DisplayAreaNameSelector.class+" "+E(e)),f(b,C)}function p(e,t,i,r,o,n,a){if(0===o){return(e.width-r)/t}var s=i;if(n&&a){s=n.getConfig().displayOptions.hideTileMenu?e.height:e.height-a}return s/i}function d(e,t,i){var r=t/e.viewModel.width,o=t,n=e.viewModel.height*r+i;if(e.adjustScaleForLayout){var a=e.adjustScaleForLayout({x:r,y:r});if(a.x!==r||a.y!==r){var s=Math.min(a.x,a.y),l=s/r;o*=l,n=(n-i)*l+i,r=s}}return{width:o,height:n}}function h(e,i,r,o,n){var s=v(i,N),l=s.get(0).getBoundingClientRect(),c=e.outerViewport.width/e.viewModel.width,u=o.getConfig(),d=u.displayOptions.hideTileMenu?e.outerViewport.height:e.outerViewport.height-n;d-=A(e,o);var h=d/e.viewModel.height,y=Math.min(c,h),m=y===c?0:1,S=p(l,e.viewModel.width,e.viewModel.height,e.canvasOptions.scrollbarOffset,m,o,n);if(e.adjustScaleForLayout){var w=e.adjustScaleForLayout({x:y,y:y});w.x===y&&w.y===y||(y=Math.min(w.x,w.y))}r.setDisplayAreaScaleFactor(y),r.setWallpaperScaleFactor(S),i.scrollTop(0).scrollLeft(0);var C=e.viewModel.width*y,b=e.viewModel.height*y+n;e.canvasViewStyle=0,e.canvasViewStyle|=4,i.css(a.overflowXProperty,a.hiddenValue).css(a.overflowYProperty,a.hiddenValue),x(e,C,b);var F=i.find(t.DisplayAreaNameSelector.selector);F.attr("class",t.DisplayAreaNameSelector.class+" "+E(e));var D={width:C,height:b};f(F,D),g(F,e.outerViewport,D)}function v(e,t){if(e)return e.hasClass(t.class)?e:v(e.parent(),t)}function g(e,t,i){var r=null!=t.height&&null!=i.height?(t.height-i.height)/2:void 0,o=null!=t.width&&null!=i.width?(t.width-i.width)/2:void 0;e.css({position:"absolute",top:null!=r?r+"px":"",left:null!=o?o+"px":""})}function f(e,t){e.css({height:t.height+"px",width:t.width+"px"})}function y(e){e.css({position:"",top:"",left:""})}function m(e){e.css({height:"",width:""})}function S(e,i,r,o){var n=i.find(t.DisplayAreaNameSelector.selector);y(n),m(n),e.canvasViewStyle=8,r.setDisplayAreaScaleFactor(1),r.setWallpaperScaleFactor(1),x(e,e.outerViewport.width,e.outerViewport.height),i.css(a.overflowXProperty,a.hiddenValue).css(a.overflowYProperty,a.hiddenValue),n.attr("class",t.DisplayAreaNameSelector.class+" "+E(e))}function w(e,i,r){var o=t.getAutoLayoutVisualVCHeader(i,r),n=e.size;return{height:n.height+o,width:n.width}}function C(e,i,r,o,n){var s=i.find(t.DisplayAreaNameSelector.selector),c=e.isCanvasBackdropVisible();e.canvasViewStyle=0;var u=e.viewModel.width,p=e.viewModel.height+n,d={width:c?l.PhoneAuthoringViewportWidth:u,height:c?l.PhoneAuthoringViewportHeight:p};d.width>e.outerViewport.width?(e.canvasViewStyle|=512,i.css(a.overflowXProperty,a.autoValue)):(e.canvasViewStyle|=256,i.css(a.overflowXProperty,a.hiddenValue)),d.height>e.outerViewport.height?(e.canvasViewStyle|=128,i.css(a.overflowYProperty,a.autoValue)):(e.canvasViewStyle|=64,i.css(a.overflowYProperty,a.hiddenValue));var h=e.canvasViewStyle,v={width:256&h?d.width:void 0,height:64&h?d.height:void 0};g(s,e.outerViewport,v),256&h&&64&h?e.canvasViewStyle|=32:e.canvasViewStyle|=16,f(s,d),o.setDisplayAreaScaleFactor(1),o.setWallpaperScaleFactor(1),x(e,u,p);var y=E(e);s.attr("class",t.DisplayAreaNameSelector.class+" "+y),c&&r.attr("class",B.class+" "+y)}function b(e,i,r,o){var n=i.find(t.DisplayAreaNameSelector.selector);e.canvasViewStyle=0,e.canvasViewStyle|=512,e.canvasViewStyle|=128,e.canvasViewStyle|=16,e.viewModel.width>=e.outerViewport.width?i.css(a.overflowXProperty,a.autoValue):i.css(a.overflowXProperty,a.hiddenValue),e.viewModel.height>=e.outerViewport.height?i.css(a.overflowYProperty,a.autoValue):i.css(a.overflowYProperty,a.hiddenValue),r.setDisplayAreaScaleFactor(1),r.setWallpaperScaleFactor(1);var s=e.viewModel.width,l=e.viewModel.height+o;n.css({width:s+"px",height:l+"px"}),x(e,s,l),n.attr("class",t.DisplayAreaNameSelector.class+" "+E(e))}function x(e,t,i){var r={width:t,height:i};r.width>0&&r.height>0&&(e.forceSyncSizeUpdates?e.size=r:e.$evalAsync((function(){return e.size=r})))}function F(t,i,o,n,a,c,u,p,d,h,v,g){var f,y,m,S,w,C=h.getConfig(),b=C.displayOptions.hideOutspaceFormatting,x=1===h.getMode()&&!i.isCanvasBackdropVisible();switch(t){case 1:m=i.outspace=i.outspace||{},y="outspace",f=i.outspaceBackground,S=l.getDefaultCanvasOutspace(),w=d.getCurrentLayoutCapabilities().canShowCanvasOutspace();break;case 2:m=i.background=i.background||{},y="background",f=i.canvasBackground,S=l.getDefaultCanvasBackground(),w=d.getCurrentLayoutCapabilities().canShowCanvasBackground();break;default:debug.assertNever(t)}if(w){var F=n&&n[y];i.hasPopOut?(m.color=l.DefaultCanvasBackgroundColor,m.transparency=0,m.image=null):F?(m.color=e.DataViewObject.getFillColorByPropertyName(F,"color",l.DefaultCanvasBackgroundColor),m.transparency=e.DataViewObject.getValue(F,"transparency",l.DefaultCanvasBackgroundTransparency),m.image=F.image):D(m,S);var P=m.image,E=i.viewModel.contract.objects,T=s.getObjectDefinition(E,y,null),A=T&&T.properties.image;A&&e.data.SQExpr.isResourcePackageItem(A.url)?M(i,f,m,P,A.url,T,c,u,p,g,x,v,b,t):V(f,m,P,P?P.url:"",i.hasPopOut,g,x,v,b,t)}else D(m,S),V(f,S,null,"",i.hasPopOut,g,x,v,b,t);2===t&&(h&&C.displayOptions.extendBackgroundToWholeCanvas?o.css({"background-color":r.hexToRGBString(m.color,(100-m.transparency)/100)}):o.css({"background-color":""}))}function D(e,t){e.color=t.color,e.image=t.image,e.transparency=t.transparency}function V(t,i,n,a,s,l,c,u,p,d){void 0===p&&(p=!1),void 0===d&&(d=null);var h=n&&n.scaling,v=s?1:(100-i.transparency)/100;if(t.imageFitClass=h,t.imageSource=n&&a,t.imageStyle=h===e.visuals.imageScalingType.normal?{transform:"scale("+l.getWallpaperScaleFactor()+")"}:{},t.backgroundStyle||(t.backgroundStyle={}),t.backgroundStyle.opacity=v,t.backgroundStyle["background-color"]=p&&1===d?"transparent":r.hexToRGBString(i.color),2===d){var g=o.getThemeColor(u,"foregroundNeutralSecondary");t.displayAreaStyle||(t.displayAreaStyle={}),t.displayAreaStyle["box-shadow"]=p?"0 0 0":"0 0 10px rgba(200,200,200,"+v+")",t.displayAreaStyle.outline=c&&v<=.5?"2px dotted "+g:"none",t.imageStyle=h===e.visuals.imageScalingType.normal?{transform:"scale("+l.getDisplayAreaScaleFactor()+")"}:{}}}function M(t,i,r,o,n,a,s,l,c,p,d,h,v,g){void 0===v&&(v=!1);var f=l.getCurrentExploration();if(f){var y=t.viewModel.contract;u.loadAndResolveFromSQExpr(n,f.resourcePackages,s,c).then((function(s){var l=a.properties.image;y===t.viewModel.contract&&l&&e.data.SQExpr.equals(l.url,n)&&V(i,r,o,s.value||"",t.hasPopOut,p,d,h,v,g)}))}}function P(e,t){t&&t.outspace&&!e.isCanvasBackdropVisible()?e.canvasBackground.displayAreaStyle&&delete e.canvasBackground.displayAreaStyle["background-color"]:(e.canvasBackground.displayAreaStyle||(e.canvasBackground.displayAreaStyle={}),e.canvasBackground.displayAreaStyle["background-color"]=l.DefaultCanvasBackgroundColor)}function E(e){var t="";return e.useResponsiveLayout&&(t+=" responsive"),e.disableAnimations&&(t+=" disableAnimations"),8===(8&e.canvasViewStyle)&&(t+=" fitToScreen"),4===(4&e.canvasViewStyle)&&(t+=" fitToPage"),1===(1&e.canvasViewStyle)&&(t+=" fitToWidthOrigin"),2===(2&e.canvasViewStyle)&&(t+=" fitToWidthCentered"),256===(256&e.canvasViewStyle)&&(t+=" actualSizeAlignCenter"),512===(512&e.canvasViewStyle)&&(t+=" actualSizeAlignLeft"),64===(64&e.canvasViewStyle)&&(t+=" actualSizeAlignMiddle"),128===(128&e.canvasViewStyle)&&(t+=" actualSizeAlignTop"),32===(32&e.canvasViewStyle)&&(t+=" actualSizeCentered"),16===(16&e.canvasViewStyle)&&(t+=" actualSizeOrigin"),t.trim()}function T(e,t){return t&&t.getCapabilities().visualContainerOptions.useStylableHeader?0:e&&e.getCurrentLayoutCapabilities().canShowVisualContainerHeaderInset()?0:l.AutoLayoutVisualVCHeader}function A(e,t){if(1===t.getMode()){var i=e.background&&e.background.transparency;if(i&&i>=l.DisplayAreaTransparencyOutlineThreshold)return l.DisplayAreaOutlineSize}return 0}function I(e,r,o){if(e.viewModel&&e.viewModel.contract){var n=r.find(t.DisplayAreaContainerNameSelector.selector),a=v(r,N).find(B.selector),s=o.canvasScale.getDisplayOption(),l=T(o.formFactor,o.explorationCapabilities);switch(s){case 2:i(e,n,o.canvasScale,l);break;case 1:h(e,n,o.canvasScale,o.viewModeState,l);break;case 3:C(e,n,a,o.canvasScale,l);break;case 4:b(e,n,o.canvasScale,l);break;case 0:S(e,n,o.canvasScale,l);break;default:S(e,n,o.canvasScale,l)}o.eventBridge.publishToChannel(c.events.CanvasResized)}}function _(e,t){z=e.css(a.overflowXProperty),H=e.css(a.overflowYProperty),e.css(a.overflowXProperty,t),e.css(a.overflowYProperty,t)}function k(e){e.css(a.overflowXProperty,z),e.css(a.overflowYProperty,H)}function L(e){return{left:e.x,top:e.y,width:e.width,height:e.height}}function O(e){return{x:e.left,y:e.top,width:e.width,height:e.height}}function R(e){return e.width===l.DefaultCortanaWidth&&e.height===l.DefaultCortanaHeight}t.DisplayAreaNameSelector=n("displayArea"),t.DisplayAreaContainerNameSelector=n("displayAreaContainer"),t.VisualContainerHostSelector=n("visualContainerHost"),t.OutspaceContainerSelector=n("outspaceContainer"),t.OutspaceImageSelector=n("outspaceImage"),t.VisualBackgroundContainerSelector=n("visualBackgroundContainer"),t.VisualBackgroundImageSelector=n("visualBackgroundImage"),t.DefaultVisualPosition={x:100,y:100,width:300,height:300};var B=n("canvasBackdrop"),N=n("exploreCanvas"),z="",H="";t.fitToWidth=i,t.fitToPage=h,t.fitToScreen=S,t.getCanvasActualSize=w,t.displayInActualSize=C,t.displayInActualSizeTopLeft=b,t.updateCanvasSize=x,t.updateAndApplyBackground=F,t.setDisplayAreaBackground=P,t.convertDisplayOptionToStyle=E,t.getAutoLayoutVisualVCHeader=T,t.getCanvasOutlineSize=A,t.applyFitOption=I,t.storeOverflowValuesAndChange=_,t.restoreOverflowValues=k,t.visualPositionToRect=L,t.rectToVisualPosition=O,t.isCortanaPageSize=R})(i=t.CanvasDisplayUtility||(t.CanvasDisplayUtility={}))})(i=t.util||(t.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r,o=jsCommon.ArrayExtensions,n=e.explore.services.StaticResourceReferences;!(function(r){function a(e,t){return _.filter(e.visualContainers,(function(e){return e.isSelected}))}function s(e,t){for(var i=0,r=e;i<r.length;i++){var o=r[i];if(o.contract===t)return o}}function l(e,t,i){for(var r=[],o=t.getSelectedElements(),n=0,a=o;n<a.length;n++){var s=a[n];if(s.visualContainer){var l=c(s.visualContainer,i);r.push(e.serializeVisualContainer(l))}}return r}function c(e,t){return e.filters?u(e,new i.VariationToHierarchyRewriter(t)):e}function u(t,i){var r=o.rewriteArray(t.filters,(function(e){return p(e,i)}));return r!==t.filters?e.Prototype.inherit(t,(function(e){return e.filters=r})):t}function p(t,i){var r=t.filter;if(r){var o=r.rewrite(i);if(o!==r)return e.Prototype.inherit(t,(function(e){return e.filter=o}))}return t}function d(e,t){for(var i={},r=e.getSelectedElements(),o=0,a=r;o<a.length;o++){var s=a[o];if(s.visualContainer){var l=s.visualContainer.config.singleVisual.objects;n.addObjectsReferences(l,void 0,t,i)}}return i}function h(e,t,i){e=Math.max(0,e-t/2);var r=e+t-i;return r>0&&(e-=r),e}function v(e,t,r,n,a){var s=a.deserializeVisualContainer(e,!0,i.VisualContainerUtils.uniqueName(n.visualContainers)),l=s.layouts.withId(t);return l.position.z=F(r),s.layouts=o.extendWithId([l]),n.visualContainers.push(s),s}function g(e,i,r,o,n,a,s){if(e){for(var l=[],c=s.getCurrentLayout(),u=0,p=e.length;u<p;++u){for(var d=v(e[u],c,i,i.contract,o),h=d.layouts.withId(c).position;S(h,i)&&(h.x+=10,h.y+=10,2!==f(h,i)););f(h,i);var g=t.viewModels.ViewModelFactory.convertVisualContainer(r,i.contract,d,c);g&&(i.visualContainers.push(g),l.push(d))}t.services.selectionUtils.selectVisualContainers(l,n);for(var y=0,m=l;y<m.length;y++){var d=m[y];a.applyFilterOutput(d)}return l}}function f(e,t){var i=0;return e.x+e.width>t.width&&(e.x=Math.max(t.width-e.width,0),i++),e.y+e.height>t.height&&(e.y=Math.max(t.height-e.height,0),i++),i}function y(t,r,o,n,a){return __awaiter(this,void 0,e.Promise,(function(){var s;return __generator(this,(function(l){switch(l.label){case 0:return t.expr?[3,1]:(s=n.addEmptyVisualContainer(r,t.visualType,t.position),[3,3]);case 1:return[4,n.addVisualContainer({expr:t.expr,visualType:t.visualType,targetRole:t.targetRole,dataSources:o,allowAggregate:!0},r)];case 2:s=l.sent(),l.label=3;case 3:return a.logEvent(e.telemetry.EXCreateVisual,m(t.telemetrySource),i.VisualContainerUtils.getVisualType(s)),[2,s]}}))}))}function m(e){switch(e){case 0:return"CheckboxTickedInFieldList";case 3:return"DraggedToFieldWell";case 1:return"DraggedToCanvas";case 2:return"VisualTypeIconClicked";case 4:return"InsertVisualButton";case 5:return"WhatIfParameterControl";case 6:return"Qna"}}function S(e,t){return _.some(t.visualContainers,(function(t){return t.position.x===e.x&&t.position.y===e.y}))}function w(e,t,i){var r={x:e.x*t.x,y:e.y*t.y,z:e.z,width:e.width*t.x,height:e.height*t.y,angle:e.angle,tabOrder:e.tabOrder};if(i===!0){var o=Math.round(r.x),n=Math.round(r.y),a=Math.round(r.x+r.width),s=Math.round(r.y+r.height);r={x:o,y:n,z:r.z,width:a-o,height:s-n,angle:e.angle,tabOrder:e.tabOrder}}return r}function C(e,t){return{x:e.x/t.x,y:e.y/t.y,z:e.z,width:e.width/t.x,height:e.height/t.y,
angle:e.angle,tabOrder:e.tabOrder}}function b(e,t){return{left:e.left*t.x,top:e.top*t.y,width:e.width*t.x,height:e.height*t.y}}function x(e,t){return{left:e.left/t.x,top:e.top/t.y,width:e.width/t.x,height:e.height/t.y}}function F(e){return!e||_.isEmpty(e.visualContainers)?0:_.chain(e.visualContainers).map((function(e){return e.position&&e.position.z||0})).max().value()+1}r.getSelectedCanvasVisualContainers=a,r.findVisualContainerViewModel=s,r.serializeSelection=l,r.getSelectionResources=d,r.checkBoundaryForCharts=h,r.duplicateVisual=v,r.duplicateVisuals=g,r.addVisualContainerToCanvas=y,r.convertToScaledPosition=w,r.convertFromScaledPosition=C,r.convertToScaledRect=b,r.convertFromScaledRect=x,r.getZIndexForNewVisual=F})(r=i.CanvasVisualsUtility||(i.CanvasVisualsUtility={}))})(i=t.util||(t.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i,r=e.data.SQExprBuilder;!(function(t){function i(e,i){var r=s(e.objects,i);if(!r)return t.DefaultDataBarsSettings;var n,a=r.minValue;a&&(n=a.value);var l,c=r.maxValue;return c&&(l=c.value),{minValue:n,maxValue:l,positiveColor:o(r.positiveColor),negativeColor:o(r.negativeColor),axisColor:o(r.axisColor),reverseDirection:r.reverseDirection.value,hideText:r.hideText.value}}function o(e){var t=e.solid.color;return jsCommon.Color.isHexString(t.value)?{solid:{color:t.value}}:null}function n(){return a(t.DefaultDataBarsSettings,e.ValueType.fromPrimitiveTypeAndCategory(12))}function a(t,i){var o;void 0!==t.minValue&&(o=c(t.minValue,i));var n;return void 0!==t.maxValue&&(n=c(t.maxValue,i)),{minValue:o,maxValue:n,positiveColor:e.fillDefinitionHelpers.createSolidFillDefinition(t.positiveColor&&t.positiveColor.solid.color,"maxColor"),negativeColor:e.fillDefinitionHelpers.createSolidFillDefinition(t.negativeColor&&t.negativeColor.solid.color,"minColor"),axisColor:e.fillDefinitionHelpers.createSolidFillDefinition(t.axisColor&&t.axisColor.solid.color,"foreground"),reverseDirection:r.boolean(t.reverseDirection),hideText:r.boolean(t.hideText)}}function s(t,i){return e.VisualObjectRepetition.getDefinition(t,i)}function l(e,t){return void 0!==s(e,t)}function c(e,t){if(t.integer){var i=Math.round(e);return r.integer(i)}return 2===t.primitiveType?r.decimal(e):r.double(e)}t.DefaultDataBarsSettings={reverseDirection:!1,hideText:!1},t.getDataBarsSettings=i,t.createDefaultDataBarsDefinition=n,t.createDataBarsDefinition=a,t.getDefinition=s,t.isDataBarsApplied=l})(i=t.DataBarsUtil||(t.DataBarsUtil={}))})(i=t.util||(t.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){e.Field="field",e.Bookmark="bookmark",e.Sections="sections",e.VisualContainer="visualContainer",e.VisualContainerThumbnail="visual-container-thumbnail"})(t=e.DragDropTypes||(e.DragDropTypes={}))})(t=e.util||(e.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){function t(e,t){return e===t||e&&t&&e.UnitLength===t.UnitLength&&e.UnitDivisions===t.UnitDivisions}function i(t,i){var r=t/(i/e.CanvasLayout.UnitLength);return r=Math.floor(r),{UnitLength:r,UnitDivisions:_.find(n,(function(t){return 1===t||r/t>=e.MinimumUnitDivisionLength}))}}function r(e,t){return{x:o(e.x,t.width),y:o(e.y,t.height)}}function o(t,r){return i(i(t*r,r).UnitLength/e.CanvasLayout.UnitLength*r,r).UnitLength/e.CanvasLayout.UnitLength}e.CanvasLayout={UnitLength:96,UnitDivisions:12};var n=[12,6,4,3,2,1];e.MinimumUnitDivisionLength=8,e.sameLayout=t,e.getLayoutForScreen=i,e.adjustScaleForGrid=r})(t=e.DotGridUtil||(e.DotGridUtil={}))})(t=e.util||(e.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){function t(e){if(!e)return!1;var t=e.displayableErrorInfo;return!_.isEmpty(t)&&(!_.isEmpty(t[0].errorInfoKey)&&!_.isEmpty(t[0].errorInfoValue))}function i(e){return e in r?r[e]:0}var r={BlockedCustomVisual:1,ScriptVisualsNotEnabled:1,UnapprovedCustomVisual:1,CvApiVersionNotSupported:1};e.hasAdditionalErrorInfo=t,e.getErrorOverlayType=i})(t=e.ErrorDetailsUtility||(e.ErrorDetailsUtility={}))})(t=e.util||(e.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(){}return e.handled=function(e){if(e){var t=e;e.originalEvent&&(t=e.originalEvent);var i=t.handled;return void 0!==i&&i===!0}},e.markAsHandled=function(e){if(e){var t=e;e.originalEvent&&(t=e.originalEvent),t.handled=!0}},e})();e.EventBubblingUtility=t})(t=e.util||(e.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){function t(e,t,i){return!!i.isTrustedVisual(e)&&_.some(t.sections,(function(t){return _.some(t.visualContainers,(function(t){return t.config.singleVisual.visualType===e}))}))}function i(e,t){for(var i=[],r=0,o=e.sections;r<o.length;r++)for(var n=o[r],a=0,s=n.visualContainers;a<s.length;a++){var l=s[a],c=l.config.singleVisual.visualType;c&&t.isTrustedVisual(c)&&i.push(c)}return t.getConsentAndLoadVisuals(i)}e.explorationContainsTrustedVisual=t,e.acquireTrustedVisuals=i})(t=e.ExplorationTrustedVisualUtil||(e.ExplorationTrustedVisualUtil={}))})(t=e.util||(e.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i,r=e.explore.contracts.FilterType,o=e.explore.services.FormatPainter,n=jsCommon.JsonExtensions,a=e.common.dialog.MessageDialogBuilder,s=e.data.services.SemanticQuerySerializer;!(function(i){function l(i,r,n,s,l,u,p,d,h,v,g,f,y,m,S,w){function C(e,t){return _.find(e,(function(e){return e.name===t}))}function b(e,t){return _.find(e,(function(e){return e.name===t}))}function x(e){for(var t=0,i=e;t<i.length;t++){i[t].config.singleVisual.syncGroup=null}}function F(e){return _.filter(e,(function(e){return e.config.singleVisual.syncGroup}))}function D(e,t,o){var n=[],a=b(i.exploration.contract.sections,e);if(!a)return n;for(var s=0;s<o.length;s++){var l=o[s];if(g.capabilities(l.config.singleVisual.visualType).supportsSynchronizingFilterState&&l.config.singleVisual.query&&!l.config.singleVisual.syncGroup){var c=C(a.visualContainers,r.deserializeVisualContainer(t[s]).name);c&&n.push({sourceVisual:c,newVisual:l})}}return n}function V(){for(var e={},t=i.exploration.contract.sections,r=0,o=t;r<o.length;r++)for(var n=o[r],a=0,s=n.visualContainers;a<s.length;a++){var l=s[a],c=l.config.singleVisual.syncGroup;c&&(e[c.groupName]=!0)}return e}function M(t){return __awaiter(this,void 0,e.Promise,(function(){var e,i,r,o,n,a,s,c,h,v;return __generator(this,(function(f){switch(f.label){case 0:return[4,l.get(u.get())];case 1:for(e=f.sent(),i=V(),r=d("visualSync"),o=0,n=t;o<n.length;o++)a=n[o],s=a.sourceVisual.config.singleVisual,c=s.syncGroup,c?a.newVisual.config.singleVisual.syncGroup=__assign({},c):(h=p.getDisplayName(r.getVisualSyncField(s),e,g.capabilities(s.visualType)),v=r.generateUniqueGroupName(h,i),s.syncGroup={groupName:v,fieldChanges:!0},a.newVisual.config.singleVisual.syncGroup={groupName:v,fieldChanges:!0},i[v]=!0);return[2]}}))}))}var P=this;return{deleteSelection:function(){i.exploration&&i.exploration.exploreCanvas&&v.deleteSelectedVisuals(i.exploration.exploreCanvas)},deserializeAndDuplicateData:function(o,p,d,v){return __awaiter(P,void 0,e.Promise,(function(){var g,m,C,b,V,P,E,T,A;return __generator(this,(function(I){switch(I.label){case 0:return i.exploration&&i.exploration.exploreCanvas?v?[3,2]:[4,l.get(u.get())]:[2];case 1:for(g=I.sent(),m=0,C=d;m<C.length;m++)b=C[m],c(b,g);I.label=2;case 2:return V=t.CanvasVisualsUtility.duplicateVisuals(d,i.exploration.exploreCanvas,i.exploration.contract,r,h,f,y),w?1===o?[2]:(P=F(V),p===i.exploration.exploreCanvas.contract.name?(x(P),[2]):(E=D(p,d,V),_.isEmpty(P)&&_.isEmpty(E)?[2]:(T=new a(s),[4,T.show("syncVisuals",{titleText:n.get("SyncVisualsDialog_Title"),messageText:n.get("SyncVisualsDialog_Message"),okButtonText:n.get("SyncVisualsDialog_Sync"),cancelButtonText:n.get("SyncVisualsDialog_DoNotSync")})]))):[2];case 3:return A=0===I.sent(),S.logEvent(e.telemetry.EXCopyPasteSyncGroup,A,E.length),A?[4,M(E)]:[3,5];case 4:return I.sent(),[3,6];case 5:x(P),I.label=6;case 6:return[2]}}))}))},serializeSelection:function(){return __awaiter(P,void 0,e.Promise,(function(){var e,i,o;return __generator(this,(function(n){switch(n.label){case 0:return i=(e=t.CanvasVisualsUtility).serializeSelection,o=[r,h],[4,l.get(u.get())];case 1:return[2,i.apply(e,o.concat([n.sent()]))]}}))}))},getSelectionResources:function(){return t.CanvasVisualsUtility.getSelectionResources(h,i.exploration.contract.resourcePackages)},getSelectionSectionName:function(){return i.exploration.exploreCanvas.contract.name},deserializeVisualContainer:function(e){return r.deserializeVisualContainer(e,!0)},copyVisualFormat:function(){return o.copyFormatVisualConfig(h,g)},pasteVisualFormat:function(e){var t=o.pasteFormatVisualConfig(h,g,e);t&&v.raiseVisualContainerChanged(t)}}}function c(e,t){if(e.filters){for(var i=n.tryParseJSON(e.filters),o=0,a=i;o<a.length;o++){var s=a[o];if(s.type===r[r.Categorical]){var l=u(s.expression,t);l&&(s.filter.From[0].Entity=l)}}e.filters=JSON.stringify(i)}}function u(e,t){var i=e&&e.HierarchyLevel,r=i&&i.Expression&&i.Expression.Hierarchy,o=r&&r.Expression&&r.Expression.PropertyVariationSource;if(o){var n=s.deserializeExpr(o.Expression),a=n.getTargetEntity();return p(t,a&&a.entity,o.Property,o.Name)}}function p(e,t,i,r){for(var o=0,n=e.schemas;o<n.length;o++)for(var a=n[o],s=0,l=a.entities;s<l.length;s++){var c=l[s];if(c.name===t)for(var u=0,p=c.properties;u<p.length;u++){var d=p[u];if(d.name===i){var h=d.column;if(h&&h.variations)for(var v=0,g=h.variations;v<g.length;v++){var f=g[v];if(f.name===r)return f.navigationProperty.targetEntity.name}}}}}i.createClipboardHandler=l})(i=t.ExploreClipboardHandlerUtility||(t.ExploreClipboardHandlerUtility={}))})(i=t.util||(t.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i=(function(){function t(){}return t.getDefaultVisualPlugin=function(t){return t&&t.featureSwitches&&t.featureSwitches.pivotTableVisualEnabled?e.visuals.plugins.tableEx:e.visuals.plugins.table},t})();t.FieldWellUtility=i})(i=t.util||(t.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){function t(e,t){var i=[];if(!e||!t)return i;for(var r=0,o=e;r<o.length;r++){var n=o[r];i.push(t(n))}return i}function i(){return{type:1}}e.getMenuItems=t,e.createSeparator=i})(t=e.MenuItemUtility||(e.MenuItemUtility={}))})(t=e.util||(e.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r,o=e.explore.util.CanvasDisplayUtility,n=t.constants.ExploreCanvasConstants;!(function(i){function r(t){for(var i=[],r=0,o=t;r<o.length;r++){var n=o[r];i.push({value:n.value.toString(),displayName:e.explore.viewModels.ViewModelFactory.getDisplayName(n.displayName)})}return i}function a(t){void 0===t&&(t=!1);for(var i=e.visuals.valueFormatter.getDisplayUnits(t),r=[],o=0,n=i;o<n.length;o++){var a=n[o];r.push({displayName:a.title,value:a.value.toString()})}return r}function s(e,t){return l(e,t.getCurrentExploration(),t.getCurrentSection())}function l(e,r,a){if(0===e.displayOption)return i.PageSizeTypes.Dynamic;if(e.width===t.constants.ExploreCanvasConstants.DefaultCanvasWidth&&e.height===n.DefaultCanvasHeight)return i.PageSizeTypes.Standard;if(e.width===t.constants.ExploreCanvasConstants.DefaultWidescreenWidth&&e.height===n.DefaultWidescreenHeight)return i.PageSizeTypes.Widescreen;if(o.isCortanaPageSize(e)){var s=t.PodUtils.findPodIndexForSectionName(r,a.name);return s!==-1&&r.pods[s].cortanaEnabled?i.PageSizeTypes.Cortana:i.PageSizeTypes.Custom}return e.width===t.constants.ExploreCanvasConstants.DefaultLetterWidth&&e.height===n.DefaultLetterHeight?i.PageSizeTypes.Letter:u(e)?i.PageSizeTypes.Tooltip:i.PageSizeTypes.Custom}function c(e){return i.PageSizeTypesToSectionSize[e]}function u(e){return e.width===t.constants.ExploreCanvasConstants.DefaultTooltipWidth&&e.height===t.constants.ExploreCanvasConstants.DefaultTooltipHeight}var p;i.PageSizeTypes={Dynamic:"Dynamic",Standard:"Standard",Widescreen:"Widescreen",Cortana:"Cortana",Letter:"Letter",Tooltip:"Tooltip",Custom:"Custom"},i.PageSizeTypesToSectionSize=(p={},p[i.PageSizeTypes.Dynamic]={displayOption:0,width:t.constants.ExploreCanvasConstants.DefaultCanvasWidth,height:t.constants.ExploreCanvasConstants.DefaultCanvasHeight},p[i.PageSizeTypes.Standard]={displayOption:1,width:t.constants.ExploreCanvasConstants.DefaultCanvasWidth,height:t.constants.ExploreCanvasConstants.DefaultCanvasHeight},p[i.PageSizeTypes.Widescreen]={displayOption:1,width:t.constants.ExploreCanvasConstants.DefaultWidescreenWidth,height:t.constants.ExploreCanvasConstants.DefaultWidescreenHeight},p[i.PageSizeTypes.Cortana]={displayOption:3,width:t.constants.ExploreCanvasConstants.DefaultCortanaWidth,height:t.constants.ExploreCanvasConstants.DefaultCortanaHeight},p[i.PageSizeTypes.Letter]={displayOption:1,width:t.constants.ExploreCanvasConstants.DefaultLetterWidth,height:t.constants.ExploreCanvasConstants.DefaultLetterHeight},p[i.PageSizeTypes.Tooltip]={displayOption:1,width:t.constants.ExploreCanvasConstants.DefaultTooltipWidth,height:t.constants.ExploreCanvasConstants.DefaultTooltipHeight},p[i.PageSizeTypes.Custom]={displayOption:3,width:t.constants.ExploreCanvasConstants.DefaultCanvasWidth,height:t.constants.ExploreCanvasConstants.DefaultCanvasHeight},p),i.getDisplayNames=r,i.getDisplayUnits=a,i.getPageSizeType=s,i.getPageSizeTypeBySection=l,i.getDefaultSectionSize=c})(r=i.PropertyPaneUtils||(i.PropertyPaneUtils={}))})(i=t.util||(t.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(e){this.container=e,this.context={pendingGeocodingCount:0}}return e.prototype.newQuery=function(){var e=0!==this.context.pendingGeocodingCount;this.context={pendingGeocodingCount:0},e&&this.container.onStopGeocoding()},e.prototype.hasPendingGeocoding=function(){return this.context.pendingGeocodingCount>0},e.prototype.wrapGeocoder=function(e){return{geocode:this.wrapAsyncGeocoderMethod(e,e.geocode),geocodeBoundary:this.wrapAsyncGeocoderMethod(e,e.geocodeBoundary),geocodePoint:this.wrapAsyncGeocoderMethod(e,e.geocodePoint),tryGeocodeImmediate:function(t){return e.tryGeocodeImmediate(t)},tryGeocodeBoundaryImmediate:function(t,i,r,o,n,a){return e.tryGeocodeBoundaryImmediate(t,i,r,o,n,a)}}},e.prototype.wrapAsyncGeocoderMethod=function(e,t){var i=this;return function(){for(var r=[],o=0;o<arguments.length;o++)r[o]=arguments[o];var n=i.context,a=t.apply(e,r);1===++n.pendingGeocodingCount&&i.container.onStartGeocoding();var s=function(){n===i.context&&--n.pendingGeocodingCount<=0&&i.container.onStopGeocoding()};return a.then(s,s),a}},e})();e.QueryGeocodingTracker=t})(t=e.util||(e.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){function t(e,t,i){return e?i.get(e):t.reject()}function i(e,t){Object.defineProperty(e,"dataSources",{get:function(){return t.get()},set:function(e){return t.set(e)}})}e.getSchemaPromise=t,e.defineDataSourcesOnScopeLegacy=i})(t=e.ScopeUtils||(e.ScopeUtils={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){function i(e){for(var t={},i=0,r=e.schemas;i<r.length;i++)for(var o=r[i],n=0,a=o.entities;n<a.length;n++){var s=a[n];if(s.properties)for(var l=0,c=s.properties;l<c.length;l++){var u=c[l],p=u.column;if(p&&p.variations)for(var d=0,h=p.variations;d<h.length;d++){var v=h[d],g=v.navigationProperty;if(!v.navigationProperty)return;var f=g.targetEntity,y=v.defaultHierarchy;t[f.name]={variationName:v.name,sourceEntity:s.name,sourceProperty:u.name,hierarchy:y.name}}}}return t}var r=jsCommon.ArrayExtensions,o=e.data.DefaultSQExprVisitor,n=e.data.SQEntityExpr,a=e.data.SQHierarchyExpr,s=e.data.SQHierarchyLevelExpr,l=e.data.SQInExpr,c=e.data.SQNotExpr,u=e.data.SQPropertyVariationSourceExpr,p=(function(e){function t(t){var r=e.call(this)||this;return r.mappings=i(t),r}return __extends(t,e),t.prototype.visitEntity=function(e){var t=this.mappings[e.entity];return t?new n(e.schema,t.sourceEntity):e},t.prototype.visitColumnRef=function(e){var t=e.source.accept(this);if(t!==e.source){var i=this.mappings[e.source.entity];return new s(new a(new u(t,i.variationName,i.sourceProperty),i.hierarchy),e.ref)}return e},t.prototype.visitNot=function(e){var t=e.arg.accept(this);return e.arg!==t?new c(t):e},t.prototype.visitIn=function(e){var t=this,i=r.rewriteArray(e.args,(function(e){return e.accept(t)}));return e.args!==i?new l(i,e.values,e.table):e},t.prototype.visitDefault=function(e){return e},t})(o);t.VariationToHierarchyRewriter=p})(i=t.util||(t.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){function r(e,t,i,r,o,n,a,s,l,c,u,p,d,h,v,g,f,y,m,S){return new Q(e,t,i,r,o,n,a,s,l,c,u,p,d,h,v,g,f,y,m,S)}function o(t,i,r){var o=_.filter(r.filters,(function(e){return 5===e.howCreated}));t.logEvent(e.telemetry.EXDrillthroughFilterUpdate,i,o.length)}function n(e,t,i,r){var o=e.getMetadata(t);if(o.type.geography)return D.name;var n=k.asFieldPattern(e);if(i&&n){var a=n.column||n.groupingColumn,l=a&&a.name,c=n.hierarchyLevel&&n.hierarchyLevel||n.columnHierarchyLevelVariation&&n.columnHierarchyLevelVariation.level;if(c){var u=c.level;if(i.isGeographic(u))return D.name;var p=R.getConceptualHierarchyLevel(t,c.schema,c.entity,c.name,u);l=p&&p.column&&p.column.name}if(l&&i.isGeographic(l))return D.name}var d=n.column,h=d&&t.schema(d.schema).findProperty(d.entity,d.name).column;return h&&h.parameterMetadata&&1===h.defaultAggregate?T.name:s(e,o,t)?f.name:r&&r.pivotTableVisualEnabled?z.name:N.name}function a(e,t,i,r){if(e.config&&e.config.singleVisual){var o=e.config.singleVisual,n=r.capabilities(o.visualType);if(i.shouldApplyDefaultSort(o,n)){var a=o.query,s=a.defn,l=a.projections,c=s.select(),u=[],p=_.filter(n.dataRoles,(function(e){return!(_.has(e,"joinPredicate")||0===e.joinPredicate)}));if(_.some(p,(function(e){var i=V.getRole(l,e.name);if(i){var r=_.map(i.all(),(function(e){return c.withName(e.queryRef)}));return _.some(r,(function(e){return e.expr&&!_.isEmpty(e.expr.getOrderByColumns(t))}))}})))return void(o.hasDefaultSort&&(o.query=new j(s.orderBy([]),a.projections,a.expansionStates),o.hasDefaultSort=!1));for(var d=!1,h=0,v=p;h<v.length;h++){var g=v[h],f=V.getRole(l,g.name);if(f){var y=_.map(f.all(),(function(e){return e.queryRef}));if(y){for(var m=!1,S={direction:1,expr:null},w=0,C=y;w<C.length;w++){var b=C[w],x=c.withName(b),F=x&&x.expr;if(F&&O.isExprValidForSorting(F)){var D=F.getMetadata(t);if(D){var M=1===D.kind&&D.type.numeric;if(null==S.expr&&(F&&M&&(S.direction=2),S.expr=F),D.type.temporal){m=d=!0;break}if(M){m=!0;break}}}}if(m&&(_.isEmpty(u)||d)&&(u=[S]),d)break}}}_.isEmpty(u)||(o.hasDefaultSort=!0,o.query=new j(s.orderBy(u),a.projections,a.expansionStates))}}}function s(e,t,i){return 1===t.kind||t.type.numeric&&!O.discourageAggregation(e,i)}function l(e){var t;switch(e&&(t=e.kind),t){case 0:return"Entity";case 2:return"ColumnRef";case 3:return"MeasureRef";case 4:return"Aggregation";case 5:return"PropertyVariationSource";case 6:return"Hierarchy";case 7:return"HierarchyLevel";default:return"Other"}}function c(e){switch(e){case x.Advanced:return"Advanced";case x.Categorical:return"Categorical";case x.Passthrough:return"Passthrough";case x.Range:return"Range";case x.Visual:return"Visual"}}function u(e){switch(e){case 2:return"Exploration";case 1:return"Section";case 0:return"Visual"}}function p(e){switch(e){case 0:return"View";case 1:return"Edit"}}var d=e.visuals.plugins.actionButton,h=e.visuals.ActionButtonType,v=jsCommon.ArrayExtensions,g=e.visuals.plugins.basicShape,f=e.visuals.plugins.clusteredColumnChart,y=e.explore.constants,m=e.data.DataViewObjectDefinitions,S=e.data.DataViewObjectDescriptors,w=e.data.DataViewRoleWildcard,C=e.explore.util.DrillUtils,b=t.services.events,x=t.contracts.FilterType,F=e.explore.util.HierarchyUtils,D=e.visuals.plugins.map,V=e.data.QueryProjectionsByRole,M=e.contracts.ResourcePackageItemType,P=t.services.selectionUtils,E=e.data.SemanticFilter,T=e.visuals.plugins.slicer,A=e.data.SQExpr,I=e.data.SQExprBuilder,k=e.data.SQExprConverter,L=e.data.SQExprHierarchyToHierarchyLevelConverter,O=e.data.SQExprUtils,R=e.data.SQHierarchyExprUtils,B=e.data.SQScopedEvalExpr,N=e.visuals.plugins.table,z=e.visuals.plugins.tableEx,H=e.visuals.TablixPropertyManager,$=e.explore.contracts.VisualContainer,U=e.explore.util.VisualContainerUtils,j=t.contracts.VisualQuery,G=e.explore.contracts.VisualLink;i.createVisualAuthoringOperations=r;var Q=(function(){function r(e,i,r,o,n,a,s,l,c,u,p,d,h,v,g,f,y,m,S,w){this.visualPluginService=e,this.pluginOps=i,this.displayNameService=r,this.telemetry=o,this.explorationNavigationService=n,this.selectionService=a,this.geotaggingAnalyzerService=s,this.explorationSerializer=l,this.eventBridge=c,this.featureSwitchService=u,this.sortService=p,this.visualRelationshipService=d,this.drill=h,this.expandCollapse=v,this.filterGenerator=g,this.aggrOps=f,this.resourceRegistration=y,this.formFactorProvider=m,this.localizationService=S,this.viewModeState=w,this.core=t.services.createVisualAuthoringCore(e,s,f,u)}return r.prototype.addFieldToVisual=function(t,i,r,o){if(!r)return!1;var n=r.config.singleVisual,s=n.query,c=this.visualPluginService.capabilities(n.visualType),u=this.addHierarchyLevelToExistingHierarchiesInVisual(t,c,r.config,i)||this.addExpressionToVisualWithoutAggregation(t,r,c,i)||this.addExpressionToVisualForcingAggregation(t,r,c,i)||this.addExpressionToVisual(t,r,c,i),p=i.getConceptualProperty(t),d=p&&p.measure&&p.measure.template&&p.measure.template.name;return u?(this.ensureValidDrillMode(r),this.ensureDefaultFilterAndRaiseEvent(t,r,!1),a(r,t,this.sortService,this.visualPluginService),void 0!==o&&this.telemetry.logEvent(e.telemetry.EXAddField,o,U.getVisualType(r),l(i),U.hasGroupByItemsInQuery(r),!0,d),!0):(r.config.singleVisual.query=s,void 0!==o&&this.telemetry.logEvent(e.telemetry.EXAddField,o,U.getVisualType(r),l(i),U.hasGroupByItemsInQuery(r),!1,d),!1)},r.prototype.addFieldInRole=function(t,i,r,o,n){var s=this.getVisualDataRole(o,r);if(!s)return!1;var c;this.shouldPreferGroupToAggregate(t,i,o,s)||(i=this.createExprWithAggregate(i,t,!0,s),c=!0);var u=this.canHierarchyLevelJoinExistingGroup(t,o.config.singleVisual.query,r,i,n),p=this.getTargetRoleAndExpressionsForAdd(t,o,i,r),d=c||u?i:p&&p.expressions,h={expr:d,schema:t,targetRole:r,targetIndex:n},v=i.getConceptualProperty(t),g=v&&v.measure&&v.measure.template&&v.measure.template.name;return this.core.add(h,o.config)?(this.ensureValidDrillMode(o),this.ensureDefaultFilterAndRaiseEvent(t,o,!1),a(o,t,this.sortService,this.visualPluginService),this.telemetry.logEvent(e.telemetry.EXAddField,"DraggedToFieldWell",U.getVisualType(o),l(i),U.hasGroupByItemsInQuery(o),!0,g),!0):(this.telemetry.logEvent(e.telemetry.EXAddField,"DraggedToFieldWell",U.getVisualType(o),l(i),U.hasGroupByItemsInQuery(o),!1,g),!1)},r.prototype.expandHierarchy=function(e,t,i,r,o){var n=(t.config.singleVisual.query.tryGetExprs(i)||[]).slice(r,r+o);if(_.isEmpty(n))return!1;var a=n[0];if(A.isHierarchyLevel(a)){var s=a.arg,l=R.expandExpr(e,s);if(_.isArray(l)){var c=l.length;if(o<c){for(var u=t.config.singleVisual.query,p=!1,d=0;d<c;d++)if(!A.equals(u.tryGetExpr(i,r+d),l[d])){if(!this.core.add({expr:l[d],schema:e,targetRole:i,targetIndex:r+d},t.config))break;p=!0}return p&&this.notifyVisualContainers([t]),p}}}return!1},r.prototype.removeField=function(e,t){var i=P.getSelectedVisuals(this.selectionService),r=R.expandExpr(t,e,!0),o=this.removeFieldImpl(e,i,t);return _.isArray(r)&&(o=this.removeFieldImpl(r,i,t)||o),o},r.prototype.removeProjection=function(e,t){var i=P.getSelectedVisual(this.selectionService);return!!i&&this.invokeRemoveOnSelectedVisuals(e,[i],t)},r.prototype.removeInvalidExpressions=function(e,t){var i=t.config.singleVisual;if(!i||!i.query)return!1;for(var r=[],o=0,n=i.query.defn.select();o<n.length;o++){var a=n[o],s=a.expr;_.isEmpty(s.validate(e,this.aggrOps))||r.push(s)}for(var l=0,c=r;l<c.length;l++){var u=c[l];this.removeFiltersWithExpr(u,t)}return this.removeFieldImpl(r,[t],e),!0},r.prototype.moveProjection=function(e,t,i,r,o,n){var s=P.getSelectedVisual(this.selectionService);if(!s)return!1;var l;if(t!==i){var c=this.getVisualDataRole(s,i),u=F.getHierarchyReplacementExpressions(s.config,t,r,n,c);if(_.isEmpty(u))return!1;l=u}var p={sourceRole:t,targetRole:i,sourceIndex:r,targetIndex:o,sourceCount:n,replacementExpressions:l,schema:e,allowPartialReplace:!0},d=s.config.singleVisual.query,h=C.getDrillFilterRemovalInfoList(d,p,1);if(this.core.replace(p,s.config)){this.ensureValidDrillState(s,h),a(s,e,this.sortService,this.visualPluginService),this.notifyVisualContainers([s]);var v=s.config.singleVisual.query,g=v.tryGetExpr(i,o);return this.logReportMeasureMoveTelemetry(e,s,t,i,g),!0}return!1},r.prototype.drillDownLevel=function(t,i,r){if(i){var o=U.getVisualType(i),n=this.telemetry.startEvent(e.telemetry.EXInteractionExpand,o,2===r),a=i.config.singleVisual,s=_.isEmpty(t)?[]:[t];if(_.isEmpty(s)){var l=this.visualPluginService.capabilities(a.visualType);s=C.getDrillableRoles(l)}if(!_.isEmpty(s))for(var c=0,u=s;c<u.length;c++){var p=u[c];if(p){var d=this.core.changeActiveProjection(p,a,r);if(d)return 2===r&&this.expandCollapse.isEnabled(i,[p])&&this.expandCollapse.expandLevel(i,[p],d.length-2,!0),this.notifyVisualContainers([i]),void n.resolve()}}n.reject()}},r.prototype.replaceProjection=function(e,t,i,r,o){var n={sourceRole:i,targetRole:i,sourceIndex:r,targetIndex:r,sourceCount:1,replacementExpressions:[t],schema:e};return!!this.core.replace(n,o.config)&&(this.ensureValidDrillMode(o),this.resetSearchProperties(o),this.ensureDefaultFilterAndRaiseEvent(e,o,!1),!0)},r.prototype.drillDown=function(t,i,o,n){var a=U.getVisualType(o),s=this.telemetry.startEvent(e.telemetry.EXInteractionDrill,a,!0),l=o.config.singleVisual;if(l.clearSelectedDataPoints(),_.isEmpty(i)||_.isEmpty(i[0].dataMap))return!1;o.filters||(o.filters=[]);var c=i[0].dataMap,u=l.query,p=_.isEmpty(n)?[]:[n];if(_.isEmpty(p)){var d=this.visualPluginService.capabilities(l.visualType);p=C.getDrillableRoles(d)}if(!_.isEmpty(p))for(var h=function(e){var i=u.projections[e],n=i&&i.activeProjectionRefs,a=_.filter(c,(function(e,t){return _.includes(n,t)}));if(!_.isEmpty(a)){var p=u.currentDrillMode(e)||2,d=v.core.changeActiveProjection(e,l,p);if(d){if(2===p&&v.expandCollapse.isEnabled(o,[e])){var h=_.uniq(d);v.expandCollapse.expandLevel(o,[e],h.length-2,!0)}for(var g=0,f=a;g<f.length;g++){var y=f[g];v.core.addDrillFilter(t,o.filters,u,n,r.chooseRepetitionSelectorForDrill(y))}var m=v.explorationNavigationService.getCurrentSection();return v.filterGenerator.updateCrossFilterOnDrill(m,o),v.notifyVisualContainers([o]),s.resolve(),{value:!0}}}},v=this,g=0,f=p;g<f.length;g++){var y=f[g],m=h(y);if("object"==typeof m)return m.value}return s.reject(),!1},r.chooseRepetitionSelectorForDrill=function(e){if(e=v.ensureArray(e),1===e.length)return e[0];for(var t,i=0,r=e;i<r.length;i++){var o=r[i];t||(t=o),o.key.length>t.key.length&&(t=o)}return t},r.prototype.drillUp=function(t,i){if(i){var r=U.getVisualType(i),o=this.telemetry.startEvent(e.telemetry.EXInteractionDrill,r,!1),n=i.config.singleVisual,a=n.query,s=_.isEmpty(t)?[]:[t];if(_.isEmpty(s)){var l=this.visualPluginService.capabilities(i.config.singleVisual.visualType);s=C.getDrillableRoles(l)}if(!_.isEmpty(s))for(var c=0,u=s;c<u.length;c++){var p=u[c],d=this.core.changeActiveProjection(p,n,1);if(!_.isEmpty(d)){var h=_.last(d),v=a.defn.select().withName(h).expr,g=a.currentDrillMode(p)||2;if(2===g&&this.expandCollapse.isEnabled(i,[p])){var f=_.uniq(d);this.expandCollapse.collapseLevel(i,[p],f.length-1)}var y=this.core.removeDrillFilter(i.filters,v);if(y){var m=this.explorationNavigationService.getCurrentSection();this.filterGenerator.updateCrossFilterOnDrill(m,i)}return this.notifyVisualContainers([i]),void o.resolve()}}o.reject()}},r.prototype.setDrillFilterOtherVisualsSetting=function(e){var t=P.getSelectedVisual(this.selectionService);t&&this.setVisualDrillFilterOtherVisualsSetting(t,e)},r.prototype.drillToDetails=function(t,i,r,o,n,a){var s=!1;if(_.some(r)&&(s=A.isAggregation(_.head(r))&&1===r.length||_.every(r,(function(e){return A.isMeasure(e)}))),s){var c=$.clone(n,this.explorationSerializer);this.addDrillToDetailsFilters(i,c,o);var u=c.config.singleVisual,p={name:t,config:{singleVisual:u},layouts:n.layouts,filters:c.filters};if(u.visualType!==e.visuals.plugins.tableEx.name){var d=this.convert(i,p,e.visuals.plugins.tableEx.name);if(!d)return}u=p.config.singleVisual;(u.vcObjects=u.vcObjects||{}).stylePreset=[{properties:{name:I.text("Default")}}];var h=u.objects={};m.setValue(h,H.PropTotalTableExTotals,void 0,I.boolean(!1));for(var v=u.query,g=0,f=r;g<f.length;g++){var y=f[g],S=y.getTargetEntity();A.isAggregation(y)?(this.removeAggregatesAndMeasures(i,p,!1),this.removeTableReferences(p),this.addDetailTableProperties(i,S,p),v.defn=v.defn.addGroupBy(S)):(this.addDetailTableProperties(i,S,p,!0,a),this.removeAggregatesAndMeasures(i,p,!0),this.removeTableReferences(p));var w=U.getVisualType(n);this.telemetry.logEvent(e.telemetry.EXDrillToDetails,w,l(y))}return p}},r.prototype.removeAggregatesAndMeasures=function(e,t,i){for(var r=t.config.singleVisual.query,o=r.defn.select(),n=function(e){var t=e.expr;if(O.isMeasure(t)&&i===!1||A.isAggregation(t)&&i===!0){var o=r.getRoleNameForExpr(t),n=V.getRole(r.projections,o),a=_.findIndex(n.all(),(function(t){return t.queryRef===e.name}));r.removeAggregate(o,a)}A.isMeasure(t)&&i===!1&&r.removeExpr(t,!1)},a=0,s=o;a<s.length;a++){n(s[a])}},r.prototype.removeTableReferences=function(e){for(var t=e.config.singleVisual.query,i=t.defn.select(),r=0,o=i;r<o.length;r++){var n=o[r];A.isEntity(n.expr)&&t.removeExpr(n.expr,!1)}},r.prototype.addDetailTableProperties=function(e,t,i,r,o){for(var n=i.config.singleVisual.query,a=O.getConceptualEntity(t,e),s=n.defn.select(),l=0,c=s;l<c.length;l++){var u=c[l],p=u.expr,d=p.getTargetEntity();if(!_.isEqual(t,d)){var h=0;if(!O.isRelatedOneToOne(e,t,d,h)){O.isRelatedToMany(e,d,t,h)||n.removeExpr(p,!1)}}}for(var v=a.properties,g=0,f=v;g<f.length;g++){var y=f[g];if(!y.hidden&&(1!==y.kind||!o)&&(1!==y.kind&&!y.type.integer&&!y.type.numeric||r)&&(!y.type.dateTime||!y.column||_.isEmpty(y.column.variations))){var m=void 0;m=1===y.kind?I.measureRef(t,y.name):I.columnRef(t,y.name);n.defn.selectNameOf(m)||this.addFieldToVisual(e,m,i)}}},r.prototype.setAggregate=function(e,t,i,r,o){var n={role:t,index:i,newAggregate:r,schema:e};return!!this.core.setAggregate(n,o.config)&&(a(o,e,this.sortService,this.visualPluginService),this.notifyVisualContainers([o]),!0)},r.prototype.removeAggregate=function(e,t,i,r){var o={role:t,index:i,schema:e};return!!this.core.removeAggregate(o,r.config)&&(a(r,e,this.sortService,this.visualPluginService),this.notifyVisualContainers([r]),!0)},r.prototype.setPercentOfGrandTotal=function(e,t,i,r){var o={role:t,index:i,schema:e};return!!this.core.setPercentOfGrandTotal(o,r.config)&&(this.ensureValidDrillMode(r),this.notifyVisualContainers([r]),!0)},r.prototype.removePercentOfGrandTotal=function(e,t,i,r){var o={role:t,index:i,schema:e};return!!this.core.removePercentOfGrandTotal(o,r.config)&&(this.notifyVisualContainers([r]),!0)},r.prototype.setPercentOfRoleTotal=function(e,t,i,r,o){var n={roleRefs:t,role:i,index:r,schema:e};return!!this.core.setPercentOfRoleTotal(n,o.config)&&(this.ensureValidDrillMode(o),this.notifyVisualContainers([o]),!0)},r.prototype.removePercentOfRoleTotal=function(e,t,i,r){
var o={role:t,index:i,schema:e};return!!this.core.removePercentOfRoleTotal(o,r.config)&&(this.notifyVisualContainers([r]),!0)},r.prototype.setVariation=function(e,t,i,r,o,n){if(n=n||1,o<0)return!1;for(var s=[],l=0;l<n;l++)if(s[l]=t.config.singleVisual.query.tryGetExpr(r,o+l),!s[l])return!1;var c=[i];if(A.isHierarchy(i)&&(c=L.convert(i,e),!c))return!1;var u=this.getVisualDataRole(t,r),p=F.getHierarchyReplacementExpressions(t.config,r,o,n,u,c);if(_.isEmpty(p))return!1;var d=p,h={sourceRole:r,targetRole:r,sourceIndex:o,targetIndex:o,sourceCount:s.length,replacementExpressions:d,schema:e,allowPartialReplace:!0},v={count:s.length,index:o,role:r},g=C.getDrillFilterRemovalInfoList(t.config.singleVisual.query,v,0),f=this.core.replace(h,t.config);return f&&(this.ensureValidDrillState(t,g),a(t,e,this.sortService,this.visualPluginService),this.notifyVisualContainers([t])),f},r.prototype.toggleShowAll=function(e,t){t&&(this.core.toggleShowAll(e,t.config),this.notifyVisualContainers([t]))},r.prototype.createVisualContainerConfig=function(e,t){return this.createVisualContainerConfigCore(t,e)},Object.defineProperty(r.prototype,"featureSwitches",{get:function(){return this.featureSwitchService.featureSwitches},enumerable:!0,configurable:!0}),r.prototype.addDrillToDetailsFilters=function(e,t,i){if(!_.isEmpty(i)&&i[0]&&!_.isEmpty(i[0].dataMap)){var o=U.getVisualQuery(t);if(o){var n=[];if(o.projections)for(var a in o.projections)_.isEmpty(o.projections[a].activeProjectionRefs)||n.push(o.projections[a].activeProjectionRefs);var s=i[0].dataMap;t.filters=t.filters||[];var l;for(l in s){var c=_.find(n,(function(e){return _.includes(e,l)}));this.core.addDrillToDetailsFilter(e,t.filters,o,c||[l],r.chooseRepetitionSelectorForDrill(s[l]))}}}},r.prototype.findCompatibleRole=function(r,o,n){var a=o.config.singleVisual,s=a.query||new j(e.data.SemanticQuery.create(),{},[]),l=this.visualPluginService.capabilities(a.visualType),c=s&&s.projections;if(l&&c){var u=e.requireSync("Explore/services/visualCapabilitiesHelper").create(l,this.geotaggingAnalyzerService);return u&&u.findCompatibleRole({queryProjections:c,schema:r,expr:n,roleToExprMap:new t.utils.SQExprToRoleDictionary(i.HierarchyUtils.hierarchyLevelComparer),preferDrillableRoles:!1})}},r.prototype.getMaxNumberOfExpressionsAllowedInRole=function(t,i,r){var o=i.config.singleVisual,n=o.query||new j(e.data.SemanticQuery.create(),{},[]),a=this.visualPluginService.capabilities(o.visualType),s=n&&n.projections;if(a&&s){var l=e.requireSync("Explore/services/visualCapabilitiesHelper").create(a,this.geotaggingAnalyzerService),c=C.getDrillableRoles(a);if(_.includes(c,r))return Number.MAX_VALUE;var u=l.getNumberRangesForRoles(n),p=u[r];if(p&&p.max)return p.max}return 0},r.prototype.getTargetRoleAndExpressionsForAdd=function(e,t,i,r){var o=i;if(R.isHierarchyOrVariation(e,i)&&(o=R.expandExpr(e,i),_.isArray(o))){var n=o;if(!r){var a=this.findCompatibleRole(e,t,n[0]);a&&(r=a.name)}if(r){var s=this.getMaxNumberOfExpressionsAllowedInRole(e,t,r);s!==Number.MAX_VALUE&&(o=1===s&&A.isColumn(i)?i:A.isHierarchy(i)||A.isColumn(i)?n.slice(0,s):n.slice(n.length-s,n.length))}}return{targetRole:r,expressions:o}},r.prototype.addExpressionToVisualWithoutAggregation=function(t,i,r,o){var n=r&&e.ScriptResultUtil.findScriptResultMapping(r.dataViewMappings),a=this.getTargetRoleAndExpressionsForAdd(t,i,o);return a.targetRole&&r.dataRoles[a.targetRole]!==e.VisualDataRoleKind.Measure||(a.expressions instanceof Array&&(a.expressions=o),n||this.shouldPreferGroupToAggregate(t,o,i)||(a.expressions=this.createExprWithAggregate(a.expressions,t,!1))),this.core.add({expr:a.expressions,schema:t,targetRole:a.targetRole},i.config)},r.prototype.addExpressionToVisualForcingAggregation=function(e,t,i,r){var o=this.createExprWithAggregate(r,e,!0);return this.core.add({expr:o,schema:e},t.config)},r.prototype.addExpressionToVisual=function(e,t,i,r){return this.core.add({expr:r,schema:e},t.config)},r.prototype.createVisualContainerConfigCore=function(e,t){var i,r=e.expr,o=r instanceof Array;!e.allowAggregate||o||this.shouldPreferGroupToAggregate(t,r)||(r=this.createExprWithAggregate(r,t,!1));var a=o?r[0]:r,s=e.visualType||n(a,t,this.geotaggingAnalyzerService,this.featureSwitches),l={expr:i?e.expr:r,schema:t,visualType:s};return this.core.create(l)},r.prototype.addVisualContainerImageFromData=function(e,t,i){var r="data:image/png;base64,"+t,o=this.resourceRegistration.add(i,1,M.Image,{content:r});this.addVisualContainerImage(e,o)},r.prototype.addVisualContainerImage=function(t,i){var o={singleVisual:{visualType:"image",objects:{general:[{properties:{imageUrl:i}}]}}},n=e.Prototype.inherit(t);n.position=r.getPositionForAddedVisual(t.exploreCanvas,t.position),this.createVisualFromConfig(n,o)},r.prototype.addVisualContainerShapeVisual=function(t,i,o){var n=e.Prototype.inherit(t);n.position=r.getPositionForAddedVisual(t.exploreCanvas,t.position);var a,s;if(1===o)switch(a={icon:[{properties:{shapeType:I.text(i)},selector:{id:"default"}}]},s={properties:{show:I.boolean(!0)}},i){case h.back:s.properties.type=I.text(G.Back);break;case h.qna:s.properties.type=I.text(G.Qna);break;case h.bookmarks:s.properties.type=I.text(G.Bookmark);break;default:s=void 0}else a={general:[{properties:{shapeType:I.text(i)}}]};var l={singleVisual:{visualType:1===o?d.name:g.name,objects:a}};s&&(l.singleVisual.vcObjects={},l.singleVisual.vcObjects.visualLink=[s]);var c=this.createVisualFromConfig(n,l);this.telemetry.logEvent(e.telemetry.EXCreateVisual,"InsertVisualButton",U.getVisualType(c))},r.prototype.applyConfigOptions=function(e,t){return e.visualLink&&(t.singleVisual.vcObjects=t.singleVisual.vcObjects||{},t.singleVisual.vcObjects.visualLink=[e.visualLink]),t},r.prototype.addVisualContainer=function(e,t,i,o){o=r.getPositionForAddedVisual(i,o),t.expr=R.expandExpr(e,t.expr);var n=this.createVisualContainerConfig(e,t);if(n)return this.createVisualFromConfig({exploreCanvas:i,position:o},n)},r.prototype.addEmptyVisualContainer=function(e,t,i){i=r.getPositionForAddedVisual(e,i);var o={singleVisual:{visualType:t}};return this.createVisualFromConfig({exploreCanvas:e,position:i},o)},r.prototype.addVisualContainerFromConfig=function(e,t,i,o){return o||(o=r.getPositionForAddedVisual(i,null)),this.createVisualFromConfig({exploreCanvas:i,position:o},e,t)},r.prototype.createVisualFilters=function(e,i,r,o,n){for(var a=t.viewModels.ViewModelFactory.createVisualFilters(e,i,o,this.displayNameService,this.visualPluginService,this.pluginOps,this.filterGenerator,this.aggrOps,this.localizationService,n),s=0,l=a;s<l.length;s++){var c=l[s];c.updateFilterProperties(o,this.visualPluginService,this.aggrOps),c.canVisualize()&&(c.isInvalid()||this.createFilterVisualContainerConfig(c.contract,r,o))}return a},r.prototype.addFilter=function(r,n,a,s,p){if(!t.FilterUtils.canAdd(n,r,a,p,this.pluginOps,this.filterGenerator,this.featureSwitchService))return!1;var d=p?5:1,h=t.FilterUtils.getDefaultFilterType(n,r,d),v={name:t.FilterUtils.getNextFilterName(a.container.filters),expression:n,type:h,howCreated:d};if(p){var g=this.aggrOps.defaultAggregate(n,r);v.isLinkedAsAggregation=null!==g&&void 0!==g}var f=_.isEmpty(t.FilterUtils.validate(v,r,this.aggrOps));v.expanded=t.FilterUtils.canExpandManually(d,!1,n,f),e.data.SQExprUtils.isMeasure(n)||this.createFilterVisualContainerConfig(v,s,r),t.FilterUtils.add(a.container,v);var y={filter:v,changeType:1,scope:a};this.eventBridge.publishToChannel(b.filterContainerChanged,y);var m=P.getSelectedVisual(this.selectionService);return p?o(this.telemetry,"Add",a.container):O.isMeasure(n)&&this.telemetry.logEvent(e.telemetry.EXAddFilter,c(h),u(a.scopeType),l(n),U.hasGroupByItemsInQuery(m),i.getTelemetryViewMode(this.viewModeState.getMode())),!0},r.prototype.addFilterContainers=function(e,i){for(var r=0,o=e;r<o.length;r++){var n=o[r];t.FilterUtils.add(i.container,n);var a={filter:n,changeType:1,scope:i};this.eventBridge.publishToChannel(b.filterContainerChanged,a)}},r.prototype.removeFilter=function(e,t){return this.removeFilterImpl(e,t)},r.prototype.enableSearchInFilterCard=function(t){var i=e.visuals.plugins.slicer.capabilities,r=this.filterGenerator.tryGetSelfFilterEnabledProperty(i),o=e.visuals.visualStyles.create().colorPalette,n=e.visuals.slicerProps.searchBox;m.setValue(t,r,null,e.data.SQExprBuilder.boolean(!0)),m.setValue(t,n.borderColor,null,{solid:{color:e.data.SQExprBuilder.text(o.foregroundNeutralDark.value)}}),m.setValue(t,n.outline,null,e.data.SQExprBuilder.text(e.visuals.lineStyle.solid)),m.setValue(t,n.background,null,{solid:{color:e.data.SQExprBuilder.text(o.foregroundNeutralSecondary.value)}}),m.setValue(t,n.fontColor,null,{solid:{color:e.data.SQExprBuilder.text(o.foregroundLight.value)}})},r.prototype.createFilterVisualContainerConfig=function(t,i,r){var o=t.expression;if(!A.isTransformOutputRoleRef(o)){var n=O.discourageAggregation(o,r),a=k.asFieldPattern(o),s=a.column||a.groupingColumn||a.hierarchyLevel,l={expr:o,dataSources:i,allowAggregate:!1,visualType:e.visuals.plugins.filterSlicer.name};if(!O.isMeasure(o)){var c=this.createVisualContainerConfigCore(l,r);if(c){var u=c.singleVisual.objects;u||(c.singleVisual.objects=u={});var p=5===t.howCreated&&!t.isTransient,d=p,h=!d,v=e.visuals.slicerProps.selection.selectAllCheckboxEnabled,g=e.visuals.slicerProps.selection.singleSelect,f=e.visuals.slicerProps.header.show,S=e.visuals.slicerProps.data.mode;m.setValue(u,S,null,I.text(e.visuals.slicerMode.basic)),m.setValue(u,v,null,I.boolean(h)),m.setValue(u,g,null,I.boolean(d)),m.setValue(u,f,null,I.boolean(!1)),this.featureSwitchService.featureSwitches.enableSearchInFilter&&this.enableSearchInFilterCard(u);var C=e.visuals.slicerProps.items.textSize;if(m.setValue(u,C,null,I.integer(y.smallFontSizeInPoint)),!n&&s){var b=I.entity(s.schema,s.entity,s.entityVar),x=I.aggregate(b,2),F=e.visuals.slicerProps.general.count,D=c.singleVisual.query.getRoleNameForExpr(o),V={data:[w.fromRoles([D])]};m.setValue(u,F,V,x)}var M=0===t.howCreated&&!E.isDefaultFilter(t.filter);if(this.ensureDefaultFilterApplied(r,c.singleVisual,M)&&null==t.filter){var P=a.column||a.groupingColumn?o.getKeyColumns(r):[o];t.filter=E.getDefaultValueFilter(P)}t.config=c}}}},r.prototype.notifyVisualContainers=function(e,i,r){var o=this,n=this.explorationNavigationService.getCurrentSection(),a=_.map(e,(function(e){return i?U.filterAffects(e,n,o.visualRelationshipService,r):U.contractEqualityComparator(e)}));this.eventBridge.publishToChannel(t.services.events.visualContainerChanged,{affectContainer:function(e){return _.some(a,(function(t){return t(e)}))}})},r.prototype.convert=function(i,r,o){var n=U.getVisualType(r),s=this.telemetry.startEvent(e.telemetry.EXInteractionVisualConversion,n,o);if(r.config.singleVisual.query){this.resetSearchProperties(r);var l=t.contracts.SingleVisualConfig.clone(r.config.singleVisual),c=this.core.convert({schema:i,source:l,target:o});if(!c)return s.reject();r.config.singleVisual=l,s.resolve();var u=this.visualPluginService.capabilities(n),p=this.filterGenerator.tryGetFilterPropertyIdentifier(u);if(!p){var d=this.visualPluginService.capabilities(o);p=this.filterGenerator.tryGetFilterPropertyIdentifier(d)}this.ensureValidDrillMode(r),this.ensurePercentRoleTotal(r,o),this.ensureDefaultFilterAndRaiseEvent(i,r,!1,p);var h=r.filters;return _.isEmpty(h)||t.FilterUtils.supportsVisualFilters(r,this.pluginOps,this.filterGenerator)||(r.filters=[]),a(r,i,this.sortService,this.visualPluginService),c}return r.config.singleVisual.visualType=o,s.resolve(),this.notifyVisualContainers([r]),!0},r.prototype.setOrderBy=function(e,t){var i=e.config.singleVisual;i.query.orderBy(t),i.hasDefaultSort=!1,this.notifyVisualContainers([e])},r.prototype.removeOrderBy=function(e,t,i){for(var r=0,o=t;r<o.length;r++){var n=o[r];e.config.singleVisual.query.removeOrderBy(n)}a(e,i,this.sortService,this.visualPluginService),this.notifyVisualContainers([e])},r.prototype.deleteVisualRelationships=function(e,t){_.remove(e.relationships,(function(e){return e.source===t||e.target===t}))},r.prototype.addProperty=function(e,t,i,r){var o=e.config.singleVisual,n=o.objects;n||(o.objects=n={}),m.setValue(n,t,i,r)},r.prototype.removeProperty=function(e,t,i){var r=e.config.singleVisual.objects;m.deleteProperty(r,t.objectName,i,t.propertyName)},r.prototype.setVisibility=function(e,t,i){var r=e.config.singleVisual;if($.setHidden(r,t),t){var o=this.explorationNavigationService.getCurrentSection();this.filterGenerator.clearCrossHighlightForVisualContainers(o,[e]),i||P.unselectVisualContainer(e,this.selectionService)}},r.prototype.setVisualRelationship=function(e,t,i,r){if(t!==i){e.relationships=e.relationships||[];var o=this.visualRelationshipService.relationship(e,t,i);if(o)o.type=r;else{var n=(_.includes(e.visualContainers,t),_.includes(e.visualContainers,i),{source:t,target:i,type:r});e.relationships.push(n)}}},r.prototype.persistProperties=function(e,i,r){var o=i.objects||{},n=this.visualPluginService.capabilities(i.visualType),a=n?n.objects:void 0;return!!t.services.applyPropertyChanges(e,a,o,r)&&(i.objects=o,!0)},r.prototype.ensureValidDrillState=function(e,t){for(var i=0,r=t;i<r.length;i++){var o=r[i];this.core.removeDrillFilter(e.filters,o.expr);var n=e.config.singleVisual.query,a=n.projections[o.roleName];if(a){var s=_.last(a.activeProjectionRefs);if(null!=s){var l=n.defn.select().withName(s).expr;this.core.removeDrillFilter(e.filters,l)}}}this.ensureValidDrillMode(e)},r.prototype.ensureValidDrillMode=function(e){var t=e.drillMode;(1===t&&0===this.drill.getSupportedDrillDirections(e)||2===t&&!this.drill.canDrillToDetails(e))&&this.drill.setDrillMode(e,0)},r.prototype.ensurePercentRoleTotal=function(e,r){if(!this.visualPluginService.capabilities(r).dataRoleTotals){var o=new W,n=new t.schemaRewriterUtils.VisualQueryExprRewriter(o),a=new i.VisualContainerRewriter([n]);i.traverseVisualContainer(e,a,this.visualPluginService)}},r.prototype.getVisualDataRole=function(e,t){var i=U.getDataRolesForVisual(e,this.visualPluginService);if(!_.isEmpty(i))return v.findItemWithName(i,t)},r.prototype.removeFieldImpl=function(e,t,i){return this.invokeRemoveOnSelectedVisuals({expr:e,ignoreAggregates:!0},t,i)},r.prototype.removeFilterImpl=function(t,r){if(!r||!r.container||!r.container.filters)return!1;for(var n={filter:t,changeType:0,scope:r},a=0;a<r.container.filters.length;a++)if(r.container.filters[a]===t)return r.container.filters.splice(a,1),this.eventBridge.publishToChannel(b.filterContainerChanged,n),5===t.howCreated&&o(this.telemetry,"Delete",r.container),!0;return this.telemetry.logEvent(e.telemetry.EXRemoveFilter,i.getTelemetryFilterType(t.type),i.getTelemetryFilterScopeType(r.scopeType),t.expression&&i.getTelemetryFieldKind(t.expression),i.getTelemetryViewMode(this.viewModeState.getMode())),!1},r.prototype.removeFiltersWithExpr=function(e,t){var i=t.filters;if(!i)return!1;for(var r,o=i.length-1;o>=0;o--){var n=i[o];A.equals(n.expression,e)&&(r=this.removeFilterImpl(n,{scopeType:0,container:t}))}return r},r.prototype.invokeRemoveOnSelectedVisuals=function(e,t,i){for(var r=!1,o=t.length-1;o>-1;o--){var n=t[o],s=n.config.singleVisual.query,l=C.getDrillFilterRemovalInfoList(s,e,0);this.removeExpressionsFromVisual(e,n.config,i)&&(this.ensureValidDrillState(n,l),this.isEmptyQueryVisual(n)?this.eventBridge.publishToChannel(b.deleteVisualContainer,n):(a(n,i,this.sortService,this.visualPluginService),this.notifyVisualContainers([n])),r=!0)}return r},r.prototype.isEmptyQueryVisual=function(t){var i=t.config.singleVisual;if(i&&this.pluginOps.isQueryVisual(i.visualType)&&i.query&&0===i.query.defn.select().length){var r=this.visualPluginService.capabilities(i.visualType);if(r){var o=e.ScriptResultUtil.extractScriptResultFromVisualConfig(r.dataViewMappings,i.objects);return!(o&&!jsCommon.StringExtensions.isNullOrUndefinedOrWhiteSpaceString(o.source))}return!1}return!1},r.prototype.removeExpressionsFromVisual=function(e,t,i){for(var r=e.count||1,o=0;o<r;o++)if(!this.core.remove(e,t,i))return!1;return!0},r.prototype.createVisualFromConfig=function(e,i,r){i=this.applyConfigOptions(e,i);var o=this.formFactorProvider.getCurrentLayout(),n=e.exploreCanvas,a={name:U.uniqueName(n.contract.visualContainers),config:i,filters:r||[],layouts:jsCommon.ArrayExtensions.extendWithId([{id:o,position:e.position}])},s=this.explorationNavigationService.getCurrentExploration();s.defaultDrillFilterOtherVisuals&&(a.drillFilterOtherVisuals=!0),n.contract.visualContainers.push(a);var l=t.viewModels.ViewModelFactory.convertVisualContainer(s,n.contract,a,o);if(l)return n.visualContainers.push(l),e.select!==!1&&P.selectVisualContainer(a,this.selectionService),a},r.prototype.createExprWithAggregate=function(e,t,i,r){if(O.discourageAggregation(e,t))return e;var o=this.getPreferredAggregate(t,e,r);return this.aggrOps.createExprWithAggregate(e,t,i,r?r.requiredTypes:null,o)},r.getPositionForAddedVisual=function(e,t){if(!t)return r.getDefaultVisualContainerPosition(e);if(null!=t.z)return t;var o=_.cloneDeep(t);return o.z=i.CanvasVisualsUtility.getZIndexForNewVisual(e),o},r.getDefaultVisualContainerPosition=function(e){return{height:0,width:0,x:0,y:0,z:i.CanvasVisualsUtility.getZIndexForNewVisual(e)}},r.prototype.shouldPreferGroupToAggregate=function(t,i,r,o){if(o&&o.kind===e.VisualDataRoleKind.GroupingOrMeasure){var n=this.isRoleOrExprLatLong(t,i,o);if(n){if(!r)return!0;var a=U.getVisualQuery(r);if(a&&a.projections){var l=this.visualPluginService.capabilities(r.config.singleVisual.visualType),c=e.requireSync("Explore/services/visualCapabilitiesHelper").create(l,this.geotaggingAnalyzerService),u=void 0;n&&(u=c.getNonLatLongRoles());for(var p=0,d=u;p<d.length;p++){var h=d[p];if(a.projections[h])return!1}}}else{if(!O.isExprValidForAggregation(i))return!0;if(s(i,i.getMetadata(t),t))return!1}}return o&&o.kind!==e.VisualDataRoleKind.Measure},r.prototype.getPreferredAggregate=function(e,t,i){if(this.isRoleOrExprLatLong(e,t,i))return 1},r.prototype.isRoleOrExprLatLong=function(t,i,r){var o=e.requireSync("Explore/services/visualCapabilitiesHelper").isValueTypeDescriptorLatLong;if(r){var n=r.preferredTypes;if(o(_.isEmpty(n)?void 0:n[0]))return!0}var a=i.getMetadata(t),s=a?a.type:void 0;if(o(s))return!0;if(s){var l=k.asFieldPattern(i),c=l.column||l.columnAggr||l.groupingColumnAggr||l.groupingColumnAggr||l.measure;if(c){var u=c&&this.geotaggingAnalyzerService.getFieldType(c.name);if(null!=u){var p=e.ValueType.fromPrimitiveTypeAndCategory(s.primitiveType,u);if(o(p)||p.numeric)return!0}}}return!1},r.prototype.canHierarchyLevelJoinExistingGroup=function(e,t,i,r,o){var n=t&&t.projections[i];if(A.isHierarchyLevel(r)&&n&&n.all().length>0){var a=r,s=n.all(),l=R.expandExpr(e,a.arg),c=_.isNumber(o)?o-1:s.length-1;if(c>=0&&R.areHierarchyLevelsOrdered(l,t.tryGetExpr(i,c),a))return!0;if(_.isNumber(o)&&o<s.length&&R.areHierarchyLevelsOrdered(l,a,t.tryGetExpr(i,o)))return!0}return!1},r.prototype.addHierarchyLevelToExistingHierarchiesInVisual=function(e,t,i,r){var o=!1,n=F.getOptionsToAddHierarchyLevelToExistingHierarchies(e,t,i.singleVisual.query,r);if(n)for(var a=0,s=n;a<s.length;a++){var l=s[a];o=this.core.add(l,i)||o}return o},r.prototype.ensureDefaultFilterAndRaiseEvent=function(e,t,i,r){var o=t.config.singleVisual;if(this.ensureDefaultFilterApplied(e,o,i))this.eventBridge.publishToChannel(b.visualContainerChanged,{affectContainer:function(e){return!0}});else{var n=void 0;if(r&&o.objects){n=null!=(r&&m.getValue(o.objects,r,null))}this.notifyVisualContainers([t],n,e)}},r.prototype.ensureDefaultFilterApplied=function(e,t,i){var r=t.query.getUniqueQueryRefs();if(0===r.length)return!1;var o=t.query.defn.select().withName(r[0]).expr,n=O.getDefaultValue(o,e),a=this.visualPluginService.capabilities(t.visualType),s=a?a.objects:null;if(!n)return this.clearDefaultValueAndFilter(t,o,s),!1;if(!S.findDefaultValue(s))return this.clearDefaultValueAndFilter(t,o,s),!1;if(i)return!1;t.objects||(t.objects={});var l,c=k.asFieldPattern(o);l=c.column||c.groupingColumn?o.getKeyColumns(e):o;var u=S.findFilterOutput(s),p=E.getDefaultValueFilter(l);return m.setValue(t.objects,u,null,p),!0},r.prototype.clearDefaultValueAndFilter=function(e,t,i){if(e.objects){var r=S.findFilterOutput(i);if(r){var o=m.getValue(e.objects,r,null);E.isDefaultFilter(o)&&m.deleteProperty(e.objects,r.objectName,null,r.propertyName)}}},r.prototype.resetSearchProperties=function(e){var t=U.getObjectDefinitions(e);if(t){var i=U.getVisualCapabilities(e,this.visualPluginService),r=this.filterGenerator.tryGetSelfFilterEnabledProperty(i);r&&m.deleteProperty(t,r.objectName,null,r.propertyName);var o=this.filterGenerator.tryGetSelfFilterProperty(i);o&&m.deleteProperty(t,o.objectName,null,o.propertyName)}},r.prototype.logReportMeasureMoveTelemetry=function(t,i,r,o,n){if(r!==o){var a=n&&n.getTargetEntity();if(a&&a.schema===y.ExplorationSchemaName){var s=n.getConceptualProperty(t);if(s){var l=this.getVisualDataRole(i,r),c=this.getVisualDataRole(i,o),u=JSON.stringify(l.requiredTypes),p=JSON.stringify(c.requiredTypes);u!==p&&this.telemetry.logEvent(e.telemetry.EXReportMeasureMoveRoleKind,e.PrimitiveTypeStrings[s.type.primitiveType],u,p)}}}},r.prototype.setVisualDrillFilterOtherVisualsSetting=function(e,t){e.drillFilterOtherVisuals!==t&&(e.drillFilterOtherVisuals=t,this.eventBridge.publishToChannel(b.visualDrillFilterOtherVisualsSettingChanged,{visualContainer:e,on:t}))},r})(),W=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.visitScopedEval=function(e){return new B(e.expression,[])},t})(e.data.SQExprRewriter);i.getVisualDefaultType=n,i.setDefaultSort=a,i.getTelemetryFieldKind=l,i.getTelemetryFilterType=c,i.getTelemetryFilterScopeType=u,i.getTelemetryViewMode=p})(i=t.util||(t.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){function r(e,t,i,r){return new c(e,t,i,r)}var o=i.ErrorDetailsUtility,n=e.explore.services.events,a=e.data.SQExprUtils,s=jsCommon.TraceType;i.createVisualContainerErrorManager=r;var l="Sampled",c=(function(){function i(e,t,i,r){this.viewModel=e,this.getVisualType=t,this.getVisualContract=i,this.services=r}return i.prototype.showErrorDetails=function(){var e=this.viewModel;this.logErrorAndShowDialog(e.errorInfo,this.getVisualType(),"User"!==e.errorInfo.source,!0)},i.prototype.showWarningDetails=function(){var e=this.viewModel,t={details:e.warningInfo?e.warningInfo.details:e.customVisualDeprecatedWarningInfo.details,code:e.warningInfo?e.warningInfo.code:e.customVisualDeprecatedWarningInfo.code,fixableError:0};this.logErrorAndShowDialog(t,this.getVisualType(),!1,!0)},i.prototype.showTransformWarningDetails=function(){var e=this.viewModel,t={details:e.transformWarningInfo.details,code:e.transformWarningInfo.code,fixableError:0};this.logErrorAndShowDialog(t,this.getVisualType(),!1,!0)},i.prototype.showInfoDetails=function(){var e=this.viewModel,t={details:e.visualInfo.details,code:e.visualInfo.code,fixableError:0};this.logErrorAndShowDialog(t,this.getVisualType(),!1,!1)},i.prototype.clearError=function(){var e=this.viewModel;e.errorInfo=void 0,e.warningInfo=void 0,e.transformWarningInfo=void 0,e.visualInfo=void 0},i.prototype.showErrorOverlay=function(t,i,r,n){var a=this.viewModel,s=this.getVisualType();if(this.services.telemetryService.logEvent(e.telemetry.VisualError,i,s,void 0,t.message),!a.errorInfo||a.errorInfo.code!==i){var l=o.getErrorOverlayType(i),c=this.shouldHideSeeDetails(i),u=this.services.conceptualSchemaProxy.getLatestCapabilities(this.services.dataSources.get(),void 0),p=this.getFixableErrorKind(i,this.services.featureSwitchService.featureSwitches.enableTableToTableRelationship&&u&&u.canEdit);a.errorInfo={details:t,code:i,fixableError:p,hideSeeDetails:c,overlayType:l,requestId:r,source:n}}},i.prototype.showWarningIcon=function(e,t){var i=this.viewModel,r=this.getVisualType();this.logVisualWarning(r,t,e.message),i.warningInfo||(i.warningInfo={details:e,code:t})},i.prototype.showDeprecationWarning=function(){var t=this.viewModel,i=e.common.localize.get("CustomVisuals_DeprecatedMessageWarningKey"),r=e.common.localize.get("CustomVisuals_DeprecatedMessageWarningValue"),o={message:e.common.localize.get("CustomVisuals_DeprecatedMessage"),displayableErrorInfo:[{errorInfoKey:i,errorInfoValue:r}],hideAdditionalErrorInfo:!0};t.customVisualDeprecatedWarningInfo={details:o,code:"CustomVisuals_DeprecatedMessage"}},i.prototype.clearDeprecationWarning=function(){this.viewModel.customVisualDeprecatedWarningInfo=void 0},i.prototype.showTransformWarningIcon=function(e,t,i){var r=this.viewModel,o=this.getVisualType(),n=i?t.concat("|").concat(l):t;this.logVisualWarning(o,n,e.message),r.transformWarningInfo||(r.transformWarningInfo={details:e,code:t})},i.prototype.showInfoIcon=function(e,t){var i=this.viewModel,r=this.getVisualType();this.logVisualWarning(r,t,e.message),i.visualInfo||(i.visualInfo={details:e,code:t})},i.prototype.fixErrors=function(){var e=this.viewModel,i=this.getVisualContract();switch(e.errorInfo.fixableError){case 1:t.services.selectionUtils.selectVisualContainer(i,this.services.selection),this.services.visualAuthoring.removeInvalidExpressions(i,this.services.dataSources.get());break;case 2:var r=a.getActiveTablesNames(i.config.singleVisual.query.defn);this.services.eventBridge.publishToChannel(n.missingTableRelationship,{tables:r});break;case 3:this.removeBrokenFilters();break;case 4:this.services.eventBridge.publishToChannel(n.showEnableScriptVisualsDialog,0);break;case 5:this.services.eventBridge.publishToChannel(n.showEnableScriptVisualsDialog,1);break;case 0:}},i.prototype.removeBrokenFilters=function(){var e=this,t=this.getVisualContract(),i=t.filters,r={scopeType:0,container:t};this.services.conceptualSchemaProxy.get(this.services.dataSources.get()).then((function(t){for(var o=0,n=i;o<n.length;o++){var a=n[o];a.filter&&!_.isEmpty(a.filter.validate(t,e.services.aggrOps))&&e.services.visualAuthoring.removeFilter(a,r)}}))},i.prototype.generateShowMoreErrorDetails=function(t){var i=[],r=t.message,n=e.common.localize.get("ServiceError_CannotLoadVisual");if(o.hasAdditionalErrorInfo(t)&&(n=t.displayableErrorInfo[0].errorInfoKey,r=t.displayableErrorInfo[0].errorInfoValue,t.displayableErrorInfo.length>1))for(var a=1;a<t.displayableErrorInfo.length;a++)i.push(t.displayableErrorInfo[a]);return{title:n,message:r,displayableErrorInfo:i,debugErrorInfo:t.debugErrorInfo,source:t.source}},i.prototype.getFixableErrorKind=function(e,t){switch(e){case"Missing_References":return 1;case"InvalidUnconstrainedJoin":return t?2:0;case"Broken_Filters":return 3;case"ScriptVisualsNotEnabled":return 4;case"PythonVisualsNotEnabled":return 5;default:return 0}},i.prototype.shouldHideSeeDetails=function(e){return 1===o.getErrorOverlayType(e)},i.prototype.logErrorAndShowDialog=function(e,i,r,o){var n,a,l=this.generateShowMoreErrorDetails(e.details),c=e.code;if(r?(n="VisualErrorSeeDetails_"+c+"_"+i,a=s.Error):(n="VisualWarningSeeDetails_"+c+"_"+i,a=s.Warning),o){var u={title:l.title,displayableErrorInfo:l.displayableErrorInfo,debugErrorInfo:l.debugErrorInfo,level:a,source:null!=l.source?l.source:e.source},p=e.details;p&&(u.showAdditionalErrorInfo=p.hideAdditionalErrorInfo!==!0,p.helpLink&&(u.helpLink=p.helpLink,u.displayLearnMoreHelpLink=1===p.helpLinkType)),e.requestId&&(u.requestId=e.requestId),this.services.errorService.error(l.message,n,u)}else{new t.dialogs.LearnMoreDialogBuilder(this.services.modalDialogService).show("VisualContainerInfo",l.title,l.message,"PBI_Button_Label_Close",e.details.helpLink)}},i.prototype.logVisualWarning=function(t,i,r){this.services.telemetryService.logEvent(e.telemetry.VisualWarning,t,void 0,!1,"PowerBI",i,r)},i})();i.VisualContainerErrorManager=c})(i=t.util||(t.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){function t(){return{getFilters:function(){return{dataFilter:null,dataFiltersUnmerged:null}},getVisualRelationshipFilterAction:function(){return 0},selectDataPoint:_.noop,setVisualRelationshipFilterAction:_.noop}}e.createQueryVisualHostServices=t})(t=e.VisualHostServicesUtil||(e.VisualHostServicesUtil={}))})(t=e.util||(e.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){function i(t){var i=[{name:"AccessibilityInfo",blockType:2,consumerHostFlags:299},{name:"AdvancedFilter",blockType:1,consumerHostFlags:299},{name:"BoxGrid",syncModule:"ExploreUI/components/boxGrid/boxGrid",blockType:2,consumerHostFlags:11},{name:"CanvasTooltip",blockType:2,consumerHostFlags:299},{name:"CanvasVisualErrorOverlay",blockType:2,consumerHostFlags:299},{name:"CanvasVisualHeaderIcon",blockType:1,consumerHostFlags:299},{name:"Carousel",blockType:1,consumerHostFlags:299},{name:"DateTimePicker",blockType:2,consumerHostFlags:11},{name:"DeleteVisualWarningDialog",blockType:1,consumerHostFlags:299},{name:"DetailVisual",blockType:2,consumerHostFlags:299},{name:"DisplayOptionFilter",dependencies:["localizationService"],blockType:4,consumerHostFlags:299},{name:"EsriConsentDialog",blockType:1,consumerHostFlags:299},{name:"Exploration",blockType:1,consumerHostFlags:299},{name:"ExploreCanvasPrinter",dependencies:["$rootScope","featureSwitchService","localizationService"],blockType:1,consumerHostFlags:11},{name:"ExplorationFooter",blockType:2,consumerHostFlags:299},{name:"ExplorationHost",blockType:1,consumerHostFlags:299},{name:"ExplorationNavigationTab",dependencies:["platformCapabilities"],blockType:1,consumerHostFlags:299},{name:"ExplorationPaginator",blockType:1,consumerHostFlags:299},{name:"ExplorationStatusBar",blockType:1,consumerHostFlags:299},{name:"ExploreCanvas",dependencies:["telemetryService","overlayService"],blockType:1,consumerHostFlags:299},{name:"Filter",blockType:2,consumerHostFlags:299},{name:"FilterPane",blockType:2,consumerHostFlags:299},{name:"FilterVisual",blockType:2,consumerHostFlags:299},{name:"InstancePicker",blockType:2,consumerHostFlags:811},{name:"JqSelect",dependencies:[],blockType:1,consumerHostFlags:299},{name:"IncludeExcludeFilter",blockType:2,consumerHostFlags:299},{name:"ModelingContextChanger",blockType:1,consumerHostFlags:299},{name:"PbiValidate",blockType:1,consumerHostFlags:299},{name:"PenAnnotation",blockType:2,consumerHostFlags:299},{name:"PropertyPaneTextBox",dependencies:["localizationService"],blockType:1,consumerHostFlags:811},{name:"RelativeDateFilter",blockType:2,consumerHostFlags:299},{name:"SectionAnimationSlider",blockType:1,consumerHostFlags:299},{name:"SectionTabKeyHandler",blockType:1,consumerHostFlags:299},{name:"SelectionBox",blockType:1,consumerHostFlags:299},{name:"StandaloneCanvas",blockType:2,consumerHostFlags:299},{name:"SvgUseSymbol",blockType:2,consumerHostFlags:811},{name:"TaskPane",blockType:1,consumerHostFlags:299},{name:"TopNFilter",blockType:2,consumerHostFlags:299},{name:"TooltipActions",blockType:2,consumerHostFlags:299},{name:"TooltipChildMenu",blockType:2,consumerHostFlags:299},{name:"VirtualList",blockType:1,consumerHostFlags:299},{name:"VisualContainer",blockType:2,consumerHostFlags:299},{name:"VisualContainerContextMenu",blockType:1,consumerHostFlags:299},{name:"VisualContainerDrill",blockType:2,consumerHostFlags:299},{name:"VisualContainerDrillToggle",blockType:2,consumerHostFlags:299},{name:"VisualContainerFilterRestatementButton",blockType:2,consumerHostFlags:299},{name:"VisualContainerRelationshipFilters",blockType:2,consumerHostFlags:299},{name:"VisualContainerHeader",blockType:2,consumerHostFlags:299},{name:"VisualContainerOptionsMenu",blockType:2,consumerHostFlags:299},{name:"VisualContainerPinButton",blockType:2,consumerHostFlags:299},{name:"VisualContainerPopOutBar",blockType:2,consumerHostFlags:299},{name:"VisualHeaderItemContainer",blockType:2,consumerHostFlags:299},{name:"SingleVisualHost",blockType:2,consumerHostFlags:299},{name:"VisualizationPane",blockType:1,consumerHostFlags:299},{name:"VisualTooltip",blockType:2,consumerHostFlags:811},{name:"VisualWatermark",dependencies:["$templateCache","visualPlugin"],
blockType:1,consumerHostFlags:299}];e.common.registerBuildingBlocksForHost(t,i,{componentsTarget:"powerbi.explore.components",componentsMap:e.explore.components,directivesTarget:"powerbi.explore.directives",directivesMap:e.explore.directives,filtersTarget:"powerbi.explore.filters",filtersMap:e.explore.filters})}var r=e.explore.services;angular.module("powerbi.explore.controllers",[]),angular.module("powerbi.explore.directives",[]),angular.module("powerbi.explore.components",[]),angular.module("powerbi.explore.filters",[]);var o=["powerbi.common","powerbi.explore.controllers","powerbi.explore.directives","powerbi.explore.components","powerbi.explore.filters","powerbi.visualHost"];angular.module("powerbi.explore",o).run(["$injector",function(e){return window.powerbiExploreInjector=e}]).config(["dataReaderProviderProvider",function(t){t.registerExplorationDataReaderExtension=e.explore.dataReaderPlugins.registerExplorationDataReaderExtension}]).config(["lazyProvider",function(t){var i=t.factories;i.fieldWellViewModelFactory={source:{javascript:"ExploreUIShell/viewModels/fieldWellViewModelFactory"},ng:["aggrOps","displayNameService","featureSwitchService","geoTaggingAnalyzerService","lazy","localizationService","promiseFactory"],fn:function(e,t,i,r,o,n,a,s){return e.create(t,i,r,o,n,a,s)}},i.fieldWellPropertyViewModelFactory={source:{javascript:"ExploreUIShell/viewModels/fieldWellPropertyViewModelFactory"},ng:["aggrOps","displayNameService"],fn:function(e,t,i){return e.create(t,i)}},i.instantEmail={source:{javascript:"PowerBISidePanes/services/instantEmailService"},ng:["taskPaneSliderService"],fn:function(e,t){return e.create(t)}},i.customVisualsGalleryService={source:{javascript:"CustomVisualsGallery/services/customVisualsGalleryService"},ng:["telemetryService"],fn:function(e,t){return e.create(t)}},i.conditionalFormattingDialogBuilder={source:{javascript:"ExploreUIDialogs/dialogs/conditionalFormattingDialog/conditionalFormattingDialogBuilder"},fn:function(e){return new e.ConditionalFormattingDialogBuilder}},i.dataBarsDialogBuilder={source:{javascript:"ExploreUIDialogs/dialogs/dataBarsDialog/dataBarsDialogBuilder"},fn:function(e){return new e.DataBarsDialogBuilder}},i.tableViewDialogBuilder={source:{javascript:"ExploreUIDialogs/dialogs/tableViewDialog/tableViewDialogBuilder"},ng:["modalDialogService"],fn:function(e,t){return e.create(t)}},i.explorationStateDiffer={source:{javascript:"Explore/services/explorationStateDiffer"},fn:function(e){return e}},i.insightsService={source:{javascript:"Insights/services/insightsService"},ng:["errorService","localizationService","telemetryService"],modular:["insightsCache","insightsRuntime"],fn:function(e,t,i,r,o,n){return e.create(o,n,r,t,i)}},i.insightsCache={source:{javascript:"Insights/services/insightsCacheService"},fn:function(e){return e.create()}},i.insightsRuntime={source:{javascript:"Insights/proxies/insightsHttpRuntime"},ng:["promiseFactory","syncService","featureSwitchService"],fn:function(t,i,r,o){return t.create(e.common.httpService,i,r,o)}}}]).config(["lazySyncProvider",function(t){t.factories.linguisticSchemaProxy={ng:["promiseFactory"],fn:function(t,i){return t("Explore/proxies/linguisticSchemaProxy").create(i,e.common.httpService)}}}]).factory("themeService",["themeServiceBase",function(i){return e.common.createThemeService(i,t.services.upgrade.ObjectVersioning)}]).factory("licenseEnforcementService",(function(){return[]})).factory("displayNameService",["aggrOps","featureSwitchService","localizationService",function(t,i,r){var o=r,n={aggregateDisplayNames:{Sum:o.get("DisplayName_Sum"),Avg:o.get("DisplayName_Avg"),Count:o.get("DisplayName_Count"),Min:o.get("DisplayName_Min"),Max:o.get("DisplayName_Max"),CountNonNull:o.get("DisplayName_CountNonNull"),Median:o.get("DisplayName_Median"),StandardDeviation:o.get("DisplayName_StandardDeviation"),Variance:o.get("DisplayName_Variance"),DateMin:o.get("DisplayName_DateMin"),DateMax:o.get("DisplayName_DateMax"),StringMin:o.get("DisplayName_StringMin"),StringMax:o.get("DisplayName_StringMax")},showValueAsDisplayNames:{PercentOfGrandTotal:o.get("DisplayName_QuickCalc_PercentOfGrandTotal"),PercentOfGrandTotalTooltip:o.get("DisplayName_QuickCalc_PercentOfGrandTotalTooltip"),PercentileExclusive:o.get("DisplayName_QuickCalc_PercentileExclusive"),PercentileInclusive:o.get("DisplayName_QuickCalc_PercentileInclusive")},qualifiedDisplayNameTemplate:o.get("Field_Tooltip"),stringResourceProvider:o};return e.explore.services.createDisplayNameService(n,t,i)}]).factory("visualPlugin",["asyncFeatureSwitchService","mapControlFactory","promiseFactory","resourceLoader","visualSandbox",function(t,i,r,o,n){return e.explore.services.createExplorationVisualPluginService(t,r,o,i,n)}]).factory("transformPluginService",[function(){return e.data.transforms.createTransformPluginService()}]).factory("explorationSerializer",["visualPlugin","featureSwitchService","telemetryService",function(t,i,r){return e.explore.services.createExplorationSerializer(t,r,i)}]).factory("reportTileService",["promiseFactory","explorationProxy","$timeout",function(t,i,r){return e.explore.services.createReportTileService(t,i,r)}]).factory("explorationProxy",["promiseFactory","explorationSerializer","telemetryService","featureSwitchService","activeFolderId",function(t,i,r,o){return e.explore.proxies.createExplorationProxy(t,e.common.httpService,i,r,o)}]).factory("layoutInsertionHelper",(function(){return e.explore.services.createLayoutInsertionHelper()})).factory("federatedSchemaValidator",["localizationService",function(t){return e.explore.services.createFederatedSchemaValidator(t)}]).factory("geoTaggingAnalyzerService",["localizationService",function(t){return e.requireSync("VisualsCommon/services/geoTaggingAnalyzerService").create((function(e){return t.get(e)}))}]).factory("daxParserService",["promiseFactory",function(t){return e.explore.services.createDaxParserService(t)}]).factory("cultureService",(function(){return e.explore.services.createCultureService()})).factory("uiBlockingService",["promiseFactory",function(t){return e.explore.services.createUIBlockingService(t)}]).factory("networkAvailability",[function(){return e.common.createNetworkAvailabilityService()}]).factory("visualStylePreset",(function(){return e.visualHost.services.createVisualStylePresetService()})).factory("svgProvider",["$http","promiseFactory",function(t,i){return e.explore.services.createSvgProvider(t,i)}]).factory("hostTooltip",["$compile","$injector","$rootScope","$timeout","featureSwitchService",function(t,i,r,o,n){return e.explore.services.createHostTooltipService(t,i,r,o,(function(){return n.featureSwitches.touchScreenOptimizedTooltips}))}]).directive("datepickerPopup",(function(){return{restrict:"EAC",require:"ngModel",link:function(e,t,i,r){r.$formatters.shift()}}})).factory("subscription",["taskPaneSliderService","userInfo","localizationService","featureSwitchService",function(t,i,r,o){return e.explore.services.createSubscriptionPaneService(t,i,r,o)}]).factory("visualConsent",["promiseFactory","telemetryService",function(t,i){return e.visualHost.createVisualConsentService(t,i)}]).factory("trustedVisual",["promiseFactory","telemetryService","visualConsent","approvedResourceService","visualSandbox","resourceLoader",function(t,i,r,o,n,a){return e.visualHost.createTrustedVisualService(t,i,r,o,n,a)}]).factory("focus",["$rootElement","modalDialogService",function(t,i){return e.explore.services.createFocusService(t,i,[])}]).run(["lazyScopedFactories",function(e){e.clustering={source:{javascript:"ExploreUI/services/clustering"},ng:["conceptualSchemaProxy","errorService","explorationSerializer","localizationService","modalDialogService","promiseFactory","telemetryService"],scoped:["clusteringState","groupingDesignStateService","modelChangeHandler","visualAuthoring","visualPlugin"],fn:function(e,t,i,r,o,n,a,s,l,c,u,p,d){return e.create(t,null,l,c,p,d,i,o,u,n,a,s,r)}},e.drillthrough={source:{javascript:"ExploreActions/services/drillthrough"},ng:["conceptualSchemaProxy","featureSwitchService"],scoped:["dataSources","explorationNavigation"],fn:function(e,t,i,r,o){return e.create(t,i,r,o)}},e.insightsAnalysisService={source:{javascript:"Insights/services/insightsAnalysisService"},ng:["displayNameService","localizationService","featureSwitchService"],scoped:["visualPluginOps","visualPlugin"],fn:function(e,t,i,r,o,n){return e.create(t,o,i,r,n)}},e.bookmark={source:{javascript:"ExploreUIShell/services/bookmarkService"},ng:["conceptualSchemaProxy","featureSwitchService","localizationService","$rootScope","telemetryService"],scoped:["dataSources","eventBridge","explorationNavigation","lazyScopedSync","selection","viewModeState","undoRedo"],fn:function(e,t,i,r,o,n,a,s,l,c,u,p,d){return e.create(o,t,a,s,c("explorationStateManager"),c("explorationStateApplier"),l,r,u,p,d,n)}},e.canvasListOrderingService={source:{javascript:"ExploreUIShell/services/canvasListOrderingService"},fn:function(e){return e.create()}},e.tabOrder={source:{javascript:"ExploreUIShell/services/tabOrderService"},scopedModular:["canvasListOrderingService"],fn:function(e,t){return e.create(t)}},e.zIndex={source:{javascript:"ExploreUIShell/services/zIndexService"},scopedModular:["canvasListOrderingService"],fn:function(e,t){return e.create(t)}},e.explorationAuthoring={source:{javascript:"ExploreUIShell/services/explorationAuthoring"},ng:["explorationSerializer","lazySync","localizationService","telemetryService"],scoped:["eventBridge","explorationNavigation","undoRedo","explorationActivity"],fn:function(e,t,i,r,o,n,a,s,l){return e.create(s,i,n,t,a,r,l,o)}},e.visualHostTooltipActionsProvider={source:{javascript:"ExploreUIShell/services/visualHostTooltipActionsProvider"},ng:["conceptualSchemaProxy","telemetryService"],scoped:["explorationNavigation","drill","dataSources","lazyScoped","lazyScopedSync","visualAuthoring","visualPluginOps"],fn:function(e,t,i,r,o,n,a,s,l,c){return e.create(t,r,o,n,a,s,c,i,l)}},e.qnaExplore={source:{javascript:"InfoNavBootstrap/services/qnaExplore"},ng:["$compile","featureSwitchService","errorService","localizationService"],scoped:["lazyScoped","eventBridge"],fn:function(e,t,i,r,o,n,a){return e.create(t,i,a,n,r,o)}},e.canvasPopout={source:{javascript:"ExploreUIDialogs/services/canvasPopoutService"},ng:["$templateCache","$compile","overlayService","promiseFactory"],scoped:["eventBridge","explorationNavigation","explorationCapabilities","modelChangeHandler"],fn:function(e,t,i,r,o,n,a,s,l){return e.create(t,i,r,n,a,s,l,o)}},e.exportVisualData={source:{javascript:"ExploreUIShell/services/exportVisualDataService"},ng:["aggrOps","conceptualSchemaProxy","singleExecutableDataProxyFactory","geoTaggingAnalyzerService","featureSwitchService","promiseFactory","displayNameService","localizationService"],scoped:["visualPlugin","visualQueryGenerator"],fn:function(e,t,i,r,o,n,a,s,l,c,u){return e.create(c,u,r.create(),i,t,o,n,a,s,l)}},e.userEmulationService={source:{javascript:"ExploreUI/services/userEmulationService"},scoped:["eventBridge"],fn:function(e,t){return e.create(t)}},e.daxCapabilities={source:{javascript:"ExploreUI/services/daxCapabilitiesService"},fn:function(e){return e.create()}}}]).run(["lazyScopedSyncFactories",function(e){e.drillToDetails={ng:["aggrOps","conceptualSchemaProxy","displayNameService","explorationSerializer","geoTaggingAnalyzerService","featureSwitchService","localizationService","$rootScope","$timeout","telemetryService"],scoped:["drill","expandCollapse","eventBridge","explorationNavigation","filterGenerator","visibility","resourceRegistration","selection","sort","undoRedo","viewModeState","visualPlugin","visualPluginOps","visualRelationship","formFactor"],fn:function(e,t,i,r,o,n,a,s,l,c,u,p,d,h,v,g,f,y,m,S,w,C,b,x,F,D){return e("ExploreUI/services/drillToDetails").create(i,o,b,x,n,w,a,m,v,f,l,c,h,r,u,S,F,p,d,g,t,y,s,D,C)}},e.explorationState={ng:["aggrOps","featureSwitchService"],scoped:["expandCollapse","filterGenerator","visualPlugin","visualPluginOps"],fn:function(e,t,i,r,o,n,a){return e("Explore/services/explorationState").create(r,o,n,a,t,i)}},e.explorationStateApplier={ng:["dataProxy","featureSwitchService"],scoped:["explorationNavigation","lazyScopedSync"],fn:function(e,t,i,r,o){return e("ExploreUI/services/explorationStateApplier").create(t,o("explorationStateManager"),r,i,o("visualSync"))}},e.explorationStateManager={ng:["telemetryService"],scoped:["explorationNavigation","eventBridge","lazyScopedSync","visibility","filterGenerator","explorationActivity"],fn:function(e,t,i,r,o,n,a,s){return e("ExploreUI/services/explorationStateManager").create(o("explorationState"),i,r,n,a,s,t)}},e.visualSync={ng:["conceptualSchemaProxy","featureSwitchService"],scoped:["dataSources","explorationNavigation","lazyScopedSync","visualPlugin"],fn:function(e,t,i,r,o,n,a){return e("ExploreUI/services/visualSyncService").create(n("explorationStateManager"),o,i,a,t,r)}},e.quickCalcService={ng:["aggrOps","conceptualSchemaProxy","modalDialogService","promiseFactory","telemetryService","explorationSerializer","daxTemplateService"],scoped:["dataSources","modelAuthoring","modelChangeHandler","visualAuthoring","lazyScoped"],fn:function(e,t,i,r,o,n,a,s,l,c,u,p,d){return e("ExploreUI/services/quickCalc").create(t,i,l,a,r,c,u,o,s,p,n,d)}},e.layoutAuthoring={ng:["explorationSerializer","telemetryService"],scoped:["eventBridge","explorationNavigation","formFactor","undoRedo","selection","explorationCapabilities"],fn:function(e,t,i,r,o,n,a,s,l){return e("ExploreUIShell/services/layoutAuthoring").create(t,i,r,a,o,n,s,l)}}}]).run(["scopedProvider",function(i){i.register("runningVisuals",{fn:function(){return r.createRunningVisualService()}}).register("dataSources",{fn:function(){return r.createDataSourcesService()}}).register("canvasScale",{services:["overlayService"],scopedServices:["explorationNavigation","formFactor","visibility","viewModeState"],fn:function(e,t,i,o,n){return r.createCanvasScaleService(t,i,o,n,e)}}).register("uiComponent",{services:["$compile","promiseFactory","moduleLoader"],fn:function(t,i,r){return e.explore.services.createUIComponentService(t,r,i)}}).register("eventBridge",{fn:function(){return e.common.createEventBridge()}}).register("focusNotificator",{services:["focus"],scopedServices:["eventBridge"],fn:function(t,i){return e.explore.services.createFocusServiceNotificator(t,i)}}).register("includeExcludeService",{services:["localizationService","telemetryService"],scopedServices:["eventBridge","undoRedo","viewModeState"],fn:function(e,i,r,o,n){return t.services.createIncludeExcludeService(r,e,o,i,n)}}).register("explorationActivity",{services:[],scopedServices:["eventBridge"],fn:function(e){return r.createExplorationActivityService(e)}}).register("explorationNavigation",{services:["explorationProxy","telemetryService"],scopedServices:["$scope","eventBridge","selection","formFactor","explorationActivity"],fn:function(t,i,r,o,n,a,s){return e.explore.services.createExplorationNavigationService(t,o,r,n,a,i,s)}}).register("servicePauser",{fn:function(){return e.explore.services.createServicePauser()}}).register("formFactor",{services:["$timeout","telemetryService"],scopedServices:["eventBridge","selection","servicePauser","viewModeState"],fn:function(e,t,i,o,n,a){return r.createFormFactorProvider(i,o,n,e,a,t)}}).register("viewModeState",{fn:function(){return e.explore.services.createViewModeState()}}).register("colorPicker",{fn:function(){return e.common.createColorPickerService()}}).register("drill",{scopedServices:["eventBridge","visualPlugin","visualPluginOps"],fn:function(e,t,i){return r.createDrillService(e,t,i)}}).register("expandCollapse",{services:["featureSwitchService"],scopedServices:["visualPlugin"],fn:function(e,t){return r.createExpandCollapseService(t,e)}}).register("groupAuthoring",{services:["telemetryService"],fn:function(t){return e.explore.services.createDisabledGroupAuthoringService(t)}}).register("selection",{scopedServices:["eventBridge"],fn:function(t){return e.explore.services.createSelectionService(t)}}).register("visibility",{services:["telemetryService"],scopedServices:["eventBridge","selection","explorationNavigation"],fn:function(t,i,r,o){return e.explore.services.createVisibilityService(t,i,r,o)}}).register("deleteVisual",{services:["$rootScope","telemetryService"],scopedServices:["eventBridge","visualPlugin","undoRedo"],fn:function(t,i,r,o,n){return e.exploreui.services.createDeleteVisualService(r,t,i,o,n)}}).register("importVisual",{services:["localFileService","localizationService","modalDialogService","notificationToast","promiseFactory","telemetryService","upload"],scopedServices:["eventBridge","visualPlugin"],fn:function(t,i,r,o,n,a,s,l,c){return e.exploreui.services.createImportVisualService(t,i,r,o,n,a,s,l,c)}}).register("visualRelationship",{services:["featureSwitchService"],scopedServices:["visualPlugin","visualPluginOps","explorationNavigation","filterCapabilitiesService"],fn:function(t,i,r,o,n){return e.explore.services.createVisualRelationshipService(i,r,o,t,n)}}).register("visualPluginOps",{scopedServices:["visualPlugin"],fn:function(t){return e.explore.services.createVisualPluginOps(t)}}).register("undoRedo",{services:["$rootScope","$timeout","logger"],scopedServices:["eventBridge"],fn:function(t,i,r,o){return e.explore.services.createUndoRedoService(t,i,o,r)}}).register("clipboardStorage",{services:[],scopedServices:[],fn:function(){return e.explore.services.createWebClipboardStorageService()}}).register("clipboard",{services:["visualStylePreset","$rootScope","telemetryService"],scopedServices:["eventBridge","visibility","undoRedo","servicePauser","staticResourceReferences","clipboardStorage"],fn:function(t,i,r,o,n,a,s,l,c){return s.register(e.explore.services.createClipboardService(o,n,a,t,i,r,l,c))}}).register("hostFiltersService",{services:["conceptualSchemaProxy","singleExecutableDataProxyFactory","promiseFactory"],scopedServices:["eventBridge"],fn:function(t,i,r,o){return e.explore.services.createHostFiltersService(t,i,r,o)}}).register("visualPlugin",{services:["asyncFeatureSwitchService","mapControlFactory","promiseFactory","visualSandbox"],scopedServices:["resourceLoader"],fn:function(t,i,r,o,n){return e.explore.services.createExplorationVisualPluginService(t,r,n,i,o)}}).register("sort",{services:["displayNameService","featureSwitchService"],scopedServices:["visualPlugin"],fn:function(t,i,r){return e.explore.services.createSortService(t,i,r)}}).register("scriptVisuals",{services:["featureSwitchService","localizationService","userInfo","embedModeService","licenseEnforcementService"],scopedServices:["visualPlugin"],fn:function(t,i,r,o,n,a){return e.explore.services.createScriptVisualsService(a,t,i,r,o,n)}}).register("filterGenerator",{services:["aggrOps","telemetryService","featureSwitchService"],scopedServices:["eventBridge","hostFiltersService","visualPlugin","visualRelationship","scriptVisuals","filterCapabilitiesService"],fn:function(t,i,r,o,n,a,s,l,c){return e.explore.services.createFilterGenerator(o,a,t,s,n,i,l,r,c)}}).register("filterCapabilitiesService",{services:[],scopedServices:["visualPlugin"],fn:function(t){return e.explore.services.createFilterCapabilitiesService(t)}}).register("visualQueryGenerator",{services:["aggrOps","dataReaderProvider","displayNameService","featureSwitchService","transformPluginService","telemetryService"],scopedServices:["filterGenerator","visualPlugin","visualPluginOps","sort"],fn:function(t,i,r,o,n,a,s,l,c,u){return e.explore.services.createVisualQueryGenerator({dataReaders:i,displayNameService:r,featureSwitchService:o,plugin:l,pluginOps:c,sortService:u,aggrOps:t,filterGenerator:s,transformPluginService:n,telemetryService:a})}}).register("visualAuthoring",{services:["conceptualSchemaProxy","displayNameService","explorationSerializer","telemetryService","promiseFactory","geoTaggingAnalyzerService","featureSwitchService","aggrOps","hostTooltip","localizationService"],scopedServices:["drill","expandCollapse","eventBridge","undoRedo","explorationNavigation","resourceRegistration","selection","sort","viewModeState","visualPlugin","visualPluginOps","visualRelationship","filterGenerator","formFactor","lazyScopedSync","dataSources"],fn:function(t,i,r,o,n,a,s,l,c,u,p,d,h,v,g,f,y,m,S,w,C,b,x,F,D,V){return e.explore.services.createVisualAuthoring(w,C,t,i,o,g,y,a,r,h,n,v,s,m,b,p,d,x,l,c,f,F,u,D,S,V)}}).register("visualAuthoringOperations",{services:["aggrOps","displayNameService","explorationSerializer","featureSwitchService","geoTaggingAnalyzerService","localizationService","telemetryService"],scopedServices:["drill","expandCollapse","eventBridge","explorationNavigation","filterGenerator","formFactor","resourceRegistration","selection","sort","viewModeState","visualPlugin","visualPluginOps","visualRelationship"],fn:function(e,i,r,o,n,a,s,l,c,u,p,d,h,v,g,f,y,m,S,w){return t.util.createVisualAuthoringOperations(m,S,i,s,p,g,n,r,u,o,f,w,l,c,d,e,v,h,a,y)}}).register("canvasKeyHandler",{services:["explorationSerializer"],scopedServices:["selection","clipboard","undoRedo","viewModeState","visualAuthoring","eventBridge","visibility","formFactor","lazyScopedSync"],fn:function(t,i,r,o,n,a,s,l,c,u){return e.explore.services.createCanvasKeyHandlerService(r,i,t,n,o,a,s,l,c,u)}}).register("modelChangeHandler",{services:["conceptualSchemaProxy","dataProxy","lazy","pbiLazyLoad","promiseFactory"],scopedServices:["$scope","dataSources","eventBridge","undoRedo","visualPlugin"],fn:function(t,i,r,o,n,a,s,l,c,u){return e.explore.services.createModelChangeHandler(t,i,a,s,l,c,u,n,r,o)}}).register("modelAuthoring",{services:["promiseFactory","telemetryService","modalDialogService","localizationService","daxParserService","explorationSerializer","cultureService","uiBlockingService"],scopedServices:["modelChangeHandler","explorationNavigation"],fn:function(t,i,r,o,n,a,s,l,c,u,p,d){return e.explore.services.createModelAuthoringService(t,i,c,r,o,u,p,d,n,a,s,l)}}).register("clusteringState",{fn:function(){return e.explore.services.createClusteringStateService()}}).register("groupingDesignStateService",{fn:function(){return e.explore.services.createGroupingDesignStateService()}}).register("groupQueryService",{services:["conceptualSchemaProxy","promiseFactory","singleExecutableDataProxyFactory"],scopedServices:["filterGenerator","visualQueryGenerator"],fn:function(e,i,r,o,n){return t.services.createGroupQueryService(r,o,e,n,i)}}).register("schemaItemActivation",{scopedServices:["eventBridge"],fn:function(t){return e.explore.services.createSchemaItemActivationService(t)}}).register("shell",{fn:function(){return e.explore.services.createShellService()}}).register("pinVisual",{services:["conceptualSchemaProxy","displayNameService","singleExecutableDataProxyFactory","featureSwitchService","resourcePackagesService"],scopedServices:["visualQueryGenerator","visualPlugin","filterCapabilitiesService"],fn:function(t,i,r,o,n,a,s,l){return e.explore.services.createPinVisualService(t,i,r.create(),o,n,a,s,l)}}).register("explorationCapabilities",{services:["userInfo","featureSwitchService"],fn:function(t,i){return e.explore.services.createExplorationCapabilitiesService(t,i)}}).register("resourcePublishing",{fn:function(t){return e.explore.services.createResourcePublishingService()}}).register("resourceRegistration",{services:["promiseFactory"],scopedServices:["explorationNavigation","resourceLoader","resourcePublishing"],fn:function(t,i,r,o){return e.explore.services.createResourceRegistrationService(i,t,r,o)}}).register("staticResourceReferences",{services:["promiseFactory","explorationSerializer"],scopedServices:["resourceLoader","explorationNavigation","resourceRegistration"],fn:function(e,t,i,o,n){return r.createStaticResourceReferenceService(e,i,o,t,n)}}).register("filterRestatement",{services:["conceptualSchemaProxy","promiseFactory","dataProxy"],scopedServices:["filterGenerator","visualQueryGenerator"],fn:function(t,i,r,o,n){return e.explore.services.createFilterRestatementService(t,o,i,r,n)}}).register("visualValidator",{services:["featureSwitchService","localizationService","trustedVisual","resourcePackagesService"],scopedServices:["visualPlugin","scriptVisuals","shell"],fn:function(t,i,r,o,n,a,s){return e.explore.services.createVisualValidatorService(t,n,a,s,i,r,o)}}).register("showValueAsService",{services:["localizationService","promiseFactory","telemetryService"],scopedServices:["undoRedo","visualAuthoring","visualPlugin"],fn:function(t,i,r,o,n,a){return e.explore.services.createShowValueAsService(t,i,r,n,a)}}).register("visualContainerMenuFactory",{services:["conceptualSchemaProxy","dropdown","explorationExtensibilityService","featureSwitchService","localizationService","overlayService","promiseFactory","telemetryService"],scopedServices:["clipboard","dataSources","drill","expandCollapse","lazyScopedSync","eventBridge","explorationCapabilities","explorationNavigation","filterGenerator","formFactor","groupAuthoring","includeExcludeService","lazyScoped","undoRedo","visualPlugin","visualPluginOps","viewModeState","visibility","visualAuthoring"],fn:function(t,i,r,o,n,a,s,l,c,u,p,d,h,v,g,f,y,m,S,w,C,b,x,F,D,V,M){return e.explore.services.createVisualContainerMenuFactoryService(t,c,u,p,d,r,h,i,v,g,f,o,S,w,C,n,V,s,M,D,y,l,F,a,m,b,x)}}).register("incrementalRefreshPolicyService",{services:["modalDialogService","promiseFactory"],fn:function(t,i){return e.explore.services.createIncrementalRefreshPolicyService(t,i)}}).register("manageAggregationsService",{services:["modalDialogService","promiseFactory"],fn:function(t,i){return e.explore.services.createManageAggregationsService(t,i)}}).register("visualHostTooltipServiceFactory",{services:["hostTooltip"],scopedServices:["dataSources","explorationCapabilities","explorationNavigation","lazyScoped","visualPlugin","viewModeState","eventBridge"],fn:function(t,i,r,o,n,a,s,l){return e.explore.services.createVisualHostTooltipServiceFactory(i,r,o,t,n,a,s,l)}})}]),t.registerBuildingBlocksForHost=i})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){e.TransformElementResizeStartEventName="TransformElementResizeStart",e.TransformElementResizeMoveEventName="TransformElementResizeMove",e.TransformElementResizeEndEventName="TransformElementResizeEnd",e.TransformElementDragStartEventName="TransformElementDragStart",e.TransformElementDragMoveEventName="TransformElementDragMove",e.TransformElementDragEndEventName="TransformElementDragEnd",e.TransformElementNudgeEventName="TransformElementNudge",e.scrollCarouselToEndEventName="scrollCarouselToEnd",e.explorationLoadedEventName="explorationLoaded",e.pinVisualContainerEventName="pinVisualContainer",e.saveReportBeforePinning="saveReportFromPinDialog",e.trustedVisualConsentStateChangedEventName="trustedVisualConsentStateChanged",e.invalidVisualContainerId=-1,e.explorationNextPageEvent="explorationNextPage",e.explorationPreviousPageEvent="explorationPreviousPage",e.insertSectionEvent="insertSectionEvent",e.renameSectionEvent="renameSectionEvent",e.deleteSectionEvent="deleteSectionEvent",e.switchSectionEvent="switchSectionEvent",e.updateNavButtonEvent="updateNavButtonEvent",e.exploreCanvasVisualRendered="exploreCanvasVisualRendered",e.available="Available",e.applied="Applied",e.ConnectionSetupLimit=4,e.smallFontSizeInPoint=9;var t;!(function(e){e.AutoLayoutVisualPadding=10,e.AutoLayoutVisualVCHeader=20,e.AutoLayoutVisualSkittlesRightPadding=30,e.AutoLayoutMaxSpaceHeight=300,e.AutoLayoutMaxSpaceWidth=300,e.AutoLayoutMinSpaceHeight=150,e.AutoLayoutMinSpaceWidth=150,e.ResponsiveLayoutMaxWidthBreakpoint=500,e.ScrollbarOffset=15,e.DisplayAreaHeightAdditionMinimumScale=.9,e.DisplayAreaHeightScaleAddtion=.02,e.DisplayAreaOverflowEpsilonPx=8,e.DisplayAreaOutlineSize=8,e.DisplayAreaTransparencyOutlineThreshold=50,e.PhoneAuthoringViewportHeight=558,e.PhoneAuthoringViewportWidth=324,e.PhonePortraitRowCount=40,e.PhonePortraitCanvasHeight=2400})(t=e.ExploreCanvasConstants||(e.ExploreCanvasConstants={}))})(t=e.constants||(e.constants={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){e.ExploreUIShellModule={name:"powerbi.exploreUIShell",dependency:{javascript:"ExploreUIShell/module",css:["exploreUIShell"]}},e.ExploreUIDialogsModule={name:"powerbi.explore.dialogs",dependency:{javascript:"ExploreUIDialogs/module",css:["exploreUIDialogs"]}}})(t=e.modules||(e.modules={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t="accessibility-info-collapsed",i=".accessibility-info",r=(function(){function e(e,t){this.services=t}return e.createOptions=function(){return{additionalServices:["$element","localizationService"]}},e.prototype.$onInit=function(){var e=this;this.container=this.services.$element.find(i),this.container.on("focusin",(function(){e.show()})),this.container.on("focusout",(function(){e.hide()}));var t=this.services.localizationService.get("HotkeyDialog_Help");this.keyDescription=this.services.localizationService.format("AccessibilityInfo_KeyInfo",t)},e.prototype.skipToContent=function(){this.hide(),this.onClose&&this.onClose()},e.prototype.hide=function(){this.container.addClass(t)},e.prototype.show=function(){this.container.removeClass(t)},e})();e.AccessibilityInfoController=r})(t=e.controllers||(e.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){i.AccessibilityInfo={templateUrl:"components/accessibilityInfo/accessibilityInfo.html",bindings:{onClose:"<"},controller:e.common.createController(t.controllers.AccessibilityInfoController)}})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={})),powerbi.define("ExploreUI/components/boxGrid/boxGridController",(function(e){return (function(){function e(){}return e.prototype.getRows=function(){var e=this.viewModel&&this.viewModel.rowCount;if(e)return this.rows&&this.rows.length===e||(this.rows=_.range(e)),this.rows},e.prototype.getColumns=function(){var e=this.viewModel&&this.viewModel.columnCount;if(e)return this.columns&&this.columns.length===e||(this.columns=_.range(e)),this.columns},e.getSvgSize=function(e,t){return e&&t?2*e.margin+t*(e.size+e.gutter)-e.gutter:0},e.getBoxLocation=function(e,t){return e?e.margin+t*(e.size+e.gutter)+.5:0},e.getBoxSize=function(e){return e?e.size+-1:0},e.prototype.getSvgWidth=function(){return this.viewModel?e.getSvgSize(this.viewModel.layout&&this.viewModel.layout.horizontal,this.viewModel.columnCount):0},e.prototype.getSvgHeight=function(){return this.viewModel?e.getSvgSize(this.viewModel.layout&&this.viewModel.layout.vertical,this.viewModel.rowCount):0},e.prototype.getSvgStyle=function(){var e=this.viewModel&&this.viewModel.style;if(e)return{stroke:e.color}},e.prototype.getBoxX=function(t){return this.viewModel?e.getBoxLocation(this.viewModel.layout&&this.viewModel.layout.horizontal,t):0},e.prototype.getBoxWidth=function(){return this.viewModel?e.getBoxSize(this.viewModel.layout&&this.viewModel.layout.horizontal):0},e.prototype.getBoxY=function(t){return this.viewModel?e.getBoxLocation(this.viewModel.layout&&this.viewModel.layout.vertical,t):0},e.prototype.getBoxHeight=function(){return this.viewModel?e.getBoxSize(this.viewModel.layout&&this.viewModel.layout.vertical):0},e})()})),powerbi.define("ExploreUI/components/boxGrid/boxGrid",(function(e){return{templateUrl:"components/boxGrid/boxGrid.html",bindings:{viewModel:"<"},controller:powerbi.common.createController(e("ExploreUI/components/boxGrid/boxGridController"))}}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i,r=e.visuals.GradientUtils,o=e.data.SQExprBuilder;!(function(t){function i(e){return{solid:{color:n(e,r.getDefaultGradientSettings())}}}function n(t,i){var r,n={color:o.color(i.minColor,"minColor")},a=i.minValue;null!=a&&(r=o.double(a));var s,l;if(i.diverging){s={color:o.color(i.midColor,"midColor")};var c=i.midValue;null!=c&&(l=o.double(c));
}var u,p={color:o.color(i.maxColor,"maxColor")},d=i.maxValue;null!=d&&(u=o.double(d));var h,v=i.nullStrategy,g=i.nullColor,f={};return h=i.diverging?f.linearGradient3={min:n,mid:s,max:p}:f.linearGradient2={min:n,max:p},r&&(h.min.value=r),l&&(h.mid.value=l),u&&(h.max.value=u),v&&(h.nullColoringStrategy={strategy:o.text(v)},v===e.NullStrategy.specificColor&&(h.nullColoringStrategy.color=o.color(g,"nullColor"))),o.fillRule(t,f)}t.createDefaultFillDefinition=i,t.createFillExpression=n})(i=t.ConditionalFormattingUtil||(t.ConditionalFormattingUtil={}))})(i=t.util||(t.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i=(function(){function t(e,t,i,r,o,n){this.lazy=e,this.localizationService=t,this.modalDialogService=i,this.promiseFactory=r,this.telemetryService=o,this.visualAuthoring=n}return t.prototype.show=function(t,i,r,o,n,a,s){var l={fieldDisplayName:i,fieldExpr:r,repetition:n,schema:o,visual:t,fromPropertyPane:a,promiseFactory:this.promiseFactory,localizationService:this.localizationService,modalDialogService:this.modalDialogService,telemetryService:this.telemetryService,visualAuthoring:this.visualAuthoring,colorPalette:s},c=this.promiseFactory.defer();return this.lazy("dataBarsDialogBuilder").then((function(e){e.show(l).then((function(){c.resolve(void 0)})).catch((function(){c.reject()}))})),e.RejectablePromise(c)},t})();t.DataBarsDialogLauncher=i})(i=t.dialogs||(t.dialogs={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i=(function(){function t(e,t,i,r,o,n){this.lazy=e,this.localizationService=t,this.modalDialogService=i,this.promiseFactory=r,this.visualAuthoring=o,this.colorPickerService=n}return t.prototype.show=function(t,i,r,o,n,a){var s={targetExprDisplayName:i,targetExpr:r,repetition:n,targetExprQueryName:t.config.singleVisual.query.defn.selectNameOf(r),visual:t,dataSources:a,promiseFactory:this.promiseFactory,localizationService:this.localizationService,modalDialogService:this.modalDialogService,visualAuthoring:this.visualAuthoring,colorPickerService:this.colorPickerService},l=this.promiseFactory.defer();return this.lazy("conditionalFormattingDialogBuilder").then((function(e){e.show(s).then((function(){l.resolve(void 0)})).catch((function(){l.reject()}))})),e.RejectablePromise(l)},t})();t.ConditionalFormattingDialogLauncher=i})(i=t.dialogs||(t.dialogs={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){function r(e){var t=e.value.dateValue;e.value.value=s.formatValue(t,"d")}var o=t.services.events,n=e.explore.constants.ExploreCanvasConstants,a=t.contracts.FilterType,s=e.formattingService,l=e.common.utils.IdUtility,c=e.data.SemanticFilter,u=e.common.directives.TooltipAnchorElementType,p=(function(){function i(e,t){this.menuIds={},this.scope=e,this.services=t,this.initialize(),this.scope.useNewFilterPane=!1,this.initializeHighContrastRules()}return i.createOptions=function(){return{additionalServices:["aggrOps","conceptualSchemaProxy","cssGenerationService","overlayService","telemetryService","localizationService","tooltipService"],scopedDependencies:["dataSources","eventBridge","explorationActivity","explorationNavigation","undoRedo","viewModeState","visualAuthoring","visualPlugin"]}},i.prototype.$onInit=function(){return __awaiter(this,void 0,e.Promise,(function(){var e;return __generator(this,(function(t){return e=this.services.explorationNavigation&&this.services.explorationNavigation.getCurrentExploration(),this.updateUseNewFilterPaneSettings(e),[2]}))}))},i.prototype.initialize=function(){var i=this;this.scope.moduleConfig={name:"ui.bootstrap",dependency:{javascript:"angular-ui-datetimepicker"}},this.getConceptualSchema().then((function(e){var r=i.scope;i.advFilterCard=t.viewModels.FilterViewModelFactory.extractAdvFilterCard(r.viewModel.contract),r.advFilterCard=i.advFilterCard,r.applyFilter=function(){return i.applyFilter()},r.getMenuId=function(e){return i.menuIds[e]||(i.menuIds[e]=l.generateId()),i.menuIds[e]},r.handleFocusedInputChanged=function(e,t){return i.handleFocusedInputChanged(e,t)},r.handleInputBlur=function(){return i.handleInputBlur()},r.isDirty=!1,r.markDirty=function(){return i.scope.isDirty=!0},r.clearDirty=function(){return i.scope.isDirty=!1},r.validateFilterInput=function(e){return i.validateFilterInput(e)},r.dateOptions={showWeeks:!1},r.dateSelected=function(e){return i.dateSelected(e)},r.changeOperator=function(e){return i.changeOperator(e)},r.timeSelected=function(e){return i.timeSelected(e)},r.dateTextUpdateComplete=function(e){return i.dateTextUpdateComplete(e)},r.dateTextUpdated=function(e){return i.dateTextUpdated(e)},r.keyUp=function(e){return i.onKeyUp(e)},r.datePlaceholder=i.getLocalizedPlaceholder(),r.tooltipConfig={tooltipLocalizeTitle:"AdvancedFilter_InvalidTooltip",tooltipAnchorElementSelector:"input[type='text']:first",tooltipAnchorElementType:u.Sibling},i.updateRestatement(),i.updateModel(e),i.formatDate(i.scope.advFilterCard);var n=i.services.eventBridge.createChannelSubscriptionManager().subscribe(o.filterContainerChanged,(function(e,t){return i.onFilterContainerChanged(t)})).subscribe(o.explorationSettingsLoaded,(function(e,t){t.useNewFilterPaneExperienceChanged&&i.updateUseNewFilterPaneSettings(i.services.explorationNavigation.getCurrentExploration())}));r.$on("$destroy",(function(){return n.unsubscribeAll()}))})).catch((function(){return i.services.telemetryService.logEvent(e.telemetry.EXLoadFilterError,"Conceptual schema could not be found.")})),this.scope.viewModel.isInOutspacePane&&(this.scope.backgroundColor=n.DefaultControlBackgroundColor,this.scope.color=n.DefaultControlForegroundColor)},i.prototype.initializeHighContrastRules=function(){this.services.cssGenerationService.addRule(".themeableElement .advancedControl.conditionValue","{ border-color: @buttonForegroundColor !important; }")},i.prototype.updateModel=function(t){var i=this;if(this.advFilterCard.loadOperators(t,this.services.aggrOps),!this.advFilterCard.operators)return void this.services.telemetryService.logEvent(e.telemetry.EXLoadFilterError,"Filter operators failed to load.");var r=this.advFilterCard.field,o=r.getMetadata(t);o&&(this.advFilterCard.isDateTime=!!o.type.dateTime),this.advFilterCard.ensureConditions();var n=this.advFilterCard.conditions,a=this.scope;a.viewModel.updateFilterProperties(t,this.services.visualPlugin,this.services.aggrOps);for(var s=0,l=n;s<l.length;s++){var c=l[s];c&&c.value&&(c.value.formatter=this.scope.viewModel.formatter)}a.viewModel.updateViewState(),a.canApplyFilter=function(){return i.canApplyFilter(t)}},i.prototype.applyFilter=function(){var i=this,r=this.scope.viewModel;r.contract.type=a.Advanced,this.services.explorationActivity.doActivityAsync((function(e){return i.getConceptualSchema().then((function(o){i.services.undoRedo.register("ApplyAdvancedFilter",(function(){if(!i.canApplyFilter(o))return e(),!1;var n,a=i.advFilterCard.toSQExpr(o),s=i.scope.viewModel;a?(i.services.visualAuthoring.updateFilter(s.getFilterContainerScope(),s.contract,c.fromSQExpr(a)),n=2):(i.services.visualAuthoring.updateFilter(s.getFilterContainerScope(),s.contract,void 0),n=10);var l={filter:r.contract,changeType:n,scope:r.getFilterContainerScope(),source:s};return i.scope.clearDirty(),i.scope.viewModel.useDefaultFilter=!1,i.updateRestatement(),i.services.eventBridge.publishBubbling(i.scope,t.viewModels.FilterEvents.filterChanged,l),i.formatDate(i.scope.advFilterCard),!0}))}))}),(function(o){return i.services.telemetryService.startActivity(o,e.telemetry.EXFilterPaneAdvancedFilterApplied,r.isVisualFilter,t.contracts.FilterType.Advanced,t.util.getTelemetryViewMode(i.services.viewModeState.getMode()))}))},i.prototype.validateFilterInput=function(e){var t=this;this.getConceptualSchema().then((function(i){e.value&&e.value.value&&!t.advFilterCard.isConditionValid(i,e)?e.isInvalid=!0:(e.isInvalid=!1,t.services.tooltipService.hideTooltip())}))},i.prototype.formatDate=function(e){if(e.isDateTime)for(var t=0,i=e.conditions;t<i.length;t++){var o=i[t];r(o)}},i.prototype.handleFocusedInputChanged=function(e,t){this.validateFilterInput(t)},i.prototype.handleInputBlur=function(){this.services.tooltipService.hideTooltip()},i.prototype.dateSelected=function(e){this.services.overlayService.hideAllDropdowns(),e.value.dateValue&&r(e),this.scope.markDirty()},i.prototype.changeOperator=function(e){39!==e.keyCode&&37!==e.keyCode&&38!==e.keyCode&&40!==e.keyCode||(0===this.advFilterCard.logicalOperator?this.advFilterCard.logicalOperator=1:this.advFilterCard.logicalOperator=0,$(e.target).siblings().attr("tabindex","0").focus(),e.stopPropagation(),this.scope.markDirty())},i.prototype.timeSelected=function(e){if(e.value.value&&e.value.value instanceof Date){var t=e.value.timePickerValue.getHours(),i=e.value.timePickerValue.getMinutes();e.value.dateValue=new Date(e.value.value.setHours(t,i)),r(e)}else e.value.dateValue=e.value.timePickerValue,r(e);this.scope.markDirty()},i.prototype.dateTextUpdateComplete=function(e){_.isString(e.value.value)&&r(e)},i.prototype.dateTextUpdated=function(e){var t=s.parseDate(e.value.value);t&&(e.value.dateValue=t)},i.prototype.updateRestatement=function(){if(!this.scope.viewModel.useDefaultFilter&&this.scope.viewModel.contract.type===a.Advanced){var e=this.scope.viewModel;e.setRestatement(this.advFilterCard.getRestatement(e.formatter))}},i.prototype.getConceptualSchema=function(){var e=this.services.dataSources.get();return this.services.conceptualSchemaProxy.get(e)},i.prototype.onFilterContainerChanged=function(e){var i=this.scope.viewModel;if(e.filter===i.contract&&jsCommon.EnumExtensions.hasFlag(e.changeType,2)){var r=t.viewModels.FilterViewModelFactory.extractAdvFilterCard(e.filter);this.advFilterCard.conditions=r.conditions,this.advFilterCard.logicalOperator=r.logicalOperator,this.updateRestatement(),this.advFilterCard.ensureConditions()}},i.prototype.canApplyFilter=function(e){return this.scope.isDirty&&!this.scope.viewModel.readOnlyState.disabled&&this.advFilterCard.areConditionsValid(e)},i.prototype.onKeyUp=function(e){var t=this;e.preventDefault(),13===(e.keyCode||e.which)&&this.scope.$applyAsync((function(){return t.applyFilter()}))},i.prototype.updateUseNewFilterPaneSettings=function(e){e&&(this.scope.useNewFilterPane=e.settings&&e.settings.useNewFilterPaneExperience)},i.prototype.getLocalizedPlaceholder=function(){return s.getCurrentCulture().calendar.patterns.d},i})();i.AdvancedFilterController=p})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=(function(){function i(){this.restrict="E",this.replace=!0,this.scope={viewModel:"="},this.controller=e.common.createController(t.controllers.AdvancedFilterController),this.templateUrl="components/advancedFilter/advancedFilter.html"}return i})();i.AdvancedFilter=r})(i=t.directives||(t.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=t.util.CanvasDisplayUtility,o=e.explore.services.events,n=(function(){function i(e,t){this.$scope=e,this.services=t,this.resetCanvasLoading()}return i.createOptions=function(){return{scopedServiceRoot:!0,additionalServices:["$timeout","conceptualSchemaProxy"],scopedDependencies:["canvasScale","dataSources","eventBridge","explorationCapabilities","explorationNavigation","formFactor","lazyScoped","lazyScopedSync","viewModeState","visualAuthoring","visualPlugin"]}},i.prototype.$onInit=function(){var i=this;this.services.eventBridge.createChannelSubscriptionManager().subscribe(o.visualContainerLoadingStarted,(function(e,t){return i.onVisualContainerLoadingStarted(t)})).subscribe(o.visualContainerLoadingStopped,(function(e,t){return i.onVisualContainerLoadingStopped(t)})).subscribe(o.explorationLoaded,(function(){return __awaiter(i,void 0,e.Promise,(function(){return __generator(this,(function(e){switch(e.label){case 0:return this.explorationLoaded=!0,this.filterContext?[4,this.updateFilters()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))})).subscribe(o.explorationUnloaded,(function(){i.explorationLoaded=!1})).subscribe(o.sectionChanged,(function(){return __awaiter(i,void 0,e.Promise,(function(){return __generator(this,(function(e){switch(e.label){case 0:return this.filterContext?[4,this.updateFilters()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))})).subscribe(o.formFactorChanged,(function(){return i.updateViewport()})),this.$scope.$on(t.constants.exploreCanvasVisualRendered,(function(){i.visualsRendered=!0,i.checkForCanvasReady(!1)})),this.pluginsLoaded=!1,this.services.visualPlugin.ensureBuiltInPlugins().then((function(){return i.pluginsLoaded=!0})),this.canvasLayout=0,this.services.canvasScale.overrideDisplayOption=3,this.services.viewModeState.setMode(0),this.updateViewport()},i.prototype.$onChanges=function(t){return __awaiter(this,void 0,e.Promise,(function(){var e,i,r;return __generator(this,(function(o){switch(o.label){case 0:return e=!!t.sectionName,i=!!t.explorationContract,r=e||i,i&&this.services.explorationCapabilities.setCapabilities(this.explorationCapabilities),(e||i)&&(this.resetCanvasLoading(),this.updateViewport()),t.tooltipDataSources&&this.services.dataSources.set(t.tooltipDataSources.currentValue),!r&&(t.tooltipDataSources||t.identities||t.filterContext)&&this.filterContext&&this.explorationLoaded&&void 0!==this.sectionName?[4,this.updateFilters()]:[3,2];case 1:o.sent(),o.label=2;case 2:return[2]}}))}))},i.prototype.$onDestroy=function(){},i.prototype.updateViewport=function(){var e=this;if(!this.explorationContract||null==this.sectionName)return void(this.canvasSize=null);var t=_.find(this.explorationContract.sections,(function(t){return t.name===e.sectionName}));this.canvasSize=r.getCanvasActualSize(t,this.services.formFactor,this.services.explorationCapabilities)},i.prototype.onVisualContainerLoadingStarted=function(e){void 0===this.visualsLoading[e]&&(this.visualsLoading[e]=0),this.visualsLoading[e]++,this.visualsLoadingCount++,this.checkForCanvasReady(!0)},i.prototype.onVisualContainerLoadingStopped=function(e){void 0!==this.visualsLoading[e]&&(this.visualsLoading[e]--,this.visualsLoadingCount--,0===this.visualsLoading[e]&&delete this.visualsLoading.visualContainerName,this.checkForCanvasReady(!1))},i.prototype.updateFilters=function(){return __awaiter(this,void 0,e.Promise,(function(){var e,t,i,r,o,n,a=this;return __generator(this,(function(s){switch(s.label){case 0:if(!this.sectionName)return[2];e="__CanvasTooltipCanvas__",this.onVisualContainerLoadingStarted(e),s.label=1;case 1:return s.trys.push([1,,4,5]),[4,this.services.lazyScoped("drillthrough")];case 2:return t=s.sent(),i={targetName:this.sectionName,actionDisplayName:void 0,getFilterContext:function(){return a.filterContext}},(r=t.getApplyStateInfo(i,!1))?(o=this.services.lazyScopedSync("explorationStateManager"),[4,this.services.conceptualSchemaProxy.get(this.services.dataSources.get())]):[2];case 3:return n=s.sent(),o.apply(r.state,n,r.options),[3,5];case 4:return this.onVisualContainerLoadingStopped(e),[7];case 5:return[2]}}))}))},i.prototype.resetCanvasLoading=function(){this.visualsRendered=!1,this.visualsLoadingCount=0,this.visualsLoading={}},i.prototype.checkForCanvasReady=function(e){e&&1===this.visualsLoadingCount?this.onCanvasBusy():this.visualsRendered&&0===this.visualsLoadingCount&&this.onCanvasReady()},i})();i.CanvasTooltipController=n})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){t.CanvasTooltip={templateUrl:"components/canvasTooltip/canvasTooltip.html",controller:e.common.createController(t.CanvasTooltipController),bindings:{explorationContract:"<",explorationCapabilities:"<",tooltipDataSources:"<",identities:"<",filterContext:"<",sectionName:"<",showCanvasMask:"<",onCanvasReady:"&",onCanvasBusy:"&"}}})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i=e.common.utils.IdUtility,r=(function(){function e(e,t){this.moduleConfig={name:"ui.bootstrap",dependency:{javascript:"angular-ui-datetimepicker"}},this.services=t,this.id=i.generateId()}return e.createOptions=function(){return{additionalServices:["overlayService"]}},e.prototype.$onInit=function(){var e=this;this.ngModel.$render=function(){if(_.isNumber(e.ngModel.$viewValue)){var t=new Date(e.ngModel.$viewValue);"Invalid Date"!==t.toString()?e.ngModel.$setViewValue(t):e.ngModel.$setViewValue(void 0)}else void 0===e.ngModel.$viewValue?(e.textVal=void 0,e.dateVal=void 0,e.inputInvalid=!1):e.inputInvalid||(e.dateVal=e.ngModel.$viewValue,e.textVal=e.ngModel.$viewValue.toLocaleDateString()+" "+e.ngModel.$viewValue.toLocaleTimeString())}},e.prototype.$onChanges=function(e){e&&e.validators&&void 0!==this.textVal&&this.validateTextInput()},e.prototype.dateSelected=function(){this.inputInvalid=!1,this.textVal=this.dateVal.toLocaleDateString()+" "+this.dateVal.toLocaleTimeString(),this.ngModel.$setViewValue(this.dateVal),this.services.overlayService.hideAllDropdowns()},e.prototype.dateTextUpdated=function(){this.validateTextInput(),this.inputInvalid||this.ngModel.$setViewValue(this.dateVal)},e.prototype.validateTextInput=function(){if(this.textVal){var e=new Date(this.textVal);this.inputInvalid="Invalid Date"===e.toString(),this.validators&&(this.inputInvalid=this.inputInvalid||e<this.validators.min||e>this.validators.max),this.inputInvalid||(this.dateVal=e)}else this.textVal=void 0,this.dateVal=void 0,this.inputInvalid=!1},e})();t.DateTimePickerController=r})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){i.DateTimePicker={templateUrl:"components/dateTimePicker/dateTimePicker.html",bindings:{placeholder:"<",validators:"<"},require:{ngModel:"ngModel"},controller:e.common.createController(t.controllers.DateTimePickerController)}})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=e.data.DataViewObjectDefinitions,o=e.explore.services.events,n=e.data.SQConstantExpr,a=e.data.SQExprBuilder,s=e.visuals.TablixPropertyManager,l=e.explore.util.VisualContainerUtils,c=(function(){function i(e,i){this.services=i,this.spinnerService=t.services.createDetailVisualSpinnerService(e,i.eventBridge)}return i.createOptions=function(){return{additionalServices:["conceptualSchemaProxy","featureSwitchService","geocoder","localizationService","moduleLoader","promiseFactory","singleExecutableDataProxyFactory","telemetryService"],scopedDependencies:["dataSources","eventBridge","explorationNavigation","filterGenerator","visibility","visualPlugin","visualAuthoring","visualQueryGenerator"]}},i.prototype.$onInit=function(){this.dataProxy=this.services.singleExecutableDataProxyFactory.create(),this.visualDataProxyService=t.services.createExploreVisualDataProxyService(this.dataProxy,this.services.filterGenerator),this.queryVisualHostServices=this.createQueryVisualHostServices(),this.initializeVisual()},i.prototype.$onDestroy=function(){this.subscriptionManager&&this.subscriptionManager.unsubscribeAll()},i.prototype.$onChanges=function(e){e.viewModel&&!this.isInitialized&&this.initializeVisual()},i.prototype.initializeVisual=function(){var i=this;if(this.viewModel&&this.viewModel.parentContract){var r=this.viewModel.parentContract,n=this.viewModel.visual;n.visualPlugin=this.services.visualPlugin,n.interactivityOptions={isInteractiveLegend:!1,selection:!1},n.type=2===r.visibility?e.visuals.plugins.pivotTable.name:e.visuals.plugins.accessibleTable.name,n.hostServices=e.Prototype.inherit(t.services.createVisualHostServices(this.services.promiseFactory,this.services.moduleLoader,e.visuals.services.createGeolocation(),this.services.geocoder),(function(e){e.persistProperties=function(e){return i.persistProperties(e)},e.getLocalizedString=function(e){return i.services.localizationService.get(e)},e.getViewMode=function(){return 1},e.loadMoreData=function(){i.runQuery(!1,!1,!0)}})),this.initializeDetailVisualContract(n.type),this.subscriptionManager=this.services.eventBridge.createChannelSubscriptionManager().subscribe(o.visualContainerChanged,(function(e,t){t&&i.viewModel.parentContract&&t.affectContainer(i.viewModel.parentContract)&&i.runQuery(!1)})).subscribe(o.filterContainerChanged,(function(e,t){0===t.scope.scopeType&&t.scope.container!==i.viewModel.parentContract||i.runQuery(!1)})).subscribe(o.parentExpandCollapseAction,(function(e,t){t.visualContainer===i.viewModel.parentContract&&i.runQuery(!1)})),this.runQuery(!0),this.isInitialized=!0}},i.prototype.initializeDetailVisualContract=function(e){this.detailVisualContract={name:this.viewModel.parentContract.name,config:{singleVisual:{visualType:e}},layouts:jsCommon.ArrayExtensions.extendWithId([{id:0,position:{x:0,y:0,width:0,height:0}}])}},i.prototype.updateSubtotalState=function(){var e=this.viewModel.parentContract,t=!1,i=!1;if(e.config&&e.config.singleVisual&&"pivotTable"===e.config.singleVisual.visualType&&(t=!0,i=!0,e.config.singleVisual.objects)){var o=r.getValue(e.config.singleVisual.objects,s.PropSubTotalsPivotTableColumnSubtotals,void 0);o&&o.value&&(i=n.getBooleanValue(o)),o=r.getValue(e.config.singleVisual.objects,s.PropSubTotalsPivotTableRowSubtotals,void 0),o&&o.value&&(t=n.getBooleanValue(o))}var l=this.detailVisualContract.config.singleVisual.objects||{};r.setValue(l,s.PropSubTotalsPivotTableRowSubtotals,null,a.boolean(t)),r.setValue(l,s.PropSubTotalsPivotTableColumnSubtotals,null,a.boolean(i)),this.detailVisualContract.config.singleVisual.objects=l},i.prototype.persistProperties=function(e){var t=this.detailVisualContract,i=_.isArray(e)?{replace:e}:e;this.services.visualAuthoring.persistProperties(i,t,!0)&&this.runQuery(!1,!0)},i.prototype.runQuery=function(e,t,i){var r=this;if(void 0===i&&(i=!1),this.viewModel&&this.viewModel.parentContract){this.updateSubtotalState();var o=this.viewModel.parentContract,n=this.services.dataSources.get();n&&o.config&&o.config.singleVisual&&(i&&!this.visualDataProxyService.canLoadMore()||(this.spinnerService.startSpinner(),this.services.conceptualSchemaProxy.get(n).then((function(o){var a=r.viewModel.parentContract,s={dataSources:n,schema:o,config:a.config.singleVisual,hostServices:r.queryVisualHostServices,visualQueryGenerator:r.services.visualQueryGenerator,isLoadMore:i,preferCurrentData:t,additionalDataViewKinds:2};return r.visualDataProxyService.runQuery(s).then((function(t){return r.onDataChanged(t,e,i)}),(function(t){return r.clearData("Query error",e)}))}),(function(t){return r.clearData("Conceptual schema error",e)})).finally((function(){return r.spinnerService.stopSpinner()}))))}},i.prototype.clearData=function(e,t){var i=this.viewModel,r={dataView:{metadata:{columns:[]},matrix:{rows:{root:{children:[],childIdentityFields:[]},levels:[]},columns:{root:{children:[]},levels:[]},valueSources:[]}},dataViewSource:null};i.visual.dataTransforms={},i.visual.data=r,i.hasData=!1},i.prototype.onDataChanged=function(i,r,o){var n;if(n=i?{dataView:i&&i.dataReaderResult?i.dataReaderResult.dataView:null,dataViewSource:i&&i.dataViewSource?i.dataViewSource:null}:this.viewModel.visual.data){var a=n.dataView;if(a&&!a.matrix){return void this.clearData("No matrix data view",r)}var s=l.isSegment(n.dataView);s&&(n.isFirstSegment=s);var c;if(null!=a){var u=this.visualDataProxyService.lastExecutedQuery(),p=l.getDataRolesForVisual(this.viewModel.parentContract,this.services.visualPlugin),d=_.map(p,(function(e){return e.name})),h=t.util.MatrixVisualDataViewConverter.generate(a,u.transforms.selects,u.transforms.splits,d,u.transforms.roles&&u.transforms.roles.ordering,this.services.featureSwitchService);if(c=h?h.transformActions:void 0,n.dataView=h&&h.dataView?h.dataView:n.dataView,!c)return void this.clearData("Failed to generate data view transform actions",r);c.objects=this.detailVisualContract.config.singleVisual.objects}o&&(a=this.viewModel.visual.data.dataView,e.data.segmentation.DataViewMerger.mergeDataViews(a,n.dataView),n.dataView=a),this.viewModel.visual.dataTransforms=c,this.viewModel.visual.data=n,this.viewModel.hasData=!0}},i.prototype.createQueryVisualHostServices=function(){var i=this;return e.Prototype.inherit(t.util.VisualHostServicesUtil.createQueryVisualHostServices(),(function(e){return e.getFilters=function(e,t){var r=i.services.explorationNavigation;return e.calculateDetailVisualFilter(r.getCurrentExploration(),r.getCurrentSection(),i.viewModel.parentContract,t,1)}}))},i})();i.DetailVisualController=c})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){i.DetailVisual={templateUrl:"components/detailVisual/detailVisual.html",bindings:{viewModel:"<"},controller:e.common.createController(t.controllers.DetailVisualController)}})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=t.services.events,o=(function(){function i(e,i){var o=this;this.scope=e,this.services=i,this.services.eventBridge.createChannelSubscriptionManager().subscribe(r.renameSection,(function(e,t){return o.renameSection(t)})),this.exploreUIShellConfig=t.modules.ExploreUIShellModule}return i.createOptions=function(){return{additionalServices:["dropdown","lazySync"],scopedDependencies:["eventBridge","explorationNavigation","formFactor","lazyScoped","undoRedo","viewModeState"]}},i.prototype.isBookmarkView=function(){return null!=this.services.viewModeState.getViewState().bookmarkView},i.prototype.createSection=function(){this.services.eventBridge.publishToChannel(r.createSection)},i.prototype.seeAllSections=function(e){var t=this,i={items:[]};i.items=_.map(this.viewModel.exploration.sections,(function(e,t){return{key:t,text:e.displayName,type:0,selected:e.selected}})),this.services.dropdown.showContextMenu(i,{x:e.pageX,y:e.pageY},(function(e){return t.services.eventBridge.publishBubbling(t.scope,r.switchSection,e)}),!0,void 0,!0,!0)},i.prototype.isEditMode=function(){return this.services.formFactor.getCurrentLayoutCapabilities().canAddRemoveSections()},i.prototype.isReadingMode=function(){return 0===this.services.viewModeState.getMode()},i.prototype.getModeString=function(){return this.isEditMode()?"editing":this.isReadingMode()||1===this.services.viewModeState.getMode()&&1===this.services.formFactor.getCurrentLayout()?"reading":void 0},i.prototype.isHiddenInViewMode=function(e){return!!(1&e.contract.visibility)},i.prototype.isOnlySectionVisibleInViewMode=function(e){if(this.isHiddenInViewMode(e))return!1;for(var t=0,i=this.viewModel.exploration.sections;t<i.length;t++){var r=i[t];if(r!==e&&!this.isHiddenInViewMode(r))return!1}return!0},i.prototype.renameSection=function(t){return __awaiter(this,void 0,e.Promise,(function(){var e;return __generator(this,(function(i){switch(i.label){case 0:return[4,this.services.lazyScoped("explorationAuthoring")];case 1:return e=i.sent(),e.renameSection(this.viewModel,t.sectionNewName,t.sectionIndex),[2]}}))}))},i})();i.ExplorationFooterController=o})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){t.ExplorationFooter={templateUrl:"components/explorationFooter/explorationFooter.html",bindings:{viewModel:"<"},controller:e.common.createController(e.explore.controllers.ExplorationFooterController)}})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=e.explore.util.DragDropTypes,o=e.explore.services.events,n=e.explore.constants.ExploreCanvasConstants,a=jsCommon.PixelConverter,s=t.services.selectionUtils,l=(function(){function i(e,i){var n=this;this.scope=e,this.services=i;var a=this.services.explorationNavigation.getCurrentExploration();this.scope.viewModel=t.viewModels.ViewModelFactory.createFilterPane(this.services.localizationService,null!=a),this.scope.viewModeState=i.viewModeState,this.scope.dropPageFilter=function(e,t,i){return n.dropPageFilter(e,t,i)},this.scope.dropDrillthroughFilter=function(e,t,i){return n.dropDrillthroughFilter(e,t,i)},this.scope.dropReportFilter=function(e,t,i){return n.dropReportFilter(e,t,i)},this.scope.dropVisualFilter=function(e,t,i){return n.dropVisualFilter(e,t,i)},this.scope.dropConfig={accept:r.Field},this.scope.getDropAction=function(e){return n.getDropAction(e)},this.scope.isVisualFiltersVisible=function(){return n.isVisualFiltersVisible()},this.scope.isPageFiltersVisible=function(){return n.isPageFiltersVisible()},this.scope.isDrillthroughFiltersVisible=function(){return n.isDrillthroughFiltersVisible()},this.scope.isTooltipLinksVisible=function(){return n.isTooltipLinksVisible()},this.scope.isReportFiltersVisible=function(){return n.isReportFiltersVisible()},this.scope.showNoFiltersHeader=function(){return n.showNoFiltersHeader()},this.scope.exploreUIShellConfig=t.modules.ExploreUIShellModule;var s=t.viewModels.createFieldListViewModelFactory(t.viewModels.createFieldListMenuItemFactory(this.services.localizationService,this.services.featureSwitchService),t.viewModels.createFieldListPropertyTemplateGenerator(),this.services.localizationService,this.services.featureSwitchService);this.scope.fieldListConfig={viewModelFactory:s,alwaysHasActiveItem:!1,hideCheckboxes:!0},this.scope.createAdhocFilter=function(e,t,i){return n.createAdhocFilter(e,t,i)},this.scope.toggleFieldList=function(e){return n.toggleFieldList(e)},this.currentFieldListScope=void 0,this.scope.isFieldListShown=function(e){return n.isFieldListShown(e)},this.scope.enableFilterAddExperience=function(){return!1};var l=this.services.eventBridge.createChannelSubscriptionManager().subscribe(o.selectionChanged,(function(){return n.updateSelection()})).subscribe(o.modelChanged,(function(){return n.onModelChanged()})).subscribe(o.canvasChanged,(function(){return n.onCanvasChanged()})).subscribe(o.explorationLoaded,(function(){return n.onModelChanged()})).subscribe(o.visualContainerChanged,(function(e,t){return n.onVisualContainerChanged(t)})).subscribe(o.explorationFiltersContainerChanged,(function(e,t){return n.onExplorationFiltersContainerChanged(t)})).subscribe(o.sectionFiltersContainerChanged,(function(e,t){return n.onSectionFiltersContainerChanged(t)})).subscribe(o.filterContainerChanged,(function(e,t){return n.onFilterContainerChanged(t)})).subscribe(o.explorationLoaded,(function(){return n.updateUseNewFilterPaneSettings(n.services.explorationNavigation.getCurrentExploration())})).subscribe(o.explorationSettingsLoaded,(function(e,t){t.useNewFilterPaneExperienceChanged&&n.updateUseNewFilterPaneSettings(n.services.explorationNavigation.getCurrentExploration())}));e.$on("$destroy",(function(){return l.unsubscribeAll()})),this.updateSelection(),this.onModelChanged()}return i.createOptions=function(){return{additionalServices:["aggrOps","conceptualSchemaProxy","displayNameService","dragDataService","featureSwitchService","localizationService","promiseFactory","telemetryService"],scopedDependencies:["dataSources","eventBridge","explorationCapabilities","explorationNavigation","scriptVisuals","selection","viewModeState","visualAuthoring","visualPlugin","visualPluginOps"]}},i.prototype.$onInit=function(){this.filterPaneHeaderLocalization_Visual="FilterPane_Visual"+(this.isInOutspacePane?"_OutspacePane":""),this.filterPaneHeaderLocalization_Page="FilterPane_Page"+(this.isInOutspacePane?"_OutspacePane":""),this.filterPaneHeaderLocalization_Report="FilterPane_Report"+(this.isInOutspacePane?"_OutspacePane":""),this.updateUseNewFilterPaneSettings(this.services.explorationNavigation.getCurrentExploration())},i.prototype.$onChanges=function(e){e.sectionObjects&&this.updateFormatting(e.sectionObjects.currentValue);
},i.prototype.updateFormatting=function(t){if(this.isInOutspacePane){var i=t&&t.outspacePane,r=e.DataViewObject.getValue(i,"fontFamily",n.DefaultOutspacePaneFontFamily);this.headerFontFamily=r;var o=e.DataViewObject.getValue(i,"headerSize",n.DefaultOutspacePaneHeaderSizePx);this.headerFontSize=a.toString(o)}},i.prototype.newFilterPaneEnabled=function(){return this.useNewFilterPane},i.prototype.onModelChanged=function(){this.createReportFilters(),this.createPageScopeFilters()},i.prototype.onExplorationFiltersContainerChanged=function(e){e.container===this.services.explorationNavigation.getCurrentExploration()&&this.createReportFilters()},i.prototype.onSectionFiltersContainerChanged=function(e){e.container===this.services.explorationNavigation.getCurrentSection()&&this.createPageScopeFilters()},i.prototype.onCanvasChanged=function(){this.createPageScopeFilters()},i.prototype.isFieldListShown=function(e){return this.currentFieldListScope===e},i.prototype.toggleFieldList=function(e){void 0===this.currentFieldListScope||this.currentFieldListScope!==e?this.currentFieldListScope=e:this.currentFieldListScope=void 0},i.prototype.createAdhocFilter=function(e,t,i){var r,o=this.services.dataSources.get();0===i?r={scopeType:0,container:this.getSelectedVisual()}:1===i?r={scopeType:1,container:this.services.explorationNavigation.getCurrentSection()}:2===i?r={scopeType:2,container:this.services.explorationNavigation.getCurrentExploration()}:debug.assertNever(i),this.services.visualAuthoring.addFilter(t,r,o)},i.prototype.getDropAction=function(e,t){var i=this.services.promiseFactory.defer(),r=this.services.dragDataService.getDragContext();return r&&r.field?i.resolve(3):i.resolve(0),i.promise},i.prototype.dropVisualFilter=function(e,i,r){var o=this.getSelectedVisual();o&&t.util.FilterPaneUtil.addFilterToScopeFromDrop(0,o,!1,this.services.dataSources,this.services.dragDataService,this.services.visualAuthoring)},i.prototype.dropPageFilter=function(e,i,r){var o=this.services.explorationNavigation.getCurrentSection();t.util.FilterPaneUtil.addFilterToScopeFromDrop(1,o,!1,this.services.dataSources,this.services.dragDataService,this.services.visualAuthoring)},i.prototype.dropDrillthroughFilter=function(e,i,r){var o=this.services.explorationNavigation.getCurrentSection();t.util.FilterPaneUtil.addFilterToScopeFromDrop(1,o,!0,this.services.dataSources,this.services.dragDataService,this.services.visualAuthoring)},i.prototype.dropReportFilter=function(e,i,r){var o=this.services.explorationNavigation.getCurrentExploration();t.util.FilterPaneUtil.addFilterToScopeFromDrop(2,o,!1,this.services.dataSources,this.services.dragDataService,this.services.visualAuthoring)},i.prototype.isVisualFiltersVisible=function(){var e=this.scope.viewModeState.getMode(),t=1===e,i=0===e;if(this.isInOutspacePane){var r=_.filter(this.scope.viewModel.visualFilters,(function(e){return e.contract.isHiddenInViewMode!==!0}));return this.scope.viewModel.isVisualVisible&&!_.isEmpty(r)}return!(!t||!this.scope.viewModel.isVisualVisible)||!(!i||_.isEmpty(this.scope.viewModel.visualFilters))},i.prototype.isPageFiltersVisible=function(){var e=this.scope.viewModel.pageFilters;return this.isInOutspacePane&&(e=e.concat(this.scope.viewModel.drillthroughFilters)),this.isPageOrReportScopeFiltersVisible(e)},i.prototype.isDrillthroughFiltersVisible=function(){if(!this.scope.viewModeState.getConfig().displayOptions.showDrillthroughFilters&&this.services.featureSwitchService.featureSwitches.measureDrillthrough)return!1;var e=this.services.explorationNavigation.getCurrentSection();return!(!e||null!=e.type&&0!==e.type)&&this.isPageOrReportScopeFiltersVisible(this.scope.viewModel.drillthroughFilters)},i.prototype.isReportFiltersVisible=function(){return this.isPageOrReportScopeFiltersVisible(this.scope.viewModel.reportFilters)},i.prototype.showNoFiltersHeader=function(){return this.isInOutspacePane&&!this.isVisualFiltersVisible()&&!this.isPageFiltersVisible()&&!this.isDrillthroughFiltersVisible()&&!this.isReportFiltersVisible()},i.prototype.isPageOrReportScopeFiltersVisible=function(e){if(this.isInOutspacePane)e=_.reduce(e,(function(e,t){return t.contract.isHiddenInViewMode||e.push(t),e}),[]);else{var t=this.scope.viewModeState;if(t.getConfig().alwaysPopulatePanes)return!0;if(1===t.getMode())return!0}return!_.isEmpty(e)},i.prototype.updateSelection=function(){var e=this.scope.viewModel,t=this.getSelectedVisual();e.visualFilters.length=0,t&&this.services.visualPluginOps.isQueryVisual(t.config.singleVisual.visualType)?(e.isVisualVisible=!0,this.updateVisualFilters()):this.scope.viewModel.isVisualVisible=!1},i.prototype.onVisualContainerChanged=function(e){if(e){var t=this.getSelectedVisual();t&&e.affectContainer(t)&&this.updateVisualFilters()}},i.prototype.onFilterContainerChanged=function(e){var i=5===e.filter.howCreated&&this.services.featureSwitchService.featureSwitches.measureDrillthrough&&!this.scope.viewModeState.getConfig().displayOptions.showDrillthroughFilters,r=this.scope.viewModel;if(t.util.FilterPaneUtil.updateCategoricalFiltersIfNeeded(this.services,0,this.scope.viewModel.visualFilters,e),t.util.FilterPaneUtil.updateCategoricalFiltersIfNeeded(this.services,1,this.scope.viewModel.pageFilters,e),t.util.FilterPaneUtil.updateCategoricalFiltersIfNeeded(this.services,2,this.scope.viewModel.reportFilters,e),i||t.util.FilterPaneUtil.updateCategoricalFiltersIfNeeded(this.services,1,this.scope.viewModel.drillthroughFilters,e),!i||this.isInOutspacePane){var o,n=this.services.explorationNavigation.getCurrentExploration(),a=this.getSelectedVisual();switch(e.scope.scopeType){case 0:o=r.visualFilters;break;case 1:o=5===e.filter.howCreated?r.drillthroughFilters:r.pageFilters;break;case 2:o=r.reportFilters;break;default:return}t.util.FilterPaneUtil.onFilterContainerChanged(e,o,n,this.services,a)}},i.prototype.getSelectedVisual=function(){return s.getSelectedVisual(this.services.selection)},i.prototype.createPageScopeFilters=function(){return __awaiter(this,void 0,e.Promise,(function(){var e,i,r,o;return __generator(this,(function(n){switch(n.label){case 0:return[4,t.util.FilterPaneUtil.getPageScopeFilters(this.services)];case 1:for(e=n.sent(),this.scope.viewModel.pageFilters=[],this.scope.viewModel.drillthroughFilters=[],i=0,r=e;i<r.length;i++)o=r[i],5!==o.howCreated?this.scope.viewModel.pageFilters.push(o):this.scope.viewModel.drillthroughFilters.push(o);return[2]}}))}))},i.prototype.createReportFilters=function(){return __awaiter(this,void 0,e.Promise,(function(){var e,i;return __generator(this,(function(r){switch(r.label){case 0:return e=this.services.explorationNavigation.getCurrentExploration(),e?[4,t.util.FilterPaneUtil.getConceptualSchema(this.services.dataSources,this.services.conceptualSchemaProxy)]:(this.scope.viewModel.reportFilters=null,[2]);case 1:return i=r.sent(),this.scope.viewModel.reportFilters=t.viewModels.ViewModelFactory.createFilters({scopeType:2,container:e},i,this.services.displayNameService,this.services.visualPlugin,this.services.aggrOps,this.services.localizationService,null),t.util.FilterPaneUtil.addConfigToFilters(this.scope.viewModel.reportFilters,i,this.services.dataSources,this.services.visualAuthoring),[2]}}))}))},i.prototype.updateVisualFilters=function(){return __awaiter(this,void 0,e.Promise,(function(){var e,i,r;return __generator(this,(function(o){switch(o.label){case 0:return[4,t.util.FilterPaneUtil.getConceptualSchema(this.services.dataSources,this.services.conceptualSchemaProxy)];case 1:return e=o.sent(),i=this.services.explorationNavigation.getCurrentSection(),(r=this.getSelectedVisual())?(this.scope.viewModel.visualFilters=this.services.visualAuthoring.createVisualFilters(i,r,this.services.dataSources.get(),e,!this.isInOutspacePane),[2]):[2]}}))}))},i.prototype.isTooltipLinksVisible=function(){if(this.services.featureSwitchService.featureSwitches.measureDrillthrough)return!1;var e=this.services.explorationNavigation.getCurrentSection();if(!e)return!1;var t=this.scope.viewModeState;return 1===e.type&&(t.getConfig().alwaysPopulatePanes||1===t.getMode())},i.prototype.updateUseNewFilterPaneSettings=function(e){e&&(this.useNewFilterPane=e.settings&&e.settings.useNewFilterPaneExperience)},i})();i.FilterPaneController=l})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){t.FilterPane={bindings:{isInOutspacePane:"<?",sectionObjects:"<?"},controller:e.common.createController(t.FilterPaneController),templateUrl:"components/filterPane/filterPane.html"}})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){e.filterChanged={name:"filterChanged"},e.topNFilterOrderByUpdate={type:2,name:"topNFilterOrderByUpdate"}})(t=e.FilterEvents||(e.FilterEvents={}))})(t=e.viewModels||(e.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=e.common.utils.ColorUtility,o=e.explore.services.events,n=e.explore.constants.ExploreCanvasConstants,a=t.contracts.FilterType,s=e.data.RestatementHelper,l=e.data.SemanticFilter,c=(function(){function i(e,t){this.scope=e,this.services=t,this.useNewFilterPane=!1,this.initializeHighContrastRules()}return i.createOptions=function(){return{additionalServices:["conceptualSchemaProxy","cssGenerationService","displayNameService","hostTypeResolutionService","$element","localizationService","featureSwitchService","telemetryService"],scopedDependencies:["dataSources","eventBridge","explorationActivity","explorationNavigation","includeExcludeService","visualAuthoring","viewModeState"]}},i.prototype.$onInit=function(){var e=this,i=this.viewModel;i.updateViewState(),i.updateAvailableTypes(),i.isInOutspacePane=this.isInOutspacePane;var r=this.services;this.tooltipConfigManager={getTooltipConfig:function(){return{tooltipDisable:!i.readOnlyState.invalid,tooltipTitle:r.localizationService.get("Invalid_Filter_Tooltip")}}},r.eventBridge.subscribeToBubbling(this.scope,t.viewModels.FilterEvents.filterChanged,(function(t,i){return e.onFilterChanged(t,i)})),i.chevronExpandDescription=r.localizationService.get("Chevron_ExpandDescription"),i.chevronCollapseDescription=r.localizationService.get("Chevron_CollapseDescription"),this.subscriptionManager=r.eventBridge.createChannelSubscriptionManager().subscribe(o.filterContainerChanged,(function(t,i){return e.onFilterContainerChanged(i)})).subscribe(o.explorationSettingsLoaded,(function(t,i){i.useNewFilterPaneExperienceChanged&&e.updateUseNewFilterPaneSettings(e.services.explorationNavigation.getCurrentExploration())})),this.updateUseNewFilterPaneSettings(this.services.explorationNavigation.getCurrentExploration()),this.initializeDefaultValue(),this.updateRestatement()},i.prototype.$onChanges=function(e){e.sectionObjects&&this.updateBackgroundStyle(this.sectionObjects)},i.prototype.$onDestroy=function(){this.subscriptionManager.unsubscribeAll()},i.prototype.updateLinkAsAggregation=function(){var e=this.viewModel;if(this.services.visualAuthoring.setLinkFieldAsAggregation(e.contract,e.isLinkedAsAggregation),e.isLinkedAsAggregation&&e.contract.filter){this.viewModel.clearRestatement(),this.services.visualAuthoring.updateFilter(e.getFilterContainerScope(),e.contract,void 0);var t={filter:e.contract,changeType:10,scope:e.getFilterContainerScope()};this.services.eventBridge.publishToChannel(o.filterContainerChanged,t)}var i={filter:e.contract,changeType:64,scope:e.getFilterContainerScope(),source:e};this.services.eventBridge.publishToChannel(o.filterContainerChanged,i);var r={filter:e.contract,changeType:16,scope:e.getFilterContainerScope()};this.services.eventBridge.publishToChannel(o.filterContainerChanged,r)},i.prototype.getLabelForAsAggregationOption=function(e){return e?this.services.localizationService.get("LinkField_AsAggregationEnabledText"):this.services.localizationService.get("LinkField_AsAggregationDisabledText")},i.prototype.getResourceIdForAsAggregationDropdown=function(){return 1===this.services.explorationNavigation.getCurrentSection().type?"LinkField_AsAggregationForTooltip":"LinkField_AsAggregationForDrillthrough"},i.prototype.isIncludeExclude=function(){return this.viewModel.contract.type===a.Include||this.viewModel.contract.type===a.Exclude},i.prototype.getDisplayName=function(){return this.viewModel.displayName},i.prototype.getRestatement=function(){var e;return this.viewModel.contract.type===a.Passthrough?e="":(e=this.viewModel.getRestatement(),e||(e=this.services.localizationService.get("FilterRestatement_IsAll"))),e},i.prototype.isFilterApplied=function(){return!(!this.viewModel.getRestatement()||!this.useNewFilterPane&&!this.useMobileFilterConfig()||this.viewModel.contract.type===a.Passthrough)},i.prototype.getTooltip=function(){var e;return e=this.isIncludeExclude()?this.getDisplayName():this.viewModel.contract.type===a.Passthrough?this.getDisplayName():this.viewModel.tooltip},i.prototype.getIconClassName=function(){var e=this.viewModel;if(5===e.howCreated&&this.isMeasureDrillthroughEnabled()&&e.contract&&!e.contract.isTransient)return e.isMeasure?"fieldListMeasure":e.isLinkedAsAggregation?"fieldListNumeric":void 0},i.prototype.showExpandIcon=function(){return this.viewModel.canExpandManually&&this.viewModel.contract.type!==a.Passthrough},i.prototype.showLockIcon=function(){return!this.useMobileFilterConfig()&&this.useNewFilterPane&&!this.isInOutspacePane&&6!==this.viewModel.howCreated},i.prototype.showClearIcon=function(){return this.viewModel.canClearManually&&this.viewModel.contract.type!==a.Passthrough&&!this.isIncludeExclude()},i.prototype.showVisibilityIcon=function(){return!this.useMobileFilterConfig()&&this.useNewFilterPane&&!this.isInOutspacePane&&6!==this.viewModel.howCreated},i.prototype.showFilterTypeSelection=function(){return!this.isInOutspacePane&&this.viewModel.availableTypes.length>1&&!this.viewModel.isSingleSelectionRequired&&!this.viewModel.isInvalid()&&!this.isIncludeExclude()},i.prototype.isMeasureDrillthroughEnabled=function(){return!!this.services.featureSwitchService.featureSwitches.measureDrillthrough},i.prototype.getFilterLockTooltip=function(){return this.viewModel.isFilterLocked()?"FilterPane_FilterLocked":this.viewModel.contract.isLockedInViewMode?"FilterPane_UnlockFilter":"FilterPane_LockFilter"},i.prototype.useMobileFilterConfig=function(){return this.services.viewModeState.getConfig().displayOptions.useMobileFilterConfiguration},i.prototype.initializeHighContrastRules=function(){this.services.cssGenerationService.addRule(".themeableElement .visual .slicer-container .slicer-content-wrapper .searchHeader","{ border-color: @buttonForegroundColor !important; }"),this.services.cssGenerationService.addRule(".themeableElement .slicerCheckbox span.checkbox","{ background-color: @foregroundColor !important; border-color: @foregroundColor !important; }"),this.services.cssGenerationService.addRule(" .themeableElement .slicerCheckbox span.checkbox:before","{ border-color: @backgroundColor !important; }")},i.prototype.getAriaLabelString=function(){var e=this.getDisplayName(),t=this.getRestatement();return t&&(e=e+" "+t),e},i.prototype.onFilterChanged=function(e,t){var i=this.viewModel.contract.expression;this.viewModel.useDefaultFilter&&(t.filter.filter=l.getDefaultValueFilter(i)),this.services.eventBridge.publishToChannel(o.filterContainerChanged,t),this.updateRestatement(),this.updateBackgroundStyle(this.sectionObjects)},i.prototype.onFilterContainerChanged=function(e){var t=this.viewModel;e.filter===t.contract&&jsCommon.EnumExtensions.hasFlag(e.changeType,2)&&(this.updateRestatement(),this.viewModel.updateViewState()),e.filter===t.contract&&t!==e.source&&(jsCommon.EnumExtensions.hasFlag(e.changeType,32)&&((e.filter.type===a.TopN&&t.cardType.type!==a.TopN||e.filter.type!==a.TopN&&t.cardType.type===a.TopN)&&this.viewModel.clearRestatement(),t.updateCardType(e.filter.type)),jsCommon.EnumExtensions.hasFlag(e.changeType,16)&&this.viewModel.updateViewState());var i=e.filter,r=this.viewModel.contract;this.isInOutspacePane&&64===e.changeType&&t!==e.source&&i===r&&i.isLinkedAsAggregation!==this.viewModel.isLinkedAsAggregation&&(t.isLinkedAsAggregation=i.isLinkedAsAggregation,this.updateLinkAsAggregation()),this.updateBackgroundStyle(this.sectionObjects)},i.prototype.toggle=function(i,r){if(r.canExpandManually){var n=r.contract;n.expanded=!n.expanded,this.services.telemetryService.logEvent(e.telemetry.EXToggleFilterCardExpanded,t.util.getTelemetryFilterType(n.type),t.util.getTelemetryFilterScopeType(r.getFilterContainerScope().scopeType),t.util.getTelemetryFieldKind(n.expression),n.expanded,t.util.getTelemetryViewMode(this.services.viewModeState.getMode())),r.updateViewState();var a=this.viewModel,s={filter:a.contract,changeType:16,scope:a.getFilterContainerScope()};this.services.eventBridge.publishToChannel(o.filterContainerChanged,s)}},i.prototype.clearFilter=function(t,i){var r=this;t.stopPropagation(),i.contract.filter&&this.services.explorationActivity.doActivity((function(){r.viewModel.clearRestatement();var e=r.viewModel;r.services.visualAuthoring.clearFilter(e.getFilterContainerScope(),e.contract);var t={filter:i.contract,changeType:10,scope:i.getFilterContainerScope()};r.services.eventBridge.publishToChannel(o.filterContainerChanged,t)}),(function(t){return r.services.telemetryService.startActivity(t,e.telemetry.EXFilterPaneFilterCleared)}))},i.prototype.toggleFilterVisibility=function(e,t){e.stopPropagation();var i=this.viewModel;this.services.visualAuthoring.toggleFilterVisibility(i.getFilterContainerScope(),i.contract);var r={filter:i.contract,changeType:2,scope:i.getFilterContainerScope()};this.services.eventBridge.publishToChannel(o.filterContainerChanged,r)},i.prototype.toggleFilterLockState=function(e,t){e.stopPropagation();var i=this.viewModel;this.services.visualAuthoring.toggleFilterLock(i.getFilterContainerScope(),i.contract);var r={filter:i.contract,changeType:2,scope:i.getFilterContainerScope()};this.services.eventBridge.publishToChannel(o.filterContainerChanged,r)},i.prototype.restoreDefaultFilter=function(t,i){var r=this;this.services.explorationActivity.doActivity((function(){var e=r.viewModel,n=r.viewModel.contract.expression;r.services.visualAuthoring.updateFilter(e.getFilterContainerScope(),e.contract,l.getDefaultValueFilter(n));var a={filter:i.contract,changeType:10,scope:i.getFilterContainerScope()};r.services.eventBridge.publishToChannel(o.filterContainerChanged,a),e.useDefaultFilter=!0,r.updateRestatement(),t.stopPropagation()}),(function(t){return r.services.telemetryService.startActivity(t,e.telemetry.EXFilterPaneFilterDefaultRestored)}))},i.prototype.deleteFilter=function(t,i){var r=this;t.stopPropagation(),this.services.explorationActivity.doActivity((function(){var e=i.getFilterContainerScope();if(r.services.visualAuthoring.removeFilter(i.contract,e),r.viewModel.isSingleSelectionRequired){var t={filterName:i.contract.name,type:2};r.services.eventBridge.publishToChannel(o.podParameterChanged,t)}}),(function(t){return r.services.telemetryService.startActivity(t,e.telemetry.EXFilterPaneFilterDeleted)}))},i.prototype.switchCardType=function(i){switch(void 0===i&&(i=this.viewModel.cardType),this.viewModel.cardType=i,this.viewModel.contract.type=i.type,this.viewModel.cardType.type){case a.Advanced:case a.Categorical:case a.TopN:case a.RelativeDate:this.viewModel.switchType(this.viewModel.cardType.type),this.viewModel.updateViewState()}this.services.hostTypeResolutionService.getHostType()===e.common.HostType.iOSWK&&this.services.$element.find(".typeSwitchOptions").get(0).blur();var r={filter:this.viewModel.contract,changeType:32,scope:this.viewModel.getFilterContainerScope(),source:this.viewModel};this.services.eventBridge.publishToChannel(t.services.events.filterContainerChanged,r),this.toggle(void 0,this.viewModel),this.toggle(void 0,this.viewModel)},i.prototype.showLinkFieldOptions=function(){return this.isMeasureDrillthroughEnabled()&&this.viewModel.readOnlyState.expanded&&this.viewModel.canToggleLinkAsAggregation&&!this.isInOutspacePane},i.prototype.getFilterClass=function(){var e=[];if(e.push("unselectable"),this.viewModel.cardType)switch(this.viewModel.cardType.type){case a.Visual:e.push("visual");break;case a.Advanced:e.push("advanced");break;case a.Categorical:e.push("categorical");break;case a.TopN:e.push("topN");break;case a.RelativeDate:e.push("relativeDate")}return this.isFilterApplied()&&e.push("hasRestateHighlight"),e.join(" ")},i.prototype.updateRestatement=function(){var e=this,t=this.viewModel;if(t.useDefaultFilter)t.setRestatement(s.fromDefault(t.defaultValue.value));else if(t.contract.type===a.Passthrough)t.displayName=t.getRestatement(),t.updateViewState();else if(this.isIncludeExclude()){var i=this.services.dataSources.get();this.services.conceptualSchemaProxy.get(i).then((function(i){var r=e.viewModel.contract,o=e.services.includeExcludeService.buildViewModel(r.filter,r.type,i,e.services.displayNameService,r.filterExpressionMetadata);t.setRestatement(o.restatement),t.displayName=o.displayName,t.updateViewState()}))}},i.prototype.initializeDefaultValue=function(){var e=this.viewModel;(e.hasDefaultValue&&!e.contract.filter||l.isDefaultFilter(e.contract.filter))&&(e.useDefaultFilter=!0,this.updateRestatement())},i.prototype.updateBackgroundStyle=function(e){if(this.isInOutspacePane){var t=e&&e.filterCard;this.setBackground(t),this.setBorder(t);var i=e&&e.outspacePane;this.setColor(i)}},i.prototype.setBackground=function(t){if(this.viewModel.contract.filter){var i=t&&t.$instances[e.explore.constants.applied],o=e.DataViewObject.getFillColorByPropertyName(i,"backgroundColor",n.DefaultAppliedFilterCardBackgroundColor),a=r.convertTransparencyToOpacity(e.DataViewObject.getValue(i,"transparency",n.DefaultAppliedFilterCardTransparency));this.backgroundColor=r.hexToRGBString(o,a)}else{var s=t&&t.$instances[e.explore.constants.available],o=e.DataViewObject.getFillColorByPropertyName(s,"backgroundColor",n.DefaultAvailableFilterCardBackgroundColor),a=r.convertTransparencyToOpacity(e.DataViewObject.getValue(s,"transparency",n.DefaultAvailableFilterCardTransparency));this.backgroundColor=r.hexToRGBString(o,a)}},i.prototype.setBorder=function(t){var i=t&&t.$instances[e.explore.constants.available],o=t&&t.$instances[e.explore.constants.applied];if(this.viewModel.contract.filter){var a=e.DataViewObject.getFillColorByPropertyName(o,"borderColor",n.DefaultFilterCardBorderColor),s=e.DataViewObject.getValue(o,"border",n.DefaultFilterCardBorder),l=0;s===!0&&(l=1),this.borderColor=r.hexToRGBString(a,l)}else{var a=e.DataViewObject.getFillColorByPropertyName(i,"borderColor",n.DefaultFilterCardBorderColor),s=e.DataViewObject.getValue(i,"border",n.DefaultFilterCardBorder),l=0;s===!0&&(l=1),this.borderColor=r.hexToRGBString(a,l)}},i.prototype.setColor=function(t){var i=e.DataViewObject.getFillColorByPropertyName(t,"foregroundColor",n.DefaultForegroundColor);this.color=r.hexToRGBString(i)},i.prototype.updateUseNewFilterPaneSettings=function(e){e&&(this.useNewFilterPane=e.settings&&e.settings.useNewFilterPaneExperience)},i})();i.FilterController=c})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){t.Filter={bindings:{viewModel:"=",isInOutspacePane:"<?",sectionObjects:"<?"},controller:e.common.createController(t.FilterController),templateUrl:"components/filter/filter.html"}})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=t.contracts.FilterType,o=e.data.SQExprUtils,n=e.explore.util.VisualContainerUtils,a=(function(i){function a(e,t){var r=i.call(this,e,{expanded:!1,canToggleSingleSelect:!1,availableTypes:[],type:e.type})||this;return r.id=a.counter++,r.restatement="",r.displayName="",r.containerScope=t,r.howCreated=0,r.isLinkedAsAggregation=!1,r}return __extends(a,i),a.prototype.setServices=function(e,t,i){this.visualHostServices=e,this.visualPlugin=t,this.viewModeState=i},a.prototype.isInvalid=function(){return this.invalid},Object.defineProperty(a.prototype,"isVisualFilter",{get:function(){return this.containerScope&&0===this.containerScope.scopeType},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"hasDefaultValue",{get:function(){return this.defaultValue&&(1===this.howCreated||5===this.howCreated)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"isLinkField",{get:function(){return 5===this.howCreated&&!this.contract.isTransient},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"canToggleLinkAsAggregation",{get:function(){return this.isLinkField&&!this.isMeasure},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"canDeleteManually",{get:function(){return 6!==this.howCreated&&((!this.isInOutspacePane||!this.contract.isLockedInViewMode)&&(this.readOnlyState.type===r.Passthrough||1===this.howCreated||3===this.howCreated||4===this.howCreated||5===this.howCreated||this.readOnlyState.invalid))},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"canClearManually",{get:function(){return(!this.isInOutspacePane||!this.contract.isLockedInViewMode)&&(6!==this.howCreated&&!this.hasDefaultValue&&!!this.restatement)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"canExpandManually",{get:function(){return(!this.isInOutspacePane||!this.contract.isLockedInViewMode)&&t.FilterUtils.canExpandManually(this.howCreated,this.contract.isTransient,this.contract.expression,!this.invalid)},enumerable:!0,configurable:!0}),a.prototype.getFilterContainerScope=function(){return this.containerScope},a.prototype.setRestatement=function(e){this.contract.type===this.readOnlyState.type&&(this.restatement=e)},a.prototype.clearRestatement=function(){this.restatement=""},a.prototype.getRestatement=function(){return this.restatement},Object.defineProperty(a.prototype,"restatementLineStyleRule",{get:function(){var e="";return this.getRestatement()&&(e=!this.isInOutspacePane||this.isFilterExpanded()?"trimmedTextWithEllipsis":"multiLineText"),e},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"visualContainer",{get:function(){if(this.isVisualFilter)return this.containerScope.container},enumerable:!0,configurable:!0}),a.prototype.isFilterHidden=function(){return this.contract.isHiddenInViewMode&&this.isInOutspacePane},a.prototype.isFilterLocked=function(){return this.contract.isLockedInViewMode&&this.isInOutspacePane},a.prototype.isFilterExpanded=function(){return this.readOnlyState.expanded&&!this.isFilterLocked()},a.prototype.updateFilterProperties=function(e,i,r){if(this.contract.expression){var a=this.contract.expression;this.isMeasure=o.isMeasure(a),this.discourageAggregation=o.discourageAggregation(a,e),this.valueType=t.FilterUtils.getValueType(a,e),this.formatter=t.FilterUtils.getFormatter(a,e),this.defaultValue=o.getDefaultValue(a,e);var s=5===this.howCreated&&!this.contract.isTransient;if(s||(s=1===o.getAggregateBehavior(a,e)),s)this.isSingleSelectionRequired=!0,this.disableSelectionModeToggle=!0;else{this.contract.isTransient&&(this.isSingleSelectionRequired=!1,this.disableSelectionModeToggle=!0)}}var l=this.containerScope.container;this.hasGroupingScope=l&&n.hasGrouping(l,e),this.invalid=!_.isEmpty(t.FilterUtils.validate(this.contract,e,r)),this.disabled=t.FilterUtils.shouldDisableFilter(this.contract,e,l,r,i),this.isLinkedAsAggregation=!!this.contract.isLinkedAsAggregation},a.prototype.switchType=function(e){this.readOnlyState.type=e},a.prototype.canVisualize=function(){var e=this.contract;return e.expression&&e.type!==r.Passthrough&&!this.isMeasure},a.prototype.updateViewStateCore=function(t){var i=this.contract,o=!this.invalid;if(t.disabled=this.disabled,t.expanded=i.expanded&&o,t.invalid=!o,_.some(this.availableTypes,(function(e){return e.type===r.Categorical}))&&!t.visual&&i.config){var n=i.config.singleVisual;n&&this.visualHostServices&&this.visualPlugin&&(t.visual={viewport:a.DefaultVisualViewPort,type:e.visuals.plugins.filterSlicer.name,dataTransforms:{objects:n.objects},hostServices:this.visualHostServices,interactivityOptions:{dragDataPoint:!1,selection:!0},allowInvalidDataView:!0,visualPlugin:this.visualPlugin,themeCollection:{}})}var s=5===this.howCreated&&!this.contract.isTransient;t.canToggleSingleSelect=!s&&!this.contract.isTransient&&!!(!t.disabled&&this.isPodEnabled()&&t.expanded&&t.visual&&t.visual.data)},a.prototype.updateAvailableTypes=function(){var t=this.readOnlyState.type;if(t===r.Passthrough)return void(this.availableTypes=[]);var i=[];!this.valueType||this.valueType.bool||this.isLinkField||i.push({type:r.Advanced,label:e.common.localize.get("FilterPane_Advanced")}),this.isMeasure||(i.push({type:r.Categorical,label:e.common.localize.get("FilterPane_Basic")}),this.valueType&&this.valueType.dateTime&&i.push({type:r.RelativeDate,label:e.common.localize.get("FilterPane_RelativeDate")}),this.isVisualFilter&&i.push({type:r.TopN,label:e.common.localize.get("FilterPane_TopN")})),this.availableTypes=i,this.updateCardType(t)},a.prototype.updateCardType=function(e){var t=this.availableTypes;this.readOnlyState.type=e,this.cardType=_.find(t,(function(t){return t.type===e}))},a.prototype.isPodEnabled=function(){return this.containerScope&&t.FilterUtils.isCategoricalFilter(this.readOnlyState.type)},a.prototype.isSingleSelectDisabled=function(){return this.disableSelectionModeToggle||!this.viewModeState||0===this.viewModeState.getMode()},a.DefaultVisualViewPort={width:146,height:180,scale:1},a.counter=0,a})(i.ViewModel);i.FilterViewModel=a})(i=t.viewModels||(t.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r,o=e.data.FieldExprPattern,n=t.contracts.FilterType,a=e.data.SQExprConverter,s=jsCommon.StringExtensions,l=e.visuals.valueFormatter;!(function(r){function c(e,t,r,o,a,s,l,c,u){var p;switch(e.type){case n.TopN:p=f(e,c,o,t,r,l,u);break;case n.Advanced:case n.Categorical:p=g(e,c,o,t,r,l,u);break;case n.RelativeDate:p=y(e,c,o,t,r,l,u);break;case n.Passthrough:p=v(e,c,o,t,r,u,l);break;case n.Include:case n.Exclude:p=new i.FilterViewModel(e,o);break;default:p=f(e,c,o,t,r,l,u)||y(e,c,o,t,r,l,u)||g(e,c,o,t,r,l,u)||h(e,o,t,r)||v(e,c,o,t,r,u,l)}return p.howCreated=e.howCreated,p.updateFilterProperties(t,a,s),p}function u(e){var t;if(e.filter){var r=e.filter.conditions(),o=r[0];o&&(t=i.FilterCardConverter.createAdvFilter(o,null,e.expression))}return!t&&e.expression&&(t=new i.AdvFilterCard(e.expression)),t}function p(e,t,i,r,n,s,l){var c=a.asFieldPattern(e),u={includeVariationSource:!0};return i.getDisplayName(e,t,r,n,0===l?s:void 0,u)||(c?o.getFieldExprName(c):void 0)}function d(e,t,i,r,o,n){var a=i.getQualifiedDisplayName(e,t,o);return n&&(a=r.format("FilterCard_Transient",[a])),a}function h(e,r,o,a){var s=new t.services.IncludeExcludeSQExprVisitor(o,a);if(e.filter){var l=e.filter.conditions();if(!(_.isEmpty(l)||l.length>1)){return l[0].accept(s),s.dataPoints.length>0?(e.type=s.isExclude?n.Exclude:n.Include,new i.FilterViewModel(e,r)):void 0}}}function v(t,r,o,a,c,u,p){null==t.type&&(t.type=n.Passthrough);var d=new i.FilterViewModel(t,o),h=t.restatement;if((!h||""===h)&&t.filter){var v={includeFieldNamesInFilter:!0};if(h=c.getFilterRestatement(t.filter,a,r,v),d.tooltip=c.getQualifiedFilterRestatement(t.filter,a,r,v),_.isEmpty(h)){var g=e.data.PassthroughFilterPattern.extractParametersFromFilter(t.filter);if(!_.isEmpty(g)){var f,y=p.get("ListJoin_Separator"),m=void 0,S=void 0,w=void 0;u&&(f=u.columnProperties);var C=g.fieldsBeingFiltered.map((function(e){var t=u&&u.query&&u.query.defn.selectNameOf(e);return c.getDisplayName(e,a,r,t,f)})).join(y),b=g.fieldsBeingFiltered.map((function(e){return c.getQualifiedDisplayName(e,a,r,v)})).join(y);if(g.isSubquery&&g.itemCount){var x=l.format(g.itemCount);if(g.orderByField){
var F=u&&u.query&&u.query.defn.selectNameOf(g.orderByField),D=c.getDisplayName(g.orderByField,a,r,F,f);w=g.isTop?"FilterRestatement_TopNBy_Drillthrough":"FilterRestatement_BottomNBy_Drillthrough",m=[x,C,D],S=[x,b,D]}}else m=[C],S=[b],w=g.isSubquery?"FilterRestatement_Subquery":"FilterRestatement_Columns";h=s.format.apply(s,[p.get(w)].concat(m)),d.tooltip=s.format.apply(s,[p.get(w)].concat(S))}}}return d.setRestatement(h),d}function g(e,r,o,a,s,l,c,h){var v=u(e);if(v){e.expression||(e.expression=v.field),null==e.type&&(e.filter?e.type=t.FilterUtils.getFilterType(v.field,v.supportsCategorical):e.type=t.FilterUtils.getDefaultFilterType(e.expression,a,e.howCreated)),null==e.type&&(e.type=n.Categorical);var g,f,y=e.expression,m=new i.FilterViewModel(e,o);return c&&(g=c.query&&c.query.defn.selectNameOf(y),f=c.columnProperties),m.displayName=p(y,a,s,r,g,f,o.scopeType),m.tooltip=d(y,a,s,l,r,e.isTransient),m}}function f(t,i,r,o,a,s,l){if(0===r.scopeType&&5!==t.howCreated){var c=e.data.TopNFilterPattern.extractParametersFromFilter(t.filter);return c&&m(t,n.TopN,c.fieldBeingFiltered),S(t,n.TopN,r,o,a,s,i,l)}}function y(t,i,r,o,a,s,l){var c=e.data.RelativeDateFilterPattern.extractParametersFromSemanticFilter(t.filter);return c&&m(t,n.RelativeDate,c.field),S(t,n.RelativeDate,r,o,a,s,i,l)}function m(e,t,i){e.type=t,e.expression=i}function S(e,t,r,o,n,a,s,l){if(e.type===t&&e.expression){var c=new i.FilterViewModel(e,r),u=l&&l.query?l.query.defn.selectNameOf(e.expression):void 0,h=l?l.columnProperties:void 0;return c.displayName=p(e.expression,o,n,s,u,h,r.scopeType),c.tooltip=d(e.expression,o,n,a,s,e.isTransient),c}}r.convertFilterContainer=c,r.extractAdvFilterCard=u})(r=i.FilterViewModelFactory||(i.FilterViewModelFactory={}))})(i=t.viewModels||(t.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=e.data.DataViewObjectDefinitions,o=e.explore.services.events,n=t.constants.ExploreCanvasConstants,a=e.explore.services,s=e.data.RestatementHelper,l=e.data.SemanticFilter,c=e.data.SQExpr,u=e.data.SQExprBuilder,p=e.data.SQExprConverter,d=e.explore.util.VisualContainerUtils,h=e.explore.util.VisualHostServicesUtil,v=jsCommon.EnumExtensions,g={objectName:"general",propertyName:"requireSingleSelect"},f=(function(){function i(e,t){this.scope=e,this.services=t}return i.createOptions=function(){return{additionalServices:["aggrOps","conceptualSchemaProxy","featureSwitchService","geocoder","localizationService","moduleLoader","promiseFactory","singleExecutableDataProxyFactory","telemetryService"],scopedDependencies:["dataSources","eventBridge","explorationActivity","explorationNavigation","filterGenerator","filterRestatement","hostFiltersService","undoRedo","viewModeState","visualAuthoring","visualPlugin","visualQueryGenerator","visualRelationship"]}},i.prototype.$onInit=function(){var t=this,i=this.services.singleExecutableDataProxyFactory.create();if(this.visualDataProxyService=a.createExploreVisualDataProxyService(i,this.services.filterGenerator),this.crossFilteringHostService=this.createFilteringHostService(),this.requireSingleSelectLabel=this.services.localizationService.get("PageFilter_SingleSelectionRequired"),this.viewModel.isPodEnabled()&&this.isPodParameter())this.viewModel.isSingleSelectionRequired=!0;else if(this.viewModel.contract.objects){var n=r.getValue(this.viewModel.contract.objects,{objectName:"general",propertyName:"requireSingleSelect"},void 0);n&&n.value&&(this.viewModel.isSingleSelectionRequired=e.data.SQConstantExpr.getBooleanValue(n))}this.subscriptionManager=this.services.eventBridge.createChannelSubscriptionManager().subscribe(o.filterContainerChanged,(function(e,i){return t.onFilterContainerChanged(i)})).subscribe(o.explorationLoaded,(function(){t.updateSlowDataApplyEnabled()})).subscribe(o.explorationUnloaded,(function(){t.updateSlowDataApplyEnabled()})).subscribe(o.explorationSlowDataSourceSettingsLoaded,(function(e,i){i.isFilterSelectionsButtonEnabledChanged&&(t.applyBufferedFilter(),t.updateSlowDataApplyEnabled(),t.scope.$applyAsync())})),this.updateSlowDataApplyEnabled(),this.init(this.viewModel)},i.prototype.$onChanges=function(e){this.isInitialized||e.expanded.currentValue!==!0||(this.init(this.viewModel),this.isInitialized=!0)},i.prototype.$onDestroy=function(){this.subscriptionManager.unsubscribeAll(),this.viewModel.setServices(void 0,this.services.visualPlugin,this.services.viewModeState),this.viewModel.readOnlyState.visual=void 0},i.prototype.init=function(i){var r=this;this.viewModel=i,this.viewModel.setServices(e.Prototype.inherit(t.services.createVisualHostServices(this.services.promiseFactory,this.services.moduleLoader,e.visuals.services.createGeolocation(),this.services.geocoder),(function(e){e.persistProperties=function(e){return r.persistProperties(e)},e.loadMoreData=function(){return r.loadMoreData()},e.promiseFactory=function(){return r.services.promiseFactory},e.analyzeFilter=function(e){return r.createAnalyzedFilter(e)},e.canSelect=function(e){return!0},e.setIdentityDisplayNames=function(e){return r.updateCachedLabel(e)},e.getIdentityDisplayNames=function(e){return r.getLabelForScopeId(e)}})),this.services.visualPlugin,this.services.viewModeState),this.getConceptualSchema().then((function(e){if(r.viewModel.updateFilterProperties(e,r.services.visualPlugin,r.services.aggrOps),r.viewModel.updateViewState(),r.viewModel.isSingleSelectionRequired){var t=r.viewModel.getFilterContainerScope();r.isPodParameter()||1!==t.scopeType?r.updateVisualSelectAllState():r.updateRequiredState(!1)}if(r.viewModel.readOnlyState.expanded)r.loadData(!1);else var i=r.scope.$watch("viewModel.readOnlyState.expanded",(function(e,t,o){e!==t&&e&&(r.loadData(!1),i())}));r.loadRestatement()}))},i.prototype.loadRestatement=function(){var e=this;this.services.filterRestatement.loadRestatement(this.services.dataSources.get(),this.viewModel.contract,this.viewModel.formatter).then((function(t){return e.viewModel.setRestatement(t)}))},i.prototype.createAnalyzedFilter=function(e){var i=this.viewModel.contract;e.filter=i.filter;var r=1!==i.howCreated&&!l.isDefaultFilter(i.filter);return t.services.createAnalyzedFilter(e,r)},i.prototype.persistProperties=function(e){this.checkAndApplySelfFilterPropertyChanges(e),this.checkAndApplyFilterPropertyChanges(e)},i.prototype.checkAndApplySelfFilterPropertyChanges=function(i){var r,o=e.visuals.plugins.slicer.capabilities,n=this.services.filterGenerator.tryGetSelfFilterProperty(o);if(i&&!_.isEmpty(i.merge)?r=_.has(i.merge[0].properties,n.propertyName):i&&!_.isEmpty(i.remove)&&(r=_.has(i.remove[0].properties,n.propertyName)),r){var a=o.objects,s=this.viewModel.contract.config.singleVisual;t.services.applyPropertyChanges(i,a,s.objects),this.loadData(!1)}},i.prototype.checkAndApplyFilterPropertyChanges=function(t){var i,r,o=this.services.filterGenerator.tryGetFilterPropertyIdentifier(e.visuals.plugins.slicer.capabilities);t?(_.isEmpty(t.merge)?_.isEmpty(t.remove)||(r=_.has(t.remove[0].properties,o.propertyName)):(i=t.merge[0].properties[o.propertyName],r=_.has(t.merge[0].properties,o.propertyName)),r&&!this.bufferPropertyChanges(i)&&this.applyPropertyChanges(i)):this.bufferPropertyChanges(i)||this.applyPropertyChanges(i)},i.prototype.applyPropertyChanges=function(i){var r=this,o=this.viewModel;if(o.useDefaultFilter=!1,!l.isSameFilter(o.contract.filter,i)&&(!l.isAnyFilter(o.contract.filter)||i)){var n=this.viewModel.readOnlyState.visual,a=__assign({},n.data);n.data=a,this.services.undoRedo.register("UpdateFilter",(function(){var n=o.getFilterContainerScope();r.viewModel.contract.type=r.viewModel.readOnlyState.type,r.services.explorationActivity.doActivity((function(){r.services.visualAuthoring.updateFilter(n,o.contract,i);var e=i?2:10,a={filter:o.contract,changeType:e,scope:n,source:o};r.services.eventBridge.publishToChannel(t.services.events.filterContainerChanged,a),r.loadRestatement()}),(function(i){return r.services.telemetryService.startActivity(i,e.telemetry.EXFilterPaneBasicFilterChanged,t.util.getTelemetryFilterScopeType(n.scopeType),t.util.getTelemetryFieldKind(o.contract.expression),t.util.getTelemetryViewMode(r.services.viewModeState.getMode()))}))}))}},i.prototype.updateRequiredState=function(e){void 0===e&&(e=!0);var t=this.viewModel.isSingleSelectionRequired;if(1===this.viewModel.getFilterContainerScope().scopeType){var i={filterName:this.viewModel.contract.name,type:t?0:1,isCausedByCode:!1};this.services.eventBridge.publishToChannel(o.podParameterChanged,i)}this.updateVisualSelectAllState(),this.triggerDataChanged();var n=this.viewModel,a=this.viewModel.contract.objects;if(a||(this.viewModel.contract.objects=a={}),r.setValue(a,g,null,u.boolean(t)),e&&t&&n.contract.filter){this.services.visualAuthoring.updateFilter(n.getFilterContainerScope(),n.contract,void 0);var s={filter:n.contract,changeType:10,scope:n.getFilterContainerScope()};this.services.eventBridge.publishToChannel(o.filterContainerChanged,s)}else e&&this.services.visualAuthoring.updateFilter(n.getFilterContainerScope(),n.contract,n.contract.filter)},i.prototype.isPodParameter=function(){var e=this.services.explorationNavigation.getCurrentExploration(),i=this.services.explorationNavigation.getCurrentSection(),r=this.viewModel.contract.name;return!!(e&&i&&r)&&t.PodUtils.hasParameter(e,i.name,r)},i.prototype.createFilteringHostService=function(){var t=this;return e.Prototype.inherit(h.createQueryVisualHostServices(),(function(e){return e.getFilters=function(e,i){return t.services.filterGenerator.calculateFilterContainerInputFilter(t.services.explorationNavigation.getCurrentExploration(),t.services.explorationNavigation.getCurrentSection(),t.viewModel.contract,i,t.viewModel.getFilterContainerScope())}}))},i.prototype.loadMoreData=function(){this.visualDataProxyService.canLoadMore()&&this.loadData(!0)},i.prototype.loadData=function(e){var t=this;this.viewModel.isLoading=!0,this.hasQueryError=!1,this.getConceptualSchema().then((function(i){var r=t.services.dataSources.get(),o={dataSources:r,schema:i,config:t.viewModel.contract.config.singleVisual,hostServices:t.crossFilteringHostService,visualQueryGenerator:t.services.visualQueryGenerator,isLoadMore:e};return t.visualDataProxyService.runQuery(o).then((function(r){var o=t.visualDataProxyService.lastExecutedQuery();e===!0?t.onMergeMoreData(r,i,o.transforms):t.onDataChanged(r,i,o.transforms)}),(function(e){t.hasQueryError=!0})).finally((function(){t.viewModel.isLoading=!1}))}))},i.prototype.onDataChanged=function(e,t,i){var r=this.viewModel.readOnlyState.visual;if(e&&e.dataReaderResult&&r){var o={dataView:e&&e.dataReaderResult?e.dataReaderResult.dataView:null,dataViewSource:e&&e.dataViewSource?e.dataViewSource:null},n=d.isSegment(o.dataView);n&&(o.isFirstSegment=n),r.data=o,this.isInOutspacePane&&this.applyVisualStyling(i),r.dataTransforms=i,this.viewModel.updateViewState(),this.dataLoaded=!0}},i.prototype.onMergeMoreData=function(t,i,r){var o=this.viewModel.readOnlyState.visual;if(t&&t.dataReaderResult&&o){var n=t.dataReaderResult.dataView;if(n){var a=o.data.dataView;e.data.segmentation.DataViewMerger.mergeDataViews(a,n);var s={dataView:a,dataViewSource:t&&t.dataViewSource,isFirstSegment:!1};o.data=s,o.dataTransforms=r}}},i.prototype.onFilterContainerChanged=function(i){var r=this.viewModel,o=r.readOnlyState.visual;if(i.filter===r.contract)if(v.hasFlag(i.changeType,2)){if(10===i.changeType)return o&&o.visual&&o.visual.onClearSelection(),r.contract.filter&&!l.isAnyFilter(r.contract.filter)||r.setRestatement(s.fromDataViewScopeIdentities([],!1,r.formatter)),void(l.isDefaultFilter(r.contract.filter)&&r.setRestatement(s.fromDefault(r.defaultValue.value)));l.isSameFilter(r.contract.filter,i.filter.filter)||this.services.visualAuthoring.updateFilter(r.getFilterContainerScope(),r.contract,i.filter.filter),this.loadData(!1),this.loadRestatement()}else if(this.dataLoaded&&v.hasFlag(i.changeType,4))this.loadData(!1);else if(v.hasFlag(i.changeType,16))o&&o.visual&&o.visual.update({viewport:t.viewModels.FilterViewModel.DefaultVisualViewPort,type:e.VisualUpdateType.Resize,dataViews:null});else if(v.hasFlag(i.changeType,32)){var n=this.viewModel;n!==i.source&&(n.cardType.type=i.filter.type)}},i.prototype.updateVisualSelectAllState=function(){var t=this.viewModel.readOnlyState.visual;if(t){var i=this.viewModel.isSingleSelectionRequired,o=t.dataTransforms.objects,n=e.visuals.slicerProps.selection.selectAllCheckboxEnabled,a=e.visuals.slicerProps.selection.singleSelect;o||(o={}),r.setValue(o,n,null,u.boolean(!i)),r.setValue(o,a,null,u.boolean(i))}},i.prototype.triggerDataChanged=function(){var e=this.viewModel.readOnlyState.visual;if(e&&e.data){var t={dataView:e.data.dataView,dataViewSource:e.data.dataViewSource,isFirstSegment:e.data.isFirstSegment};e.data=t}},i.prototype.updateCachedLabel=function(t){if(!_.isEmpty(t)){var i=t[0].identity,r=i&&i.expr,o=e.data.ScopeIdentityExtractor.getKeys(r),n=this.viewModel.contract;1===o.length&&c.equals(n.expression,o[0])||(n.cachedValueItems=t)}},i.prototype.getLabelForScopeId=function(e){for(var t=[],i=0,r=e;i<r.length;i++){var o=r[i],n=this.getDisplayNameFromCache(o);n||(n={displayName:p.getFirstComparandValue(o),identity:o}),t.push(n)}return t},i.prototype.getDisplayNameFromCache=function(t){var i=this.viewModel.contract.cachedValueItems;if(!_.isEmpty(i))return _.find(this.viewModel.contract.cachedValueItems,(function(i){return e.DataViewScopeIdentity.equals(i.identity,t,!0)}))},i.prototype.getConceptualSchema=function(){var e=this.services.dataSources.get();return e&&this.viewModel.contract.config&&this.viewModel.contract.config.singleVisual?this.services.conceptualSchemaProxy.get(e):this.services.promiseFactory.reject()},i.prototype.updateSlowDataApplyEnabled=function(){if(this.slowDataApplyEnabled=!1,this.services.featureSwitchService.featureSwitches.slowDataSourceModeEnabled){var e=this.services.explorationNavigation.getCurrentExploration();e&&e.slowDataSourceSettings&&e.slowDataSourceSettings.isFilterSelectionsButtonEnabled&&(this.slowDataApplyEnabled=!0)}},i.prototype.isApplyButtonVisible=function(){return this.slowDataApplyEnabled},i.prototype.isApplyButtonEnabled=function(){return this.haveBufferedFilter},i.prototype.onApplyButtonClicked=function(){this.slowDataApplyEnabled&&this.applyBufferedFilter()},i.prototype.applyBufferedFilter=function(){if(this.haveBufferedFilter){var e=this.bufferedFilter;this.haveBufferedFilter=!1,this.bufferedFilter=void 0,this.applyPropertyChanges(e)}},i.prototype.bufferPropertyChanges=function(e){return!!this.slowDataApplyEnabled&&(!(!this.haveBufferedFilter&&l.isSameFilter(this.viewModel.contract.filter,e))&&(this.haveBufferedFilter=!0,this.bufferedFilter=e,this.scope.$applyAsync(),!0))},i.prototype.applyVisualStyling=function(t){var i={},o={solid:{color:e.data.SQExprBuilder.text(n.DefaultControlForegroundColor)}},a={solid:{color:e.data.SQExprBuilder.text(n.DefaultControlBackgroundColor)}};r.setValue(i,{objectName:"searchBox",propertyName:"fontColor"},null,o),r.setValue(i,{objectName:"searchBox",propertyName:"background"},null,a),r.extend(i,t.objects),t.objects=i},i})();i.FilterVisualController=f})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){t.FilterVisual={bindings:{viewModel:"=",expanded:"<",isInOutspacePane:"<?"},controller:e.common.createController(t.FilterVisualController),templateUrl:"components/filterVisual/filterVisual.html"}})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=jsCommon.EnumExtensions,o=e.explore.services.events,n=(function(){function e(e,t){var i=this;this.isExpanded=!1,this.services=t,this.subscriptionManager=this.services.eventBridge.createChannelSubscriptionManager().subscribe(o.filterContainerChanged,(function(e,t){return i.onFilterContainerChanged(t)})).subscribe(o.explorationSettingsLoaded,(function(e,t){t.useNewFilterPaneExperienceChanged&&i.updateUseNewFilterPaneSettings(i.services.explorationNavigation.getCurrentExploration())})),this.scrollbarsConfig={ignoreOverlay:!1,ignoreMobile:!1},this.useNewFilterPane=!1,this.updateUseNewFilterPaneSettings(this.services.explorationNavigation.getCurrentExploration())}return e.createOptions=function(){return{additionalServices:["conceptualSchemaProxy","displayNameService"],scopedDependencies:["includeExcludeService","eventBridge","explorationNavigation","visualAuthoring","dataSources"]}},e.prototype.$onInit=function(){this.updateViewModel()},e.prototype.$onDestroy=function(){this.subscriptionManager.unsubscribeAll()},e.prototype.toggleExpand=function(){this.isExpanded=!this.isExpanded},e.prototype.deleteFilter=function(e){var t=this.filterViewModel.getFilterContainerScope();this.services.visualAuthoring.removeFilter(this.filterViewModel.contract,t),e.stopPropagation()},e.prototype.delete=function(e,i,r){if(1===this.viewModel.points.length)return void this.deleteFilter(e);var o=this.filterViewModel.contract;if(o.filterExpressionMetadata&&!_.isEmpty(o.filterExpressionMetadata.cachedValueItems)){var n=this.viewModel.points[r];t.FilterUtils.removeEntryFromFilterCache(n.columns,n.values,o.filterExpressionMetadata)}this.viewModel.points.splice(r,1),this.services.includeExcludeService.updateFilterContainer(this.filterViewModel,this.viewModel),e.stopPropagation()},e.prototype.updateViewModel=function(){var e=this,t=this.services.dataSources.get();this.services.conceptualSchemaProxy.get(t).then((function(t){var i=e.filterViewModel.contract;e.viewModel=e.services.includeExcludeService.buildViewModel(i.filter,i.type,t,e.services.displayNameService,i.filterExpressionMetadata)}))},e.prototype.getFilterLockTooltip=function(){return this.filterViewModel.isFilterLocked()?"FilterPane_FilterLocked":this.filterViewModel.contract.isLockedInViewMode?"FilterPane_UnlockFilter":"FilterPane_LockFilter"},e.prototype.onFilterContainerChanged=function(e){e.filter===this.filterViewModel.contract&&r.hasFlag(e.changeType,2)&&this.updateViewModel()},e.prototype.toggleFilterVisibility=function(e,t){e.stopPropagation();var i=this.filterViewModel;this.services.visualAuthoring.toggleFilterVisibility(i.getFilterContainerScope(),i.contract)},e.prototype.toggleFilterLockState=function(e,t){e.stopPropagation();var i=this.filterViewModel;this.services.visualAuthoring.toggleFilterLock(i.getFilterContainerScope(),i.contract);var r={filter:i.contract,changeType:2,scope:i.getFilterContainerScope()};this.services.eventBridge.publishToChannel(o.filterContainerChanged,r)},e.prototype.updateUseNewFilterPaneSettings=function(e){e&&(this.useNewFilterPane=e.settings&&e.settings.useNewFilterPaneExperience)},e})();i.IncludeExcludeFilterController=n})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){t.IncludeExcludeFilter={templateUrl:"components/includeExcludeFilter/includeExcludeFilter.html",controller:e.common.createController(t.IncludeExcludeFilterController),bindings:{filterViewModel:"<",isInOutspacePane:"<?"}}})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=e.data.DataViewObjectDefinitions,o=e.data.segmentation.DataViewMerger,n=t.services,a=e.data.SemanticFilter,s=e.data.SemanticQuery,l=e.data.SQExpr,c=e.data.SQExprBuilder,u=t.util.VisualContainerUtils,p=t.contracts.VisualQuery,d=e.visuals.services,h=(function(){function i(i,r){var o=this;this.slicerWidth=146,this.slicerHeight=28,this.scope=i,this.services=r,this.visualHostServices=e.Prototype.inherit(n.createVisualHostServices(this.services.promiseFactory,this.services.moduleLoader,d.createGeolocation(),this.services.geocoder),(function(e){e.persistProperties=function(e){return o.persistProperties(e)},e.loadMoreData=function(){return o.loadMoreData()},e.analyzeFilter=function(e){return n.createAnalyzedFilter(e,!1)},e.getLocalizedString=function(e){return o.getLocalizedString(e)}})),this.dataProxy=n.createExploreVisualDataProxyService(this.services.singleExecutableDataProxyFactory.create(),this.services.filterGenerator),this.queryVisualHostServices=t.util.VisualHostServicesUtil.createQueryVisualHostServices()}return i.createOptions=function(){return{additionalServices:["conceptualSchemaProxy","geocoder","localizationService","moduleLoader","promiseFactory","singleExecutableDataProxyFactory"],scopedDependencies:["dataSources","filterGenerator","visualPlugin","visualQueryGenerator"]}},i.prototype.$onInit=function(){var e=this;this.createVisualDefinition(),this.ngModel.$render=function(){e.updateVisual(!1),e.setFilter(e.ngModel.$viewValue.filter)},this.fieldWatcherUnsubscribe=this.scope.$watch("$ctrl.ngModel.$viewValue.field",(function(t,i){l.equals(t,i)||e.onFieldChange()})),this.isInitialized=!0},i.prototype.$onChanges=function(e){this.isInitialized&&e.filter&&!a.isSameFilter(e.filter.currentValue,e.filter.previousValue)&&this.updateVisual(!1)},i.prototype.$onDestroy=function(){this.fieldWatcherUnsubscribe()},i.prototype.onFieldChange=function(){this.ngModel.$setViewValue({field:this.ngModel.$viewValue.field,filter:void 0}),this.updateVisual(!1)},i.prototype.updateVisual=function(e){var t=this;this.ngModel.$viewValue.field&&this.loadData(e).then((function(e){t.visual.data=e;var i=_.clone(t.dataProxy.lastExecutedQuery().transforms);i.objects=t.visual.dataTransforms.objects,t.visual.dataTransforms=i}))},i.prototype.createVisualDefinition=function(){var i={},o=e.visuals.slicerProps.data.mode,n=e.visuals.slicerProps.selection.selectAllCheckboxEnabled,a=e.visuals.slicerProps.selection.singleSelect,s=e.visuals.slicerProps.header.show,l=e.visuals.slicerProps.items.textSize;r.setValue(i,o,null,c.text(this.mode)),r.setValue(i,n,null,c.boolean(!1)),r.setValue(i,a,null,c.boolean(!0)),r.setValue(i,s,null,c.boolean(!1)),r.setValue(i,l,null,c.integer(t.constants.smallFontSizeInPoint));var u=e.visuals.plugins.slicer.name;this.visual={viewport:{width:this.slicerWidth,height:this.slicerHeight,scale:1},type:u,dataTransforms:{objects:i},hostServices:this.visualHostServices,interactivityOptions:{dragDataPoint:!1,selection:!0},themeCollection:{},visualPlugin:this.services.visualPlugin}},i.prototype.persistProperties=function(t,i){var o=this;void 0===i&&(i=!0);var n,a=this.services.filterGenerator.tryGetFilterPropertyIdentifier(e.visuals.plugins.slicer.capabilities),s=this.visual.dataTransforms.objects;t&&!_.isEmpty(t.merge)&&(n=t.merge[0].properties[a.propertyName]),n?r.setValue(s,a,null,n):r.deleteProperty(s,a.objectName,null,a.propertyName),this.services.timeout((function(){var e=_.clone(o.visual.data);o.visual.data=e})),i&&this.ngModel.$setViewValue({field:this.ngModel.$viewValue.field,filter:n})},i.prototype.loadData=function(t){var i=this,r=this.services.promiseFactory.defer(),n=this.services.dataSources.get();return this.services.conceptualSchemaProxy.get(n).then((function(r){var o=new p(s.create(),{},[]);return o.add(i.ngModel.$viewValue.field,e.visuals.slicerRoles.value),i.filter&&(o.defn=o.defn.addSemanticFilter(i.filter)),i.dataProxy.runQuery({dataSources:n,schema:r,config:{visualType:e.visuals.plugins.slicer.name,query:o,objects:i.visual.dataTransforms.objects},hostServices:i.queryVisualHostServices,visualQueryGenerator:i.services.visualQueryGenerator,isLoadMore:t,preferCurrentData:!t,isInitialLoad:!t})})).then((function(e){var n,a=i.visual.data&&i.visual.data.dataView,s=i.visual.data&&i.visual.data.dataViewSource;if(e&&e.dataReaderResult&&e.dataReaderResult.dataView&&e.dataViewSource&&i.visual)if(t){var l=e.dataReaderResult.dataView;if(l){var c=i.visual.data.dataView;o.mergeDataViews(c,l),a=c}s=e.dataViewSource,n=!1}else a=e.dataReaderResult.dataView,s=e.dataViewSource,n=u.isSegment(a);r.resolve({dataView:a,dataViewSource:s,isFirstSegment:n})})),r.promise},i.prototype.loadMoreData=function(){this.dataProxy.canLoadMore()&&this.updateVisual(!0)},i.prototype.getLocalizedString=function(e){return"Slicer_Restatement_All"===e?this.services.localizationService.get("InstancePicker_Slicer_Restatement_All"):this.services.localizationService.get(e)},i.prototype.setFilter=function(t){if(t){var i=this.services.filterGenerator.tryGetFilterPropertyIdentifier(e.visuals.plugins.slicer.capabilities),r={merge:[{objectName:i.objectName,selector:void 0,properties:{filter:t}}]};this.persistProperties(r,!1)}},i})();i.InstancePickerController=h})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){i.InstancePicker={templateUrl:"components/instancePicker/instancePicker.html",bindings:{mode:"<",filter:"<"},require:{ngModel:"ngModel"},controller:e.common.createController(t.controllers.InstancePickerController)}})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(e){this.annotations=e}return e.prototype.clear=function(){this.annotations=[]},e.prototype.length=function(){return this.annotations.length},e.prototype.removeAt=function(e){this.annotations.splice(e,1)},e.prototype.getAnnotation=function(e){return this.annotations[e]},e.prototype.takeAll=function(){return _.take(this.annotations,this.annotations.length)},e.prototype.push=function(e){this.annotations.push(e)},e.prototype.eraseAnnotations=function(e,t){var i=this.annotations.length;return _.remove(this.annotations,(function(i){return i.polygon.lineIntersectionPoint(e,t)})),i-this.annotations.length},e})();e.AnnotationsList=t})(t=e.viewModels||(e.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i=e.explore.viewModels.AnnotationsList,r=e.explore.services.events,o=e.visuals.shapes.Polygon,n="pen",a=5,s=10,l=(function(){function e(e,t){var i=this;this.services=t,this.services.eventBridge.createChannelSubscriptionManager().subscribe(r.sectionChanged,(function(){return i.invalidateAnnotations()})).subscribe(r.clearAnnotations,(function(){return i.clearAnnotations()})),this.pensAnnotationsDataHelper=new c,this.penAnnotationDrawer=new u(this.services.$element);var o=function(e){i.onPointerDown(e)},n=function(e){i.onPointerMove(e)},a=function(e){i.onPointerUp(e)};interact.on("pointerdown",o),interact.on("pointermove",n),interact.on("pointerup",a),e.$on("$destroy",(function(){interact.off("pointerdown",o),interact.off("pointermove",n),interact.off("pointerup",a),i.clearAnnotationsFromExploration()})),this.resetViewModel()}return e.createOptions=function(){return{scopedDependencies:["eventBridge","explorationNavigation","viewModeState"],additionalServices:["$element"]}},e.prototype.eraseAnnotations=function(e,t){this.viewModel.annotationsList.eraseAnnotations(t,e)>0&&(this.penAnnotationDrawer.redrawAnnotations(this.viewModel),this.persistOnSection(this.viewModel.annotationsList.takeAll()))},e.prototype.onPointerDown=function(e){if(e.pointerType===n){this.penAnnotationDrawer.validateRectPos(this.viewModel.annotationsList.length());var t=this.penAnnotationDrawer.convertToCanvasPosition(e.pageX,e.pageY),i=this.isEraseEvent(e)?2:1;switch(this.pensAnnotationsDataHelper.createPenAnnotationData(e.pointerId,i),i){case 1:this.pensAnnotationsDataHelper.addPoint(e.pointerId,t),this.viewModel.currentAnnotations[e.pointerId]=this.createPenAnnotationCurve(e.pointerId);break;case 2:this.erasePrevPoint=t,this.eraseAnnotations(t,this.erasePrevPoint)}}},e.prototype.onPointerMove=function(e){if(e.pointerType===n){var t=this.penAnnotationDrawer.convertToCanvasPosition(e.pageX,e.pageY);switch(this.pensAnnotationsDataHelper.getAnnotationMode(e.pointerId)){case 1:this.pensAnnotationsDataHelper.addPoint(e.pointerId,t);var i=this.viewModel.currentAnnotations[e.pointerId];i&&(i.polygon=this.createPolygon(e.pointerId)),this.drawAnnotationAddedPoints(i);break;case 2:this.eraseAnnotations(t,this.erasePrevPoint),this.erasePrevPoint=t}}},e.prototype.onPointerUp=function(e){if(e.pointerType===n){switch(this.pensAnnotationsDataHelper.getAnnotationMode(e.pointerId)){case 1:var t=this.viewModel.currentAnnotations[e.pointerId];t&&(t.polygon.polygonPoints.length>=s&&(this.viewModel.annotationsList.push(t),this.persistOnSection(this.viewModel.annotationsList.takeAll())),delete this.viewModel.currentAnnotations[e.pointerId])}this.pensAnnotationsDataHelper.remove(e.pointerId)}},e.prototype.drawAnnotationAddedPoints=function(e){var t=e.polygon.polygonPoints,i=t.length;i<s||(i===s?this.penAnnotationDrawer.drawAnnotation(e):this.penAnnotationDrawer.drawLine(t[i-2],t[i-1]))},e.prototype.resetViewModel=function(e){void 0===e&&(e=[]),this.viewModel={currentAnnotations:[],annotationsList:new i(e)},this.pensAnnotationsDataHelper.clear()},e.prototype.clearAnnotationsFromExploration=function(){for(var e=this.services.explorationNavigation.getCurrentExploration(),t=0,i=e.sections;t<i.length;t++){i[t].penAnnotations=[]}},e.prototype.isEraseEvent=function(e){return e.button===a||!e.isPrimary&&0===e.pressure},e.prototype.persistOnSection=function(e){var t=this.services.explorationNavigation.getCurrentSection();t&&(t.penAnnotations=e)},e.prototype.getAnnotationsFromSection=function(){return this.services.explorationNavigation.getCurrentSection().penAnnotations||[]},e.prototype.clearAnnotations=function(){this.persistOnSection([]),this.invalidateAnnotations()},e.prototype.invalidateAnnotations=function(){var e=this.getAnnotationsFromSection();this.resetViewModel(e),this.penAnnotationDrawer.redrawAnnotations(this.viewModel)},e.prototype.createPenAnnotationCurve=function(e){var t=this.services.viewModeState.getConfig();return{polygon:this.createPolygon(e),lineWidth:t.penProperties.lineWidth,strokeStyle:t.penProperties.strokeStyle,opacity:t.penProperties.opacity}},e.prototype.createPolygon=function(e){for(var t=[],i=0,r=this.pensAnnotationsDataHelper.getPoints(e);i<r.length;i++){var n=r[i];t.push(n.x),t.push(n.y)}return new o(new Float64Array(t))},e})();t.PenAnnotationController=l;var c=(function(){function e(){this.pensAnnotationsData=[]}return e.prototype.getAnnotationMode=function(e){return this.pensAnnotationsData[e]?this.pensAnnotationsData[e].penAnnotationMode:0},e.prototype.createPenAnnotationData=function(e,t){this.pensAnnotationsData[e]={pointerId:e,penAnnotationMode:t,points:[]}},e.prototype.addPoint=function(e,t){this.pensAnnotationsData[e]&&this.pensAnnotationsData[e].points.push(t)},e.prototype.remove=function(e){delete this.pensAnnotationsData[e]},e.prototype.getPoints=function(e){return this.pensAnnotationsData[e]?this.pensAnnotationsData[e].points:[]},e.prototype.clear=function(){this.pensAnnotationsData=[]},e})(),u=(function(){function e(e){this.rect=e.children()[0],this.rectContext=this.rect.getContext("2d")}return e.prototype.validateRectPos=function(e){this.loadCanvasClientRects(),0!==e||this.rect.width===Math.floor(this.rectPosition.width)&&this.rect.height===Math.floor(this.rectPosition.height)||(this.rect.width=this.rectPosition.width,this.rect.height=this.rectPosition.height)},e.prototype.drawLine=function(e,t){this.rectContext.moveTo(e.x,e.y),this.rectContext.lineTo(t.x,t.y),this.rectContext.stroke()},e.prototype.loadCanvasClientRects=function(){this.rectPosition=this.rect.getBoundingClientRect(),this.canvasLeft=this.rectPosition.left,this.canvasTop=this.rectPosition.top},e.prototype.redrawAnnotations=function(e){this.loadCanvasClientRects(),this.rectContext.clearRect(0,0,this.rectPosition.width,this.rectPosition.height);for(var t=0,i=this.getAnnotations(e);t<i.length;t++){var r=i[t];this.drawAnnotation(r)}},e.prototype.getAnnotations=function(e){var t=e.annotationsList.takeAll(),i=[];for(var r in e.currentAnnotations)i.push(e.currentAnnotations[r]);return t.concat(i)},e.prototype.drawAnnotation=function(e){this.rectContext.beginPath(),this.setupNewPath(e);var t=e.polygon.polygonPoints;this.rectContext.moveTo(t[0].x,t[0].y);
for(var i=1;i<t.length;i++)this.rectContext.lineTo(t[i].x,t[i].y);this.rectContext.stroke()},e.prototype.setupNewPath=function(e){this.rectContext.lineWidth=e.lineWidth,this.rectContext.strokeStyle=e.strokeStyle,this.rectContext.globalAlpha=e.opacity,this.rectContext.lineCap="round",this.rectContext.lineJoin="round"},e.prototype.convertToCanvasPosition=function(e,t){return{x:e-this.canvasLeft,y:t-this.canvasTop}},e})()})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){i.PenAnnotation={templateUrl:"components/penAnnotation/penAnnotation.html",controller:e.common.createController(t.controllers.PenAnnotationController)}})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){e.Background="background",e.Border="border",e.CategoryAxis="categoryAxis",e.ConditionalFormatting="conditionalFormatting",e.General="general",e.Gradient="gradient",e.Labels="labels",e.LockAspect="lockAspect",e.StylePreset="stylePreset",e.VisualHeader="visualHeader",e.VisualTooltip="visualTooltip",e.Title="title",e.VisualLink="visualLink",e.ValueAxis="valueAxis"})(t=e.PropertyCardNames||(e.PropertyCardNames={}));var i;!(function(e){e.Position="position",e.RevertToDefault="revertToDefault",e.SecPosition="secPosition",e.Slider="slider",e.Show="show",e.TextArea="textarea",e.NumericSelection="numericSelection",e.Selection="selection"})(i=e.PropertySliceNames||(e.PropertySliceNames={}));var r;!(function(e){e.X="x",e.Y="y",e.Width="width",e.Height="height",e.AltText="altText",e.AllowBinnedLineSample="allowBinnedLineSample",e.AllowOverlappingPointsSample="allowOverlappingPointsSample"})(r=e.GeneralPropertyNames||(e.GeneralPropertyNames={}))})(t=e.viewModels||(e.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=e.explore.constants.ExploreCanvasConstants,o=t.contracts.FilterType,n=e.data.RelativeDateFilterPattern,a=e.data.RelativeDateQualifier,s=jsCommon.Utility,l=(function(){function i(t,i){var r=this;this.scope=t,this.services=i,this.subscriptionManager=this.services.eventBridge.createChannelSubscriptionManager().subscribe(e.explore.services.events.filterContainerChanged,(function(e,t){return r.onFilterContainerChanged(t)}))}return i.createOptions=function(){return{additionalServices:["aggrOps","conceptualSchemaProxy","localizationService","promiseFactory","telemetryService"],scopedDependencies:["dataSources","eventBridge","undoRedo","viewModeState","visualAuthoring","visualPlugin"]}},i.prototype.$onInit=function(){this.initializeViewModel(this.viewModel.contract),this.viewModel.isInOutspacePane&&(this.backgroundColor=r.DefaultControlBackgroundColor,this.color=r.DefaultControlForegroundColor)},i.prototype.initializeViewModel=function(e){var i=this,r=this.services.dataSources.get();this.services.conceptualSchemaProxy.get(r).then((function(r){var o=n.extractParametersFromSemanticFilter(e.filter),a=e.expression||o&&o.field,s=o&&o.options;i.vm=new t.viewModels.RelativeDateFilterViewModel(a,i.services.localizationService,s),i.viewModel.updateFilterProperties(r,i.services.visualPlugin,i.services.aggrOps),i.viewModel.updateViewState(),o?i.updateRestatement():(i.filterForm.$setDirty(),e.filter||i.clearRestatement())}))},i.prototype.$onDestroy=function(){this.subscriptionManager.unsubscribeAll()},i.prototype.applyFilter=function(){var e=this;if(this.canApplyFilter()){this.viewModel.contract.type=o.RelativeDate;var i=this.services.dataSources.get();this.services.conceptualSchemaProxy.get(i).then((function(i){e.services.undoRedo.register("ApplyRelativeDateFilter",(function(){var i=e.vm.getRelativeDateRangeOptions();e.logFilterAppliedTelemetry(i,(function(){var r=n.buildSemanticFilter({field:e.vm.dateField,options:i});e.services.visualAuthoring.updateFilter(e.viewModel.getFilterContainerScope(),e.viewModel.contract,r),e.viewModel.useDefaultFilter=!1,e.filterForm.$setPristine(),e.updateRestatement(),e.services.eventBridge.publishBubbling(e.scope,t.viewModels.FilterEvents.filterChanged,{filter:e.viewModel.contract,changeType:2,scope:e.viewModel.getFilterContainerScope(),source:e.viewModel})}))}))}))}},i.prototype.canApplyFilter=function(){return this.viewModel&&!this.viewModel.cardType.invalid&&this.vm&&this.vm.relativeUnit&&this.vm.relativeQualifier&&(this.vm.duration>0||this.vm.relativeQualifier.value===a.Current)&&this.filterForm&&this.filterForm.$dirty&&this.filterForm.$valid},i.prototype.logFilterAppliedTelemetry=function(i,r){var o=this.services.telemetryService.startEvent(e.telemetry.EXFilterPaneRelativeDateFilterApplied,a[i.relativeQualifier],i.duration,e.data.RelativeDateUnit[i.relativeUnit],i.includeToday,n.isCalendarPeriod(i.relativeUnit),t.util.getTelemetryViewMode(this.services.viewModeState.getMode()));try{r(),o.resolve()}catch(e){throw o.reject(),s.ensureError(e)}},i.prototype.onFilterContainerChanged=function(e){e.filter===this.viewModel.contract&&jsCommon.EnumExtensions.hasFlag(e.changeType,10)&&this.initializeViewModel(e.filter),e.filter===this.viewModel.contract&&e.source!==this.viewModel&&jsCommon.EnumExtensions.hasFlag(e.changeType,2)&&this.initializeViewModel(e.filter)},i.prototype.updateRestatement=function(){this.viewModel.setRestatement(this.vm.getRestatement())},i.prototype.clearRestatement=function(){this.viewModel.setRestatement(void 0)},i})();i.RelativeDateFilterController=l})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){t.RelativeDateFilter={templateUrl:"components/relativeDateFilter/relativeDateFilter.html",controller:e.common.createController(t.RelativeDateFilterController),bindings:{viewModel:"<"}}})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i=e.data.RelativeDateFilterPattern,r=e.data.RelativeDateRangeHelper,o=e.data.RelativeDateQualifier,n=e.data.RelativeDateUnit,a={relativeQualifier:o.Last,duration:30,relativeUnit:n.Day,includeToday:!0},s=(function(){function e(e,t,i){void 0===i&&(i=a),this.dateField=e,this.duration=i.duration,this.includeToday=i.includeToday,this.anchorDate=i.anchorDate,this.populateRelativeQualifiers(t,i.relativeQualifier),this.populateRelativeUnits(t,i.relativeUnit)}return e.prototype.populateRelativeQualifiers=function(e,t){this.relativeQualifiers=[{value:o.Last,text:e.get("RelativeDateQualifier_Last")},{value:o.Current,text:e.get("RelativeDateQualifier_Current")},{value:o.Next,text:e.get("RelativeDateQualifier_Next")}],this.relativeQualifier=_.find(this.relativeQualifiers,(function(e){return e.value===t}))},e.prototype.populateRelativeUnits=function(e,t){this.relativeUnitsAll=[{value:n.Day,text:e.get("RelativeDateUnit_Days")},{value:n.Week,text:e.get("RelativeDateUnit_Weeks")},{value:n.CalendarWeek,text:e.get("RelativeDateUnit_CalendarWeeks")},{value:n.Month,text:e.get("RelativeDateUnit_Months")},{value:n.CalendarMonth,text:e.get("RelativeDateUnit_CalendarMonths")},{value:n.Year,text:e.get("RelativeDateUnit_Years")},{value:n.CalendarYear,text:e.get("RelativeDateUnit_CalendarYears")}],this.relativeUnitsCurrent=[{value:n.Day,text:e.get("RelativeDateUnit_Day")},{value:n.Week,text:e.get("RelativeDateUnit_Week")},{value:n.Month,text:e.get("RelativeDateUnit_Month")},{value:n.Year,text:e.get("RelativeDateUnit_Year")}],this.relativeUnit=_.find(this.relativeUnitsAll,(function(e){return e.value===t}))},e.prototype.isDurationApplicable=function(){return this.relativeQualifier.value!==o.Current},e.prototype.isIncludeTodayApplicable=function(){return this.relativeQualifier.value!==o.Current&&!i.isCalendarPeriod(this.relativeUnit.value)},e.prototype.onRelativeQualifierChanged=function(){if(this.relativeQualifier.value===o.Current){var e=this.relativeUnit.value;switch(this.relativeUnit.value){case n.CalendarWeek:e=n.Week;break;case n.CalendarMonth:e=n.Month;break;case n.CalendarYear:e=n.Year}this.relativeUnit=_.find(this.relativeUnitsAll,(function(t){return t.value===e}))}},e.prototype.getDurationMax=function(){return r.getDurationMax(this.relativeQualifier.value,this.relativeUnit.value)},e.prototype.getRestatement=function(){var e=this.getRelativeDateRangeOptions();return r.getRestatement(e)},e.prototype.getRelativeDateRangeOptions=function(){return{duration:this.duration,includeToday:this.includeToday,relativeQualifier:this.relativeQualifier.value,relativeUnit:this.relativeUnit.value,anchorDate:this.anchorDate}},e})();t.RelativeDateFilterViewModel=s})(i=t.viewModels||(t.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=270,i=(function(){function e(e,t){this.services=t,this.showErrorMessage=!0}return e.createOptions=function(){return{}},e.prototype.$onInit=function(){this.updateErrorOverlayVisibility(this.viewport),this.isFixButtonVisible=this.errorInfo&&(1===this.viewMode&&0!==this.errorInfo.fixableError||0===this.viewMode&&3===this.errorInfo.fixableError)},e.prototype.$onChanges=function(e){e.viewport&&this.updateErrorOverlayVisibility(this.viewport)},e.prototype.updateErrorOverlayVisibility=function(e){e&&(this.showErrorMessage=e.width>=t)},e})();e.CanvasVisualErrorOverlayController=i})(t=e.controllers||(e.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){i.CanvasVisualErrorOverlay={templateUrl:"components/canvasVisualErrorOverlay/canvasVisualErrorOverlay.html",bindings:{errorInfo:"<",viewMode:"<",viewport:"<",showErrorDetails:"&",fixErrors:"&"},controller:e.common.createController(t.controllers.CanvasVisualErrorOverlayController)}})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=e.explore.util.DragDropTypes,o=t.constants.ExploreCanvasConstants,n=e.data.FieldExprPattern,a=t.contracts.FilterType,s=e.data.SQExprBuilder,l=e.data.SQExprConverter,c=e.data.SQExprUtils,u=e.data.TopNFilterPattern,p=(function(){function p(i,o){var n=this;this.scope=i,this.services=o,this.dropConfig={accept:r.Field},this.subscriptionManager=this.services.eventBridge.createChannelSubscriptionManager().subscribe(e.explore.services.events.filterContainerChanged,(function(e,t){return n.onFilterContainerChanged(t)})).subscribe(t.viewModels.FilterEvents.topNFilterOrderByUpdate,(function(e,t){return n.onTopNFilterValueUpdate(t)}))}return p.createOptions=function(){return{additionalServices:["aggrOps","conceptualSchemaProxy","displayNameService","dragDataService","dropdown","localizationService","promiseFactory","telemetryService"],scopedDependencies:["dataSources","eventBridge","undoRedo","viewModeState","visualAuthoring","visualPlugin"]}},p.prototype.onTopNFilterValueUpdate=function(e){var t=this,r=e.filterViewModel,o=e.orderByField;if(r&&r.contract===this.viewModel.contract){var n=this.services.dataSources.get();this.services.conceptualSchemaProxy.get(n).then((function(e){t.isValidOrderByExpr(o,e)&&i.TopNFilterViewModelFactory.updateOrderByField(t.vm,o,e,t.services.displayNameService,t.services.localizationService,t.services.aggrOps)&&t.topNFilterForm.$setDirty()}))}},p.prototype.$onInit=function(){this.initializeViewModel(this.viewModel.contract),this.checkDisabled(),this.viewModel.isInOutspacePane&&(this.backgroundColor=o.DefaultControlBackgroundColor,this.color=o.DefaultControlForegroundColor)},p.prototype.$onDestroy=function(){this.subscriptionManager.unsubscribeAll()},p.prototype.applyFilter=function(){var e=this;if(this.canApplyFilter()){this.viewModel.contract.type=a.TopN;var r={fieldBeingFiltered:this.viewModel.contract.expression,isTop:this.vm.targetType.type===i.TopNFilterType.Top,itemCount:this.vm.itemCount,orderByField:this.vm.orderByField};this.services.visualAuthoring.updateTopNFilter(this.viewModel.visualContainer,r,this.viewModel.getFilterContainerScope(),this.viewModel.contract).then((function(){var i={filter:e.viewModel.contract,changeType:2,scope:e.viewModel.getFilterContainerScope(),source:e.viewModel};return e.viewModel.useDefaultFilter=!1,e.updateRestatement(),e.topNFilterForm.$setPristine(),e.services.eventBridge.publishBubbling(e.scope,t.viewModels.FilterEvents.filterChanged,i),!0}))}},p.prototype.canApplyFilter=function(){return this.checkDisabled(),!this.viewModel.cardType.invalid&&this.vm&&this.vm.itemCount>0&&null!=this.vm.orderByField&&this.topNFilterForm.$dirty&&this.topNFilterForm.$valid},p.prototype.dropFilterTarget=function(){var e=this,t=this.services.dragDataService.getDragContext();if(t&&t.field){var r=this.services.dataSources.get();this.services.conceptualSchemaProxy.get(r).then((function(r){var o=t.field,n=c.isMeasure(o)?o:s.aggregate(o,e.services.aggrOps.defaultAggregate(o,r,!0));e.isValidOrderByExpr(n,r)&&i.TopNFilterViewModelFactory.updateOrderByField(e.vm,n,r,e.services.displayNameService,e.services.localizationService,e.services.aggrOps)&&e.topNFilterForm.$setDirty()}))}},p.prototype.getDropAction=function(){return __awaiter(this,void 0,e.Promise,(function(){var e,t,i,r,o,n;return __generator(this,(function(a){switch(a.label){case 0:return e=this.services.promiseFactory.defer(),t=0,this.viewModel.cardType.invalid?[3,2]:(i=this.services.dragDataService.getDragContext(),i&&i.field?(r=i.field,o=this.services.dataSources.get(),[4,this.services.conceptualSchemaProxy.get(o)]):[3,2]);case 1:n=a.sent(),this.isValidOrderByExpr(r,n)&&!c.isFromVariation(r)&&(t=1),a.label=2;case 2:return e.resolve(t),[2,e.promise]}}))}))},p.prototype.removeOrderBy=function(){i.TopNFilterViewModelFactory.removeOrderByField(this.vm),this.topNFilterForm.$setDirty()},p.prototype.selectAggregate=function(e){var t=this;if(e!==this.vm.selectedAggregate){var r=this.services.dataSources.get();this.services.conceptualSchemaProxy.get(r).then((function(r){i.TopNFilterViewModelFactory.updateAggregate(t.vm,e,r,t.services.displayNameService,t.services.localizationService)&&t.topNFilterForm.$setDirty()}))}},p.prototype.showContextMenu=function(e){var t=this,i={anchorElement:$(e.currentTarget)};this.services.dropdown.showContextMenu(this.vm.availableAggregates,void 0,(function(e){return t.selectAggregate(e.aggregate)}),!1,void 0,void 0,!0,i)},p.prototype.checkDisabled=function(){var t=this,i=this.viewModel.getFilterContainerScope().container;this.viewModel.cardType.invalid=_.some(i.filters,(function(i){return i!==t.viewModel.contract&&e.data.TopNFilterPattern.extractParametersFromFilter(i.filter)}))},p.prototype.isValidOrderByExpr=function(e,t){var i=l.asFieldPattern(e,t);return!!(c.isMeasure(e)||n.getProperty(i)||i.hierarchyLevel)},p.prototype.onFilterContainerChanged=function(e){e.filter===this.viewModel.contract&&jsCommon.EnumExtensions.hasFlag(e.changeType,10)&&this.initializeViewModel(e.filter),e.filter===this.viewModel.contract&&e.source!==this.viewModel&&jsCommon.EnumExtensions.hasFlag(e.changeType,2)&&this.initializeViewModel(e.filter),this.checkDisabled()},p.prototype.initializeViewModel=function(e){var t=this,r=this.services.dataSources.get();this.services.conceptualSchemaProxy.get(r).then((function(r){var o=e&&e.filter&&u.extractParametersFromFilter(e.filter);t.vm=i.TopNFilterViewModelFactory.createViewModel(o,r,t.services.localizationService,t.services.displayNameService,t.services.aggrOps),t.updateRestatement(),t.viewModel.updateFilterProperties(r,t.services.visualPlugin,t.services.aggrOps),t.viewModel.updateViewState()}))},p.prototype.updateRestatement=function(){this.viewModel.setRestatement(this.vm.getRestatement(this.services.localizationService))},p})();i.TopNFilterController=p})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){t.TopNFilter={templateUrl:"components/topNFilter/topNFilter.html",controller:e.common.createController(t.TopNFilterController),bindings:{viewModel:"<"}}})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i;!(function(e){e[e.Top=0]="Top",e[e.Bottom=1]="Bottom"})(i=t.TopNFilterType||(t.TopNFilterType={}));var r=(function(){function t(e,t,i){this.filterTypes=e,this.targetType=t,this.itemCount=i}return t.prototype.getRestatement=function(t){var i=e.data.TopNFilterHelper;return i?i.getRestatement(t,this):null},t})();t.TopNFilterViewModel=r})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r,o=e.data.SQExpr,n=e.data.SQExprBuilder,a=e.data.TopNFilterPattern;!(function(r){function s(e,t,i,r,o){var n=a.extractParametersFromFilter(e);if(n)return l(n,t,i,r,o)}function l(e,t,r,o,n){var a=!e||e.isTop?i.TopNFilterType.Top:i.TopNFilterType.Bottom,s=v(r),l=new i.TopNFilterViewModel(s,_.find(s,(function(e){return e.type===a})),e&&e.itemCount);return e&&u(l,e.orderByField,t,o,r,n),l}function c(e){e.orderByField=null,e.availableAggregates=null,e.selectedAggregate=null,e.orderByDisplayName=null}function u(e,t,i,r,n,a){return!o.equals(t,e.orderByField)&&(e.orderByField=t,e.availableAggregates=h(t,i,a,n),e.orderByDisplayName=r.getDisplayName(e.orderByField,i,null,null,null,{includeVariationSource:!0}),e.selectedAggregate=o.isAggregation(t)?t.func:null,d(e),!0)}function p(e,t,i,r,o){return e.selectedAggregate!==t&&(e.orderByField=n.setAggregate(e.orderByField,t),e.selectedAggregate=t,d(e),e.orderByDisplayName=r.getDisplayName(e.orderByField,i,null,null,null,{includeVariationSource:!0}),!0)}function d(e){for(var t=0,i=e.availableAggregates.items;t<i.length;t++){var r=i[t];r.checked=r.key.aggregate===e.selectedAggregate}}function h(i,r,o,n){return{items:t.viewModels.MenuItemFactory.createAggregateMenuItems(i,r,o,!1,e.VisualDataRoleKind.Measure,[])}}function v(e){return[{type:i.TopNFilterType.Top,text:e.get("Top")},{type:i.TopNFilterType.Bottom,text:e.get("Bottom")}]}r.createViewModelFromSemanticFilter=s,r.createViewModel=l,r.removeOrderByField=c,r.updateOrderByField=u,r.updateAggregate=p,r.getAvailableAggregates=h})(r=i.TopNFilterViewModelFactory||(i.TopNFilterViewModelFactory={}))})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=t.services,o=e.explore.services.events,n=t.util.VisualContainerUtils,a=(function(){function i(e,t){this.scope=e,this.services=t}return i.createOptions=function(){return{additionalServices:["conceptualSchemaProxy","dataProxy","displayNameService","embedModeService","featureSwitchService","networkAvailability","promiseFactory","singleExecutableDataProxyFactory","telemetryService"],scopedDependencies:["dataSources","eventBridge","explorationNavigation","filterGenerator","resourceLoader","resourceRegistration","scriptVisuals","shell","visualPlugin","visualPluginOps","visualQueryGenerator","visualValidator"]}},i.prototype.$onInit=function(){var e=this;this.initializeQueryHandler(),this.initializeVisual(),this.subscriptionManager=this.services.eventBridge.createChannelSubscriptionManager().subscribe(o.visualContainerChanged,(function(t,i){i&&e.visual&&i.affectContainer(e.visual)&&e.onVisualContainerChanged()})),this.onVisualContainerChanged(!0,!this.services.networkAvailability.isNetworkAvailable())},i.prototype.$onChanges=function(e){this.visualDefinition&&e&&e.visualViewport&&(this.visualDefinition.viewport=this.visualViewport)},i.prototype.$onDestroy=function(){this.subscriptionManager.unsubscribeAll()},i.prototype.initializeQueryHandler=function(){var e=this,i={getDataSources:function(){return e.services.dataSources.get()},notifyStart:function(){return e.config.notifyStart()},notifyEnd:function(){return e.config.notifyEnd()},clearErrors:function(){return e.config.clearQueryErrors()},handleErrors:function(t){return e.config.handleQueryErrors(t)},handleWarnings:function(t,i){return e.config.handleQueryWarnings(t,i)},applyUpdate:function(t,i,r){return e.handleQueryResult(t,i,r)},loadMergedData:function(t){return e.setVisualData(t)}};this.queryHandler=r.createVisualContainerQueryHandler(i,this.config.queryVisualHostServices,this.services.promiseFactory,this.services.conceptualSchemaProxy,this.services.featureSwitchService,this.services.telemetryService,this.services.visualQueryGenerator,this.services.visualPlugin,this.services.visualPluginOps,this.services.dataProxy,this.services.networkAvailability,this.services.embedModeService,this.services.filterGenerator,this.services.scriptVisuals,this.services.displayNameService,this.services.explorationNavigation,this.services.resourceLoader,this.services.eventBridge,this.services.shell,t.services.createExploreVisualDataProxyService(this.services.singleExecutableDataProxyFactory.create(),this.services.filterGenerator),this.services.resourceRegistration)},i.prototype.initializeVisual=function(){var t=this,i=this.services.visualPlugin.getPlugin(n.getVisualType(this.visual)),r=i?i.name:void 0,o=e.data.DataViewObjectDefinitions.getValue(n.getContainerObjectDefinitions(this.visual),{objectName:"stylePreset",propertyName:"name"},void 0);this.visualDefinition={interactivityOptions:this.config.interactivityOptions,type:r,allowInvalidDataView:!0,themeCollection:this.themeCollection,viewport:this.visualViewport,dataTransforms:{objects:n.getObjectDefinitions(this.visual)},hostServices:this.getVisualHostServices(),visualAdapterHostServices:{startProgressBar:function(){return t.config.notifyStart()},stopProgressBar:function(){return t.config.notifyEnd()},getNextDataSegment:function(){return t.getNextDataSegment()}},stylePresetName:o&&o.value,additionalObjectUpdates:this.config.additionalObjectUpdates,visualPlugin:this.services.visualPlugin}},i.prototype.onVisualContainerChanged=function(e,t){this.config.clearQueryErrors();var i=this.services.visualValidator.validate(this.visual);return i?void this.config.handleQueryErrors({code:i.code,getDetails:function(){return i.details}}):void(this.services.visualQueryGenerator.shouldExecute(this.visual.config.singleVisual,this.services.dataSources.get())?this.applyUpdate(e,!1,t):this.queryHandler.updateNonQueryVisual(this.visual,this.visualDefinition.dataTransforms))},i.prototype.applyUpdate=function(e,t,i){this.queryHandler.runQuery({contract:this.visual,viewport:this.visualDefinition.viewport,initialLoad:e,useVisualContainerCache:this.shouldUseCache(),preferCurrentData:t,allowCache:i,currentData:this.visualDefinition.data})},i.prototype.getNextDataSegment=function(){return this.queryHandler.getNextDataSegment({contract:this.visual,viewport:this.visualDefinition.viewport,useVisualContainerCache:this.shouldUseCache()})},i.prototype.loadMoreData=function(){this.queryHandler.loadMoreData({contract:this.visual,currentData:this.visualDefinition.data,useVisualContainerCache:this.shouldUseCache(),viewport:this.visualDefinition.viewport})},i.prototype.shouldUseCache=function(){return n.shouldUseQueryCache(this.visual,this.config.disableQueryCacheUpdates)},i.prototype.handleQueryResult=function(t,i,r){var o=this.visualDefinition;o.dataTransforms=i,r&&(o.dataTransforms=e.Prototype.inherit(o.dataTransforms),o.dataTransforms.objects=r),this.setVisualData(t)},i.prototype.setVisualData=function(t){var i=this.visualDefinition;i.data=t,i.dataAppliedEvent&&(i.dataAppliedEvent.reject(),i.dataAppliedEvent=void 0),i.dataAppliedEvent=this.services.telemetryService.startActivity(this.scope,e.telemetry.EXVisualDataChanged)},i.prototype.getVisualHostServices=function(){var t=this,i=this.config.visualHostServices;return this.config.noLoadMore||(i=e.Prototype.inherit(i,(function(e){e.loadMoreData=function(){return t.loadMoreData()}}))),i},i})();i.SingleVisualHostController=a})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){i.SingleVisualHost={templateUrl:"components/singleVisualHost/singleVisualHost.html",bindings:{visual:"<",visualViewport:"<",themeCollection:"<",config:"<"},controller:e.common.createController(t.controllers.SingleVisualHostController)}})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=e.explore.services.events,o=e.explore.services.undoRedoStrategy.UndoRedoNoOp,n=(function(){function e(e,t){this.services=t,this.disableOutspacePane=!0,this.canvasOptions={autoLayoutVisualPadding:0,disableDeferredRendering:!0,disableFocusOnExploreCanvas:!0,scrollbarOffset:0},this.initialized=!1}return e.createOptions=function(){return{additionalServices:["$element"],scopedDependencies:["eventBridge","explorationNavigation","formFactor","undoRedo"]}},e.prototype.$onInit=function(){var e=this;this.subscriptionManager=this.services.eventBridge.createChannelSubscriptionManager().subscribe(r.sectionChanged,(function(t,i){e.services.explorationNavigation.updateExplorationActiveSectionIndex({exploration:e.explorationContract,section:i.name,suppressTelemetry:!0})}));var t=new o;this.services.undoRedo.setStrategy(t),this.fadeOnLoading=jsCommon.BrowserUtility.isInternetExplorerBrowser(),this.updateViewModel(),this.initialized=!0},e.prototype.$onDestroy=function(){this.subscriptionManager&&(this.subscriptionManager.unsubscribeAll(),this.subscriptionManager=null),this.initialized=!1},e.prototype.$onChanges=function(e){var t=this,i=!1;if(e.explorationContract||e.sectionName){e.explorationContract&&this.updateExploration(e.explorationContract.currentValue);var r=_.find(this.explorationContract.sections,(function(e){return e.name===t.sectionName}));this.services.explorationNavigation.goto(r,{updateUrl:!0}),i=!0}e.layout&&(i=!0),i&&this.initialized&&this.updateViewModel()},e.prototype.updateExploration=function(e){null!=e&&this.services.explorationNavigation.loadExploration(e)},e.prototype.updateViewModel=function(){var e=this,i=_.find(this.explorationContract.sections,(function(t){return t.name===e.sectionName}));this.viewModel=t.viewModels.ViewModelFactory.convertSectionToExploreCanvas(this.explorationContract,i,this.layout)},e})();i.StandaloneCanvasController=n})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){t.StandaloneCanvas={templateUrl:"components/standaloneCanvas/standaloneCanvas.html",controller:e.common.createController(t.StandaloneCanvasController),bindings:{layout:"<",explorationContract:"<",sectionName:"<",showMask:"<",disableOutspacePane:"<?"}}})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(e,t){this.services=t,this.initializeHighContrastRules()}return e.createOptions=function(){return{additionalServices:["svgProvider","cssGenerationService"]}},e.prototype.initializeHighContrastRules=function(){this.services.cssGenerationService.addRule(".fwns","{fill: @foregroundColor !important; opacity: 1 !important; stroke: none !important; }"),this.services.cssGenerationService.addRule(".fwns1","{fill: @backgroundColor !important; opacity: 1 !important; stroke: none !important; }"),this.services.cssGenerationService.addRule(".nfwns","{fill: none !important; stroke: none !important; }")},e.prototype.$onInit=function(){this.services.svgProvider.loadSheet(this.sheet)},e.prototype.getSymbolRef=function(){return"#"+this.symbolId+(this.disabled?"_disabled":"")},e})();e.SvgUseSymbolController=t})(t=e.components||(e.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){t.SvgUseSymbol={template:'<svg height="100%" width="100%"><use href="{{$ctrl.getSymbolRef()}}" xlink:href="{{$ctrl.getSymbolRef()}}"/></svg>',bindings:{symbolId:"<",disabled:"<?",sheet:"@"},controller:e.common.createController(t.SvgUseSymbolController)}})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i=e.Promise,r=(function(){function e(e,t){}return e.createOptions=function(){return{additionalServices:["promiseFactory"],scopedDependencies:[]}},e.prototype.$onInit=function(){this.commands=this.getCommands()},e.prototype.$onChanges=function(e){e.tooltipShown&&e.tooltipShown.currentValue&&(this.childMenu=void 0,this.commands=this.getCommands())},e.prototype.$onDestroy=function(){},e.prototype.hide=function(){this.childMenu=void 0,this.showChildMenu({show:!1}),this.onHide()},e.prototype.execute=function(e){return __awaiter(this,void 0,i,(function(){var t;return __generator(this,(function(i){switch(i.label){case 0:return[4,e.getChildren()];case 1:return t=i.sent(),_.isEmpty(t)?[3,2]:(this.toggleChildMenu(t),[3,4]);case 2:return e.execute?[4,e.execute()]:[3,4];case 3:i.sent(),this.hide(),i.label=4;case 4:return[2]}}))}))},e.prototype.toggleChildMenu=function(e){this.childMenu=this.childMenu?void 0:e,this.showChildMenu({show:!!this.childMenu})},e.prototype.getCommands=function(){return this.actionsProvider&&this.actionsProvider.updateAndGetTooltipCommands()},e})();t.TooltipActionsController=r})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){t.TooltipActions={templateUrl:"components/tooltipActions/tooltipActions.html",controller:e.common.createController(t.TooltipActionsController),bindings:{actionsProvider:"<",onHide:"&",showChildMenu:"&",tooltipShown:"<"}}})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i=e.Promise,r=(function(){function e(e,t){}return e.createOptions=function(){return{additionalServices:[],scopedDependencies:[]}},e.prototype.$onInit=function(){},e.prototype.$onChanges=function(e){},e.prototype.$onDestroy=function(){},e.prototype.execute=function(e){return __awaiter(this,void 0,i,(function(){var t;return __generator(this,(function(i){switch(i.label){case 0:return[4,e.getChildren()];case 1:return t=i.sent(),_.isEmpty(t)?[3,2]:(this.commandsMenu=t,[3,4]);case 2:return e.execute?[4,e.execute()]:[3,4];case 3:i.sent(),this.onHide(),i.label=4;case 4:return[2]}}))}))},e})();t.TooltipChildMenuController=r})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){t.TooltipChildMenu={templateUrl:"components/tooltipChildMenu/tooltipChildMenu.html",controller:e.common.createController(t.TooltipChildMenuController),bindings:{commandsMenu:"<",onHide:"&"}}})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=jsCommon.BrowserUtils,o=e.common.constants,n=e.common.events,a=e.data.DataViewObjectDefinitions,s=e.data.DataViewObjectDescriptors,l=t.util.DragDropTypes,c=jsCommon.DragDropUtils,u=e.data.dsr.DsrMessage,p=t.services.events,d=e.explore.FilterExpressionMetadataUtils,h=e.a11y.util.FocusUtility,v=e.helpers,g=t.util.QueryGeocodingTracker,f=t.services.selectionUtils,y=e.data.Selector,m=e.data.SemanticFilter,S=e.visuals.SlicerPluginMethods,w=e.data.SQExpr,C=e.data.SQExprUtils,b=e.data.SQExprConverter,x=e.common.helpers.TelemetryHelper.TelemetryEventManager,F=t.contracts.VisualContainer,D=t.util.VisualContainerUtils,V=t.contracts.VisualLink,M=e.visualHost.visualPluginServiceHelpers,P=t.contracts.VisualTitle,E=(function(){function i(e,t){this.lastProgressBarState={progressBarCount:0,detailVisualProgressBarCount:0,hasPendingGeocoding:!1},this.applyUpdateActivity=new x,this.scope=e,this.services=t,this.setTransformScopeProperties(this.scope)}return i.createOptions=function(){
return{additionalServices:["aggrOps","conceptualSchemaProxy","dataProxy","displayNameService","dragDataService","$element","embedModeService","errorService","explorationSerializer","featureSwitchService","geocoder","localizationService","modalDialogService","moduleLoader","networkAvailability","overlayService","promiseFactory","singleExecutableDataProxyFactory","telemetryService","trustedVisual","visualInstanceIdTracking","customVisualsAuthentication","themeService"],scopedDependencies:["clipboard","dataSources","drill","expandCollapse","eventBridge","explorationActivity","explorationCapabilities","explorationNavigation","filterGenerator","formFactor","groupingDesignStateService","lazyScoped","lazyScopedSync","resourceLoader","resourceRegistration","runningVisuals","scriptVisuals","selection","shell","sort","undoRedo","uiComponent","viewModeState","visibility","visualAuthoring","visualAuthoringOperations","visualContainerMenuFactory","visualPlugin","visualPluginOps","visualQueryGenerator","visualRelationship","visualHostTooltipServiceFactory","visualValidator"]}},i.prototype.$onInit=function(){var i=this;this.dataProxyService=t.services.createExploreVisualDataProxyService(this.services.singleExecutableDataProxyFactory.create(),this.services.filterGenerator),this.isExplorationUnloaded=!1,this.queryExecutionServices={getDataSources:function(){return i.services.dataSources.get()},notifyStart:function(){return i.startProgressBar()},notifyEnd:function(){return i.stopProgressBar()},clearErrors:function(){return i.errorManager.clearError()},handleErrors:function(e){return i.handleQueryErrors(e)},handleWarnings:function(e,t){return i.handleWarnings(e,t)},applyUpdate:function(e,t,r){return i.handleQueryResult(e,t,r)},loadMergedData:function(e){return i.loadMergedData(e)}},this.errorManager=t.util.createVisualContainerErrorManager(this.viewModel,(function(){return i.viewModel.getVisualType()}),(function(){return i.viewModel.contract}),{aggrOps:this.services.aggrOps,conceptualSchemaProxy:this.services.conceptualSchemaProxy,dataSources:this.services.dataSources,eventBridge:this.services.eventBridge,errorService:this.services.errorService,featureSwitchService:this.services.featureSwitchService,modalDialogService:this.services.modalDialogService,selection:this.services.selection,telemetryService:this.services.telemetryService,visualAuthoring:this.services.visualAuthoring}),this.initializeVisualContainerQueryHandler(),this.visualHostTooltip=this.services.visualHostTooltipServiceFactory.create(this.viewModel.contract,this.queryHandler,this.dataProxyService),this.progressBarCount=0,this.detailVisualProgressBarCount=0,this.scopeEventManager=e.common.createScopeEventSubscriptionManager(this.scope),this.visualContainerDataSelectionService=t.services.createVisualContainerDataSelectionService(this.viewModel,this.services.visualPluginOps),this.viewModel.showWatermark=!1,this.viewModel.options=this.services.explorationCapabilities.getCapabilities().visualContainerOptions,this.endLoadDefer=this.services.promiseFactory.defer(),this.viewModel.isFooterVisible=function(){return i.isFooterVisible()},this.updateContract("update"),this.menuOptions={canDelete:!1,canExport:!1,canSort:!1,canSearch:!1,canCluster:!1,canSpatialCluster:!1,hasMoreOptions:!1,canEdit:!1,sortSetting:{defaultSortBehavior:!1,sortableFields:[]},canSeeData:!1,canSpotlight:this.canSpotlight()},this.sortHelper=e.explore.services.createVisualSortHelper(this.menuOptions.sortSetting,this.viewModel,this.services.sort,this.services.undoRedo,this.services.timeout,this.services.visualAuthoringOperations),this.scope.getDragRestriction=function(){return i.getDragRestrictElementRect()},this.dropConfig={accept:l.Field,greedy:!1},this.scopeEventManager.subscribe(t.constants.explorationLoadedEventName,(function(){return i.applyUpdate(!0)})),this.instanceId=jsCommon.Utility.generateGuid();var r=this.viewModel.contract.config.singleVisual.visualType;this.services.visualInstanceIdTracking.associate(this.instanceId,r),this.visualHostTelemetryService=t.services.createVisualHostTelemetryService(this.services.telemetryService,r,this.instanceId),this.visualHostAuthenticationService=this.services.customVisualsAuthentication,this.setViewModelServices(),this.disablePin=this.viewModel.options.disablePin,this.resetVisualStyle(),this.resetBackground(),this.resetTitle(),this.resetAspectRatio(),this.resetBorder(),this.viewModel.updateViewState(),this.viewModel.getRunningVisual().setAdditionalObjectUpdates((function(e){return i.applyBufferedPropertyChangesToObjects(e)})),this.updateSelection(),this.resetPadding(),this.scopeEventManager.subscribe(t.constants.TransformElementDragStartEventName,(function(e,t){i.isSelected()||i.selectVisualContainer()})),this.scopeEventManager.subscribe(o.visualReady,(function(e){e.stopPropagation(),i.endLoadDefer.resolve(null),i.services.eventBridge.publishToChannel(p.visualContainerDataRendered,i.viewModel.contract)})),this.viewModel.showWatermark&&this.endLoadDefer.resolve(null),this.createCanvasLayoutItemOptions(),this.subscribeToEvents();var n=this.viewModel.contract,a=!n.initialLoadCompleted;n.initialLoadCompleted=!0;var s;this.services.networkAvailability.isNetworkAvailable()||(s=!0),this.scope.$applyAsync((function(){return i.onVisualContainerChangedAsync(a,s)})),this.geocodingTracker=new g({onStartGeocoding:function(){i.updateProgressBarState(),i.scope.$applyAsync()},onStopGeocoding:function(){i.updateProgressBarState(),i.scope.$applyAsync()}}),this.registerDomEventHandlers()},i.prototype.$onDestroy=function(){this.canvasLayout.unregisterLayoutItem(this.canvasLayoutItem),this.hideOverlays(),this.subscriptionManager.unsubscribeAll(),this.unregisterReloadEmptyVisuals&&this.unregisterReloadEmptyVisuals(),this.visualHostTooltip.hide({isTouchEvent:!1,immediately:!0}),this.updateContract("destroy"),this.viewModel.reset()},i.prototype.registerDomEventHandlers=function(){var e=this,t=this.scope;if(!this.services.viewModeState.getConfig().displayOptions.visualMouseoverDisabled){var i=this.services.$element;i.on("mouseenter",(function(){return t.$applyAsync((function(){return e.setHover(!0)}))})),i.on("mouseleave",(function(){return t.$applyAsync((function(){return e.setHover(!1)}))}))}},i.prototype.setTransformScopeProperties=function(t){var i=this.services.formFactor.getCurrentLayoutCapabilities();t.aspectRatioOffset=e.explore.viewModels.VisualContainer.getVisualBodyOffset(i,this.services.explorationCapabilities)},i.prototype.initializeVisualContainerQueryHandler=function(){this.queryHandler=t.services.createVisualContainerQueryHandler(this.queryExecutionServices,this.viewModel.hostServices,this.services.promiseFactory,this.services.conceptualSchemaProxy,this.services.featureSwitchService,this.services.telemetryService,this.services.visualQueryGenerator,this.services.visualPlugin,this.services.visualPluginOps,this.services.dataProxy,this.services.networkAvailability,this.services.embedModeService,this.services.filterGenerator,this.services.scriptVisuals,this.services.displayNameService,this.services.explorationNavigation,this.services.resourceLoader,this.services.eventBridge,this.services.shell,this.dataProxyService,this.services.resourceRegistration)},i.prototype.computeStyle=function(){var e=this.viewModel,t=this.services.viewModeState,i=this.services.viewModeState.getConfig(),r=t.getMode(),o=!this.showSelectionBorder&&0===r&&!i.displayOptions.showVisualBordersInViewMode,n=this.getVisualHeaderPlacement(e);return[e.contract.initialLoadCompleted?"":"loading",e.isSelected?"selected":"",e.isSelected?"swipeable-blocked":"",0===r?"readMode":"",1===r?"editMode":"",o?"hideBorder":"",i.displayOptions.disableFadeout?"disableFadeout":"",e.isPoppedOut?"popOut":"",this.services.visibility.isSeeDataMode(this.viewModel.contract.visibility)?"seeData":"",4===e.contract.visibility?"spotlight":"",2===e.contract.detailVisualLayout?"seeDataVerticalLayout":"",e.isPaddingDisabled?"paddingDisabled":"",e.visualTitleVisible()?"":"noVisualTitle",this.preventInnerScroll()?"preventVisualScrolling":"",0===n?"visualHeaderAbove":1===n?"visualHeaderBelow":""]},i.prototype.getVisualHeaderPlacement=function(e){if(!this.services.explorationCapabilities.getCapabilities().visualContainerOptions.useStylableHeader)return 3;var i=e.uiScale.y;if(e.isPoppedOut||e.visualTitleVisible()&&i>=t.viewModels.VisualContainer.HeaderInTitleScaleThreshold)return 2;var r=e.position;return r.y*i>=t.viewModels.VisualContainer.VisualContainerHeaderHeight?0:(this.services.explorationNavigation.getCurrentSection().size.height-(r.y+r.height))*i>=t.viewModels.VisualContainer.VisualContainerHeaderHeight?1:2},i.prototype.onClosePopOut=function(e){e.stopPropagation(),this.applyBufferedPropertyChanges(),this.setPopOutMode(0),2===this.services.viewModeState.getMode()&&this.services.viewModeState.setMode(1),this.viewModel.setEditMode(0)},i.prototype.toggleSelect=function(e,i){var o=this;if(this.showSelectionBorder=i,r.isCtrlOrMeta(e)&&this.isSelected()&&f.getSelectedVisuals(this.services.selection).length>1)return t.util.EventBubblingUtility.markAsHandled(e),this.services.overlayService.hideAllDropdowns(),void f.unselectVisualContainer(this.viewModel.contract,this.services.selection);this.selectVisualContainer(r.isCtrlOrMeta(e)),this.services.overlayService.hideAllDropdowns();var n=!t.util.EventBubblingUtility.handled(e),a=$(e.currentTarget);t.util.EventBubblingUtility.markAsHandled(e),this.services.timeout((function(){n&&a.focus(),o.services.clipboard.tryPasteFormat()}))},i.prototype.getVisualContainerTabindex=function(){return void 0!==this.viewModel.position.tabOrder&&this.viewModel.position.tabOrder<0?-1:0},i.prototype.setHover=function(e){this.isHovering=e},i.prototype.setHeaderHover=function(e,t){if(this.viewModel.contract.name===t.visualContainerName){var i="showHover";this.isHovering=e;this.services.$element.toggleClass(i,e)}},i.prototype.onDoubleClick=function(e){this.services.viewModeState.getConfig().visualDoubleClickEnabled&&!this.services.visibility.get()&&this.popOutVisualContainer()},i.prototype.onVCBodyClick=function(t){return __awaiter(this,void 0,e.Promise,(function(){return __generator(this,(function(e){return this.ensureFocus(t),[2]}))}))},i.prototype.onRightClick=function(e){var i=D.getVisualType(this.viewModel.contract);t.util.EventBubblingUtility.handled(e)||this.services.visualPlugin.isCustomVisual(i)||!this.services.visualPluginOps.isQueryVisual(i)||this.onContextMenu({data:void 0,position:{x:e.pageX,y:e.pageY}})},i.prototype.onKeydown=function(e){if(13===e.keyCode||32===e.keyCode){var t=this.getVisualLink();if(t&&t.show){var i={visualObjects:[{objectName:"",selectorsByColumn:{}}],isCtrlOrMetaKey:r.isCtrlOrMeta(e),position:{x:e.clientX,y:e.clientY}};this.onSelecting(i),1===i.action&&e.stopPropagation()}}},i.prototype.updateVisualLinkProperties=function(){var e=this.services.viewModeState.getMode(),t=this.getVisualLink(),i=t&&t.show,r=null;if(i){var o=V.getType(t);if(t.tooltip)r=t.tooltip;else{var n=1===e?"Visual_VisualLink_Click_EditTooltip":"Visual_VisualLink_Click_ViewTooltip",a=void 0;a=o===V.Back?this.services.localizationService.get("Visual_VisualLink_Back_Tooltip"):this.services.localizationService.get("Visual_VisualLink_Bookmark_Tooltip"),r=this.services.localizationService.format(n,[a])}}this.visualLinkProperties={hasVisualLink:i,title:r}},i.prototype.getVisualLink=function(){var e=this.getVisualCapabilities();if(e&&e.supportsVisualLink){var t=this.viewModel.objects;return t&&t.visualLink}},i.prototype.getVisualCapabilities=function(){return this.services.visualPlugin.capabilities(this.viewModel.getVisualType())},i.prototype.canSpotlight=function(){return!this.viewModel.isPoppedOut&&!this.services.viewModeState.getConfig().displayOptions.disableSpotlight},i.prototype.onTouchend=function(e){this.visualHostTooltip.visible()&&this.services.viewModeState.getConfig().touchOptions.disableTouchendOnTooltip&&e.preventDefault()},i.prototype.getTouchActionState=function(){var e=this.visualHostTooltip.visible();return this.visualHostTooltip.isTouchScreenOptimizedEnabled()&&e?"none":"pan-y pan-x"},i.prototype.getContextMenuHandlers=function(){var e=this;return{onSetNodeExpansionState:function(t){return e.setNodeExpansionState(t)},onSetLevelExpansionState:function(t){return e.setLevelExpansionState(t)},onSetHierarchyExpansionState:function(t){return e.setHierarchyExpansionState(t)}}},i.prototype.onContextMenu=function(e){if(this.viewModel.options.showContextMenu){this.contextMenuArgs=e,this.isSelected()||this.selectVisualContainer();var t=_.first(this.viewModel.getRunningVisual().getDataViews());this.services.visualContainerMenuFactory.createMenu(this.viewModel.contract,this.contextMenuArgs,this.dataProxyService,this.queryHandler,this.getContextMenuHandlers(),this.visualContainerDataSelectionService,t)}},i.prototype.ensureFocus=function(e){h.isFocusInTree($(e.currentTarget))&&t.util.EventBubblingUtility.markAsHandled(e)},i.prototype.setViewModelServices=function(){var i=this;this.viewModel.setServices({getLocalizedString:function(e){return i.services.localizationService.get(e)},requestFocus:function(e){return jsCommon.FocusManager.focus(e)},canSelect:function(e){return i.canSelect(e)},onDragStart:function(e){return i.onDragStart(e)},onContextMenu:function(e){return i.onContextMenu(e)},onSelecting:function(e){return i.onSelecting(e)},onSelect:function(e){return i.onSelect(e)},canExpandCollapse:function(e){return i.canExpandCollapse(e)},setNodeExpansionState:function(e){return i.setNodeExpansionState(e)},getVisualLinkProperties:function(){return i.visualLinkProperties},persistProperties:function(e,t){return i.persistProperties(e,t)},shouldRetainSelection:function(){return i.shouldRetainSelection()},loadMoreData:function(){return i.loadMoreData()},onCustomSort:function(e){return i.onCustomSort(e.sortDescriptors)},getViewMode:function(){return i.services.viewModeState.getMode()},getEditMode:function(){return i.viewModel.editMode},setWarnings:function(e){return i.setClientWarnings(e)},setToolbar:function(e){return i.setToolbar({element:e,removeOnBlur:_.noopFalse})},geocoder:function(){return i.getGeocoderForVisual()},geolocation:function(){return e.visuals.services.createGeolocation()},locale:function(){return e.common.unmappedCultureInfo},promiseFactory:function(){return i.services.promiseFactory},analyzeFilter:function(e){return t.services.createAnalyzedFilter(e,!1)},setIdentityDisplayNames:function(e){return i.setIdentityDisplayName(e)},getIdentityDisplayNames:function(e){return i.getLabelForScopeId(e)},visualCapabilitiesChanged:function(){return i.visualCapabilitiesChanged()},tooltips:function(){return i.visualHostTooltip},telemetry:function(){return i.visualHostTelemetryService},loader:function(){return i.services.moduleLoader},getUIComponentFactory:function(){return i.services.uiComponent.getUIComponentFactory(i.scope)},applyJsonFilter:function(e,t,r,o){return i.applyJsonFilter(e,t,r,o)},instanceId:this.instanceId,refreshHostData:function(){return i.refreshHostData()},authenticationService:function(){return i.visualHostAuthenticationService},localStorageService:function(){return i.visualHostLocalStorageService},getJSONFilter:function(t){return __awaiter(i,void 0,e.Promise,(function(){return __generator(this,(function(e){switch(e.label){case 0:return[4,this.getJSONFilter(t)];case 1:return[2,e.sent()]}}))}))}},this.services.visualPlugin,this.services.visualPluginOps,this.services.viewModeState,this.services.formFactor,this.services.visibility,this.services.runningVisuals,this.services.explorationCapabilities,{getNextDataSegment:function(){return i.getNextDataSegment()},startProgressBar:function(){return i.startProgressBar()},stopProgressBar:function(){return i.stopProgressBar()}})},i.prototype.setIdentityDisplayName=function(e){var t=this.viewModel.contract.config.singleVisual;if(_.isEmpty(e))return void(t.cachedFilterDisplayItems=null);var i=e[0].identity,r={data:[i]};d.hasGroupOnKeys([r],t)&&(t.cachedFilterDisplayItems=e)},i.prototype.getGeocoderForVisual=function(){return this.geocodingTracker.wrapGeocoder(this.services.geocoder)},i.prototype.visualCapabilitiesChanged=function(){this.convertTo(this.viewModel.getVisualType()),this.raiseVisualContainerChanged((function(){return function(){return!0}}))},i.prototype.getLabelForScopeId=function(e){for(var t=[],i=0,r=e;i<r.length;i++){var o=r[i],n=this.getDisplayNameFromCache(o);n||(n={displayName:b.getFirstComparandValue(o),identity:o}),t.push(n)}return t},i.prototype.getDisplayNameFromCache=function(t){var i=this.viewModel.contract.config.singleVisual.cachedFilterDisplayItems;if(!_.isEmpty(i))return _.find(i,(function(i){return e.DataViewScopeIdentity.equals(i.identity,t,!0)}))},i.prototype.createCanvasLayoutItemOptions=function(){var e=this,t=function(t){e.hideOverlays()},i=function(t,i){1===e.services.selection.getSelectedElements().length&&e.updateDimensions(t)},r=function(t,i){if(e.isEditable()&&!e.viewModel.isPoppedOut&&1===e.services.selection.getSelectedElements().length){var r=new I(e.viewModel.id,"nudge");e.updateDimensions(t,r),e.visualHostTooltip.hide({immediately:!0,isTouchEvent:!1})}},o=function(t){e.hideOverlays(),e.services.eventBridge.publishToChannel(n.visualContainerResizeStart)},a=function(t,i){return e.updateVisualViewport(t)},s=function(t,i){e.updateDimensions(t),e.services.eventBridge.publishToChannel(n.visualContainerResizeEnd)},l=function(){return e.isExplorationUnloaded},c=function(){return e.getPosition(e.viewModel.contract)},u=function(){return e.viewModel.uiScale};this.canvasLayoutItem={dragEnd:i,dragStart:t,nudge:r,resizeStart:o,resizeMove:a,resizeEnd:s,isSuspended:l,getPosition:c,getScale:u},this.transformOptions=this.canvasLayout.registerLayoutItem(this.canvasLayoutItem),this.transformOptions.getCustomRestrictionSelector=function(){return e.transformParent||"div"}},i.prototype.subscribeToEvents=function(){var i=this;this.subscriptionManager=this.services.eventBridge.createChannelSubscriptionManager().subscribe(e.events.visualThemeChanged,(function(){return i.onVisualThemeChanged()})).subscribe(p.selectionChanged,(function(){return i.updateSelection()})).subscribe(p.explorationSlowDataSourceSettingsLoaded,(function(e,t){var r=t.isSlicerSelectionsButtonEnabledChanged&&i.isFilterVisual();r&&i.applyBufferedPropertyChanges(),(t.isCrossHighlightingDisabledChanged||r)&&i.onVisualContainerChangedAsync(!1,!0)})).subscribe(p.visualContainerChanged,(function(e,t){t&&t.affectContainer(i.viewModel.contract)&&i.onVisualContainerChangedAsync(!1,t.allowCache,t.cacheResponseOnServer)})).subscribe(p.filterContainerChanged,(function(e,t){i.onFilterContainerChanged(t)})).subscribe(p.dataSelectionChanged,(function(e,t){t&&t.affectContainer(i.viewModel.contract)&&i.clearDataSelection()})).subscribe(p.explorationUnloaded,(function(e,t){i.scopeEventManager.unsubscribeAll(),i.isExplorationUnloaded=!0})).subscribe(p.changeViewMode,(function(e,t){return i.onChangeViewMode(t)})).subscribe(p.visibilityChanged,(function(){var e=i.viewModel.getRunningVisual();e.setIsInFocus(i.viewModel.isPoppedOut),i.updateMenuButtonsState(),i.detailVisualProgressBarCount&&!i.services.visibility.isSeeDataMode(i.viewModel.contract.visibility)&&i.clearDetailVisualProgressBar(),i.viewModel.updateViewState(),D.isScriptVisual(i.viewModel.contract,i.services.visualPlugin)&&i.applyUpdate()})).subscribe(n.visualContainerShowHover,(function(e,t){return i.setHeaderHover(!0,t)})).subscribe(n.visualContainerHideHover,(function(e,t){return i.setHeaderHover(!1,t)})).subscribe(p.visualContainerOptionsMenuOpened,(function(){return i.resetSortSettings()})),this.subscribeToBubbling(t.viewModels.DetailVisualEvents.spinnerAction,(function(e,t){if(e.stopPropagation&&e.stopPropagation(),i.services.visibility.isSeeDataMode(i.viewModel.contract.visibility))switch(t){case 0:i.startDetailVisualProgressBar();break;case 1:i.stopDetailVisualProgressBar()}})),this.subscribeToBubbling(p.toggleSortVisualContainer,(function(t,r){return __awaiter(i,void 0,e.Promise,(function(){var e,t;return __generator(this,(function(i){switch(i.label){case 0:return e=this.services.dataSources.get(),[4,this.services.conceptualSchemaProxy.get(e)];case 1:return t=i.sent(),this.sortHelper.toggleSort(r.sortableField,r.sortDirection,t,r.sortOnDemand),[2]}}))}))})),this.subscribeToBubbling(p.getClusters,(function(t,r){return __awaiter(i,void 0,e.Promise,(function(){var e;return __generator(this,(function(t){switch(t.label){case 0:return[4,this.services.lazyScoped("clustering")];case 1:return e=t.sent(),e.createClusters(this.viewModel,this.services.dataSources.get(),r.useSpatialClustering),[2]}}))}))})),this.subscribeToBubbling(p.changeEditMode,(function(e,t){i.onChangeEditMode(t)}));var r=this.viewModel.contract.config.singleVisual.visualType;!r||this.services.trustedVisual.canLoadVisual(r)&&this.services.visualPlugin.getPlugin(r)||(this.unregisterReloadEmptyVisuals=this.services.rootScope.$on(e.constants.reloadEmptyVisuals,(function(e,t){_.includes(t.visualTypes,r)&&(i.unregisterReloadEmptyVisuals(),i.onVisualContainerChangedAsync())})))},i.prototype.updateContract=function(t){var i=this,r=this.viewModel,o=r.contract.config.singleVisual;"update"===t?(o.getCurrentVisual=function(){return r.getRunningVisual().getAdapter()},o.getCurrentDataViews=function(){return r.getRunningVisual().getDataViews()},o.getErrorDetails=function(){return i.getErrorDetails()},o.getEvaluatedObject=function(e){return r.objects&&r.objects[e]},o.getWarnings=function(){return i.getWarnings()},o.getSelectedDataPoints=function(){return i.getSelectedDataPoints()},o.clearSelectedDataPoints=function(){if(i.selectedDatapoints=void 0,o.getCurrentVisual){var e=o.getCurrentVisual();e&&e.onClearSelection&&e.onClearSelection()}},o.setSelectedDataPoints=function(t){if(o.getCurrentVisual){var n=r.getRunningVisual(),a=o.getCurrentVisual();a&&a.visualHasMethod&&a.visualHasMethod("onRestoreSelection")?n?a.onRestoreSelection({selection:t}):o.pendingSelection=t:i.setClientWarnings([new e.visuals.OnRestoreSelectionNotSupportedWarning]),i.selectedDatapoints=t}}):"destroy"===t&&(o.getCurrentVisual=void 0,o.getCurrentDataViews=void 0,o.getErrorDetails=void 0,o.getEvaluatedObject=void 0,o.getWarnings=void 0,o.getSelectedDataPoints=void 0,o.clearSelectedDataPoints=void 0,o.setSelectedDataPoints=void 0)},i.prototype.onFilterContainerChanged=function(e){var t=this.viewModel.contract;if(0!==e.scope.scopeType||e.scope.container===t){var i=!1;switch(e.changeType){case 1:case 0:null!=e.filter&&null!=e.filter.filter&&(i=!0);break;case 10:case 2:i=!0}if(i&&(this.applyUpdate(),0===e.scope.scopeType)){var r=this.services.explorationNavigation.getCurrentSection(),o=this.services.explorationNavigation.getCurrentExploration();this.services.filterGenerator.updateCrossHighlightCollectedFilters(r,o,t)}}},i.prototype.drop=function(e,t){var i=this.services.dragDataService.getDragContext();i&&i.field&&c.isDropOnExpectedTarget(t.draggable,this.viewModel.contract)&&(f.selectVisualContainer(this.viewModel.contract,this.services.selection),this.services.visualAuthoring.addFieldToVisual(i.field,this.services.dataSources.get(),this.viewModel.contract,"DraggedToVisual"))},i.prototype.hasPositionOverride=function(){return null!=this.viewModel.overridePosition},i.prototype.getDragRestrictElementRect=function(){var e={top:0,left:0,bottom:1,right:1};if(f.hasMultipleVisualContainerSelection(this.services.selection)){for(var t=f.getSelectedVisuals(this.services.selection),i=0,r=0,o=0,n=0,a=null,s=0,l=0,c=t.length;l<c;l++){s=l;var u=t[l];if(u===this.viewModel.contract){a=this.getPosition(u);break}}if(!a)return;if(t.splice(s,1),a){for(var p=0,d=t;p<d.length;p++){var u=d[p],h=this.getPosition(u),v=a.x-h.x;i=i<v?v:i,v=h.y+h.height-(a.y+a.height),r=r<v?v:r,v=a.y-h.y,o=o<v?v:o,v=h.x+h.width-(a.x+a.width),n=n<v?v:n}e={top:0-(o>0?o/a.height:0),left:0-(i>0?i/a.width:0),bottom:1+(r>0?r/a.height:0),right:1+(n>0?n/a.width:0)}}}return e},i.prototype.setClientWarnings=function(e){if(_.isEmpty(e))return void(this.warnings=null);if(_.isArray(e)?this.warnings={warnings:e}:this.warnings=e,!_.isEmpty(this.warnings.warnings)){var t=this.warnings.warnings[0].getMessages(this.services.localizationService),i={message:t.message,displayableErrorInfo:[{errorInfoKey:t.title,errorInfoValue:t.detail}]};this.errorManager.showInfoIcon(i,this.warnings.warnings[0].code)}},i.prototype.setToolbar=function(e){this.viewModel.contract.toolbar=e,this.viewModel.updateViewState(),null!=e&&null!=e.element&&this.setToolbarVisible(!0)},i.prototype.setToolbarVisible=function(e){var t=this;if(this.viewModel.toolbarViewModel.$element){var i=this.services.viewModeState.getMode();if(e=e&&this.viewModel.isSelected&&1===i){e=this.services.formFactor.getCurrentLayoutCapabilities().canShowVisualToolbar()}this.viewModel.toolbarViewModel.visible!==e&&this.scope.$applyAsync((function(){t.viewModel.toolbarViewModel.visible=e,t.viewModel.toolbarViewModel.update()}))}},i.prototype.ensureToolbarHidden=function(){var e=this.viewModel.contract.toolbar;e&&e.removeOnBlur()&&this.setToolbar(void 0)},i.prototype.hideOverlays=function(){this.services.overlayService.hideAllDropdowns(),this.setToolbarVisible(!1)},i.prototype.onVisualThemeChanged=function(){this.resetVisualStyle(),this.onVisualContainerChangedAsync(!1,!0)},i.prototype.shouldRunQueries=function(){return!F.isHidden(this.viewModel.contract.config.singleVisual)},i.prototype.onVisualContainerChangedAsync=function(e,t,i){var r=this;if(this.shouldRunQueries()){this.startProgressBar();var o=D.getVisualType(this.viewModel.contract);return M.ensurePlugin(o,this.services.visualPlugin,this.services.moduleLoader,this.services.promiseFactory).then((function(o){var n=r.viewModel,a=n.contract.config.singleVisual;r.updateContract("update"),r.updateVisualContainerProperties(),r.setToolbar(n.contract.toolbar);var s=n.dataViewSource,l=r.viewModel.getRunningVisual();a.pendingSelection&&(l.setPendingSelection(a.pendingSelection),a.pendingSelection=void 0),s?(r.queryHandler.visualizeDataViewSource(n.contract,s,l.getViewport()),n.dataViewSource=null,r.evaluateObjectDefinitions()):r.services.visualQueryGenerator.shouldExecute(a,r.services.dataSources.get())?r.viewModel.errorInfo||r.applyUpdate(e,!1,t,i):(r.queryHandler.updateNonQueryVisual(n.contract,{objects:a.objects}),r.evaluateObjectDefinitions()),r.updateVisualContainerThemeableProperties()})).finally((function(){return r.stopProgressBar()}))}},i.prototype.updateVisualContainerProperties=function(){this.errorManager.clearError();var e=this.services.explorationNavigation.getCurrentExploration(),t=e&&e.reportId,i=this.services.visualValidator.validate(this.viewModel.contract,t);i&&(this.errorManager.showErrorOverlay(i.details,i.code),this.updateDisablePin()),this.updateDetailVisualVisibility(),this.updateMenuButtonsState();var r=this.getVisualCapabilities();r&&r.sorting&&r.sorting.custom&&this.resetSortSettings()},i.prototype.updateVisualContainerThemeableProperties=function(){this.resetBackground(),this.resetTitle(),this.resetAspectRatio(),this.resetBorder(),this.updateVisualLinkProperties(),this.resetPadding(),this.viewModel.errorInfo||this.viewModel.updateViewState()},i.prototype.getErrorDetails=function(){if(this.viewModel.errorInfo)return this.viewModel.errorInfo.details},i.prototype.getWarnings=function(){return this.warnings},i.prototype.getSelectedDataPoints=function(){return this.selectedDatapoints},i.prototype.updateMenuButtonsState=function(){var e=this.viewModel,t=this.services.viewModeState.getMode(),i=this.menuOptions;i.canExport=this.canExport(),i.canDelete=1===t&&this.services.viewModeState.getConfig().supportsDeletion;var r=i.sortSetting;i.canSort=r.defaultSortBehavior&&!_.isEmpty(r.sortableFields),i.canEdit=this.canEdit(),i.canSpotlight=this.canSpotlight(),i.canSeeData=this.services.drill.canSeeData(this.viewModel.contract)&&!this.services.visibility.isSeeDataMode(this.viewModel.contract.visibility);var o=[],n=this.canSearch().then((function(e){i.canSearch=e}));o.push(n),o.push(this.canCluster().then((function(e){i.canCluster=e.canCluster,i.canSpatialCluster=e.canSpatialCluster}))),this.services.promiseFactory.all(o).then((function(){i.hasMoreOptions=e.options.showMenu&&(i.canExport||i.canDelete||i.canSort||i.canSearch||i.canCluster||i.canSeeData)}))},i.prototype.canEdit=function(){var e=D.getVisualType(this.viewModel.contract),t=this.services.viewModeState.getMode(),i=this.viewModel.editMode,r=this.services.formFactor.getCurrentLayout(),o=0===r&&!this.viewModel.errorInfo&&this.canPopOut();return 1===t&&1!==i&&this.services.visualPluginOps.canEdit(e,o)},i.prototype.canCluster=function(){var t=this,i={canCluster:!1,canSpatialCluster:!1},r=this.viewModel.contract.config.singleVisual,o=this.services.visualPlugin.capabilities(r.visualType);if(!o||!o.grouping||!o.grouping.cluster)return this.services.promiseFactory.resolve(i);var n=o.grouping.cluster,a=this.services.dataSources.get();return this.services.conceptualSchemaProxy.get(a).then((function(o){var a=r.query;if(!a||!a.defn||_.some(a.defn.select(),(function(e){return!C.isExprValidForClustering(e.expr)}))||D.hasGroupByItems(a))return i;var s=_.chain(a.defn.select()).map((function(e){return e.expr.getTargetEntity()})).uniq(),l=s.map((function(e){return e.schema})).uniq().value(),c=s.map((function(e){return o.schema(e.schema).entities.withName(e.entity)})).value(),u=_.every(c,(function(e){return e&&e.capabilities&&e.capabilities.supportsClustering}));if(1!==_.size(l)||!u)return i;for(var p=a.projections,d=D.createRoleKindByQueryRef(r.query),h=0,v=n.conditions;h<v.length;h++){var g=v[h],f=e.DataViewAnalysis.checkForConditionErrors(p,g,d,!1);if(_.isEmpty(f))return i.canCluster=1===t.services.viewModeState.getMode(),i.canSpatialCluster=i.canCluster&&t.services.featureSwitchService.featureSwitches.spatialClusteringEnabled,i}return i}))},i.prototype.updateVisualViewport=function(e,t){var i={width:e.width,height:e.height};this.viewModel.updateVisualViewportForUserResize(i),this.setToolbarVisible(!1)},i.prototype.updateDimensions=function(e,t){var i=this;this.services.undoRedo.register("VisualContainerUpdateDimensions",(function(){var t=i.viewModel,r={x:e.x,y:e.y,z:t.position.z,width:e.width,height:e.height,angle:e.angle,tabOrder:t.position.tabOrder};i.services.lazyScopedSync("layoutAuthoring").moveVisualContainer(i.viewModel,r)}),t),this.setToolbarVisible(!0)},i.prototype.convertTo=function(e){var i=this;this.publishBubbling(p.visualConversion,{visualContainer:this.viewModel.contract,newVisualType:e,actionAfterConversion:function(){t.util.VisualContainerUtils.notifyVisualContainersExceptSource(i.services.eventBridge,i.viewModel.contract),i.visualHostTooltip.hide({immediately:!0,isTouchEvent:!1})}})},i.prototype.getPosition=function(e){var t=e.layouts.withId(this.services.formFactor.getCurrentLayout());return t&&t.position},i.prototype.selectVisualContainer=function(e){f.selectVisualContainer(this.viewModel.contract,this.services.selection,e)},i.prototype.isSelected=function(){return f.isVisualContainerSelected(this.viewModel.contract,this.services.selection)},i.prototype.updateSelection=function(){var e=this.isSelected();e||(this.showSelectionBorder=!1),this.viewModel.setSelected(e),e||this.ensureToolbarHidden(),this.setToolbarVisible(e),this.scope.$emit(o.VisualSelectionOrPositionChangedEventName)},i.prototype.preventInnerScroll=function(){return!this.isSelected()&&this.services.viewModeState.getConfig().touchOptions.touchEventsOnSelectedVisualOnly},i.prototype.clearDataSelection=function(){this.viewModel.contract.config.singleVisual.clearSelectedDataPoints()},i.prototype.onChangeViewMode=function(e){this.updateMenuButtonsState();var t=1===e;this.setToolbarVisible(t),0===e&&this.viewModel.setEditMode(0);var i=this.viewModel.getRunningVisual(),r=i.getAdapter();r&&(this.updateVisualLinkProperties(),r.onViewModeChanged&&r.onViewModeChanged(e))},i.prototype.onChangeEditMode=function(t){var i=this.viewModel;i.setEditMode(t),this.updateMenuButtonsState();var r=i.getVisualType(),o=this.services.visualPlugin.capabilities(r);
o&&2===o.advancedEditModeSupport?this.services.visibility.set(i.contract,1):r!==e.visualHost.EsriVisual&&r!==e.visualHost.SandDanceVisual||(this.services.viewModeState.setMode(2),this.services.viewModeState.updateConfig((function(e){e.alwaysPopulatePanes||(e.alwaysPopulatePanes=!0)})),this.services.visibility.set(i.contract,1))},i.prototype.popOutVisualContainer=function(){var e=this.viewModel;this.services.visibility.set(e.contract,1)},i.prototype.canPopOut=function(){return this.services.visualPluginOps.supportsFocusMode(D.getVisualType(this.viewModel.contract))},i.prototype.resetSortSettings=function(){return __awaiter(this,void 0,e.Promise,(function(){var e,t,i,r,o,n,a,s,l,c,u,p,d;return __generator(this,(function(h){switch(h.label){case 0:return e=this.services.dataSources.get(),e?[4,this.services.conceptualSchemaProxy.get(e)]:[3,5];case 1:return t=h.sent(),[4,M.ensurePlugin(this.viewModel.contract.config.singleVisual.visualType,this.services.visualPlugin,this.services.moduleLoader,this.services.promiseFactory)];case 2:return h.sent(),i=this.viewModel.contract,r=i.config.singleVisual,o=r?this.services.visualPlugin.capabilities(r.visualType):void 0,n=r&&r.query,a=[],n&&o?[4,this.queryHandler.getCachedQueryOrGenerate({contract:i})]:[3,4];case 3:s=h.sent();try{a=this.services.sort.getSortableFields({query:n,schema:t,visualType:r.visualType,columnProperties:r.columnProperties,compiledMappings:void 0===s?[]:s.compiledMappings})}catch(e){return[2]}if(!_.isEmpty(a))for(l=0,c=a;l<c.length;l++)u=c[l],u.active=u.active&&0===u.orderByIndex;h.label=4;case 4:p=!!o&&!!o.sorting&&!!o.sorting.default,this.sortHelper.resetSortSettings(a,p),d=_.findIndex(this.menuOptions.sortSetting.sortableFields,(function(e){return e.active})),d>=0&&(this.viewModel.readOnlyState.actualSortDirection=this.menuOptions.sortSetting.sortableFields[d].sortDirection),this.updateMenuButtonsState(),h.label=5;case 5:return[2]}}))}))},i.prototype.resetVisualStyle=function(){var e=this.services.explorationNavigation.getCurrentExploration();e&&this.viewModel.setThemeCollection(e.themeCollection)},i.prototype.resetPadding=function(){var e=this.viewModel.contract.config.singleVisual,t=this.services.visualPlugin.capabilities(e.visualType);this.viewModel.isPaddingDisabled=t&&t.suppressDefaultPadding},i.prototype.resetBackground=function(){var e=this.viewModel,t=e.objects&&e.objects.background;t&&t.show?e.visualBackground={colorRGB:D.getVisualBackgroundRGBColor(t)}:e.visualBackground=null},i.prototype.resetAspectRatio=function(){var e=this.viewModel,t=e.objects&&e.objects.lockAspect;e.lockAspectRatio=!(!t||!t.show)},i.prototype.resetBorder=function(){var e=this.viewModel,i=e.objects&&e.objects.border,r=t.viewModels.VisualBorder.getDefaultValues(),o={show:i?i.show:r.show,color:i&&i.color||r.color};e.visualBorder=o.show?new t.viewModels.VisualBorder(o):null},i.prototype.resetTitle=function(){var e=this,t=this.viewModel,i=t.contract.config.singleVisual,r=this.services.visualPlugin.capabilities(i.visualType),o=this.services.dataSources.get();this.startProgressBar();var n=t.objects&&t.objects.title;r&&!P.isHidden(n)&&o?this.services.conceptualSchemaProxy.get(o).then((function(o){e.services.displayNameService&&(n=e.services.displayNameService.getVisualTitle(n,i,o,r),t.setVisualTitle(n),t.updateViewState())})).finally((function(){e.stopProgressBar()})):(t.visualTitle=void 0,this.stopProgressBar())},i.prototype.hasMultipleScopeIds=function(e){if(!(e&&e.data&&e.data.length>0))return!1;if(e.data.length>1)return!0;if(!e.data[0])return!1;var t=e.data[0];return!!t.expr&&8===t.expr.kind},i.prototype.canSelect=function(i){var r,o=this,n=e.extensibility.legacy.isOldSelectEventArgs(i);if(r=n?e.extensibility.legacy.getSelectors(i):_.map(i.visualObjects,(function(e){return y.convertSelectorsByColumnToSelector(e.selectorsByColumn)})),r.length>1&&r.some((function(e){return o.hasMultipleScopeIds(e)}))){if(i.visualObjects){var a=this.viewModel.contract.config.singleVisual,s=_.map(i.visualObjects,(function(e){return e.selectorsByColumn})),l=this.services.conceptualSchemaProxy.getLatestCapabilities(this.services.dataSources.get(),void 0);if(l&&l.supportsMultiTableTupleFilters)return!0;if(t.utils.GroupUtils.canGroup(s,a.query))return!0}return!1}return!0},i.prototype.canExpandCollapse=function(e){var t=this.services.conceptualSchemaProxy.getLatestCapabilities(this.services.dataSources.get(),void 0);return this.services.expandCollapse.isSupported(t,this.viewModel.contract,e)},i.prototype.setNodeExpansionState=function(e){var t=this;e.isCollapse?this.services.undoRedo.register("CollapseNode",(function(){return t.services.expandCollapse.collapseNode(t.viewModel.contract,e.dataRoles,e.data)})):this.services.undoRedo.register("ExpandNode",(function(){return t.services.expandCollapse.expandNode(t.viewModel.contract,e.dataRoles,e.data)})),this.reloadDataSegment(e.nodeIndex),this.raiseDrillModeChanged(),this.raiseExpandCollapseAction()},i.prototype.setLevelExpansionState=function(e){var t=this,i=y.convertSelectorsByColumnToSelector(e.data).data;e.isCollapse?this.services.undoRedo.register("CollapseLevel",(function(){return t.services.expandCollapse.collapseLevel(t.viewModel.contract,e.dataRoles,i.length-1)})):this.services.undoRedo.register("ExpandLevel",(function(){return t.services.expandCollapse.expandLevel(t.viewModel.contract,e.dataRoles,i.length-1)})),this.onVisualContainerChangedAsync(!1),this.raiseDrillModeChanged(),this.raiseExpandCollapseAction()},i.prototype.setHierarchyExpansionState=function(e){var t=this;e.isCollapse?this.services.undoRedo.register("CollapseAll",(function(){return t.services.expandCollapse.collapseAll(t.viewModel.contract,e.dataRoles,e.data)})):this.services.undoRedo.register("ExpandAll",(function(){return t.services.expandCollapse.expandAll(t.viewModel.contract,e.dataRoles,e.data)})),this.onVisualContainerChangedAsync(!1),this.raiseDrillModeChanged(),this.raiseExpandCollapseAction()},i.prototype.raiseDrillModeChanged=function(){this.services.eventBridge.publishToChannel(p.drillModeChanged,{visualContainer:this.viewModel.contract})},i.prototype.raiseExpandCollapseAction=function(){this.services.eventBridge.publishToChannel(p.parentExpandCollapseAction,{visualContainer:this.viewModel.contract})},i.prototype.raiseVisualContainerChanged=function(e){this.services.eventBridge.publishToChannel(p.visualContainerChanged,{affectContainer:e(this.viewModel.contract)})},i.prototype.onDragStart=function(e){},i.prototype.shouldRetainSelection=function(){return this.isDrillEnabled()},i.prototype.isDrillEnabled=function(){var e=this.viewModel.contract,t=this.services.drill;if(e&&e.drillMode)return t.isDrillModeEnabled(e,1)||t.isDrillModeEnabled(e,2)||t.isDrillModeEnabled(e,3)},i.prototype.drill=function(e,t,i,r){var o=this.viewModel.contract,n=this.services.dataSources.get();switch(o.drillMode){case 1:this.services.visualAuthoring.drillDown(t,o,n,r);break;case 2:this.services.lazyScopedSync("drillToDetails").drillToDetails(t,o,n);break;case 3:e||this.services.visualContainerMenuFactory.createDrillthroughMenu(o,t,i,this.dataProxyService,this.queryHandler)}},i.prototype.executeVisualLink=function(t){return __awaiter(this,void 0,e.Promise,(function(){var i,r,o,n,s,l,c,u,d,h,v=this;return __generator(this,(function(g){switch(g.label){case 0:return i=V.getType(t),i!==V.Back?[3,1]:(this.services.explorationActivity.doActivity((function(){return v.services.explorationNavigation.back()}),(function(t){return v.services.telemetryService.startActivity(t,e.telemetry.EXNavigateBack)})),[3,6]);case 1:return i!==V.Bookmark?[3,3]:(r=t.bookmark,r?[4,this.services.lazyScoped("bookmark")]:[2]);case 2:return o=g.sent(),o.applyByName(r),[3,6];case 3:return i!==V.Qna?[3,5]:(n=this.services.explorationNavigation.getCurrentExploration(),s=this.services.explorationNavigation.getCurrentSection(),[4,this.services.conceptualSchemaProxy.get(this.services.dataSources.get())]);case 4:return l=g.sent(),c=this.viewModel.contract,u=a.getObjectDefinition(c.config.singleVisual.vcObjects,"visualLink",void 0),d=this.services.filterGenerator.calculateVisualContainerFilter(n,s,c,l,!0),h=d&&d.dataFiltersUnmerged,this.services.eventBridge.publishToChannel(p.showQnaPopout,{visualLink:u,sourceFilters:_.map(h,(function(e){return e.filter}))}),[3,6];case 5:g.label=6;case 6:return[2]}}))}))},i.prototype.onSelecting=function(t){var i=this.getVisualLink();if(i&&i.show){var r=this.services.viewModeState.getMode();if(!this.services.explorationCapabilities.getCapabilities().allowVisualLinks)return;return void((0===r||1===r&&t.isCtrlOrMetaKey)&&(t.action=1,this.executeVisualLink(i)))}if(this.isDrillEnabled()){this.visualHostTooltip.hide({immediately:!0,isTouchEvent:!1});var o=void 0,n=e.extensibility.legacy.isOldSelectEventArgs(t);if(o=n?e.extensibility.legacy.getSelectorsByColumn(t):_.map(t.visualObjects,(function(e){return e.selectorsByColumn})),!_.isEmpty(o)){var a=_.isEmpty(t.dataRoles)?void 0:_.head(t.dataRoles);return this.drill(n,o,t.position,a),void(t.action=1)}}t.action=0},i.prototype.onSelect=function(e){this.bufferOnSelect(e)||this.applySelect(e)},i.prototype.applySelect=function(t){var i,r=this,o=e.extensibility.legacy.isOldSelectEventArgs(t);i=o?e.extensibility.legacy.getSelectorsByColumn(t):_.map(t.visualObjects,(function(e){return e.selectorsByColumn})),!_.isEmpty(i)&&this.isDrillEnabled()?(this.visualHostTooltip.hide({immediately:!0,isTouchEvent:!1}),this.drill(!0,i,void 0)):this.services.explorationActivity.doActivity((function(){var n;n=o?e.extensibility.legacy.getSelectors(t):_.map(i,(function(e){return y.convertSelectorsByColumnToSelector(e)}));var a=_.size(t.visualObjects)!==_.size(r.selectedDatapoints)||_.some(t.visualObjects,(function(e,t){return!y.equalsSelectorsByColumn(e.selectorsByColumn,r.selectedDatapoints[t])}));r.selectedDatapoints=t.visualObjects?_.map(t.visualObjects,(function(e){return e.selectorsByColumn})):void 0;var s;try{s=r.getDataViewDataPointDescription(n)}catch(e){}r.viewModel.hostServices.selectDataPoint(r.services.filterGenerator,i,t.multiSelect,s),a&&(r.selectedDatapoints=t.visualObjects?_.map(t.visualObjects,(function(e){return e.selectorsByColumn})):void 0,r.viewModel.hostServices.selectDataPoint(r.services.filterGenerator,i,t.multiSelect,s),r.raiseDataPointsSelectedEvent(n))}),(function(t){return r.services.telemetryService.startActivity(t,e.telemetry.EXSelectDataPoint)}))},i.prototype.getDataViewDataPointDescription=function(e){if(!_.isEmpty(e)&&this.viewModel.contract.config&&this.viewModel.contract.config.singleVisual&&this.viewModel.getRunningVisual()&&!_.isEmpty(this.viewModel.getRunningVisual().getDataViews())){var t=this.viewModel.getRunningVisual().getDataViews()[0],i=this.viewModel.contract.config.singleVisual;return d.getSelectorsMetadata(e,i,t)}},i.prototype.raiseDataPointsSelectedEvent=function(e){for(var t=[],i=0,r=e;i<r.length;i++){var o=r[i],n=this.visualContainerDataSelectionService.getSelectedValues(o);t.push({selector:o,values:n})}var a={dataPointsDescriptions:t,visualContainer:this.viewModel.contract,visualTitleText:this.viewModel.visualTitle?this.viewModel.visualTitle.text:null};this.services.eventBridge.publishToChannel(p.dataPointsSelected,a)},i.prototype.startProgressEvent=function(){this.progressTransitionEvent&&this.progressTransitionEvent.resolve(),this.progressTransitionEvent=this.services.telemetryService.startActivity(this.scope,e.telemetry.EXRenderExplorationVisual,this.viewModel.contract&&this.viewModel.contract.config&&this.viewModel.contract.config.singleVisual&&this.viewModel.contract.config.singleVisual.visualType),this.services.eventBridge.publishToChannel(p.visualContainerLoadingStarted,this.viewModel.contract.name)},i.prototype.endProgressEvent=function(){this.progressTransitionEvent&&(this.progressTransitionEvent.resolve(),this.progressTransitionEvent=null),this.services.eventBridge.publishToChannel(p.visualContainerLoadingStopped,this.viewModel.contract.name)},i.prototype.startDetailVisualProgressBar=function(){1===++this.detailVisualProgressBarCount&&this.updateProgressBarState()},i.prototype.stopDetailVisualProgressBar=function(){--this.detailVisualProgressBarCount<=0&&this.updateProgressBarState()},i.prototype.clearDetailVisualProgressBar=function(){this.detailVisualProgressBarCount=0,this.updateProgressBarState()},i.prototype.startProgressBar=function(){1===++this.progressBarCount&&this.updateProgressBarState()},i.prototype.stopProgressBar=function(){--this.progressBarCount<=0&&this.updateProgressBarState()},i.prototype.updateProgressBarState=function(){var e=this,t=this.lastProgressBarState,i={progressBarCount:this.progressBarCount,detailVisualProgressBarCount:this.detailVisualProgressBarCount,hasPendingGeocoding:this.geocodingTracker&&this.geocodingTracker.hasPendingGeocoding()},r=t.progressBarCount>0||t.detailVisualProgressBarCount>0,o=i.progressBarCount>0||i.detailVisualProgressBarCount>0,n=r||t.hasPendingGeocoding,a=o||i.hasPendingGeocoding;a!==n&&(a?this.services.lazyScoped("loadProgressNotification").then((function(e){e.beginLoad()})):this.endLoadDefer.promise.finally((function(){e.services.lazyScoped("loadProgressNotification").then((function(e){e.endLoad()}))})),this.viewModel.showProgressBar=a),o!==r&&(o?this.startProgressEvent():this.endProgressEvent()),this.lastProgressBarState=i},i.prototype.updateDisablePin=function(){this.disablePin=this.viewModel.options.disablePin||this.shouldBlockPinButtonForScriptVisual()},i.prototype.shouldBlockPinButtonForScriptVisual=function(){var t=this.viewModel.contract,i=this.services.explorationNavigation.getCurrentExploration(),r=i&&i.reportId,o=D.getVisualType(t),n=e.explore.util.ScriptVisualsUtil.getScriptVisualType(o);return this.services.viewModeState.getConfig().supportsPinning&&this.services.scriptVisuals.shouldBlockScriptVisual(n,r)},i.prototype.evaluateObjectDefinitions=function(){var e=this.viewModel;e.objects=D.evaluateObjectDefinitions(this.services.explorationNavigation.getCurrentExploration().themeCollection,this.services.themeService,e.contract)},i.prototype.applyUpdate=function(t,i,r,o){var n=this;this.applyUpdateActivity.start((function(){return n.services.telemetryService.startActivity(n.scope,e.telemetry.EXVisualContainerApplyUpdate)}));try{var a=this.viewModel,s=a.contract,l=a.getRunningVisual();this.evaluateObjectDefinitions(),this.queryHandler.runQuery({contract:s,viewport:l.getViewport(),initialLoad:t,useVisualContainerCache:a.shouldUseCache(),preferCurrentData:i,allowCache:r,cacheResponseOnServer:o,currentData:l.getData(),geocodingTracker:this.geocodingTracker})||this.applyUpdateActivity.resolve();var c=this.services.visualPlugin.getPlugin(a.getVisualType());c&&c.isDeprecated?this.errorManager.showDeprecationWarning():this.errorManager.clearDeprecationWarning()}catch(e){throw this.applyUpdateActivity.reject({errorCode:"Exception",errorMessage:e&&e.name}),e}},i.prototype.loadMergedData=function(t){var i=this.viewModel.getRunningVisual();i&&i.setData(t,this.services.telemetryService.startActivity(this.scope,e.telemetry.EXVisualDataChanged))},i.prototype.handleQueryResult=function(t,i,r){try{var o=this.viewModel.getRunningVisual();if(!o)return;r&&(i=e.Prototype.inherit(i),i.objects=r),o.setDataTransforms(i),o.setData(t,this.services.telemetryService.startActivity(this.scope,e.telemetry.EXVisualDataChanged))}finally{this.applyUpdateActivity.resolve()}var n=this.viewModel;n&&n.contract&&n.contract.cachedData&&n.contract.cachedData.dataUpdatedTime&&(n.lastUpdateAttemptTime=(new Date).toLocaleString())},i.prototype.handleQueryErrors=function(t){var i=t&&t.source?t.source:void 0;if(this.applyUpdateActivity.reject({errorCode:"Error",errorSource:i}),t||(t=new A),!t.ignorable||t.ignorable!==!0){var r,n,a=this.viewModel.getRunningVisual();if(t instanceof e.DsrClientError){var s=t,l=s.powerBiErrorDetails,c=s.AdditionalErrorMessages;if(l)try{var u=JSON.parse(l);n={error:u.error,showNotification:!0}}catch(e){}if(c)for(var p=0,d=c.length;p<d;p++){var h=c[p];if(h.Code&&h.Message){var g=h.Code,f=h.Message;if(g===o.serverErrors.onPremiseServiceException)try{var u=JSON.parse(f);n={error:u.error,showNotification:!0}}catch(e){}}}}var y=t.getDetails(e.common.localize);if(r){y.displayableErrorInfo.length>0&&(y.displayableErrorInfo[0].errorInfoValue=e.common.localize.get(e.ServiceErrorHelper.serverErrorPrefix+r.code)),y.displayableErrorInfo.push({errorInfoKey:e.common.localize.get("AdditionalErrorInfo_ErrorText"),errorInfoValue:r.code});v.PowerBIServiceExceptionErrorHelper.generateErrorMessage(r).always((function(e){if(e&&e.displayableErrorInfo)for(var t=0,i=e.displayableErrorInfo;t<i.length;t++){var r=i[t];y.displayableErrorInfo.push(r)}}))}if(D.isScriptVisual(this.viewModel.contract,this.services.visualPlugin)){var m=D.getVisualType(this.viewModel.contract),S=e.explore.util.ScriptVisualsUtil.getScriptVisualType(m);y=this.services.scriptVisuals.overrideEmbeddedErrorDetails(S,y)||y}this.publishVisualErrorEvent(y,t.code,t.requestId,this.viewModel.visualTitle&&this.viewModel.visualTitle.text,n),this.errorManager.showErrorOverlay(y,t.code,t.requestId,t.source),a&&a.setData(null)}},i.prototype.publishVisualErrorEvent=function(t,i,r,o,n){var a,s;if(t.debugErrorInfo)for(var l=0,c=t.debugErrorInfo;l<c.length;l++){var u=c[l];u.errorInfoKey===e.ClientErrorStrings.ErrorCode?a=u.errorInfoValue:u.errorInfoKey===e.ClientErrorStrings.ErrorDetails&&(s=u.errorInfoValue)}var d={code:n&&n.error.code||a||i,message:n&&n.error.message||s||t.message,details:[r],target:o,"pbi.error":n&&n.error["pbi.error"]},h={error:d,showNotification:n&&n.showNotification};this.publishBubbling(p.reportVisualError,h)},i.prototype.handleWarnings=function(t,i){if(!_.isEmpty(t))for(var r=_.some(t,(function(t){return t instanceof e.data.dsr.DsrLimitsWarning})),o=0,n=t;o<n.length;o++){var a=n[o];a.columnNameFromIndex=function(e){var t=i.selects;return t.length<=e?null:t[e].displayName};var s=a.getDetails(e.common.localize);a instanceof e.data.dsr.DsrLimitsWarning?this.errorManager.showInfoIcon(s,a.code):a instanceof u&&a.isTransformMessage()?this.errorManager.showTransformWarningIcon(s,a.code,r):this.errorManager.showWarningIcon(s,a.code)}},i.prototype.getNextDataSegment=function(){var e=this.viewModel,t=e.contract,i=e.getRunningVisual();return this.queryHandler.getNextDataSegment({contract:t,viewport:i&&i.getViewport(),useVisualContainerCache:e.shouldUseCache()})},i.prototype.loadMoreData=function(){var e=this.viewModel,t=e.contract,i=e.getRunningVisual();this.queryHandler.loadMoreData({contract:t,currentData:i&&i.getData(),useVisualContainerCache:e.shouldUseCache(),viewport:i&&i.getViewport()})},i.prototype.reloadDataSegment=function(e){var t=this.viewModel,i=t.contract,r=t.getRunningVisual();this.queryHandler.reloadDataSegment({contract:i,currentData:r&&r.getData(),useVisualContainerCache:t.shouldUseCache(),viewport:r&&r.getViewport()},e)},i.prototype.persistProperties=function(e,t){var i=this.bufferPropertyChanges(_.isArray(e)?{replace:e}:e);i&&this.applyPropertyChanges(i,t)},i.prototype.applyPropertyChanges=function(t,i){var r=this,o=function(){var e=r.viewModel;r.services.visualAuthoring.persistProperties(t,e.contract,i===!0)&&(r.applyUpdate(void 0,!0),r.updateVisualContainerProperties(),r.updateVisualContainerThemeableProperties())};this.isFilterChange(t)?this.services.explorationActivity.doActivity(o,(function(t){return r.services.telemetryService.startActivity(t,e.telemetry.EXApplySlicer)})):o()},i.prototype.isFilterChange=function(e){function t(e){return!!_.find(e,(function(e){return!e.selector&&e.objectName===o.objectName&&e.properties&&null!=e.properties[o.propertyName]}))}function i(e){return e&&(t(e.merge)||t(e.replace)||t(e.remove))}if(!e)return!1;var r=this.getVisualCapabilities(),o=s.findFilterOutput(r.objects);return!!o&&(_.isArray(e)?!!_.find(e,(function(e){return i(e)})):i(e))},i.prototype.applyJsonFilter=function(t,i,r,o){return void 0===o&&(o=0),__awaiter(this,void 0,e.Promise,(function(){var e,n,a,s,l,c,u;return __generator(this,(function(p){switch(p.label){case 0:return e=this.services.dataSources.get(),[4,this.services.moduleLoader.require({javascript:"JSONFilter/services/jsonFilterParser"})];case 1:return n=p.sent(),[4,n.create(this.services.promiseFactory,this.services.moduleLoader)];case 2:return a=p.sent(),[4,this.services.conceptualSchemaProxy.get(e)];case 3:return s=p.sent(),[4,a.tryConvertJsonFilterArrayToSemanticFilter(t,s)];case 4:return l=p.sent(),c={},c[r]=l,u={},u=0===o?{merge:[{objectName:i,properties:c,selector:void 0}]}:{remove:[{objectName:i,properties:c,selector:void 0}]},this.persistProperties(u),this.raiseVisualContainerChanged(D.contractUnEqualityComparator),[2]}}))}))},i.prototype.getJSONFilter=function(t){return __awaiter(this,void 0,e.Promise,(function(){var e,i,r,o;return __generator(this,(function(n){switch(n.label){case 0:return t?(e=this.services.dataSources.get(),[4,this.services.moduleLoader.require({javascript:"JSONFilter/services/jsonFilterParser"})]):[2];case 1:return i=n.sent(),[4,i.create(this.services.promiseFactory,this.services.moduleLoader)];case 2:return r=n.sent(),[4,this.services.conceptualSchemaProxy.get(e)];case 3:return o=n.sent(),[4,r.tryCreateJSONFilter(t,o)];case 4:return[2,n.sent()]}}))}))},i.prototype.onCustomSort=function(e){this.sortHelper.applySortByFields(e),this.services.overlayService.hideAllDropdowns()},i.prototype.updateDetailVisualVisibility=function(){var e=this.viewModel.contract;this.services.visibility.isSeeDataMode(e.visibility)&&!this.services.drill.canSeeData(e)&&this.setPopOutMode(1)},i.prototype.setPopOutMode=function(e){0===e?this.services.visibility.clear():this.services.visibility.set(this.viewModel.contract,e)},i.prototype.isHeaderVisible=function(){var e=this.services;if(!e.formFactor.getCurrentLayoutCapabilities().canShowVisualContainerHeader())return!1;var t=e.viewModeState.getConfig(),i=t.displayOptions,r=this.viewModel;if(i.hideInFocusTileMenu&&r.isPoppedOut||i.hideTileMenu||r.options.hideHeader)return!1;if(0===this.services.viewModeState.getMode()){var o=r.objects&&r.objects.visualHeader;if((o&&o.show)===!1)return!1}var n=f.getSelectedVisual(this.services.selection),a=t.showRelationships&&n&&e.visualRelationship.supportsAnyFilterAction(n);return this.isSelected()||this.isHovering||a},i.prototype.canRemoveFromLayout=function(){return this.services.formFactor.getCurrentLayoutCapabilities().canRemoveVisualFromLayout()&&!this.isHeaderVisible()},i.prototype.removeVisualFromLayout=function(){this.publishBubbling(p.removeVisualContainerFromLayout,this.viewModel.contract)},i.prototype.isPopOutBarVisible=function(){return this.viewModel.isPoppedOut&&!this.services.viewModeState.getConfig().displayOptions.hideInFocusBar},i.prototype.isVisualHidden=function(){return this.viewModel&&this.services.visibility.isSeeDataMode(this.viewModel.contract.visibility)&&this.services.viewModeState.getConfig().displayOptions.showDetailVisualOnFullScreen},i.prototype.onHeaderDestroy=function(){this.viewModel.titleWidthReduction&&(this.viewModel.titleWidthReduction=void 0,this.viewModel.updateViewState())},i.prototype.onHeaderResize=function(e,t){var i;2===this.getVisualHeaderPlacement(this.viewModel)&&(i=e),this.viewModel.titleWidthReduction!==i&&(this.viewModel.titleWidthReduction=i,this.viewModel.updateViewState())},i.prototype.shouldRestrictTransformDraw=function(){return this.services.formFactor.getCurrentLayoutCapabilities().canShowVisualContainerHeaderInset()},i.prototype.isEditable=function(){return 1===this.services.viewModeState.getMode()},i.prototype.isInViewMode=function(){return 0===this.services.viewModeState.getMode()},i.prototype.canExport=function(){var e=!1,t=!1,i=!!this.services.viewModeState.getConfig().supportsExportData,r=this.viewModel;if(null!=r){t=r.showWatermark;var o=r.contract&&r.contract.config,n=o&&o.singleVisual&&o.singleVisual.visualType;jsCommon.StringExtensions.isNullOrUndefinedOrWhiteSpaceString(n)||(e=this.services.visualPluginOps.isQueryVisual(n))}return i&&e&&!t},i.prototype.canSearch=function(){var e=this,t=this.viewModel;if(t){var i=D.getVisualType(t.contract);if(this.services.visualPluginOps.supportVisualSearch(i)){var r=this.services.dataSources.get();if(r)return this.services.conceptualSchemaProxy.get(r).then((function(i){return!!D.containSearchableField(t.contract,e.services.visualPlugin,i)}))}}return this.services.promiseFactory.resolve()},i.prototype.refreshHostData=function(){var t=D.getVisualType(this.viewModel.contract);this.services.telemetryService.logEvent(e.telemetry.EXRefreshHostData,t),this.publishBubbling(p.refreshExploration)},i.prototype.subscribeToBubbling=function(e,t){return this.services.eventBridge.subscribeToBubbling(this.scope,e,t)},i.prototype.publishBubbling=function(e,t){this.services.eventBridge.publishBubbling(this.scope,e,t)},i.prototype.isLockObjects=function(){return this.services.viewModeState.getViewState().lockObjects},i.prototype.slowDataApplyEnabled=function(){if(!this.services.featureSwitchService.featureSwitches.slowDataSourceModeEnabled)return!1;var e=this.services.explorationNavigation.getCurrentExploration();return!!(e&&e.slowDataSourceSettings&&e.slowDataSourceSettings.isSlicerSelectionsButtonEnabled)},i.prototype.isFilterVisual=function(){var e=this.viewModel,t=e&&e.readOnlyState;return t&&t.isFilterVisual},i.prototype.isFooterVisible=function(){return this.isApplyButtonVisible()},i.prototype.isApplyButtonVisible=function(){return this.slowDataApplyEnabled()&&this.isFilterVisual()},i.prototype.isApplyButtonEnabled=function(){return!_.isEmpty(this.bufferedFilterChanges)},i.prototype.onApplyButtonClicked=function(){this.applyBufferedPropertyChanges()},i.prototype.applyBufferedPropertyChanges=function(){var e=this.bufferedFilterChanges,t=this.bufferedFilterSelect;this.bufferedFilterChanges=void 0,this.bufferedFilterSelect=void 0,null!=e&&this.applyPropertyChanges(e,!1),null!=t&&this.applySelect(t)},i.prototype.bufferOnSelect=function(e){return!(!this.slowDataApplyEnabled()||!this.isFilterVisual())&&(this.bufferedFilterSelect=e,!0)},i.prototype.bufferPropertyChanges=function(e){if(!this.slowDataApplyEnabled()||!this.isFilterVisual())return e;null==this.bufferedFilterChanges&&(this.bufferedFilterChanges=[]),this.bufferedFilterChanges.push(e);var t=this.viewModel.contract.config.singleVisual,i=t.objects;i=i?a.clone(i):{};var r=S.getSlicerModeDefinition(i),o=this.getVisualCapabilities(),n=s.findSelfFilter(o.objects),l=n&&a.getValue(i,n,void 0),c=new T;if(!this.applyBufferedPropertyChangesToObjects(i,c.toCallback())&&1===this.bufferedFilterChanges.length)return this.bufferedFilterChanges=void 0,e;var u=c.getChanges(),p=!u;if(this.bufferedFilterChanges=[u||{}],!p&&"slicer"===t.visualType)if(r){var d=S.getSlicerModeDefinition(i);w.equals(r,d)||(p=!0)}else{var h=s.findFilterOutput(o.objects),v=h&&a.getValue(i,h,void 0);v||(p=!0)}if(!p&&n){var g=a.getValue(i,n,void 0);(l?g&&m.isSameFilter(l,g):!g)||(p=!0)}return p?void this.applyBufferedPropertyChanges():void this.applyUpdate(void 0,!0)},i.prototype.applyBufferedPropertyChangesToObjects=function(e,i){var r=!1;if(null!=this.bufferedFilterChanges)for(var o=0,n=this.bufferedFilterChanges;o<n.length;o++){var a=n[o];t.services.applyPropertyChanges(a,this.getVisualCapabilities().objects,e,i)&&(r=!0)}return r},i})();i.VisualContainerController=E;var T=(function(){function e(){this.propertyChanges={}}return e.prototype.getChanges=function(){var e,t=function(t){for(var r=function(i){var r=i.selector;for(var o in i.properties){var n=i.properties[o];if(n.oldDef!==n.newDef&&!a.propertiesAreEqual(n.oldDef,n.newDef))if(e||(e={}),n.newDef){e.merge||(e.merge=[]);var s=_.find(e.merge,(function(e){return e.objectName===t&&y.equals(e.selector,r)}));s||e.merge.push(s={objectName:t,selector:r,properties:{}}),s.properties[o]=n.newValue}else{e.remove||(e.remove=[]);var l=_.find(e.remove,(function(e){return e.objectName===t&&y.equals(e.selector,r)}));l||e.remove.push(l={objectName:t,selector:r,properties:{}}),l.properties[o]=void 0}}},o=0,n=i.propertyChanges[t];o<n.length;o++){r(n[o])}},i=this;for(var r in this.propertyChanges)t(r);return e},e.prototype.toCallback=function(){var e=this;return function(t,i,r,o,n,a){var s=e.propertyChanges[t];s||(s=e.propertyChanges[t]=[]);var l=_.find(s,(function(e){return y.equals(e.selector,i)}));l||s.push(l={selector:i,properties:{}});var c=l.properties[r];c?(c.newDef=n,c.newValue=a):c=l.properties[r]={oldDef:o,newDef:n,newValue:a}}},e})(),A=(function(e){function t(){return e.call(this,"VisualDataProxyExecutionUnknownError")||this}return __extends(t,e),t})(e.UnknownClientError),I=(function(){function e(e,t){this.visualContainerId=e,this.action=t}return e.prototype.equals=function(e){return!!e&&this.action===e.action&&this.visualContainerId===e.visualContainerId},e})()})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){t.VisualContainer={bindings:{viewModel:"<",canvasLayout:"<",transformParent:"<"},controller:e.common.createController(t.VisualContainerController),controllerAs:"$ctrl",templateUrl:"components/visualContainer/visualContainer.html"}})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i=(function(){function t(e,t,i,r){void 0===r&&(r=!1),this.localizationService=e,this.explorationCapabilities=t,this.dropdown=i,this.showIcons=r,this.allCommands=[]}return t.prototype.create=function(t,i,r){return __awaiter(this,void 0,e.Promise,(function(){var e,o,n;return __generator(this,(function(a){switch(a.label){case 0:return e=this,[4,this.createItems(t)];case 1:return e.menuItems=a.sent(),o=this.explorationCapabilities.getCapabilities(),n=o&&o.shouldUseMenuScrollbars,this.dropdown.showContextMenu(this.menuItems,i,this.select.bind(this),!1,void 0,n,!0,r),[2]}}))}))},t.prototype.getItems=function(){return this.menuItems},t.prototype.createItems=function(t){return __awaiter(this,void 0,e.Promise,(function(){var e,i;return __generator(this,(function(r){switch(r.label){case 0:return e=[],[4,this.createMenuItemsFromCommands(t,e)];case 1:return i=r.sent(),_.isEmpty(i)?[2,this.createNoAvailableActionsMenu(this.localizationService)]:(this.allCommands=e,[2,{items:i}])}}))}))},t.prototype.select=function(t){return __awaiter(this,void 0,e.Promise,(function(){var e;return __generator(this,(function(i){switch(i.label){case 0:return e=this.allCommands[t],[4,e.execute()];case 1:return i.sent(),[2]}}))}))},t.prototype.createNoAvailableActionsMenu=function(e){var t=[],i=e.get("VisualContainer_ContextMenu_NoAvailableActions"),r=this.createMenuItem(null,i,null);return r.disabled=!0,t.push(r),{items:t}},t.prototype.createMenuItemsFromCommands=function(t,i){return void 0===i&&(i=[]),__awaiter(this,void 0,e.Promise,(function(){var e,r,o,n,a,s,l,c,u,p;return __generator(this,(function(d){switch(d.label){case 0:if(_.isEmpty(t))return[2];e=[],r=0,o=t,d.label=1;case 1:return r<o.length?(n=o[r],[4,n.isVisible()]):[3,11];case 2:return d.sent()?(a=void 0,s=void 0,n.getToolTip?[4,n.getToolTip(this.localizationService)]:[3,4]):[3,10];case 3:s=d.sent(),d.label=4;case 4:return c=n.isDisabled,c?[4,n.isDisabled()]:[3,6];case 5:c=d.sent(),d.label=6;case 6:return l=c,l?[3,9]:[4,n.getChildren()];case 7:return u=d.sent(),[4,this.createMenuItemsFromCommands(u,i)];case 8:a=d.sent(),d.label=9;case 9:i.push(n),p=this.createMenuItem(i.length-1,n.title(this.localizationService),l,a,n.glyph,n.selected,n.customIcon,s),e.push(p),d.label=10;case 10:return r++,[3,1];case 11:return[2,e]}}))}))},t.prototype.createMenuItem=function(e,t,i,r,o,n,a,s){return{key:e,text:t,type:0,children:r,icon:o,selected:n,customIcon:a,showIcon:this.showIcons,disabled:i,tooltip:s}},t})();t.VisualContainerContextMenu=i})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=e.common.ArrowVerticalPosition,o=t.services.events,n=(function(){function t(e,t){this.services=t}return Object.defineProperty(t.prototype,"activeRoleName",{
get:function(){return this.activeRole.name},set:function(e){var t=_.find(this.drillableRoles,(function(t){return t.name===e}));t&&(this.activeRole=t)},enumerable:!0,configurable:!0}),t.createOptions=function(){return{additionalServices:["localizationService"],scopedDependencies:["drill","eventBridge","visualAuthoring","visualPlugin"]}},t.prototype.$onInit=function(){var e=this;this.subscriptionManager=this.services.eventBridge.createChannelSubscriptionManager().subscribe(o.visualContainerChanged,(function(t,i){e.updateDrillableRoles(),e.updateDrillMode(i)})).subscribe(o.drillModeChanged,(function(t,i){e.updateDrillModeCore()})),this.updateDrillableRoles(),this.updateDrillModeCore()},t.prototype.$onDestroy=function(){this.subscriptionManager.unsubscribeAll()},t.prototype.drillUp=function(){this.services.visualAuthoring.drillUp(this.getActiveRoleName(),this.visual.contract)},t.prototype.drillDownLevel=function(){this.services.visualAuthoring.drillDownLevel(this.getActiveRoleName(),this.visual.contract,3)},t.prototype.drillDownLevelGrouped=function(){this.services.visualAuthoring.drillDownLevel(this.getActiveRoleName(),this.visual.contract,2)},t.prototype.canDrill=function(){return this.canDrillDownWithCurrentGroup||this.canDrillDownWithoutCurrentGroup||this.canDrillUp},t.prototype.canDrillOnMoreThanOneRole=function(){return this.drillableRoles.length>1},t.prototype.onRoleChanged=function(){this.updateDrillModeCore()},t.prototype.drillUpTitle=function(){return this.services.localizationService.get("DrillUp_ToolTip")},t.prototype.drillUpTooltipConfig=function(){return{tooltipArrowVerticalPosition:r.bottom,tooltipTitle:this.drillUpTitle(),tooltipShowOnFocus:!0}},t.prototype.drillLevelTitle=function(){return this.canDrillDownWithCurrentGroup||this.canDrillDownWithoutCurrentGroup?this.services.localizationService.get("DrillDownLevel_ToolTip"):this.services.localizationService.get("DrillDownLevelDisabled_ToolTip")},t.prototype.drillLevelTooltipConfig=function(){return{tooltipArrowVerticalPosition:r.bottom,tooltipTitle:this.drillLevelTitle(),tooltipShowOnFocus:!0}},t.prototype.drillLevelGroupedTitle=function(){return this.canDrillDownWithCurrentGroup||this.canDrillDownWithoutCurrentGroup?this.services.localizationService.get("DrillDownLevelGrouped_ToolTip"):this.services.localizationService.get("DrillDownLevelDisabled_ToolTip")},t.prototype.drillLevelGroupedTooltipConfig=function(){return{tooltipArrowVerticalPosition:r.bottom,tooltipTitle:this.drillLevelGroupedTitle(),tooltipShowOnFocus:!0}},t.prototype.updateDrillMode=function(e){e&&e.affectContainer(this.visual.contract)&&this.updateDrillModeCore()},t.prototype.updateDrillableRoles=function(){this.drillableRoles=[];var t=this.services.visualPlugin.capabilities(this.visual.contract.config.singleVisual.visualType);if(t)for(var i=e.explore.util.DrillUtils.getDrillableRoles(t),r=0,o=i;r<o.length;r++){var n=o[r];(this.canDrillDownWithCurrentGroupOnRole(n)||this.canDrillDownWithoutCurrentGroupOnRole(n)||this.canDrillUpOnRole(n))&&this.drillableRoles.push({name:n,value:this.services.localizationService.get("Drill_Role_"+n)})}if(_.isEmpty(this.drillableRoles))this.activeRole=void 0;else{var a=this.getActiveRoleName();_.find(this.drillableRoles,(function(e){return a===e.name}))||(this.activeRole=this.drillableRoles[0])}},t.prototype.canDrillDownWithCurrentGroupOnRole=function(e){return this.services.drill.canDrillByDirection(this.visual.contract,2,e)},t.prototype.canDrillDownWithoutCurrentGroupOnRole=function(e){return this.services.drill.canDrillByDirection(this.visual.contract,4,e)},t.prototype.canDrillUpOnRole=function(e){return this.services.drill.canDrillByDirection(this.visual.contract,1,e)},t.prototype.getActiveRoleName=function(){return this.activeRole?this.activeRole.name:null},t.prototype.updateDrillModeCore=function(){var e=this.getActiveRoleName();this.canDrillDownWithCurrentGroup=this.canDrillDownWithCurrentGroupOnRole(e),this.canDrillDownWithoutCurrentGroup=this.canDrillDownWithoutCurrentGroupOnRole(e),this.canDrillUp=this.canDrillUpOnRole(e)},t})();i.VisualContainerDrillController=n})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){i.VisualContainerDrill={templateUrl:"components/visualContainerDrill/visualContainerDrill.html",bindings:{visual:"<"},controller:e.common.createController(t.controllers.VisualContainerDrillController)}})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){function r(e,t,i){switch(e){case 1:return t.canDrillByDirection(i,2)||t.canDrillByDirection(i,4)||t.canDrillByDirection(i,1);case 3:return t.canDrillthrough(i);case 2:return t.canDrillToDetails(i);case 0:return!0;default:return!1}}var o=e.common.ArrowVerticalPosition,n=t.services.events,a=(function(){function e(e,t){this.services=t}return e.createOptions=function(){return{additionalServices:["localizationService"],scopedDependencies:["drill","eventBridge","visualAuthoring"]}},e.prototype.$onInit=function(){var e=this;this.updateDrillState(),this.subscriptionManager=this.services.eventBridge.createChannelSubscriptionManager().subscribe(n.visualContainerChanged,(function(t,i){i&&i.affectContainer(e.visual.contract)&&e.updateDrillState()})).subscribe(n.drillModeChanged,(function(t,i){e.updateDrillState()}))},e.prototype.$onDestroy=function(){this.subscriptionManager.unsubscribeAll()},e.prototype.toggleDrillDown=function(){this.isDrillDownEnabled=this.isDrillDownEnabled===!1,this.services.drill.setDrillMode(this.visual.contract,this.isDrillDownEnabled?1:0)},e.prototype.updateDrillState=function(){if(!this.visual)return this.canDrillDown=!1,void(this.isDrillDownEnabled=!1);var e=this.visual.contract,t=this.services.drill;this.canDrillDown=r(1,t,e);var i=e.drillMode,o=!1;1!==i||this.canDrillDown?null==i||0===i||r(i,t,e)||(o=!0):o=!0,o&&this.services.drill.setDrillMode(e,0),this.isDrillDownEnabled=t.isDrillModeEnabled(e,1),this.title=1===this.visual.contract.drillMode?this.services.localizationService.get("DrillMode_ToolTip"):this.services.localizationService.get("DrillDown_ToolTip")},e.prototype.tooltipConfig=function(){return{tooltipArrowVerticalPosition:o.bottom,tooltipTitle:this.title,tooltipShowOnFocus:!0}},e})();i.VisualContainerDrillToggleController=a})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){i.VisualContainerDrillToggle={templateUrl:"components/visualContainerDrillToggle/visualContainerDrillToggle.html",bindings:{visual:"<"},controller:e.common.createController(t.controllers.VisualContainerDrillToggleController)}})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i=e.explore.util.VisualContainerUtils,r=(function(){function t(e,t){this.services=t}return t.createOptions=function(){return{additionalServices:["dropdown","localizationService","$element"],scopedDependencies:["visualPluginOps"]}},t.prototype.$onInit=function(){var e=this;this.services.localizationService.ensureLocalization((function(){e.ariaLabel=e.services.localizationService.get("FilterRestatementVisual_Button_Label")}))},t.prototype.showButton=function(){var e=this.visual.isHeaderItemVisible("filterRestatementButton"),t=i.getVisualType(this.visual.contract),r=this.services.visualPluginOps.isQueryVisual(t);return e&&r},t.prototype.handleMouseClick=function(e){this.showRestatement(e,!1),this.currentDropdown=null},t.prototype.handleMouseEnter=function(e){this.showRestatement(e,!0)},t.prototype.handleMouseLeave=function(e){null!=this.currentDropdown&&(this.services.dropdown.hide(this.currentDropdown),this.currentDropdown=null)},t.prototype.showRestatement=function(t,i){var r={visual:this.visual.contract,isHover:i};this.currentDropdown=this.services.dropdown.showMenu(r,"visualContainerFilterRestatementOverlay.html",{anchorElement:$(t.target),showInsideVisibleArea:!0,hideExistingOverlays:!0},this.services.$element.inheritedData(e.common.angularInjectorController))},t})();t.VisualContainerFilterRestatementButtonController=r})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){i.VisualContainerFilterRestatementButton={templateUrl:"components/visualContainerFilterRestatementButton/visualContainerFilterRestatementButton.html",bindings:{visual:"<"},controller:e.common.createController(t.controllers.VisualContainerFilterRestatementButtonController)}})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=e.common.ArrowVerticalPosition,o=e.explore.services.events,n=t.services.selectionUtils,a=e.explore.util.VisualContainerUtils,s=(function(){function t(e,t){var i=this;this.services=t,this.focusModeTitle=this.services.localizationService.get("FocusModeVisual_ToolTip"),this.focusModeTooltipConfig={tooltipArrowVerticalPosition:r.bottom,tooltipTitle:this.focusModeTitle,tooltipShowOnFocus:!0},this.menuId=e.$id.toString(),this.useNewFilterPane=!1,this.subscriptionManager=this.services.eventBridge.createChannelSubscriptionManager().subscribe(o.explorationLoaded,(function(){return i.onExplorationLoaded()})).subscribe(o.explorationSettingsLoaded,(function(e,t){t.useNewFilterPaneExperienceChanged&&i.updateUseNewFilterPaneSettings(i.services.explorationNavigation.getCurrentExploration())}))}return t.createOptions=function(){return{additionalServices:["localizationService","$element"],scopedDependencies:["eventBridge","selection","undoRedo","viewModeState","visibility","explorationNavigation","visualPluginOps","visualRelationship"]}},t.prototype.$onInit=function(){return __awaiter(this,void 0,e.Promise,(function(){var e;return __generator(this,(function(t){return e=this.services.explorationNavigation&&this.services.explorationNavigation.getCurrentExploration(),e&&this.updateUseNewFilterPaneSettings(e),[2]}))}))},t.prototype.$onDestroy=function(){this.onHeaderDestroy&&this.onHeaderDestroy(),this.subscriptionManager.unsubscribeAll()},t.prototype.canPopOut=function(){return!(this.visual.isPoppedOut||!this.services.visualPluginOps.supportsFocusMode(a.getVisualType(this.visual.contract))||this.visual.options&&this.visual.options.disableInFocus)},t.prototype.popOutVisualContainer=function(e){e.stopPropagation(),this.services.visibility.set(this.visual.contract,1)},t.prototype.getSeeDataLayoutTitle=function(){return 2===this.visual.contract.detailVisualLayout?this.services.localizationService.get("VisualContainer_SeeData_HorizontalLayoutButton"):this.services.localizationService.get("VisualContainer_SeeData_VerticalLayoutButton")},t.prototype.getSeeDataLayoutTooltipConfig=function(){return{tooltipArrowVerticalPosition:r.bottom,tooltipTitle:this.getSeeDataLayoutTitle(),tooltipShowOnFocus:!0}},t.prototype.toggleSeeDataLayout=function(e){e.stopPropagation();var t=this.visual.contract,i=t.detailVisualLayout||1;this.services.undoRedo.register("ToggleSeeDataLayout",(function(){1===i?t.detailVisualLayout=2:t.detailVisualLayout=1})),this.visual.updateViewState()},t.prototype.canSetVisualRelationshipFilterAction=function(){if(!this.services.viewModeState.getConfig().showRelationships||1!==this.services.selection.getSelectedElements().length)return!1;var e=n.getSelectedVisual(this.services.selection);return!!this.services.visualRelationship.supportsAnyFilterAction(e)&&!n.isVisualContainerSelected(this.visual.contract,this.services.selection)},t.prototype.onResize=function(){if(this.onHeaderResize){var e=this.services.$element.find(".vcHeader"),t=e.width(),i=e.height();this.onHeaderResize({$width:t,$height:i})}},t.prototype.onExplorationLoaded=function(){var e=this.services.explorationNavigation.getCurrentExploration();e&&this.updateUseNewFilterPaneSettings(e)},t.prototype.updateUseNewFilterPaneSettings=function(e){this.useNewFilterPane=e.settings&&e.settings.useNewFilterPaneExperience},t})();i.VisualContainerHeaderController=s})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){i.VisualContainerHeader={templateUrl:"components/visualContainerHeader/visualContainerHeader.html",bindings:{visual:"<",menuOptions:"<",disablePin:"<",showWarningDetails:"&",showTransformWarningDetails:"&",showInfoDetails:"&",onVisualContainerChanged:"&",onHeaderDestroy:"&",onHeaderResize:"&"},controller:e.common.createController(t.controllers.VisualContainerHeaderController)}})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=e.common.ArrowVerticalPosition,o=e.visualHost.ResourcePackageReferenceResolver,n=e.explore.contracts.VisualContainer,a=e.explore.util.VisualContainerUtils,s=(function(){function e(e,t){this.services=t}return e.createOptions=function(){return{additionalServices:["conceptualSchemaProxy","errorService","explorationSerializer","localizationService","promiseFactory"],scopedDependencies:["dataSources","explorationNavigation","filterGenerator","pinVisual","resourceLoader","viewModeState","visualPlugin"]}},e.prototype.pinVisualContainer=function(e){var r=this,o=function(){var e,t=r.services.dataSources.get(),i=r.visual;r.services.conceptualSchemaProxy.get(t).then((function(t){e=r.visual.hostServices.getFilters(r.services.filterGenerator,t)})).then((function(){return r.resolveResourceReferences(i.contract)})).then((function(o){return r.services.pinVisual.pinVisualContainer(t,o,e,i.themeCollection,r.services.explorationNavigation.getCurrentExploration().resourcePackages)}))};if(this.promptToSaveFirst()){var n=this.services.localizationService.get("ReportAppBar_SaveAsDialogTitle"),a=this.services.localizationService.get("ReportContainer_NeedToSaveReportBeforePin");i.showSaveAsDialog(this.services.errorService,this.services.localizationService,n,a).then((function(e){r.services.rootScope.$emit(t.constants.saveReportBeforePinning,e,o)}))}else o();e&&e.stopPropagation&&e.stopPropagation()},e.prototype.promptToSaveFirst=function(){var e=this.services.explorationNavigation.getCurrentExploration();return!(!e||e.report)},e.prototype.canPin=function(){if(!this.visual)return!1;if(a.hasGroupByItemsInQuery(this.visual.contract))return!1;var e=!1,t=this.visual.getVisualType();return e=this.services.pinVisual.canPinVisualType(t),this.services.viewModeState.getConfig().supportsPinning&&e&&!this.visual.showWatermark&&!!this.visual.canPin},e.prototype.showPin=function(){return this.visual&&this.visual.options.showPin},e.prototype.getPinTileTitle=function(){return this.visual.options.disablePin?this.services.localizationService.get("PinTile_NotSupportedTitle"):this.services.localizationService.get("PinVisual_ToolTip")},e.prototype.getPinTileTooltipConfig=function(){return{tooltipArrowVerticalPosition:r.bottom,tooltipTitle:this.getPinTileTitle(),tooltipShowOnFocus:!0}},e.prototype.resolveResourceReferences=function(e){var t=this,i=this.services.promiseFactory.defer(),r=a.getVisualType(e),s=a.getObjectDefinitions(e),l=this.services.explorationNavigation.getCurrentExploration(),c=this.services.visualPlugin.capabilities(r),u=c&&c.objects;return o.loadAndResolveFromDataViewObjects(s,u,l.resourcePackages,this.services.resourceLoader,this.services.promiseFactory,!0).then((function(r){var o=n.clone(e,t.services.explorationSerializer);o.config.singleVisual.objects=r,i.resolve(o)})),i.promise},e})();i.VisualContainerPinButtonController=s})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){i.VisualContainerPinButton={templateUrl:"components/visualContainerPinButton/visualContainerPinButton.html",bindings:{visual:"<",disablePin:"<"},controller:e.common.createController(t.controllers.VisualContainerPinButtonController)}})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(){}return e.prototype.closePopOut=function(e){this.onClosePopOut({$event:e})},e})();e.VisualContainerPopOutBarController=t})(t=e.components||(e.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){t.VisualContainerPopOutBar={templateUrl:"components/visualContainerPopOutBar/visualContainerPopOutBar.html",controller:e.common.createController(t.VisualContainerPopOutBarController),bindings:{viewModel:"<",onClosePopOut:"&"}}})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=t.services.events,o=t.services.selectionUtils,n=e.explore.util.VisualContainerUtils,a=(function(){function i(e,t){this.services=t}return i.createOptions=function(){return{additionalServices:["conceptualSchemaProxy","telemetryService"],scopedDependencies:["dataSources","eventBridge","selection","viewModeState","visualAuthoring","visualRelationship"]}},i.prototype.$onInit=function(){var e=this;this.loadVisualRelationshipFilterAction(),this.subscriptionManager=this.services.eventBridge.createChannelSubscriptionManager().subscribe(r.selectionChanged,(function(){return e.loadVisualRelationshipFilterAction()})).subscribe(r.explorationSlowDataSourceSettingsLoaded,(function(t,i){return i.isCrossHighlightingDisabledChanged&&e.loadVisualRelationshipFilterAction()}))},i.prototype.$onDestroy=function(){this.subscriptionManager.unsubscribeAll()},i.prototype.setVisualRelationshipFilterAction=function(i,r){i&&i.stopPropagation&&i.stopPropagation();var a=o.getSelectedVisual(this.services.selection);this.visual.hostServices.setVisualRelationshipFilterAction(a,this.visual.contract,r,this.services.visualAuthoring),this.services.telemetryService.logEvent(e.telemetry.EXVisualRelationshipOverride,n.getVisualType(a),n.getVisualType(this.visual.contract),t.contracts.VisualRelationshipFilterActionUtil.toString(r)),this.filterAction=r,this.onVisualContainerChanged()},i.prototype.loadVisualRelationshipFilterAction=function(){var e=this,t=o.getSelectedVisual(this.services.selection);if(t){var i=this.services.dataSources.get();this.services.conceptualSchemaProxy.get(i).then((function(i){var r=e.visual.hostServices.getVisualRelationshipFilterAction(t,e.services.visualRelationship,i);0===r&&(r=e.services.visualRelationship.defaultFilterAction(t,e.visual.contract)),e.filterAction=r}))}},i.prototype.supportsVisualRelationshipFilterAction=function(e){var t=o.getSelectedVisual(this.services.selection);return this.services.visualRelationship.supportsFilterActionTarget(t,this.visual.contract,e)},i})();i.VisualContainerRelationshipFiltersController=a})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){i.VisualContainerRelationshipFilters={templateUrl:"components/visualContainerRelationshipFilters/visualContainerRelationshipFilters.html",bindings:{visual:"<",onVisualContainerChanged:"&"},controller:e.common.createController(t.controllers.VisualContainerRelationshipFiltersController)}})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(e,t){}return e.createOptions=function(){return{additionalServices:[],scopedDependencies:[]}},e})();e.VisualHeaderItemContainerController=t})(t=e.controllers||(e.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){i.VisualHeaderItemContainer={templateUrl:"components/visualHeaderItemContainer/visualHeaderItemContainer.html",transclude:!0,bindings:{visual:"<"},controller:e.common.createController(t.controllers.VisualHeaderItemContainerController)}})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=e.common.ArrowVerticalPosition,o=e.common.OverlayUtils,n=(function(){function e(e,t){this.services=t,this.optionsMenuTitle=this.services.localizationService.get("Options_Menu"),this.optionsMenuTooltipConfig={tooltipArrowVerticalPosition:r.bottom,tooltipTitle:this.optionsMenuTitle,tooltipShowOnFocus:!0}}return e.createOptions=function(){return{additionalServices:["localizationService","dropdown"],scopedDependencies:["eventBridge","selection","visualContainerMenuFactory"]}},e.prototype.showOptionsMenu=function(e){this.services.dropdown.hideAll(),this.services.eventBridge.publishToChannel(t.services.events.visualContainerOptionsMenuOpened),this.services.visualContainerMenuFactory.createOptionsMenu(this.visualContainerController.viewModel,this.visualContainerController.scope,this.visualContainerController.menuOptions,void 0,this.getMenuProperties(e)),e.stopPropagation()},e.prototype.getMenuProperties=function(e){var t=$(e.currentTarget);return{anchorDimensions:o.getAnchorDimensions(t),anchorElement:t,preferLeft:!1,showInsideVisibleArea:!0,horizontal:!1,backgroundStyle:this.visual.readOnlyState.headerBackgroundStyle,foregroundStyle:this.visual.readOnlyState.headerForegroundStyle}},e})();i.VisualContainerOptionsMenuController=n})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){i.VisualContainerOptionsMenu={templateUrl:"components/visualOptionsMenu/visualContainerOptionsMenu.html",bindings:{visual:"<",menuOptions:"<",menuId:"<"},require:{visualContainerController:"^visualContainer"},controller:e.common.createController(t.controllers.VisualContainerOptionsMenuController)}})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=jsCommon.CssConstants.createClassAndSelector,o=e.visuals.DataItemTooltip,n=t.contracts.VisualTooltip,a=r("data-item-tooltip-container"),s=(function(){function e(e,t){var i=this;this.scope=e,this.services=t,this.pointerDownHandler=function(e){var t=e.originalEvent;t&&"touch"===t.pointerType&&(t.tooltip=!0)},this.canvasMask=new h(function(e,t){return i.canvasMaskTransit(e,t)})}return e.prototype.showCanvasSection=function(){return this.getTooltipType()===n.Canvas},e.prototype.showDefaultSection=function(){return this.getTooltipType()===n.Default&&!this.defaultSectionHidden},e.prototype.showLoadingSection=function(){return this.isLoadingDelayed&&this.getTooltipType()===n.Canvas},e.createOptions=function(){return{additionalServices:["$element"],scopedDependencies:[]}},e.prototype.$onChanges=function(e){if(this.defaultSectionHidden=!1,e.tooltipData){e.tooltipShown&&e.tooltipShown.currentValue&&this.canvasMask.goto(l.Shown),this.updateView(e.tooltipData.currentValue)}e.tooltipDataItems&&!e.tooltipDataItems.isFirstChange()&&this.updateDataItemTooltip(e.tooltipDataItems.currentValue)},e.prototype.$onInit=function(){this.tooltipData||(this.requestedTooltipType=n.Default),this.isLoading=!1;var e=this.services.$element.find(a.selector),t=this.dataItemTooltip=new o;e.append(t.create()),this.dataItemTooltip.update({items:this.tooltipDataItems,bounds:{height:window.innerHeight,width:window.innerWidth}}),this.services.$element.on("pointerdown",this.pointerDownHandler)},e.prototype.$onDestroy=function(){this.subscriptionManager&&(this.subscriptionManager.unsubscribeAll(),this.subscriptionManager=null),this.services.$element.off("pointerdown",this.pointerDownHandler)},e.prototype.getTooltipType=function(){return this.requestedTooltipType},e.prototype.showChildMenu=function(e){this.defaultSectionHidden=e},e.prototype.updateView=function(e){e||(e={filterContext:void 0,identities:void 0,sectionName:void 0,tooltipType:n.Default}),this.requestedTooltipType=this.explorationContract?e.tooltipType:n.Default,this.filterContext=e.filterContext,this.identities=e.identities,this.sectionName=e.sectionName},e.prototype.updateDataItemTooltip=function(e){this.dataItemTooltip.update({items:e,bounds:{height:window.innerHeight,width:window.innerWidth}})},e.prototype.onCanvasReady=function(){this.canvasMask.accept(d.CanvasIdle)},e.prototype.onCanvasBusy=function(){this.canvasMask.accept(d.CanvasBusy)},e.prototype.canvasMaskTransit=function(e,t){var i=this;switch(e){case l.Shown:this.isLoadingDelayed=!1,this.waitingToShowLoadingTimer&&(clearTimeout(this.waitingToShowLoadingTimer),this.waitingToShowLoadingTimer=void 0);break;case l.WaitingToShow:this.waitingToShowTimer&&(clearTimeout(this.waitingToShowTimer),this.waitingToShowTimer=void 0);break;case l.WaitingToHide:this.waitingToHideTimer&&(clearTimeout(this.waitingToHideTimer),this.waitingToHideTimer=void 0)}switch(t){case l.Shown:this.setIsLoading(!0),this.waitingToShowLoadingTimer=setTimeout((function(){i.waitingToShowLoadingTimer=void 0,i.isLoadingDelayed=!0}),p);break;case l.WaitingToShow:this.waitingToShowTimer=setTimeout((function(){i.waitingToShowTimer=void 0,i.canvasMask.accept(d.WaitingToShowElapsed)}),c);break;case l.Hidden:this.setIsLoading(!1);break;case l.WaitingToHide:this.waitingToHideTimer=setTimeout((function(){i.waitingToHideTimer=void 0,i.canvasMask.accept(d.WaitingToHideElapsed)}),u)}},e.prototype.setIsLoading=function(e){this.isLoading=e,this.scope.$applyAsync()},e})();i.VisualTooltipController=s;var l,c=50,u=50,p=1e3;!(function(e){e[e.Hidden=0]="Hidden",e[e.WaitingToShow=1]="WaitingToShow",e[e.Shown=2]="Shown",e[e.WaitingToHide=3]="WaitingToHide"})(l=i.CanvasMaskState||(i.CanvasMaskState={}));var d;!(function(e){e[e.CanvasBusy=0]="CanvasBusy",e[e.CanvasIdle=1]="CanvasIdle",e[e.WaitingToShowElapsed=2]="WaitingToShowElapsed",e[e.WaitingToHideElapsed=3]="WaitingToHideElapsed"})(d=i.CanvasMaskEvent||(i.CanvasMaskEvent={}));var h=(function(){function e(e,t){void 0===t&&(t=l.Hidden),this.transit=e,this.state=t}return e.prototype.goto=function(e){var t=this.state;t!==e&&(this.transit(t,e),this.state=e)},e.prototype.accept=function(e){var t=this.state;switch(t){case l.Hidden:switch(e){case d.CanvasBusy:t=l.WaitingToShow;break;case d.CanvasIdle:break;case d.WaitingToHideElapsed:case d.WaitingToShowElapsed:}break;case l.WaitingToShow:switch(e){case d.CanvasBusy:break;case d.CanvasIdle:t=l.Hidden;break;case d.WaitingToShowElapsed:t=l.Shown;break;case d.WaitingToHideElapsed:}break;case l.Shown:switch(e){case d.CanvasBusy:break;case d.CanvasIdle:t=l.WaitingToHide;break;case d.WaitingToShowElapsed:case d.WaitingToHideElapsed:}break;case l.WaitingToHide:switch(e){case d.CanvasBusy:t=l.Shown;break;case d.CanvasIdle:break;case d.WaitingToShowElapsed:break;case d.WaitingToHideElapsed:t=l.Hidden}}this.goto(t)},e})();i.CanvasMaskStateMachine=h})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){t.VisualTooltip={templateUrl:"components/visualTooltip/visualTooltip.html",controller:e.common.createController(t.VisualTooltipController),bindings:{explorationContract:"<",explorationCapabilities:"<",onHide:"&",showActionBar:"<",tooltipData:"<",tooltipDataItems:"<",tooltipDataSources:"<",tooltipShown:"<",actionsProvider:"<"}}})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(t){function i(e){return new a(e)}function r(e){return{left:e.x,top:e.y,width:e.width,height:e.height}}function o(e){return{x:e.left,y:e.top,width:e.width,height:e.height}}var n=e.util.CanvasVisualsUtility;t.createCanvasLayout=i;var a=(function(){function e(e){this.canvasScale=e,this.items=[]}return e.prototype.registerLayoutItem=function(e){var t=this;return this.items.push(e),{onDragStart:function(i,r){return t.dragStart(e,i)},onDragEnd:function(i,r){return t.dragEnd(e,r,i)},onNudge:function(i,r,o){return t.nudge(e,o,r,i)},onResizeStart:function(i){return t.resizeStart(e,i)},onResizeMove:function(i,r){return t.resizeMove(e,r,i)},onResizeEnd:function(i,r){return t.resizeEnd(e,r,i)},getIntermediateDimensions:function(i){return t.getIntermediateDimensions(e,i)}}},e.prototype.unregisterLayoutItem=function(e){_.pull(this.items,e)},e.prototype.dragEnd=function(e,t,i){this.canProcess(e)&&(e.dragEnd(this.getNormalizedPosition(e,i),t),this.strategy.onDragEnd&&this.strategy.onDragEnd())},e.prototype.dragStart=function(e,t){this.canProcess(e)&&(this.strategy.onDragStart&&this.strategy.onDragStart(),t=this.getIntermediateDimensions(e,t),e.dragStart(t))},e.prototype.nudge=function(e,t,i,r){this.canProcess(e)&&e.nudge(this.getNormalizedPosition(e,i,r),t)},e.prototype.resizeStart=function(e,t){this.canProcess(e)&&(this.strategy.onResizeStart&&this.strategy.onResizeStart(r(t)),t=this.getIntermediateDimensions(e,t),e.resizeStart(t))},e.prototype.resizeMove=function(e,t,i){this.canProcess(e)&&(i=this.getIntermediateDimensions(e,i),e.resizeMove(i,t))},e.prototype.resizeEnd=function(e,t,i){this.canProcess(e)&&(e.resizeEnd(this.getNormalizedPosition(e,i),t),this.strategy.onResizeEnd&&this.strategy.onResizeEnd())},e.prototype.setStrategy=function(e){this.strategy=e},e.prototype.setCanvasSize=function(e){this.canvasSize=e},e.prototype.getDropPosition=function(e,t,i){var r=i;if(!r){var o=this.canvasScale.getDisplayAreaScaleFactor();r={x:o,y:o}}return this.strategy.getNearestDropPosition({item:null,allItems:this.items,rawItemPosition:{left:e,top:t,width:0,height:0},canvasSize:this.canvasSize,canvasScale:r})},e.prototype.getIntermediateDimensions=function(e,t){if(this.strategy.isEnforcedForIntermediateStates()){var i=r(this.getScaledPosition(e,t));return o(this.strategy.getHostRectFromScaled(i))}return t},e.prototype.getScaledPosition=function(e,t,i){var a=e.getScale(),s={x:!_.isFinite(t.x),y:!_.isFinite(t.y),width:!_.isFinite(t.width),height:!_.isFinite(t.height)},l=e.getPosition(),c=n.convertToScaledPosition(l,a,!1);if(s.x||s.y||s.width||s.height){var u=this.strategy.getHostRectFromScaled(r(c));t=__assign({},t),s.x&&(t.x=u.left),s.y&&(t.y=u.top),s.width&&(t.width=u.width),s.height&&(t.height=u.height)}var p=r(t),d=this.strategy.getNearestValidPosition({item:e,allItems:this.items,canvasSize:this.canvasSize,canvasScale:a,rawItemPosition:p,nudge:i});return d?o(d):c},e.prototype.getNormalizedPosition=function(e,t,i){var a=this.getScaledPosition(e,t,i);return o(n.convertFromScaledRect(r(a),e.getScale()))},e.prototype.canProcess=function(e){return!!e&&!e.isSuspended()&&_.includes(this.items,e)},e})();t.CanvasLayout=a})(t=e.controllers||(e.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){function t(e,t,r,o){var n=i(e,o);return{width:l(r,n.width,o.colSpacing),height:l(t,n.height,o.rowSpacing)}}function i(e,t){var i=t.cols,r=t.rows,o=t.rowSpacing,n=t.colSpacing,a=n*(i+1),s=o*(r+1),l=Math.floor((e.width-a)/i),c=Math.floor((e.height-s)/r);return{width:l,height:c}}function r(e,t,r){for(var o=i(e,t),n=t.cols,a=t.rows,s=t.rowSpacing,l=t.colSpacing,c=r.width,u=r.height,p=o.width,d=o.height,h=Math.ceil(c/(p+l)),v=Math.ceil(u/(d+s)),g=[],f=0,y=0;y<=a-v;++y){f+=s;for(var m=0,S=0;S<=n-h;++S)m+=l,g.push({left:m,top:f,width:c,height:u}),m+=p;f+=d}return g}function o(e,t,i,r){return[n(t,e,r),i]}function n(e,t,r){var o=i(t,e),n=e.rowSpacing,l=e.colSpacing,c=o.width,u=o.height;return{left:a(r.left,c,l),top:a(r.top,u,n),width:s(r.width,c,l),height:s(r.height,u,n)}}function a(e,t,i){var r=e+t/2;return r-=1,c(Math.floor(r/(t+i)),t,i)}function s(e,t,i){var r=e+t/2+i,o=Math.floor(r/(t+i));return o=Math.max(1,o),l(o,t,i)}function l(e,t,i){return e*t+Math.max(0,e-1)*i}function c(e,t,i){return e*t+e*i+i}e.getSpanSize=t,e.getCellSize=i,
e.getAllSlots=r,e.getAllResizeSlots=o})(t=e.CanvasLayoutGrid||(e.CanvasLayoutGrid={}))})(t=e.canvas||(e.canvas={}))})(t=e.controllers||(e.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r;!(function(i){function r(e,t,i){var r=_.chain(i).without(t).map((function(e){return a.visualPositionToRect(e.getPosition())})).value();return _.remove(e,(function(e){return _.some(r,(function(t){return o(t,e)}))})),e}function o(e,t){return!(t.left>=e.left+e.width||e.left>=t.left+t.width||t.top>=e.top+e.height||e.top>=t.top+t.height)}function n(e,t){return l.getDistance(c.getCentroid(e),c.getCentroid(t))}var a=t.util.CanvasDisplayUtility,s=t.util.CanvasVisualsUtility,l=e.visuals.shapes.Point,c=e.visuals.shapes.Rect,u=(function(){function e(e,t){void 0===t&&(t={width:3,height:3}),this.options=e,this.defaultNewCellSize=t}return e.prototype.getScaledRectFromHost=function(e){var t=this.options.offset;return t&&(e=c.add(e,t)),e},e.prototype.getHostRectFromScaled=function(e){var t=this.options.offset;return t&&(e=c.subtract(e,t)),e},e.prototype.getNearestValidPosition=function(e){var t=e.rawItemPosition,i=this.options.offset;i&&(t=c.add(e.rawItemPosition,i));var r,o=s.convertFromScaledRect(t,e.canvasScale),l=!1;e.item&&(r=a.visualPositionToRect(e.item.getPosition()),l=o.width!==r.width||o.height!==r.height);var u,p;if(l)u=this.getAvailableResizeRects(e.item,e.allItems,e.canvasSize,r,o),p=u[0];else{if(u=this.getAvailableRects(e.item,e.allItems,e.canvasSize,o),_.isEmpty(u))return;p=_.minBy(u,(function(e){return n(e,o)}))}return s.convertToScaledRect(p,e.canvasScale)},e.prototype.getNearestDropPosition=function(e){var t=c.getCentroid(e.rawItemPosition);this.options.offset&&(t.x-=this.options.offset.left,t.y-=this.options.offset.top),t.x/=e.canvasScale.x,t.y/=e.canvasScale.y;var r=this.defaultNewCellSize.width,o=this.defaultNewCellSize.height,a=function(){var a=i.CanvasLayoutGrid.getSpanSize(e.canvasSize,r,o,s.options),l={left:t.x-a.width/2,top:t.y-a.height/2,width:a.width,height:a.height},u=s.getAvailableRects(e.item,e.allItems,e.canvasSize,l);return _.isEmpty(u)||(_.remove(u,(function(e){return!c.containsPoint(e,t)})),_.isEmpty(u))?(--r,void--o):{value:_.minBy(u,(function(e){return n(e,l)}))}},s=this;do{var l=a();if("object"==typeof l)return l.value}while(r>=1&&o>=1)},e.prototype.isEnforcedForIntermediateStates=function(){return!1},e.prototype.getAvailableRects=function(e,t,o,n){return r(i.CanvasLayoutGrid.getAllSlots(o,this.options,n),e,t)},e.prototype.getAvailableResizeRects=function(e,t,o,n,a){return r(i.CanvasLayoutGrid.getAllResizeSlots(o,this.options,n,a),e,t)},e})();i.CanvasLayoutGridStrategy=u,i.isIntersecting=o})(r=i.canvas||(i.canvas={}))})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){function t(e,t){if(!e.visual.canvas)return{};var i={};return i.canvas=!0,l.hasFlag(t,1)&&(i.left=!0),l.hasFlag(t,2)&&(i.center=!0),l.hasFlag(t,4)&&(i.right=!0),i}function i(e,t){var i=_.minBy(t,(function(t){return Math.abs(t.newLeftPosition-e.left)}));return{offset:i.newLeftPosition-e.left,newLeftPosition:i.newLeftPosition,distance:Math.abs(i.newLeftPosition-e.left),aligments:i.alignments}}function r(e,t,i){function r(e,t,i){o[e]||(o[e]={newLeftPosition:e,alignments:[]});var r=_.last(o[e].alignments);r&&r.visual===t?r.snappedToVisualPoints|=i:o[e].alignments.push({visual:t,snappedToVisualPoints:i})}for(var o={},n=0,a=t;n<a.length;n++){var s=a[n],c=s.left+s.width;if(l.hasFlag(i,4)&&(r(s.left-e.width,s,1),r(s.horizontalCenter-e.width,s,2),r(c-e.width,s,4)),l.hasFlag(i,2)){var u=e.horizontalCenter-e.left;r(s.left-u,s,1),r(s.horizontalCenter-u,s,2),r(c-u,s,4)}l.hasFlag(i,1)&&(r(s.left,s,1),r(s.horizontalCenter,s,2),r(c,s,4))}return _.values(o)}function o(e){return a(__assign({},e,{verticalCenter:e.top+e.height/2,horizontalCenter:e.left+e.width/2}))}function n(e){var t=e.getPosition(),i=e.getScale();return o({top:t.y*i.y,left:t.x*i.x,width:t.width*i.x,height:t.height*i.y})}function a(e){return{canvas:e.canvas,top:Math.round(e.top),left:Math.round(e.left),width:Math.round(e.width),height:Math.round(e.height),verticalCenter:Math.round(e.verticalCenter),horizontalCenter:Math.round(e.horizontalCenter)}}function s(e){return{canvas:e.canvas,top:e.left,left:e.top,width:e.height,height:e.width,horizontalCenter:e.verticalCenter,verticalCenter:e.horizontalCenter}}var l=jsCommon.EnumExtensions;e.smartGuideSnappingDistance=6,e.smartGuidePadding=6;var c=(function(){function a(e,t,i){this.baseStrategy=e,this.selectionService=t,this.guidesViewModel=i}return a.prototype.onDragStart=function(){this.draggingMultipleVisuals=this.selectionService.getSelectedElements().length>1},a.prototype.onDragEnd=function(){this.guidesViewModel.guides=[],this.draggingMultipleVisuals=void 0},a.prototype.onResizeStart=function(e){this.resizing=!0,this.initialResizeDimensions=o(this.getScaledRectFromHost(__assign({},e)))},a.prototype.onResizeEnd=function(){this.resizing=!1,this.initialResizeDimensions=void 0,this.guidesViewModel.guides=[]},a.prototype.getScaledRectFromHost=function(e){return this.baseStrategy.getScaledRectFromHost(e)},a.prototype.getHostRectFromScaled=function(e){return this.baseStrategy.getHostRectFromScaled(e)},a.prototype.getNearestValidPosition=function(e){return e.nudge||this.draggingMultipleVisuals||(e.rawItemPosition=this.alignObject(e)),this.baseStrategy.getNearestValidPosition(e)},a.prototype.getNearestDropPosition=function(e){return this.baseStrategy.getNearestDropPosition(e)},a.prototype.isEnforcedForIntermediateStates=function(){return!0},a.prototype.alignObject=function(e){this.guidesViewModel.guides=[];var t=o(this.getScaledRectFromHost(__assign({},e.rawItemPosition))),i=_.chain(e.allItems).filter((function(t){return t!==e.item})).map((function(e){return n(e)})).value(),r=e.canvasScale,a=e.canvasSize;return i.push(o({left:0,width:a.width*r.x,top:0,height:a.height*r.y,canvas:!0})),this.resizing?this.alignResize(t,i):this.alignDrag(t,i),this.getHostRectFromScaled({top:t.top,left:t.left,width:t.width,height:t.height})},a.prototype.alignDrag=function(t,o){var n,a,l=i(t,r(t,o,7)),c=l.distance<=e.smartGuideSnappingDistance;c&&(t.left+=l.offset);var u=s(t),p=o.map((function(e){return s(e)})),d=i(u,r(u,p,7)),h=d.distance<=e.smartGuideSnappingDistance;if(h&&(t.top+=d.offset,u.left+=d.offset),c&&(n=this.guidesViewModel.guides).push.apply(n,this.createVerticalGuides(t,l.aligments)),h){var v=this.createVerticalGuides(u,d.aligments);(a=this.guidesViewModel.guides).push.apply(a,v.map((function(e){return{top:e.left,left:e.top,width:e.height,class:e.class}})))}},a.prototype.alignResize=function(e,t){var i,r;if(!_.isEqual(e,this.initialResizeDimensions)){var o=this.alignResizeLeftRight(this.initialResizeDimensions,e,t);(i=this.guidesViewModel.guides).push.apply(i,o);var n=s(e),a=s(this.initialResizeDimensions),l=t.map((function(e){return s(e)})),c=this.alignResizeLeftRight(a,n,l);if(!_.isEmpty(c)){var u=s(n);e.top=u.top,e.height=u.height,(r=this.guidesViewModel.guides).push.apply(r,c.map((function(e){return{left:e.top,top:e.left,width:e.height,class:e.class}})))}}},a.prototype.alignResizeLeftRight=function(t,o,n){var a=o.left===t.left&&o.width!==t.width,s=o.left!==t.left;if(!s&&!a)return[];var l=s?1:4,c=i(o,r(o,n,l));return c.distance<=e.smartGuideSnappingDistance?(s?(o.width-=c.offset,o.left=c.newLeftPosition):o.width+=c.offset,this.createVerticalGuides(o,c.aligments)):[]},a.prototype.createVerticalGuides=function(i,r){function o(e,r,o){n[e]||(n[e]={left:e,top:i.top,bottom:i.top+i.height,classes:{}}),n[e].top=Math.min(n[e].top,r.visual.top),n[e].bottom=Math.max(n[e].bottom,r.visual.top+r.visual.height),n[e].classes=_.assign(n[e].classes,t(r,o))}for(var n={},a=0,s=r;a<s.length;a++){var c=s[a],u=l.hasFlag(c.snappedToVisualPoints,1),p=l.hasFlag(c.snappedToVisualPoints,4);u&&o(c.visual.left,c,1),p&&o(c.visual.left+c.visual.width,c,4),(!u&&!p||c.visual.canvas)&&l.hasFlag(c.snappedToVisualPoints,2)&&o(c.visual.horizontalCenter,c,2)}var d=[];for(var h in n){var v=n[h],g=v.top,f={top:g,left:v.left,width:1,height:v.bottom-g};d.push({top:f.top-e.smartGuidePadding,left:f.left,height:f.height+2*e.smartGuidePadding,class:Object.keys(v.classes).join(" ")})}return d},a})();e.SmartGuideStrategy=c})(t=e.canvas||(e.canvas={}))})(t=e.controllers||(e.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i;!(function(t){var i=e.explore.util.CanvasDisplayUtility,r=e.visuals.shapes.Rect,o=(function(){function e(e,t){this.offset=e,this.lazyScopedSync=t}return e.prototype.getScaledRectFromHost=function(e){return r.add(e,this.offset)},e.prototype.getHostRectFromScaled=function(e){return r.subtract(e,this.offset)},e.prototype.getNearestValidPosition=function(e){return r.add(e.rawItemPosition,this.offset)},e.prototype.getNearestDropPosition=function(e){var t={x:e.rawItemPosition.left+e.rawItemPosition.width/2,y:e.rawItemPosition.top+e.rawItemPosition.height/2};t.x-=this.offset.left,t.y-=this.offset.top,t.x/=e.canvasScale.x,t.y/=e.canvasScale.y;var r=_.map(e.allItems,(function(e){return i.visualPositionToRect(e.getPosition())}));return _.isEmpty(r)&&(t.x-=i.DefaultVisualPosition.width/2,t.y-=i.DefaultVisualPosition.height/2),this.lazyScopedSync("layoutAuthoring").getLayoutForNewVisualContainerWithRects(r,t,e.canvasSize)},e.prototype.isEnforcedForIntermediateStates=function(){return!1},e})();t.DefaultLayoutStrategy=o})(i=t.canvas||(t.canvas={}))})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i;!(function(t){var i=e.explore.util.CanvasDisplayUtility,r=e.explore.util.DotGridUtil,o=e.visuals.shapes.Rect,n=e.common.controllers.TransformNudgeDirection,a=(function(){function e(e){this.options=e}return e.prototype.getScaledRectFromHost=function(e){var t=this.options.offset;return t&&(e=o.add(e,t)),e},e.prototype.getHostRectFromScaled=function(e){var t=this.options.offset;return t&&(e=o.subtract(e,t)),e},e.prototype.getNearestValidPosition=function(t){var i=o.add(t.rawItemPosition,this.options.offset),r=t.canvasScale;if(t.nudge&&t.item){var a=t.item.getPosition(),s=a.x,l=a.y;t.nudge.direction===n.Left||t.nudge.direction===n.Right?s=e.applyNudge(s,this.options.layoutX.UnitDivisions,t.nudge.direction===n.Left,t.nudge.bigNudge):t.nudge.direction!==n.Up&&t.nudge.direction!==n.Down||(l=e.applyNudge(l,this.options.layoutY.UnitDivisions,t.nudge.direction===n.Up,t.nudge.bigNudge)),i.left=s*r.x,i.top=l*r.y}var c=this.getNearestUnscaledGridRect(i,r);return{left:c.left*r.x,top:c.top*r.y,width:c.width*r.x,height:c.height*r.y}},e.applyNudge=function(e,t,i,o){e=Math.round(e);var n=o?r.CanvasLayout.UnitLength:r.CanvasLayout.UnitLength/t,a=n*(i?Math.floor:Math.ceil)(e/n);return a===e&&(a+=i?-n:n),a},e.prototype.getNearestDropPosition=function(e){var t=o.getCentroid(e.rawItemPosition);t.x-=this.options.offset.left,t.y-=this.options.offset.top,t.x/=e.canvasScale.x,t.y/=e.canvasScale.y;var r=_.map(e.allItems,(function(e){return i.visualPositionToRect(e.getPosition())}));_.isEmpty(r)&&(t.x-=i.DefaultVisualPosition.width/2,t.y-=i.DefaultVisualPosition.height/2);var n=this.options.lazyScopedSync("layoutAuthoring").getLayoutForNewVisualContainerWithRects(r,t,e.canvasSize);return n=this.getNearestUnscaledGridRect(n,{x:1,y:1})},e.prototype.getNearestUnscaledGridRect=function(t,i){var r=this.getNearestUnscaledGridPoint({x:t.left,y:t.top},i),o=this.getNearestUnscaledGridPoint({x:t.left+t.width,y:t.top+t.height},i),n=this.options.limits;if(n){var a=e.limitAdjustment(r.x,o.x,n.left,n.width);0!==a&&(r.x+=a,o.x+=a);var s=e.limitAdjustment(r.y,o.y,n.top,n.height);0!==s&&(r.y+=s,o.y+=s)}return{left:r.x,top:r.y,width:o.x-r.x,height:o.y-r.y}},e.limitAdjustment=function(e,t,i,r){if(e<i)return i-e;var o=i+r;return t>o?o-t:0},e.prototype.getNearestUnscaledGridPoint=function(t,i){return{x:e.getNearestUnscaledGridCoordinate(this.options.layoutX,t.x,i.x),y:e.getNearestUnscaledGridCoordinate(this.options.layoutY,t.y,i.y)}},e.getNearestUnscaledGridCoordinate=function(e,t,i){var o=t/i,n=r.CanvasLayout.UnitLength/e.UnitDivisions;return Math.round(o/n)*n},e.prototype.isEnforcedForIntermediateStates=function(){return!0},e})();t.DotGridLayoutStrategy=a})(i=t.canvas||(t.canvas={}))})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=t.util.ErrorDetailsUtility,o=(function(){function t(t,i){var r=this;this.services=i,this.tooltipConfigManager={getTooltipConfig:function(){return{tooltipArrowPosition:e.common.ArrowPosition.arrowTopLeft,tooltipDelay:100,tooltipDescription:r.getWarningMessage()}}}}return t.createOptions=function(){return{additionalServices:["localizationService"],scopedDependencies:["explorationCapabilities"]}},t.prototype.isClickable=function(){var e=this.details;return!!e&&(!_.isEmpty(e.message)||this.hasAdditionalErrorInfo(e))},t.prototype.hasAdditionalErrorInfo=function(e){return r.hasAdditionalErrorInfo(e)},t.prototype.getWarningMessage=function(){var e=this.details;return e?this.hasAdditionalErrorInfo(e)?e.message+" "+this.services.localizationService.get("VisualContainer_ClickToSeeMore"):e.message:""},t.prototype.useStylableHeader=function(){return this.services.explorationCapabilities&&this.services.explorationCapabilities.getCapabilities().visualContainerOptions.useStylableHeader},t})();i.CanvasVisualHeaderIconController=o})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(e){var t=this;this.scope=e,this.errorService=this.scope.errorService,this.modalDialog=this.errorService.control(),this.scope.deleteVisual=function(){return t.deleteVisual()},this.scope.closeDialog=function(){return t.closeDialog()}}return e.prototype.deleteVisual=function(){this.closeDialog(),this.scope.deleteVisualService.deleteCustomVisuals(this.scope.explorationContract,this.scope.customVisuals)},e.prototype.closeDialog=function(){this.modalDialog&&this.modalDialog.hideDialog()},e})();e.DeleteVisualWarningDialogController=t})(t=e.controllers||(e.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i=(function(){function t(t,i){var r=this;this.services=i,this.scope=t,this.errorService=this.services.errorService,this.modalDialog=this.errorService.control(),this.scope.acceptTermsOfService=function(){return r.notifyConsentChanged(!0)},this.scope.rejectTermsOfService=function(){return r.notifyConsentChanged(!1)},this.scope.learnMoreLink=e.models.EsriLearnMoreUrl,this.scope.byClickingText=this.services.localizationService.format("EsriConsentDialog_ByClicking",['<a href="https://go.microsoft.com/fwlink/?LinkID=826322" target="_blank">'+this.services.localizationService.get("Terms")+"</a>",'<a href="https://go.microsoft.com/fwlink/?LinkID=826323" target="_blank">'+this.services.localizationService.get("PrivacyPolicy")+"</a>"])}return t.createOptions=function(){return{additionalServices:["errorService","localizationService"]}},t.createAndShowEsriConsentDialog=function(t,i,r,o){var n=t.defer(),a=i.$new(!0);a.errorService=r,a.esriConsentDialogCallback=function(t){n.promise.then((function(){return i.$emit(e.explore.constants.trustedVisualConsentStateChangedEventName)})),n.resolve(t)};var s={dialogName:void 0,isDismissable:!0,scope:a,template:"<esri-consent-dialog></esri-consent-dialog>",dialogCssClass:"esriConsentDialog"};return o.showLegacyWebModalDialog(s),n.promise},t.prototype.notifyConsentChanged=function(e){this.closeDialog(),this.scope.esriConsentDialogCallback(e)},t.prototype.closeDialog=function(){this.modalDialog&&this.modalDialog.hideDialog()},t})();t.EsriConsentDialogController=i})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=jsCommon.FocusManager,i=(function(){function e(e,t){var i=this;this.services=t,this.scope=e,this.scope.isMasterFormFactor=function(){return 0===t.formFactor.getCurrentLayout()},this.scope.isMobileLayoutAuthoring=function(){return 0!==t.formFactor.getCurrentLayout()&&1===t.viewModeState.getMode()},this.scope.focusVisualContainer=function(){return i.focusVisualContainer()}}return e.createOptions=function(){return{additionalServices:["$element","focus"],scopedDependencies:["formFactor","viewModeState","focusNotificator"]}},e.prototype.focusVisualContainer=function(){var e=this;this.services.timeout((function(){t.focusChildInGroup(e.services.$element.get(0))}))},e.prototype.$onInit=function(){!this.scope.shouldSetFocus||this.scope.canvasOptions&&this.scope.canvasOptions.disableFocusOnExploreCanvas||this.services.$element.focus(),this.services.focus.startListening()},e.prototype.$onDestroy=function(){this.services.focus.stopListening()},e})();e.ExplorationController=i})(t=e.controllers||(e.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i=e.explore.constants,r=e.explore.services.events,o=(function(){function t(t,o){var n=this;this.scope=t,this.services=o,this.scope.viewModel.isTabEditable=!1,this.services=o,this.scope.viewModeState=this.services.viewModeState,this.scope.eventBridge=this.services.eventBridge,this.scope.renameSection=function(e){return n.renameSection(e,n.scope.tabIndex)},this.scope.changeSection=function(e){return n.changeSection(e,n.scope.tabIndex)},this.scope.deleteSection=function(e){return n.deleteSection(e,n.scope.tabIndex)},this.scope.beginEditSection=function(){return n.beginEditSection()},this.scope.showContextMenu=function(e){return n.showContextMenu(e)},this.scope.onKeyPress=function(e){return n.onKeyPress(e)},this.scope.selectMenuItem=function(e){return n.selectMenuItem(e)},this.services.eventBridge.createChannelSubscriptionManager().subscribe(r.sectionNameChanged,(function(e,t){n.scope.viewModel.selected&&n.scope.$emit(i.renameSectionEvent)})),this.services.eventBridge.createChannelSubscriptionManager().subscribe(r.sectionChanged,(function(e,t){n.scope.viewModel.selected&&n.scope.$emit(i.updateNavButtonEvent)})),this.scope.$on(e.common.constants.editableLabelOnBlurEventName,(function(e){n.scope.viewModel.isTabEditable=!1,n.scope.$emit(i.renameSectionEvent)}))}return t.createOptions=function(){return{additionalServices:["dropdown","featureSwitchService","localizationService"],scopedDependencies:["eventBridge","lazyScoped","viewModeState"]}},t.prototype.showContextMenu=function(e){var t=this;if(this.scope.isEditing){var i=this.getMenuItemsCollection();this.services.dropdown.showContextMenu(i,{x:e.pageX,y:e.pageY},(function(e){return t.scope.selectMenuItem(e)}),!1)}},t.prototype.onKeyPress=function(e){if(this.scope.isEditing)switch(e.keyCode){case $.ui.keyCode.DELETE:this.scope.isOnlyVisibleTab||this.deleteSection(e,this.scope.tabIndex)}},t.prototype.getMenuItemsCollection=function(){for(var e={items:[]},t=0,i=this.scope.viewModel.menuItems.items;t<i.length;t++){var r=i[t],o=r.key,n=!1;(!this.scope.isOnlyVisibleTab||2!==o&&3!==o)&&(3===o&&(n=!!this.scope.isHiddenInViewMode),e.items.push({key:o,type:0,text:r.text,checked:n}))}return e},t.prototype.beginEditSection=function(){this.scope.viewModel.isTabEditable=!0,this.scope.toggleDraggable(!1),this.scope.$emit(i.renameSectionEvent)},t.prototype.renameSection=function(e,t){if(!jsCommon.StringExtensions.isNullOrUndefinedOrWhiteSpaceString(e)){var i={sectionNewName:e,sectionIndex:t};this.services.eventBridge.publishToChannel(r.renameSection,i),this.scope.toggleDraggable(!0)}},t.prototype.deleteSection=function(e,t){this.services.eventBridge.publishToChannel(r.deleteSectionInitiated,{sectionIndex:t,supportMinervaDialog:this.scope.supportsMinervaDialog}),e&&e.stopPropagation&&e.stopPropagation()},t.prototype.changeSection=function(e,t){this.scope.viewModel.selected||(this.services.eventBridge.publishBubbling(this.scope,r.switchSection,t),e&&e.stopPropagation&&e.stopPropagation())},t.prototype.toggleSectionVisibility=function(){var e=this,t=this.scope.isHiddenInViewMode?0:1;this.services.lazyScoped("explorationAuthoring").then((function(i){i.setSectionVisibility(e.scope.viewModel.contract,t)}))},t.prototype.selectMenuItem=function(e){switch(e){case 0:this.services.eventBridge.publishToChannel(r.duplicateSection,this.scope.tabIndex);break;case 1:this.beginEditSection();break;case 2:this.deleteSection(null,this.scope.tabIndex);break;case 3:this.toggleSectionVisibility()}},t})();t.ExplorationNavigationTabController=o})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){function r(e){var t=e.overridePosition||e.position;return{height:t.height,width:t.width,top:t.y,left:t.x}}function o(t){return 0!==t.contract.visibility?e.common.constants.MaxSupportedZIndexValue:t.position.z}var n=e.explore.util.CanvasDisplayUtility,a=e.explore.controllers.canvas.CanvasLayoutGrid,s=i.canvas.CanvasLayoutGridStrategy,l=t.util.CanvasVisualsUtility,c=e.visuals.ColorHelper,u=e.common.constants,p=e.data.DataViewObjectDefinitions,d=i.canvas.DefaultLayoutStrategy,h=i.canvas.DotGridLayoutStrategy,v=e.explore.util.DotGridUtil,g=e.explore.util.DragDropTypes,f=jsCommon.DragDropUtils,y=e.explore.services.events,m=e.visuals.shapes.Rect,S=e.explore.contracts.Section,w=e.explore.controllers.canvas.SmartGuideStrategy,C=e.explore.util.VisualContainerUtils;i.CursorClass={Brush:"brush-cursor"};var b={width:0,height:0},x=0,F=0,D="foregroundNeutralDark",V=(function(){function V(r,o){var a=this;this.uiScale=V.DefaultNoUiScale,this.isDraggingVisual=!1,this.scope=r,this.model=r.viewModel,this.services=o,this.scopeEventManager=e.common.createScopeEventSubscriptionManager(r),this.scope.displayOptionServices={canvasScale:this.services.canvasScale,viewModeState:this.services.viewModeState,formFactor:this.services.formFactor,eventBridge:this.services.eventBridge,explorationCapabilities:this.services.explorationCapabilities},this.viewModeState=this.services.viewModeState,this.scope.clearSelection=function(e){a.scope.viewModel&&a.scope.viewModel.preventSelectionClearing||t.util.EventBubblingUtility.handled(e)||(a.services.selection.clearSelection(),a.services.overlayService.hideAllDropdowns(),a.services.clipboard.clearFormatData())},this.showDotGrid=o.settingsService.getShowGridlines(),this.snapToDotGrid=o.settingsService.getSnapToGrid(),this.scope.keyDown=function(e){return a.onKeyDown(e)},this.scope.drop=function(e,t){return a.drop(e,t)},this.scope.dropConfig={accept:g.Field+" "+g.VisualContainerThumbnail},this.scope.getExploreCanvasClass=function(){return a.getExploreCanvasClass()},this.scope.useNewFilterPane=!1,this.scope.isOutspacePaneVisible=!1,this.scope.shouldDisableZoom=function(){return a.shouldDisableZoom()},this.scope.canPinch=function(){return a.canPinch()},this.scope.canSwipe=function(){return a.canSwipe()},this.scope.isCanvasBackdropVisible=function(){return a.isCanvasBackdropVisible()},this.scope.showBoxGrid=function(){return a.services.formFactor.getCurrentLayoutCapabilities().canShowLayoutGrid()&&1===a.services.formFactor.getCurrentLayout()},this.scope.showDotGrid=function(){return a.showDotGrid&&a.services.formFactor.getCurrentLayoutCapabilities().canShowLayoutGrid()&&0===a.services.formFactor.getCurrentLayout()},this.scope.snapToDotGrid=function(){return a.snapToDotGrid&&0===a.services.formFactor.getCurrentLayout()},this.scope.showOutspaceImage=function(){return a.canShowOutspaceImage()&&!!a.scope.outspaceBackground.imageSource},this.scope.showBackgroundImage=function(){return!a.hideBackgroundImage()&&!!a.scope.canvasBackground.imageSource},this.scope.isVisualContainerVisible=function(e){return!e.isHidden},this.scope.adjustScaleForLayout=function(e){return a.adjustScaleForLayout(e)},this.scope.shouldDisableScroll=function(){return a.shouldDisableScroll()},this.scope.showQna=function(e){return a.showQna(e)},this.scope.isMobileLayoutAuthoring=function(){return 0!==o.formFactor.getCurrentLayout()&&1===o.viewModeState.getMode()},this.scope.canvasPinchStart=function(e){a.services.hostTooltip&&a.services.hostTooltip.hide({isTouchEvent:!0,immediately:!0}),1===e&&n.storeOverflowValuesAndChange(a.services.$element,jsCommon.CssConstants.visibleValue),a.pinchStartScale=e},this.scope.canvasPinchEnd=function(e){1===e&&n.restoreOverflowValues(a.services.$element);var t;t=void 0===a.pinchStartScale||e===a.pinchStartScale?0:e>a.pinchStartScale?1:2,a.services.eventBridge.publishToChannel(y.canvasPinched,{direction:t})},this.scope.outspaceBackground={},this.scope.canvasBackground={},this.subscribeToEvents(),this.scope.$watch("size",(function(e){if(e){var i=a.services.canvasScale.getDisplayOption();a.scope.useResponsiveLayout=e.width<=t.constants.ExploreCanvasConstants.ResponsiveLayoutMaxWidthBreakpoint&&a.scope.viewModel&&a.scope.viewModel.contract&&0===i,a.updateSize(),a.resetThemableProperties(),a.services.eventBridge.publishToChannel(y.canvasSizeChangedEvent)}})),this.layout=i.createCanvasLayout(this.services.canvasScale),this.updateCanvasLayoutSize(),this.updateLayoutStrategy(),this.scope.$watchCollection("viewModel.visualContainers",(function(){a.scaleVisualContainersToCanvas(a.uiScale),a.scope.viewModel&&a.services.lazyScoped("loadProgressNotification").then((function(e){e.register(a),e.reset()}))})),this.scope.canvasOptions||(this.scope.canvasOptions={autoLayoutVisualPadding:t.constants.ExploreCanvasConstants.AutoLayoutVisualPadding,scrollbarOffset:t.constants.ExploreCanvasConstants.ScrollbarOffset}),this.services.lazyScoped("loadProgressNotification").then((function(e){e.register(a)}))}return V.createOptions=function(){return{additionalServices:["conceptualSchemaProxy","dragDataService","layoutInsertionHelper","$element","featureSwitchService","lazySync","telemetryService","hostTooltip","overlayService","dropdownMenuService","promiseFactory","settingsService","$compile","themeService"],scopedDependencies:["canvasScale","canvasKeyHandler","canvasScale","clipboard","dataSources","eventBridge","explorationCapabilities","explorationNavigation","formFactor","visibility","resourceLoader","selection","undoRedo","viewModeState","visualAuthoring","visualQueryGenerator","lazyScoped","lazyScopedSync"]}},V.prototype.$onInit=function(){return __awaiter(this,void 0,e.Promise,(function(){var e;return __generator(this,(function(t){return e=this.services.explorationNavigation&&this.services.explorationNavigation.getCurrentExploration(),e&&(this.updateUseNewFilterPaneSettings(e),this.updateIsOutspacePaneVisible(e.evaluatedObjects)),[2]}))}))},V.prototype.getIsOutspacePaneVisible=function(){return!this.scope.disableOutspacePane&&this.scope.isOutspacePaneVisible&&!this.scope.isMobileLayoutAuthoring()&&this.services.explorationCapabilities.getCapabilities().showVisualizationPane},V.prototype.resetThemableProperties=function(){this.evaluateObjects(),this.updateAndApplyCanvasOutspaceOrBackground(1),this.updateAndApplyCanvasOutspaceOrBackground(2),this.updateDotGridLayout()},V.prototype.updateIsOutspacePaneVisible=function(t){var i=t&&t.outspacePane;this.scope.isOutspacePaneVisible=e.DataViewObject.getValue(i,"visible",!0)&&this.scope.useNewFilterPane},V.prototype.evaluateObjects=function(){var i=this.services.explorationNavigation.getCurrentExploration();if(this.scope.viewModel&&i){var r=i.themeCollection,o=this.services.themeService,n=t.constants.SectionComponentType,a=this.scope.viewModel.contract,s=a.objects,l=o.getVisualObjects(r,n,void 0,S.objectDescriptors);l&&(s=p.clone(s||{}),p.extend(s,l));var c=o.getVisualStyle(r),u=e.data.createStaticEvalContext(c);a.evaluatedObjects=e.data.DataViewTransform.evaluateMetadataOnceDataViewObjectDefinitions(s,S.objectDescriptors,u)}},V.prototype.isScrollablePhoneAuthoring=function(){return 0!==this.services.formFactor.getCurrentLayout()&&1===this.services.viewModeState.getMode()},V.prototype.shouldTrackLoadProgress=function(){var e=!1;if(this.scope.viewModel&&this.scope.viewModel.visualContainers.length>0){var t=this.services.dataSources.get();if(t)for(var i=0,r=this.scope.viewModel.visualContainers;i<r.length;i++){var o=r[i];if(this.services.visualQueryGenerator.shouldExecute(o.contract.config.singleVisual,t)){e=!0;break}}}return e},V.prototype.cancelTracking=function(e){if(this.scope.viewModel&&this.scope.viewModel.visualContainers.length>0)for(var t=0,i=this.scope.viewModel.visualContainers;t<i.length;t++){var r=i[t];r.showProgressBar&&(r.errorInfo={details:{message:e,displayableErrorInfo:null},fixableError:0,code:"VisualLoadingCanceled",hideSeeDetails:!0})}this.services.lazyScoped("loadProgressNotification").then((function(e){e.cancelTracking()}))},V.prototype.onPrintStarting=function(){this.savedCanvasOptions=this.scope.canvasOptions,this.scope.canvasOptions=__assign({},this.savedCanvasOptions,{disableDeferredRendering:!0})},V.prototype.onPrintFinished=function(){this.scope.canvasOptions=this.savedCanvasOptions},V.prototype.subscribeToEvents=function(){var i=this,r=this.services.eventBridge.createChannelSubscriptionManager().subscribe(e.events.visualThemeChanged,(function(e,t){return i.resetThemableProperties()})).subscribe(y.selectionChanged,(function(){return i.onSelectionChanged()})).subscribe(y.explorationLoaded,(function(){return i.onExplorationLoaded()})).subscribe(y.explorationObjectsLoaded,(function(e,t){return i.updateIsOutspacePaneVisible(t.evaluatedObjects)})).subscribe(y.explorationUnloaded,(function(e,t){return i.onExplorationUnloaded()})).subscribe(y.canvasBackgroundChanged,(function(e,t){return i.resetThemableProperties()})).subscribe(y.canvasDisplayChanged,(function(e,t){return i.applyFitOption(t)})).subscribe(y.canvasDimensionChanged,(function(e,t){return i.updateCanvasDimension(t)})).subscribe(y.align,(function(e,t){return i.alignVisuals(t)})).subscribe(y.visibilityChanged,(function(){return i.onPopOutModeChanged()})).subscribe(y.clipboardDataUpdated,(function(){return i.onClipboardDataUpdated()})).subscribe(y.formFactorChanged,(function(){return i.onFormFactorChanged()})).subscribe(y.canvasLayoutChanged,(function(){return i.onCanvasLayoutChanged()})).subscribe(y.sectionLayoutRemoved,(function(){return i.onSectionLayoutRemoved()})).subscribe(y.deleteVisualContainer,(function(e,t){return i.services.visualAuthoring.deleteVisualContainer(t,i.scope.viewModel)})).subscribe(e.common.events.printStarting,(function(){return i.onPrintStarting()})).subscribe(e.common.events.printFinished,(function(){return i.onPrintFinished()})).subscribe(y.explorationSettingsLoaded,(function(e,t){return i.onExplorationSettingsLoaded(t)}));this.scope.$watch((function(){return i.services.settingsService.getShowGridlines()}),(function(){return i.onShowGridlinesChanged()})),this.scope.$watch((function(){return i.services.settingsService.getSnapToGrid()}),(function(){return i.onSnapToGridChanged()})),this.scope.$watch((function(){return i.services.settingsService.getLockObjects()}),(function(){return i.onLockObjectsChanged()})),this.scope.$watch((function(){return i.services.settingsService.getShowSmartGuides()}),(function(){return i.onShowSmartGuidesChanged()}));var o=this.scope.$on(e.common.constants.visualCancelLoadEventName,(function(e,t){return i.cancelTracking(t)}));this.scope.$on("$destroy",(function(){o(),r.unsubscribeAll()})),this.scopeEventManager.subscribe(t.constants.TransformElementDragStartEventName,(function(e,t){i.onDragStartPosition={x:t.x,y:t.y,width:t.width,height:t.height},i.isDraggingVisual=!0})).subscribe(t.constants.TransformElementDragMoveEventName,(function(e,t){i.moveSelectedContainersWrapper(e,t)})),this.services.eventBridge.subscribeToBubbling(this.scope,y.removeVisualContainerFromLayout,(function(e,t){i.services.lazyScopedSync("layoutAuthoring").removeLayoutFromVisualContainer(i.scope.viewModel,t),
e.stopPropagation&&e.stopPropagation()}))},V.prototype.onExplorationSettingsLoaded=function(t){if(t.useNewFilterPaneExperienceChanged){var i=this.services.explorationNavigation.getCurrentExploration();this.updateUseNewFilterPaneSettings(i),this.updateIsOutspacePaneVisible(i.evaluatedObjects),this.services.telemetryService.logEvent(e.telemetry.EXImprovedFilterExperienceToggleReportSetting,this.scope.useNewFilterPane)}},V.prototype.onSectionLayoutRemoved=function(){var e=this.services.formFactor.getCurrentLayout();_.remove(this.model.visualContainers,(function(t){return!t.contract.layouts.withId(e)})),this.services.eventBridge.publishToChannel(y.canvasChanged)},V.prototype.onShowGridlinesChanged=function(){this.showDotGrid=this.services.settingsService.getShowGridlines(),this.scope.applyFitOption()},V.prototype.onSnapToGridChanged=function(){this.snapToDotGrid=this.services.settingsService.getSnapToGrid(),this.updateLayoutStrategy()},V.prototype.onShowSmartGuidesChanged=function(){this.updateLayoutStrategy()},V.prototype.onLockObjectsChanged=function(){if(1===this.services.viewModeState.getMode()){var e=this.services.settingsService.getLockObjects();this.services.viewModeState.getViewState().lockObjects=e,this.updateGridLayout()}},V.prototype.applyFitOption=function(e){this.services.canvasScale.setDisplayOption(e),this.scope.applyFitOption()},V.prototype.moveSelectedContainersWrapper=function(e,t){var i=this;this.services.selection.getSelectedElements().length>1&&this.services.formFactor.getCurrentLayoutCapabilities().canMoveMultipleVisuals()&&(this.isDraggingVisual?(this.isDraggingVisual=!1,this.services.undoRedo.register("MoveSelectedVisualContainers",(function(){i.moveSelectedContainers(e,t)}))):this.moveSelectedContainers(e,t))},V.prototype.alignVisuals=function(e){var t={width:this.model.width,height:this.model.height};this.services.lazyScopedSync("layoutAuthoring").alignSelectedVisuals(e.alignmentType,t,l.getSelectedCanvasVisualContainers(this.scope.viewModel,this.services.selection)),this.scope.$broadcast(u.VisualSelectionOrPositionChangedEventName)},V.prototype.moveSelectedContainers=function(e,t){for(var i=this.onDragStartPosition,r={x:i.x-t.x,y:i.y-t.y,width:0,height:0},o=l.convertFromScaledPosition(r,this.uiScale),n=0,a=this.model.visualContainers;n<a.length;n++){var s=a[n];if(s.isSelected){var c=_.cloneDeep(s.position);c.x-=o.x,c.y-=o.y;this.services.lazyScopedSync("layoutAuthoring").moveVisualContainer(s,c)}}i.x=t.x,i.y=t.y},V.prototype.updateCanvasDimension=function(e){var i=this;this.services.undoRedo.register("UpdateCanvasDimension",(function(){i.scope.viewModel.contract.size=e;var r=i.services.explorationNavigation.getCurrentExploration(),o=i.services.explorationNavigation.getCurrentSection(),a=n.isCortanaPageSize(e);t.PodUtils.setCortanaEnabled(r,o.name,a,i.services.lazySync("linguisticSchemaProxy"))}))},V.prototype.onPopOutModeChanged=function(){this.scope.hasPopOut=!!this.services.visibility.get(),this.updateSizeAndFitOption(),this.resetThemableProperties()},V.prototype.onCanvasLayoutChanged=function(){this.updateSizeAndFitOption()},V.prototype.onFormFactorChanged=function(){this.services.overlayService.hideAllDropdowns(),this.updateSizeAndFitOption(),this.updateLayoutStrategy(),this.resetThemableProperties()},V.prototype.updateAndApplyCanvasOutspaceOrBackground=function(e){var t=this.services.explorationNavigation.getCurrentExploration();if(this.scope.viewModel&&t){var i=this.scope.viewModel.contract.evaluatedObjects,r=t.themeCollection,o=this.services.themeService.getVisualStyle(r);n.updateAndApplyBackground(e,this.scope,this.services.$element,i,this.services.featureSwitchService,this.services.resourceLoader,this.services.explorationNavigation,this.services.promiseFactory,this.services.formFactor,this.scope.displayOptionServices.viewModeState,o,this.services.canvasScale),2===e&&n.setDisplayAreaBackground(this.scope,i)}},V.prototype.updateSizeAndFitOption=function(){this.scope.viewModel&&(this.scope.applyFitOption(),this.updateSize())},V.prototype.updateLayoutStrategy=function(){var e,i=this.services.formFactor.getCurrentLayout(),r=this.services.formFactor.getCurrentLayoutCapabilities(),o=t.viewModels.VisualContainer.getVisualBodyOffset(r,this.services.explorationCapabilities);switch(i){case 1:var n=t.viewModels.FixedPhoneCanvasSettings.phoneGridLayout;e=new s({rows:n.rowCount,cols:n.columnCount,rowSpacing:F,colSpacing:x});break;default:if(this.scope&&this.scope.snapToDotGrid&&this.scope.snapToDotGrid()){var a=void 0,l=void 0,c=this.scope.dotGridViewModel,u=this.scope.canvasLayoutSize;c?(a=c.layoutX,l=c.layoutY):(a=v.getLayoutForScreen(this.uiScale.x*u.width,u.width),l=v.getLayoutForScreen(this.uiScale.y*u.height,u.height));e=new h({layoutX:a,layoutY:l,offset:o,lazyScopedSync:this.services.lazyScopedSync,limits:{left:0,top:0,width:u.width,height:u.height}})}else e=new d(o,this.services.lazyScopedSync)}this.services.featureSwitchService.featureSwitches.redlineAlignment&&0===i&&this.services.settingsService.getShowSmartGuides()&&(this.scope.smartGuideViewModel=this.scope.smartGuideViewModel||{guides:[]},e=new w(e,this.services.selection,this.scope.smartGuideViewModel)),this.layout.setStrategy(e),this.updateGridLayout()},V.prototype.adjustScaleForLayout=function(e){return this.scope.showDotGrid()?v.adjustScaleForGrid(e,this.scope.canvasLayoutSize):e},V.prototype.updateGridLayout=function(){this.model&&(this.updateBoxGridLayout(),this.updateDotGridLayout())},V.prototype.updateDotGridLayout=function(){var t=this.services.explorationNavigation.getCurrentExploration();if(t){var i=this.scope.canvasLayoutSize,r=this.scope.dotGridViewModel,o=!r,n=v.getLayoutForScreen(this.uiScale.x*i.width,i.width),a=r&&r.layoutX;o||(o=!v.sameLayout(n,a));var s=v.getLayoutForScreen(this.uiScale.y*i.height,i.height),l=r&&r.layoutY;o||(o=!v.sameLayout(s,l));var u=this.services.themeService.getVisualStyle(t.themeCollection),p=c.getThemeColor(u,e.visuals.ForegroundColorName),d=r&&r.color;o||(o=p!==d),o&&(this.scope.dotGridViewModel={layoutX:n,layoutY:s,color:p})}},V.prototype.updateBoxGridLayout=function(){var e=this.services.explorationNavigation.getCurrentExploration();if(e){var i,r=t.viewModels.FixedPhoneCanvasSettings.phoneGridLayout;switch(this.services.formFactor.getCurrentLayout()){case 1:var o={rows:r.rowCount,cols:r.columnCount,rowSpacing:F,colSpacing:x},n=a.getCellSize({width:this.model.width,height:this.model.height},o),s=this.services.themeService.getVisualStyle(e.themeCollection);i={columnCount:r.columnCount,rowCount:r.rowCount,layout:{horizontal:{margin:x,gutter:x,size:n.width},vertical:{margin:F,gutter:F,size:n.height}},style:{color:c.getThemeColor(s,D),fullOpacity:s.isHighContrast}};break;default:i=void 0}this.scope.boxGridLayout=i}},V.prototype.autoLayoutVisualVCHeader=function(){return n.getAutoLayoutVisualVCHeader(this.services.formFactor,this.services.explorationCapabilities)},V.prototype.updateSize=function(){var e=this.scope.size;if(this.model=this.scope.viewModel,e&&this.model){if(0===this.services.canvasScale.getDisplayOption()){var t=this.services.viewModeState.getConfig(),i=t.displayOptions.hideTileMenu?e.height:e.height-this.autoLayoutVisualVCHeader(),r=e.width;this.uiScale={x:r/this.model.width,y:i/this.model.height}}else{var o=this.services.canvasScale.getDisplayAreaScaleFactor();this.uiScale={x:o,y:o}}this.scaleVisualContainersToCanvas(this.uiScale),this.updateCanvasLayoutSize(),this.updateLayoutStrategy()}},V.prototype.updateCanvasLayoutSize=function(){var e=this.scope.viewModel;e?this.scope.canvasLayoutSize={width:e.width,height:e.height}:this.scope.canvasLayoutSize=b,this.layout.setCanvasSize(this.scope.canvasLayoutSize),this.updateGridLayout()},V.prototype.scaleVisualContainersToCanvas=function(e){var i=this;if(this.model=this.scope.viewModel,this.model){for(var r=this.model.visualContainers,o=this.services.visibility.get(),n=this.services.canvasScale.getDisplayOption(),a=this.scope.viewModel.contract.size&&3!==n&&0!==n,s=0,l=r;s<l.length;s++){var c=l[s];if(c.uiScale=e,c.enableVisualScaling=a,!c.isPositioned){var u=this.getEmptyRawCanvasSpaces();u.z=r.length;this.services.lazyScopedSync("layoutAuthoring").moveVisualContainer(c,u)}o?this.setVisualContainerSizeForPopOutMode(c):this.scope.useResponsiveLayout||(c.overridePosition=null,c.updateViewState()),this.scope.canvasOptions.disableDeferredRendering&&(c.allowDeferredRendering=!1)}if(this.scope.useResponsiveLayout&&!o)for(var p=0,d=_.sortBy(r,(function(e){return e.position.y*i.model.width+e.position.x})),h=0,v=d;h<v.length;h++){var c=v[h],g=c.getScaledPosition();p+=20,c.overridePosition={width:this.scope.size.width-2*t.constants.ExploreCanvasConstants.AutoLayoutVisualSkittlesRightPadding,height:g.height,x:t.constants.ExploreCanvasConstants.AutoLayoutVisualSkittlesRightPadding,y:p},p+=Math.round(g.height),c.updateViewState()}}},V.prototype.setVisualContainerSizeForPopOutMode=function(e){if(e.isPoppedOut){var i=this.services.formFactor.getCurrentLayoutCapabilities(),r=t.viewModels.VisualContainer.getVisualBodyOffset(i,this.services.explorationCapabilities),o=this.scope.size.height,n=this.scope.size.width;if(0!==this.services.canvasScale.getDisplayOption()){var a=this.services.canvasScale.getDisplayAreaScaleFactor();o=this.scope.viewModel.height*a-r.height,n=this.scope.viewModel.width*a-r.width}e.overridePosition={width:n,height:o,x:-r.left,y:-r.top},e.updateViewState()}},V.prototype.onSelectionChanged=function(){this.scope.canvasOptions.disableFocusOnExploreCanvas||this.getFocusOnClearSelection()},V.prototype.onExplorationLoaded=function(){this.resetThemableProperties(),this.applyFitToPageIfAny(),this.updateUseNewFilterPaneSettings(this.services.explorationNavigation.getCurrentExploration())},V.prototype.applyFitToPageIfAny=function(){var e=this;jsCommon.QueryStringUtil.getQueryStringValue("loadFitToPage")&&this.services.timeout((function(){e.applyFitOption(1)}),0,!1)},V.prototype.onExplorationUnloaded=function(){this.services.dropdownMenuService.hideMenu(),this.scope.suspendSizeUpdates&&this.scope.suspendSizeUpdates()},V.prototype.isCanvasBackdropVisible=function(){return this.services.formFactor.getCurrentLayoutCapabilities().canShowCanvasBackdrop()},V.prototype.getFocusOnClearSelection=function(){var e=this.services.selection;_.isEmpty(e.getSelectedElements())&&(this.scope.hasFocus=!0)},V.prototype.getEmptyRawCanvasSpaces=function(){if(this.scope.size){var e={x:0,y:0,width:this.model.width,height:this.model.height},i=_.map(this.model.visualContainers,(function(e){var t=e.position;return{x:Math.round(t.x),y:Math.round(t.y),width:Math.round(t.width),height:Math.round(t.height)}})),r=this.services.layoutInsertionHelper.getEmptySpaces(e,i);if(r.length>0){var o=r[0];o.height=Math.min(o.height,t.constants.ExploreCanvasConstants.AutoLayoutMaxSpaceHeight),o.width=Math.min(o.width,t.constants.ExploreCanvasConstants.AutoLayoutMaxSpaceWidth);var a=this.scope.canvasOptions.autoLayoutVisualPadding,s=this.autoLayoutVisualVCHeader();if(o.x+=a,o.y+=s,o.width-=2*a,o.height-=2*a,!_.some(this.model.visualContainers,(function(e){return e.isPositioned})))return o;var l={x:o.x+o.width/2,y:o.y+o.height/2},c=this.services.lazyScopedSync("layoutAuthoring"),u=c.getLayoutForNewVisualContainerWithRects(_.map(i,n.visualPositionToRect),l,e);return n.rectToVisualPosition(u)}}return n.DefaultVisualPosition},V.prototype.drop=function(e,i){var r=this,o=this.services.dragDataService.getDragContext();if(o){var a={left:0,top:0};if(e.target){var s=$(e.target).find(n.VisualContainerHostSelector.selector);s&&(a=s.offset())}var c,u=e.pageX-a.left,p=e.pageY-a.top;if(0===this.services.canvasScale.getDisplayOption()&&(c=this.uiScale),o.field){var d=this.services.formFactor.getCurrentLayoutCapabilities(),h=t.viewModels.VisualContainer.getVisualBodyOffset(d,this.services.explorationCapabilities),v=u,g=p;this.services.formFactor.getCurrentLayoutCapabilities().canShowVisualContainerHeaderInset()||(g-=h.top);var y=c;if(!y){var m=this.services.canvasScale.getDisplayAreaScaleFactor();y={x:m,y:m}}var S=v/y.x,w=g/y.y;if(f.tryFindChildDropTarget(i.draggable,(function(){return r.getVisualContainerFromCoordinate(S,w)})))return}var C=this.layout.getDropPosition(u,p,c);if(C){var b=n.rectToVisualPosition(C);if(o.field)b.z=l.getZIndexForNewVisual(this.scope.viewModel),this.addVisual(o.field,b);else if(o.source){var x=o.source,F=this.services.lazyScopedSync("layoutAuthoring");F.addLayoutToVisualContainer(this.scope.viewModel,x,b)}}}},V.prototype.getVisualContainerFromCoordinate=function(e,t){var i={x:e,y:t},n=this.scope.viewModel.visualContainers,a=_.filter(n,(function(e){return m.containsPoint(r(e),i)}));if(!_.isEmpty(a)){return _.maxBy(a,(function(e){return o(e)})).contract}},V.prototype.addVisual=function(t,i){var r=this,o=this.services.dataSources.get();o&&this.services.visualAuthoring.addVisualContainer({expr:t,dataSources:o,allowAggregate:!0},this.scope.viewModel,i).then((function(t){r.services.telemetryService.logEvent(e.telemetry.EXCreateVisual,"DraggedToCanvas",C.getVisualType(t))}))},V.prototype.onKeyDown=function(e){return this.services.canvasKeyHandler.onKeyDown(e,this.scope.viewModel)},V.prototype.onClipboardDataUpdated=function(){this.updateCanvasCursor()},V.prototype.updateCanvasCursor=function(){var e=this.services.clipboard.canPasteFormat();this.setCursorClass(e?i.CursorClass.Brush:void 0)},V.prototype.setCursorClass=function(e){this.scope.customCursorClass=e},V.prototype.shouldDisableZoom=function(){return this.viewModeState.getConfig().touchOptions.disableTouchZoom},V.prototype.getExploreCanvasClass=function(){var e=[];return this.scope.disableAnimations&&e.push("disableAnimations"),this.scope.useResponsiveLayout&&e.push("responsive"),this.services.visibility.get(4)?e.push("hasSpotlight"):this.services.visibility.get()&&(e.push("popOut"),this.services.visibility.get(10)&&e.push("seeData")),this.scope.customCursorClass&&e.push(this.scope.customCursorClass),this.shouldDisableZoom()&&e.push("disableTouchZoom"),this.isScrollablePhoneAuthoring()&&e.push("scrollablePhoneAuthoring"),this.services.explorationCapabilities.getCapabilities().visualContainerOptions.useStylableHeader&&e.push("stylableVisualContainerHeader"),0===this.services.formFactor.getCurrentLayout()?e.push("master-form-factor"):e.push("phone-form-factor"),e.join(" ")},V.prototype.canSwipe=function(){return this.services.viewModeState.getConfig().touchOptions.isCanvasSwipeable},V.prototype.canPinch=function(){return!(this.viewModeState&&this.viewModeState.getConfig().touchOptions.disableCanvasPinch)},V.prototype.shouldDisableScroll=function(){return this.viewModeState.getConfig().touchOptions.disableCanvasScrollOnSelectedVisual},V.prototype.canShowOutspaceImage=function(){return!this.services.viewModeState.getConfig().displayOptions.hideOutspaceImage},V.prototype.hideBackgroundImage=function(){return this.services.viewModeState.getConfig().displayOptions.hideBackgroundImage||1===this.services.viewModeState.getMode()&&1===this.services.formFactor.getCurrentLayout()},V.prototype.showQna=function(t){return __awaiter(this,void 0,e.Promise,(function(){return __generator(this,(function(e){return t.target===t.currentTarget&&(t.stopPropagation&&t.stopPropagation(),this.services.eventBridge.publishToChannel(y.addQnaContainer,{pointOfInterest:{x:t.offsetX/this.uiScale.x,y:t.offsetY/this.uiScale.y},sourceOfCreation:1})),[2]}))}))},V.prototype.updateUseNewFilterPaneSettings=function(e){this.scope.useNewFilterPane=e&&e.settings&&e.settings.useNewFilterPaneExperience},V.DefaultNoUiScale={x:1,y:1},V})();i.ExploreCanvasController=V})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=e.explore.services.events,o=e.explore.services.SectionNavigationAction,n=(function(){function i(t,i){var o=this;this.scope=t,this.services=i,this.services.explorationActivity.registerExplorationHostScope(t),this.services.eventBridge.setBubblingScope(t).subscribe(r.switchSection,(function(e,t){return o.onSwitchSection(e,t)})).subscribe(r.reorderSection,(function(e,t){return o.onReorderSection(e,t)})).subscribe(r.visualConversion,(function(e,t){return o.onVisualConversion(t)})).subscribe(r.undo,(function(e,t){return i.undoRedo.undo()})).subscribe(r.redo,(function(e,t){return i.undoRedo.redo()}));var n=this.services.rootScope.$on(e.explore.constants.explorationNextPageEvent,(function(e,t){return o.switchToAdjacentSection(!0,t)})),a=this.services.rootScope.$on(e.explore.constants.explorationPreviousPageEvent,(function(e,t){return o.switchToAdjacentSection(!1,t)})),s=this.services.rootScope.$on(e.explore.constants.deleteSectionEvent,(function(e,t){return o.onDeleteSection(e,t)})),l=this.services.rootScope.$on(e.explore.constants.insertSectionEvent,(function(e,t){return o.onInsertSection(e,t)})),c=this.services.rootScope.$on(e.explore.constants.switchSectionEvent,(function(e,t,i){return o.onSwitchSection(e,t,i)})),u=this.services.eventBridge.createChannelSubscriptionManager().subscribe(r.podParameterChanged,(function(e,t){return o.onPodParameterChanged(t)})).subscribe(r.createSection,(function(e,t){return o.onCreateSection(e,t)})).subscribe(r.duplicateSection,(function(e,t){return o.onDuplicateSection(e,t)})).subscribe(r.deleteSection,(function(e,t){return o.onDeleteSection(e,t)}));t.$on(e.common.constants.scopeDestroyEventName,(function(){n(),a(),s(),l(),c(),u.unsubscribeAll()}))}return i.createOptions=function(){return{additionalServices:["explorationSerializer","lazySync","localizationService","telemetryService","featureSwitchService"],scopedDependencies:["dataSources","eventBridge","explorationActivity","explorationNavigation","formFactor","lazyScoped","selection","undoRedo","visualAuthoring","visualPlugin","viewModeState"]}},i.prototype.switchToAdjacentSection=function(t,i){var r=this;void 0===i&&(i=o.Unknown);var n=this.scope.viewModel.exploration&&this.scope.viewModel.exploration.sections;if(n){var a=this.scope.viewModel.sectionStatus&&this.scope.viewModel.sectionStatus.currentSectionNumber;if(null==a)return;this.services.explorationActivity.doActivity((function(){var e=a,o=n.length;do e+=t?1:-1,(e<0||e===o)&&(e=o-Math.abs(e));while(e!==a&&0===r.services.viewModeState.getMode()&&1&n[e].contract.visibility);r.services.explorationNavigation.updateActiveSection({targetSectionIndex:e,navigationAction:i,forceUpdate:!0})}),(function(i){return r.services.telemetryService.startActivity(i,e.telemetry.EXSwitchToAdjacentSection,t)}))}},i.prototype.onSwitchSection=function(t,i,r){var o=this;t.stopPropagation&&t.stopPropagation(),this.scope.viewModel.exploration&&this.services.explorationActivity.doActivity((function(){return o.services.explorationNavigation.updateActiveSection({targetSectionIndex:i,forceUpdate:!0,canvasLayout:r})}),(function(t){return o.services.telemetryService.startActivity(t,e.telemetry.EXSwitchSection,i,r)}))},i.prototype.onCreateSection=function(e,t){var i=this;if(this.scope.viewModel.exploration){var r=t?t.size:void 0;return e.stopPropagation&&e.stopPropagation(),this.services.lazyScoped("explorationAuthoring").then((function(e){e.createSection(i.scope.viewModel,r)}))}},i.prototype.onDuplicateSection=function(e,t){if(this.scope.viewModel.exploration){e.stopPropagation&&e.stopPropagation();var i=this.scope.viewModel;return this.services.lazyScoped("explorationAuthoring").then((function(e){e.duplicateSection(i,t)}))}},i.prototype.onDeleteSection=function(e,t){if(this.scope.viewModel.exploration){e.stopPropagation&&e.stopPropagation();var i=this.scope.viewModel;return this.services.lazyScoped("explorationAuthoring").then((function(e){e.deleteSection(i,t.targetSectionIndex,t.addToUndoRedoStack)}))}},i.prototype.onInsertSection=function(e,t){if(this.scope.viewModel.exploration){e.stopPropagation&&e.stopPropagation();var i=this.scope.viewModel;return this.services.lazyScoped("explorationAuthoring").then((function(e){e.insertSection(i,t)}))}},i.prototype.onReorderSection=function(e,t){var i=this;return e.stopPropagation&&e.stopPropagation(),this.services.lazyScoped("explorationAuthoring").then((function(e){e.reorderSection(i.scope.viewModel,t.originalIndex,t.targetIndex)})).then((function(){var e=i.scope.viewModel.exploration.contract,t=_.find(i.scope.viewModel.exploration.sections,(function(e){return e.selected})),r={exploration:e,section:t.contract.name};i.services.explorationNavigation.updateExplorationActiveSectionIndex(r)}))},i.prototype.onVisualConversion=function(e){this.services.visualAuthoring.convert(e.visualContainer,this.services.dataSources.get(),e.newVisualType).then((function(){e.actionAfterConversion&&e.actionAfterConversion()}))},i.prototype.onPodParameterChanged=function(e){var i=this;if(this.scope.viewModel.exploration){var r=this.scope.viewModel.exploration.contract;if(r){var o=this.services.explorationNavigation.getCurrentSection(),n=function(){switch(e.type){case 0:t.PodUtils.addParameter(r,o.name,e.filterName);break;case 1:case 2:t.PodUtils.deleteParameter(r,o.name,e.filterName,i.services.lazySync("linguisticSchemaProxy"))}};e.isCausedByCode?n():this.services.undoRedo.register("PodParameterChanged",(function(){n()}))}}},i})();i.ExplorationHostController=n})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i=e.explore.services.events,r=(function(){function e(e,t){var i=this;this.scope=e,this.services=t,this.scope.prev=function(){return i.prev()},this.scope.next=function(){return i.next()},this.scope.getSelectedPageIndex=function(){return i.getSelectedPageIndex()}}return e.createOptions=function(){return{scopedDependencies:["eventBridge"]}},e.prototype.prev=function(){var e=this.getSelectedPageIndex();if(void 0!==e){var t=e-1;t>-1&&this.services.eventBridge.publishBubbling(this.scope,i.switchSection,t)}},e.prototype.next=function(){var e=this.getSelectedPageIndex();if(void 0!==e){var t=e+1;t<this.scope.viewModel.exploration.sections.length&&this.services.eventBridge.publishBubbling(this.scope,i.switchSection,t)}},e.prototype.getSelectedPageIndex=function(){if(this.scope.viewModel.exploration)for(var e=this.scope.viewModel.exploration.sections,t=e.length-1;t>=0;--t)if(e[t].selected)return t},e})();t.ExplorationPaginatorController=r})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(e,t){this.scope=e,this.services=t,this.scope.eventBridge=this.services.eventBridge,this.scope.schemaItemActivationService=this.services.schemaItemActivation}return e.createOptions=function(){return{scopedDependencies:["eventBridge","schemaItemActivation"]}},e})();e.ModelingContextChangerController=t})(t=e.controllers||(e.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){function t(e,t){return jsCommon.StringExtensions.isNullOrUndefinedOrWhiteSpaceString(e)?"":e.length>=260?t.get("ReportAppBar_SaveError_TooLong"):null}function i(e,i,r,o,n){var a=$.Deferred();n=n||i.get("ModalDialog_Save");var s=e.control();o=o||i.get("ReportAppBar_SaveAsDialogInstructions");var l='<div class="content"><label class="message instructions" for="explorationSaveAsName"></label><input type="text" id="explorationSaveAsName" class="explorationSaveAsName" /><div class="errorMessage"></div></div>',c=$(l);c.find(".message").text(o);var u=c.find(".explorationSaveAsName"),p=[new InJs.ModalDialogAction(n,function(e,t){var i=jsCommon.StringExtensions.trimWhitespace(u.val());s.hideDialog(),a.resolve(i)}),new InJs.ModalDialogAction(i.get("ModalDialog_Cancel"),function(e,t){s.hideDialog(),a.reject()})];return r=r||i.get("ReportAppBar_SaveAsDialogTitle"),s.showCustomDialog(r,c,p,(function(e){e.parent().find('input[value = "'+n+'"]').prop("disabled",!0),u.focus().on("change keyup paste mouseup",(function(r){var o=t($(r.target).val(),i);e.parent().find('input[value = "'+n+'"]').prop("disabled",null!==o),e.parent().find(".errorMessage").text(o)})).on("keyup",(function(e){13===e.which&&null===t($(e.target).val(),i)?p[0].actionCallback(null,null,null):27===e.which&&p[1].actionCallback(null,null,null)}))}),!0),a}e.validateReportName=t,e.showSaveAsDialog=i})(t=e.controllers||(e.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){function i(e,t){for(var i=d.filterTransient(t),r=d.filterTransient(e),o=i.length-1;o>=0;o--){var n=i[o],a=r[o];n.id=a.id,n.objectId=a.objectId;for(var s=n.visualContainers.length-1;s>=0;s--){n.visualContainers[s].id=a.visualContainers[s].id}}}function r(e,t){if(e&&e.sections){var i=e.sections,r=_.findIndex(i,(function(e){return e.name===t}));return r!==-1?r:void 0}}function o(e,t){if(!e||!e.sections)return-1;var i=e.sections;return _.findIndex(i,(function(e){return e===t}))}function n(e,t){return e&&e.sections?p.findWithId(e.sections,t):null}function a(e,t){if(!e||!e.sections)return-1;var i=e.sections;return _.findIndex(i,(function(e){return e.id===t}))}function s(e,t){for(var i=1,r=t.format("Explore_Section_Page",[i.toFixed()]);_.findLastIndex(e,(function(e){return e.displayName===r}))>=0;)r=t.format("Explore_Section_Page",[(++i).toFixed()]);return r}function l(e,t){for(var i=e.sections,r=0,o=i;r<o.length;r++){var n=o[r];n.displayName||(n.displayName=s(e.sections,t))}}function c(e){return _.filter(e,(function(e){return!u(e)}))}function u(e){return!!(1&e.visibility)}var p=jsCommon.ArrayExtensions,d=e.explore.contracts.Section;t.synchronizeSectionsIds=i,t.findSectionIndexForSectionName=r,t.findSectionIndexForSection=o,t.findSectionById=n,t.findSectionIndexForSectionId=a,t.getNextSectionDisplayNameWithIndex=s,t.fillDefaultSectionDisplayNames=l,t.getVisibleSections=c,t.isSectionHidden=u})(i=t.SectionUtils||(t.SectionUtils={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=(function(){function i(e,i){var r=this;this.services=i,this.scope=e,this.scope.toggleTaskPane=function(){return r.toggleTaskPane()},this.scope.exploreUIShellConfig=t.modules.ExploreUIShellModule}return i.createOptions=function(){return{additionalServices:["telemetryService"],scopedDependencies:["viewModeState"]}},i.prototype.toggleTaskPane=function(){this.scope.viewModel.isPaneExpanded=!this.scope.viewModel.isPaneExpanded,this.services.telemetryService.logEvent(e.telemetry.EXTogglePaneExpanded,"Task",this.scope.viewModel.isPaneExpanded,t.util.getTelemetryViewMode(this.services.viewModeState.getMode()))},i})();i.TaskPaneController=r})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=e.data.DataViewObjectDefinitions,o=e.explore.services.events,n=e.explore.modules,a=e.visuals.plugins,s=t.services.selectionUtils,l=e.data.SQExprBuilder,c=t.util.VisualContainerUtils,u=(function(){function i(e,i){var r=this;this.scope=e,this.services=i,this.scope.viewModeState=i.viewModeState,this.scope.setActiveSection=function(e){return r.setActiveSection(e)},this.scope.setActivePagePaneSection=function(e){return r.setActivePagePaneSection(e)},this.scope.toggle=function(){return r.toggle()},this.scope.exploreUIShellConfig=n.ExploreUIShellModule,this.scope.scrollbarsConfig={ignoreOverlay:!1,ignoreMobile:!1},this.scope.focusedSection=this.scope.viewModel.activeSection,this.scope.useNewFilterPane=!1,this.scope.isOutspacePaneVisible=!1,this.scope.toggleOutspacePaneVisibility=function(){return r.toggleOutspacePaneVisibility()},this.updateAll();var a=this.services.eventBridge.createChannelSubscriptionManager().subscribe(o.selectionChanged,(function(){r.updateSections(),r.updateHeader(),r.updatePagePaneSections()})).subscribe(o.explorationLoaded,(function(){return r.onExplorationLoaded()})).subscribe(o.explorationObjectsLoaded,(function(e,t){return r.updateIsOutspacePaneVisible(t.evaluatedObjects)})).subscribe(o.explorationSettingsLoaded,(function(e,t){if(t.useNewFilterPaneExperienceChanged){var i=r.services.explorationNavigation.getCurrentExploration();r.updateUseNewFilterPaneSettings(i),r.updateIsOutspacePaneVisible(i.evaluatedObjects)}}));this.scope.$watchGroup(["viewModeState.getMode()","viewModeState.getConfig().alwaysPopulatePanes"],(function(){return r.updateAll()})),this.scope.$on(t.constants.explorationLoadedEventName,(function(){return r.updateAll()})),this.scope.$on("$destroy",(function(){return a.unsubscribeAll()})),this.initializeHighContrastRules()}return i.createOptions=function(){return{additionalServices:["cssGenerationService","featureSwitchService","localizationService","telemetryService"],scopedDependencies:["eventBridge","selection","viewModeState","visualPlugin","visualPluginOps","explorationNavigation","undoRedo"]}},i.prototype.$onInit=function(){var e=this.services.explorationNavigation.getCurrentExploration();e&&(this.updateUseNewFilterPaneSettings(e),this.updateIsOutspacePaneVisible(e.evaluatedObjects))},i.prototype.initializeHighContrastRules=function(){this.services.cssGenerationService.addRule(".themeableElement .navMarker","{ background: @foregroundColor !important; }"),this.services.cssGenerationService.addRule(".themeableElement .visualizationPane .pivotNav li:focus, .themeableElement .visualizationPane .pivotNav li:hover","{ background-color: @selectedBackgroundColor !important; }"),this.services.cssGenerationService.addRule(".themeableElement .propertyPaneContents .inputField .inputFieldInSlice:hover, \n            .themeableElement .propertyPaneContents .inputField .inputRange:hover, .themeableElement .propertyPaneContents .inputField \n            .themeableElement .inputUpDown:hover, .themeableElement .propertyPaneContents .inputField .paragraph:hover, \n            .themeableElement .propertyPaneContents .inputField .select-element:hover, .themeableElement .propertyPaneContents .inputField .selection-box:hover, \n            .themeableElement .propertyPaneContents .inputField .ui-widget:hover","{ border-color: @selectedBackgroundColor !important; }"),this.services.cssGenerationService.addRule(".themeableElement .propertyPaneContents .inputField .clearAll","{ border-color: transparent !important; }")},i.prototype.setActiveSection=function(e){this.scope.viewModel.previousSection=this.scope.viewModel.activeSection,this.scope.viewModel.activeSection=e,this.updateShowHideElements()},i.prototype.setActivePagePaneSection=function(e){this.scope.viewModel.previousPageSection=this.scope.viewModel.activePageSection,this.scope.viewModel.activePageSection=e,this.updateShowHideElements()},i.prototype.updateAll=function(){var e=this.scope.viewModeState.getMode();this.scope.isEditing=1===e,this.scope.populatePanes=this.scope.isEditing||this.scope.viewModeState.getConfig().alwaysPopulatePanes,this.scope.showVisualTypes=this.scope.populatePanes,this.scope.viewModel&&(this.updateShowHideElements(),this.updateSections(),this.updatePagePaneSections(),this.updateHeader())},i.prototype.updateShowHideElements=function(){var e=this.scope.viewModel.activeSection,i=this.scope.viewModel.activePageSection,r=this.scope.populatePanes,o=this.getSelectedVisual();o?this.scope.showVisualTypes=r&&this.services.visualPluginOps.canConvertVisual(o):this.scope.showVisualTypes=r,this.scope.showFieldWellOrFilters=!e&&!i||e===t.viewModels.VisualizationPaneSectionType.Fields||i===t.viewModels.PagePaneSectionType.Fields,this.scope.showFieldWell=r&&(e===t.viewModels.VisualizationPaneSectionType.Fields||i===t.viewModels.PagePaneSectionType.Fields),this.scope.showPropertyPane=r&&e===t.viewModels.VisualizationPaneSectionType.Format,this.scope.showPagePropertyPane=r&&i===t.viewModels.PagePaneSectionType.Format&&!this.scope.isNonQueryVisual,this.scope.showAnalyticsPane=r&&e===t.viewModels.VisualizationPaneSectionType.Analytics,this.scope.showDrillthroughPane=this.scope.showFieldWellOrFilters&&this.services.featureSwitchService.featureSwitches.measureDrillthrough;
},i.prototype.updateSections=function(){var e=this.getSelectedVisual(),i=this.scope.viewModel,r=c.getVisualType(e),o=this.services.visualPluginOps,n=o.isSupportedVisual(e),a=r&&o.isQueryVisual(r);if(this.scope.isNonQueryVisual=void 0!==e&&!a,i.sections=[],!e||!n)return void this.setActiveSection(void 0);if(this.scope.isEditing&&this.scope.isNonQueryVisual)this.setActiveSection(t.viewModels.VisualizationPaneSectionType.Format);else{var s=i.activeSection;this.scope.isEditing&&void 0!==s||this.setActiveSection(t.viewModels.VisualizationPaneSectionType.Fields),i.sections.push({sectionType:t.viewModels.VisualizationPaneSectionType.Fields,displayName:this.services.localizationService.get("VisualizationPane_Section_Fields"),cssClass:"fields"})}o.canFormatVisual(e)&&(i.sections.push({sectionType:t.viewModels.VisualizationPaneSectionType.Format,displayName:this.services.localizationService.get("VisualizationPane_Section_Format"),cssClass:"format"}),i.sections.push({sectionType:t.viewModels.VisualizationPaneSectionType.Analytics,displayName:this.services.localizationService.get("VisualizationPane_Section_Analytics"),cssClass:"analytics"}))},i.prototype.updatePagePaneSections=function(){var e=this.getSelectedVisual(),i=this.scope.viewModel;return i.pagePaneSections=[],e?void this.setActivePagePaneSection(void 0):(this.scope.isEditing&&void 0!==i.activePageSection||this.setActivePagePaneSection(t.viewModels.PagePaneSectionType.Fields),i.pagePaneSections.push({sectionType:t.viewModels.PagePaneSectionType.Fields,displayName:this.services.localizationService.get("VisualizationPane_Section_Fields"),cssClass:"fields"}),void i.pagePaneSections.push({sectionType:t.viewModels.PagePaneSectionType.Format,displayName:this.services.localizationService.get("VisualizationPane_Section_Format"),cssClass:"format"}))},i.prototype.updateHeader=function(){var e;if(this.scope.populatePanes){var t=this.getSelectedVisual();if(t){var i=t.config.singleVisual.visualType;i===a.basicShape.name?e="VisualizationPane_Shape":i===a.image.name&&(e="VisualizationPane_Image")}e=e||"VisualizationPane_Title"}else e="VisualizationPane_Filters";this.scope.viewModel.header=this.services.localizationService.get(e)},i.prototype.toggle=function(){this.scope.viewModel.isPaneExpanded=!this.scope.viewModel.isPaneExpanded,this.services.telemetryService.logEvent(e.telemetry.EXTogglePaneExpanded,"Visualization",this.scope.viewModel.isPaneExpanded,t.util.getTelemetryViewMode(this.services.viewModeState.getMode()))},i.prototype.getSelectedVisual=function(){return s.getDefaultSelectedVisualInSingleOrMultiCase(this.services.selection)},i.prototype.toggleOutspacePaneVisibility=function(){var t=this;this.scope.isOutspacePaneVisible=!this.scope.isOutspacePaneVisible;var i=l.boolean(this.scope.isOutspacePaneVisible),n=this.services.explorationNavigation.getCurrentExploration();this.services.undoRedo.register("ToggleOutspacePaneVisibility",(function(){void 0===n.objects&&(n.objects={}),r.setValue(n.objects,{objectName:"outspacePane",propertyName:"visible"},null,i),t.services.eventBridge.publishToChannel(o.explorationObjectsChanged)})),this.services.telemetryService.logEvent(e.telemetry.EXImprovedFilterExperienceToggleOutspacePaneVisibility,this.scope.isOutspacePaneVisible)},i.prototype.onExplorationLoaded=function(){var e=this.services.explorationNavigation.getCurrentExploration();e&&this.updateUseNewFilterPaneSettings(e)},i.prototype.updateIsOutspacePaneVisible=function(t){var i=t&&t.outspacePane;this.scope.isOutspacePaneVisible=this.scope.useNewFilterPane&&e.DataViewObject.getValue(i,"visible",!0)},i.prototype.updateUseNewFilterPaneSettings=function(e){this.scope.useNewFilterPane=e.settings&&e.settings.useNewFilterPaneExperience},i})();i.VisualizationPaneController=u})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=(function(){function i(e,t){this.modalDialogService=e,this.localizationService=t}return i.prototype.show=function(i,r,o){var n=t.viewModels.ExportDataDialogViewModelFactory.create(this.localizationService,i,r,o),a={viewModel:n},s={dialogName:"ExportDataDialog",definitionTemplateCachePath:"dialogs/exportDataDialog/exportDataDialogDefinition.html",bindings:a,lazyModuleDependencies:[e.explore.modules.ExploreUIDialogsModule]};return this.modalDialogService.showWebModalDialog(s)},i})();i.ExportDataDialogBuilder=r})(i=t.dialogs||(t.dialogs={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i=(function(){function t(e){this.modalDialogService=e}return t.prototype.show=function(){var t={bindings:void 0,definitionTemplateCachePath:"dialogs/hotkeyDialog/hotkeyDialogDefinition.html",dialogName:"HotkeyDialog",lazyModuleDependencies:[e.explore.modules.ExploreUIDialogsModule]};return this.modalDialogService.showHostModalDialog(t)},t})();t.HotkeyDialogBuilder=i})(i=t.dialogs||(t.dialogs={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i=(function(){function t(e){this.modalDialogService=e}return t.prototype.show=function(t,i,r,o,n){var a={config:{titleText:i,messageText:r,okButtonText:o,learnMoreLink:n}},s={dialogName:t,definitionTemplateCachePath:"dialogs/learnMoreDialog/learnMoreDialogDefinition.html",bindings:a,lazyModuleDependencies:[e.explore.modules.ExploreUIDialogsModule]};return this.modalDialogService.showHostModalDialog(s)},t})();t.LearnMoreDialogBuilder=i})(i=t.dialogs||(t.dialogs={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(e){var t=this;this.require="ngModel",this.restrict="E",this.scope={validators:"=",placeholder:"<",inputType:"@",labelId:"<?",isDisabled:"<?"},this.templateUrl="views/inputFields/propertyPaneTextBox.html",this.link=function(e,i,r,o){o.$render=function(){e.sliceValue=o.$viewValue},e.onKeydown=function(e){e.which===$.ui.keyCode.DELETE&&e.stopPropagation()},e.onChange=function(){e.inputForm&&!e.inputForm.$invalid&&o.$setViewValue(e.sliceValue)},e.getErrorMessage=function(){var i,r=e.inputForm.$error;return r&&(r.decimal||r.number?i=t.localizationService.get("Validation_NotANumber"):r.min?i=t.localizationService.get("Validation_NumberBelowMin"):r.max?i=t.localizationService.get("Validation_NumberAboveMax"):r.integer?i=t.localizationService.get("Validation_NumberNotInteger"):r.required&&(i=t.localizationService.get("Validation_Empty"))),{tooltipDescription:i,tooltipDisable:_.isEmpty(r)}}},this.localizationService=e}return e})();e.PropertyPaneTextBox=t})(t=e.directives||(e.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=(function(){function i(){this.replace=!0,this.restrict="E",this.scope={},this.controller=e.common.createController(t.controllers.CanvasVisualHeaderIconController),this.controllerAs="$ctrl",this.bindToController={details:"=",iconType:"="},this.templateUrl="views/canvasVisualHeaderIcon.html"}return i})();i.CanvasVisualHeaderIcon=r})(i=t.directives||(t.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=t.constants,o=41,n=35,a=250,s=e.common.createRtl().isRtlLayout,l=(function(){function t(){var t=this;this.restrict="E",this.templateUrl="views/carousel.html",this.transclude=!0,this.replace=!0,this.scope={autoResize:"=",onSeeAll:"&",isReadingMode:"<"},this.link=function(i,l){i.element=l,i.scrollPane=l.find(".carouselScrollPane"),i.previousNavButton=l.find(".carouselNavButton.previousPage"),i.nextNavButton=l.find(".carouselNavButton.nextPage"),i.isRtl=s;var c=i.previousNavButton,u=i.nextNavButton,p=i.scrollPane,d=!1;i.getScrollChildren=function(){var e=p.children();return i.isReadingMode&&(e=e.not(".hidden-in-view-mode")),e};var h=function(){c.prop("disabled",!1),u.prop("disabled",!1),0===p.scrollLeft()&&(s?u.prop("disabled",!0):c.prop("disabled",!0)),Math.abs(p.scrollLeft()+p.width()-p[0].scrollWidth)<=2&&(s?c.prop("disabled",!0):u.prop("disabled",!0))};i.updateNavButtonVisibility=h;var v=function(e){if(e&&e.length>0){d=!0;var r=i.getScrollChildren(),o=e.position().left-t.getLeftmostScrollChildOffset(r);p.animate({scrollLeft:o},a,(function(){h(),d=!1}))}},g=function(){if(!d){v(p.find(".selected"))}};if(i.scrollToLast=function(){v(i.getScrollChildren().last())},i.updateCarouselWidth=function(){window.setTimeout((function(){if(p.is(":visible")){for(var e=i.element.parent().width(),t=i.getScrollChildren(),r=0,a=0,s=t.length;a<s;a++)r+=t.eq(a).outerWidth(!0);var l=r+n;e>o&&(l=Math.min(e-o,l)),i.element.width(l)}h()}))},i.onNavButtonContainerRightClick=function(){i.onSeeAll&&i.onSeeAll({event:event})},i.scrollToNext=function(){for(var e,t=i.getScrollChildren(),r=p.width(),o=s?t.length-1:0;s?o>=0:o<t.length;s?o--:o++)if(e=t.eq(o),e.position().left+e.width()>r){v(e);break}},i.scrollToPrevious=function(){for(var e,t=i.getScrollChildren(),r=-p.width(),o=s?t.length-1:0;s?o>=0:o<t.length;s?o--:o++)if(e=t.eq(o),e.position().left>=r){v(e);break}},i.autoResize){e.common.createScopeEventSubscriptionManager(i).subscribe(r.renameSectionEvent,(function(){window.setTimeout((function(){i.updateCarouselWidth()}))}));var f=0,y=new MutationObserver(function(e){i.updateCarouselWidth();var t=i.getScrollChildren().length;f===t-1?i.scrollToLast():0===f&&g(),f=t}),m={childList:!0,characterData:!0,attributes:!0};y.observe(i.scrollPane[0],m)}var S=0;i.carouselResized=function(){if(i.autoResize){var e=l.parent().width();e!==S&&(S=e,i.updateCarouselWidth(),g())}},e.common.createScopeEventSubscriptionManager(i).subscribe(r.updateNavButtonEvent,(function(){window.setTimeout((function(){h()}))}))}}return t.prototype.getLeftmostScrollChildOffset=function(e){return e.length>0?s?e.last().position().left:e.first().position().left:0},t})();i.Carousel=l})(i=t.directives||(t.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=(function(){function i(){this.restrict="E",this.replace=!0,this.controller=e.common.createController(t.controllers.DeleteVisualWarningDialogController),this.templateUrl="views/deleteVisualWarningDialog.html"}return i})();i.DeleteVisualWarningDialog=r})(i=t.directives||(t.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=(function(){function i(){this.restrict="E",this.replace=!0,this.controller=e.common.createController(t.controllers.EsriConsentDialogController),this.templateUrl="views/esriConsentDialog.html"}return i})();i.EsriConsentDialog=r})(i=t.directives||(t.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){function r(i,r,s,l){var c={width:0,height:0};i.outerViewport=c;var u=!1,p=null;r.on("touchstart",".visualContainer.selected",(function(e){u=$(event.target).closest(".tableExContainer,.pivotTableContainer,.visual-accessibleTable").length>0})),r.on("touchend",(function(e){u=!1})),r.on("touchmove",".visualContainer.selected",(function(e){i.shouldDisableScroll&&i.shouldDisableScroll()&&!u&&e.preventDefault()}));var d=function(){var e=i.onResizeViewport.width,t=i.onResizeViewport.height;i.outerViewport={width:e,height:t},e===c.width&&t===c.height||(c.width=e,c.height=t,i.forceSyncSizeUpdates?o.applyFitOption(i,r,i.displayOptionServices):window.requestAnimationFrame((function(){o.applyFitOption(i,r,i.displayOptionServices)}))),i.$emit(n.domLayoutChangedEvent)},h=_.throttle(d,a);i.canvasResized=function(){return i.forceSyncSizeUpdates?d():void h()},i.disableAnimations=!0,i.$watch("useResponsiveLayout",(function(){r.scrollTop(0)})),i.$watch("hasFocus",(function(e){e===!0&&(r.focus(),i.hasFocus=!1)})),i.$watch("viewModel.contract.size",(function(e){e&&(o.updateCanvasSize(i,e.width,e.height),o.applyFitOption(i,r,i.displayOptionServices))}));var v=null;i.$on(t.constants.explorationLoadedEventName,(function(){l&&(p&&(p.reject(),p=null),p=l.startActivity(i,e.telemetry.EXLoadExplorationVisuals),v&&v(),v=i.$watchCollection("viewModel.visualContainers",(function(e){e&&(0===e.length&&p&&(p.resolve(),p=null),v(),v=null)})))})),i.$on("visualContainerRepeatFinished",(function(){p&&(p.resolve(),p=null),document.activeElement||r.focus(),i.$emit(t.constants.exploreCanvasVisualRendered),i.$emit(n.domLayoutChangedEvent)})),i.applyFitOption=function(){o.applyFitOption(i,r,i.displayOptionServices),i.$emit(n.domLayoutChangedEvent)}}var o=t.util.CanvasDisplayUtility,n=e.common.constants,a=300;i.linkCanvas=r;var s=(function(){function i(i,o){var n=this;this.telemetryService=i,this.overlayService=o,this.restrict="E",this.replace=!0,this.scope={viewModel:"=",disablePrint:"=",canvasOptions:"=?",disableOutspacePane:"<?"},this.controller=e.common.createController(t.controllers.ExploreCanvasController),this.controllerAs="$ctrl",this.templateUrl="views/exploreCanvas.html",this.link=function(e,t,i){r(e,t,n.overlayService,n.telemetryService)}}return i})();i.ExploreCanvas=s})(i=t.directives||(t.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=(function(){function i(){this.restrict="E",this.replace=!0,this.transclude=!0,this.scope={viewModel:"="},this.controller=e.common.createController(t.controllers.ExplorationHostController),this.templateUrl="views/explorationHost.html"}return i})();i.ExplorationHost=r})(i=t.directives||(t.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=jsCommon.DragDropUtils,o="dragover",n="section",a=".pane.sections",s=".section.dynamic",l=(function(){function i(i){var a=this;this.restrict="E",this.replace=!0,this.scope={viewModel:"=",tabIndex:"=",isOnlyVisibleTab:"<",isEditing:"=",isHiddenInViewMode:"="},this.controller=e.common.createController(t.controllers.ExplorationNavigationTabController),this.templateUrl="views/explorationNavigationTab.html",this.link=function(t,i,s){t.toggleDraggable=function(e){return i.draggable({disabled:!e})},t.supportsMinervaDialog=a.platformCapabilities.supportsMinervaDialog;var l=jsCommon.FocusManager.setFocusOnPreviousElementOnDestroy(i,!1,!1);i.on("$destroy",(function(){return l()})),i.droppable({accept:function(e){return"sections"===r.getDragSourceType(e)},activate:function(e,i){return t.dragoverIndex=-1},hoverClass:o,tolerance:"pointer",over:function(e,r){if(1===t.viewModeState.getMode()){var o=-1,s=a.getSections();o=i.hasClass(n)?s.index(i):Math.max(s.length-1,0),t.dragoverIndex=o,t.$apply()}},drop:function(i,r){if(1===t.viewModeState.getMode()){var o=r.draggable;if(o){var n=a.getSections(),s=n.index(o),l=t.dragoverIndex;s!==l&&s!==-1&&t.eventBridge.publishBubbling(t,e.explore.services.events.reorderSection,{originalIndex:s,targetIndex:l})}}}}),t.$on("$destroy",(function(){return i.droppable({disabled:!0}).droppable("destroy")}))},this.platformCapabilities=i}return i.prototype.getSections=function(){return $(a).find(s)},i})();i.ExplorationNavigationTab=l})(i=t.directives||(t.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=(function(){function i(){this.restrict="E",this.replace=!0,this.scope={viewModel:"="},this.controller=e.common.createController(t.controllers.ExplorationPaginatorController),this.templateUrl="views/explorationPaginator.html"}return i})();i.ExplorationPaginator=r})(i=t.directives||(t.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=(function(){function i(){this.restrict="E",this.replace=!0,this.scope={viewModel:"=",disablePrint:"=",canvasOptions:"<",shouldSetFocus:"<"},this.controller=e.common.createController(t.controllers.ExplorationController),this.templateUrl="views/exploration.html"}return i})();i.Exploration=r})(i=t.directives||(t.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(){this.replace=!0,this.scope={classes:"@",ngModel:"<",ngChange:"&",options:"<",expression:"@"},this.templateUrl="views/jqSelect.html"}return e})();e.JqSelect=t})(t=e.directives||(e.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=e.explore.services.events,o=(function(){function i(){this.restrict="A",this.controller=e.common.createController(t.controllers.ModelingContextChangerController),this.link=function(e,t,i){var o=e.eventBridge.createChannelSubscriptionManager().subscribe(r.schemaItemActivationChanged,(function(){e.schemaItemActivationService.getActiveItem()?t.on("click",(function(){e.eventBridge.publishToChannel(r.modelingContextChanged)})):t.off("click")}));e.$on("$destroy",(function(){return o.unsubscribeAll()}))}}return i})();i.ModelingContextChanger=o})(i=t.directives||(t.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(){this.restrict="A",this.require="ngModel",this.scope={pbiValidate:"="},this.link=function(t,i,r,o){t.pbiValidate&&(o.$validators.required=function(e,i){return null==i||!t.pbiValidate.required||""!==i},o.$validators.min=function(i,r){return e.isLargerOrEqual(r,t.pbiValidate.min)},o.$validators.max=function(i,r){return e.isLargerOrEqual(t.pbiValidate.max,r)},o.$validators.decimal=function(e,i){return null==i||!t.pbiValidate.decimal||_.isFinite(Number(i))},o.$validators.integer=function(e,i){if(null==i||!t.pbiValidate.integer)return!0;var r=Number(i);return _.isFinite(r)&&Math.floor(r)===r})}}return e.isLargerOrEqual=function(e,t){if(null==e||null==t||""===e||""===t)return!0;var i=Number(e),r=Number(t);return!_.isFinite(i)||!_.isFinite(r)||i>=r},e})();e.PbiValidate=t})(t=e.directives||(e.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i=e.common.directives.BasePrinter,r=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.printContainerSelector="[explore-canvas-printer]",t}return __extends(t,e),t.prototype.calculateStyle=function(e,t){var r=t.displayOptionServices.viewModeState.getConfig().printProperties,o=e.width()+r.containerPixelPadding,n=e.height(),a=i.getPrintTargetViewPort(e);if(!r.useSectionDisplayOption||0===t.displayOptionServices.canvasScale.getDisplayOption()){var s=e.find(".visualContainer");if(s.length>0){var l=0,c=0;s.each((function(e,t){var i=$(t),r=i.position(),o=Math.max(0,r.left),n=Math.max(0,r.top);l=Math.max(l,o+i.width()),c=Math.max(c,n+i.height())}));var u=i.calculateScaleFactor({width:o,height:n},{width:l,height:c},!0);o*=u,n*=u}}var p=i.calculateScaleFactor({width:o,height:n},a),d=o*p,h=n*p,v=(a.width-d)/2,g=(a.height-h)/2;return{width:o+"px !important",height:n+"px !important",transform:"translate("+v+"px, "+g+"px) scale("+p+") !important","-webkit-transform":"translate("+v+"px, "+g+"px) scale("+p+") !important","transform-origin":"left top !important","-webkit-transform-origin":"left top !important",left:"auto !important",top:"auto !important",right:"auto !important",bottom:"auto !important",margin:"0 !important"}},t})(i);t.ExploreCanvasPrinter=r})(i=t.directives||(t.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(){var e=this;this.restrict="A",this.scope={viewModel:"=?",sectionNumber:"=?",navMarkerParent:"@",autoWidth:"<?"},this.link=function(t,i){null!=t.viewModel?(t.$watch("viewModel.activePageSection",(function(r){if(null!=r){var o=e.getPageSectionIndexes(t.viewModel,r),n=o[0],a=o[1];e.animateSectionSlide(t,i,n,a)}})),t.$watch("viewModel.activeSection",(function(r){if(null!=r){var o=e.getSectionIndexes(t.viewModel,r),n=o[0],a=o[1];e.animateSectionSlide(t,i,n,a)}})),t.$watch("viewModel.sections.length",(function(r,o){if(0!==r&&r!==o){var n=e.getSectionIndexes(t.viewModel,t.viewModel.activeSection),a=n[0],s=n[1];e.animateSectionSlide(t,i,a,s)}}))):null!=t.sectionNumber&&t.$watch("sectionNumber",(function(r){null!=r&&e.animateSectionSlide(t,i,r,Number(!r))}))}}return e.prototype.animateSectionSlide=function(e,t,i,r){i<r?t.css({right:"200%"}).animate({right:0},200):i>r&&t.css({"margin-left":"200%"}).animate({"margin-left":0},200);var o=$("."+e.navMarkerParent+".navMarker");e.autoWidth?0===i?o.css({"margin-left":o.width()*r+"px",right:"auto"}).animate({"margin-left":"0"},200):o.animate({right:"0"},200,(function(){o.css({"margin-left":"auto"})})):o.animate({"margin-left":o.width()*i+"px"},200)},e.prototype.getSectionIndexes=function(e,t){var i=[],r=e.previousSection;return e.sections.forEach((function(e,o){if(e.sectionType===t?i[0]=o:e.sectionType===r&&(i[1]=o),2===i.length)return i})),i},e.prototype.getPageSectionIndexes=function(e,t){var i=[],r=e.previousPageSection;return e.pagePaneSections.forEach((function(e,o){if(e.sectionType===t?i[0]=o:e.sectionType===r&&(i[1]=o),2===i.length)return i})),i},e})();e.SectionAnimationSlider=t})(t=e.directives||(e.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=jsCommon.CssConstants.createClassAndSelector,i=(function(){function e(){this.restrict="A",this.scope={sectionLength:"<",currentSection:"=",setActiveSectionFunction:"&"},this.link=function(e,i){i.on("keydown",(function(i){var r=t("sectionTab"),o=e.sectionLength;switch(i.keyCode){case $.ui.keyCode.LEFT:case $.ui.keyCode.UP:var n=(e.currentSection-1+o)%o;e.setActiveSectionFunction({nextSection:n}),$(i.target).parent("ul").find(r.selector).eq(n).focus(),i.stopPropagation();break;case $.ui.keyCode.RIGHT:case $.ui.keyCode.DOWN:n=(e.currentSection+1)%o,e.setActiveSectionFunction({nextSection:n}),$(i.target).parent("ul").find(r.selector).eq(n).focus(),i.stopPropagation()}}))}}return e})();e.SectionTabKeyHandler=i})(t=e.directives||(e.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=(function(){function i(){this.restrict="E",this.replace=!0,this.scope={viewModel:"=",fieldListConfig:"<"},this.controller=e.common.createController(t.controllers.TaskPaneController),this.templateUrl="views/taskPane.html"}return i})();i.TaskPane=r})(i=t.directives||(t.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=(function(){function i(){this.restrict="E",this.replace=!0,this.scope={viewModel:"="},this.controller=e.common.createController(t.controllers.VisualizationPaneController),this.templateUrl="views/visualizationPane.html"}return i})();i.VisualizationPane=r})(i=t.directives||(t.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(t,i){var r=this;this.restrict="E",this.replace=!0,this.template='<div class="watermark"></div>',this.scope={visualType:"="},this.link=function(t,i){function o(e,t,i,r){var o=e.indexOf('id="'+t),n=t.length+6,a=e.substring(o+n,e.indexOf(i)),s=a.indexOf(r);return a.substring(0,s)}function n(t,i,r){t=o(t,i,"</svg>","</symbol>"),$(e.svgTemplate+t+"</svg>").appendTo(r)}function a(t,i,r,o){var a=o.getPlugin(i),s=a&&a.watermarkKey||e.defaultWatermark;r.attr(e.dataAttribute,s),n(t,s,r)}var s="views/svg/visualsWatermarks.svg",l=r.visualPlugin,c=r.templateCache.get(s);a(c,t.visualType,i,l),t.$watch("visualType",(function(e,t){e!==t&&(i.empty(),a(c,e,i,l))}))},this.templateCache=t,this.visualPlugin=i}return e.svgTemplate='<svg id="Layer_1" x="0px" y="0px" viewBox="0 0 400 300" enable-background="new 0 0 400 300" xml:space="preserve">',e.dataAttribute="data-svg-visual-key",e.defaultWatermark="defaultWatermark",e})();e.VisualWatermark=t})(t=e.directives||(e.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(){this.restrict="E",this.replace=!0,this.transclude=!0,this.scope={initLimit:"=",totalItemsAmount:"="},this.templateUrl="views/virtualList.html",this.link=function(e,t){var i=0,r=10;e.limitItems=+e.initLimit,e.scrollbarsConfig={ignoreOverlay:!1,ignoreMobile:!1};var o=t.find(".virtual-list"),n=2*t.height();o.scroll((function(){var a=o.scrollTop();n||(n=2*t.height()),a+n>o.height()&&e.totalItemsAmount>=e.limitItems&&a>i&&(i=a,e.limitItems+=r,e.$digest())}))}}return e})();e.VirtualList=t})(t=e.directives||(e.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){function t(e,t){var i="";switch(e){case 0:i=t.get("ReportAppBar_ViewDynamic");break;case 1:i=t.get("ReportAppBar_ViewFitToPage");break;case 2:i=t.get("ReportAppBar_ViewFitToWidth");break;case 3:i=t.get("ReportAppBar_ViewActualSize")}return i}e.convert=t})(t=e.DisplayOptionFilter||(e.DisplayOptionFilter={}))})(t=e.filters||(e.filters={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){function i(){var e=jsCommon.QueryStringUtil.getQueryStringValue("openReportSource");return e?r[e]||r.Invalid:r.Normal}var r=e.telemetry.OpenExplorationSource;t.GetOpenExplorationSource=i;var o=(function(){function t(){}return t.HasUnsupportedExploreVisuals=function(t,i){var r=!1;if(t){var o=t.sections;if(o)for(var n=0,a=o.length;n<a;n++){var s=o[n],l=s.visualContainers;if(l)for(var c=0,u=l.length;c<u;c++){var p=l[c],d=p.config.singleVisual.visualType;if(d&&!i.getPlugin(d)){if(t.resourcePackages){if(t.resourcePackages.some((function(e){return e.name===d})))continue;if(e.visualHost.CustomVisualsUtils.isOrganizationalCustomVisual(d))continue}r=!0;break}}}}return r},t.IsReportSavedAsExploration=function(e){return e.hasExploration||!e.reportUrl},t.shouldDisplayErrorAsNotificationBar=function(t){return t===e.DMTS_NoGatewayWithAllDatasourcesToBindError||t===e.DMTS_MultipleGatewaysWithAllDatasourcesToBindError||t===e.DMTS_DatasourceHasNoCredentialError||t===e.DM_GWPipeline_Client_GatewayUnreachable||t===e.DMTS_UserLostPermissionToDatasourceError||t===e.DMTS_UserNotFoundInADGraphError||t===e.DM_GWPipeline_Gateway_DataSourceConnectionError||t===e.DM_GWPipeline_Gateway_DataSourceAccessError||t===e.DM_GWPipeline_Gateway_ImpersonationError||t===e.DM_GWPipeline_Gateway_InvalidMashupConnectionString||t===e.DM_GWPipeline_Gateway_DatabaseLoginError||t===e.DM_GWPipeline_Gateway_SqlTimeoutException||t===e.DM_GWPipeline_Gateway_AdomdTimeoutException||t===e.DM_GWPipeline_Gateway_InvalidObjectNameException||t===e.DM_GWPipeline_Gateway_ConnectionBrokenException||t===e.DM_GWPipeline_Gateway_MemoryError||t===e.DM_GWPipeline_Gateway_MissingStructureError||t===e.DM_GWPipeline_Gateway_UnprocessedStructureError||t===e.DM_GWPipeline_Gateway_ModelLoadError||t===e.DM_GWPipeline_Gateway_CancellationError||t===e.DM_GWPipeline_Gateway_QueryExecutionError||t===e.DM_GWPipeline_Gateway_RecalculationRequiredError||t===e.DM_GWPipeline_Gateway_AdomdConnectError||t===e.DM_GWPipeline_Gateway_MashupDataAccessError||t===e.RS_CannotRetrieveModel||t===e.RS_AccessDeniedDueToRLSGroup||t===e.RS_AccessDenied},t})();t.ReportUtility=o})(i=t.helpers||(t.helpers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){e.spinnerAction={name:"spinnerAction"}})(t=e.DetailVisualEvents||(e.DetailVisualEvents={}))})(t=e.viewModels||(e.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i=e.explore.constants.ExploreCanvasConstants;t.FixedPhoneCanvasSettings={phoneWidth:i.PhoneAuthoringViewportWidth,phoneHeight:i.PhonePortraitCanvasHeight,phoneGridLayout:{columnCount:6,rowCount:i.PhonePortraitRowCount,layout:{horizontal:{margin:9.5,gutter:9,size:44},vertical:{margin:9.5,gutter:9,size:50}},style:{color:null,fullOpacity:!1}}};var r=(function(){function e(e,t){void 0===t&&(t=0),this.selectedVisualOriginalPosition=-1,this.contract=e,this.canvasLayout=t}return Object.defineProperty(e.prototype,"width",{get:function(){return 0===this.canvasLayout?this.contract.size&&this.contract.size.width:t.FixedPhoneCanvasSettings.phoneWidth},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return 0===this.canvasLayout?this.contract.size&&this.contract.size.height:t.FixedPhoneCanvasSettings.phoneHeight},enumerable:!0,configurable:!0}),e})();t.ExploreCanvas=r})(i=t.viewModels||(t.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i;!(function(t){function i(){return r.createNavigationMenuItems()}t.createNavigationMenuItems=i;var r;!(function(t){function i(){return{items:[r("Duplicate_page",0),r("Rename_page",1),r("Delete_page",2),r("Hide_page",3)]}}function r(t,i){return{key:i,text:e.common.localize.get(t),type:0}}t.createNavigationMenuItems=i})(r||(r={}))})(i=t.ExplorationContainerViewModelFactory||(t.ExplorationContainerViewModelFactory={}))})(i=t.viewModels||(t.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){function t(e,t,i,r){var o=0===t;return{options:[e.get("ModalDialog_ExportDataSummarized"),e.get("ModalDialog_ExportDataUnderlying")],dataType:0,dataFormat:o?(0).toString():1..toString(),isExlFormatDisabled:!o,isUnderlyingDisabled:!i,exportDataMode:r,isCsvFormatDisabled:!1,exportXlsxUnsupportedType:t}}e.create=t})(t=e.ExportDataDialogViewModelFactory||(e.ExportDataDialogViewModelFactory={}))})(t=e.viewModels||(e.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=jsCommon.EnumExtensions,i=(function(){function e(e){this.contract=e,this.showCheckboxes=!0,this.entities=[]}return Object.defineProperty(e.prototype,"name",{get:function(){return this.contract.name},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"canEdit",{get:function(){return this.contract.capabilities.canEdit&&!this.disableEditing},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"canCreateColumn",{get:function(){return this.canEdit&&this.contract.capabilities.supportsCalculatedColumns!==!1},enumerable:!0,configurable:!0}),e.prototype.findEntity=function(e){return _.find(this.entities,(function(t){return t.name===e}))},e.prototype.findFields=function(e,t,i){var r=this.findEntity(e);if(r)return r.findFields(t,i)},e.prototype.findHierarchies=function(e,t,i){var r=this.findEntity(e);if(r)return r.findHierarchies(t,i)},e.prototype.findKpis=function(e,t,i){var r=this.findEntity(e);if(r)return r.findKpis(t,i)},e.prototype.findKpiMeasures=function(e,t,i){var r=this.findEntity(e);if(r)return r.findKpiMeasures(t,i)},e.prototype.getMenuItems=function(e,t){return this.menuItemFactory.createSchemaMenuItems(this,e,t)},e})();e.FieldListConceptualModel=i;var r=(function(){function i(e,t,i){this.hasCheckedProperties=!1,this.contract=e,this.contractSchema=t,this.schema=i,this.properties=[],this.hierarchies=[],this.displayFolders=[]}return Object.defineProperty(i.prototype,"name",{get:function(){return this.contract.name},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"displayName",{get:function(){return this.displayNameOverride||this.contract.displayName},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"description",{get:function(){return this.contract.description},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"errorMessage",{get:function(){
return this.contract.errorMessage},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"calculated",{get:function(){return this.contract.calculated},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"iconClassName",{get:function(){return 1===this.contract.queryable?"fieldListError":this.calculated?"fieldListEntityCalculated":this.isMeasureGroup?"fieldListMeasureGroup":void 0},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"hidden",{get:function(){return t.hasFlag(this.contract.visibility,1)&&_.every(this.properties,(function(e){return!e.isExtension||e.hidden}))},set:function(e){e?this.contract.visibility=t.setFlag(this.contract.visibility,1):this.contract.visibility=t.resetFlag(this.contract.visibility,1)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"canEdit",{get:function(){return this.contractSchema.capabilities.canEdit&&!this.schema.disableEditing&&!e.FieldListViewModelUtils.isAbandoned(this.contract)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"private",{get:function(){return t.hasFlag(this.contract.visibility,4)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"showAsVariationsOnly",{get:function(){return t.hasFlag(this.contract.visibility,2)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"showHidden",{get:function(){return this.schema.showHidden},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"hasMenu",{get:function(){return this.schema.menuItemFactory.hasEntityMenu()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"canRefresh",{get:function(){return this.canEdit&&this.contract.capabilities.canRefresh},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"canEditEntity",{get:function(){return this.canEdit&&!this.calculated&&this.contract.capabilities.canEditSource},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"canDelete",{get:function(){return this.canEdit&&this.contract.capabilities.canDelete},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"canRename",{get:function(){return this.canEdit&&this.contract.capabilities.canRename},enumerable:!0,configurable:!0}),i.prototype.findFields=function(e,t){return this.findFieldsByType(e,t,0)},i.prototype.findKpis=function(e,t){return this.findFieldsByType(e,t,4)},i.prototype.findKpiMeasures=function(e,t){return this.findFieldsByType(e,t,5)},i.prototype.findHierarchies=function(e,t){return this.findFieldsByType(e,t,2)},i.prototype.findFieldsByType=function(e,t,i){var r=[];2===i?r.push.apply(r,_.filter(this.hierarchies,(function(i){return i.name===e&&i.schema.name===t}))):r.push.apply(r,_.filter(this.properties,(function(r){return r.name===e&&r.fieldType===i&&r.schemaName===t})));for(var o=0,n=this.displayFolders;o<n.length;o++)for(var a=n[o],s=0,l=_.filter(a.getAllChildren(),(function(t){return t.name===e&&t.fieldType===i}));s<l.length;s++){var c=l[s];r.indexOf(c)<0&&r.push(c)}if(!_.isEmpty(r))return r},Object.defineProperty(i.prototype,"userEntity",{get:function(){return this.schema.showNonUserEntities||!(this.private||this.showAsVariationsOnly)},enumerable:!0,configurable:!0}),i.prototype.getMenuItems=function(){return this.schema.menuItemFactory.createEntityMenuItems(this)},i})();e.FieldListConceptualEntity=r;var o=(function(){function e(e,t,i){this.hasCheckedChildren=!1,this.contract=e,this.schema=t,this.entity=i}return Object.defineProperty(e.prototype,"name",{get:function(){return this.contract.name},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"schemaName",{get:function(){return this.schema.name},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"displayName",{get:function(){return this.displayNameOverride||this.contract.displayName},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"description",{get:function(){return this.contract.description},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"errorMessage",{get:function(){return null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"visible",{get:function(){return!this.parent||this.parent.expanded&&this.parent.visible},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hidden",{get:function(){return this.contract.hidden},set:function(e){this.contract.hidden=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"showHidden",{get:function(){return this.entity.showHidden},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"canEdit",{get:function(){return!this.variation&&this.schema.capabilities.canEdit&&!this.entity.schema.disableEditing},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"disableDragging",{get:function(){return this.entity.schema.disableDragging},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"showCheckboxes",{get:function(){return this.entity.schema.showCheckboxes},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasMenu",{get:function(){return this.entity.schema.menuItemFactory.hasPropertyMenu()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isExtension",{get:function(){return!1},enumerable:!0,configurable:!0}),e})();e.FieldListConceptualItem=o;var n=(function(e){function t(t,i,r,o,n){var a=e.call(this,t,i,r)||this;return a.children=[],a.originalEntity=o,a.variation=n,a.expanded=!1,a.draggable=!a.disableDragging,a.fieldType=0,a}return __extends(t,e),Object.defineProperty(t.prototype,"kind",{get:function(){return this.contract.kind},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"defaultAggregate",{get:function(){return this.contract.column?this.contract.column.defaultAggregate:null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"type",{get:function(){return this.contract.type},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"idOnEntityKey",{get:function(){return!!this.contract.column&&this.contract.column.idOnEntityKey},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"errorMessage",{get:function(){return this.contract.errorMessage},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"canDelete",{get:function(){return this.canEdit&&this.contract.canDelete!==!1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"canAddToFilter",{get:function(){return!this.contract.measure||!this.schema.capabilities.limitMultiColumnFiltersToQueryGroupColumns},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"properties",{get:function(){return this.children},enumerable:!0,configurable:!0}),t.prototype.getMenuItems=function(e,t){return this.entity.schema.menuItemFactory.createPropertyMenuItems(this,e,t)},t.prototype.clone=function(){var e=new t(this.contract,this.schema,this.entity);return e.template=this.template,e},t})(o);e.FieldListConceptualProperty=n;var a=(function(e){function t(t,i,r){return e.call(this,t,i,r)||this}return __extends(t,e),Object.defineProperty(t.prototype,"defaultAggregate",{get:function(){return 2},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"idOnEntityKey",{get:function(){return!1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isExtension",{get:function(){return!0},enumerable:!0,configurable:!0}),t.prototype.getMenuItems=function(e,t){return this.entity.schema.menuItemFactory.createExtensionMeasureMenuItems(this,e,t)},t.prototype.clone=function(){var e=new t(this.contract,this.schema,this.entity);return e.template=this.template,e},t})(n);e.FieldListConceptualExtensionMeasure=a;var s=(function(e){function t(t,i,r,o,n,a){var s=this;return s=e.call(this,t.column,i,o)||this,s.originalEntity=n,s.variation=a,s.hierarchyLevelContract=t,s.parent=r,s.fieldType=3,s}return __extends(t,e),Object.defineProperty(t.prototype,"hidden",{get:function(){return this.parent.hidden},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return this.hierarchyLevelContract.name},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"displayName",{get:function(){return this.displayNameOverride||this.hierarchyLevelContract.displayName},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"description",{get:function(){return this.hierarchyLevelContract.description},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"canDelete",{get:function(){return!this.variation&&this.canEdit&&this.hierarchyLevelContract.canDelete!==!1},enumerable:!0,configurable:!0}),t.prototype.getMenuItems=function(e,t){return this.entity.schema.menuItemFactory.createHierarchyLevelMenuItems(this,e,t)},t.prototype.clone=function(e){var i=e||this.parent,r=new t(this.hierarchyLevelContract,this.schema,i,this.entity);return r.template=this.template,r},t})(n);e.FieldListConceptualHierarchyLevel=s;var l=(function(e){function t(t,i,r,o,n){var a=e.call(this,t,i,r)||this;return a.expanded=!1,a.hierarchyLevels=[],a.originalEntity=o,a.variation=n,a.draggable=!a.disableDragging,a.fieldType=2,a}return __extends(t,e),Object.defineProperty(t.prototype,"properties",{get:function(){return this.hierarchyLevels},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"children",{get:function(){return this.hierarchyLevels},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"canDelete",{get:function(){return!this.variation&&this.canEdit&&this.contract.canDelete!==!1},enumerable:!0,configurable:!0}),t.prototype.findLevel=function(e,t){return _.find(this.hierarchyLevels,(function(t){return t.name===e}))},t.prototype.getMenuItems=function(){return this.entity.schema.menuItemFactory.createHierarchyMenuItems(this)},t.prototype.clone=function(){var e=new t(this.contract,this.schema,this.entity);return e.hierarchyLevels=_.map(this.hierarchyLevels,(function(t){return t.clone(e)})),e.template=this.template,e},t})(o);e.FieldListConceptualHierarchy=l;var c=(function(e){function t(t,i,r){var o=e.call(this,t,i,r)||this;return o.expanded=!1,o.kpiMeasures=[],o.fieldType=4,o}return __extends(t,e),Object.defineProperty(t.prototype,"kind",{get:function(){return this.contract.kind},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"properties",{get:function(){return this.kpiMeasures},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"children",{get:function(){return this.kpiMeasures},enumerable:!0,configurable:!0}),t.prototype.getMenuItems=function(){return this.entity.schema.menuItemFactory.createKpiMenuItems(this)},t.prototype.clone=function(){var e=new t(this.contract,this.schema,this.entity);return e.kpiMeasures=_.map(this.kpiMeasures,(function(t){return t.clone(e)})),e.template=this.template,e},t})(o);e.FieldListConceptualKpi=c;var u=(function(e){function t(t,i,r,o,n,a){var s=this;return s=e.call(this,t,i,n)||this,s.kpiType=r,s.parent=o,s.locOptions=a,s.draggable=!s.disableDragging,s.fieldType=5,s}return __extends(t,e),Object.defineProperty(t.prototype,"displayName",{get:function(){var e;switch(this.kpiType){case 2:e=this.locOptions.KpiValueDisplayName;break;case 1:e=this.locOptions.KpiGoalDisplayName;break;case 0:e=this.locOptions.KpiStatusDisplayName;break;case 3:e=this.locOptions.KpiTrendDisplayName}return this.displayNameOverride||e||this.contract.displayName},enumerable:!0,configurable:!0}),t.prototype.getMenuItems=function(){return this.entity.schema.menuItemFactory.createKpiMeasureMenuItems(this)},t.prototype.clone=function(e){var i=e||this.parent,r=new t(this.contract,this.schema,this.kpiType,i,this.entity,this.locOptions);return r.template=this.template,r},t})(n);e.FieldListConceptualKpiMeasure=u;var p=(function(e){function t(t,i,r,o,n){var a=e.call(this,t,o,n)||this;a.expanded=!1,a.parent=r,a.children=i,a.fieldType=1;for(var s=0,l=i;s<l.length;s++){l[s].parent=a}return a}return __extends(t,e),Object.defineProperty(t.prototype,"hidden",{get:function(){return!_.some(this.children,(function(e){return!e.hidden}))},set:function(e){},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasMenu",{get:function(){return!1},enumerable:!0,configurable:!0}),t.prototype.getMenuItems=function(){return{items:[]}},t.prototype.clone=function(){},t.prototype.getAllChildren=function(){for(var e=[],t=0,i=this.children;t<i.length;t++){var r=i[t];e.push(r),1===r.fieldType&&e.push.apply(e,r.getAllChildren())}return e},t})(o);e.FieldListConceptualDisplayFolder=p})(t=e.viewModels||(e.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){e.fieldListAction={name:"fieldListAction"}})(t=e.FieldListEvents||(e.FieldListEvents={}))})(t=e.viewModels||(e.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){function r(e,t,i){return new l(e,t,i)}var o=e.explore.utils.GroupUtils,n=e.explore.util.HierarchyUtils;i.createFieldListMenuItemFactory=r;var a;!(function(e){function t(){return{type:1,checked:!1}}function i(e,t,i,r){return void 0===r&&(r=!1),{text:i.get(e)||e,key:t,type:0,checked:!!r}}e.createItemSeparator=t,e.createFieldListMenuItem=i})(a=i.FieldListMenuItemViewModelGenerator||(i.FieldListMenuItemViewModelGenerator={}));var s;!(function(e){e[e.Check=0]="Check",e[e.Uncheck=0]="Uncheck",e[e.HierarchyCreate=1]="HierarchyCreate",e[e.HierarchyAddTo=2]="HierarchyAddTo",e[e.Create=3]="Create",e[e.Entity=4]="Entity",e[e.Copy=5]="Copy",e[e.Edit=6]="Edit",e[e.Hidden=7]="Hidden",e[e.ExpandCollapse=8]="ExpandCollapse",e[e.Groups=9]="Groups",e[e.FieldProperties=10]="FieldProperties",e[e.AddToFilters=11]="AddToFilters",e[e.AddToDrillthrough=12]="AddToDrillthrough",e[e.TopN=13]="TopN"})(s||(s={}));var l=(function(){function e(e,t,i){this.localizationService=e,this.featureSwitchService=t,this.groupingDesignStateService=i}return e.prototype.createSchemaMenuItems=function(e,t,i){var r=this.canAuthorReportMeasuresOnSchema(e.contract);return this.createMenuItems({canViewHidden:e.canEdit||r,canUnHideAll:e.canEdit||r,canExpandCollapseAll:!0,showHidden:e.showHidden,isVisualSelected:t,visualFilters:i})},e.prototype.createEntityMenuItems=function(e){var t=this.canAuthorReportMeasuresOnEntity(e),i=this.createMenuSections({canDelete:e.canDelete,canRename:e.canRename,canViewHidden:e.schema.canEdit||t,canUnHideAll:e.schema.canEdit||t,canExpandCollapseAll:!0,isEntity:!0,canRefresh:e.canRefresh,canHide:e.schema.canEdit,canEditEntity:e.canEditEntity,canCreateColumn:e.schema.canCreateColumn,canCreateMeasure:e.canEdit||this.canCreateNewReportMeasureOnEntity(e),hidden:e.hidden,showHidden:e.showHidden,canCreateQuickCalcMeasure:this.isQuickMeasureSupported(e),canShowFieldProperties:this.canShowFieldProperties(),canShowIncrementalRefreshPolicy:e.canEditEntity&&this.featureSwitchService.featureSwitches.showIncrementalRefreshPolicy,canShowManageAggregations:e.canEditEntity&&this.featureSwitchService.featureSwitches.showManageAggregations});return this.canMarkCustomDateTable(e)&&this.createCustomDateTableSection(i,e),{items:this.getMenuItemsAndSeparators(i)}},e.prototype.createHierarchyMenuItems=function(e){var t=this.canAuthorReportMeasuresOnEntity(e.entity);return this.createMenuItems({canDelete:e.canDelete,canRename:e.canEdit,canAddField:e.entity.schema.showCheckboxes&&!e.checked,canRemoveField:e.checked,canHide:e.canEdit&&e.entity.schema.canEdit,canCreateColumn:e.entity.schema.canCreateColumn,canCreateMeasure:e.entity.canEdit||this.canCreateNewReportMeasureOnEntity(e.entity),canViewHidden:e.entity.schema.canEdit||t,canUnHideAll:e.entity.schema.canEdit||t,canExpandCollapseAll:!0,hidden:e.hidden,showHidden:e.showHidden,canShowFieldProperties:this.canShowFieldProperties()&&!e.variation})},e.prototype.createHierarchyLevelMenuItems=function(e,t,i){var r=this.canAuthorReportMeasuresOnEntity(e.entity),o=e.parent.contract.levels;return this.createMenuItems({canAddToFilter:!0,isVisualSelected:t,visualFilters:i,canAddField:e.entity.schema.showCheckboxes&&!e.checked,canRemoveField:e.checked,canDelete:e.canDelete,canRename:e.canEdit,canMoveUp:e.canEdit&&_.head(o).name!==e.hierarchyLevelContract.name,canMoveDown:e.canEdit&&_.last(o).name!==e.hierarchyLevelContract.name,canCreateColumn:e.entity.schema.canCreateColumn,canCreateMeasure:e.entity.canEdit||this.canCreateNewReportMeasureOnEntity(e.entity),canViewHidden:e.entity.schema.canEdit||r,canUnHideAll:e.entity.schema.canEdit||r,canExpandCollapseAll:!0,showHidden:e.showHidden,canCreateQuickCalcMeasure:this.isQuickMeasureSupported(e.entity),canShowFieldProperties:this.canShowFieldProperties()&&!e.variation})},e.prototype.createPropertyMenuItems=function(e,t,i){var r=this.canAuthorReportMeasuresOnEntity(e.entity),n=this.createMenuSections({canAddToFilter:e.canAddToFilter,isVisualSelected:t,visualFilters:i,canAddField:e.entity.schema.showCheckboxes&&!e.checked,canRemoveField:e.checked,canDelete:this.canDeleteProperty(e),canRename:e.canEdit,canHide:e.canEdit,canGroup:e.canEdit&&this.featureSwitchService.featureSwitches.enableGroupAuthoring&&this.groupingDesignStateService&&0===e.kind&&o.canPropertyBeGrouped(e.contract)&&e.schema.capabilities.supportsGrouping!==!1,canEditGroups:e.canEdit&&this.featureSwitchService.featureSwitches.enableGroupAuthoring&&this.groupingDesignStateService&&o.isGroupOrBinColumn(e.entity.name,e.contract,this.groupingDesignStateService)&&e.schema.capabilities.supportsGrouping!==!1,canEditClustering:e.canEdit&&this.groupingDesignStateService&&o.isClusteringColumn(e.entity.name,e.contract,this.groupingDesignStateService)&&e.schema.capabilities.supportsGrouping!==!1,canCreateColumn:e.entity.schema.canCreateColumn,canCreateMeasure:e.entity.canEdit||this.canCreateNewReportMeasureOnEntity(e.entity),canViewHidden:e.entity.schema.canEdit||r,canUnHideAll:e.entity.schema.canEdit||r,canExpandCollapseAll:!0,hidden:e.hidden,showHidden:e.showHidden,canCreateQuickCalcMeasure:this.isQuickMeasureSupported(e.entity),canShowFieldProperties:this.canShowFieldProperties()});return e.entity.canEdit&&1!==e.kind&&this.createHierarchyMenuSections(e,n),{items:this.getMenuItemsAndSeparators(n)}},e.prototype.canDeleteProperty=function(e){return e.canDelete&&!(e.entity&&e.entity.calculated&&e.contract.column&&!e.contract.column.calculated)},e.prototype.canCreateNewReportMeasureOnEntity=function(e){return this.canAuthorReportMeasuresOnEntity(e)&&!i.FieldListViewModelUtils.isAbandoned(e.contract)},e.prototype.canAuthorReportMeasuresOnEntity=function(e){return e.contractSchema.isExtensionSchema?e.contractSchema.capabilities.canEdit:this.canAuthorReportMeasuresOnSchema(e.contractSchema)},e.prototype.canAuthorReportMeasuresOnSchema=function(e){return e.capabilities.isExtendable},e.prototype.createExtensionMeasureMenuItems=function(e,t,i){return this.createPropertyMenuItems(e,t)},e.prototype.createKpiMenuItems=function(e){var t=this.canAuthorReportMeasuresOnEntity(e.entity);return this.createMenuItems({canDelete:e.canEdit,canRename:e.canEdit,canCreateColumn:e.entity.schema.canCreateColumn,canCreateMeasure:e.entity.canEdit||this.canCreateNewReportMeasureOnEntity(e.entity),canViewHidden:e.entity.schema.canEdit||t,canUnHideAll:e.entity.schema.canEdit||t,canExpandCollapseAll:!0,hidden:e.hidden,showHidden:e.showHidden})},e.prototype.createKpiMeasureMenuItems=function(e){return this.createMenuItems({canExpandCollapseAll:!0,hidden:e.hidden,showHidden:e.showHidden})},e.prototype.hasPropertyMenu=function(){return!0},e.prototype.hasEntityMenu=function(){return!0},e.prototype.createMenuItems=function(e){return{items:this.getMenuItemsAndSeparators(this.createMenuSections(e))}},e.prototype.createMenuSections=function(e){var i=[];if(e.canAddToFilter){var r=this.addMenuItem(i,s.AddToFilters,"FieldListMenuItem_AddToFilters",void 0),o=[a.createFieldListMenuItem("FieldListMenuItem_PageLevelFilters",{action:26},this.localizationService),a.createFieldListMenuItem("FieldListMenuItem_ReportLevelFilters",{action:27},this.localizationService)];e.isVisualSelected&&o.unshift(a.createFieldListMenuItem("FieldListMenuItem_VisualLevelFilters",{action:25},this.localizationService)),r.children=o,this.addMenuItem(i,s.AddToDrillthrough,"FieldListMenuItem_AddToDrillthrough",28)}if(e.canAddField&&this.addMenuItem(i,s.Check,"FieldListMenuItem_Check",29),e.visualFilters&&e.visualFilters.length>0){for(var n=[],l=0,c=e.visualFilters;l<c.length;l++){var u=c[l];u.contract&&u.contract.type===t.contracts.FilterType.TopN&&n.push(a.createFieldListMenuItem(u.displayName,{action:32,filter:u},this.localizationService))}if(n&&n.length>0){this.addMenuItem(i,s.TopN,"FieldListMenuItem_AddToTopNByValue",void 0).children=n}}return e.canRemoveField&&this.addMenuItem(i,s.Uncheck,"FieldListMenuItem_Uncheck",30),e.canCreateMeasure&&this.addMenuItem(i,s.Create,"FieldListMenuItem_NewMeasure",9),e.canCreateColumn&&this.addMenuItem(i,s.Create,"FieldListMenuItem_NewColumn",12),e.canCreateQuickCalcMeasure&&this.addMenuItem(i,s.Create,"QuickCalc_NewMeasure",18),e.isEntity&&(e.canRefresh&&this.addMenuItem(i,s.Entity,"FieldListMenuItem_RefreshEntity",5),e.canEditEntity&&this.addMenuItem(i,s.Entity,"FieldListMenuItem_EditEntity",8),e.canShowIncrementalRefreshPolicy&&this.addMenuItem(i,s.Entity,"Incremental_Refresh_Label_Generic",23),e.canShowManageAggregations&&this.addMenuItem(i,s.Entity,"FieldListMenuItem_ManageAggregations",24),e.canCopyTable&&this.addMenuItem(i,s.Copy,"DataExplorerFieldListMenuItem_CopyTable",19)),e.canMoveUp&&this.addMenuItem(i,s.Edit,"FieldListMenuItem_MoveUp",6),e.canMoveDown&&this.addMenuItem(i,s.Edit,"FieldListMenuItem_MoveDown",7),e.canRename&&this.addMenuItem(i,s.Edit,"ItemAction_Rename",3),e.canDelete&&this.addMenuItem(i,s.Edit,"ItemAction_Delete",4),e.canHide&&this.addMenuItem(i,s.Edit,"FieldListMenuItem_Hide",0,e.hidden),e.canHideInReportView&&this.addMenuItem(i,s.Edit,"FieldListMenuItem_HideInReportView",0,e.hidden),(e.canUnHideAll||e.canViewHidden)&&(e.canViewHidden&&this.addMenuItem(i,s.Hidden,"FieldListMenuItem_ViewHidden",1,e.showHidden),e.canUnHideAll&&this.addMenuItem(i,s.Hidden,"FieldListMenuItem_UnHideAll",2)),e.canExpandCollapseAll&&(this.addMenuItem(i,s.ExpandCollapse,"FieldListMenuItem_CollapseAll",13),this.addMenuItem(i,s.ExpandCollapse,"FieldListMenuItem_ExpandAll",14)),e.canGroup&&this.addMenuItem(i,s.Groups,"ContextMenuItem_CreateGroups",15),e.canEditGroups&&this.addMenuItem(i,s.Groups,"ContextMenuItem_EditGroups",16),e.canEditClustering&&this.addMenuItem(i,s.Groups,"Clustering_EditClusters",17),e.canShowFieldProperties&&this.addMenuItem(i,s.FieldProperties,"Properties",20),i},e.prototype.createHierarchyMenuSections=function(e,t){var r=e.contract,o=e.entity.contract.hierarchies;if(this.addMenuItem(t,s.HierarchyCreate,"FieldListMenuItem_NewHierarchy",10),!_.isEmpty(o)){var a=o.slice(0);n.sortHierarchies(a);var l=i.FieldListViewModelUtils.getHierarchyLevelDictionary(o),c=_.filter(a,(function(e){var t=l[e.name];return!(t&&t[r.name])})),u=_.map(c,(function(e){return{text:e.displayName,key:{action:11,hierarchyName:e.name},type:0,checked:!1}}));if(!_.isEmpty(u)){this.addMenuItem(t,s.HierarchyAddTo,"FieldListMenuItem_AddToHierarchy",void 0).children=u}}return t},e.prototype.createCustomDateTableSection=function(e,t){var i=this.addMenuItem(e,s.Edit,"CustomDateTableDialog_Header_Mark",void 0),r=a.createFieldListMenuItem("CustomDateTableDialog_Header_Mark",{action:21},this.localizationService,t.contract.isDateTable),o=a.createFieldListMenuItem("CustomDateTableDialog_Header_DateTableSettings",{action:22},this.localizationService,!1);return o.disabled=!t.contract.isDateTable,i.children=[r,o],e},e.prototype.addMenuItem=function(e,t,i,r,o){void 0===o&&(o=!1);var n=a.createFieldListMenuItem(i,void 0!==r?{action:r}:void 0,this.localizationService,o);return this.addMenuItems(e,t,[n]),n},e.prototype.addMenuItems=function(e,t,i){var r=e[t];r||(r=[],e[t]=r),r.push.apply(r,i)},e.prototype.getMenuItemsAndSeparators=function(e){for(var t=[],i=0,r=e;i<r.length;i++){var o=r[i];_.size(o)>0&&(t.length>0&&t.push(a.createItemSeparator()),t.push.apply(t,o))}return t},e.prototype.canShowFieldProperties=function(){return this.featureSwitchService.featureSwitches.fieldProperties},e.prototype.isQuickMeasureSupported=function(e){return e.schema.canEdit||e.contractSchema.capabilities.isExtendable},e.prototype.canMarkCustomDateTable=function(e){return!(!e.schema.canEdit||!this.featureSwitchService.featureSwitches.canMarkCustomDateTable)&&_.some(e.contract.properties,(function(e){return e.type.dateTime}))},e})();i.FieldListMenuItemFactory=l})(i=t.viewModels||(t.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){function t(){return new i}e.DefaultPropertyTemplate="Default",e.FolderPropertyTemplate="Folder",e.KpiPropertyTemplate="Kpi",e.HierarchyPropertyTemplate="Hierarchy",e.LeafPropertyTemplate="Leaf",e.createFieldListPropertyTemplateGenerator=t;var i=(function(){function t(){}return t.prototype.getTemplate=function(t){switch(t.fieldType){case 0:return this.getTemplateUri(e.DefaultPropertyTemplate);case 1:return this.getTemplateUri(e.FolderPropertyTemplate);case 4:return this.getTemplateUri(e.KpiPropertyTemplate);case 2:return this.getTemplateUri(e.HierarchyPropertyTemplate);case 5:case 3:return this.getTemplateUri(e.LeafPropertyTemplate);default:return this.getTemplateUri(e.DefaultPropertyTemplate)}},t.prototype.getTemplateUri=function(e){return"views/fieldListProperty"+e+".html"},t})();e.FieldListPropertyTemplateGenerator=i})(t=e.viewModels||(e.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){function t(e,t,r,o){return new i(e,t,r,o)}e.createFieldListViewModelFactory=t;var i=(function(){function t(e,t,i,r){this.menuItemFactory=e,this.propertyTemplateGenerator=t,this.localizationService=i,this.featureSwitchService=r}return Object.defineProperty(t.prototype,"featureSwitches",{get:function(){return this.featureSwitchService.featureSwitches},enumerable:!0,configurable:!0}),t.prototype.createModel=function(t,i,r,o){var n,a=t.schemas,s=e.FieldListViewModelUtils.getExtensions(a);a=e.FieldListViewModelUtils.sortExtensionSchemasAtEnd(a);for(var l=0,c=a;l<c.length;l++){var u=c[l];n=this.convertConceptualSchema(u,i,n,s,r,o)}return e.FieldListViewModelOperations.expandIfSingleEntity(n.entities),n},t.prototype.convertConceptualSchema=function(t,i,r,o,n,a){var s,l=this;r=r||new e.FieldListConceptualModel(t),r.disableDragging=a;var c=_.filter(t.entities,(function(t){return!e.FieldListViewModelUtils.isExtension(t)||e.FieldListViewModelUtils.isAbandoned(t)})),u=_.map(c,(function(e){return l.convertConceptualEntity(e,t,r,o)}));return(s=r.entities).push.apply(s,u),r.showNonUserEntities=i,r.disableEditing=n,r.menuItemFactory=this.menuItemFactory,r},t.prototype.convertConceptualEntity=function(t,i,r,o){var n,a=this,s=new e.FieldListConceptualEntity(t,i,r);if(s.properties=[],t.properties&&!e.FieldListViewModelUtils.isExtension(t))for(var l=0,c=t.properties;l<c.length;l++){var u=c[l];if(u.measure&&u.measure.kpi)s.properties.push(this.convertConceptualKpi(u,i,s));else if(!u.kpiValue){var p=this.convertConceptualProperty(u,i,s);s.properties.push(p)}}if(s.isMeasureGroup=e.FieldListViewModelUtils.isMeasureGroup(t.properties),s.expanded=!1,t.hierarchies&&t.hierarchies.length>0){s.hierarchies=_.map(t.hierarchies,(function(e){return a.convertConceptualHierarchy(e,i,s)}));for(var d=0,h=s.hierarchies;d<h.length;d++){var v=h[d];s.properties.push(v)}}if(!_.isEmpty(t.displayFolders)){var g;s.displayFolders=_.map(t.displayFolders,(function(e){return a.convertConceptualDisplayFolder(e,i,g,s)})),(n=s.properties).push.apply(n,s.displayFolders)}if(o){var f=e.FieldListViewModelUtils.getExtensionKey(i.name,t.name),y=o.entities[f];if(y)for(var m=0,S=y;m<S.length;m++)for(var w=S[m],C=0,b=w.entity.properties;C<b.length;C++){var u=b[C],x=this.convertConceptualExtensionMeasure(u,w.schema,s);s.properties.push(x)}}return e.FieldListViewModelUtils.sortProperties(s.properties),e.FieldListViewModelUtils.removeDuplicateProperties(s.properties,s.displayFolders),e.FieldListViewModelUtils.flattenFolders(s),e.FieldListViewModelUtils.updatePropertiesWithChildren(s),s},t.prototype.convertConceptualDisplayFolder=function(e,t,i,r){for(var o={},n={},a=0,s=r.properties;a<s.length;a++){var l=s[a];3===l.fieldType||2===l.fieldType?n[l.name]=l:o[l.name]=l}return this.convertConceptualDisplayFolderCore(e,t,i,o,n,r)},t.prototype.convertConceptualDisplayFolderCore=function(t,i,r,o,n,a){for(var s=[],l=0,c=t.properties;l<c.length;l++){var u=c[l];if(u){var p=o[u.name];p&&s.push(p.clone())}}for(var d=0,h=t.hierarchies;d<h.length;d++){var v=h[d];if(v){var p=n[v.name];p&&s.push(p.clone())}}var g=new e.FieldListConceptualDisplayFolder(t,s,r,i,a);g.template=this.propertyTemplateGenerator.getTemplate(g);for(var f=0,y=t.displayFolders;f<y.length;f++){var m=y[f];g.children.push(this.convertConceptualDisplayFolderCore(m,i,g,o,n,a))}return e.FieldListViewModelUtils.sortProperties(g.children),g},t.prototype.convertConceptualHierarchy=function(t,i,r,o,n){var a=new e.FieldListConceptualHierarchy(t,i,r,o,n);a.template=this.propertyTemplateGenerator.getTemplate(a),a.hierarchyLevels=[];for(var s=0,l=t.levels;s<l.length;s++){var c=l[s];a.hierarchyLevels.push(this.convertConceptualHierarchyLevel(c,i,a))}return a},t.prototype.convertConceptualHierarchyLevel=function(t,i,r){var o=new e.FieldListConceptualHierarchyLevel(t,i,r,r.entity,r.originalEntity,r.variation);return o.template=this.propertyTemplateGenerator.getTemplate(o),o},t.prototype.convertConceptualProperty=function(t,i,r){var o=new e.FieldListConceptualProperty(t,i,r);return this.featureSwitches.variationUIChange&&e.FieldListViewModelUtils.updateChildrenWithVariations(this,o),o.template=this.propertyTemplateGenerator.getTemplate(o),o},t.prototype.convertConceptualExtensionMeasure=function(t,i,r){var o=new e.FieldListConceptualExtensionMeasure(t,i,r);return o.template=this.propertyTemplateGenerator.getTemplate(o),o},t.prototype.convertConceptualKpi=function(t,i,r){var o=this,n=new e.FieldListConceptualKpi(t,i,r);n.template=this.propertyTemplateGenerator.getTemplate(n);var a={};this.localizationService.ensureLocalization((function(){a.KpiValueDisplayName=o.localizationService.get("KpiValueFieldListDisplayName"),a.KpiStatusDisplayName=o.localizationService.get("KpiStatusFieldListDisplayName"),a.KpiGoalDisplayName=o.localizationService.get("KpiGoalFieldListDisplayName"),a.KpiTrendDisplayName=o.localizationService.get("KpiTrendFieldListDisplayName")}));var s=t.measure.kpi,l=s.goal,c=s.status,u=s.trend;return n.kpiMeasures=[],n.kpiMeasures.push(this.convertConceptualKpiMeasure(t,i,2,n,r,a)),l&&n.kpiMeasures.push(this.convertConceptualKpiMeasure(l,i,1,n,r,a)),c&&n.kpiMeasures.push(this.convertConceptualKpiMeasure(c,i,0,n,r,a)),u&&n.kpiMeasures.push(this.convertConceptualKpiMeasure(u,i,3,n,r,a)),n},t.prototype.convertConceptualKpiMeasure=function(t,i,r,o,n,a){var s=new e.FieldListConceptualKpiMeasure(t,i,r,o,n,a);return s.template=this.propertyTemplateGenerator.getTemplate(s),s},t})()})(t=e.viewModels||(e.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i,r=e.explore.util.ModelAuthoringUtility;!(function(i){function o(e){return _.find(e,(function(e){return!e.hidden}))&&!_.find(e,(function(e){return!e.hidden&&1!==e.kind&&2!==e.kind}))}function n(e){for(var t={entities:{}},i=0,r=e;i<r.length;i++){var o=r[i];if(l(o))for(var n=o.extends,a=0,c=o.entities;a<c.length;a++){var u=c[a];if(l(u)){var p={schema:o,entity:u},d=s(n,u.name),h=t.entities[d];h?h.push(p):(h=[p],t.entities[d]=h)}}}return t}function a(e){var t=_.filter(e,(function(e){return!l(e)})),i=_.filter(e,(function(e){return l(e)}));return _.union(t,i)}function s(e,t){return JSON.stringify({e:t})}function l(e){return e.hasOwnProperty("extends")}function c(e){return e.isAbandoned}function u(e){for(var t=e.properties,i=[],r=0,o=t;r<o.length;r++){p(i,o[r]);
}e.properties=i}function p(e,i){if(e.push(i),(i instanceof t.FieldListConceptualKpi||i instanceof t.FieldListConceptualHierarchy||i instanceof t.FieldListConceptualProperty)&&!_.isEmpty(i.properties))for(var r=0,o=i.properties;r<o.length;r++){var n=o[r];p(e,n)}}function d(e){_.isEmpty(e)||e.sort(h)}function h(e,t){var i=e.displayName.toLocaleUpperCase(),r=t.displayName.toLocaleUpperCase();return i.localeCompare(r)}function v(e,t){if(!_.isEmpty(e)){var i={};g(t,i);var r=_.filter(e,(function(e){return 1!==e.fieldType&&i[e.name]}));_.isEmpty(r)||_.pull.apply(_,[e].concat(r))}}function g(e,t){if(!_.isEmpty(e)){for(var i=[],r=0,o=e;r<o.length;r++)for(var n=o[r],a=0,s=n.children;a<s.length;a++){var l=s[a];1===l.fieldType?i.push(l):t[l.name]=l}g(i,t)}}function f(e){var t=[];y(e.properties,t),e.properties=t}function y(e,t){for(var i=0,r=e;i<r.length;i++){var o=r[i];if(t.push(o),1===o.fieldType){y(o.children,t)}}}function m(e,t){return _.find(e.entities,(function(e){return e.contract===t}))}function S(e){var t={};if(!_.isEmpty(e))for(var i=0,r=e;i<r.length;i++){var o=r[i],n={};t[o.name]=n;for(var a=0,s=o.levels;a<s.length;a++){var l=s[a];n[l.column.name]=l}}return t}function w(e,i){var r=i.contract,o=i.schema,n=i.entity;if(r.column&&r.column.variations)for(var a=function(r){var a=r.navigationProperty.targetEntity;if(!a||!a.hierarchies||_.find(i.children,(function(e){return e instanceof t.FieldListConceptualItem&&e.variation===r.name})))return"continue";var s=r.defaultHierarchy;if(s.hidden)return"continue";var l=e.convertConceptualHierarchy(s,o,n,a,r.name);l.parent=i,i.children.push(l)},s=0,l=r.column.variations;s<l.length;s++){var c=l[s];a(c)}}function C(t,i,o,n,a,s){return __awaiter(this,void 0,e.Promise,(function(){var e;return __generator(this,(function(l){switch(l.label){case 0:n.displayNameOverride=s,l.label=1;case 1:return l.trys.push([1,,5,6]),e=r.rename(a,s,o),e?[4,e]:[3,4];case 2:return l.sent(),[4,t.get(i.get())];case 3:l.sent(),l.label=4;case 4:return[3,6];case 5:return n.displayNameOverride=null,[7];case 6:return[2]}}))}))}i.isMeasureGroup=o,i.getExtensions=n,i.sortExtensionSchemasAtEnd=a,i.getExtensionKey=s,i.isExtension=l,i.isAbandoned=c,i.updatePropertiesWithChildren=u,i.sortProperties=d,i.removeDuplicateProperties=v,i.flattenFolders=f,i.findTargetEntityViewModel=m,i.getHierarchyLevelDictionary=S,i.updateChildrenWithVariations=w,i.applyItemRename=C})(i=t.FieldListViewModelUtils||(t.FieldListViewModelUtils={}))})(i=t.viewModels||(t.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i;!(function(i){function r(e,t,i,r,n,a,s,l){if(e&&t||(e={schema:void 0,isLoaded:!1}),t){var c=t.schemas;_.some(c)&&(e.schema?o(e,t,n,a,r,i):(e.schema=i.createModel(t,n,s,l),e.isLoaded=!0))}return e}function o(e,i,r,o,n,a){var s=t.FieldListViewModelUtils.getExtensions(i.schemas);v.visitModel(e,i,s,[new g(e.schema,n),new f(a,s),new y(a,s,n,o),new m])}function n(e,t,i,r){t.contract=i;for(var o=i.measure.kpi,n=0,s=t.kpiMeasures;n<s.length;n++){var l=s[n],c=void 0;switch(l.kpiType){case 2:c=i;break;case 1:c=o.goal;break;case 0:c=o.status;break;case 3:c=o.trend}a(l,c)}}function a(e,t){e.contract=t}function s(e,i,r,o,n){var a={};if(!_.isEmpty(i))for(var c=0,u=i;c<u.length;c++){var p=u[c];a[p.name]=p}for(var d=0,h=r;d<h.length;d++){var v=h[d],g=v.name,p=a[g];if(p){delete a[g];var f=_.filter(p.children,(function(e){return 1===e.fieldType}));l(e,p,v),s(e,f,v.displayFolders,o,p)}else{var y=o.convertConceptualDisplayFolder(v,e.contractSchema,n,e);n?(n.children||(n.children=[]),n.children.push(y),t.FieldListViewModelUtils.sortProperties(n.children)):(e.displayFolders||(e.displayFolders=[]),e.displayFolders.push(y),e.properties.push(y))}}if(!_.isEmpty(a)){var m=_.values(a);_.isEmpty(m)||m.forEach((function(e){_.isEmpty(e.children)||e.children.forEach((function(e){return e.parent=void 0}))})),n?_.pull.apply(_,[n.children].concat(m)):_.pull.apply(_,[e.displayFolders].concat(m))}}function l(e,t,i){var r={},o=_.filter(t.children,(function(e){return 1!==e.fieldType}));if(!_.isEmpty(o))for(var n=0,a=o;n<a.length;n++){var s=a[n];r[s.name]=s}if(!_.isEmpty(i.properties))for(var l=0,c=i.properties;l<c.length;l++){var u=c[l],p=u.name,s=r[p];if(s)delete r[p];else{var d=e.findFields(p,t.schemaName)||e.findKpis(p,t.schemaName),h=d[0].clone();h.parent=t,t.children.push(h)}}if(!_.isEmpty(i.hierarchies))for(var v=0,g=i.hierarchies;v<g.length;v++){var f=g[v],y=f.name,m=r[y];if(m)delete r[y];else{var d=e.findHierarchies(y,t.schemaName),h=_.head(d).clone();h.parent=t,t.children.push(h)}}if(!_.isEmpty(r)){var S=_.values(r);_.pull.apply(_,[t.children].concat(S))}}function c(e){var t=e.properties,i=_.filter(t,(function(e){return 1===e.fieldType}));_.isEmpty(i)||_.pull.apply(_,[t].concat(i)),e.displayFolders&&t.push.apply(t,e.displayFolders)}function u(e){return!!e.measure&&!!e.measure.kpi}function p(e){return!!e.kpiValue}function d(e,t,i,r,o){if(!_.isEmpty(e)){var n=_.filter(e,(function(e){return e.propertyRename&&e.propertyRename.after===t}));_.isEmpty(n)||(t=n[0].propertyRename.before)}return r.findFieldsByType(t,i,o)}var h=e.explore.util.HierarchyUtils;i.mergeModel=r;var v;!(function(e){function i(e,i,o,n){for(var a,s=t.FieldListViewModelUtils.sortExtensionSchemasAtEnd(i.schemas),l=0,c=s;l<c.length;l++){var u=c[l];if(!t.FieldListViewModelUtils.isExtension(u))for(var p=0,d=n;p<d.length;p++){var h=d[p];a=h.visitModel(a,u)}for(var v=0,g=u.entities;v<g.length;v++){var f=g[v];t.FieldListViewModelUtils.isExtension(f)&&!t.FieldListViewModelUtils.isAbandoned(f)||r(u,f,o,n)}if(!t.FieldListViewModelUtils.isExtension(u))for(var y=0,m=n;y<m.length;y++){var h=m[y];a=h.modelVisited(a,u)}}}function r(e,i,r,c){for(var h,v=0,g=c;v<g.length;v++){var f=g[v];h=f.visitEntity(h,e,i)}if(!t.FieldListViewModelUtils.isExtension(i))for(var y=0,m=i.properties;y<m.length;y++){var S=m[y];t.FieldListViewModelUtils.isExtension(S)||(u(S)?a(e,S,c):p(S)?s(e,S,c):o(e,S,c))}var w=r.entities[t.FieldListViewModelUtils.getExtensionKey(e.name,i.name)];if(w)for(var C=0,b=w;C<b.length;C++)for(var x=b[C],F=0,D=x.entity.properties;F<D.length;F++){var S=D[F];n(x.schema,S,c)}for(var V=0,M=i.hierarchies;V<M.length;V++){l(e,M[V],c)}for(var P=0,E=c;P<E.length;P++){var f=E[P];h=f.entityVisited(h,i)}for(var T=0,A=i.displayFolders;T<A.length;T++){d(e,A[T],c)}}function o(e,t,i){for(var r,o=0,n=i;o<n.length;o++){r=n[o].visitProperty(r,e,t)}}function n(e,t,i){for(var r,o=0,n=i;o<n.length;o++){r=n[o].visitExtensionMeasure(r,e,t)}}function a(e,t,i){for(var r,o=0,n=i;o<n.length;o++){r=n[o].visitKpi(r,e,t)}}function s(e,t,i){for(var r,o=0,n=i;o<n.length;o++){r=n[o].visitKpiMeasure(r,e,t)}}function l(e,t,i){for(var r,o=0,n=i;o<n.length;o++){r=n[o].visitHierarchy(r,e,t)}for(var a=0,s=t.levels;a<s.length;a++){c(e,s[a],i)}}function c(e,t,i){for(var r,o=0,n=i;o<n.length;o++){r=n[o].visitHierarchyLevel(r,e,t)}}function d(e,t,i){for(var r,o=0,n=i;o<n.length;o++){r=n[o].visitDisplayFolder(r,e,t)}for(var a=0,s=t.displayFolders;a<s.length;a++){d(e,s[a],i)}}e.visitModel=i})(v||(v={}));var g=(function(){function e(e,t){this.fieldListConceptualModel=e,t&&(this.schemaChanges=t.changes,this.entityRenameChanges=_.filter(this.schemaChanges,(function(e){return e.entityRename})))}return e.prototype.visitModel=function(e,t){return this.fieldListConceptualModel},e.prototype.visitEntity=function(e,i,r){return this.fieldListConceptualEntity=this.getFieldListConceptualEntity(r),this.fieldListConceptualEntity&&t.FieldListViewModelUtils.isAbandoned(this.fieldListConceptualEntity.contract)!==t.FieldListViewModelUtils.isAbandoned(r)&&(this.fieldListConceptualEntity=null),this.propertyRenameChanges=this.fieldListConceptualEntity&&_.filter(this.schemaChanges,(function(e){return e.propertyRename&&e.propertyRename.entity===r.name&&"Hierarchy"!==e.propertyRename.objectType})),this.hierarchyRenameChanges=this.fieldListConceptualEntity&&_.filter(this.schemaChanges,(function(e){return e.propertyRename&&e.propertyRename.entity===r.name&&"Hierarchy"===e.propertyRename.objectType})),this.fieldListConceptualEntity},e.prototype.visitProperty=function(e,t,i){if(this.fieldListConceptualEntity){var r=d(this.propertyRenameChanges,i.name,t.name,this.fieldListConceptualEntity,0);return _.filter(r,(function(e){return!e.isExtension}))}},e.prototype.visitExtensionMeasure=function(e,t,i){if(this.fieldListConceptualEntity){var r=d(this.propertyRenameChanges,i.name,t.name,this.fieldListConceptualEntity,0);return _.filter(r,(function(e){return e.isExtension}))}},e.prototype.visitHierarchy=function(e,t,i){if(this.fieldListConceptualHierarchies=this.fieldListConceptualEntity&&d(this.hierarchyRenameChanges,i.name,t.name,this.fieldListConceptualEntity,2),_.isEmpty(this.fieldListConceptualHierarchies))this.fieldListConceptualHierarchies=null,this.existingLevels=null;else{this.existingLevels={};for(var r=_.head(this.fieldListConceptualHierarchies).hierarchyLevels,o=0,n=r;o<n.length;o++){var a=n[o];this.existingLevels[a.name]=a}}return this.fieldListConceptualHierarchies},e.prototype.visitHierarchyLevel=function(e,t,i){var r=this;if(!_.isEmpty(this.fieldListConceptualHierarchies)){var o=i.name,n=_.head(this.fieldListConceptualHierarchies),a=_.filter(this.schemaChanges,(function(e){return e.hierarchyLevelRename&&e.hierarchyLevelRename.entity===r.fieldListConceptualEntity.contract.name&&e.hierarchyLevelRename.hierarchy===n.contract.name&&e.hierarchyLevelRename.after===o}));return _.isEmpty(a)||(o=_.head(a).hierarchyLevelRename.before),this.existingLevels[o]}},e.prototype.visitKpi=function(e,t,i){if(this.fieldListConceptualEntity)return d(this.propertyRenameChanges,i.name,t.name,this.fieldListConceptualEntity,4)},e.prototype.visitKpiMeasure=function(e,t,i){if(this.fieldListConceptualEntity)return d(this.propertyRenameChanges,i.name,t.name,this.fieldListConceptualEntity,5)},e.prototype.visitDisplayFolder=function(e,t,i){return this.fieldListConceptualEntity?d(this.propertyRenameChanges,i.name,t.name,this.fieldListConceptualEntity,1):e},e.prototype.modelVisited=function(e,t){return e},e.prototype.entityVisited=function(e,t){return e},e.prototype.getFieldListConceptualEntity=function(e){var t=e.name;if(!_.isEmpty(this.entityRenameChanges)){var i=_.filter(this.entityRenameChanges,(function(t){return t.entityRename&&t.entityRename.after===e.name}));_.isEmpty(i)||(t=i[0].entityRename.before)}return this.fieldListConceptualModel.findEntity(t)},e})(),f=(function(){function e(e,t){this.fieldListViewModelFactory=e,this.extensions=t}return e.prototype.visitModel=function(e,t){return this.fieldListConceptualModel=e,e&&(e.contract=t),e},e.prototype.visitEntity=function(e,t,i){return this.fieldListConceptualEntity=e,e&&(e.contract=i),this.fieldListConceptualEntity},e.prototype.modelVisited=function(e,t){return e},e.prototype.entityVisited=function(e,t){return e},e.prototype.visitProperty=function(e,t,i){if(e)for(var r=0,o=e;r<o.length;r++){var n=o[r];n.contract=i}return e},e.prototype.visitExtensionMeasure=function(e,t,i){if(e)for(var r=0,o=e;r<o.length;r++){var n=o[r];n.contract=i}return e},e.prototype.visitHierarchy=function(e,t,i){if(e){for(var r=0,o=e;r<o.length;r++){o[r].contract=i}this.fieldListConceptualHierarchies=e;for(var n=0,a=this.fieldListConceptualHierarchies;n<a.length;n++){a[n].hierarchyLevels=[]}}return e},e.prototype.visitHierarchyLevel=function(e,t,i){if(e){e.contract=i.column,e.hierarchyLevelContract=i;for(var r=0,o=this.fieldListConceptualHierarchies;r<o.length;r++){o[r].hierarchyLevels.push(e)}}return e},e.prototype.visitKpi=function(e,t,i){if(!_.isEmpty(e))for(var r=0,o=e;r<o.length;r++){var a=o[r];n(this.fieldListConceptualEntity,a,i,this.fieldListConceptualEntity.contract)}return e},e.prototype.visitKpiMeasure=function(e,t,i){if(!_.isEmpty(e))for(var r=0,o=e;r<o.length;r++){var n=o[r];n.contract=i}return e},e.prototype.visitDisplayFolder=function(e,t,i){return e},e})(),y=(function(){function e(e,t,i,r){this.fieldListViewModelFactory=e,this.extensions=t,i&&(this.modelSchemaChanges=i.changes),this.showVariationUIChange=r}return e.prototype.visitModel=function(e,t){return this.fieldListConceptualModel=e,this.schema=t,e},e.prototype.visitEntity=function(e,i,r){if(this.fieldListConceptualEntity=e,this.fieldListConceptualModel&&!e){var o=this.fieldListViewModelFactory.convertConceptualEntity(r,i,this.fieldListConceptualModel,this.extensions);this.fieldListConceptualModel.entities.push(o)}return this.sortedHierarchies=r.hierarchies.slice(0),h.sortHierarchies(this.sortedHierarchies),this.hierarchyLevelDictionary=this.fieldListConceptualModel.canEdit&&t.FieldListViewModelUtils.getHierarchyLevelDictionary(r.hierarchies),this.fieldListConceptualEntity},e.prototype.modelVisited=function(e,t){return e},e.prototype.entityVisited=function(e,t){return e&&s(this.fieldListConceptualEntity,this.fieldListConceptualEntity.displayFolders,t.displayFolders,this.fieldListViewModelFactory,null),e},e.prototype.visitProperty=function(e,i,r){if(this.fieldListConceptualEntity){if(_.isEmpty(e)){var o=this.fieldListViewModelFactory.convertConceptualProperty(r,i,this.fieldListConceptualEntity);this.fieldListConceptualEntity.properties.push(o)}if(this.showVariationUIChange)for(var n=0,a=e;n<a.length;n++){var s=a[n];t.FieldListViewModelUtils.updateChildrenWithVariations(this.fieldListViewModelFactory,s)}return e}},e.prototype.visitExtensionMeasure=function(e,t,i){if(this.fieldListConceptualEntity&&_.isEmpty(e)){var r=this.fieldListViewModelFactory.convertConceptualExtensionMeasure(i,t,this.fieldListConceptualEntity);this.fieldListConceptualEntity.properties.push(r)}return e},e.prototype.visitHierarchy=function(e,t,i){if(this.fieldListConceptualHierarchies=e,this.fieldListConceptualEntity&&_.isEmpty(e)){var r=this.fieldListViewModelFactory.convertConceptualHierarchy(i,t,this.fieldListConceptualEntity);this.fieldListConceptualEntity.hierarchies||(this.fieldListConceptualEntity.hierarchies=[]),this.fieldListConceptualEntity.hierarchies.push(r),this.fieldListConceptualEntity.properties.push(r),this.expandHierarchyIfJustCreated(r),e=[r]}return e},e.prototype.visitHierarchyLevel=function(e,t,i){if(!_.isEmpty(this.fieldListConceptualHierarchies)&&!e){var r=_.head(this.fieldListConceptualHierarchies);e=this.fieldListViewModelFactory.convertConceptualHierarchyLevel(i,t,r);for(var o=0,n=this.fieldListConceptualHierarchies;o<n.length;o++){n[o].hierarchyLevels.push(e)}}return e},e.prototype.visitKpi=function(e,t,i){if(this.fieldListConceptualEntity&&_.isEmpty(e)){var r=this.fieldListViewModelFactory.convertConceptualKpi(i,t,this.fieldListConceptualEntity);this.fieldListConceptualEntity.properties.push(r),e=[r]}return e},e.prototype.visitKpiMeasure=function(e,t,i){return e},e.prototype.visitDisplayFolder=function(e,t,i){return e},e.prototype.expandHierarchyIfJustCreated=function(e){var t=this;_.some(this.modelSchemaChanges,(function(i){return i.hierarchyCreate&&i.hierarchyCreate.entity===t.fieldListConceptualEntity.contract.name&&i.hierarchyCreate.name===e.name}))&&(e.expanded=!0)},e})(),m=(function(){function e(){}return e.prototype.visitModel=function(e,t){this.fieldListConceptualModel=e,this.existingEntities=[];for(var i=0,r=this.fieldListConceptualModel.entities;i<r.length;i++){var o=r[i];this.existingEntities.push(o)}return e},e.prototype.visitEntity=function(e,t,i){if(this.fieldListConceptualEntity=e,e){if(_.pull(this.existingEntities,e),this.existingHierarchies=[],this.fieldListConceptualEntity.hierarchies)for(var r=0,o=this.fieldListConceptualEntity.hierarchies;r<o.length;r++){var n=o[r];this.existingHierarchies.push(n)}this.existingProperties=[];for(var a=0,s=this.fieldListConceptualEntity.properties;a<s.length;a++){var l=s[a];this.existingProperties.push(l)}}return this.fieldListConceptualEntity},e.prototype.modelVisited=function(e,i){return _.pull.apply(_,[this.fieldListConceptualModel.entities].concat(this.existingEntities)),t.FieldListViewModelOperations.expandIfSingleEntity(this.fieldListConceptualModel.entities),e},e.prototype.entityVisited=function(e,i){return e&&(_.pull.apply(_,[this.fieldListConceptualEntity.hierarchies].concat(this.existingHierarchies)),_.pull.apply(_,[this.fieldListConceptualEntity.properties].concat(this.existingProperties)),c(this.fieldListConceptualEntity),t.FieldListViewModelUtils.sortProperties(this.fieldListConceptualEntity.properties),t.FieldListViewModelUtils.removeDuplicateProperties(this.fieldListConceptualEntity.properties,this.fieldListConceptualEntity.displayFolders),t.FieldListViewModelUtils.flattenFolders(this.fieldListConceptualEntity),t.FieldListViewModelUtils.updatePropertiesWithChildren(this.fieldListConceptualEntity)),e},e.prototype.visitProperty=function(e,i,r){if(this.fieldListConceptualEntity&&!_.isEmpty(e))for(var o=0,n=e;o<n.length;o++){var a=n[o];if(_.pull(this.existingProperties,a),!_.isEmpty(a.children))for(var s=0,l=a.children;s<l.length;s++){var c=l[s];c instanceof t.FieldListConceptualItem&&c.originalEntity&&!i.entities.withName(c.originalEntity.name)&&_.pull(a.children,c)}}return e},e.prototype.visitExtensionMeasure=function(e,t,i){if(this.fieldListConceptualEntity&&!_.isEmpty(e))for(var r=0,o=e;r<o.length;r++){var n=o[r];_.pull(this.existingProperties,n)}return e},e.prototype.visitHierarchy=function(e,t,i){if(this.fieldListConceptualEntity&&!_.isEmpty(e))for(var r=0,o=e;r<o.length;r++){var n=o[r];_.pull(this.existingProperties,n),_.pull(this.existingHierarchies,n)}return e},e.prototype.visitHierarchyLevel=function(e,t,i){return e},e.prototype.visitKpi=function(e,t,i){if(!_.isEmpty(e))for(var r=0,o=e;r<o.length;r++){var n=o[r];_.pull(this.existingProperties,n)}return e},e.prototype.visitKpiMeasure=function(e,t,i){return e},e.prototype.visitDisplayFolder=function(e,t,i){if(this.fieldListConceptualEntity&&!_.isEmpty(e))for(var r=0,o=e;r<o.length;r++){var n=o[r];_.pull(this.existingProperties,n)}return e},e})()})(i=t.FieldListViewModelMerger||(t.FieldListViewModelMerger={}))})(i=t.viewModels||(t.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r,o=e.data.FieldExprPattern,n=t.services.schemaItemActivationUtils,a=e.data.SQExprBuilder;!(function(e){function t(e){return e.supported&&(!e.hidden||e.showHidden)}e.isFieldVisible=t})(r=i.FieldListUtils||(i.FieldListUtils={}));var s;!(function(t){function i(e,t,i,r){var o=f(r);if(o)return l(e,o),n.setActiveSchemaItem(t,o,i),o}function r(e,t){for(var i=0,r=e.entities;i<r.length;i++){var o=r[i];o.expanded=t;for(var n=0,a=o.properties;n<a.length;n++){var s=a[n];2!==s.fieldType&&4!==s.fieldType&&1!==s.fieldType||(s.expanded=t)}}}function s(t,i){var r=e.data.SQExprConverter.asFieldPattern(i),n=o.toFieldExprEntityItemPattern(r);if(n.entity){var a=t.findEntity(n.entity);a&&(a.expanded=!0)}}function l(e,i){s(e,i),t.updateSelection(e,i)}function c(t,i){var r=e.data.SQExprConverter.asFieldPattern(i),n=o.toFieldExprEntityItemPattern(r);if(n&&n.entity)if(o.hasFieldExprName(r)){var a=t.findFields(n.entity,o.getPropertyName(r),n.schema);if(a){for(var s=0,l=a;s<l.length;s++){var c=l[s];c.hidden=!c.hidden}return _.head(a).hidden}}else if(r.hierarchy){var u=t.findHierarchies(n.entity,o.getHierarchyName(r),n.schema);if(u){for(var p=0,d=u;p<d.length;p++){var h=d[p];h.hidden=!h.hidden}return _.head(u).hidden}}else{var v=t.findEntity(n.entity);if(v)return v.hidden=!v.hidden,v.hidden}}function u(e){e.showHidden=!e.showHidden}function p(e){for(var t=0,i=e.entities;t<i.length;t++){var r=i[t];r.canEdit&&r.hidden&&(r.hidden=!1);for(var o=0,n=r.properties;o<n.length;o++){var a=n[o];a.canEdit&&a.hidden&&(a.hidden=!1)}}}function d(e){for(var t=0,i=e.entities;t<i.length;t++)for(var r=i[t],o=0,n=r.properties;o<n.length;o++){var a=n[o],s=a;s.supported=!(s.type&&s.type.binary)}}function h(e){for(var t=0,i=e.entities;t<i.length;t++){var r=i[t];r.selected=!1;for(var o=0,n=r.properties;o<n.length;o++){n[o].selected=!1}}}function v(i,r){t.clearSelection(i);var n=e.data.SQExprConverter.asFieldPattern(r);if(n){var a=o.toFieldExprEntityItemPattern(n);if(a.entity)if(o.hasFieldExprName(n)){var s=i.findFields(a.entity,o.getPropertyName(n),a.schema);if(s)for(var l=0,c=s;l<c.length;l++){var u=c[l];u.selected=!0}}else{var p=i.findEntity(a.entity);p&&(p.selected=!0)}}}function g(e){var t=_.filter(e,(function(e){return e.userEntity&&!e.hidden}));1===t.length&&(t[0].expanded=!0)}function f(e){if(null!=e&&!_.isEmpty(e.changes)){var t=_.filter(e.changes,(function(e){return e.newMeasureCreated||e.newCalculatedColumnCreated||e.measureMove||e.newCalculatedTableCreated||e.newBins||e.newGroups}));if(1===t.length){var i,r,o,n,s=t[t.length-1];return s.newMeasureCreated?(i=s.newMeasureCreated.schema,r=s.newMeasureCreated.entity,n=s.newMeasureCreated.name,a.measureRef(a.entity(i,r),n)):s.newCalculatedColumnCreated?(i=s.newCalculatedColumnCreated.schema,r=s.newCalculatedColumnCreated.entity,o=s.newCalculatedColumnCreated.name,a.columnRef(a.entity(i,r),o||n)):s.newCalculatedTableCreated?(i=s.newCalculatedTableCreated.schema,r=s.newCalculatedTableCreated.entity,a.entity(i,r)):s.measureMove?(i=s.measureMove.schema,r=s.measureMove.destination,n=s.measureMove.property,a.measureRef(a.entity(i,r),n)):s.newBins?(i=s.newBins.schema,r=s.newBins.entity,o=s.newBins.name,a.columnRef(a.entity(i,r),o)):s.newGroups?(i=s.newGroups.schema,r=s.newGroups.entity,o=s.newGroups.name,a.columnRef(a.entity(i,r),o)):void 0}}}t.applyModelChanges=i,t.collapseOrExpandAllEntities=r,t.expandEntity=s,t.expandEntityAndSelect=l,t.toggleHide=c,t.toggleShowHidden=u,t.unhideAll=p,t.updateSupportedProperties=d,t.clearSelection=h,t.updateSelection=v,t.expandIfSingleEntity=g})(s=i.FieldListViewModelOperations||(i.FieldListViewModelOperations={}))})(i=t.viewModels||(t.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r,o=e.data.FieldExprPattern,n=e.explore.utils.GroupUtils,a=e.data.SQExprBuilder,s=e.data.SQExprUtils,l=e.data.SQHierarchyExprUtils,c=e.explore.util.VisualContainerUtils;!(function(i){function r(e,t,i,r,n,a,s){var l=new v(e,n,a,t,i,r,s);return o.visit(e,l)}function u(e){return{type:0}}function p(e,t,i,r,n,a,s,l,c,u){return{items:o.visit(e.expr,new g(e,t,i,r,n,a,s,l,c,u))}}function d(e,t){var i=e.getConceptualProperty(t);return i&&1===i.kind}var h="Aggregate_";i.createAggregateMenuItems=r;var v=(function(){function i(e,t,i,r,o,n,a){this.sqExpr=e,this.dataRoleKind=t,this.requiredTypes=i,this.schema=r,this.aggrOps=o,this.hasHierarchyLevels=n,this.property=a}return i.prototype.visitEntity=function(e){return this.createMenuItems(this.sqExpr)},i.prototype.visitColumn=function(e){return this.createMenuItems(this.sqExpr)},i.prototype.visitColumnAggr=function(e){return this.createMenuItems(this.sqExpr)},i.prototype.visitGroupingColumn=function(e){return this.createMenuItems(this.sqExpr)},i.prototype.visitGroupingColumnAggr=function(e){return this.createMenuItems(this.sqExpr)},i.prototype.visitColumnHierarchyVariation=function(e){return this.createMenuItems(this.sqExpr)},i.prototype.visitColumnHierarchyLevelVariation=function(e){return this.createMenuItems(this.sqExpr)},i.prototype.visitEntityAggr=function(e){return this.createMenuItems(this.sqExpr)},i.prototype.visitHierarchy=function(e){return this.createMenuItems(this.sqExpr)},i.prototype.visitHierarchyLevel=function(e){return this.createMenuItems(this.sqExpr)},i.prototype.visitHierarchyLevelAggr=function(e){return this.createMenuItems(this.sqExpr)},i.prototype.visitMeasure=function(e){return[]},i.prototype.visitPercentOfGrandTotal=function(e){var t=a.fieldExpr(e.baseExpr);return this.createMenuItemsForPercentOfTotal(t)},i.prototype.visitPercentOfRoleTotal=function(e){var t=a.fieldExpr(e.baseExpr);return this.createMenuItemsForPercentOfTotal(t)},i.prototype.visitPercentile=function(e){return[]},i.prototype.visitSelectRef=function(e){return[]},i.prototype.visitFilteredEval=function(e){var t=a.fieldExpr(e.baseExpr);return this.createMenuItems(t)},i.prototype.createMenuItemsForPercentOfTotal=function(e){var t=a.removeAggregate(e,this.schema).getMetadata(this.schema);if(!t)return[];var i=t.type,r=i.text||i.dateTime||i.duration?[3,4]:[];return this.createMenuItems(e,r)},i.prototype.createMenuItems=function(t,i){void 0===i&&(i=[]);var r=[];if(!this.hasHierarchyLevels&&_.isEmpty(t.validate(this.schema,this.aggrOps))&&!s.discourageAggregation(t,this.schema)){var o=this.dataRoleKind===e.VisualDataRoleKind.Grouping,n=this.dataRoleKind===e.VisualDataRoleKind.GroupingOrMeasure,a=o?[]:this.aggrOps.getSupportedAggregates(t,this.schema,this.requiredTypes);a=_.difference(a,i),n&&!d(t,this.schema)&&r.push(this.createRemoveAggregateMenuItem());for(var l=0,c=a;l<c.length;l++){var u=c[l];r.push(this.createAggregateMenuItem(u))}}return r},i.prototype.createAggregateMenuItem=function(i){var r=u(this.property);r.key={action:2,aggregate:i};var o=a.removeAggregate(this.sqExpr,this.schema).getMetadata(this.schema),n=t.services.getAggregateKey(i,o);return r.text=e.common.localize.get(h+n),r},i.prototype.createRemoveAggregateMenuItem=function(){var t=u(this.property);return t.key={action:1},t.text=e.common.localize.get("FieldWell_RemoveAggregate"),t},i.prototype.visitTransformOutputRoleRef=function(e){return[]},i})(),g=(function(){function t(e,t,i,r,o,n,a,s,l,c){this.property=e,this.bucket=t,this.buckets=i,this.dataRole=r,this.schema=o,this.aggrOps=n,this.visual=a,this.featureSwitchService=s,this.groupingDesignStateService=l,this.showValueAsService=c,this.property.interactivityOptions.isEditableField?this.menuItems=[this.createDeleteMenuItem(),this.createRenameMenuItem()]:this.menuItems=[this.createDeleteMenuItem()],this.bucket.properties.length>1&&this.menuItems.push(this.createMoveGroupMenuItem()),this.buckets.length>1&&this.menuItems.push(this.createMoveToGroupMenuItem())}return t.prototype.visitEntity=function(e){return this.menuItems},t.prototype.visitColumn=function(e){var t=this.property.expr;return this.addConditionalFormattingMenuItems(t),this.addAggregateMenuItems(),this.addShowValueAsMenuItem(e.schema),this.addQuickCalcMenuItem(e.schema),this.addShowAllMenuItem(t),this.addHierarchiesMenuItems(this.property.hierarchyLevels),this.addVariationsMenuItems(e),this.addGroupsMenuItems(e),this.menuItems},t.prototype.visitColumnAggr=function(e){var t=this.property.expr;return this.addConditionalFormattingMenuItems(t),this.addAggregateMenuItems(),this.addShowValueAsMenuItem(e.schema),this.addQuickCalcMenuItem(e.schema),this.addShowAllMenuItem(t),this.addHierarchiesMenuItems(this.property.hierarchyLevels),this.addVariationsMenuItems(e),this.menuItems},t.prototype.visitGroupingColumn=function(e){var t=this.property.expr;return this.addConditionalFormattingMenuItems(t),this.addAggregateMenuItems(),this.addShowValueAsMenuItem(e.schema),this.addQuickCalcMenuItem(e.schema),this.addShowAllMenuItem(t),this.addHierarchiesMenuItems(this.property.hierarchyLevels),this.addVariationsMenuItems(e),this.addGroupsMenuItems(e),this.menuItems},t.prototype.visitGroupingColumnAggr=function(e){var t=this.property.expr;return this.addConditionalFormattingMenuItems(t),this.addAggregateMenuItems(),this.addShowValueAsMenuItem(e.schema),this.addQuickCalcMenuItem(e.schema),this.addShowAllMenuItem(t),this.addHierarchiesMenuItems(this.property.hierarchyLevels),this.addVariationsMenuItems(e),this.menuItems},t.prototype.visitColumnHierarchyVariation=function(e){return this.menuItems},t.prototype.visitColumnHierarchyLevelVariation=function(e){var t=this.property.expr;return this.addAggregateMenuItems(),this.addShowValueAsMenuItem(e.source.schema),this.addQuickCalcMenuItem(e.source.schema),this.addShowAllMenuItem(t),this.addHierarchiesMenuItems(this.property.hierarchyLevels),this.menuItems},t.prototype.visitEntityAggr=function(e){var t=this.property.expr;return this.addAggregateMenuItems(),this.addShowValueAsMenuItem(e.schema),this.addQuickCalcMenuItem(e.schema),this.addShowAllMenuItem(t),this.menuItems},t.prototype.visitHierarchy=function(e){return this.addAggregateMenuItems(),this.addShowValueAsMenuItem(e.schema),this.addShowAllMenuItem(_.head(this.property.hierarchyLevels).expr),this.addHierarchiesMenuItems(this.property.hierarchyLevels),this.menuItems},t.prototype.visitHierarchyLevel=function(e){var t=this.property.expr;return this.addAggregateMenuItems(),this.addShowValueAsMenuItem(e.schema),this.addQuickCalcMenuItem(e.schema),this.addShowAllMenuItem(t),this.addHierarchiesMenuItems(this.property.hierarchyLevels),this.menuItems},t.prototype.visitHierarchyLevelAggr=function(e){var t=this.property.expr;return this.addConditionalFormattingMenuItems(t),this.addAggregateMenuItems(),this.addShowValueAsMenuItem(e.schema),this.addQuickCalcMenuItem(e.schema),this.addShowAllMenuItem(t),this.menuItems},t.prototype.visitMeasure=function(e){var t=this.property.expr;return this.addConditionalFormattingMenuItems(t),this.addShowValueAsMenuItem(e.schema),this.addQuickCalcMenuItem(e.schema),this.addShowAllMenuItem(t),this.menuItems},t.prototype.visitPercentile=function(e){var t=this.property.expr;return this.addConditionalFormattingMenuItems(t),this.menuItems},t.prototype.visitSelectRef=function(e){return[]},t.prototype.visitTransformOutputRoleRef=function(e){return[]},t.prototype.visitPercentOfGrandTotal=function(e){return this.addPercentTotalMenuItems(e.baseExpr)},t.prototype.visitPercentOfRoleTotal=function(e){return this.addPercentTotalMenuItems(e.baseExpr)},t.prototype.visitFilteredEval=function(e){return this.addFilteredEvalMenuItems()},t.prototype.addFilteredEvalMenuItems=function(){return this.addAggregateMenuItems(),this.menuItems},t.prototype.addPercentTotalMenuItems=function(e){var t=a.fieldExpr(e);this.addConditionalFormattingMenuItems(t),this.addAggregateMenuItems(),this.addShowValueAsMenuItem(o.getSchema(e)),this.addShowAllMenuItem(t),this.addHierarchiesMenuItems(this.property.hierarchyLevels);var i=o.getProperty(e);return i&&this.addVariationsMenuItems(i),this.menuItems},t.prototype.addAggregateMenuItems=function(){var e,t=r(this.property.expr,this.schema,this.aggrOps,!_.isEmpty(this.property.hierarchyLevels),this.dataRole.kind,this.dataRole.requiredTypes,this.property);_.isEmpty(t)||(this.menuItems.push(this.createSeparatorMenuItem()),(e=this.menuItems).push.apply(e,t))},t.prototype.addConditionalFormattingMenuItems=function(e){if(!_.isEmpty(this.property.conditionalFormattingRepetitions)){if(e.getMetadata(this.schema)){c.hasGroupByItems(this.visual.query)||(this.menuItems.push(this.createSeparatorMenuItem()),this.addSetConditionalFormattingMenuItem(),this.addRemoveConditionalFormattingMenuItem())}}},t.prototype.addSetConditionalFormattingMenuItem=function(){if(!_.isEmpty(this.property.conditionalFormattingRepetitions)){var t=u(this.property);t.text=e.common.localize.get("FieldWell_ConditionalFormatting"),this.menuItems.push(t);for(var i=t.children=[],r=0,o=this.property.conditionalFormattingRepetitions;r<o.length;r++){var n=o[r];i.push(this.createConditionalFormattingMenuItem(n.propertyDescriptor.displayName,12,n))}}},t.prototype.addRemoveConditionalFormattingMenuItem=function(){var t=this.property.conditionalFormattingRepetitions;if(!_.isEmpty(t)){var i=u(this.property);i.text=e.common.localize.get("FieldWell_RemoveConditionalFormatting"),this.menuItems.push(i);for(var r=[],o=!1,n=this.visual&&this.visual.objects,a=0,s=t;a<s.length;a++){var l=s[a],c=n&&null!=e.VisualObjectRepetition.getDefinition(n,l);r.push(c),o=o||c}if(!o)return void(i.disabled=!0);var p=i.children=[];p.push(this.createConditionalFormattingMenuItem(e.data.createDisplayNameGetter("FieldWell_ConditionalFormatting_All"),13));for(var d=0,h=t.length;d<h;d++){var l=t[d],v=this.createConditionalFormattingMenuItem(l.propertyDescriptor.displayName,14,l);v.disabled=!r[d],p.push(v)}}},t.prototype.createConditionalFormattingMenuItem=function(t,i,r){var o=u(this.property);return o.key={action:i,conditionalFormattingRepetition:r},o.text=e.data.getDisplayName(t,e.common.localize),o},t.prototype.addShowAllMenuItem=function(t){var i=s.isMeasure(t);
c.hasGroupByItems(this.visual.query)||(this.dataRole.kind===e.VisualDataRoleKind.Grouping||this.dataRole.kind===e.VisualDataRoleKind.GroupingOrMeasure&&!i)&&(this.menuItems.push(this.createSeparatorMenuItem()),this.menuItems.push(this.createShowAllMenuItem()))},t.prototype.addHierarchiesMenuItems=function(e){if(!_.isEmpty(e)){var t=_.head(e),i=l.expandExpr(this.schema,t.expr.arg);i instanceof Array&&i.length===e.length||this.bucket.supportsMultipleItems&&(this.menuItems.push(this.createSeparatorMenuItem()),this.menuItems.push(this.createRestoreHierarchyMenuItem()))}},t.prototype.addShowValueAsMenuItem=function(t){if(_.isEmpty(this.property.hierarchyLevels)&&this.property.expr.getConceptualProperty(this.schema)){var i=this.schema.schema(t),r=i&&i.capabilities.supportsScopedEval;if(this.featureSwitchService.featureSwitches.quickCalc&&!c.hasGroupByItems(this.visual.query)&&r&&this.dataRole.kind!==e.VisualDataRoleKind.Grouping){var o=this.property.expr,n=this.showValueAsService.createShowValueAsMenuItems(o,this.schema,this.visual.visualType);_.isEmpty(n)||(this.menuItems.push(this.createSeparatorMenuItem()),this.menuItems.push(this.createShowValueAsMenuItem(n)))}}},t.prototype.addQuickCalcMenuItem=function(e){if(this.property.expr.getConceptualProperty(this.schema)){var t=this.schema.schema(e);(t&&t.capabilities.canEdit&&!t.isExtensionSchema||this.canAuthorReportMeasuresOnSchema(t))&&(this.menuItems.push(this.createSeparatorMenuItem()),this.menuItems.push(this.createQuickCalcMenuItem()))}},t.prototype.canAuthorReportMeasuresOnSchema=function(e){return e.capabilities.isExtendable||e.isExtensionSchema},t.prototype.addVariationsMenuItems=function(t){var i,r=a.fromColumn(t),o=r.getConceptualProperty(this.schema);if(o){var n=o.column;if(n&&!_.isEmpty(n.variations)){for(var s=a.entity(t.schema,t.entity),l=this.createVariationMenuItem(o.displayName,r),c=[],u=0,p=n.variations;u<p.length;u++){var d=p[u];if(d.navigationProperty&&d.navigationProperty.targetEntity){var h=d.navigationProperty.targetEntity;if(this.dataRole.kind!==e.VisualDataRoleKind.Measure)for(var v=_.filter(h.hierarchies,(function(e){return!e.hidden})),g=0,f=v;g<f.length;g++){var y=f[g],m=a.hierarchy(a.propertyVariationSource(s,d.name,o.name),y.name);c.push(this.createVariationMenuItem(y.name,m))}for(var S=a.entity(s.schema,h.name),w=_.filter(h.properties,(function(e){return!e.hidden})),C=0,b=w;C<b.length;C++){var x=b[C],F=a.columnRef(S,x.name);c.push(this.createVariationMenuItem(x.displayName,F))}}}_.isEmpty(c)||(this.menuItems.push(this.createSeparatorMenuItem()),this.menuItems.push(l),(i=this.menuItems).push.apply(i,c))}}},t.prototype.addGroupsMenuItems=function(e){var t,i=this.schema.schema(e.schema);if((i&&i.capabilities.canEdit&&i.capabilities.supportsGrouping)!==!1){var r=this.featureSwitchService.featureSwitches.enableGroupAuthoring,o=[],a=this.property.expr.getConceptualProperty(this.schema);r&&(!n.canExprBeGrouped(this.schema,this.property.expr)||this.property.hierarchyLevels&&this.property.hierarchyLevels.length>0||o.push(this.createGroupsMenuItem()),n.isGroupOrBinColumn(e.entity,a,this.groupingDesignStateService)&&o.push(this.createEditGroupsMenuItem())),n.isClusteringColumn(e.entity,a,this.groupingDesignStateService)&&o.push(this.createEditClusteringMenuItem()),o.length>0&&(this.menuItems.push(this.createSeparatorMenuItem()),(t=this.menuItems).push.apply(t,o))}},t.prototype.createShowValueAsMenuItem=function(t){var i=u(this.property);return i.key={action:4},i.text=e.common.localize.get("FieldWell_ShowValueAs"),i.children=t,i},t.prototype.createQuickCalcMenuItem=function(){var t=u(this.property);return t.key={action:6},t.text=e.common.localize.get("QuickCalc_NewMeasure"),t},t.prototype.createGroupsMenuItem=function(){var t=u(this.property);return t.key={action:8},t.text=e.common.localize.get("ContextMenuItem_CreateGroups"),t},t.prototype.createEditGroupsMenuItem=function(){var t=u(this.property);return t.text=e.common.localize.get("ContextMenuItem_EditGroups"),t.key={action:9},t},t.prototype.createEditClusteringMenuItem=function(){var t=u(this.property);return t.text=e.common.localize.get("Clustering_EditClusters"),t.key={action:10},t},t.prototype.createRestoreHierarchyMenuItem=function(){var t=u(this.property);return t.text=e.common.localize.get("FieldWell_RestoreHierarchy"),t.key={action:11},t},t.prototype.createVariationMenuItem=function(e,t){var i=u(this.property);return i.text=e,i.key={action:7,variationExpr:t},i},t.prototype.createShowAllMenuItem=function(){var t=u(this.property);return t.key={action:3},t.text=e.common.localize.get("FieldWell_ShowAll"),t},t.prototype.createDeleteMenuItem=function(){var t=u(this.property);return t.key={action:0},t.text=e.common.localize.get("FieldWell_Remove"),t},t.prototype.createSeparatorMenuItem=function(){var e=u(this.property);return e.type=1,e},t.prototype.createRenameMenuItem=function(){var t=u(this.property);return t.key={action:15},t.text=e.common.localize.get("ItemAction_Rename"),t},t.prototype.createMoveToBucketsMenuItem=function(){for(var e=[],t=0,i=this.buckets;t<i.length;t++){var r=i[t];if(!this.bucket.equals(r)){var o=u(this.property);o.text=r.displayName,o.key={action:18,moveFieldBucketOptions:{role:r.role,targetIndex:r.properties?r.properties.length:0,displayName:r.displayName}},e.push(o)}}return e},t.prototype.createMoveToGroupMenuItem=function(){var t=u(this.property);return t.key={action:19},t.text=e.common.localize.get("ItemAction_MoveTo"),t.children=this.createMoveToBucketsMenuItem(),t},t.prototype.createMoveUpMenuItem=function(){var t=u(this.property);t.text=e.common.localize.get("ItemAction_Move_Up");var i={action:16},r=this.findFieldPropertyIndexInBucket();if(r<=0)t.disabled=!0;else{var o=this.bucket.properties[r-1];i.moveFieldPropertyOptions={role:o.role,startIndex:o.startIndex,hierarchyLevelsLength:o.hierarchyLevels?o.hierarchyLevels.length:0}}return t.key=i,t},t.prototype.createMoveDownMenuItem=function(){var t=u(this.property);t.text=e.common.localize.get("ItemAction_Move_Down");var i={action:17},r=this.findFieldPropertyIndexInBucket();if(r>=this.bucket.properties.length-1)t.disabled=!0;else{var o=this.bucket.properties[r+1];i.moveFieldPropertyOptions={role:o.role,startIndex:o.startIndex,hierarchyLevelsLength:o.hierarchyLevels?o.hierarchyLevels.length:0}}return t.key=i,t},t.prototype.createMoveToTopMenuItem=function(){var t=u(this.property);t.text=e.common.localize.get("ItemAction_Move_Top");var i={action:16},r=this.bucket.properties[0];return this.property.equals(r)?t.disabled=!0:i.moveFieldPropertyOptions={role:r.role,startIndex:r.startIndex,hierarchyLevelsLength:r.hierarchyLevels?r.hierarchyLevels.length:0},t.key=i,t},t.prototype.createMoveToBottomMenuItem=function(){var t=u(this.property);t.text=e.common.localize.get("ItemAction_Move_Bottom");var i={action:17},r=this.bucket.properties[this.bucket.properties.length-1];return this.property.equals(r)?t.disabled=!0:i.moveFieldPropertyOptions={role:r.role,startIndex:r.startIndex,hierarchyLevelsLength:r.hierarchyLevels?r.hierarchyLevels.length:0},t.key=i,t},t.prototype.findFieldPropertyIndexInBucket=function(){var e=this;return _.findIndex(this.bucket.properties,(function(t){return e.property.equals(t)}))},t.prototype.createMoveGroupMenuItem=function(){var t=u(this.property);return t.key={action:19},t.text=e.common.localize.get("ItemAction_Move"),t.children=[this.createMoveUpMenuItem(),this.createMoveDownMenuItem(),this.createMoveToTopMenuItem(),this.createMoveToBottomMenuItem()],t},t})();i.createDropDownItems=p})(r=i.MenuItemFactory||(i.MenuItemFactory={}))})(i=t.viewModels||(t.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(e,t,i){for(var r=[],o=3;o<arguments.length;o++)r[o-3]=arguments[o];this.kind=e,this.name=i.format(t,r)}return e})();e.ShowValueAsCalculation=t;var i=(function(e){function t(t){return e.call(this,void 0,"ShowValueAs_Calculation_None",t)||this}return __extends(t,e),t})(t);e.ShowValueAsNoCalculation=i;var r=(function(e){function t(t){return e.call(this,0,"ShowValueAs_Calculation_PercentOfGrandTotal",t)||this}return __extends(t,e),t})(t);e.ShowValueAsPercentOfGrandTotalCalculation=r;var o=(function(e){function t(t,i,r){var o=e.call(this,1,"ShowValueAs_Calculation_PercentOfRoleTotal",t,r)||this;return o.roles=i,o}return __extends(t,e),t})(t);e.ShowValueAsPercentOfRoleTotalCalculation=o})(t=e.viewModels||(e.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i=e.common.models.ApplyStyle,r=jsCommon.ArrayExtensions,o=e.visuals.plugins,n=e.data.SQExpr,a=jsCommon.StringExtensions,s=e.explore.util.VisualContainerUtils,l=(function(){function e(){this.sections=[],this.activeSection=t.VisualizationPaneSectionType.Fields,this.previousSection=t.VisualizationPaneSectionType.Fields,this.pagePaneSections=[],this.activePageSection=t.PagePaneSectionType.Fields,this.previousPageSection=t.PagePaneSectionType.Fields,this.isPaneExpanded=!1}return Object.defineProperty(e.prototype,"activeSectionIndex",{get:function(){var e=this,t=_.findIndex(this.sections,(function(t){return t.sectionType===e.activeSection}));return t!==-1?t:0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"activePageSectionIndex",{get:function(){var e=this,t=_.findIndex(this.pagePaneSections,(function(t){return t.sectionType===e.activePageSection}));return t!==-1?t:0},enumerable:!0,configurable:!0}),e})();t.VisualizationPaneViewModel=l;var c;!(function(c){function u(){return{exploration:null,options:null,taskPane:h(),visualizationPane:v(),sectionStatus:{currentSectionNumber:-1,isEditing:!1},isNavPaneCollapsed:!0,bookmarksPane:d("ExplorationBookmarksPane_Title","ExplorationBookmarksPane_Close"),canvasItemsPane:d("ExplorationCanvasItemsPane_Title","ExplorationCanvasItemsPane_Close"),fieldPropertiesPane:d("ExplorationFieldPropertiesPane_Title"),syncGroupPane:d("SyncGroupPane_Title")}}function p(e){return{contract:e,selected:!1,displayName:e.displayName,menuItems:t.ExplorationContainerViewModelFactory.createNavigationMenuItems()}}function d(e,t){return{isPaneVisible:!1,isPaneExpanded:!0,title:e,closePaneLabel:t}}function h(){return{isPaneExpanded:!0}}function v(){return new l}function g(e){return{visuals:e}}function f(e){return S(_.filter(e,(function(e){return e.custom})))}function y(t,i){var r=e.common.localize;switch(t){case o.table.name:return{class:"table",title:r.get("Table_ToolTip")};case o.matrix.name:return{class:"matrix",title:r.get("Matrix_ToolTip")};case o.pivotTable.name:return{class:"matrix",title:r.get("Matrix_ToolTip")};case o.tableEx.name:return{class:"table",title:r.get("Table_ToolTip")};case o.scatterChart.name:return{class:"scatter",title:r.get("ScatterChart_ToolTip")};case o.barChart.name:return{class:"columnHoriz",title:r.get("BarChart_ToolTip")};case o.clusteredBarChart.name:return{class:"clusteredBarHoriz",title:r.get("ClusteredBarChart_ToolTip")};case o.hundredPercentStackedBarChart.name:return{class:"column100Horiz",title:r.get("HundredPercentStackedBarChart_ToolTip")};case o.ribbonChart.name:return{class:"ribbon",title:r.get("RibbonChart_ToolTip")};case o.columnChart.name:return{class:"columnVert",title:r.get("ColumnChart_ToolTip")};case o.clusteredColumnChart.name:return{class:"clusteredBarVert",title:r.get("ClusteredColumnChart_ToolTip")};case o.dataDotClusteredColumnComboChart.name:return{class:"dataDotClusteredColumnCombo",title:r.get("DataDotClusteredColumnComboChart_ToolTip")};case o.dataDotStackedColumnComboChart.name:return{class:"dataDotStackedColumnCombo",title:r.get("DataDotStackedColumnComboChart_ToolTip")};case o.hundredPercentStackedColumnChart.name:return{class:"column100Vert",title:r.get("HundredPercentStackedColumnChart_ToolTip")};case o.realTimeLineChart.name:case o.lineChart.name:return{class:"line",title:r.get("LineChart_ToolTip")};case o.areaChart.name:return{class:"area",title:r.get("AreaChart_ToolTip")};case o.stackedAreaChart.name:return{class:"stackedArea",title:r.get("StackedAreaChart_ToolTip")};case o.lineClusteredColumnComboChart.name:return{class:"lineClusteredColumnCombo",title:r.get("LineClusteredColumnComboChart_ToolTip")};case o.lineStackedColumnComboChart.name:return{class:"lineStackedColumnCombo",title:r.get("LineStackedColumnComboChart_ToolTip")};case o.pieChart.name:return{class:"pie",title:r.get("PieChart_ToolTip")};case o.treemap.name:return{class:"tree",title:r.get("Treemap_ToolTip")};case o.sunburst.name:return{class:"sunburst",title:r.get("Sunburst_ToolTip")};case o.map.name:return{class:"map",title:r.get("Map_ToolTip")};case o.filledMap.name:return{class:"filledMap",title:r.get("FilledMap_ToolTip")};case o.shapeMap.name:return{class:"shapeMap",title:r.get("ShapeMap_ToolTip")};case o.funnel.name:return{class:"funnel",title:r.get("Funnel_ToolTip")};case o.gauge.name:return{class:"gauge",title:r.get("Gauge_ToolTip")};case o.multiRowCard.name:return{class:"card",title:r.get("MultiRowCard_ToolTip")};case o.card.name:return{class:"calloutCard",title:r.get("Card_ToolTip")};case o.waterfallChart.name:return{class:"waterfall",title:r.get("WaterfallChart_ToolTip")};case o.slicer.name:return{class:"slicerVert",title:r.get("Slicer_ToolTip")};case o.donutChart.name:return{class:"donut",title:r.get("DonutChart_ToolTip")};case o.kpi.name:return{class:"kpi",title:r.get("kpi_Tooltip")};case o.scriptVisual.name:return{class:"rScriptImageVisual",title:r.get("ScriptVisual_ToolTip")};case o.pythonVisual.name:return{class:"pythonImageVisual",title:r.get("PythonVisual_ToolTip")};case o.realTimeLineChart.name:return{class:"line",title:r.get("LineChart_ToolTip")};case o.debugVisual.name:return{class:"debugger",title:r.get("DebugVisual_ToolTip")};case o.textbox.name:return{class:null,title:r.get("Textbox")};case o.basicShape.name:return{class:null,title:r.get("BasicShape_ToolTip")};case o.actionButton.name:return{class:null,title:r.get("Button")};case o.image.name:return{class:null,title:r.get("Image")};case o.keyDriversVisual.name:return{class:"keyDrivers",title:r.get("KeyDriver_Tooltip")};default:if(i&&i.isTrustedVisual(t)){var n=i.getVisualTypeOptions(t);if(n)return{class:n.class,title:n.titleKey?r.get(n.titleKey):t,watermarkKey:n.watermarkKey}}return}}function m(e,t){return y(e.name,t)||{class:e.class,title:e.name}}function S(t,i){for(var r=[],o=e.common.localize,n=0,a=t;n<a.length;n++){var s=a[n],l={plugin:s,enabled:!0,active:!1,menuItems:[]},c=m(s,i);if(l.class=c.class,l.title=c.title,c.watermarkKey&&(s.watermarkKey=c.watermarkKey),s.custom){l.title=s.displayName||s.name.match(/([A-z]+)/g)[0];var u=w(o.get("DeleteVisual_ContextMenu"),0);l.menuItems.push(u)}l.tooltipConfig={tooltipTitle:l.title,tooltipShowOnFocus:!0},r.push(l)}return r}function w(e,t){return{text:e,hasGlyph:!1,labelClass:"visualContextMenu itemLabel",action:t,type:DropDownMenuItemType.Item,checked:!1,hrefTarget:jsCommon.DOMConstants.selfValue}}function C(e,t,i){i.hostServices={getFilters:function(r,o){return r.calculateVisualContainerFilter(e,t,i.contract,o)},getVisualRelationshipFilterAction:function(e,r,o){return r.relationshipFilterAction(t,e,i.contract,o)},selectDataPoint:function(r,o,n,a){r.setFilterOnSelectData(e,o,t,i.contract,n,a)},setVisualRelationshipFilterAction:function(e,i,r,o){return o.setVisualRelationship(t,e,i,r)}}}function b(e,t,i){var r,o=_.map(e.sections,p),n=e.sections;if(n&&n.length>0){var a=void 0!==i?i:0;if(a<n.length){r=x(e,n[a],t);for(var s=n.length-1;s>=0;--s)o[s].selected=s===a}}return{contract:e,sections:o,exploreCanvas:r}}function x(e,i,o){var n=new t.ExploreCanvas(i,o);if(i.visualContainers&&(n.visualContainers=r.extendWithId(_(i.visualContainers).map((function(e){return F(e,o)})).filter((function(e){return!!e})).value()),!_.isEmpty(n.visualContainers)))for(var a=n.visualContainers,s=0,l=a;s<l.length;s++){var c=l[s];C(e,i,c)}return n}function F(e,r){void 0===r&&(r=0);var o=new i,n=e.layouts.withId(r);if(n){var a=n.position;return o.position({y:a.y,x:a.x}),o.zIndex(a.z||0),o.viewport({height:a.height,width:a.width}),new t.VisualContainer(e,o,r)}}function D(e,t,i,r){var o=F(i,r);if(o)return C(e,t,o),o}function V(t){return e.data.getDisplayName(t,e.common.localize)}function M(){return{schema:null,isLoaded:!1}}function P(e,t){return void 0===t&&(t=!0),{isVisualVisible:!1,reportFilters:t?[]:null,pageFilters:[],drillthroughFilters:[],visualFilters:[],activeFilterPane:void 0,addFilterLabel:e.get("FieldDropZone_Watermark"),addDrillthroughFilterLabel:e.get("FieldDropZone_Drillthrough_Watermark")}}function E(e,i,r,o,a,l,c,u,p,d){for(var h=i.filters||[],v=[],g={container:i,scopeType:0},f=s.getAutoVisualFilterContainers(i,l,c,r,u),y=s.getAutoCrossDrillVisualFilterContainers(e,i,c,r),m=function(e){return t.FilterViewModelFactory.convertFilterContainer(e,r,o,g,a,u,p,s.getVisualCapabilities(i,a),i.config.singleVisual)},S=function(e){var t=m(e);if(v.push(t),f){var i=_.findIndex(f,(function(t){return n.equals(t.expression,e.expression)}));i===-1?0===e.howCreated&&(t.howCreated=e.howCreated=1):(1===e.howCreated&&(t.howCreated=e.howCreated=0),f.splice(i,1))}},w=0,C=h;w<C.length;w++){S(C[w])}f=f||[],y=y||[];var b=y;if(d&&(b=b.concat(f)),b)for(var x=0,F=b;x<F.length;x++){var D=F[x],V=m(D);V.howCreated=D.howCreated,v.push(V)}return v.sort(I),v}function T(i,r,o,n,a,s,l,c){var u=[];if(!i||!i.container||!i.container.filters)return u;for(var p=0,d=i.container.filters;p<d.length;p++){var h=d[p];if(null==c||h.howCreated===c){h.name||(h.name=e.explore.FilterUtils.getNextFilterName(i.container.filters));var v=t.FilterViewModelFactory.convertFilterContainer(h,r,o,i,n,a,s,l,null);u.push(v)}}return u.sort(I),u}function A(e){return _.map(e,(function(e){return a.replaceAll(e,k,L)})).join(k)}function I(e,t){var i=e.displayName?-1:1,r=t.displayName?-1:1;if(i!==r)return i-r;var o=e.displayName||e.getRestatement()||"",n=t.displayName||t.getRestatement()||"";return o.localeCompare(n)}var k="-",L="\\"+k;c.createExplorationContainer=u,c.convertSectionToViewModel=p,c.createExplorePane=d,c.createTaskPane=h,c.createVisualizationPane=v,c.createVisualTypesContainer=g,c.getCustomVisualTypes=f,c.getVisualTypeInfoByName=y,c.getVisualTypeInfo=m,c.getAvailableVisualTypes=S,c.convertExploration=b,c.convertSectionToExploreCanvas=x,c.convertVisualContainerStandalone=F,c.convertVisualContainer=D,c.getDisplayName=V,c.createFieldList=M,c.createFilterPane=P,c.createVisualFilters=E,c.createFilters=T,c.createUniqueId=A})(c=t.ViewModelFactory||(t.ViewModelFactory={}))})(i=t.viewModels||(t.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i=(function(){function t(e){e&&(this.color=e.color.solid.color,this.visible=e.show)}return Object.defineProperty(t.prototype,"thickness",{get:function(){return t.Width},enumerable:!0,configurable:!0}),t.prototype.getBorderStyle=function(){if(this.visible)return t.Width+"px "+t.Style+" "+e.common.utils.ColorUtility.hexToRGBString(this.color)},t})();t.VisualBorder=i,(function(e){function t(){return{color:{solid:{color:e.DefaultColor}},show:e.DefaultShow}}e.Width=1,e.Style="solid",e.DefaultColor="#000",e.DefaultShow=!1,e.getDefaultValues=t})(i=t.VisualBorder||(t.VisualBorder={}))})(i=t.viewModels||(t.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){function r(e){switch(e.keyCode){case 122:return e.altKey&&e.shiftKey?0:void 0}}var o=jsCommon.Color,n=jsCommon.CssConstants,a=e.data.DataViewObjectDescriptors,s=t.util.DetailVisualUtils,l=e.a11y.util.FocusUtility,c=jsCommon.KeyUtils,u=e.explore.util.VisualContainerUtils,p=t.contracts.VisualTitle,d={visualInformationButton:"showVisualInformationButton",visualWarningButton:"showVisualWarningButton",visualErrorButton:"showVisualErrorButton",drillRoleSelector:"showDrillRoleSelector",drillUpButton:"showDrillUpButton",drillToggleButton:"showDrillToggleButton",drillDownLevelButton:"showDrillDownLevelButton",drillDownExpandButton:"showDrillDownExpandButton",pinButton:"showPinButton",filterRestatementButton:"showFilterRestatementButton",focusModeButton:"showFocusModeButton",seeDataLayoutToggleButton:"showSeeDataLayoutToggleButton",optionsMenu:"showOptionsMenu"},h=(function(h){function v(e,t,i){var r=h.call(this,e,{style:t,titleStyle:null,footerStyle:null,headerItemContainerStyle:null,headerBackgroundStyle:null,headerForegroundStyle:null,visualViewportStyle:null,popOutBarTitle:"",popOutBarSubtitle:""})||this;return r.uiScale={x:1,y:1},r.toolbarViewModel={visible:!1,$element:null,update:_.noop},r.currentCanvasLayout=i,r.currentEditMode=0,r}return __extends(v,h),v.prototype.getRunningVisual=function(){return this.runningVisual},v.prototype.setThemeCollection=function(e){this.themeCollection=e,this.runningVisual&&this.runningVisual.setThemeCollection(e),this.runningDetailVisual&&this.runningDetailVisual.setThemeCollection(e)},v.prototype.getVisualType=function(){return u.getVisualType(this.contract)},v.getVisualBodyOffset=function(e,t){return v.useStylableHeader(t)||e.canShowVisualContainerHeaderInset()?{top:0,height:0,width:0,left:0}:{top:this.VisualContainerHeaderHeight,height:-this.VisualContainerHeaderHeight,width:0,left:0}},Object.defineProperty(v.prototype,"id",{get:function(){return this.contract.id},enumerable:!0,configurable:!0}),Object.defineProperty(v.prototype,"position",{get:function(){var e=this.currentCanvasLayout;return this.contract.layouts.withId(e).position},set:function(e){var t=this.currentCanvasLayout;this.contract.layouts.withId(t).position=e},enumerable:!0,configurable:!0}),v.prototype.getScaledPosition=function(){return this.convertToScaledPosition(this.position)},Object.defineProperty(v.prototype,"editMode",{get:function(){return this.currentEditMode},enumerable:!0,configurable:!0}),v.prototype.setEditMode=function(t){this.currentEditMode=t,this.updateVisual(this.runningVisual,this.runningVisual.getViewport(),e.VisualUpdateType.ViewMode)},Object.defineProperty(v.prototype,"isPositioned",{get:function(){var e=this.position;return 0!==e.width&&0!==e.height},enumerable:!0,configurable:!0}),Object.defineProperty(v.prototype,"isPoppedOut",{get:function(){var e=this.contract.visibility;return null!=e&&0!==e&&4!==e},enumerable:!0,configurable:!0}),Object.defineProperty(v.prototype,"isHidden",{get:function(){return t.contracts.VisualContainer.isHidden(this.contract.config.singleVisual)},enumerable:!0,configurable:!0}),v.prototype.visualTitleVisible=function(){var e=this.contract.config.singleVisual,t=this.objects&&this.objects.title,i=t&&t.text,r=this.visualPlugin&&this.visualPlugin.capabilities(e.visualType);return!p.isHidden(t)&&r&&(!r.suppressDefaultTitle||r.suppressDefaultTitle&&i)&&""!==i&&!this.isPoppedOut},v.prototype.supportsKeyboardNavigation=function(){var e=this.contract.config.singleVisual,t=this.visualPlugin&&this.visualPlugin.capabilities(e.visualType);return t&&t.supportsKeyboardFocus},v.prototype.setServices=function(e,t,i,r,o,n,a,s,l){this.visualHostServices=e,this.visualAdapterHostServices=l,this.visualPlugin=t,this.visualPluginOps=i,this.viewModeState=r,this.formFactor=o,this.visibility=n,this.runningVisuals=a,this.explorationCapabilities=s},v.prototype.setSelected=function(e){this.isSelected=e},v.prototype.handleKeyDown=function(e){switch(r(e)){case 0:this.visibility.set(this.contract,8)}if(this.isTextboxVisual()&&this.shouldHandleKeydown(e)){return this.getTextboxVisual().focus()}},v.prototype.shouldHandleKeydown=function(e){if(0===this.viewModeState.getMode())return!1;var t=e.keyCode;if(c.isArrowKey(t)||c.isNudgeModifierKey(t))return!1;if(27===t||9===t||18===t)return!1;var i=this.toolbarViewModel&&this.toolbarViewModel.$element;return!i||!l.isFocusInTree(i)},v.prototype.setVisualTitle=function(e){this.visualTitle=e;var t="",i="";e&&(e.titleComponents&&e.titleComponents.title?t=e.titleComponents.title:e.text&&(t=e.text),e.titleComponents&&e.titleComponents.subtitle&&(i=e.titleComponents.subtitle)),this.readOnlyState.popOutBarTitle=t,this.readOnlyState.popOutBarSubtitle=i},v.prototype.setTooltip=function(){var e=u.getVisualType(this.contract),t=this.visualPlugin&&this.visualPlugin.getPlugin(e);if(t){e=i.ViewModelFactory.getVisualTypeInfo(t).title}var r=this.visualTitle,o=r&&r.text||"",n=this.objects&&this.objects.general&&this.objects.general.altText||"";this.tooltip=o+" "+e+" "+n},v.prototype.updateVisualViewportForUserResize=function(t){var i=this.runningVisual;this.enableVisualScaling?(t.width/=this.uiScale.x,this.visualBorder&&(t.width-=2*this.visualBorder.thickness),this.useStylableHeader()||(t.height-=v.VisualContainerHeaderHeight),t.height/=this.uiScale.y,this.visualBorder&&(t.height-=2*this.visualBorder.thickness)):this.useStylableHeader()||(t.height-=v.VisualContainerHeaderHeight),this.isFooterVisible&&this.isFooterVisible()&&(t.height-=v.VisualContainerFooterHeight);var r=this.getVisualViewport(t.width,t.height,1);i&&this.updateVisual(i,r,e.VisualUpdateType.Resize,1),this.hasDetailVisual()&&this.updateVisual(this.runningDetailVisual,r,e.VisualUpdateType.Resize,1),this.applyVisualBodyStyle(this.readOnlyState,t),this.applyFooterStyle(this.readOnlyState,t.width)},v.prototype.shouldUseCache=function(){return u.shouldUseQueryCache(this.contract,this.options.disableQueryCacheUpdates)},v.prototype.adjustForVisualContainerHeader=function(e,t){this.formFactor&&this.formFactor.getCurrentLayoutCapabilities().canShowVisualContainerHeaderInset()||(e.y+=t,e.height-=t)},v.prototype.convertToScaledPosition=function(e){var i=t.util.CanvasVisualsUtility.convertToScaledPosition(e,this.uiScale,!0);return this.adjustForVisualContainerHeader(i,this.useStylableHeader()?0:-v.VisualContainerHeaderHeight),i},v.prototype.reset=function(){var t=this.visual;t&&(t.data=void 0,t.dataTransforms=void 0,t.hostServices=e.visuals.defaultVisualHostServices,t.visualAdapterHostServices={getNextDataSegment:function(){return new e.Promise(function(e,t){return t(new Error("Visual reset"))})},startProgressBar:_.noop,stopProgressBar:_.noop},this.visualHostServices=void 0,this.visualAdapterHostServices=void 0),this.runningVisuals&&this.runningVisuals.removeVisual(this.contract),this.runningVisual=void 0},v.prototype.updateViewStateCore=function(t){var r=this.viewModeState&&this.viewModeState.getConfig(),o=r&&r.displayOptions,n=this.contract,l=this.position,c=this.overridePosition||this.convertToScaledPosition(l),u=e.Prototype.inherit(c),p=!this.useStylableHeader()||this.isPoppedOut;if(this.enableVisualScaling?this.overridePosition?(p&&(u.height-=v.VisualContainerHeaderHeight),u.height/=this.uiScale.y,u.width/=this.uiScale.x):(u=e.Prototype.inherit(l),this.formFactor&&this.formFactor.getCurrentLayoutCapabilities().canShowVisualContainerHeaderInset()&&p&&(u.height-=v.VisualContainerHeaderHeight/this.uiScale.y)):p&&(u.height-=v.VisualContainerHeaderHeight),this.visualBorder&&(u.width-=2*this.visualBorder.thickness,u.height-=2*this.visualBorder.thickness),this.isFooterVisible&&this.isFooterVisible()&&(u.height-=v.VisualContainerFooterHeight),this.isPoppedOut&&(!o||!o.hideInFocusBar)){var d=i.VisualContainer.PopOutBarHeight;this.enableVisualScaling&&(d/=this.uiScale.y),u.height-=d}var h=this.getVisualViewport(u.width,u.height,this.uiScale.x),g=n.config.singleVisual;if(t.isFilterVisual=!1,g){this.showWatermark=!1,this.canPin=!0;var f=g.visualType,y=this.visualPlugin&&this.visualPlugin.capabilities(f);if(y&&(t.isFilterVisual=null!=a.findFilterOutput(y.objects)),this.visual&&this.visualPluginOps&&(this.visual.visualRequiresData=this.visualPluginOps.isQueryVisual(f)),g.query){var m=g.query.defn;if(m){var S=m.orderBy();t.actualSortDirection=S&&S.length?S[0].direction:void 0}}else this.visualPluginOps&&this.visualPluginOps.isQueryVisual(f)&&"debugVisual"!==f&&(this.canPin=!1,this.viewModeState&&1===this.viewModeState.getMode()?this.showWatermark=!y||!y.supportsLandingPage:this.showWatermark=!0);if(this.visual){var w=this.visual;w.type!==g.visualType&&(w.data=null),w.type=f,w.stylePresetName=this.objects&&this.objects.stylePreset&&this.objects.stylePreset.name,w.hostServices=this.visualHostServices,w.visualAdapterHostServices=this.visualAdapterHostServices}else this.visualHostServices&&(this.visual={viewport:h,type:f,dataTransforms:{objects:g.objects},hostServices:this.visualHostServices,visualAdapterHostServices:this.visualAdapterHostServices,interactivityOptions:{dragDataPoint:!1,selection:!0,isVisualInteractive:!0},allowInvalidDataView:!0,visualPlugin:this.visualPlugin,themeCollection:this.themeCollection});!this.runningVisual&&this.visual&&(this.runningVisual=this.wrapRunningVisual(this.visual),this.runningVisuals.setVisual(this.contract,this.runningVisual)),this.hasDetailVisual()?t.detailVisual||(t.detailVisual={parentContract:this.contract,visual:{viewport:s.getDetailVisualViewport(h,this.contract.detailVisualLayout),themeCollection:this.themeCollection,allowInvalidDataView:!0,hostServices:null},hasData:!1},this.runningDetailVisual||(this.runningDetailVisual=this.wrapRunningVisual(t.detailVisual.visual))):(t.detailVisual=null,this.runningDetailVisual=void 0),this.setViewport(t,h)}t.style.position({x:c.x,y:c.y}),t.style.viewport({width:c.width,height:c.height}),null==this.zIndexOverride?t.style.zIndex(l.z||0):t.style.zIndex(this.zIndexOverride),t.style.rotate(l.angle||0),t.style.apply(),this.applyTitleStyle(t,c.width),this.applyVisualBodyStyle(t,u),this.applyFooterStyle(t,u.width),this.applyHeaderStyle(t),this.setHeaderItemVisibility(t),this.setTooltip();var C=n.toolbar;this.toolbarViewModel.$element=C?C.element:void 0,C&&C.theme&&(this.toolbarViewModel.theme=C.theme),this.toolbarViewModel.update()},v.prototype.isHeaderItemVisible=function(e){return!this.readOnlyState.itemVisibility||this.readOnlyState.itemVisibility[e]},v.prototype.isDeprecationWarningVisible=function(){return 1===this.viewModeState.getMode()&&void 0!==this.customVisualDeprecatedWarningInfo},v.prototype.isWarningVisible=function(){return this.isHeaderItemVisible("visualWarningButton")&&void 0!==this.warningInfo},v.prototype.isErrorVisible=function(){return this.isHeaderItemVisible("visualErrorButton")&&void 0!==this.transformWarningInfo},v.prototype.isInfoVisible=function(){return this.isHeaderItemVisible("visualInformationButton")&&void 0!==this.visualInfo},v.prototype.isAnyIconVisible=function(){return this.isDeprecationWarningVisible()||this.isWarningVisible()||this.isErrorVisible()||this.isInfoVisible()},v.prototype.anyHeaderItemVisible=function(e){if(e)for(var t=0,i=e;t<i.length;t++){var r=i[t];if(this.isHeaderItemVisible(r))return!0}return!1},v.prototype.isTextboxVisual=function(){return this.contract.config.singleVisual.visualType===e.visuals.plugins.textbox.name},v.prototype.getTextboxVisual=function(){var e=this.runningVisual&&this.runningVisual.getAdapter();return e?e.unwrap?e.unwrap():e:void 0},v.prototype.isAnalysisVisual=function(){var e=this.contract.config.singleVisual.visualType;return this.visualPluginOps.isAnalysisVisual(e)},v.prototype.setHeaderItemVisibility=function(e){var t=e.itemVisibility;t||(t=e.itemVisibility={});var i=this.viewModeState&&0===this.viewModeState.getMode()&&this.useStylableHeader(),r=i?this.objects&&this.objects.visualHeader:void 0;for(var o in d)t[o]=(r&&r[d[o]])!==!1},v.prototype.applyHeaderStyle=function(e){var t=this.useStylableHeader()?this.objects&&this.objects.visualHeader:void 0;this.applyItemContainerStyle(e,t),this.applyHeaderBackgroundStyle(e,t),this.applyHeaderForegroundStyle(e,t)},v.prototype.applyItemContainerStyle=function(t,i){var r={"background-color":"","border-color":""};if(this.useStylableHeader()&&i&&(i.background||null!=i.transparency||null!=i.border)){var n=i.background&&i.background.solid?o.parseColorString(i.background.solid.color):{R:255,G:255,B:255},a=i.border&&i.border.solid?o.parseColorString(i.border.solid.color):n;null!=i.transparency?a.A=n.A=1-i.transparency/100:(null==n.A&&(n.A=1),null==a.A&&(a.A=1)),r["background-color"]=o.rgbString(n),
r["border-color"]=o.rgbString(a)}t.headerItemContainerStyle||(t.headerItemContainerStyle=new e.common.models.ApplyStyle),t.headerItemContainerStyle.addAttributes(r),t.headerItemContainerStyle.apply()},v.prototype.applyHeaderBackgroundStyle=function(t,i){var r={"background-color":""};if(this.useStylableHeader()&&i&&(i.background||null!=i.transparency)){var n=i.background&&i.background.solid?o.parseColorString(i.background.solid.color):{R:255,G:255,B:255};null!=i.transparency?n.A=1-i.transparency/100:null==n.A&&(n.A=1),r["background-color"]=o.rgbString(n)}t.headerBackgroundStyle||(t.headerBackgroundStyle=new e.common.models.ApplyStyle),t.headerBackgroundStyle.addAttributes(r),t.headerBackgroundStyle.apply()},v.prototype.applyHeaderForegroundStyle=function(t,i){var r={color:""};this.useStylableHeader()&&i&&i.foreground&&i.foreground.solid&&(r.color=i.foreground.solid.color),t.headerForegroundStyle||(t.headerForegroundStyle=new e.common.models.ApplyStyle),t.headerForegroundStyle.addAttributes(r),t.headerForegroundStyle.apply()},v.prototype.applyVisualBodyStyle=function(t,i){t.visualViewportStyle||(t.visualViewportStyle=new e.common.models.ApplyStyle);var r=u.getVisualStyleAttributes(i,this.enableVisualScaling?this.uiScale.x:void 0,this.visualBackground&&this.visualBackground.colorRGB,this.visualBorder&&this.visualBorder.getBorderStyle());t.visualViewportStyle.addAttributes(r),t.visualViewportStyle.apply()},v.prototype.applyFooterStyle=function(t,i){if(this.isFooterVisible&&this.isFooterVisible()){var r={};t.footerStyle||(t.footerStyle=new e.common.models.ApplyStyle);var o=this.enableVisualScaling?this.uiScale.x:1;r.transform="scale("+o+")",r.width=i+"px",t.footerStyle.addAttributes(r),t.footerStyle.apply()}},v.prototype.applyTitleStyle=function(t,i){var r={};if(this.visualTitleVisible()){r[n.visibilityProperty]=n.visibleValue;var o=this.objects&&this.objects.title||{};r[n.textAlignProperty]=o.alignment?o.alignment:"",r[n.backgroundColorProperty]=o.background&&o.background.solid&&o.background.solid.color||"",r[n.colorProperty]=o.fontColor&&o.fontColor.solid&&o.fontColor.solid.color||"";var a=u.getTitleFontSize(o);if(r[n.fontSizeProperty]=a,r[n.fontFamilyProperty]=o.fontFamily||"",r[n.heightProperty]=u.getTitleHeight(o),this.titleWidthReduction){var s=(i-this.titleWidthReduction)/this.uiScale.x;r[n.widthProperty]=s+"px"}else r[n.widthProperty]=""}else r[n.visibilityProperty]=n.hiddenValue;t.titleStyle||(t.titleStyle=new e.common.models.ApplyStyle),t.titleStyle.addAttributes(r),t.titleStyle.apply()},v.prototype.setViewport=function(e,t){this.runningVisual&&this.setVisualViewport(this.runningVisual,t),this.runningDetailVisual&&this.setVisualViewport(this.runningDetailVisual,s.getDetailVisualViewport(t,this.contract.detailVisualLayout))},v.prototype.setVisualViewport=function(e,t){if(e&&t){var i=e.getViewport();i.height===t.height&&i.width===t.width&&i.scale===this.uiScale.x||e.setViewport(__assign({},t,{scale:this.enableVisualScaling?this.uiScale.x:1}))}},v.prototype.getVisualViewport=function(e,t,r){var o=this.isPaddingDisabled?0:i.VisualContainer.VisualContainerPaddingRight+i.VisualContainer.VisualContainerPaddingLeft,n=this.isPaddingDisabled?0:i.VisualContainer.VisualContainerPaddingTop+i.VisualContainer.VisualContainerPaddingBottom,a=0;this.visualTitleVisible()&&(a=u.getTitleHeight(this.objects&&this.objects.title));var s=e-o,l=t-n-a,c=this.viewModeState&&this.viewModeState.getConfig().displayOptions.showDetailVisualOnFullScreen;if(this.hasDetailVisual()&&!c){1===(this.contract.detailVisualLayout||1)?(l-=n,l/=2):(s-=o,s/=2)}return{width:Math.max(s,0),height:Math.max(l,0),scale:r}},v.prototype.updateVisual=function(e,t,i,r){if(e&&t){var o=e.getAdapter();o&&o.update({viewport:t,suppressAnimations:!0,dataViews:e.getDataViews(),type:i,resizeMode:r,viewMode:this.visualHostServices.getViewMode(),editMode:this.editMode})}},v.prototype.hasDetailVisual=function(){return 2===this.contract.visibility||8===this.contract.visibility},v.prototype.useStylableHeader=function(){return v.useStylableHeader(this.explorationCapabilities)},v.useStylableHeader=function(e){return e&&e.getCapabilities().visualContainerOptions.useStylableHeader},v.prototype.wrapRunningVisual=function(t){var i=this,r={getType:function(){return t.type},setType:function(e){return t.type=e},getViewport:function(){return t.viewport},setViewport:function(o,n){t.viewport=o,n&&i.updateVisual(r,o,e.VisualUpdateType.Resize)},getData:function(){return t.data},getAdapter:function(){return t.visual},getDataViews:function(){return t.dataViews},setDataViews:function(e){return t.dataViews=e},getDataTransforms:function(){return t.dataTransforms},setThemeCollection:function(e){return t.themeCollection=e},getIsInFocus:function(){return t.isInFocus},setIsInFocus:function(e){return t.isInFocus=e},setData:function(e,i){t.data=e,t.dataAppliedEvent&&(t.dataAppliedEvent.reject(),t.dataAppliedEvent=void 0),t.dataAppliedEvent=i},setDataTransforms:function(e){return t.dataTransforms=e},setPendingSelection:function(e){return t.pendingSelection=e},hasPendingSelection:function(){return!!t.pendingSelection},setAdditionalObjectUpdates:function(e){return t.additionalObjectUpdates=e}};return r},v.VisualContainerHeaderHeight=20,v.VisualContainerFooterHeight=34,v.VisualContainerPaddingTop=5,v.VisualContainerPaddingRight=5,v.VisualContainerPaddingBottom=5,v.VisualContainerPaddingLeft=5,v.PopOutBarHeight=40,v.HeaderInTitleScaleThreshold=.9,v})(i.ViewModel);i.VisualContainer=h})(i=t.viewModels||(t.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){e[e.Fields=0]="Fields",e[e.Format=1]="Format",e[e.Analytics=2]="Analytics"})(t=e.VisualizationPaneSectionType||(e.VisualizationPaneSectionType={}));var i;!(function(e){e[e.Fields=0]="Fields",e[e.Format=1]="Format"})(i=e.PagePaneSectionType||(e.PagePaneSectionType={}))})(t=e.viewModels||(e.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){function r(e,t,i,r,o,n,a,s,l,u,p,d,h,v,g,f,y,m,S,w,C,b,x,F,D,V){return new c(i,o,n,e,t,a,s,l,u,p,d,h,r,v,g,f,y,m,S,w,C,b,x,F,D,V)}function o(e,t){return!!e&&!!t&&t.container===e&&0===t.scopeType}var n=e.data.DataViewObjectDefinitions,a=e.data.SemanticFilter,s=e.data.SQExpr,l=e.visuals.plugins.textbox;i.createVisualAuthoring=r;var c=(function(){function r(e,i,r,o,n,a,s,l,c,u,p,d,h,v,g,f,y,m,S,w,C,b,x,F,D,V){this.schemaProxy=e,this.telemetry=i,this.explorationNavigationService=r,this.visualPluginService=o,this.visualPluginOps=n,this.selectionService=a,this.geotaggingAnalyzerService=s,this.explorationSerializer=l,this.eventBridge=c,this.promiseFactory=u,this.undoRedoService=p,this.featureSwitchService=d,this.displayNameService=h,this.sortService=v,this.visualRelationshipService=g,this.drill=f,this.expandCollapse=y,this.filterGenerator=m,this.aggrOps=S,this.hostTooltip=w,this.resourceRegistration=C,this.formFactorProvider=b,this.localizationService=x,this.scopedLazySync=F,this.viewModeState=D,this.dataSource=V,this.visualAuthoringOperations=t.util.createVisualAuthoringOperations(this.visualPluginService,this.visualPluginOps,this.displayNameService,this.telemetry,this.explorationNavigationService,this.selectionService,this.geotaggingAnalyzerService,this.explorationSerializer,this.eventBridge,this.featureSwitchService,this.sortService,this.visualRelationshipService,this.drill,this.expandCollapse,this.filterGenerator,this.aggrOps,this.resourceRegistration,this.formFactorProvider,this.localizationService,this.viewModeState)}return r.prototype.addFieldToVisual=function(e,t,i,r){var o=this;return this.registerUndoableAction(t,(function(t){return o.visualAuthoringOperations.addFieldToVisual(t,e,i,r)}),"AddFieldToVisual")},r.prototype.addFieldInRole=function(e,t,i,r,o){var n=this;return this.registerUndoableAction(i,(function(i){return n.visualAuthoringOperations.addFieldInRole(i,e,t,r,o)}),"AddFieldInRole")},r.prototype.expandHierarchy=function(e,t,i,r,o){var n=this;return this.registerUndoableAction(e,(function(e){return n.visualAuthoringOperations.expandHierarchy(e,t,i,r,o)}),"ExpandHierarchy")},r.prototype.removeField=function(e,t){var i=this;return this.registerUndoableAction(e,(function(e){return i.visualAuthoringOperations.removeField(t,e)}),"RemoveField")},r.prototype.removeProjection=function(e,t){var i=this;return this.undoRedoService.register("RemoveProjection",(function(){return i.visualAuthoringOperations.removeProjection(e,t)}))},r.prototype.removeInvalidExpressions=function(e,t){var i=this;return this.registerUndoableAction(t,(function(t){return i.visualAuthoringOperations.removeInvalidExpressions(t,e)}),"RemoveInvalidExpressions")},r.prototype.moveProjection=function(e,t,i,r,o,n){var a=this;return this.registerUndoableAction(n,(function(n){return a.visualAuthoringOperations.moveProjection(n,e,t,i,r,o)}),"MoveProjection")},r.prototype.drillDownLevel=function(e,t,i){var r=this;this.undoRedoService.register("DrillDownLevel",(function(){return r.visualAuthoringOperations.drillDownLevel(e,t,i)}))},r.prototype.replaceProjection=function(e,i,r,o,n){var a=this;return this.schemaProxy.get(n).then((function(n){return a.undoRedoService.register("ReplaceProjection",(function(){for(var s=function(o){var s=a.visualAuthoringOperations.replaceProjection(n,e,i,r,o),l=a.filterGenerator.supportsFilterOutput(o);return s&&l&&t.util.VisualContainerUtils.notifyVisualContainersExceptSource(a.eventBridge,o),s},l=s(o),c=a.scopedLazySync("visualSync"),u=0,p=c.getVisualsAffectByFieldChanges(o);u<p.length;u++){s(p[u])}return l}))}))},r.prototype.drillDown=function(e,t,i,r){var o=this;return this.registerUndoableAction(i,(function(i){return o.visualAuthoringOperations.drillDown(i,e,t,r)}),"DrillDown")},r.prototype.drillUp=function(e,t){var i=this;this.undoRedoService.register("DrillUp",(function(){return i.visualAuthoringOperations.drillUp(e,t)}))},r.prototype.toggleDrillFilterOtherVisualsSetting=function(){var e=this,t=i.selectionUtils.getSelectedVisual(this.selectionService);if(t){var r=!t.drillFilterOtherVisuals;this.undoRedoService.register("SetDrillFilterOtherVisualsSetting",(function(){return e.visualAuthoringOperations.setDrillFilterOtherVisualsSetting(r)}))}},r.prototype.setDrillFilterOtherVisualsSetting=function(e){var t=this;this.undoRedoService.register("SetDrillFilterOtherVisualsSetting",(function(){return t.visualAuthoringOperations.setDrillFilterOtherVisualsSetting(e)}))},r.prototype.setAggregate=function(e,t,i,r,o){var n=this;return this.registerUndoableAction(o,(function(o){return n.visualAuthoringOperations.setAggregate(o,e,t,i,r)}),"SetAggregate")},r.prototype.removeAggregate=function(e,t,i,r){var o=this;return this.registerUndoableAction(r,(function(r){return o.visualAuthoringOperations.removeAggregate(r,e,t,i)}),"RemoveAggregate")},r.prototype.setPercentOfGrandTotal=function(e,t,i,r){var o=this;return this.getSchemaAndExecuteAction(r,(function(r){return o.visualAuthoringOperations.setPercentOfGrandTotal(r,e,t,i)}))},r.prototype.removePercentOfGrandTotal=function(e,t,i,r){var o=this;return this.getSchemaAndExecuteAction(r,(function(r){return o.visualAuthoringOperations.removePercentOfGrandTotal(r,e,t,i)}))},r.prototype.setPercentOfRoleTotal=function(e,t,i,r,o){var n=this;return this.getSchemaAndExecuteAction(o,(function(o){return n.visualAuthoringOperations.setPercentOfRoleTotal(o,e,t,i,r)}))},r.prototype.removePercentOfRoleTotal=function(e,t,i,r){var o=this;return this.getSchemaAndExecuteAction(r,(function(r){return o.visualAuthoringOperations.removePercentOfRoleTotal(r,e,t,i)}))},r.prototype.toggleShowAll=function(e,t){this.visualAuthoringOperations.toggleShowAll(e,t)},r.prototype.setVariation=function(e,t,i,r,o,n){var a=this;return this.registerUndoableAction(e,(function(e){return a.visualAuthoringOperations.setVariation(e,t,i,r,o,n)}),"SetVariation")},r.prototype.createVisualContainerConfig=function(e){var t=this;return this.schemaProxy.get(e.dataSources).then((function(i){return t.visualAuthoringOperations.createVisualContainerConfig(i,e)}))},r.prototype.addVisualContainerImage=function(e,t,i,r,o,n){var a=this;this.undoRedoService.register("AddVisualContainerImage",(function(){return a.visualAuthoringOperations.addVisualContainerImageFromData({exploreCanvas:e,position:n},t,o)}))},r.prototype.addVisualContainerDrillthroughBackButton=function(i){this.visualAuthoringOperations.addVisualContainerShapeVisual({exploreCanvas:i,position:{x:0,y:0,width:100,height:40},visualLink:{properties:{type:e.data.SQExprBuilder.text(t.contracts.VisualLink.Back),show:e.data.SQExprBuilder.boolean(!0)}},select:!1},e.visuals.basicShapeType.arrowButton,0)},r.prototype.addVisualContainerShapeVisual=function(e,t,i){var r=this;this.undoRedoService.register("AddVisualContainerBasicShape",(function(){var o;return 1===i&&(o={x:0,y:0,width:100,height:40}),r.visualAuthoringOperations.addVisualContainerShapeVisual({exploreCanvas:e,position:o},t,i)}))},r.prototype.addVisualContainerTextbox=function(e,t){return this.addEmptyVisualContainer(e,l.name,t)},r.prototype.addVisualContainer=function(e,t,i){var r=this;return this.schemaProxy.get(e.dataSources).then((function(o){return r.undoRedoService.register("AddVisualContainer",(function(){return r.visualAuthoringOperations.addVisualContainer(o,e,t,i)}))}))},r.prototype.addVisualContainerFromConfig=function(e,t,i){var r=this;return this.undoRedoService.register("AddVisualContainerFromConfig",(function(){return r.visualAuthoringOperations.addVisualContainerFromConfig(e,t,i)}))},r.prototype.addEmptyVisualContainer=function(e,t,i){var r=this;return this.undoRedoService.register("AddEmptyVisualContainer",(function(){return r.visualAuthoringOperations.addEmptyVisualContainer(e,t,i)}))},r.prototype.copyVisual=function(e,t,i){var r=this.explorationSerializer.deserializeVisualContainer(e);r.id=100;var o=this.formFactorProvider.getCurrentLayout(),n=r.layouts.withId(o),a=n.position;return n.position={height:a.height,width:a.width,x:Math.max(0,t?t-a.width/2:0),y:Math.max(0,i?i-a.height/2:0),z:a.z},r},r.prototype.addConfigToCategoricalFilters=function(e,t,i){var r=_.filter(e,(function(e){return!e.isInvalid()&&e.canVisualize()}));if(r)for(var o=0,n=r;o<n.length;o++){var a=n[o];this.createFilterVisualContainerConfig(a.contract,i,t)}},r.prototype.createVisualFilters=function(e,t,i,r,o){return this.visualAuthoringOperations.createVisualFilters(e,t,i,r,o)},r.prototype.addFilter=function(e,t,i){var r=this;return this.registerUndoableAction(i,(function(o){return r.visualAuthoringOperations.addFilter(o,e,t,i,!1)}),"AddFilter")},r.prototype.addDrillthroughFilter=function(e,t,i){var r=this;return this.registerUndoableAction(i,(function(o){return r.visualAuthoringOperations.addFilter(o,e,t,i,!0)}),"AddDrillthroughFilter")},r.prototype.removeFilter=function(i,r){var n=this;return this.undoRedoService.register("RemoveFilter",(function(){var a=2===i.howCreated,s=n.visualAuthoringOperations.removeFilter(i,r);return s&&a&&o(r.container,r)&&n.updateCrossDrillFromVisualContainer(r.container),n.telemetry.logEvent(e.telemetry.EXRemoveFilter,t.util.getTelemetryFilterType(i.type),t.util.getTelemetryFilterScopeType(r.scopeType),i.expression&&t.util.getTelemetryFieldKind(i.expression),t.util.getTelemetryViewMode(n.viewModeState.getMode())),s}))},r.prototype.clearFilter=function(i,r){var o=this;return this.undoRedoService.register("ClearFilter",(function(){o.telemetry.logEvent(e.telemetry.EXClearFilter,t.util.getTelemetryFilterType(r.type),t.util.getTelemetryFilterScopeType(i.scopeType),t.util.getTelemetryFieldKind(r.expression),t.util.getTelemetryViewMode(o.viewModeState.getMode())),o.updateFilter(i,r,void 0)}))},r.prototype.toggleFilterVisibility=function(i,r){var o=this;return this.undoRedoService.register("HideFilter",(function(){o.telemetry.logEvent(e.telemetry.EXHideFilter,t.util.getTelemetryFilterType(r.type),t.util.getTelemetryFilterScopeType(i.scopeType),t.util.getTelemetryFieldKind(r.expression),r.isHiddenInViewMode),r.isHiddenInViewMode=!r.isHiddenInViewMode,o.updateFilter(i,r,r.filter)}))},r.prototype.toggleFilterLock=function(i,r){var o=this;return this.undoRedoService.register("lockFilter",(function(){o.telemetry.logEvent(e.telemetry.EXLockFilter,t.util.getTelemetryFilterType(r.type),t.util.getTelemetryFilterScopeType(i.scopeType),t.util.getTelemetryFieldKind(r.expression),r.isLockedInViewMode),r.isLockedInViewMode=!r.isLockedInViewMode,o.updateFilter(i,r,r.filter)}))},r.prototype.updateFilter=function(e,t,i){var r=2===t.howCreated,s=t.filter;t.filter=i;var l=t.config&&t.config.singleVisual;if(l){var c=this.visualPluginService.capabilities(l.visualType),u=this.filterGenerator.tryGetFilterPropertyIdentifier(c);u&&(l.objects||(l.objects={}),null==i?n.deleteProperty(l.objects,u.objectName,null,u.propertyName):n.setValue(l.objects,u,null,i))}r&&!a.isSameFilter(s,i)&&o(e.container,e)&&this.updateCrossDrillFromVisualContainer(e.container);var p=e.container;null==p.filters&&(p.filters=[]),_.indexOf(p.filters,t)===-1&&p.filters.push(t)},r.prototype.updateTopNFilter=function(i,r,o,n){var a,l,c=this;if(i){var u=t.util.VisualContainerUtils.getVisualQuery(i);if(u){var p=u.defn.select();a=_.some(p,(function(e){return s.equals(e.expr,r.fieldBeingFiltered,!0,!0)})),l=_.some(p,(function(e){return s.equals(e.expr,r.orderByField,!0,!0)}))}}var d=this.telemetry.startEvent(e.telemetry.EXFilterPaneTopNFilterApplied,r.isTop,r.itemCount,a,l,t.util.getTelemetryViewMode(this.viewModeState.getMode())),h=this.dataSource.get();return this.registerUndoableAction(h,(function(t){var i=e.data.TopNFilterPattern.buildFilterFromParameters({fieldBeingFiltered:r.fieldBeingFiltered,isTop:r.isTop,itemCount:r.itemCount,orderByField:r.orderByField});return c.updateFilter(o,n,i),d.resolve(),!0}),"Apply TopN Filter")},r.prototype.createFilterVisualContainerConfig=function(e,t,i){return this.visualAuthoringOperations.createFilterVisualContainerConfig(e,t,i)},r.prototype.raiseVisualContainerChanged=function(e){this.visualAuthoringOperations.notifyVisualContainers([e])},r.prototype.convert=function(e,t,i){var r=this;return this.registerUndoableAction(t,(function(t){return r.visualAuthoringOperations.convert(t,e,i)}),"VisualConversion")},r.prototype.setOrderBy=function(e,t){var i=e.config.singleVisual;i.query.orderBy(t),i.hasDefaultSort=!1,this.raiseVisualContainerChanged(e)},r.prototype.removeOrderBy=function(e,t){for(var i=0,r=t;i<r.length;i++){var o=r[i];e.config.singleVisual.query.removeOrderBy(o)}this.raiseVisualContainerChanged(e)},r.prototype.setPropertyDefinition=function(e,t,i){var r=this;this.undoRedoService.register("Set Property",(function(){return r.visualAuthoringOperations.addProperty(e,t.propertyId,t.selector,i),r.raiseVisualContainerChanged(e),!0}))},r.prototype.removePropertyDefinition=function(e,t){var i=this;this.undoRedoService.register("Removing Property",(function(){return i.visualAuthoringOperations.removeProperty(e,t.propertyId,t.selector),i.raiseVisualContainerChanged(e),!0}))},r.prototype.addDataBars=function(e,t,i){var r=this;this.undoRedoService.register("Set Data Bars",(function(){return r.visualAuthoringOperations.addProperty(e,t.propertyId,t.selector,i),r.raiseVisualContainerChanged(e),!0}))},r.prototype.removeDataBars=function(e,t){var i=this;this.undoRedoService.register("Removing Data Bars",(function(){return i.visualAuthoringOperations.removeProperty(e,t.propertyId,t.selector),i.raiseVisualContainerChanged(e),!0}))},r.prototype.removeConditionalFormattingAll=function(e,t){var i=this;this.undoRedoService.register("Removing All Conditional Formatting",(function(){if(!_.isEmpty(t))for(var r=0,o=t;r<o.length;r++){var n=o[r];i.visualAuthoringOperations.removeProperty(e,n.propertyId,n.selector)}return i.raiseVisualContainerChanged(e),!0}))},r.prototype.persistProperties=function(e,i,r){var o=this,n=_.isArray(e)?e:[e],a=i.config.singleVisual,s=function(){var e=a.visualType,r=o.visualPluginService.capabilities(e),s=o.filterGenerator.tryGetFilterPropertyIdentifier(r),l=!1,c=function(e,t,i,r,o){s&&e===s.objectName&&s.propertyName===i&&(l=!0)},u=_.reduce(n,(function(e,t){return o.visualAuthoringOperations.persistProperties(t,a,c)&&e}),!0);return l&&t.util.VisualContainerUtils.notifyVisualContainersExceptSource(o.eventBridge,i),u?(o.scopedLazySync("visualSync").syncFilterState(i),u):u};return r?s():this.undoRedoService.register("VisualContainerPersistProperties",s)},r.prototype.deleteSelectedVisuals=function(e){for(var t=_.map(this.selectionService.getSelectedElements(),(function(e){return e.visualContainer})),i=!1,r=0,o=t;r<o.length;r++){var n=o[r];n&&(i=this.deleteVisualContainerInternal(n,e)||i)}i&&(this.notifyVisualContainersAndClearSelection(t,e),this.hostTooltip.hide({immediately:!0,isTouchEvent:!1}))},r.prototype.deleteVisualContainer=function(e,t){this.deleteVisualContainerInternal(e,t)&&this.notifyVisualContainersAndClearSelection([e],t)},r.prototype.deleteVisualContainers=function(e,t){var i=this,r=t.sections.filter((function(e){return e.selected}))[0],o=[];t.contract.sections.forEach((function(t){t.name===r.contract.name?e.forEach((function(e){_.some(t.visualContainers,(function(t){return t.config.singleVisual.visualType===e.config.singleVisual.visualType}))&&o.push(e)})):e.forEach((function(e){_.remove(t.visualContainers,(function(t){return e.config.singleVisual.visualType===t.config.singleVisual.visualType})),i.visualAuthoringOperations.deleteVisualRelationships(t,e)}))})),o.length>0&&(o.forEach((function(e){i.deleteVisualContainer(e,t.exploreCanvas)})),this.notifyVisualContainersAndClearSelection(o,t.exploreCanvas))},r.prototype.deleteVisualRelationships=function(e,t){this.visualAuthoringOperations.deleteVisualRelationships(e,t)},r.prototype.setVisualRelationship=function(e,t,i,r){var o=this;this.undoRedoService.register("SetVisualRelationship",(function(){return o.visualAuthoringOperations.setVisualRelationship(e,t,i,r)}))},r.prototype.setDisplayNameAlias=function(e,t,i){var r=this,o=t.config.singleVisual;this.undoRedoService.register("SetDisplayNameAlias",(function(){var n=o.columnProperties;if(i){o.columnProperties||(o.columnProperties=n={});var a=n[e];a||(n[e]=a={}),a.displayName=i}else if(n){var a=n[e];a&&delete a.displayName}r.raiseVisualContainerChanged(t)}))},r.prototype.setLinkFieldAsAggregation=function(e,t){this.undoRedoService.register("Set Link As Aggregation",(function(){e.isLinkedAsAggregation=t}))},r.prototype.setVisibility=function(e,t,i){var r=this;this.undoRedoService.register("Set Visual Containers Visibility",(function(){for(var o=0,n=t;o<n.length;o++){var a=n[o];r.visualAuthoringOperations.setVisibility(a,e,i)}r.visualAuthoringOperations.notifyVisualContainers(t)}))},r.prototype.applyShowValueAs=function(e,t,i){var r=this;return this.registerUndoableAction(e.dataSources,(function(o){if(r.removeShowValueAs(o,e,t))switch(i.kind){case void 0:return!0;case 0:return r.visualAuthoringOperations.setPercentOfGrandTotal(o,e.visualDataRole.name,e.roleIndex,e.visual);case 1:return r.visualAuthoringOperations.setPercentOfRoleTotal(o,i.roles,e.visualDataRole.name,e.roleIndex,e.visual);default:return!1}}),"applying quick calc ")},r.prototype.removeShowValueAs=function(e,t,i){var r;switch(i.kind){case void 0:return!0;case 0:return this.visualAuthoringOperations.removePercentOfGrandTotal(e,t.visualDataRole.name,t.roleIndex,t.visual);case 1:return r=this.visualAuthoringOperations.removePercentOfRoleTotal(e,t.visualDataRole.name,t.roleIndex,t.visual);default:return!1}},r.prototype.registerUndoableAction=function(e,t,i){var r=this;return this.getSchemaAndExecuteAction(e,(function(e){return r.undoRedoService.register(i,(function(){return t(e)}))}))},r.prototype.getSchemaAndExecuteAction=function(e,t){var i=this;return this.schemaProxy.get(e).then((function(e){return t(e)?i.promiseFactory.resolve():i.promiseFactory.reject()}))},r.prototype.notifyVisualContainersAndClearSelection=function(e,t){this.filterGenerator.clearFiltersFromVisualContainers(t.contract,e),this.selectionService.clearSelection()},r.prototype.deleteVisualContainerInternal=function(t,i){if(t){var r=e.explore.util.CanvasVisualsUtility.findVisualContainerViewModel(i.visualContainers,t);if(r){this.visualAuthoringOperations.deleteVisualRelationships(i.contract,t);var o=i.visualContainers.indexOf(r);i.visualContainers.splice(o,1);var n=i.contract,a=n.visualContainers.indexOf(t);return n.visualContainers.splice(a,1),!0}}},r.prototype.updateCrossDrillFromVisualContainer=function(e){var t=this.explorationNavigationService.getCurrentExploration(),i=_.find(t.sections,(function(t){return _.includes(t.visualContainers,e)}));i&&this.filterGenerator.updateCrossFilterOnDrill(i,e)},r})()})(i=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){function r(e,t,i,r,o,n,s,l,c,u){return new a(e,t,r,o,n,s,l,c,u)}var o=e.explore.util.CanvasVisualsUtility,n=t.services.selectionUtils;i.createCanvasKeyHandlerService=r;var a=(function(){function e(e,t,i,r,o,n,a,s,l){this.clipboardService=e,this.selectionService=t,this.viewModeState=i,this.undoRedoService=r,this.visualAuthoring=o,this.eventBridge=n,this.visibilityService=a,this.formFactor=s,this.lazyScopedSync=l}return e.prototype.onKeyDown=function(e,t){var i=e.which;if(27===i){return!!this.visibilityService.get()?(this.onExitPopOutMode(e,t),this.onClearFormatPainterData(e),this.preventStopAndReturnFalse(e)):(this.onClearSelection(e),this.onClearFormatPainterData(e),!1)}if(this.isSaveEvent(e))return this.onSave(),this.preventStopAndReturnFalse(e);var r=this.formFactor.getCurrentLayoutCapabilities();if(0!==this.viewModeState.getMode()){if(this.isDeleteEvent(e))return r.canRemoveVisualFromLayout()?this.onRemoveFromLayout(e,t):r.canDelete()&&this.onDelete(e,t),this.preventStopAndReturnFalse(e);if(this.isCtrlOrMeta(e))switch(i){case 65:return this.onSelectAll(e,t),this.preventStopAndReturnFalse(e);case 67:return r.canCutCopyPaste()&&this.onCopy(e),this.preventStopAndReturnFalse(e);case 88:return r.canCutCopyPaste()&&this.onCut(e),this.preventStopAndReturnFalse(e);case 86:return r.canCutCopyPaste()&&this.onPaste(e),this.preventStopAndReturnFalse(e);case 89:return this.onRedo(),this.preventStopAndReturnFalse(e);case 90:return this.onUndo(),this.preventStopAndReturnFalse(e);case 191:return this.onShowQna(),this.preventStopAndReturnFalse(e)}else if(r.canPassUnhandledKeysToSelectedVisual())return this.allowSelectedVisualContainerToHandle(e,t)}else if(r.canPassUnhandledKeysToSelectedVisual())return this.allowSelectedVisualContainerToHandle(e,t)},e.prototype.allowSelectedVisualContainerToHandle=function(e,t){var i=n.getSelectedVisual(this.selectionService);if(i){var r=o.findVisualContainerViewModel(t.visualContainers,i);if(r)return r.handleKeyDown(e)}},e.prototype.preventStopAndReturnFalse=function(e){return e.originalEvent&&(e.originalEvent.preventDefault(),e.originalEvent.stopPropagation()),!1},e.prototype.onUndo=function(){this.undoRedoService.undo()},e.prototype.onRedo=function(){this.undoRedoService.redo()},e.prototype.onCopy=function(e){this.canCopyOrCut()&&this.clipboardService.copy()},e.prototype.onCut=function(e){this.canCopyOrCut()&&this.clipboardService.cut()},e.prototype.onPaste=function(e){this.clipboardService.paste()},e.prototype.onRemoveFromLayout=function(e,t){this.lazyScopedSync("layoutAuthoring").removeLayoutFromSelectedVisuals(t)},e.prototype.onDelete=function(e,t){var i=this;this.undoRedoService.register("CanvasKeyDelete",(function(){i.visualAuthoring.deleteSelectedVisuals(t)}))},e.prototype.onClearSelection=function(e){this.selectionService.clearSelection()},e.prototype.onClearFormatPainterData=function(e){this.clipboardService.clearFormatData()},e.prototype.onExitPopOutMode=function(e,t){this.visibilityService.clear()},e.prototype.onSelectAll=function(e,t){var i=_.map(t.visualContainers,(function(e){return e.contract}));n.selectVisualContainers(i,this.selectionService)},e.prototype.onSave=function(){this.eventBridge.publishToChannel(i.events.saveKeyPressedEvent)},e.prototype.onShowQna=function(){this.eventBridge.publishToChannel(i.events.addQnaContainer,{sourceOfCreation:2})},e.prototype.isSaveEvent=function(e){return this.isOnlyCtrlOrMeta(e)&&83===e.which},e.prototype.isDeleteEvent=function(e){return!e.ctrlKey&&46===e.which},e.prototype.canCopyOrCut=function(){return!this.visibilityService.get()},e.prototype.isCtrlOrMeta=function(e){var t=e.ctrlKey,i=e.metaKey;return e&&(t&&!i||!t&&i)},e.prototype.isOnlyCtrlOrMeta=function(e){return this.isCtrlOrMeta(e)&&!e.altKey&&!e.shiftKey},e})()})(i=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){function t(e,t,r,o,n){return new i(e,t,r,o,n)}e.createCanvasScaleService=t;var i=(function(){function e(e,t,i,r,o){this.explorationNavigation=e,this.formFactorProvider=t,this.visibility=i,this.viewModeState=r,this.overlayService=o,this.displayAreaScale=1,this.wallpaperScale=1}return e.prototype.setDisplayAreaScaleFactor=function(e){this.displayAreaScale=e},e.prototype.setWallpaperScaleFactor=function(e){this.wallpaperScale=e},e.prototype.getDisplayAreaScaleFactor=function(){return this.displayAreaScale},e.prototype.getWallpaperScaleFactor=function(){return this.wallpaperScale},e.prototype.getDisplayOption=function(){if(1===this.formFactorProvider.getCurrentLayout()&&1===this.viewModeState.getMode())return 3;if(!!this.visibility.get())return 0;if(null!=this.overrideDisplayOption)return this.overrideDisplayOption;var e=this.explorationNavigation.getCurrentSection();return e?e.size.displayOption:void 0},e.prototype.setDisplayOption=function(e){var t=this.explorationNavigation.getCurrentSection();t&&(this.overlayService.hideAllDropdowns(),t.size.displayOption=e)},e})()})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={})),define("ExploreUI/services/daxCapabilitiesService",["require","exports"],(function(e,t){function i(){return new r}Object.defineProperty(t,"__esModule",{value:!0}),t.create=i;var r=(function(){function e(){}return e.prototype.getCapabilities=function(){return __awaiter(this,void 0,powerbi.Promise,(function(){var e;return __generator(this,(function(t){return e=["CALCULATE","DIVIDE","KEEPFILTERS","SUM","SUMMARIZE","VALUES"],[2,{Functions:_.map(e,(function(e){return{Name:e}})),Operators:[],SupportsTableConstructor:!0,SupportsVariations:!0,SupportsVirtualColumns:!0}]}))}))},e})()}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){function i(e,t,i,r,n){return new o(e,t,i,r,n)}var r=e.explore.services.events;t.createDeleteVisualService=i;var o=(function(){function t(e,t,i,r,o){this.eventBridge=e,this.$rootScope=t,this.telemetryService=i,this.visualPluginService=r,this.undoRedoService=o}return t.prototype.deleteCustomVisuals=function(t,i){var o=this;this.undoRedoService.register("DeleteCustomVisual",(function(){i.forEach((function(i){o.telemetryService.logEvent(e.telemetry.EXDeleteCustomViz,i.name),o.visualPluginService.removePlugin(i.name),_.remove(t.resourcePackages,(function(e){return e.name===i.name})),o.eventBridge.publishToChannel(r.deleteCustomVisual,{visual:i})})),o.eventBridge.publishToChannel(r.visualPluginsChanged)}))},t})()})(i=t.services||(t.services={}))})(t=e.exploreui||(e.exploreui={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(t){function i(e,t){return new r(e,t)}t.createDetailVisualSpinnerService=i;var r=(function(){function t(e,t){this.scope=e,this.eventBridge=t}return t.prototype.startSpinner=function(){this.eventBridge.publishBubbling(this.scope,e.viewModels.DetailVisualEvents.spinnerAction,0)},t.prototype.stopSpinner=function(){this.eventBridge.publishBubbling(this.scope,e.viewModels.DetailVisualEvents.spinnerAction,1)},t})()})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){function r(e,t,i){return new c(e,t,i)}var o=e.explore.util.DrillUtils,n=jsCommon.EnumExtensions,a=t.util.DetailVisualUtils,s=e.visuals.plugins,l=t.util.VisualContainerUtils;
i.createDrillService=r;var c=(function(){function t(e,t,i){this.eventBridge=e,this.visualPlugin=t,this.visualPluginOps=i}return t.prototype.getSupportedDrillDirections=function(e,t){var i=this.getProjections(e);if(!i)return 0;var r=t?[t]:[];if(_.isEmpty(r)){var n=e.config.singleVisual,a=this.visualPlugin.capabilities(n.visualType);if(!a)return 0;r=o.getDrillableRoles(a)}for(var s=0,l=0,c=r;l<c.length;l++){var u=c[l],p=i[u];if(p&&p.activeProjectionRefs){var d=p.all();if(1===d.length)continue;var h=p.activeProjectionRefs,v=this.findActiveProjectionIndexInQueryCollection(d,h);_.isEmpty(h)||v+h.length===d.length||(this.canDrillDownLevel(e,2,u)&&(s|=2),this.canDrillDownLevel(e,3,u)&&(s|=4)),!_.isEmpty(p.activeProjectionRefs)&&(0!==v||h.length>1)&&(s|=1)}}return s},t.prototype.setDrillMode=function(e,t){e&&e.drillMode!==t&&(e.drillMode=t,this.raiseDrillModeChanged(e,t))},t.prototype.canSeeData=function(e){if(!(e&&e.config&&e.config.singleVisual&&e.config.singleVisual.query))return!1;var t=l.getVisualType(e),i=e.config.singleVisual;return!(i.getErrorDetails&&!!i.getErrorDetails())&&a.supportsVisualDetails(t,this.visualPlugin,this.visualPluginOps)},t.prototype.canDrillToDetails=function(t,i){if(!t)return!1;var r=l.getVisualQuery(t);if(!r)return!1;var o=l.getVisualType(t);if(o===s.lineChart.name||o===s.areaChart.name||o===s.stackedAreaChart.name)return!1;var n=l.getVisualCapabilities(t,this.visualPlugin);if(!n||n.supportsSelection===!1)return!1;var a=_(l.getSelectExprs(t)).filter((function(t){return e.data.SQExpr.isAggregation(t.expr)})).map((function(e){return e.name})).value();if(_.isEmpty(a))return!1;if(!_.isEmpty(i)&&!_.includes(a,_.head(_.head(i).metadata)))return!1;var c=n.dataRoles;if(_.isEmpty(c))return!1;for(var u=_(c).filter((function(t){return t.kind===e.VisualDataRoleKind.Measure&&0!==t.joinPredicate})).map((function(e){return e.name})).value(),p=0,d=0,h=u;d<h.length;d++){var v=h[d],g=r.projections[v];if(!_.isEmpty(g)){if(p++,p>1)return!1;var f=g.all();if(_.some(f,(function(e){return!_.includes(a,e.queryRef)})))return!1}}return 0!==p},t.prototype.canDrillByDirection=function(e,t,i){if(!e||e.config.singleVisual.getErrorDetails&&!!e.config.singleVisual.getErrorDetails())return!1;var r=this.getSupportedDrillDirections(e,i);return!!r&&n.hasFlag(r,t)},t.prototype.canDrillthrough=function(e){return!!e},t.prototype.isDrillModeEnabled=function(e,t){return!!e&&e.drillMode===t},t.prototype.canDrillDownLevel=function(t,i,r){var o=l.getVisualQuery(t);if(!o)return!1;if(!l.getVisualCapabilities(t,this.visualPlugin))return!1;if(!r)return!1;var n=o.projections[r],a=n.getLastActiveQueryReference();if(!a)return!1;for(var s=_.findIndex(n.all(),(function(e){return e.queryRef===a})),c=function(a){var s=n.all()[a],l=o.defn.select().withName(s.queryRef).expr;if(0===_.filter(t.filters,(function(t){return 2===t.howCreated&&e.data.SQExpr.equals(l,t.expression)})).length)return{value:o.currentDrillMode(r)===i}},u=0;u<s;u++){var p=c(u);if("object"==typeof p)return p.value}return 3!==i||!_.find(o.expansionStates,(function(e){return _.find(e.roles,(function(e){return e===r}))&&e.isStateModified()}))},t.prototype.getProjections=function(e){return e&&e.config&&e.config.singleVisual&&e.config.singleVisual.query&&e.config.singleVisual.query.projections},t.prototype.findActiveProjectionIndexInQueryCollection=function(e,t){if(!_.isEmpty(t))for(var i=0;i<e.length;i++){for(var r=i,o=0;o<t.length&&r<e.length&&t[o]===e[r].queryRef;)o++,r++;if(o===t.length)return i}return-1},t.prototype.raiseDrillModeChanged=function(e,t){var r={visualContainer:e};this.eventBridge.publishToChannel(i.events.drillModeChanged,r)},t})()})(i=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){e.visualCustomCommand={type:2,name:"visualCustomCommand"}})(t=e.events||(e.events={}))})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){function r(e){return new a(e)}var o=e.common.helpers.TelemetryHelper.TelemetryEventManager;i.createExplorationActivityService=r;var n=(function(){function e(e,t){this.unregisterExploreCanvasVisualRenderedListener=e,this.unregisterDestroyScopeListener=t}return e.prototype.unregister=function(){this.unregisterExploreCanvasVisualRenderedListener(),this.unregisterDestroyScopeListener()},e})(),a=(function(){function i(e){this.eventBridge=e,this.changeSectionActivity=new o({onReject:function(e){return e.event.info.isCancelled=!0}})}return i.prototype.registerExplorationHostScope=function(e){var i=this;this.scope&&this.unregisterExplorationHostScope(this.scope),this.scope=e,this.listeners=new n(e.$on(t.constants.exploreCanvasVisualRendered,(function(){i.changeSectionActivity.resolve()})),e.$on("$destroy",(function(){i.unregisterExplorationHostScope(i.scope)})))},i.prototype.unregisterExplorationHostScope=function(e){this.scope&&e===this.scope&&(this.listeners.unregister(),this.scope=void 0,this.listeners=void 0)},i.prototype.doActivity=function(e,t){if(!this.scope)return jsCommon.Trace.warning("doActivity with no registered exploration host scope"),e(_.noop);var i=t(this.scope);try{return e((function(e){i&&(i.reject(e),i=void 0)}))}catch(e){throw i&&(i.reject({errorCode:"Exception",errorMessage:e&&e.name}),i=void 0),e}finally{i&&i.resolve()}},i.prototype.doActivityAsync=function(t,i){return __awaiter(this,void 0,e.Promise,(function(){var e,r,o;return __generator(this,(function(n){switch(n.label){case 0:return this.scope?[3,2]:(jsCommon.Trace.warning("doActivityAsync with no registered exploration host scope"),[4,t(_.noop)]);case 1:return[2,n.sent()];case 2:e=i(this.scope),n.label=3;case 3:return n.trys.push([3,5,6,7]),[4,t((function(t){e&&(e.reject(t),e=void 0)}))];case 4:return r=n.sent(),[2,r];case 5:throw o=n.sent(),e&&(e.reject({errorCode:"Exception",errorMessage:o&&o.name}),e=void 0),o;case 6:return e&&e.resolve(),[7];case 7:return[2]}}))}))},i.prototype.changeSection=function(e,t){var i=this;if(this.scope){this.changeSectionActivity.start((function(){return t(i.scope)}));try{var r=this.getVisualContainers();e();var o=this.getVisualContainers();(_.isEmpty(o)||r===o)&&this.changeSectionActivity.resolve()}catch(e){throw this.changeSectionActivity.reject({errorCode:"Exception",errorMessage:e&&e.name}),e}}else jsCommon.Trace.warning("Section change with no registered exploration host scope"),e()},i.prototype.getVisualContainers=function(){return this.scope.viewModel&&this.scope.viewModel.exploration&&this.scope.viewModel.exploration.exploreCanvas&&this.scope.viewModel.exploration.exploreCanvas.visualContainers},i})()})(i=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){function t(e,t){return new i(e,t)}e.createExplorationCapabilitiesService=t;var i=(function(){function e(e,t){var i=!t||t.featureSwitches.contentAuthoringUIEnabled,r=!(!e||!e.isGuestUser);this.options={showAppBar:!0,showTaskPane:!0,showVisualizationPane:!0,showNavContentPane:!0,visualContainerOptions:{showMenu:!0,showPin:!0,showContextMenu:!0,disablePin:r||!i,disableQueryCacheUpdates:!1},showBackButtonOnAppBar:!1,disablePin:r||!i,disableSharePointEmbed:r,disableQRGeneration:r,persistentUserStateEnabled:!1,persistentUserStateThrottlingEnabled:!1}}return e.prototype.setCapabilities=function(e){_.merge(this.options,e)},e.prototype.getCapabilities=function(){return this.options},e})()})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){function i(e,t,i,r,o){return new s(e,t,i,o,r)}var r=e.data.RestatementHelper,o=e.data.SemanticFilter,n=e.data.SQExprConverter,a=e.data.SQExprUtils;t.createFilterRestatementService=i;var s=(function(){function t(e,t,i,r,o){this.conceptualSchemaProxy=e,this.filterGenerator=t,this.promiseFactory=i,this.visualQueryGenerator=r,this.dataProxy=o}return t.prototype.loadRestatement=function(e,t,i){var n=this,s=t.filter;return!s||o.isAnyFilter(s)?this.promiseFactory.resolve(null):this.conceptualSchemaProxy.get(e).then((function(l){if(o.isDefaultFilter(s)){var c=a.getDefaultValue(t.expression,l);return r.fromDefault(c?c.value:"")}return n.loadRestatementForSQExpr(l,t,e,i)}))},t.prototype.loadRestatementForSQExpr=function(e,t,i,r){return t.expression.hasGroupOnKeys(e)?this.loadRestatementForSQExprWithGroupOnKeys(e,t,i):this.promiseFactory.resolve(this.getRestatementForSimpleSQExpr(e,t,r))},t.prototype.getRestatementForSimpleSQExpr=function(e,t,i){var o=this.getSelectedScopeIdsContainerFromFilter(e,t);return o&&r.fromDataViewScopeIdentities(o.scopeIds,o.isNot,i)},t.prototype.loadRestatementForSQExprWithGroupOnKeys=function(e,t,i){var o,n,a=this.getSelectedScopeIdsContainerFromFilter(e,t);if(a&&(o=a.isNot,n=a.scopeIds),_.isEmpty(n))return this.promiseFactory.resolve(null);var s=t.cachedValueItems;return _.isEmpty(s)||s.length!==n.length?this.runQueryToGetRestatement(e,t,o,n,i):this.promiseFactory.resolve(r.fromLabels(s,o))},t.prototype.runQueryToGetRestatement=function(t,i,o,n,a,s){var l=i.config&&i.config.singleVisual;if(!a||!l)return this.promiseFactory.resolve(null);var c=e.DataViewScopeIdentity.filterFromIdentity(n,!1),u={dataSources:a,schema:t,config:l,additionalFilters:{dataFilter:c,dataFiltersUnmerged:[{filter:c}]}},p=this.visualQueryGenerator.execute(u);return p.error?this.promiseFactory.resolve(null):this.dataProxy.execute(p.options).then((function(e){for(var t=e.dataReaderResult.dataView,n=t&&t.categorical&&t.categorical.categories[0],a=n&&n.values?n.values.length:0,l=[],c=0;c<a;c++){var u=n.identity&&n.identity[c],p=n.values&&n.values[c],d=s?s.format(p):p;l.push({displayName:d,identity:u})}return i.cachedValueItems=l,r.fromLabels(l,o)}))},t.prototype.getSelectedScopeIdsContainerFromFilter=function(e,t){var i=t.expression.getKeyColumns(e);if(i){var r=t.filter;return r?n.asScopeIdsContainer(r,i):void 0}},t})()})(i=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){function r(e,t,i,r,o,n){return new a(e,t,i,r,o,n)}var o=jsCommon.FreezeUtility,n=e.common.helpers.TelemetryHelper;i.createFormFactorProvider=r;var a=(function(){function r(e,t,i,r,o,n){this.canvasLayout=0,this.canvasLayoutCapabilities=this.initializeLayoutCapabilities(),this.eventBridge=e,this.selection=t,this.servicePauser=i,this.timeout=r,this.viewModeState=o,this.telemetry=n}return r.prototype.getCurrentLayout=function(){return this.canvasLayout},r.prototype.changeFormFactor=function(i,r){this.canvasLayout!==i&&(this.telemetry.logEvent(e.telemetry.EXChangeCanvasLayout,n.getTelemetryCanvasLayout(this.canvasLayout),n.getTelemetryCanvasLayout(i),t.util.getTelemetryViewMode(this.viewModeState.getMode())),this.selection.clearSelection(),this.setCurrentLayout(i),this.applyFormFactor(i,r))},r.prototype.applyFormFactor=function(e,r){var o=this,n=r.exploration.contract,a=n.activeSectionIndex;r.exploration.exploreCanvas=t.viewModels.ViewModelFactory.convertSectionToExploreCanvas(n,n.sections[a],this.canvasLayout),this.updateViewModeState();var s={layout:e};this.timeout((function(){return o.eventBridge.publishToChannel(i.events.formFactorChanged,s)}))},r.prototype.getCurrentLayoutCapabilities=function(){return this.canvasLayoutCapabilities[this.canvasLayout]},r.prototype.setCurrentLayout=function(e){this.canvasLayout=e,0===this.canvasLayout?this.servicePauser.resume():this.servicePauser.pause()},r.prototype.updateViewModeState=function(){var e=this.getCurrentLayoutCapabilities();this.viewModeState.updateConfig((function(t){t.displayOptions.showMobilePane=e.canShowMobileVisualizationPane()}))},r.prototype.initializeLayoutCapabilities=function(){var e,t=this,i=function(){return 1===t.viewModeState.getMode()},r=function(){return 0===t.viewModeState.getMode()},n=(e={},e[0]={canMoveMultipleVisuals:_.noopTrue,canShowCanvasBackground:_.noopTrue,canShowCanvasBackdrop:_.noopFalse,canShowCanvasOutspace:_.noopTrue,canShowCodePane:_.noopTrue,canShowVisualContainerHeader:_.noopTrue,canShowVisualContainerHeaderInset:_.noopFalse,canShowMobileVisualizationPane:_.noopFalse,canShowLayoutGrid:i,canRemoveVisualFromLayout:_.noopFalse,canCutCopyPaste:_.noopTrue,canDelete:_.noopTrue,canPassUnhandledKeysToSelectedVisual:_.noopTrue,canAddRemoveSections:i,canShowVisualToolbar:i},e[1]={canMoveMultipleVisuals:_.noopFalse,canShowCanvasBackground:_.noopTrue,canShowCanvasBackdrop:i,canShowCanvasOutspace:_.noopTrue,canShowCodePane:_.noopFalse,canShowVisualContainerHeader:r,canShowVisualContainerHeaderInset:_.noopTrue,canShowMobileVisualizationPane:i,canShowLayoutGrid:i,canRemoveVisualFromLayout:i,canCutCopyPaste:_.noopFalse,canDelete:_.noopFalse,canPassUnhandledKeysToSelectedVisual:_.noopTrue,canAddRemoveSections:_.noopFalse,canShowVisualToolbar:_.noopFalse},e[2]={canMoveMultipleVisuals:_.noopFalse,canShowCanvasBackground:_.noopTrue,canShowCanvasBackdrop:_.noopTrue,canShowCanvasOutspace:_.noopTrue,canShowCodePane:_.noopFalse,canShowVisualContainerHeader:_.noopFalse,canShowVisualContainerHeaderInset:_.noopFalse,canShowMobileVisualizationPane:_.noopTrue,canShowLayoutGrid:_.noopFalse,canRemoveVisualFromLayout:_.noopTrue,canCutCopyPaste:_.noopFalse,canDelete:_.noopFalse,canPassUnhandledKeysToSelectedVisual:_.noopTrue,canAddRemoveSections:_.noopFalse,canShowVisualToolbar:_.noopFalse},e);return o.deepFreeze(n),n},r})()})(i=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){function i(e,t,i,r,o){return new s(e,t,i,r,o)}var r=e.visuals.plugins.multiRowCard,o=e.data.SemanticQuery,n=e.explore.util.VisualHostServicesUtil,a=e.explore.contracts.VisualQuery;t.createGroupQueryService=i;var s=(function(){function i(e,t,i,r,o){this.conceptualSchemaProxy=i,this.visualQueryGenerator=r,this.promiseFactory=o,this.singleExecutableDataProxyFactory=e,this.filterGenerator=t,this.reset()}return i.prototype.getValuesForColumn=function(t,i,r){var s=this,l=this.promiseFactory.defer();return this.conceptualSchemaProxy.get(i).then((function(c){var u=new a(o.create(),{},[]);u.add(t,"Values"),s.runQueryImpl({dataSources:i,schema:c,config:{visualType:e.visuals.plugins.table.name,query:u},hostServices:n.createQueryVisualHostServices(),visualQueryGenerator:s.visualQueryGenerator,isLoadMore:r,preferCurrentData:!r,allowCache:!1,isInitialLoad:!r}).then((function(e){s.lastResult=e?{table:e.dataReaderResult.dataView.table,canLoadMore:s.dataProxy.canLoadMore()}:s.lastResult,l.resolve(s.lastResult)}),(function(e){l.reject(e)}))}),(function(e){l.reject(e.clientError)})),l.promise},i.prototype.getAggregatesForColumn=function(e,t){var i=this,s=this.promiseFactory.defer();return this.conceptualSchemaProxy.get(t).then((function(l){var c=new a(o.create(),{},[]),u=r.capabilities.dataRoles[0].name;c.add(e,u),c.setAggregate(u,0,3),c.add(e,u),c.setAggregate(u,1,4),c.add(e,u),c.setAggregate(u,2,5),i.runQueryImpl({dataSources:t,schema:l,config:{visualType:r.name,query:c},hostServices:n.createQueryVisualHostServices(),visualQueryGenerator:i.visualQueryGenerator,isLoadMore:!1,preferCurrentData:!1,allowCache:!1}).then((function(e){var t,i=e.dataReaderResult.dataView.table,r=i&&i.rows;if(r&&r.length>0){var o=r[0];t=o?{min:{formatString:i.columns[0].format,value:o[0]},max:{formatString:i.columns[1].format,value:o[1]},count:o[2]}:void 0}s.resolve(t)}),(function(e){s.reject(e)}))}),(function(e){s.reject(e.clientError)})),s.promise},i.prototype.reset=function(){this.conceptualSchemaProxy.clearCache(),this.dataProxy=t.createExploreVisualDataProxyService(this.singleExecutableDataProxyFactory.create(),this.filterGenerator)},i.prototype.runQueryImpl=function(e){return this.dataProxy.runQuery(e)},i})()})(i=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){function i(e,t,i,r,o,n,a){return new h(e,t,i,r,o,n,a)}var r=e.visuals.DefaultTooltipOptions,o=e.visuals.TouchOptimizedTooltipOptions;t.createHostTooltipService=i;var n="body",a=350,s=350,l=350,c=350,u=500,p='<visual-tooltip tooltip-data="tooltipData" tooltip-data-sources="tooltipDataSources" tooltip-data-items="tooltipDataItems" on-hide="onHide()" actions-provider="actionsProvider" exploration-contract="explorationContract" exploration-capabilities="explorationCapabilities" show-action-bar="showActionBar" tooltip-shown="tooltipShown"></visual-tooltip>',d=12,h=(function(){function t(t,i,o,a,s,l,c){var u=this;this.$compile=t,this.$injector=i,this.$rootScope=o,this.$timeout=a,this.isTouchScreenOptimizedEnabled=s,this.parentContainer=l,this.tooltipContainer=c,this.hideTooltipHandler=function(e){"touch"!==e.pointerType||e.tooltip||(u.hide({isTouchEvent:!0,immediately:!0}),document.removeEventListener("pointerdown",u.hideTooltipHandler),u.customVisuals.each((function(e,t){t.removeEventListener("pointerdown",u.hideTooltipHandler)})))},this.$timeout=a,this.parentContainer=l||$(n);var p=this.parentContainer.get(0);this.tooltipContainer=c||new e.visuals.TooltipContainer(p,r)}return t.prototype.show=function(t){var i=this,n=t.isTouchEvent&&this.isTouchScreenOptimizedEnabled(),s=e.Prototype.inherit(n?o:r,(function(e){e.useLightColors=t.useLightColors,e.showImmediatelyAdjacentToClickedArea=t.showImmediatelyAdjacentToClickedArea}));this.tooltipContainer.setTooltipAppearanceOptions(s),this.clearTooltipTimeout();var c;c=this.tooltipContainer.isVisible()?16:t.isTouchEvent?void 0!==t.showDelay?t.showDelay:l:void 0!==t.showDelay?t.showDelay:a;var u=this.ensureVisualTooltipManager();u.updateData({dataItems:t.dataItems,dataSources:t.dataSources,explorationContract:t.explorationContract,explorationCapabilities:t.explorationCapabilities,visualTooltipData:t.visualTooltipData}),u.updateOptions(n,t.visualHostTooltipActionsProvider),this.customVisuals=$(document).find(".visual-sandbox"),this.move(t,!1),this.delayedTooltipPromise=this.$timeout((function(){t.isTouchEvent&&(i.customVisuals.each((function(e,t){t.addEventListener("pointerdown",i.hideTooltipHandler)})),document.addEventListener("pointerdown",i.hideTooltipHandler));var e=i.tooltipContainer.isVisible();i.showTooltipContainer(),e?i.startLongPause(t.identities):i.delayedTooltipPromise=i.$timeout((function(){i.move(t,!1),i.startLongPause(t.identities)}))}),c)},t.prototype.showTooltipContainer=function(){this.tooltipContainer.show(),this.visualTooltipManager&&(this.visualTooltipManager.updateTooltipShown(!0),this.visualTooltipManager.applyChanges())},t.prototype.hideTooltipContainer=function(){this.tooltipContainer.hide(),this.visualTooltipManager&&this.visualTooltipManager.updateTooltipShown(!1)},t.prototype.move=function(e,t){void 0===t&&(t=!0);var i=this.getClickedArea(e.coordinates,e.isTouchEvent);if(this.tooltipContainer.move(i),t){var r=this.ensureVisualTooltipManager();r.updateData({dataItems:e.dataItems,dataSources:e.dataSources,explorationContract:e.explorationContract,explorationCapabilities:e.explorationCapabilities,visualTooltipData:e.visualTooltipData}),r.applyChanges()}this.startLongPause(e.identities)},t.prototype.hide=function(t){var i,r=this;i=t.immediately?0:t.isTouchEvent?c:s,this.clearTooltipTimeout(),this.delayedTooltipPromise=this.$timeout((function(){r.ensureVisualTooltipManager().updateOptions(!1,void 0),r.hideTooltipContainer(),e.visuals.TooltipManager.ToolTipInstance.hide()}),i),this.longPauseDebounced&&(this.longPauseDebounced.cancel(),this.longPauseDebounced=void 0)},t.prototype.visible=function(){return this.tooltipContainer.isVisible()},t.prototype.container=function(){return this.parentContainer.get(0)},t.prototype.enabled=function(){return e.visuals.TooltipManager.ShowTooltips},t.prototype.onLongPause=function(e){this.longPauseDebounced=void 0},t.prototype.startLongPause=function(e){var t=this;this.longPauseDebounced||(this.longPauseDebounced=_.debounce((function(){return t.onLongPause(e)}),u)),this.longPauseDebounced()},t.prototype.clearTooltipTimeout=function(){null!=this.delayedTooltipPromise&&(this.$timeout.cancel(this.delayedTooltipPromise),this.delayedTooltipPromise=void 0)},t.prototype.getClickedArea=function(t,i){var r=0,o=t[0],n=t[1];if(i){r=d;var a=r/2;o=Math.max(o-a,0),n=Math.max(n-a,0)}return new e.visuals.Rect(o,n,r,r)},t.prototype.ensureVisualTooltipManager=function(){var e=this;if(this.visualTooltipManager)return this.visualTooltipManager;this.visualTooltipManager=new v(this.$compile,this.$rootScope,this.$injector.get("explorationSerializer"),function(){return e.hideTooltipContainer()},function(){e.tooltipContainer.updateContent(null),e.visualTooltipManager=null});var t=this.visualTooltipManager.$element.get(0);return this.tooltipContainer.updateContent(t),this.visualTooltipManager},t})(),v=(function(){function t(e,t,i,r,o){var n=this;this.$rootScope=t,this.explorationSerializer=i;var a=this.scope=t.$new();this.bindings=a,this.bindings.onHide=r,this.$element=e(p)(a),this.currentData={explorationContract:void 0,explorationCapabilities:void 0,dataItems:void 0,dataSources:void 0,visualTooltipData:void 0},this.scope.$on("$destroy",(function(){n.$element.remove(),o()})),this.ensureChangeListener()}return t.prototype.updateData=function(e){void 0===e.dataItems&&void 0===e.dataSources&&void 0===e.explorationContract&&void 0===e.visualTooltipData||(this.currentData={dataItems:void 0!==e.dataItems?e.dataItems:this.currentData.dataItems,dataSources:void 0!==e.dataSources?e.dataSources:this.currentData.dataSources,explorationContract:void 0!==e.explorationContract?e.explorationContract:this.currentData.explorationContract,explorationCapabilities:void 0!==e.explorationCapabilities?e.explorationCapabilities:this.currentData.explorationCapabilities,visualTooltipData:void 0!==e.visualTooltipData?e.visualTooltipData:this.currentData.visualTooltipData})},t.prototype.updateOptions=function(e,t){this.bindings.showActionBar=e,this.bindings.actionsProvider=t,this.scope.$applyAsync()},t.prototype.updateTooltipShown=function(e){this.bindings.tooltipShown=e,this.scope.$applyAsync()},t.prototype.applyChanges=function(){var e=this.currentData;if(void 0!==e.explorationContract&&(e.explorationContract!==this.originalExploration||!this.cachedExploration)){var t=e.explorationContract;this.originalExploration=t,this.cachedExploration=this.explorationSerializer.deepCopyExploration(t)}var i=this.bindings;i.explorationContract===this.cachedExploration&&i.explorationCapabilities===e.explorationCapabilities&&i.tooltipDataSources===e.dataSources&&i.tooltipData===e.visualTooltipData&&i.tooltipDataItems===e.dataItems||(i.explorationContract=this.cachedExploration,i.explorationCapabilities=e.explorationCapabilities,i.tooltipDataSources=e.dataSources,i.tooltipData=e.visualTooltipData,i.tooltipDataItems=e.dataItems,this.ensureChangeListener(),this.scope.$applyAsync())},t.prototype.ensureChangeListener=function(){var t=this;this.deregisterChangeListener||(this.deregisterChangeListener=this.$rootScope.$on(e.common.constants.onReportChangedEventName,(function(e){t.cachedExploration=void 0,t.bindings.explorationContract=void 0,t.bindings.explorationCapabilities=void 0,t.bindings.tooltipData=void 0,t.deregisterChangeListener(),t.deregisterChangeListener=void 0})))},t})()})(i=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){function i(e,t,i,r,o,n,a,s,l){return new c(s,i,t,r,n,l,a,e,o)}var r=e.explore.services.events,o=e.common.dialog.MessageDialogBuilder,n=e.contracts.ResourcePackageItemType,a=e.explore.util.ResourcePackageUtils;t.createImportVisualService=i;var s="/powerbi/content/visual",l=".pbiviz",c=(function(){function t(e,t,i,r,o,n,a,s,l){this.eventBridge=e,this.modalDialogService=t,this.localizationService=i,this.notificationToast=r,this.telemetryService=o,this.visualPluginService=n,this.upload=a,this.localFileService=s,this.promiseFactory=l}return t.prototype.importWithDialog=function(e){var t=this,i=this.promiseFactory.defer();i.promise.then((function(i){return t.handleImport(e,i)})),this.localFileService.chooseLocalFile(i,l)},t.prototype.handleImport=function(t,i){var r=this,o=e.common.httpService.powerbiRequestOptions();o.retryCount=0,o.headers[e.common.constants.uploadFileSizeHeaderName]=i.size.toString(),this.notifyWhenLoadingCustomVisual("ImportCustomVisualLoadingTitle",0,"PleaseWaitUntilReady");var a=this.telemetryService.startEvent(e.telemetry.EXImportCustomViz,i.name,-1,"");this.upload.post(s,[i],o).then((function(e){var i=e.data;null==i.type&&(i.type=0);for(var o=0,s=i.items;o<s.length;o++){var l=s[o];null==l.type&&(l.type=n.CustomVisualJavascript)}r.import(t,i),a.event.info.resourcePackageId=i.id,a.event.info.resourcePackageName=i.name,a.resolve()}),(function(e){r.showImportErrorDialog();var t=e&&e.error?e.error.code:"-1",i={errorCode:"Import of custom visual failed -> code: "+t};a.reject(i)}))},t.prototype.showImportErrorDialog=function(){var e=new o(this.modalDialogService),t=this.localizationService;e.show("ImportVisualError",{titleText:t.get("ImportVisual_ErrorDialogHeader"),messageText:t.get("ImportVisual_ErrorDialogMessage"),okButtonText:t.get("ImportVisual_Close")})},t.prototype.import=function(e,t){var i=this;return this.visualPluginService.ensurePlugins([t],!0).then((function(){a.ensureResourcePackages(e),_.remove(e.resourcePackages,(function(e){return e.name===t.name})),e.resourcePackages.push(t),i.eventBridge.publishToChannel(r.addCustomVisual,t),i.eventBridge.publishToChannel(r.visualPluginsChanged),i.notificationToast.hide(i.toastNotificationId),i.toastNotificationId=void 0}))},t.prototype.notifyWhenLoadingCustomVisual=function(e,t,i){var r=this;this.localizationService.ensureLocalization((function(){r.toastNotificationId=r.notificationToast.notify({title:r.localizationService.get(e),message:r.localizationService.get(i),notificationType:3})}))},t})()})(i=t.services||(t.services={}))})(t=e.exploreui||(e.exploreui={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){function r(e,t,i,r,o){return new v(e,t,i,r,o)}var o=e.explore.contracts.FilterType,n=e.explore.FilterExpressionMetadataUtils,a=e.data.Selector,s=e.data.SemanticFilter,l=e.data.SQExpr,c=e.data.SQExprBuilder,u=e.data.SQExprUtils,p=e.visuals.valueFormatter,d=e.data.VariationRewriter,h=e.explore.util.VisualContainerUtils;i.createIncludeExcludeService=r;var v=(function(){function r(e,t,i,r,o){this.eventBridge=e,this.localizationService=t,this.undoRedoService=i,this.telemetry=r,this.viewModeState=o}return r.prototype.setFilter=function(r,s,l,c){var u,p=this,d=_.map(s,(function(e){return a.convertSelectorsByColumnToSelector(e)})),v=_.find(l.filters,(function(e){return e.howCreated===r})),g=2;c&&l.config&&l.config.singleVisual&&(u=n.getSelectorsMetadata(d,l.config.singleVisual,c)),v||(v={howCreated:r,name:t.FilterUtils.getNextFilterName(l.filters),type:3===r?o.Include:o.Exclude,filterExpressionMetadata:u},g=1);var f=v.filter;3===r?f=this.getIncludeFilter(d):(f=this.getExcludeFilter(f,d),2===g&&(u||v.filterExpressionMetadata)&&(v.filterExpressionMetadata=n.mergeFilterExpressionMetadata(v.filterExpressionMetadata,u))),this.undoRedoService.register("UpdateIncludeExcludeFilter",(function(){v.filter=f;var o={container:l,scopeType:0};1===g&&(t.FilterUtils.add(o.container,v),p.telemetry.logEvent(e.telemetry.EXAddFilter,3===r?"Include":"Exclude","Visual","Entity",h.hasGroupByItemsInQuery(l),t.util.getTelemetryViewMode(p.viewModeState.getMode())));var n={filter:v,changeType:g,scope:o};p.eventBridge.publishToChannel(i.events.filterContainerChanged,n)}))},r.prototype.buildViewModel=function(e,t,i,r,o){for(var n=e?e.where():[],a=[],s=0,l=n;s<l.length;s++){var c=l[s],u=c.condition,p=new g(i,r,o);u.accept(p),a.push.apply(a,p.dataPoints)}return{points:a,filter:e,displayName:this.getDisplayName(t,a.length),restatement:this.getRestatement(a)}},r.prototype.updateFilterContainer=function(e,t){var r=this,o=e.contract,n=o.type,a=this.buildFilter(t,n);this.undoRedoService.register("UpdateIncludeExcludeFilter",(function(){var t=e.getFilterContainerScope();o.filter=a;var n={filter:o,changeType:2,scope:t};r.eventBridge.publishToChannel(i.events.filterContainerChanged,n)}))},r.prototype.isIncludeExcludeSupported=function(e,t,i){if(e&&e.config&&e.config.singleVisual){var r=e.config.singleVisual,o=r.query;if(o){if(i&&t){var n=t.schema(void 0);if(n&&n.capabilities&&n.capabilities.supportsMultiTableTupleFilters)return!0}for(var a=o.defn.select(),s=void 0,c=0,p=a;c<p.length;c++){var h=p[c],v=h.expr;if(!u.isMeasure(v)){v=d.run(v,t);var g=v.getTargetEntity();if(s){if(!l.equals(s,g))return!1}else s=g}}return!0}}return!1},r.prototype.buildFilter=function(t,i){for(var r,n=t.points[0],a=c.inValues(n.columns,[n.values]),s=1;s<t.points.length;s++)n=t.points[s],r=c.inValues(n.columns,[n.values]),a=c.or(a,r);return i===o.Exclude&&(a=c.not(a)),e.data.SemanticFilter.fromSQExpr(a)},r.prototype.getDisplayName=function(e,t){var i=null;return i=e===o.Include?this.localizationService.get("Include_Label"):this.localizationService.get("FilterPane_Exclude"),i+" ("+t+")"},r.prototype.getRestatement=function(e){for(var t=[],i=0,r=e;i<r.length;i++){var o=r[i];t.push(o.text)}return t.join(this.localizationService.get("ListJoin_Separator"))},r.prototype.getIncludeFilter=function(t){var i=a.filterExprsFromSelectors(t);return e.DataViewScopeIdentity.filterFromExprs(i,!1)},r.prototype.getExcludeFilter=function(t,i){var r=a.filterExprsFromSelectors(i);if(t){var o=_.find(t.where(),(function(e){return 16===e.condition.kind}));if(o){for(var n=o.condition,l=n.arg,u=0,p=r;u<p.length;u++){var d=p[u],h=e.data.ScopeIdentityExtractor.getInExpr(d);l=c.or(l,h)}return l=c.not(l),s.fromSQExpr(l)}}return e.DataViewScopeIdentity.filterFromExprs(r,!0)},r})();i.IncludeExcludeService=v;var g=(function(e){function i(t,i,r){var o=e.call(this)||this;return o.schema=t,o.displayName=i,o.metadata=r,o.dataPoints=[],o.isExclude=!1,o}return __extends(i,e),i.prototype.visitNot=function(e){this.isExclude=!0,e.arg.accept(this)},i.prototype.visitOr=function(e){e.left.accept(this),e.right.accept(this)},i.prototype.visitIn=function(e){var r,o=this;if(!_.isEmpty(e.values)){for(var n=[],a=e.args,s=_.map(a,(function(e){return o.displayName.getDisplayName(e,o.schema,null,null,null,{includeVariationSource:!0})})),l=0,c=e.values;l<c.length;l++){var u=c[l],p=s,d=_.map(u,(function(e){return e.value})),h=t.FilterUtils.findValuesInFilterCache(a,u,this.metadata);h&&(p=_.map(h.columns,(function(e){return o.displayName.getDisplayName(e,o.schema,null,null,null,{includeVariationSource:!0})})),d=h.values),n.push({columns:a,values:u,text:i.getDataPointText(p,d)})}(r=this.dataPoints).push.apply(r,n)}},i.getDataPointText=function(e,t){for(var i="",r=0;r<e.length;r++){var o=t[r],n=e[r];i+=p.format(o)+" ("+n+") + "}return i=i.slice(0,i.length-3)},i})(e.data.DefaultSQExprVisitor);i.IncludeExcludeSQExprVisitor=g})(i=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){function t(e,t){return new i(e,t)}e.createIncrementalRefreshPolicyService=t;var i=(function(){function e(e,t){this.modalDialogService=e,this.promiseFactory=t}return e.prototype.setIncrementalRefresh=function(e){var t=this.promiseFactory.defer(),i=this.showIncrementalRefreshDialog(e);t.promise.catch((function(){return i.reject()}))},e.prototype.showIncrementalRefreshDialog=function(e){var t={dialogName:"Incremental Refresh Policy",componentName:"IncrementalRefreshPolicyComponent",bindings:{table:e}};return this.modalDialogService.showHostModalDialog(t)},e})()})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){function t(){return new i(150,150)}e.createLayoutInsertionHelper=t;var i=(function(){function e(e,t){this.emptySpaceMinWidth=e,this.emptySpaceMinHeight=t}return e.prototype.getEmptySpaces=function(e,t){for(var i=this.getNonOverlapingRects(e,t),r=this.filterWithMinimumWidth(i),o=[],n=0,a=r;n<a.length;n++){
var s=a[n],l=this.extendRect(s,i);l.height>=this.emptySpaceMinHeight&&o.push(l)}return o},e.prototype.extendRect=function(e,t){for(var i,r=!1,o=0,n=t;o<n.length;o++){var a=n[o];if(a!==e){var s=!1,l=!1;if(this.doIntersect(a,e)&&(s=a.y+a.height===e.y,l=a.y===e.y+e.height),!(a.width<e.width))if(l){var c={x:e.x,y:e.y,width:e.width,height:e.height+a.height},u=this.getIntersectingRectangle(c,a);u&&u.width===c.width&&(r=!0,i=c)}else if(s){var c={x:e.x,y:a.y,width:e.width,height:e.height+a.height},u=this.getIntersectingRectangle(c,a);u&&u.width===c.width&&(r=!0,i=c)}}}return r?this.extendRect(i,t):e},e.prototype.getIntersectingRectangle=function(e,t){var i=Math.max(e.x,t.x),r=Math.min(e.x+e.width,t.x+t.width),o=Math.max(e.y,t.y),n=Math.min(e.y+e.height,t.y+t.height);return i<=r&&o<=n?{x:i,y:o,width:r-i,height:n-o}:null},e.prototype.doIntersect=function(e,t){return!(t.x>e.x+e.width||t.x+t.width<e.x||t.y>e.y+e.height||t.y+t.height<e.y)},e.prototype.filterWithArea=function(e){for(var t=[],i=0,r=e;i<r.length;i++){var o=r[i];o.width>0&&o.height>0&&t.push(o)}return t},e.prototype.filterWithMinimumWidth=function(e){for(var t=[],i=0,r=e;i<r.length;i++){var o=r[i];o.width>=this.emptySpaceMinWidth&&t.push(o)}return t},e.prototype.splitRectangleOnIntersection=function(e,t){var i=this.getIntersectingRectangle(e,t);return i?this.filterWithArea([{x:e.x,y:e.y,width:e.width,height:i.y-e.y},{x:e.x,y:i.y+i.height,width:e.width,height:e.y+e.height-(i.y+i.height)},{x:e.x,y:i.y,width:i.x-e.x,height:i.height},{x:i.x+i.width,y:i.y,width:e.x+e.width-(i.x+i.width),height:i.height}]):[e]},e.prototype.getNonOverlapingRects=function(e,t){if(!t.length)return[];for(var i=[e],r=0,o=t;r<o.length;r++){for(var n=o[r],a=[],s=0,l=i;s<l.length;s++){var c=l[s];a=a.concat(this.splitRectangleOnIntersection(c,n))}i=a}return i},e})()})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){function t(e,t){return new i(e,t)}e.createManageAggregationsService=t;var i=(function(){function e(e,t){this.modalDialogService=e,this.promiseFactory=t}return e.prototype.manageAggregations=function(e){var t=this.promiseFactory.defer(),i=this.showManageAggregationsDialog(e);t.promise.catch((function(){return i.reject()}))},e.prototype.showManageAggregationsDialog=function(e){var t={dialogName:"Manage aggregations",componentName:"ManageAggregationsComponent",bindings:{table:e}};return this.modalDialogService.showHostModalDialog(t)},e})()})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){function r(e,t,i,r,o,n,a,s){return new p(e,t,i,o,n,a,s)}var o=jsCommon.ArrayExtensions,n=e.data.QueryProjectionsByRole,a=e.visualHost.utils.ResourcePackageUtils,s=e.visualHost.ThemeUtils,l=jsCommon.Trace,c=e.data.dsr.transformDataQueryToSemanticQueryDataShapeCommand,u=t.util.VisualContainerUtils;i.createPinVisualService=r;var p=(function(){function t(e,t,i,r,o,n,a){this.conceptualSchemaProxy=e,this.displayNameService=t,this.dataProxy=i,this.resourcePackagesService=r,this.visualQueryGenerator=o,this.visualPlugin=n,this.filterCapabilitiesService=a}return t.prototype.getPinData=function(t,i,r,o,n,a,l,c,p){var d,h=t.config.singleVisual;if(l){var v=l.options.query.command,g=u.describeForPinning(this.displayNameService,c,h.query,h.columnProperties,this.visualPlugin.capabilities(h.visualType),n?n.filterMetadata:null),f=g.queryMetadata;d={dataTransforms:l.transforms,dataViewSource:a?a.dataViewSource:null,elements:g.visualElements,query:v,queryMetadata:f,themeCollection:s.cloneThemeCollection(o),tileLayoutType:i,visualContainer:t};var y=e.data.DataViewObjectDefinitions.getValue(t.config.singleVisual.vcObjects,{objectName:"title",propertyName:"text"},void 0);y&&y.value?d.tileHeading=y.value:this.setPinDataHeadings(a,f,d)}else d={dataViewSource:{data:void 0},themeCollection:s.cloneThemeCollection(o),tileLayoutType:i,visualContainer:t};var m=this.gatherModelExtensions(r);return m&&(d.modelExtensions=m),this.addResourcePackageIdsToPinData(h.visualType,d,p)},t.prototype.gatherModelExtensions=function(e){var t=_.find(e,(function(e){return"exploration"===e.type}));if(t){var i=t.exploration;if(i)return i.getModelExtensions()}},t.prototype.setPinDataHeadings=function(t,i,r){var o,n,a,s=t&&t.dataViewSource&&t.dataViewSource.data.descriptor;if(s){var l=new e.data.dsr.QueryDescription(i,s);o=l.getMeasureRestatements(),n=l.getFilterRestatements(),a=l.getGroupRestatements()}else{for(var c=[],u=[],p=0,d=i.Select;p<d.length;p++){var h=d[p];3===h.Type||1===h.Type?c.push(h.Restatement):4!==h.Type&&2048!==h.Type||u.push(h.Restatement)}u.length>0&&(a=u),c.length>0&&(o=c)}o?r.tileHeading=this.joinList(o):a&&(r.tileHeading=this.joinList(a)),n&&(r.tileFilterDetails=this.joinList(n)),o&&a&&(r.tileSubDisplay=e.common.localize.format("TileHeadings_By",[this.joinList(a)]))},t.prototype.joinList=function(t){return t.join(e.common.localize.get("ListJoin_Separator"))},t.prototype.pinVisualContainer=function(t,i,r,o,n){var a=this,s=i.config.singleVisual,l=s.visualType,u=this.handler,p=l===e.visuals.plugins.image.name?e.common.contracts.TileLayoutType.Full:e.common.contracts.TileLayoutType.Default;this.conceptualSchemaProxy.get(t).then((function(d){var h;if(a.visualQueryGenerator.shouldExecute(s,t)){var v=e.common.GridLayoutConstants.getDefaultGridItemViewport(e.common.GridLayoutConstants.getMediumLandscapeGridItem());h=a.visualQueryGenerator.execute({config:s,dataSources:t,schema:d,additionalFilters:r,dataWindow:v,ignoreViewportForCache:!0,allowClientSideFilters:!1})}if(h){var g=h.options.query.command,f=c(g);a.modifyPinnedVisualDataShapeBinding(f.Binding,s.query,d,l),a.dataProxy.execute(h.options).then((function(e){var s=a.getPinData(i,p,t,o,r,e,h,d,n);u&&u.pinVisual(s)}),(function(){}))}else{var y=a.getPinData(i,p,t,o,null,null,null,null,n);u&&u.pinVisual(y)}}))},t.prototype.canPinVisualType=function(t){return null!=t&&null!=this.visualPlugin.getPlugin(t)&&!this.filterCapabilitiesService.hasFilterCapabilities(t)&&t!==e.visuals.plugins.basicShape.name},t.prototype.setHandler=function(e){this.handler=e},t.prototype.modifyPinnedVisualDataShapeBinding=function(e,i,r,a){if(e){var s=this.visualPlugin.capabilities(a);if(t.isTableOrMatrix(a))return e.DataReduction||(e.DataReduction={}),void(e.DataReduction.Primary={Window:{Count:100}});if(t.supportsScalarCategoryAxis(s)){var l=i.projections,c=i.defn.select();if(e.DataReduction&&(e.DataReduction.Primary&&e.DataReduction.Primary.BinnedLineSample||e.DataReduction.Intersection&&e.DataReduction.Intersection.BinnedLineSample))return;if(!l||_.isEmpty(c))return;var u="Category",p=n.getRole(l,u);if(!p||_.isEmpty(p.all()))return;var d=p.getLastActiveQueryReference()||p.all()[0].queryRef,h=o.findItemWithName(c,d);if(!h)return;var v=h.expr.getMetadata(r);v&&0===v.kind&&v.type.dateTime&&(e.DataReduction||(e.DataReduction={}),e.DataReduction.Primary={Bottom:{}})}}},t.prototype.addResourcePackageIdsToPinData=function(e,t,i){var r=[];if(this.visualPlugin.isCustomVisual(e)){var o=this.resourcePackagesService.getPackage(e);o&&r.push(o.id)}if(i){var n=t.themeCollection;n.customTheme&&this.addResourcePackageIdIfNeeded(i,n.customTheme.type,(function(e){return e.name===n.customTheme.name}),r),n.baseTheme&&this.addResourcePackageIdIfNeeded(i,n.baseTheme.type,(function(e){return e.name===n.baseTheme.name}),r)}return _.isEmpty(r)||(t.resourcePackageIds=_.uniq(r)),t},t.prototype.addResourcePackageIdIfNeeded=function(e,t,i,r){var o=a.findResourcePackage(e,t);o&&null==o.id&&l.error("Resource package should have an ID"),o&&null!=o.id&&_.find(o.items,i)&&r.push(o.id)},t.supportsScalarCategoryAxis=function(e){return e.objects&&e.objects.categoryAxis&&e.objects.categoryAxis.properties&&void 0!==e.objects.categoryAxis.properties.axisType},t.isTableOrMatrix=function(t){var i=e.visuals.plugins;return t===i.table.name||t===i.matrix.name||t===i.tableEx.name||t===i.pivotTable.name},t})()})(i=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){function i(){return{canShowHiddenSchemaItem:_.noopFalse,canToggleSchemaItems:_.noopTrue,setShowHiddenSchemaItem:_.noop,areScriptVisualsApproved:_.noopTrue,approveScriptVisuals:function(){e.contract.fail("ShellService.approveScriptVisuals is not available in ExploreUI view")},showBookmarksPane:_.noop,showEditQueriesEditor:_.noop,showCanvasItemsPane:_.noop,showSyncSlicersPane:_.noop,showFieldPropertiesPane:_.noop}}t.createShellService=i})(i=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){function r(e,t,i,r,o){return new u(e,t,i,r,o)}var o=e.data.FieldExprPattern,n=t.viewModels.ShowValueAsNoCalculation,a=t.viewModels.ShowValueAsPercentOfGrandTotalCalculation,s=t.viewModels.ShowValueAsPercentOfRoleTotalCalculation,l=e.data.SQExprConverter,c=e.data.SQExprUtils;i.createShowValueAsService=r;var u=(function(){function t(e,t,i,r,o){this.localizationService=e,this.promiseFactory=t,this.telemetryService=i,this.visualAuthoring=r,this.visualPlugin=o}return t.prototype.createShowValueAsMenuItems=function(t,i,r){var c=o.getSchema(l.asFieldPattern(t));if(!i.schema(c).capabilities.supportsScopedEval)return[];var u=[];if(this.aggregateSupportsShowValueAs(t,i)){var p=new n(e.common.localize);u.push(this.showValueAsMenuItemBuilder(p));var d=new a(e.common.localize);u.push(this.showValueAsMenuItemBuilder(d));var h=this.visualPlugin.capabilities(r),v=h&&h.dataRoleTotals;if(!_.isEmpty(v))for(var g=0,f=v;g<f.length;g++){var y=f[g],m=new s(this.localizationService,y.roles,e.data.getDisplayName(y.displayName,this.localizationService));u.push(this.showValueAsMenuItemBuilder(m))}}return u},t.prototype.applyShowValueAs=function(t,i,r){var o=this;this.visualAuthoring.applyShowValueAs(t,i,r).then((function(){return o.telemetryService.logEvent(e.telemetry.EXChangeQuickCalc,o.showValueAsKindToTelemetryId(i.kind),o.showValueAsKindToTelemetryId(r.kind)),o.promiseFactory.resolve()}))},t.prototype.showValueAsMenuItemBuilder=function(e){var t={type:0};return t.key={action:5,showValueAs:e},t.text=e.name,t},t.prototype.aggregateSupportsShowValueAs=function(e,t){var i=e.getMetadata(t);return i&&i.type&&i.type.numeric&&c.isMeasure(e)},t.prototype.showValueAsKindToTelemetryId=function(e){switch(e){case void 0:return"None";case 0:return"PercentOfGrandTotal";case 1:return"PercentOfRoleTotal"}},t})()})(i=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){function i(e,t,i,r){return new o(e,r)}var r=e.common.models.CollapsiblePaneExpandedWidth;t.createSubscriptionPaneService=i;var o=(function(){function e(e,t){this.taskPaneSliderService=e,this.featureSwitchService=t,this.collapsiblePaneWidth=this.featureSwitchService.featureSwitches.scheduledSubscriptionUI?r.Large:r.Small}return e.prototype.expandPaneForReportSubscription=function(e,t){this.taskPaneSliderService.isPaneExpanded()||(this.info={reportInfo:e},this.currentSubscriptionGUID=t,this.taskPaneSliderService.expandPane(15,this.collapsiblePaneWidth))},e.prototype.expandPaneForDashboardSubscription=function(e,t){this.info={dashboardInfo:e},this.currentSubscriptionGUID=t,this.taskPaneSliderService.expandPane(15,this.collapsiblePaneWidth)},e.prototype.collapseSubscriptionPane=function(){this.taskPaneSliderService.isPaneExpanded()&&(this.taskPaneSliderService.collapsePane(),this.currentSubscriptionGUID=void 0)},e.prototype.getInfo=function(){return this.info},e.prototype.getCurrentSubscriptionGUID=function(){return this.currentSubscriptionGUID},e})()})(i=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){function i(e,t){return new o(e,t)}t.createSvgProvider=i;var r;!(function(e){e.container="svgProviderContainer"})(r=t.svgProviderClassName||(t.svgProviderClassName={}));var o=(function(){function t(e,t){this.$http=e,this.promiseFactory=t;var i=$("#"+r.container);0===i.length?(this.svgContainer=$("<div id='"+r.container+'\' style="display: none;"></div>'),$("body").append(this.svgContainer)):this.svgContainer=i}return t.prototype.loadSheet=function(e){var t=this.promiseFactory.defer(),i=this.getSheetId(e);if(this.svgContainer.find("#"+i).length)t.resolve(void 0);else{var r=$('<div id="'+i+'"></div>');this.svgContainer.append(r);var o=this.getSVGResourceUri(e);this.$http.get(o).then((function(e){e&&e.data&&r.append(e.data),t.resolve(i)}),(function(e){r.remove(),t.reject(e)}))}return t.promise},t.prototype.getSheetId=function(e){return"svgProvider-"+e},t.prototype.getSVGResourceUri=function(t){return e.common.httpService.getVersionedResourceUri("/images")+"/"+t+".svg"},t})();t.SvgProvider=o})(i=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){function i(e,t,i){return new a(e,t,i)}var r="uicomponents",o="ColorPicker",n={javascript:"uiComponents"};t.createUIComponentService=i;var a=(function(){function e(e,t,i){this.$compile=e,this.moduleLoader=t,this.promiseFactory=i}return e.prototype.getUIComponentFactory=function(e){return new s(e,this.$compile,this.moduleLoader,this.promiseFactory)},e})(),s=(function(){function t(e,t,i,r){this.$scope=e,this.$compile=t,this.moduleLoader=i,this.promiseFactory=r}return t.prototype.createColorPicker=function(t,i,a,s){return __awaiter(this,void 0,e.Promise,(function(){var l,c=this;return __generator(this,(function(u){return l=this.promiseFactory.defer(),this.moduleLoader.require(n).then((function(){var n=e[r][o],u=new n(c.$scope,c.$compile,t,i,a,s);l.resolve(u)})),[2,l.promise]}))}))},t})()})(i=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){function t(){return new n}function i(){return{supportsPinning:void 0,supportsDeletion:void 0,enablePenAnnotation:!1,visualDoubleClickEnabled:!1,displayOptions:{canShowCanvasWatermark:!1,showVisualBordersInViewMode:!1,hideVisualizationPane:!1,hideTileMenu:!1,hideNavigationPane:!1,disableFadeout:!1,showMobilePane:!1,hideInFocusBar:!1,hideInFocusTileMenu:!1,visualMouseoverDisabled:!1,hideCanvasSwipeHandles:!1,extendBackgroundToWholeCanvas:!1,hideOutspaceFormatting:!1,hideOutspaceImage:!1,hideBackgroundImage:!1,showVisualAccessibleData:!1,showDetailVisualOnFullScreen:!1,disableSpotlight:!1,enableTooltipActions:!1,showDrillthroughFilters:!1,useMobileFilterConfiguration:!1},touchOptions:{deselectVisualOnCanvasScroll:!1,disableCanvasScrollOnSelectedVisual:!1,disableTouchZoom:!1,isCanvasSwipeable:!1,swipeOnlyFromEdge:!1,swipeEdgeThreshold:void 0,touchEventsOnSelectedVisualOnly:!1,disableCanvasPinch:!1,disableTouchendOnTooltip:!1},penProperties:{strokeStyle:r.DefaultPenStrokeStyle,lineWidth:r.DefaultPenLineWidth,opacity:r.DefaultPenOpacity},printProperties:{containerPixelPadding:40,useSectionDisplayOption:!1}}}var r,o=jsCommon.FreezeUtility;!(function(e){e.DefaultPenStrokeStyle="#939598",e.DefaultPenLineWidth=20,e.DefaultPenOpacity=1})(r=e.annotations||(e.annotations={})),e.createViewModeState=t;var n=(function(){function e(){this.config=i(),this.freeze(),this.state={}}return e.prototype.getViewState=function(){return this.state},e.prototype.getConfig=function(){return this.frozenConfig},e.prototype.updateConfig=function(e){e&&(e(this.config),this.config.displayOptions.showMobilePane&&(this.state.bookmarkView=void 0),this.freeze())},e.prototype.getMode=function(){return this.mode},e.prototype.setMode=function(e){this.mode=e},e.prototype.freeze=function(){var e=_.cloneDeep(this.config);o.deepFreeze(e),this.frozenConfig=e},e})()})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){function r(e,t,i,r,o,n,a,s,l,c,u,p,d,v,g,f,y,m,S,w,C){return new h(e,t,i,r,o,n,a,s,l,c,u,p,d,v,g,f,y,m,S,w,C)}var o=e.data.CacheOptions,n=e.common,a=e.data.segmentation.DataViewMerger,s=e.data.services.DataViewTransformActionsSerializer,l=e.data.dsr,c=e.visualHost.ResourcePackageReferenceResolver,u=e.explore.util.ResourcePackageUtils,p=e.visualHost.utils.ResourcePackageUtils,d=t.util.VisualContainerUtils;i.createVisualContainerQueryHandler=r;var h=(function(){function r(e,i,r,o,n,a,s,l,c,u,p,d,h,v,g,f,y,m,S,w,C){this.queryExecutionServices=e,this.hostServices=i,this.promiseFactory=r,this.conceptualSchemaProxy=o,this.featureSwitchService=n,this.visualQueryGenerator=s,this.visualPlugin=l,this.visualPluginOps=c,this.embedModeService=d,this.filterGenerator=h,this.scriptVisuals=v,this.displayNameService=g,this.explorationNavigation=f,this.resourceLoader=y,this.eventBridge=m,this.shell=S,this.dataProxyService=w,this.resourceRegistration=C,this.visualDataProxyExecutionService=t.services.createVisualDataProxyExecutionService(r,o,n,a,s,l,c,u,w,p,this.embedModeService)}return r.prototype.getDatasetCacheOptions=function(e){return this.featureSwitchService.featureSwitches.enableQueryCaching&&e.initialLoad?o.AllowCache|o.AllowQuery|o.CacheResult:void 0},r.prototype.runQuery=function(e){var t=this,i=this.queryExecutionServices.getDataSources(),r=e.contract;if(this.shouldBlockVisualQuery(r)||!this.visualQueryGenerator.shouldExecute(r.config.singleVisual,i))return!1;var o;!e.initialLoad&&this.hostServices&&this.updateCachedData(e);var n=this.getDatasetCacheOptions(e),a=this.visualDataProxyExecutionService.runQuery({dataSources:i,contract:r,viewport:e.viewport,hostServices:this.hostServices,initialLoad:e.initialLoad,useVisualContainerCache:e.useVisualContainerCache,preferCurrentData:e.preferCurrentData,allowCache:e.allowCache,cacheResponseOnServer:e.cacheResponseOnServer,cacheOptions:n,generatedQuery:o}),s=r.config.singleVisual.visualType,l=r.config.singleVisual.objects,c=this.loadResourcePackageReferences(s,l);e.geocodingTracker&&e.geocodingTracker.newQuery(),this.queryExecutionServices.notifyStart();var u=!1;return a.previewPromise.then((function(e){e&&!u&&t.resolveResourcePackageReferences(s,e.dataProxyQuery.transforms.objects).then((function(i){t.handleQueryResult(r,e.result,e.dataProxyQuery,i)}))})),a.finalPromise.then((function(i){c.then((function(){var o;i&&(o={updateContractCache:!0,updateServerCache:i.updateServerVisualContainerCache},t.resolveResourcePackageReferences(s,i.dataProxyQuery.transforms.objects).then((function(n){t.handleQueryResult(r,i&&i.result,i.dataProxyQuery,n,o,e.currentData)})))}))}),(function(e){t.queryExecutionServices.handleErrors(e)})).finally((function(){u=!0,t.queryExecutionServices.notifyEnd()})),!0},r.prototype.getCachedQueryOrGenerate=function(t){return __awaiter(this,void 0,e.Promise,(function(){var e,i;return __generator(this,(function(r){switch(r.label){case 0:return(e=this.dataProxyService.lastExecutedQuery())?(this.cachedQueryResult=void 0,[2,e]):(i=this.cachedQueryResult,i?[3,2]:[4,this.generateQuery(t)]);case 1:i=r.sent(),r.label=2;case 2:return[2,i]}}))}))},r.prototype.generateQuery=function(t){return __awaiter(this,void 0,e.Promise,(function(){var e,i,r,o;return __generator(this,(function(n){switch(n.label){case 0:return e=this.queryExecutionServices.getDataSources(),[4,this.conceptualSchemaProxy.get(e)];case 1:return i=n.sent(),r={dataSources:e,schema:i,config:t.contract.config.singleVisual,hostServices:this.hostServices,visualQueryGenerator:this.visualQueryGenerator,isLoadMore:!1,preferCurrentData:null==t.preferCurrentData||t.preferCurrentData,viewport:t.viewport,allowCache:null==t.allowCache||t.allowCache,cacheOptions:void 0},o=this.visualDataProxyExecutionService.generateQuery(r),this.dataProxyService.lastExecutedQuery()?this.cachedQueryResult=void 0:this.cachedQueryResult=o,[2,o]}}))}))},r.prototype.updateCachedData=function(t){return __awaiter(this,void 0,e.Promise,(function(){var e,i,r;return __generator(this,(function(o){switch(o.label){case 0:return[4,this.generateQuery(t)];case 1:return e=o.sent(),i=t.contract,e&&!e.error&&i.cachedData?(i.cachedData.dataUpdatedTime=void 0,r=this.visualPlugin.capabilities(i.config.singleVisual.visualType),i.cachedData.transformsObject=s.serializeDataViewTransformActions(e.transforms,r.objects),i.cachedData.queryObject=e.options.query.command,i.cachedData.dataObject=void 0,[2]):[2]}}))}))},r.prototype.loadMoreData=function(e){var t=this;this.queryExecutionServices.notifyStart(),this.getNextDataSegment(e).then((function(i){i&&t.mergeMoreData(i.result,i.dataProxyQuery,e.currentData)})).finally((function(){t.queryExecutionServices.notifyEnd()}))},r.prototype.getNextDataSegment=function(e){var t=this,i=this.promiseFactory.defer();return this.visualDataProxyExecutionService.canLoadMoreData()?this.visualDataProxyExecutionService.loadMoreData({dataSources:this.queryExecutionServices.getDataSources(),contract:e.contract,hostServices:this.hostServices,viewport:e.viewport,useVisualContainerCache:e.useVisualContainerCache}).then((function(e){t.handleLoadMoreDataWarnings(e&&e.result,e&&e.dataProxyQuery),i.resolve(e)}),(function(e){t.queryExecutionServices.handleErrors(e),i.reject(e)})):i.reject("Cannot load more data"),i.promise},r.prototype.reloadDataSegment=function(e,t){var i=e.currentData&&e.currentData.dataView&&e.currentData.dataView.matrix&&e.currentData.dataView.matrix.rows&&e.currentData.dataView.matrix.rows.root;if(!i)return void this.runQuery(e);var r=this.dataProxyService.getNodeSegment(t);if(!r||0===r.index)return void this.runQuery(e);this.dataProxyService.discardSegmentsFrom(r.index);var o=this.dataProxyService.getLastNodeIndex();a.pruneTree(i,o)?this.loadMoreData(e):this.runQuery(e)},r.prototype.mergeMoreData=function(e,t,i){var o=r.getDataProxyQueryExecutionResultWarnings(e,t),n=e&&e.dataReaderResult?e.dataReaderResult.dataView:null;if(n){var s=i.dataView;a.mergeDataViews(s,n);var l={dataView:s,dataViewSource:e&&e.dataViewSource,isFirstSegment:!1};_.isEmpty(o)||(l.warnings=o),this.queryExecutionServices.loadMergedData(l)}},r.prototype.visualizeDataViewSource=function(e,t,i){var r=this,o=e.config.singleVisual,a=this.visualPluginOps.targetedDataViewKinds(o.visualType,this.featureSwitchService,o.query),s=l.read(a,t.data,n.utils.getDsrReaderSwitches(this.featureSwitchService.featureSwitches)),c=s.error;if(c)return void this.queryExecutionServices.handleErrors(c);var u=this.queryExecutionServices.getDataSources(),p=e&&e.config&&e.config.singleVisual;u&&p&&this.conceptualSchemaProxy.get(u).then((function(o){var n=r.visualQueryGenerator.execute({config:p,dataSources:u,schema:o,additionalFilters:r.hostServices.getFilters(r.filterGenerator,o),restartToken:s.restartToken,dataWindow:i});if(n){var a=r.promiseFactory.defer();a.resolve(n.options),r.handleQueryResult(e,{dataViewSource:t,dataReaderResult:s},{transforms:n.transforms,error:n.error,warnings:n.warnings,options:a.promise},null,{updateContractCache:!0})}}))},r.prototype.updateNonQueryVisual=function(e,t){var i=this,r={dataView:null,dataViewSource:null};if(t){var o=e.config.singleVisual.visualType,n=e.config.singleVisual.objects;this.queryExecutionServices.notifyStart(),this.resolveResourcePackageReferences(o,n).then((function(e){i.queryExecutionServices.applyUpdate(r,t,e)})).finally((function(){i.queryExecutionServices.notifyEnd()}))}else this.queryExecutionServices.applyUpdate(r,t,null)},r.prototype.updateContractCache=function(t,i,r){var o=this;if(!t)return this.promiseFactory.reject(null);var n=this.queryExecutionServices.getDataSources();if(!n)return this.promiseFactory.reject(null);var a=t.cachedData&&t.cachedData.dataUpdatedTime?t.cachedData.dataUpdatedTime:null,s=i&&i.dataViewSource?i.dataViewSource.data:void 0,l=r&&r.error;return i&&i.dataReaderResult&&i.dataReaderResult.disallowPersisting&&(a=null,s=null,l=new e.IgnorableClientError),this.conceptualSchemaProxy.get(n).then((function(e){return r.options.then((function(i){var n={transforms:r.transforms,error:l,warnings:r.warnings,options:i,compiledMappings:r.compiledMappings};t.cachedData=d.createCacheEntry(o.visualPlugin,o.displayNameService,s,n,e,t.config.singleVisual,o.filterGenerator.generateFilterMetadata(t.filters),a)}))}))},r.prototype.handleQueryResult=function(e,t,o,n,a,s){var l=this;void 0===a&&(a={}),this.queryExecutionServices.clearErrors();var c=r.getDataProxyQueryExecutionResultWarnings(t,o);c&&this.queryExecutionServices.handleWarnings(c,o.transforms);var u;if(t){u={dataView:t&&t.dataReaderResult?t.dataReaderResult.dataView:null,dataViewSource:t&&t.dataViewSource?t.dataViewSource:null},c&&(u.warnings=c);var p=d.isSegment(u.dataView);p&&(u.isFirstSegment=p)}else u={dataView:s&&s.dataView,dataViewSource:s&&s.dataViewSource};if(this.queryExecutionServices.applyUpdate(u,o.transforms,n),a.updateContractCache){var h=t&&t.dataViewSource?t.dataViewSource.data:void 0,v=this.updateContractCache(e,h,o);a.updateServerCache&&v.then((function(){o.options.then((function(t){var r=e.id,o={visualContainerId:r,query:JSON.stringify(t.query.command),dataTransforms:l.getCachedTransformsString(e)};l.eventBridge.publishToChannel(i.events.newQueryCacheResultAvailable,o)}))}))}},r.prototype.handleLoadMoreDataWarnings=function(e,t){this.queryExecutionServices.clearErrors();var i=r.getDataProxyQueryExecutionResultWarnings(e,t);i&&this.queryExecutionServices.handleWarnings(i,t.transforms)},r.prototype.getCachedTransformsString=function(e){if(e.cachedData){var t=e.cachedData.transformsObject;if(t)return s.serializeTransformActions(t)}},r.prototype.shouldBlockVisualQuery=function(t){var r=this.explorationNavigation.getCurrentExploration(),o=r&&r.reportId,n=d.getVisualType(t),a=e.explore.util.ScriptVisualsUtil.getScriptVisualType(n);return!(!d.isScriptVisual(t,this.visualPlugin)||this.shell.areScriptVisualsApproved()&&!this.scriptVisuals.shouldBlockScriptVisual(a,o))&&(this.eventBridge.publishToChannel(i.events.visualContainerQueryBlocked,{visualType:n}),!0)},r.prototype.loadResourcePackageReferences=function(e,t){var i=this,r=this.visualPlugin.capabilities(e),o=r&&r.objects,n=this.explorationNavigation.getCurrentExploration();return c.loadFromDataViewObjects(t,o,(function(){return n?n.resourcePackages:null}),this.resourceLoader,this.promiseFactory,(function(e,t){return i.ensureSharedResource(n,e,t)}))},r.prototype.ensureSharedResource=function(e,t,i){if(this.resourceRegistration){var r=u.ensureResourcePackageType(e,2);p.findItemInPackage(r,t)||this.resourceRegistration.add(t,2,i)}},r.prototype.resolveResourcePackageReferences=function(e,t){var i=this.visualPlugin.capabilities(e),r=i&&i.objects,o=this.explorationNavigation.getCurrentExploration();return c.loadAndResolveFromDataViewObjects(t,r,o?o.resourcePackages:null,this.resourceLoader,this.promiseFactory)},r.getDataProxyQueryExecutionResultWarnings=function(e,t){return t&&!_.isEmpty(t.warnings)?t.warnings:e&&e.dataReaderResult&&!_.isEmpty(e.dataReaderResult.warnings)?e.dataReaderResult.warnings:void 0},r})();i.VisualContainerQueryHandler=h})(i=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){function i(e,t){return new n(e,t)}var r=e.data.DataViewQueryEngine,o=e.explore.util.VisualContainerUtils;t.createVisualContainerDataSelectionService=i;var n=(function(){function e(e,t){this.visualContainer=e,this.visualPluginOps=t}return e.prototype.getSelectedValues=function(e){var t=o.getVisualType(this.visualContainer.contract),i=o.getVisualQuery(this.visualContainer.contract),n=this.visualPluginOps.dataViewKinds(t,i);return r.query(this.getDataViews(),e,n)},e.prototype.getDataViews=function(){var e=this.visualContainer&&this.visualContainer.getRunningVisual();return e&&e.getDataViews()},e})();t.VisualContainerDataSelectionService=n})(i=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){function r(e,t,i,r,o,n,s,l,c,u,p,d,h,v,g,f,y,m,S,w,C,b,x,F,D,V,M){return new a(e,t,i,r,o,l,c,u,p,n,d,C,h,v,g,s,f,x,m,b,w,y,S,F,D,V,M)}var o=t.components.VisualContainerContextMenu,n=(function(){function t(e,t,i,r,o,n){this.defaultTitleKey=e,this.selectors=t,this.glyph=i,this.commandDisplayOption=r,this.selected=o,this.customIcon=n}return t.prototype.title=function(e){return e&&this.defaultTitleKey?e.get(this.defaultTitleKey):this.defaultTitleKey},t.prototype.execute=function(){return __awaiter(this,void 0,e.Promise,(function(){return __generator(this,(function(e){return[2]}))}))},t.prototype.isVisible=function(){return __awaiter(this,void 0,e.Promise,(function(){return __generator(this,(function(e){return[2,2!==this.commandDisplayOption]}))}))},t.prototype.isDisabled=function(){return __awaiter(this,void 0,e.Promise,(function(){return __generator(this,(function(e){return[2,1===this.commandDisplayOption]}))}))},t.prototype.getChildren=function(){return __awaiter(this,void 0,e.Promise,(function(){return __generator(this,(function(e){return[2,null]}))}))},t})();i.VisualContainerMenuCommand=n,i.createVisualContainerMenuFactoryService=r;var a=(function(){function t(e,t,i,r,o,n,a,s,l,c,u,p,d,h,v,g,f,y,m,S,w,C,b,x,F,D,V){this.conceptualSchemaProxy=e,this.clipboard=t,this.dataSources=i,this.drill=r,this.expandCollapse=o,this.dropdown=n,this.eventBridge=a,this.explorationCapabilities=s,this.explorationNavigation=l,this.explorationExtensibility=c,this.featureSwitchService=u,this.filterGenerator=p,this.groupAuthoring=d,this.includeExcludeService=h,this.lazyScoped=v,this.lazyScopedSync=g,this.localizationService=f,this.pluginOps=y,this.promiseFactory=m,this.telemetryService=S,this.viewModeState=w,this.visibility=C,this.visualAuthoring=b,this.overlayService=x,this.formFactor=F,this.undoRedo=D,this.visualPlugin=V}return t.prototype.createMenu=function(t,i,r,n,a,s,l){return __awaiter(this,void 0,e.Promise,(function(){var e,c;return __generator(this,(function(u){switch(u.label){case 0:return[4,this.createCommands(t,i,r,n,a,s,l)];case 1:return e=u.sent(),c=new o(this.localizationService,this.explorationCapabilities,this.dropdown),[4,c.create(e,i.position)];case 2:return u.sent(),[2,c]}}))}))},t.prototype.createOptionsMenu=function(t,i,r,n,a){return __awaiter(this,void 0,e.Promise,(function(){var e,s;return __generator(this,(function(l){switch(l.label){case 0:return e=this.createOptionsCommands(t,i,r,n),s=new o(this.localizationService,this.explorationCapabilities,this.dropdown,(!0)),[4,s.create(e,void 0,a)];case 1:return l.sent(),[2,s]}}))}))},t.prototype.createDrillthroughMenu=function(t,i,r,n,a){return __awaiter(this,void 0,e.Promise,(function(){var e,s;return __generator(this,(function(l){switch(l.label){case 0:return e=this.createDrillthroughCommands(t,i,r,n,a),s=new o(this.localizationService,this.explorationCapabilities,this.dropdown),[4,s.create([e],r)];case 1:return l.sent(),[2,s]}}))}))},t.prototype.createDrillthroughCommands=function(e,t,r,o,n){var a=this.explorationExtensibility.getCommandsDisplayOptions(e.name);return new i.DrillthroughCommandCollection(e,t,"ModeOn",this.conceptualSchemaProxy,o,this.dataSources,this.drill,this.explorationNavigation,this.lazyScoped,this.lazyScopedSync,this.pluginOps,n,this.telemetryService,(void 0),a)},t.prototype.createOptionsCommands=function(e,t,r,o){var n=this.explorationNavigation.getCurrentExploration().settings,a=this.explorationExtensibility.getCommandsDisplayOptions(e.contract.name),s=[new i.ToggleSearchCommand(e,this.filterGenerator,this.overlayService,this.undoRedo,this.visualAuthoring,this.visualPlugin,r,a),new i.EnterAdvancedEditModeCommand(e,this.eventBridge,this.overlayService,t,r,a),new i.ExportVisualDataCommand(e,this.conceptualSchemaProxy,this.dataSources,this.eventBridge,this.filterGenerator,this.overlayService,r,n,a),new i.SeeDataCommand(e.contract,this.drill,this.visibility,this.pluginOps,(!0),this.viewModeState,a),new i.DeleteVisualContainerCommand(e,this.eventBridge,this.undoRedo,r,a),new i.GetClustersCommand(e,this.eventBridge,t,r,a),new i.GetSpatialClustersCommand(e,this.eventBridge,t,r,a),new i.ToggleSpotlightCommand(e,this.visibility,r,a),new i.SortDescendingCommand(t,e,this.eventBridge,this.overlayService,r,a),new i.SortAscendingCommand(t,e,this.eventBridge,this.overlayService,r,a),new i.SortByCommandCollection(t,e,this.eventBridge,this.overlayService,r,a)];
return this.getCustomCommands(s,"visualOptionsMenu",e.contract,o,void 0,a)},t.prototype.createCommands=function(t,r,o,n,a,s,l){return __awaiter(this,void 0,e.Promise,(function(){var e,c,u,p,d,h,v,g,f;return __generator(this,(function(y){switch(y.label){case 0:return e=r.data,c=r.dataRoles,u=r.nodeIndex,p=r.position,d=[],h=this.explorationExtensibility.getCommandsDisplayOptions(t.name),[4,this.conceptualSchemaProxy.get(this.dataSources.get())];case 1:return v=y.sent().schema(void 0),this.expandCollapse.isSupported(v&&v.capabilities,t,c)&&this.expandCollapse.isEnabled(t,c)&&(g=this.expandCollapse.getAllowedActions(t,c,e),g&&(d.push(new i.ExpandCollapseCommandsCollection(g,(!1),e,c,u,a,h)),d.push(new i.ExpandCollapseCommandsCollection(g,(!0),e,c,u,a,h)))),d.push(new i.DrillDownCommand(t,e,c,this.dataSources,this.drill,this.visualAuthoring,(void 0),h),new i.DrillToDetailsCommand(t,e,this.drill,this.dataSources,this.lazyScopedSync,h),new i.DrillDownLevelWithoutCurrentGroupCommand(t,c,this.visualAuthoring,this.drill,h),new i.DrillDownLevelWithCurrentGroupCommand(t,c,this.visualAuthoring,this.drill,h),new i.DrillUpCommand(t,e,c,this.drill,this.visualAuthoring,(void 0),h),new i.SeeDataCommand(t,this.drill,this.visibility,this.pluginOps,(void 0),(void 0),h),new i.CreateGroupCommand(t,e,this.conceptualSchemaProxy,this.dataSources,this.featureSwitchService,this.groupAuthoring,this.promiseFactory,h),new i.IncludeCommand(t,e,this.conceptualSchemaProxy,this.dataSources,this.featureSwitchService,this.includeExcludeService,this.promiseFactory,l,h),new i.ExcludeCommand(t,e,this.conceptualSchemaProxy,this.dataSources,this.featureSwitchService,this.includeExcludeService,this.promiseFactory,l,h),new i.DrillthroughCommandCollection(t,e,"ContextMenu",this.conceptualSchemaProxy,o,this.dataSources,this.drill,this.explorationNavigation,this.lazyScoped,this.lazyScopedSync,this.pluginOps,n,this.telemetryService,(void 0),h),new i.InsightsAnalysisCommandsCollection(t,e,p,this.conceptualSchemaProxy,this.dataSources,this.dropdown,this.eventBridge,this.explorationCapabilities,this.explorationNavigation,this.featureSwitchService,this.lazyScoped,this.viewModeState,n,h)),f=new i.CopyCommandsCollection(t,this.clipboard,this.telemetryService,this.featureSwitchService,this.visibility,r,h),f.commandsCount>0&&d.push(f),[2,this.getCustomCommands(d,"visualContextMenu",t,e,s,h)]}}))}))},t.prototype.getCustomCommands=function(e,t,r,o,n,a){var s=this.explorationExtensibility.getCommandExtension();if(!_.isEmpty(s)){var l=_.filter(s,(function(e){return e.extend&&e.extend[t]}));if(!_.isEmpty(l))for(var c=0,u=l;c<u.length;c++){var p=u[c],d=new i.ExtensionCommand(r,o,p.name,p.extend[t].title||p.title,this.eventBridge,this.explorationExtensibility,p.extend[t].icon||p.icon,n,a);1===p.extend[t].menuLocation?e.unshift(d):e.push(d)}}return e},t})()})(i=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=jsCommon.EnumExtensions,o=e.data.Selector,n=(function(t){function i(e,i,r,o,n,a,s,l){var c=t.call(this,s||"DrillDown",i,"pbi-glyph-drilldowndisabled",l&&l.drill)||this;return c.visualContainer=e,c.roles=r,c.dataSources=o,c.drill=n,c.visualAuthoring=a,c}return __extends(i,t),i.prototype.execute=function(){return __awaiter(this,void 0,e.Promise,(function(){return __generator(this,(function(e){return _.isEmpty(this.selectors)?[2]:(this.visualAuthoring.drillDown(this.selectors,this.visualContainer,this.dataSources.get(),_.head(this.roles)),[2])}))}))},i.prototype.isVisible=function(){return __awaiter(this,void 0,e.Promise,(function(){var e,i,o,n;return __generator(this,(function(a){switch(a.label){case 0:return e=_.isEmpty(this.selectors),e?[3,2]:[4,t.prototype.isVisible.call(this)];case 1:e=!a.sent(),a.label=2;case 2:return e?[2,!1]:(i=this.drill.getSupportedDrillDirections(this.visualContainer,_.head(this.roles)),o=r.hasFlag(i,4),n=r.hasFlag(i,2),[2,o||n])}}))}))},i})(i.VisualContainerMenuCommand);i.DrillDownCommand=n;var a=(function(t){function i(e,i,r,o,n,a,s){var l=t.call(this,a||"DrillUp",void 0,"pbi-glyph-drillup",s&&s.drill)||this;return l.visualContainer=e,l.roles=r,l.drill=o,l.visualAuthoring=n,l}return __extends(i,t),i.prototype.execute=function(){return __awaiter(this,void 0,e.Promise,(function(){return __generator(this,(function(e){return this.visualAuthoring.drillUp(_.head(this.roles),this.visualContainer),[2]}))}))},i.prototype.isVisible=function(){return __awaiter(this,void 0,e.Promise,(function(){var e,i;return __generator(this,(function(o){switch(o.label){case 0:return[4,t.prototype.isVisible.call(this)];case 1:return o.sent()?(e=this.drill.getSupportedDrillDirections(this.visualContainer,_.head(this.roles)),i=r.hasFlag(e,1),[2,i]):[2,!1]}}))}))},i})(i.VisualContainerMenuCommand);i.DrillUpCommand=a;var s=(function(t){function i(e,i,r,o,n,a){var s=t.call(this,e,void 0,void 0,a&&a.drill)||this;return s.visualContainer=i,s.roles=r,s.drillDirection=o,s.visualAuthoring=n,s}return __extends(i,t),i.prototype.execute=function(){return __awaiter(this,void 0,e.Promise,(function(){return __generator(this,(function(e){return this.visualAuthoring.drillDownLevel(_.head(this.roles),this.visualContainer,this.drillDirection),[2]}))}))},i})(i.VisualContainerMenuCommand);i.DrillDownLevelCommand=s;var l=(function(t){function i(e,i,r,o,n){var a=t.call(this,"DrillDownLevel",e,i,3,r,n)||this;return a.drill=o,a}return __extends(i,t),i.prototype.isVisible=function(){return __awaiter(this,void 0,e.Promise,(function(){var e,i;return __generator(this,(function(o){switch(o.label){case 0:return[4,t.prototype.isVisible.call(this)];case 1:return o.sent()?(e=this.drill.getSupportedDrillDirections(this.visualContainer,_.head(this.roles)),i=r.hasFlag(e,4),[2,i]):[2,!1]}}))}))},i})(s);i.DrillDownLevelWithoutCurrentGroupCommand=l;var c=(function(t){function i(e,i,r,o,n){var a=t.call(this,"DrillDownLevelGrouped",e,i,2,r,n)||this;return a.drill=o,a}return __extends(i,t),i.prototype.isVisible=function(){return __awaiter(this,void 0,e.Promise,(function(){var e,i;return __generator(this,(function(o){switch(o.label){case 0:return[4,t.prototype.isVisible.call(this)];case 1:return o.sent()?(e=this.drill.getSupportedDrillDirections(this.visualContainer,_.head(this.roles)),i=r.hasFlag(e,2),[2,i]):[2,!1]}}))}))},i})(s);i.DrillDownLevelWithCurrentGroupCommand=c;var u=(function(t){function i(e,i,r,o,n,a){var s=t.call(this,"DrillToDetails",i,void 0,a&&a.drill)||this;return s.visualContainer=e,s.drill=r,s.dataSources=o,s.lazyScopedSync=n,s}return __extends(i,t),i.prototype.execute=function(){return __awaiter(this,void 0,e.Promise,(function(){var e;return __generator(this,(function(t){return _.isEmpty(this.selectors)?[2]:(e=this.dataSources.get(),this.lazyScopedSync("drillToDetails").drillToDetails(this.selectors,this.visualContainer,e),[2])}))}))},i.prototype.isVisible=function(){return __awaiter(this,void 0,e.Promise,(function(){var e,i;return __generator(this,(function(r){switch(r.label){case 0:return e=_.isEmpty(this.selectors),e?[3,2]:[4,t.prototype.isVisible.call(this)];case 1:e=!r.sent(),r.label=2;case 2:return e?[2,!1]:(i=this.drill.canDrillToDetails(this.visualContainer,this.selectors),[2,i])}}))}))},i})(i.VisualContainerMenuCommand);i.DrillToDetailsCommand=u;var p=(function(t){function i(e,i,r,o,n,a,s){var l=t.call(this,i?"Collapse":"Expand",r,void 0,s&&s.expandCollapse)||this;return l.allowedActions=e,l.isCollapse=i,l.roles=o,l.nodeIndex=n,l.childCommands=[new d(l.isCollapse,l.allowedActions,l.selectors,l.roles,l.nodeIndex,a,s),new h(l.isCollapse,l.allowedActions,l.selectors,l.roles,l.nodeIndex,a,s),new v(l.isCollapse,l.allowedActions,l.selectors,l.roles,l.nodeIndex,a,s)],l}return __extends(i,t),i.prototype.isDisabled=function(){return __awaiter(this,void 0,e.Promise,(function(){return __generator(this,(function(e){switch(e.label){case 0:return this.isCollapse?[4,t.prototype.isDisabled.call(this)]:[3,2];case 1:return[2,e.sent()||!(this.allowedActions.collapseHierarchy||this.allowedActions.collapseLevel||this.allowedActions.collapseNode)];case 2:return[4,t.prototype.isDisabled.call(this)];case 3:return[2,e.sent()||!(this.allowedActions.expandHierarchy||this.allowedActions.expandLevel||this.allowedActions.expandNode)]}}))}))},i.prototype.getChildren=function(){return __awaiter(this,void 0,e.Promise,(function(){return __generator(this,(function(e){return[2,this.childCommands]}))}))},i})(i.VisualContainerMenuCommand);i.ExpandCollapseCommandsCollection=p;var d=(function(t){function i(e,i,r,o,n,a,s){var l=t.call(this,"ExpandCollapseNode",r,void 0,s&&s.expandCollapse)||this;return l.isCollapse=e,l.allowedActions=i,l.roles=o,l.nodeIndex=n,l.handlers=a,l}return __extends(i,t),i.prototype.execute=function(){return __awaiter(this,void 0,e.Promise,(function(){return __generator(this,(function(e){return this.handlers.onSetNodeExpansionState({data:this.selectors[0],dataRoles:this.roles,isCollapse:this.isCollapse,nodeIndex:this.nodeIndex}),[2]}))}))},i.prototype.isDisabled=function(){return __awaiter(this,void 0,e.Promise,(function(){return __generator(this,(function(e){switch(e.label){case 0:return[4,t.prototype.isDisabled.call(this)];case 1:return[2,e.sent()||(this.isCollapse?!this.allowedActions.collapseNode:!this.allowedActions.expandNode)]}}))}))},i})(i.VisualContainerMenuCommand);i.ExpandCollapseNodeCommand=d;var h=(function(t){function i(e,i,r,o,n,a,s){var l=t.call(this,"ExpandCollapseLevel",r,void 0,s&&s.expandCollapse)||this;return l.isCollapse=e,l.allowedActions=i,l.roles=o,l.nodeIndex=n,l.handlers=a,l}return __extends(i,t),i.prototype.execute=function(){return __awaiter(this,void 0,e.Promise,(function(){return __generator(this,(function(e){return this.handlers.onSetLevelExpansionState({data:this.selectors[0],dataRoles:this.roles,isCollapse:this.isCollapse,nodeIndex:this.nodeIndex}),[2]}))}))},i.prototype.isDisabled=function(){return __awaiter(this,void 0,e.Promise,(function(){return __generator(this,(function(e){switch(e.label){case 0:return[4,t.prototype.isDisabled.call(this)];case 1:return[2,e.sent()||this.isCollapse?!this.allowedActions.collapseLevel:!this.allowedActions.expandLevel]}}))}))},i})(i.VisualContainerMenuCommand);i.ExpandCollapseLevelCommand=h;var v=(function(t){function i(e,i,r,o,n,a,s){var l=t.call(this,"ExpandCollapseAll",r,void 0,s&&s.expandCollapse)||this;return l.isCollapse=e,l.allowedActions=i,l.roles=o,l.nodeIndex=n,l.handlers=a,l}return __extends(i,t),i.prototype.execute=function(){return __awaiter(this,void 0,e.Promise,(function(){return __generator(this,(function(e){return this.handlers.onSetHierarchyExpansionState({data:this.selectors[0],dataRoles:this.roles,isCollapse:this.isCollapse,nodeIndex:this.nodeIndex}),[2]}))}))},i.prototype.isDisabled=function(){return __awaiter(this,void 0,e.Promise,(function(){return __generator(this,(function(e){switch(e.label){case 0:return[4,t.prototype.isDisabled.call(this)];case 1:return[2,e.sent()||this.isCollapse?!this.allowedActions.collapseHierarchy:!this.allowedActions.expandHierarchy]}}))}))},i})(i.VisualContainerMenuCommand);i.ExpandCollapseHierarchyCommand=v;var g=(function(i){function r(e,t,r,o,n,a,s){void 0===n&&(n=!1);var l=i.call(this,"VisualContainer_SeeData_Enable",void 0,n?"itemIcon glyphicon pbi-glyph-seedata glyph-small":void 0,s&&s.seeData)||this;return l.visualContainer=e,l.drill=t,l.visibility=r,l.pluginOps=o,l.viewModeState=a,l}return __extends(r,i),r.prototype.execute=function(){return __awaiter(this,void 0,e.Promise,(function(){var e;return __generator(this,(function(t){return e=2,this.viewModeState&&this.viewModeState.getConfig().displayOptions.showVisualAccessibleData&&(e=8),this.visibility.set(this.visualContainer,e),[2]}))}))},r.prototype.isVisible=function(){return __awaiter(this,void 0,e.Promise,(function(){var e;return __generator(this,(function(r){switch(r.label){case 0:return[4,i.prototype.isVisible.call(this)];case 1:return r.sent()?(e=this.visualContainer&&2!==this.visualContainer.visibility&&this.drill.canSeeData(this.visualContainer)&&!this.pluginOps.isAnalysisVisual(t.util.VisualContainerUtils.getVisualType(this.visualContainer)),[2,e]):[2,!1]}}))}))},r})(i.VisualContainerMenuCommand);i.SeeDataCommand=g;var f=(function(t){function i(e,i,r,o,n,a,s,l){var c=t.call(this,"Group_Action",i,void 0,l&&l.createGroup)||this;return c.visualContainer=e,c.conceptualSchemaProxy=r,c.dataSources=o,c.featureSwitchService=n,c.groupAuthoring=a,c.promiseFactory=s,c}return __extends(i,t),i.prototype.execute=function(){return __awaiter(this,void 0,e.Promise,(function(){var e,t=this;return __generator(this,(function(i){return this.pendingGroupOperation?[2]:(this.pendingGroupOperation=!0,e=this.dataSources.get(),this.conceptualSchemaProxy.get(e).then((function(i){return t.groupAuthoring.visual.group(t.visualContainer,t.selectors,!0,e,i)})).finally((function(){t.pendingGroupOperation=!1})),[2])}))}))},i.prototype.isVisible=function(){return __awaiter(this,void 0,e.Promise,(function(){var e,i,r,o,n,a;return __generator(this,(function(s){switch(s.label){case 0:return e=!this.featureSwitchService.featureSwitches.enableGroupAuthoring,e?[3,2]:[4,t.prototype.isVisible.call(this)];case 1:e=!s.sent(),s.label=2;case 2:return e?[2,!1]:(i=this.dataSources.get(),i?[4,this.conceptualSchemaProxy.get(i)]:[2,!1]);case 3:return r=s.sent(),o=r.schema(void 0),n=(o&&o.capabilities&&o.capabilities.supportsGrouping)!==!1,a=n&&this.groupAuthoring.visual.canGroup(this.visualContainer,this.selectors,r),[2,this.promiseFactory.resolve(a)]}}))}))},i})(i.VisualContainerMenuCommand);i.CreateGroupCommand=f;var y=(function(t){function i(e,i,r,o,n,a,s,l,c,u,p){var d=t.call(this,e,r,void 0,p&&p.includeExclude)||this;return d.visualContainer=i,d.filterCreationKind=o,d.conceptualSchemaProxy=n,d.dataSources=a,d.featureSwitchService=s,d.includeExcludeService=l,d.promiseFactory=c,d.dataView=u,d}return __extends(i,t),i.prototype.execute=function(){return __awaiter(this,void 0,e.Promise,(function(){return __generator(this,(function(e){return this.includeExcludeService.setFilter(this.filterCreationKind,this.selectors,this.visualContainer,this.dataView),[2]}))}))},i.prototype.isVisible=function(){return __awaiter(this,void 0,e.Promise,(function(){var e,i,r,n;return __generator(this,(function(a){switch(a.label){case 0:return e=!this.featureSwitchService.featureSwitches.includeExcludeEnabled,e?[3,2]:[4,t.prototype.isVisible.call(this)];case 1:e=!a.sent(),a.label=2;case 2:return e?[2,this.promiseFactory.resolve(!1)]:o.hasIdentities(this.selectors)?(i=this.dataSources.get(),i?[4,this.conceptualSchemaProxy.get(i)]:[2,this.promiseFactory.resolve(!1)]):[2,this.promiseFactory.resolve(!1)];case 3:return r=a.sent(),null!=this.selectors[0].dataMap?(n=this.includeExcludeService.isIncludeExcludeSupported(this.visualContainer,r,this.featureSwitchService.featureSwitches.negatedTuplesFiltering),[2,this.promiseFactory.resolve(n)]):[2,this.promiseFactory.resolve(!1)]}}))}))},i})(i.VisualContainerMenuCommand);i.IncludeExcludeCommand=y;var m=(function(e){function t(t,i,r,o,n,a,s,l,c){return e.call(this,"VisualContainer_ContextMenu_Include",t,i,3,r,o,n,a,s,l,c)||this}return __extends(t,e),t})(y);i.IncludeCommand=m;var S=(function(e){function t(t,i,r,o,n,a,s,l,c){return e.call(this,"VisualContainer_ContextMenu_Exclude",t,i,4,r,o,n,a,s,l,c)||this}return __extends(t,e),t})(y);i.ExcludeCommand=S;var w=(function(t){function i(i,r,o,n,a,s,l){var c=t.call(this,"Copy",void 0,void 0,l&&l.copy)||this;return c.clipboard=r,c.childCommands=[],c.copyPasteService=e.CopyPasteService.create(),n.featureSwitches.tablixCellCopy&&s.copyArgs&&(s.copyArgs.singleValue||s.copyArgs.grid)&&(c.childCommands.push(new C("Visual_CopyValue",i,c.copyPasteService,o,s.copyArgs.singleValue)),c.childCommands.push(new b("Visual_CopySelection",i,c.copyPasteService,o,s.copyArgs.grid))),n.featureSwitches.copyBetweenPbix&&!a.get()&&c.childCommands.push(new x("Visual_CopyVisual",c.clipboard)),c}return __extends(i,t),Object.defineProperty(i.prototype,"commandsCount",{get:function(){return this.childCommands.length},enumerable:!0,configurable:!0}),i.prototype.getChildren=function(){return __awaiter(this,void 0,e.Promise,(function(){return __generator(this,(function(e){return[2,this.childCommands]}))}))},i})(i.VisualContainerMenuCommand);i.CopyCommandsCollection=w;var C=(function(i){function r(e,t,r,o,n,a){var s=i.call(this,e,void 0,void 0,a&&a.copy)||this;return s.visualContainer=t,s.copyPasteService=r,s.telemetryService=o,s.valueCallback=n,s}return __extends(r,i),r.prototype.isDisabled=function(){return __awaiter(this,void 0,e.Promise,(function(){return __generator(this,(function(e){switch(e.label){case 0:return[4,i.prototype.isDisabled.call(this)];case 1:return[2,e.sent()||null===this.valueCallback||!("string"==typeof this.valueCallback||"function"==typeof this.valueCallback)]}}))}))},r.prototype.execute=function(){return __awaiter(this,void 0,e.Promise,(function(){var e;return __generator(this,(function(i){return e=t.util.VisualContainerUtils.getVisualType(this.visualContainer),this.copyPasteService.copyText(this.valueCallback,this.telemetryService,e),[2]}))}))},r})(i.VisualContainerMenuCommand);i.CopyValueCommand=C;var b=(function(i){function r(e,t,r,o,n,a){var s=i.call(this,e,void 0,void 0,a&&a.copy)||this;return s.visualContainer=t,s.copyPasteService=r,s.telemetryService=o,s.valueCallback=n,s}return __extends(r,i),r.prototype.isDisabled=function(){return __awaiter(this,void 0,e.Promise,(function(){return __generator(this,(function(e){switch(e.label){case 0:return[4,i.prototype.isDisabled.call(this)];case 1:return[2,e.sent()||null===this.valueCallback||"function"!=typeof this.valueCallback]}}))}))},r.prototype.execute=function(){return __awaiter(this,void 0,e.Promise,(function(){var e;return __generator(this,(function(i){return e=t.util.VisualContainerUtils.getVisualType(this.visualContainer),this.copyPasteService.copyGrid(this.valueCallback,this.telemetryService,e),[2]}))}))},r})(i.VisualContainerMenuCommand);i.CopySelectionCommand=b;var x=(function(t){function i(e,i,r){var o=t.call(this,e,void 0,void 0,r&&r.copy)||this;return o.clipboard=i,o}return __extends(i,t),i.prototype.execute=function(){return __awaiter(this,void 0,e.Promise,(function(){return __generator(this,(function(e){return this.clipboard.copy(),[2]}))}))},i})(i.VisualContainerMenuCommand);i.CopyVisualCommand=x;var F=(function(t){function i(e,i,r,o,n,a,s,l,c,u,p,d,h,v){var g=t.call(this,"VisualContainer_ContextMenu_Analyze",i,void 0,v&&v.insightsAnalysis)||this;return g.visualContainer=e,g.position=r,g.conceptualSchemaProxy=o,g.dataSources=n,g.dropdown=a,g.eventBridge=s,g.explorationCapabilities=l,g.explorationNavigation=c,g.featureSwitchService=u,g.lazyScoped=p,g.viewModeState=d,g.queryHandler=h,g.displayOverride=v,g}return __extends(i,t),i.prototype.execute=function(){return __awaiter(this,void 0,e.Promise,(function(){return __generator(this,(function(e){return[2]}))}))},i.prototype.isVisible=function(){return __awaiter(this,void 0,e.Promise,(function(){var e,i,r,o,n,a,s,l,c;return __generator(this,(function(u){switch(u.label){case 0:return e=!this.featureSwitchService.featureSwitches.insightsExplore,e?[3,2]:[4,t.prototype.isVisible.call(this)];case 1:e=!u.sent(),u.label=2;case 2:return e?[2,!1]:(i=this.dataSources.get(),i?[4,this.getChildren()]:[2,!1]);case 3:return r=u.sent(),_.isEmpty(r)?[2,!1]:[4,this.lazyScoped("userEmulationService")];case 4:return o=u.sent(),o.getState()?[2,!1]:[4,this.conceptualSchemaProxy.get(i)];case 5:return n=u.sent(),a=this.explorationCapabilities.getCapabilities(),a&&a.insights&&(s=_.some(n.schemas,(function(e){return!e.isExtensionSchema&&e.capabilities.supportsInsights})))?[4,this.getAnalysisOptions(n)]:[2,!1];case 6:return l=u.sent(),c=!_.isEmpty(l),[2,c]}}))}))},i.prototype.getChildren=function(){return __awaiter(this,void 0,e.Promise,(function(){var e,t,i,r,o,n,a,s;return __generator(this,(function(l){switch(l.label){case 0:return e=this.dataSources.get(),e?[4,this.conceptualSchemaProxy.get(e)]:[2,null];case 1:return t=l.sent(),[4,this.getAnalysisOptions(t)];case 2:if(i=l.sent(),!_.isEmpty(i)){for(r=[],o=0,n=i;o<n.length;o++)a=n[o],s=new D(this.selectors,this.position,a,this.dataSources,this.dropdown,this.eventBridge,this.explorationNavigation,this.viewModeState,this.lazyScoped,this.displayOverride),r.push(s);return[2,r]}return[2,null]}}))}))},i.prototype.getAnalysisOptions=function(t){return __awaiter(this,void 0,e.Promise,(function(){var e,i,r;return __generator(this,(function(o){switch(o.label){case 0:return[4,this.lazyScoped("insightsAnalysisService")];case 1:return e=o.sent(),[4,this.queryHandler.getCachedQueryOrGenerate({contract:this.visualContainer})];case 2:return i=o.sent(),null==i?[2]:(r=e.getOptions(this.visualContainer,i.filterContext,this.selectors,t),[2,r])}}))}))},i})(i.VisualContainerMenuCommand);i.InsightsAnalysisCommandsCollection=F;var D=(function(t){function i(e,i,r,o,n,a,s,l,c,u){var p=t.call(this,null,e,void 0,u&&u.insightsAnalysis)||this;return p.position=i,p.insightsAnalysisData=r,p.dataSources=o,p.dropdown=n,p.eventBridge=a,p.explorationNavigation=s,p.viewModeState=l,p.lazyScoped=c,p}return __extends(i,t),i.prototype.execute=function(){return __awaiter(this,void 0,e.Promise,(function(){var t,i,r=this;return __generator(this,(function(o){switch(o.label){case 0:return[4,this.lazyScoped("insightsTutorialService")];case 1:return t=o.sent(),i={exploration:this.explorationNavigation.getCurrentExploration(),analysisDefinition:this.insightsAnalysisData.analysisDefinition,insightQueryTransform:this.insightsAnalysisData.insightQueryTransform,description:this.insightsAnalysisData.description,dataSources:this.dataSources.get(),isReadOnly:0===this.viewModeState.getMode(),insightsTutorialService:t,addVisual:function(t){r.eventBridge.publishToChannel(e.explore.services.events.addInsightContainer,{visualContainer:t})},lazyLoadConfig:{name:"powerbi.insights",namespace:"powerbi.insights",dependency:{javascript:"insights",css:["insights"]}}},this.dropdown.showMenu({args:i},"insightsExplore.html",{position:this.position,showInsideVisibleArea:!0,showIndicator:!0,hideExistingOverlays:!0}),[2]}}))}))},i.prototype.title=function(e){return this.insightsAnalysisData.question},i.prototype.getChildren=function(){return __awaiter(this,void 0,e.Promise,(function(){return __generator(this,(function(e){return[2,null]}))}))},i})(i.VisualContainerMenuCommand);i.InsightsAnalysisCommand=D;var V=(function(i){function r(e,t,r,o,n,a,s,l,c,u,p,d,h,v,g){var f=i.call(this,v||"Drillthrough",t,"pbi-glyph-drillup",g&&g.drillthrough)||this;return f.visualContainer=e,f.drillthroughEntryPoint=r,f.conceptualSchemaProxy=o,f.dataProxyService=n,f.dataSources=a,f.drill=s,f.explorationNavigation=l,f.lazyScoped=c,f.lazyScopedSync=u,f.pluginOps=p,f.queryHandler=d,f.telemetryService=h,f.displayOverride=g,f}return __extends(r,i),r.prototype.execute=function(){return __awaiter(this,void 0,e.Promise,(function(){return __generator(this,(function(e){return[2]}))}))},r.prototype.isVisible=function(){return __awaiter(this,void 0,e.Promise,(function(){var e,t;return __generator(this,(function(r){switch(r.label){case 0:return e=_.isEmpty(this.selectors),e?[3,2]:[4,i.prototype.isVisible.call(this)];case 1:e=!r.sent(),r.label=2;case 2:return e?[2,!1]:this.drill.canDrillthrough(this.visualContainer)?[4,this.getChildren()]:[3,4];case 3:return t=r.sent(),[2,!_.isEmpty(t)];case 4:return[2,!1]}}))}))},r.prototype.getChildren=function(){return __awaiter(this,void 0,e.Promise,(function(){var e,i,r,o,n,a,s,l=this;return __generator(this,(function(c){switch(c.label){case 0:return e=this.drillthroughEntryPoint,i=this.explorationNavigation.getCurrentSection(),r=t.util.VisualContainerUtils.getVisualType(this.visualContainer),_.isEmpty(this.selectors)||_.isEmpty(i.name)||!this.pluginOps.isQueryVisual(r)?[2,[]]:[4,this.queryHandler.getCachedQueryOrGenerate({contract:this.visualContainer})];case 1:return o=c.sent(),null==o?[2]:[4,this.lazyScoped("drillthrough")];case 2:return n=c.sent(),[4,n.getDrillthroughActions(i.name,this.visualContainer,this.selectors,o.filterContext)];case 3:return a=c.sent(),s=_.map(a,(function(t){return new M(l.visualContainer,t,e,l.conceptualSchemaProxy,l.dataSources,l.lazyScoped,l.lazyScopedSync,l.telemetryService,l.displayOverride)})),[2,s]}}))}))},r})(i.VisualContainerMenuCommand);i.DrillthroughCommandCollection=V;var M=(function(t){function i(e,i,r,o,n,a,s,l,c){var u=t.call(this,"Drillthrough",void 0,void 0,c&&c.drillthrough)||this;return u.visualContainer=e,u.drillthroughActionData=i,u.drillthroughEntryPoint=r,u.conceptualSchemaProxy=o,u.dataSources=n,u.lazyScoped=a,u.lazyScopedSync=s,u.telemetryService=l,u}return __extends(i,t),i.prototype.execute=function(){return __awaiter(this,void 0,e.Promise,(function(){var t,i,r,o;return __generator(this,(function(n){switch(n.label){case 0:return[4,this.lazyScoped("drillthrough")];case 1:return t=n.sent(),i=t.getApplyStateInfo(this.drillthroughActionData,!0),this.telemetryService.logEvent(e.telemetry.EXDrillthroughGotoTarget,this.drillthroughEntryPoint),r=this.lazyScopedSync("explorationStateManager"),[4,this.conceptualSchemaProxy.get(this.dataSources.get())];case 2:return o=n.sent(),r.apply(i.state,o,i.options),[2]}}))}))},i.prototype.title=function(e){return this.drillthroughActionData.actionDisplayName},i})(i.VisualContainerMenuCommand);i.DrillthroughCommand=M;var P=(function(t){function i(e,i,r,o,n,a,s,l,c){var u=t.call(this,null,i,void 0,c&&c.extensions,void 0,s)||this;return u.visualContainer=e,u.commandName=r,u.commandTitle=o,u.eventBridge=n,u.explorationExtensibilityService=a,u.visualContainerDataSelectionService=l,u}return __extends(i,t),i.prototype.title=function(e){return this.commandTitle},i.prototype.execute=function(){return __awaiter(this,void 0,e.Promise,(function(){var e;return __generator(this,(function(t){return e=this.getDataPointsDescriptions(),this.explorationExtensibilityService.executeCustomCommand(this.eventBridge,this.visualContainer,this.commandName,e),[2]}))}))},i.prototype.getDataPointsDescriptions=function(){var e=[];if(this.visualContainerDataSelectionService){var t=_.map(this.selectors,(function(e){return o.convertSelectorsByColumnToSelector(e)}));if(!_.isEmpty(t))for(var i=0,r=t;i<r.length;i++){var n=r[i],a=this.visualContainerDataSelectionService.getSelectedValues(n);e.push({selector:n,values:a})}}return e},i})(i.VisualContainerMenuCommand);i.ExtensionCommand=P})(i=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=(function(i){function r(e,t,r,o,n,a,s,l){var c=i.call(this,"Slicer_SearchBox_Text",void 0,"itemIcon glyphicon pbi-glyph-search glyph-small",l&&l.search)||this;return c.visualContainer=e,c.filterGenerator=t,c.overlayService=r,c.undoRedo=o,c.visualAuthoring=n,c.visualPlugin=a,c.menuOptions=s,c.selected=c.isSearchOn,c}return __extends(r,i),r.prototype.execute=function(){return __awaiter(this,void 0,e.Promise,(function(){var i,r,o,n,a,s=this;return __generator(this,(function(l){return i=this.visualContainer.contract.config.singleVisual,i.objects||(i.objects={}),r=t.util.VisualContainerUtils.getVisualCapabilities(this.visualContainer.contract,this.visualPlugin),(o=this.filterGenerator.tryGetSelfFilterEnabledProperty(r))?(n=e.data.DataViewObjectDefinitions.getValue(i.objects,o,null),a=n&&n.value||!1,this.undoRedo.register("ToggleSearchVisualContainer",(function(){if(a){e.data.DataViewObjectDefinitions.deleteProperty(i.objects,o.objectName,null,o.propertyName);var t=s.filterGenerator.tryGetSelfFilterProperty(r);t&&e.data.DataViewObjectDefinitions.deleteProperty(i.objects,t.objectName,null,t.propertyName)}else e.data.DataViewObjectDefinitions.setValue(i.objects,o,null,e.data.SQExprBuilder.boolean(!0));s.visualAuthoring.raiseVisualContainerChanged(s.visualContainer.contract)})),this.overlayService.hideAllDropdowns(),[2]):(this.overlayService.hideAllDropdowns(),[2])}))}))},r.prototype.isVisible=function(){return __awaiter(this,void 0,e.Promise,(function(){return __generator(this,(function(e){return[2,this.menuOptions.canSearch&&i.prototype.isVisible.call(this)]}))}))},Object.defineProperty(r.prototype,"isSearchOn",{get:function(){var i=this.visualContainer.contract.config.singleVisual;if(!i||!i.objects)return!1;var r=t.util.VisualContainerUtils.getVisualCapabilities(this.visualContainer.contract,this.visualPlugin);if(!r)return!1;var o=this.filterGenerator.tryGetSelfFilterEnabledProperty(r);if(!o)return!1;var n=e.data.DataViewObjectDefinitions.getValue(i.objects,o,null);return n&&n.value||!1},enumerable:!0,configurable:!0}),r})(i.VisualContainerMenuCommand);i.ToggleSearchCommand=r;var o=(function(t){function r(e,i,r,o,n,a,s,l,c){var u=t.call(this,"ExportData_MenuItem",void 0,"itemIcon glyphicon pbi-glyph-export glyph-small",c&&c.exportData)||this;return u.visualContainer=e,u.conceptualSchemaProxy=i,u.dataSources=r,u.eventBridge=o,u.filterGenerator=n,u.overlayService=a,u.menuOptions=s,u.explorationSettings=l,u}return __extends(r,t),r.prototype.execute=function(){return __awaiter(this,void 0,e.Promise,(function(){var e,t,r,o,n,a,s;return __generator(this,(function(l){switch(l.label){case 0:e=this.visualContainer.getRunningVisual(),t=this.visualContainer.contract.config.singleVisual,r=this.visualContainer.visualTitle,o=null!=r?r.text:"",n=this.dataSources.get(),l.label=1;case 1:return l.trys.push([1,3,4,5]),[4,this.conceptualSchemaProxy.get(n)];case 2:return a=l.sent(),this.eventBridge.publishToChannel(i.events.exportVisualData,{visualData:{data:e.getData(),dataTransforms:e.getDataTransforms()},visualConfig:t,visualTitle:o,additionalFilters:this.visualContainer.hostServices.getFilters(this.filterGenerator,a)}),[3,5];case 3:return s=l.sent(),[3,5];case 4:return this.overlayService.hideAllDropdowns(),[7];case 5:return[2]}}))}))},r.prototype.isVisible=function(){return __awaiter(this,void 0,e.Promise,(function(){return __generator(this,(function(e){return[2,this.menuOptions.canExport&&t.prototype.isVisible.call(this)]}))}))},r.prototype.isDisabled=function(){return __awaiter(this,void 0,e.Promise,(function(){return __generator(this,(function(e){switch(e.label){case 0:return[4,t.prototype.isDisabled.call(this)];case 1:return[2,e.sent()||this.explorationSettings&&this.explorationSettings.exportDataMode&&2===this.explorationSettings.exportDataMode]}}))}))},r.prototype.getToolTip=function(t){return __awaiter(this,void 0,e.Promise,(function(){var e;return __generator(this,(function(i){switch(i.label){case 0:return[4,this.isDisabled()];case 1:return e=i.sent(),e?[2,t.get("VisualContainer_ExportDataDisabled_Tooltip")]:[2,null]}}))}))},r})(i.VisualContainerMenuCommand);i.ExportVisualDataCommand=o;var n=(function(t){function r(e,i,r,o,n,a){var s=t.call(this,"Edit_ToolTip",void 0,"itemIcon glyphicon pbi-glyph-edit glyph-mini",a&&a.enterAdvancedEditMode)||this;return s.visualContainer=e,s.eventBridge=i,s.overlayService=r,s.visualContainerScope=o,s.menuOptions=n,s}return __extends(r,t),r.prototype.execute=function(){return __awaiter(this,void 0,e.Promise,(function(){return __generator(this,(function(e){return this.eventBridge.publishBubbling(this.visualContainerScope,i.events.changeEditMode,1),this.overlayService.hideAllDropdowns(),[2]}))}))},r.prototype.isVisible=function(){return __awaiter(this,void 0,e.Promise,(function(){return __generator(this,(function(e){return[2,this.menuOptions.canEdit&&t.prototype.isVisible.call(this)]}))}))},r})(i.VisualContainerMenuCommand);i.EnterAdvancedEditModeCommand=n;var a=(function(t){function r(e,i,r,o,n){var a=t.call(this,"Remove_visual",void 0,"itemIcon glyphicon pbi-glyph-close glyph-mini",n&&n.removeVisual)||this;return a.visualContainer=e,a.eventBridge=i,a.undoRedo=r,a.menuOptions=o,a}return __extends(r,t),r.prototype.execute=function(){return __awaiter(this,void 0,e.Promise,(function(){var e=this;return __generator(this,(function(t){return this.undoRedo.register("DeleteVisualContainer",(function(){e.eventBridge.publishToChannel(i.events.deleteVisualContainer,e.visualContainer.contract)})),[2]}))}))},r.prototype.isVisible=function(){return __awaiter(this,void 0,e.Promise,(function(){return __generator(this,(function(e){
return[2,this.menuOptions.canDelete&&t.prototype.isVisible.call(this)]}))}))},r})(i.VisualContainerMenuCommand);i.DeleteVisualContainerCommand=a;var s=(function(t){function r(e,i,r,o,n,a,s,l){var c=t.call(this,e,void 0,i,l&&l.clusters)||this;return c.visualContainer=r,c.eventBridge=o,c.isSpatialCluster=n,c.visualContainerScope=a,c.menuOptions=s,c}return __extends(r,t),r.prototype.execute=function(){return __awaiter(this,void 0,e.Promise,(function(){return __generator(this,(function(e){return this.isSpatialCluster?this.eventBridge.publishBubbling(this.visualContainerScope,i.events.getClusters,{useSpatialClustering:!0}):this.eventBridge.publishBubbling(this.visualContainerScope,i.events.getClusters,{}),[2]}))}))},r.prototype.isVisible=function(){return __awaiter(this,void 0,e.Promise,(function(){return __generator(this,(function(e){return[2,(this.isSpatialCluster?this.menuOptions.canSpatialCluster:this.menuOptions.canCluster)&&t.prototype.isVisible.call(this)]}))}))},r})(i.VisualContainerMenuCommand);i.ClustersSpatialClustersCommand=s;var l=(function(e){function t(t,i,r,o,n){return e.call(this,"Visual_Cluster_FindGroups","itemIcon glyphicon pbi-glyph-scatter glyph-small",t,i,!1,r,o,n)||this}return __extends(t,e),t})(s);i.GetClustersCommand=l;var c=(function(e){function t(t,i,r,o,n){return e.call(this,"Visual_Cluster_FindGroups_Spatial",void 0,t,i,!0,r,o,n)||this}return __extends(t,e),t})(s);i.GetSpatialClustersCommand=c;var u=(function(t){function i(e,i,r,o){var n=t.call(this,"Spotlight",void 0,"itemIcon glyphicon pbi-glyph-flashlight glyph-small",o&&o.spotlight)||this;return n.visualContainer=e,n.visibility=i,n.menuOptions=r,n.selected=n.isSpotlightOn,n}return __extends(i,t),i.prototype.execute=function(){return __awaiter(this,void 0,e.Promise,(function(){return __generator(this,(function(e){return 4===this.visualContainer.contract.visibility?this.visibility.clear():this.visibility.set(this.visualContainer.contract,4),[2]}))}))},i.prototype.isVisible=function(){return __awaiter(this,void 0,e.Promise,(function(){return __generator(this,(function(e){return[2,this.menuOptions.canSpotlight&&t.prototype.isVisible.call(this)]}))}))},Object.defineProperty(i.prototype,"isSpotlightOn",{get:function(){return 4===this.visualContainer.contract.visibility},enumerable:!0,configurable:!0}),i})(i.VisualContainerMenuCommand);i.ToggleSpotlightCommand=u;var p=(function(t){function r(e,i,r,o,n,a,s,l,c){var u=t.call(this,e,void 0,i,c&&c.sort)||this;return u.sortDirection=r,u.visualContainerScope=o,u.visualContainer=n,u.eventBridge=a,u.overlayService=s,u.menuOptions=l,u.selected=u.isHighlighted,u}return __extends(r,t),r.prototype.execute=function(){return __awaiter(this,void 0,e.Promise,(function(){var e,t;return __generator(this,(function(r){return this.overlayService.hideAllDropdowns(),this.menuOptions.sortSetting.sortableFields&&(e=1===_.size(this.menuOptions.sortSetting.sortableFields)?this.menuOptions.sortSetting.sortableFields[0]:this.activeSortableField),t={sortableField:e,sortDirection:this.sortDirection,sortOnDemand:!0},this.eventBridge.publishBubbling(this.visualContainerScope,i.events.toggleSortVisualContainer,t),[2]}))}))},r.prototype.isVisible=function(){return __awaiter(this,void 0,e.Promise,(function(){return __generator(this,(function(e){return[2,this.menuOptions.canSort&&t.prototype.isVisible.call(this)]}))}))},Object.defineProperty(r.prototype,"activeSortableField",{get:function(){return _.find(this.menuOptions.sortSetting.sortableFields,(function(e){return e.active}))},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"isHighlighted",{get:function(){return this.visualContainer.readOnlyState.actualSortDirection===this.sortDirection&&void 0!==this.activeSortableField},enumerable:!0,configurable:!0}),r})(i.VisualContainerMenuCommand);i.SortAscendingDescendingCommand=p;var d=(function(e){function t(t,i,r,o,n,a){return e.call(this,"Sort_Desc","itemIcon glyphicon pbi-glyph-ztoa glyph-small",2,t,i,r,o,n,a)||this}return __extends(t,e),t})(p);i.SortDescendingCommand=d;var h=(function(e){function t(t,i,r,o,n,a){return e.call(this,"Sort_Asc","itemIcon glyphicon pbi-glyph-atoz glyph-small",1,t,i,r,o,n,a)||this}return __extends(t,e),t})(p);i.SortAscendingCommand=h;var v=(function(t){function i(e,i,r,o,n,a){var s=t.call(this,"MobileFooter_SortBy",void 0,void 0,a&&a.sort)||this;return s.visualContainerScope=e,s.visualContainer=i,s.eventBridge=r,s.overlayService=o,s.menuOptions=n,s.displayOverride=a,s}return __extends(i,t),i.prototype.execute=function(){return __awaiter(this,void 0,e.Promise,(function(){return __generator(this,(function(e){return[2]}))}))},i.prototype.isVisible=function(){return __awaiter(this,void 0,e.Promise,(function(){var e;return __generator(this,(function(i){switch(i.label){case 0:return e=this.menuOptions.canSort,e?[4,t.prototype.isVisible.call(this)]:[3,2];case 1:e=i.sent(),i.label=2;case 2:return e?[2,_.size(this.menuOptions.sortSetting.sortableFields)>1]:[2,!1]}}))}))},i.prototype.getChildren=function(){return __awaiter(this,void 0,e.Promise,(function(){var e,t,i=this;return __generator(this,(function(r){return e=this.menuOptions.sortSetting.sortableFields,t=_.map(e,(function(e){return new g(i.visualContainerScope,i.visualContainer,e,i.eventBridge,i.overlayService,i.displayOverride)})),[2,t]}))}))},i})(i.VisualContainerMenuCommand);i.SortByCommandCollection=v;var g=(function(t){function r(e,i,r,o,n,a){var s=t.call(this,r.displayName,void 0,void 0,a&&a.sort)||this;return s.visualContainerScope=e,s.visualContainer=i,s.sortField=r,s.eventBridge=o,s.overlayService=n,s.selected=s.sortField.active,s}return __extends(r,t),r.prototype.execute=function(){return __awaiter(this,void 0,e.Promise,(function(){var e;return __generator(this,(function(t){return this.overlayService.hideAllDropdowns(),e={sortableField:this.sortField,sortDirection:this.visualContainer.readOnlyState.actualSortDirection,sortOnDemand:!0},this.eventBridge.publishBubbling(this.visualContainerScope,i.events.toggleSortVisualContainer,e),[2]}))}))},r.prototype.title=function(e){return this.sortField.displayName},r})(i.VisualContainerMenuCommand);i.SortByCommand=g})(i=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){function r(e,t,i,r,o,n,a,l,c,u,p){return new s(e,t,i,r,o,n,a,l,c,u,p)}var o=e.data.services.DataViewTransformActionsSerializer,n=e.data.dsr,a=t.util.VisualContainerUtils;i.createVisualDataProxyExecutionService=r;var s=(function(){function t(e,t,i,r,o,n,a,s,l,c,u){this.promiseFactory=e,this.conceptualSchemaProxy=t,this.featureSwitchService=i,this.telemetryService=r,this.visualQueryGenerator=o,this.visualPlugin=n,this.visualPluginOps=a,this.dataProxy=s,this.visualDataProxyService=l,this.networkAvailability=c,this.embedTypeDescription=u.getEmbedTypeDescription()}return t.prototype.generateQuery=function(e){return this.visualDataProxyService.generateQuery(e)},t.prototype.runQuery=function(e){var t=this,i=this.promiseFactory.defer(),r=this.promiseFactory.defer(),o={previewPromise:i.promise,finalPromise:r.promise};return this.applyVisualCache(e,i,r).then((function(i){i&&t.runQueryImpl(e,r,!1)})),o},t.prototype.applyVisualCache=function(t,i,r){var o=this,n=this.promiseFactory.defer(),s=this.featureSwitchService.featureSwitches.embeddedEnabled,l=t.contract;if(t.useVisualContainerCache&&t.initialLoad||s){var c=a.hasOnPremDataSource(t.dataSources);this.retrieveFromVisualContainerCache(t.dataSources,l,t.viewport,t.hostServices).then((function(t){t.isFinal||s||!o.networkAvailability.isNetworkAvailable()?(i.reject(),r.resolve(t.result),n.resolve(!1),s||o.telemetryService.logEvent(e.telemetry.EXVisualFirstLoad,"Cache",c,"None",o.embedTypeDescription)):(i.resolve(t.result),n.resolve(!0),s||o.telemetryService.logEvent(e.telemetry.EXVisualFirstLoad,"StaleCache",c,"None",o.embedTypeDescription))}),(function(t){i.reject(),l.useInitialCachedQuery=!1,s?(r.reject(),n.resolve(!1)):(n.resolve(!0),o.telemetryService.logEvent(e.telemetry.EXVisualFirstLoad,"NoCache",c,t,o.embedTypeDescription))}))}else i.reject(),n.resolve(!0);return n.promise},t.prototype.runQueryImpl=function(e,t,i){var r=this,o=e.contract,n=e.dataSources,a=e.initialLoad&&!!e.useVisualContainerCache&&o&&!o.disableCacheOnServerForInitialLoad;return!o||!o.config||o.useInitialCachedQuery&&a||!this.visualQueryGenerator.shouldExecute(o.config.singleVisual,n)?void t.resolve(null):void this.conceptualSchemaProxy.get(n).then((function(s){var l={dataSources:n,schema:s,config:o.config.singleVisual,hostServices:e.hostServices,visualQueryGenerator:r.visualQueryGenerator,isLoadMore:i,isInitialLoad:a,allowCache:e.allowCache,cacheResponseOnServer:e.cacheResponseOnServer,preferCurrentData:e.preferCurrentData,viewport:e.viewport,generatedQuery:e.generatedQuery,cacheOptions:e.cacheOptions};r.visualDataProxyService.runQuery(l).then((function(i){return r.loadData(i,s,o,a,e.useVisualContainerCache,t)}),(function(e){return t.reject(e)}))}),(function(e){t.reject(e?e.clientError:null)}))},t.prototype.canLoadMoreData=function(){return this.visualDataProxyService.canLoadMore()},t.prototype.loadMoreData=function(e){var t=this.promiseFactory.defer();return this.visualDataProxyService.canLoadMore()?this.runQueryImpl(e,t,!0):t.reject(),t.promise},t.prototype.loadData=function(e,t,i,r,o,n){var a=this.visualDataProxyService.lastExecutedQuery(),s=r&&o&&(this.isMissingVisualQueryOrDataTransformsContract(i)||this.isGeneratedQueryDifferentToContainerQuery(i,a)),l=this.promiseFactory.defer();l.resolve(a.options),n.resolve({result:e,dataProxyQuery:{transforms:a.transforms,error:a.error,warnings:a.warnings,options:l.promise,compiledMappings:a.compiledMappings},schema:t,updateServerVisualContainerCache:s})},t.prototype.isMissingVisualQueryOrDataTransformsContract=function(e){var t=a.getVisualType(e);return!(!t||!this.visualPluginOps.isQueryVisual(t))&&(null==e.cachedData||null==e.cachedData.query&&null==e.cachedData.queryObject||!e.cachedData.transforms)},t.prototype.isGeneratedQueryDifferentToContainerQuery=function(e,t){var i=e.cachedData;if(i&&i.query){return JSON.stringify(t.options.query.command)!==i.query}return!1},t.prototype.retrieveFromVisualContainerCache=function(e,t,i,r){if(t.cachedData&&t.cachedData.data)return this.processVisualContainerCache(e,t,i,r);var o=this.promiseFactory.defer();return o.reject("CacheMissing"),o.promise},t.prototype.processVisualContainerCache=function(t,i,r,s){var l,c=this,u=this.promiseFactory.defer(),p=jsCommon.GzipUtility.uncompress(i.cachedData.data);try{l=JSON.parse(p)}catch(e){return u.reject("JsonParseFailed"),u.promise}var d=null,h=i.config.singleVisual,v=this.visualPluginOps.targetedDataViewKinds(h.visualType,this.featureSwitchService,h.query);try{d=n.read(v,l,e.common.utils.getDsrReaderSwitches(this.featureSwitchService.featureSwitches))}catch(e){return u.reject("DsrReadFailed"),u.promise}if(!d)return u.reject("DataObjectNull"),u.promise;var g={data:l},f=a.getVisualType(i),y=this.visualPlugin.capabilities(f),m=y?y.objects:void 0,S=jsCommon.JsonExtensions.tryParseJSON(i.cachedData.transforms),w=S?o.deserializeDataViewTransformActions(S,m):void 0,C=this.promiseFactory.defer(),b={result:{dataViewSource:g,dataReaderResult:d},dataProxyQuery:{transforms:w,warnings:d.warnings?d.warnings:void 0,error:d.error,options:C.promise},schema:void 0,updateServerVisualContainerCache:!1};return d.error||!w?u.reject(d.error?"DsrHasOdataError":"DataTransformsMissing"):(u.resolve({isFinal:i.useInitialCachedQuery,result:b}),i.useInitialCachedQuery&&this.conceptualSchemaProxy.get(t).then((function(e){var i=c.visualDataProxyService.generateQuery({dataSources:t,schema:e,config:h,hostServices:s,visualQueryGenerator:c.visualQueryGenerator,isLoadMore:!1,isInitialLoad:!1,allowCache:!0,viewport:r,cacheOptions:void 0});c.dataProxy.setLocalCacheResult(i.options,l),C.resolve(i.options)}))),u.promise},t})()})(i=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){function i(e,t){return new s(e,t)}var r=jsCommon.JsonComparer,o=jsCommon.PerfTimer,n=e.data.segmentation.DataViewMerger,a=(function(){function e(e,t,i){this.index=e,this.restartToken=t,i&&(this.hierarchyLastNodeIndex=i)}return e.prototype.endsBeforeNode=function(e){for(var t=this.hierarchyLastNodeIndex,i=Math.min(t.length,e.length),r=0;r<i;r++){var o=t[r],n=e[r];if(o<n)return!0;if(o>n)return!1}return e.length>t.length},e})();t.DataSegment=a,t.createExploreVisualDataProxyService=i;var s=(function(){function t(t,i){this.dataProxy=t,this.promiseFactory=e.createJQueryPromiseFactory(),this.filterGenerator=i,this.dataSegments=[]}return t.prototype.generateQuery=function(e){var t=o.start("visualQueryGenerator("+e.config.visualType+")"),i=this.dataSegments.length-1,r=e.preferCurrentData?this.getSegmentRestartToken(i):this.getSegmentRestartToken(i+1),n=e.visualQueryGenerator.execute({config:e.config,dataSources:e.dataSources,schema:e.schema,additionalFilters:e.hostServices.getFilters(this.filterGenerator,e.schema),restartToken:r,cacheResponseOnServer:!(!e.isInitialLoad&&!e.cacheResponseOnServer),allowCache:e.allowCache,dataWindow:e.viewport,cacheOptions:e.cacheOptions});return t(),n},t.prototype.getSegmentRestartToken=function(e){if(!(e<=0))return this.dataSegments[e-1].restartToken},t.prototype.runQuery=function(t){var i=this,o=this.promiseFactory.defer(),n=this.dataSegments;t.isLoadMore||t.preferCurrentData||(this.dataSegments=[]);var a=_.last(this.dataSegments),s=a&&a.restartToken;if(t.isLoadMore&&!s)o.reject();else{var l=t.generatedQuery||this.generateQuery(t);if(l)if(t.additionalDataViewKinds&&(l.options.kinds|=t.additionalDataViewKinds),l.error)o.reject(l.error),this.generatedQuery=void 0;else{if(!(this.generatedQuery&&t.preferCurrentData&&r.equals(l.options,this.generatedQuery.options))){t.isLoadMore||_.isEmpty(this.dataSegments)||(this.dataSegments=[],l=this.generateQuery(t));var c=this.dataProxy.execute(l.options);return c.then((function(e){i.generatedQuery=l,i.addNewDataSegment(e&&e.dataReaderResult),o.resolve(e)}),(function(e){i.generatedQuery=void 0,o.reject(e)})),c}this.generatedQuery=l,this.dataSegments=n,o.resolve(null)}else this.generatedQuery=void 0,o.reject()}return e.RejectablePromise2(o)},t.prototype.addNewDataSegment=function(e){var t,i=e&&e.restartToken,r=e&&e.dataView,o=r&&r.matrix&&r.matrix.rows&&r.matrix.rows.root,s=this.dataSegments.length;if(_.isEmpty(o&&o.children))t=new a(s,i);else{var l=_.last(this.dataSegments),c=void 0;c=l?_.clone(l.hierarchyLastNodeIndex):[],n.updateTreeLastNodeIndex(o,c),t=new a(s,i,c)}this.dataSegments.push(t)},t.prototype.canLoadMore=function(){var e=_.last(this.dataSegments);return null!=e&&null!=e.restartToken},t.prototype.lastExecutedQuery=function(){return this.generatedQuery},t.prototype.getNodeSegment=function(e){return _.find(this.dataSegments,(function(t){return!t.endsBeforeNode(e)}))},t.prototype.discardSegmentsFrom=function(e){this.dataSegments.length=e},t.prototype.getLastNodeIndex=function(){if(!_.isEmpty(this.dataSegments))return _.last(this.dataSegments).hierarchyLastNodeIndex},t})()})(i=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){function i(e,t,i,r){return new o(e,t,i,r)}var r={"0.00 %;-0.00 %;0.00 %":"Percentage","0.0 %;-0.0 %;0.0 %":"Percentage1"},o=(function(){function t(e,t,i,r){this.promiseFactoryValue=e,this.moduleLoader=t,this.geolocationService=i,this.geocoderService=r,this.instanceId=void 0}return t.initialize=function(i){e.visuals.valueFormatter.setLocaleOptions(t.createLocaleOptions(i)),e.visuals.TooltipManager.setLocalizedStrings(t.createTooltipLocaleOptions(i)),e.data.DataViewTransform.setLocalizationOptions(t.createDataViewTransformLocalizationOptions(i))},t.createLocaleOptions=function(e){return{null:e.get("NullValue"),true:e.get("BooleanTrue"),false:e.get("BooleanFalse"),NaN:e.get("NaNValue"),infinity:e.get("InfinityValue"),negativeInfinity:e.get("NegativeInfinityValue"),beautify:function(i){return t.beautify(e,i)},describe:function(i){return t.describeUnit(e,i)},restatementComma:e.get("FilterRestatement_Comma"),restatementCompoundAnd:e.get("FilterRestatement_CompoundAnd"),restatementCompoundOr:e.get("FilterRestatement_CompoundOr")}},t.createTooltipLocaleOptions=function(t){return{highlightedValueDisplayName:t.get(e.visuals.ToolTipComponent.highlightedValueDisplayNameResorceKey)}},t.createDataViewTransformLocalizationOptions=function(t){return{quarterPrefix:t.get(e.visuals.ForecastHelper.quarterHierarchyLevelPrefixResorceKey)}},t.prototype.getLocalizedString=function(t){return e.common.localize.get(t)},t.prototype.requestFocus=function(e){jsCommon.FocusManager.focus(e)},t.prototype.onDragStart=function(){},t.prototype.getVisualLinkProperties=function(){},t.prototype.canSelect=function(){return!1},t.prototype.onSelecting=function(){},t.prototype.onSelect=function(){},t.prototype.canExpandCollapse=function(e){return!1},t.prototype.setNodeExpansionState=function(e){},t.prototype.onContextMenu=function(){},t.prototype.loadMoreData=function(){},t.prototype.persistProperties=function(e){},t.prototype.onCustomSort=function(e){},t.prototype.getViewMode=function(){return 0},t.prototype.getEditMode=function(){return 0},t.prototype.setWarnings=function(e){},t.prototype.setToolbar=function(e){},t.prototype.shouldRetainSelection=function(){return!1},t.prototype.geocoder=function(){return this.geocoderService},t.prototype.geolocation=function(){return this.geolocationService},t.prototype.locale=function(){return e.common.unmappedCultureInfo},t.prototype.promiseFactory=function(){return this.promiseFactoryValue},t.prototype.analyzeFilter=function(t){return e.explore.services.createAnalyzedFilter(t,!1)},t.prototype.getIdentityDisplayNames=function(e){},t.prototype.setIdentityDisplayNames=function(e){},t.prototype.tooltips=function(){},t.prototype.telemetry=function(){},t.prototype.authenticationService=function(){},t.prototype.localStorageService=function(){},t.prototype.eventService=function(){},t.prototype.loader=function(){return this.moduleLoader},t.prototype.getUIComponentFactory=function(){},t.prototype.applyJsonFilter=function(e,t,i,r){},t.prototype.launchUrl=function(e){},t.prototype.refreshHostData=function(){},t.prototype.getJSONFilter=function(e){return this.promiseFactory().reject()},t.beautify=function(e,t){var i=r[t];return i?e.getOptional(i)||t:t},t.describeUnit=function(e,t){var i=t===-1?"Auto":t.toString(),r=e.getOptional("DisplayUnitSystem_E"+i+"_Title"),o=t<=0?"{0}":e.getOptional("DisplayUnitSystem_E"+i+"_LabelFormat");if(r||o)return{title:r,format:o}},t})();t.VisualHostServices=o,t.createVisualHostServices=i})(i=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){function i(e,t,i,r,o,a){return new n(e,t,i,r,o,a)}var r=jsCommon.ArrayExtensions,o=e.data.SQExpr;t.createVisualSortHelper=i;var n=(function(){function e(e,t,i,r,o,n){this.setting=e,this.model=t,this.sort=i,this.undoRedo=r,this.timeout=o,this.visualAuthoringOperations=n,this.sortDelay=500}return e.prototype.resetSortSettings=function(e,t){this.setting.defaultSortBehavior=t,this.setting.sortableFields=e},e.prototype.toggleSort=function(e,t,i,r){var o=this;this.sortPromise&&this.timeout.cancel(this.sortPromise),this.sortPromise=this.timeout((function(){o.undoRedo.register("VisualContainerToggleSort",(function(){var n=!1;return e?(t&&(e.sortDirection=t),o.toggleSortByField(e,i,r),n=!0):void 0!==o.model.readOnlyState.actualSortDirection&&(o.sortByOrder(),n=!0),o.sortPromise=void 0,n}))}),this.sortDelay)},e.prototype.toggleDirection=function(e){return 1===e?2:1},e.prototype.sortByOrder=function(){var e=this.model.contract.config.singleVisual.query.defn.orderBy();if(!_.isEmpty(e)){for(var t=0,i=e;t<i.length;t++){i[t].direction=this.toggleDirection(this.model.readOnlyState.actualSortDirection)}this.visualAuthoringOperations.setOrderBy(this.model.contract,e)}},e.prototype.toggleSortByField=function(e,t,i){var r=this,o=_.map(e.exprs,(function(t){return{direction:e.sortDirection||2,expr:t.expr}})),n=this.model.contract.config.singleVisual.query;!e.active||i?(this.sort.resetSort(n),this.resetSortableFieldsStatus(!1,!1),this.visualAuthoringOperations.setOrderBy(this.model.contract,o)):this.visualAuthoringOperations.removeOrderBy(this.model.contract,o.map((function(e){return e.expr})),t);var a=_.find(this.setting.sortableFields,(function(t){return r.compareSortableFieldExprs(e,t)}));a&&(a.active=!e.active)},e.prototype.applySortByFields=function(e){var t=this;this.sortPromise&&this.timeout.cancel(this.sortPromise),this.resetSortableFieldsStatus(!1,!0);var i=this.findMatchingSortableFields(e);this.sortPromise=this.timeout((function(){t.undoRedo.register("VisualContainerApplySort",(function(){for(var e=[],r=0,o=i;r<o.length;r++)for(var n=o[r],a=0,s=n.exprs;a<s.length;a++){var l=s[a];e.push({expr:l.expr,direction:n.sortDirection})}var c=t.model.contract,u=c.config.singleVisual.query;return t.sort.resetSort(u),t.visualAuthoringOperations.setOrderBy(c,e),t.sortPromise=void 0,!0}))}),this.sortDelay)},e.prototype.findMatchingSortableFields=function(e){var t=[],i=this.setting.sortableFields;if(_.isEmpty(i)||_.isEmpty(e))return[];for(var r=0,o=i;r<o.length;r++){for(var n=o[r],a=!1,s=null,l=function(t){var i=_.find(e,(function(e){return e.queryName===t.name}));if(!i)return a=!1,"break";if(null==s)s=i.sortDirection;else if(s!==i.sortDirection)return a=!1,"break";a=!0},c=0,u=n.exprs;c<u.length;c++){if("break"===l(u[c]))break}a&&(n.sortDirection=s,n.active=!0,t.push(n))}return t},e.prototype.areAllSortDescriptorsIncluded=function(e,t){for(var i=0,r=e;i<r.length;i++){for(var o=r[i],n=!1,a=0,s=t;a<s.length;a++){for(var l=s[a],c=0,u=l.exprs;c<u.length;c++){if(u[c].name===o.queryName){n=!0;break}}if(n)break}if(!n)return!1}return!0},e.prototype.resetSortableFieldsStatus=function(e,t){if(this.setting.sortableFields)for(var i=0,r=this.setting.sortableFields;i<r.length;i++){var o=r[i];o.active=e,t&&(o.sortDirection=void 0)}},e.prototype.compareSortableFieldExprs=function(e,t){var i=e.exprs,n=t.exprs;return r.sequenceEqual(i,n,(function(e,t){return o.equals(e.expr,t.expr)}))},e})();t.VisualSortHelper=n})(i=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){function r(e,t,i,r,o,n,a,s){return new p(e,t,i,r,o,n,a,s)}function o(e,t){return _.size(e)===_.size(t)&&(!!_.isEmpty(e)||_.every(e,(function(e,i){return n(e,t[i])})))}function n(e,t){return e?t?e.isTransient===t.isTransient&&s.isSameFilter(e.filter,t.filter):!e:!t}var a=e.data.Selector,s=e.data.SemanticFilter,l=e.data.SQExpr,c=t.contracts.VisualTooltip;i.createVisualHostTooltipServiceFactory=r;var u,p=(function(){function e(e,t,i,r,o,n,a,s){this.dataSources=e,this.explorationCapabilities=t,this.explorationNavigation=i,this.hostTooltip=r,this.lazyScoped=o,this.visualPlugin=n,this.viewModeState=a,this.eventBridge=s}return e.prototype.create=function(e,t,i){return new d(this.dataSources,this.explorationCapabilities,this.explorationNavigation,this.hostTooltip,this.lazyScoped,this.visualPlugin,this.viewModeState,this.eventBridge,e,t,i)},e})(),d=(function(){function t(e,t,i,r,o,n,a,s,l,c,u){this.dataSources=e,this.explorationCapabilities=t,this.explorationNavigation=i,this.hostTooltip=r,this.lazyScoped=o,this.visualPlugin=n,this.viewModeState=a,this.visualContainer=l,this.queryHandler=c,this.dataProxyService=u;var p=t.getCapabilities();this.ignoreTooltipDisable=this.explorationCapabilities.getCapabilities().visualContainerOptions.ignoreTooltipDisable,this.disableCanvasTooltips=p&&p.disableCanvasTooltips,this.visualTooltipData={sectionName:void 0,tooltipType:void 0,identities:void 0,filterContext:void 0},this.subscriptionManager=s.createChannelSubscriptionManager()}return t.handleEvents=function(t){return __awaiter(this,void 0,e.Promise,(function(){var e,i;return __generator(this,(function(r){switch(r.label){case 0:return[4,t];case 1:e=r.sent(),t=e.next,r.label=2;case 2:return r.trys.push([2,4,,5]),[4,e.handler()];case 3:return r.sent(),e.result.resolve(),[3,5];case 4:return i=r.sent(),e.result.reject(),[3,5];case 5:return[3,0];case 6:return[2]}}))}))},t.prototype.enqueue=function(i){this.tail||(this.tail=new e.Deferred,t.handleEvents(this.tail.promise));var r=new e.Deferred,o={next:r.promise,handler:i,result:new e.Deferred};return this.tail.resolve(o),this.tail=r,o.result.promise},t.prototype.show=function(t){var r=this;if(!this.enabled()){var o=new e.Deferred;return o.resolve(),o.promise}return this.enqueue((function(){return __awaiter(r,void 0,e.Promise,(function(){var e,r,o,n=this;return __generator(this,(function(a){switch(a.label){case 0:return this.enabled()?this.viewModeState.getConfig().displayOptions.enableTooltipActions?(e=this,r=this.visualHostActionsProvider,r?[3,2]:[4,this.lazyScoped("visualHostTooltipActionsProvider")]):[3,4]:[2];case 1:r=a.sent(),a.label=2;case 2:return e.visualHostActionsProvider=r,[4,this.visualHostActionsProvider.createTooltipCommands(t,this.visualContainer,this.dataProxyService,this.queryHandler)];case 3:a.sent(),a.label=4;case 4:return[4,this.buildData(t.identities)];case 5:return o=a.sent(),o=this.getCachedData(o),this.subscriptionManager.unsubscribeAll(),this.subscriptionManager.subscribe(i.events.canvasChanged,(function(){return n.hide({isTouchEvent:!1,immediately:!0})})).subscribe(i.events.visibilityChanged,(function(){return n.hide({isTouchEvent:!1,immediately:!0})})).subscribe(i.events.selectionChanged,(function(){return n.hide({isTouchEvent:!1,immediately:!0})})).subscribe(i.events.CanvasResized,(function(){return n.hide({isTouchEvent:!1,immediately:!0})})),this.hostTooltip.show({coordinates:t.coordinates,dataItems:t.dataItems,dataSources:this.dataSources.get(),explorationContract:this.explorationNavigation.getCurrentExploration(),explorationCapabilities:this.explorationCapabilities.getCapabilities(),identities:t.identities,isTouchEvent:t.isTouchEvent,visualTooltipData:o,visualHostTooltipActionsProvider:this.visualHostActionsProvider}),[2]}}))}))}))},t.prototype.move=function(t){var i=this;if(!this.enabled()){var r=new e.Deferred;return r.resolve(),r.promise}return this.enqueue((function(){return __awaiter(i,void 0,e.Promise,(function(){var e;return __generator(this,(function(i){switch(i.label){case 0:return this.enabled()?[4,this.buildData(t.identities)]:[2];case 1:return e=i.sent(),e=this.getCachedData(e),this.hostTooltip.move({coordinates:t.coordinates,dataItems:t.dataItems,dataSources:this.dataSources.get(),explorationContract:this.explorationNavigation.getCurrentExploration(),explorationCapabilities:this.explorationCapabilities.getCapabilities(),identities:t.identities,isTouchEvent:t.isTouchEvent,visualTooltipData:e}),[2]}}))}))}))},t.prototype.hide=function(t){var i=this;return this.enqueue((function(){return __awaiter(i,void 0,e.Promise,(function(){return __generator(this,(function(e){return this.hostTooltip.hide(t),this.subscriptionManager.unsubscribeAll(),[2]}))}))}))},t.prototype.visible=function(){return this.hostTooltip.visible()},t.prototype.container=function(){return this.hostTooltip.container()},t.prototype.enabled=function(){var e,t=this.visualContainer&&this.visualContainer.config.singleVisual.getEvaluatedObject,i=t&&t("visualTooltip"),r=this.getVisualCapabilities(),o=r&&r.tooltips,n=!o||void 0===o.showByDefault||o.showByDefault;return e=!!this.ignoreTooltipDisable||(i&&void 0!==i.show?i.show:n),!!e&&this.hostTooltip.enabled()},t.prototype.isTouchScreenOptimizedEnabled=function(){return this.hostTooltip.isTouchScreenOptimizedEnabled()},t.prototype.getCachedData=function(e){var t=this.visualTooltipData;return o(e.filterContext,t.filterContext)&&e.sectionName===t.sectionName&&e.tooltipType===t.tooltipType&&a.equalsSelectorsByColumnArray(e.identities,t.identities)||(this.visualTooltipData={filterContext:e.filterContext,identities:e.identities,sectionName:e.sectionName,tooltipType:e.tooltipType}),this.visualTooltipData},t.prototype.getVisualCapabilities=function(){return this.visualPlugin.capabilities(this.visualContainer.config.singleVisual.visualType)},t.prototype.buildData=function(t){return __awaiter(this,void 0,e.Promise,(function(){var e,i,r,o,n,a,s,l,p,d;return __generator(this,(function(h){switch(h.label){case 0:return e=this.visualContainer&&this.visualContainer.config.singleVisual.getEvaluatedObject("visualTooltip"),i=u.getTooltipType(e,this.getVisualCapabilities(),this.disableCanvasTooltips,t),i!==c.Canvas?[3,5]:(a=void 0,this.queryHandler&&this.visualContainer?[4,this.queryHandler.getCachedQueryOrGenerate({contract:this.visualContainer})]:[3,2]);case 1:s=h.sent(),a=s&&s.filterContext,h.label=2;case 2:return p=(l=u).getSectionAndFilterActionInfo,d={},[4,this.lazyScoped("drillthrough")];case 3:return[4,p.apply(l,[(d.drillthroughServices=h.sent(),d.explorationNavigation=this.explorationNavigation,d.identities=t,d.tooltipConfig=e,d.visualContainer=this.visualContainer,d.visualQueryFilterContext=a,d)])];case 4:n=h.sent(),null==n?(i=c.Default,n=void 0):(o=n.sectionName,r=n.getFilterContext()),h.label=5;case 5:return[2,{filterContext:r,identities:t,sectionName:o,tooltipType:i}]}}))}))},t})();!(function(t){function i(e,t,i,r){var o=t&&t.tooltips;if(!o||!o.supportedTypes||i||_.isEmpty(r))return c.Default;var n=e&&e.type||c.Canvas,a=!1,s=o.supportedTypes;switch(n){case c.Canvas:a=!!s.canvas;break;case c.Default:a=!!s.default;break;default:debug.assertNever(n)}return a||(n=c.Default),n}function r(t){return __awaiter(this,void 0,e.Promise,(function(){var e,i,r,n,a,s;return __generator(this,(function(l){switch(l.label){case 0:return e=t.tooltipConfig,i=e&&e.section||c.SectionAuto,r=i!==c.SectionAuto,!r||(n=t.explorationNavigation.getSectionByName(i),null!=n&&1&n.type)?(a=__assign({},t,{specifiedTargetSectionName:r?i:void 0}),[4,o(a)]):[2];case 1:return s=l.sent(),[2,s]}}))}))}function o(t){return __awaiter(this,void 0,e.Promise,(function(){var e,i,r,o,n,a,s,c,u;return __generator(this,(function(p){switch(p.label){case 0:return e=t.drillthroughServices,i=t.explorationNavigation,r=t.identities,o=t.visualContainer,_.isEmpty(r)?[2]:(n=i.getCurrentSection(),_.isEmpty(t.specifiedTargetSectionName)?[4,e.getMatchedSectionsInfo(1,n.name,o,r,t.visualQueryFilterContext)]:[3,2]);case 1:return a=p.sent(),_.isEmpty(a)?[2]:(s=_.chain(a).map((function(e){for(var t=0,i=0,r=0,o=e.matchedLinkFields;r<o.length;r++){var n=o[r],a=n.fieldExpr;n.asAggregation||!l.isColumn(a)&&!l.isHierarchyLevel(a)?(n.asAggregation||l.isMeasure(a))&&t++:i++}return{name:e.section.name,matchedColumns:i,matchedMeasures:t,getFilterContext:e.getFilterContext}})).orderBy(["getFilterContext","matchedMeasures","matchedColumns","name"],["desc","desc","desc","asc"]).value(),c=_.head(s),[2,{sectionName:c.name,getFilterContext:c.getFilterContext}]);case 2:return[4,e.getForcedMatchSectionInfo(1,t.specifiedTargetSectionName,n.name,o,r,t.visualQueryFilterContext)];case 3:if(u=p.sent())return[2,{sectionName:u.section.name,getFilterContext:u.getFilterContext}];p.label=4;case 4:return[2]}}))}))}t.getTooltipType=i,t.getSectionAndFilterActionInfo=r})(u=i.TooltipSelector||(i.TooltipSelector={}))})(i=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){function i(e,t,i){return new o(e,t,i)}var r=e.extensibility.convertVisualEventType;t.createVisualHostTelemetryService=i;var o=(function(){function t(e,t,i){this.telemetryService=e,this.visualType=t,this.instanceId=i}return t.prototype.trace=function(t,i){var o=r(t);if(o&&e.telemetry[o]){var n=e.telemetry[o];this.telemetryService.logEvent(n,this.visualType,this.instanceId,i)}},t})()})(i=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){function r(e,t,i,r,o,n,a){return new s(e,t,i,r,o,n,a)}var o=e.visualHost.CustomVisualsUtils,n=t.util.VisualContainerUtils,a=e.visualHost;
i.createVisualValidatorService=r;var s=(function(){function t(e,t,i,r,o,n,a){this.featureSwitchService=e,this.visualPlugin=t,this.scriptVisuals=i,this.shell=r,this.localizationService=o,this.trustedVisual=n,this.resourcePackageService=a}return t.prototype.validate=function(i,r){if(n.isScriptVisual(i,this.visualPlugin)){var o=n.getVisualType(i),s=e.explore.util.ScriptVisualsUtil.getScriptVisualType(o),l=void 0,c=void 0;switch(s){case 0:l=this.scriptVisuals.getScriptVisualErrorDetails(0,r),c="ScriptVisualsNotEnabled";break;case 1:l=this.scriptVisuals.getScriptVisualErrorDetails(1,r),c="PythonVisualsNotEnabled"}if(l)return{details:l,code:this.shell.areScriptVisualsApproved()?"ScriptVisualError":c}}var u=n.getVisualType(i);if(u){var p=this.visualPlugin.getPlugin(u);if(p&&p.apiVersion&&!e.extensibility.visualApiVersions.some((function(e){return e.version===p.apiVersion}))){var l={message:this.localizationService.get("CustomVisualApiVersionNotSupported"),displayableErrorInfo:[]};return{details:l,code:"CvApiVersionNotSupported"}}if(this.trustedVisual.isTrustedVisual(u)){var d=this.trustedVisual.validate(u);if(d)return{details:d,code:"TrustedVisualError"}}else{if(this.visualPlugin.isCustomVisual(u))return this.validateCustomVisual(u);if(!this.visualPlugin.getPlugin(u)){var l=t.buildErrorDetails(this.localizationService.get("VisualContainer_UnableToFindVisualMessage"),this.localizationService.get("VisualContainer_UnableToFindVisualKey"),this.localizationService.get("VisualContainer_UnableToFindVisualValue"));return{details:l,code:"UnsupportedVisual"}}if(a.utils.shouldDisableVisual(u,e.common.localize.shouldDisableMap())){var l=t.buildErrorDetails(this.localizationService.get("VisualContainer_NotSupportedForLocaleMessage"),this.localizationService.get("VisualContainer_NotSupportedForLocaleKey"),this.localizationService.get("VisualContainer_NotSupportedForLocaleValue"));return{details:l,code:"NotSupportedForLocale"}}}}},t.buildErrorDetails=function(e,t,i){return{message:e,displayableErrorInfo:[{errorInfoKey:t,errorInfoValue:i}]}},t.prototype.validateCustomVisual=function(e){var i,r,n;return this.featureSwitchService.featureSwitches.customVisuals?o.isCustomVisualTypeDisabled(this.featureSwitchService,e)?(n=t.buildErrorDetails(this.localizationService.get("VisualContainer_CustomVisualDisabledValue"),null,null),n.errorType=1,n.helpLink="https://go.microsoft.com/fwlink/?LinkID=690865",r="CustomVisualsPermissionLocked"):o.isOrganizationalCustomVisual(e)&&!this.resourcePackageService.getPackage(e)?(n=t.buildErrorDetails(this.localizationService.get("CustomVisualsAreNotAvailable"),null,null),n.errorType=1,n.helpLink="https://go.microsoft.com/fwlink/?LinkID=690865",r="CustomVisualAreNotAvailable"):this.resourcePackageService.getPackage(e)||(n=t.buildErrorDetails(this.localizationService.get("VisualContainer_ToSeeCustomVisual"),this.localizationService.get("CustomVisual"),e),r="CustomVisualNotFound"):(n=t.buildErrorDetails(this.localizationService.get("VisualContainer_CustomVisualDisabledMessage"),this.localizationService.get("VisualContainer_CustomVisualDisabledKey"),this.localizationService.get("VisualContainer_CustomVisualDisabledValue")),r="UnsupportedVisual"),r&&(i={code:r,details:n}),i},t})()})(i=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){function r(e){var t=e.sectionStatus.currentSectionNumber;return t<0&&e.exploration.sections.length>0&&(t=0),e.exploration.sections[t]}var o=e.explore.services.selectionUtils,n=e.visualHost.utils.ResourcePackageUtils,a=(function(){function a(){}return a.createUndoRedoHandler=function(a,s,l,c,u,p,d,h,v,g,f,y,m){return{takeSnapshot:function(t){var i=r(a).contract.name,o=e.explore.services.selectionUtils.getSelectedVisuals(l),n=[];if(o)for(var s=a.exploration.exploreCanvas.visualContainers,c=0,u=o;c<u.length;c++)for(var f=u[c],y=0;y<s.length;y++)if(f===s[y].contract){n.push(y);break}var m,S={withVisibility:!0,withTransientPages:!0,withTransientFilters:!0},w=p("drillToDetails").getContext();m=t&&null!=t.canvasLayout?t.canvasLayout:d&&d.getCurrentLayout();var C=h.serializeExploration(a.exploration.contract,S);return{contract:C,linguisticSchema:g.getSchema(a.exploration.contract.reportId),selectedSlide:i,selectedVisualsIndex:n,drillToDetailsState:w?w.toSnapshot(v):void 0,canvasLayout:m,getReferences:function(){var e=h.deserializeExploration(C,[],!0);return h.getReferencedStaticResources(e)}}},rollback:function(u){p("drillToDetails").clearContext();var S=h.deserializeExploration(u.contract,[],!0),w=h.getReferencedStaticResources(S);m.restoreReferences(w).then((function(){var h=v.getCurrentExploration(),m=n.getStaticResources(h.resourcePackages),w=n.getStaticResources(S.resourcePackages);for(var C in m){var b=m[C];w[C]||i.ResourcePackageUtils.ensureResourcePackages(S).push(_.clone(b));n.findResourcePackage(S.resourcePackages,b.type,b.name).items=_.map(b.items,(function(e){return _.clone(e)}))}y.removeAllCustomVisuals();var x=_.filter(S.resourcePackages,(function(e){return n.isCustomVisualResourcePackage(e)}));y.ensurePlugins(x).finally((function(){f.publishToChannel(t.services.events.visualPluginsChanged)}));var F=t.SectionUtils.findSectionIndexForSectionName(S,u.selectedSlide);a.sectionStatus.currentSectionNumber=F,a.exploration=t.viewModels.ViewModelFactory.convertExploration(S,u.canvasLayout,F),a.exploration.contract.themeCollection.highContrastTheme=h.themeCollection.highContrastTheme,a.exploration.contract.themeCollection.highContrastTheme||delete a.exploration.contract.themeCollection.highContrastTheme,g.setSchema(S.reportId,u.linguisticSchema);var D=r(a);v.loadExploration(a.exploration.contract),v.goto(D.contract),c.updateCrossDrillOfSectionOperation(D.contract),s((function(){var t=a.exploration.exploreCanvas.visualContainers,i=[];if(u.selectedVisualsIndex.length>0){for(var r=0,n=u.selectedVisualsIndex;r<n.length;r++){var s=n[r];t.length>s&&i.push(t[s].contract)}o.selectVisualContainers(i,l),u.drillToDetailsState&&p("drillToDetails").setContext(e.requireSync("ExploreUI/services/drillToDetails").snapshotToContext(u.drillToDetailsState,v))}else l.clearSelection();d.changeFormFactor(u.canvasLayout,a)}),0)}))}}},a})();i.ExploreUndoRedoHandlerUtility=a})(i=t.util||(t.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={})),angular.module("powerbi.explore").run(["$templateCache",function(e){e.put("components/accessibilityInfo/accessibilityInfo.html",'<div class="accessibility-info accessibility-info-collapsed"><a localize="AccessibilityInfo_Link" target="_blank" href=\'https://go.microsoft.com/fwlink/?linkid=852575\'></a><a href="javascript:void(0)" localize="AccessibilityInfo_SkipToContent" accessible-click="$ctrl.skipToContent()" role="button"></a><span tabindex="0" aria-label="{{::$ctrl.keyDescription }}" ng-bind="::$ctrl.keyDescription"></span></div>'),e.put("components/advancedFilter/advancedFilter.html",'<li class="advanced"><h3 class="description" localize="AdvancedFilter_Description"/><div ng-repeat="condition in advFilterCard.conditions"><jq-select classes="comparisonOperator advancedControl" ng-model="condition.operator" ng-style="{ \'background-color\': backgroundColor, \'color\': color }" ng-change="markDirty()" ng-disabled="viewModel.readOnlyState.disabled" options="advFilterCard.operators" expression="operatorInfo.value as operatorInfo.label for operatorInfo in options"></jq-select><div class="advancedControl conditionValue flex" ng-if="!advFilterCard.isDateTime" ng-show="condition.valueRequired"> <input type="text" class="item-fill" ng-model="condition.value.stringValue" ng-style="{ \'background-color\': backgroundColor, \'color\': color }" ng-disabled="viewModel.readOnlyState.disabled" ng-focus="handleFocusedInputChanged($event, condition)" ng-blur="handleInputBlur()" ng-change="validateFilterInput(condition); markDirty();" fast-keyup="keyUp($event)"/><span class="errorIcon item-auto" ng-if="condition.isInvalid" tooltip tooltip-config="tooltipConfig"><svg-use-symbol sheet="filterPaneIcons" symbol-id="\'alert\'"></svg-use-symbol></span></div><section class="datetime datetimePicker datetimePickerClassic" ng-if="advFilterCard.isDateTime" ng-show="condition.valueRequired" pbi-lazy-load-contents="moduleConfig" ng-class="{datetimePickerOutspace: useNewFilterPane}"><div class="datePicker flex"> <input type="text" class="calendarInput item-fill" ng-blur="dateTextUpdateComplete(condition)" ng-change="dateTextUpdated(condition); markDirty();" ng-model="condition.value.value" ng-style="{ \'background-color\': backgroundColor, \'color\': color }" ng-disabled="!condition.valueRequired || viewModel.readOnlyState.disabled" placeholder="{{::datePlaceholder}}" fast-keyup="keyUp($event)"/> <button type="button" class="filterPaneIcon calendar item-auto glyphicon glyph-mini pbi-glyph-calendar" ng-disabled="!condition.valueRequired || viewModel.readOnlyState.disabled" dropdown-overlay-invoke="{{getMenuId($index)}}"></button><dropdown-overlay class="datetime calendarDropDown" dropdown-overlay-name="{{getMenuId($index)}}"><datepicker class="calendar" ng-model="condition.value.dateValue" ng-disabled="!condition.valueRequired || viewModel.readOnlyState.disabled" ng-change="dateSelected(condition)" onclick="event.stopPropagation()" show-weeks="false"></datepicker></dropdown-overlay></div><timepicker class="timePicker" readonly-input="viewModel.readOnlyState.disabled" ng-model="condition.value.timePickerValue" ng-model-options="{ getterSetter: true }" ng-change="timeSelected(condition)"></timepicker></section><section role="radiogroup" ng-keyDown="changeOperator($event)" class="logicalOperator advancedControl" ng-if="$index < (advFilterCard.conditions.length -1)"> <label role="radio" class="logicalOperatorField" ng-attr-tabindex="{{advFilterCard.logicalOperator === advFilterCard.logicalAndOperator ? 0 : -1}}" ng-attr-aria-checked="{{advFilterCard.logicalOperator === advFilterCard.logicalAndOperator ? \'true\' : \'false\'}}"><input type="radio" ng-model="advFilterCard.logicalOperator" ng-value="advFilterCard.logicalAndOperator" ng-disabled="viewModel.readOnlyState.disabled" ng-change="markDirty()" ng-checked="advFilterCard.logicalOperator === advFilterCard.logicalAndOperator"/><span class="glyphicon glyph-mini" ng-class="advFilterCard.logicalOperator === advFilterCard.logicalAndOperator ? \'pbi-glyph-radiobtnon\' : \'pbi-glyph-radiobtnoff\'"/><span localize="Logical_And_Operator"/></label> <label class="logicalOperatorField" role="radio" ng-attr-tabindex="{{advFilterCard.logicalOperator === advFilterCard.logicalOrOperator ? 0 : -1}}" ng-attr-aria-checked="{{advFilterCard.logicalOperator === advFilterCard.logicalOrOperator ? \'true\' : \'false\'}}"><input type="radio" ng-model="advFilterCard.logicalOperator" ng-value="advFilterCard.logicalOrOperator" ng-disabled="viewModel.readOnlyState.disabled" ng-change="markDirty()" ng-checked="advFilterCard.logicalOperator === advFilterCard.logicalOrOperator"/><span class="glyphicon glyph-mini" ng-class="advFilterCard.logicalOperator !== advFilterCard.logicalAndOperator ? \'pbi-glyph-radiobtnon\' : \'pbi-glyph-radiobtnoff\'"/><span localize="Logical_Or_Operator"/></label></section></div> <button class="applyFilter smallFontSize" localize="Filter_ApplyFilter" localize-tooltip="Filter_ApplyFilterDescription" ng-click="applyFilter()" ng-disabled="!canApplyFilter()"/></li>'),e.put("components/boxGrid/boxGrid.html",'<triggered-recompile trigger="$ctrl.viewModel"><svg class="box-grid" ng-class="{lowOpacity: !$ctrl.viewModel.style.fullOpacity}" ng-style="{{::$ctrl.getSvgStyle()}}" ng-attr-width="{{::$ctrl.getSvgWidth()}}" ng-attr-height="{{::$ctrl.getSvgHeight()}}"><g ng-repeat="row in ::$ctrl.getRows()"><rect ng-repeat="column in ::$ctrl.getColumns()" ng-attr-width="{{::$ctrl.getBoxWidth()}}" ng-attr-height="{{::$ctrl.getBoxHeight()}}" ng-attr-x="{{::$ctrl.getBoxX(column)}}" ng-attr-y="{{::$ctrl.getBoxY(row)}}"></rect></g></svg></triggered-recompile>'),e.put("components/canvasTooltip/canvasTooltip.html",'<div class="explorationContainer" ng-if="$ctrl.explorationContract && $ctrl.sectionName && $ctrl.canvasLayout != null && $ctrl.pluginsLoaded" ng-style="{width: $ctrl.canvasSize.width, height: $ctrl.canvasSize.height}"><exploration-scoped-services-bridge><standalone-canvas layout="$ctrl.canvasLayout" exploration-contract="$ctrl.explorationContract" section-name="$ctrl.sectionName" show-mask="$ctrl.showCanvasMask"></standalone-canvas></exploration-scoped-services-bridge></div>'),e.put("components/canvasVisualErrorOverlay/canvasVisualErrorOverlay.html",'<div class="errorMessage themableBackgroundColorSolid"><div ng-switch="$ctrl.errorInfo.overlayType"><div class="glyphicon pbi-glyph-error glyph-med" ng-switch-default></div><div class="glyphicon pbi-glyph-blockedsite glyph-med" ng-switch-when="1"></div></div><div><span class="errorSpan" ng-bind="$ctrl.errorInfo.details.message" ng-show="$ctrl.showErrorMessage"/><ng-switch on="$ctrl.errorInfo.details.errorType"><a localize="VisualContainer_ShowErrorDetails" localize-tooltip="VisualContainer_ShowErrorDetails" class="errorSeeMore" href ng-click="$ctrl.showErrorDetails()" ng-if="!$ctrl.errorInfo.hideSeeDetails" ng-switch-default/><a localize="LearnMore" localize-tooltip="VisualContainer_LearnMoreLinkText" class="errorSeeMore" ng-href="{{ $ctrl.errorInfo.details.helpLink }}" target="_blank" ng-switch-when="1"/></ng-switch></div><div class="fixThisContainer"> <button class="primary" ng-show="$ctrl.isFixButtonVisible" ng-click="$ctrl.fixErrors() "><ng-switch on="$ctrl.errorInfo.fixableError"><span ng-switch-when="1" localize="Fix_This" localize-tooltip="FixReferences_ToolTip"></span><span ng-switch-when="2" localize="Fix_This" localize-tooltip="RelationshipDetection_Tooltip"></span><span ng-switch-when="3" localize="Fix_This" localize-tooltip="FixReferences_ToolTip"></span><span ng-switch-when="4|5" ng-switch-when-separator="|" localize="VisualContainer_EnableScriptVisuals"></span></ng-switch></button></div></div>'),e.put("components/dateTimePicker/dateTimePicker.html",'<div class="datetimePicker" pbi-lazy-load-contents="$ctrl.moduleConfig"> <input type="text" class="inputFieldInSlice" ng-blur="$ctrl.dateTextUpdated()" ng-model="$ctrl.textVal" ng-class="{\'ng-invalid\': $ctrl.inputInvalid}" placeholder="{{::$ctrl.placeholder}}"/> <button class="calendar" type="button" dropdown-overlay-invoke="{{$ctrl.id}}"><svg-use-symbol sheet="filterPaneIcons" symbol-id="\'fieldListEntity\'"></svg-use-symbol></button><dropdown-overlay class="calendarDropDown" dropdown-overlay-name="{{$ctrl.id}}"><datepicker class="calendar" ng-model="$ctrl.dateVal" ng-change="$ctrl.dateSelected()" onclick="event.stopPropagation()" show-weeks="false" min-date="$ctrl.validators.min" max-date="$ctrl.validators.max"></datepicker></dropdown-overlay></div>'),e.put("components/detailVisual/detailVisual.html",'<div class="detailVisual" role="document" focus-nav-mode="Group" ng-switch="$ctrl.viewModel.hasData"><visual view-model="$ctrl.viewModel.visual" ng-switch-when="true"></visual><div class="noDataOverlay" ng-switch-when="false"></div></div>'),e.put("components/explorationFooter/explorationFooter.html",'<div class="explorationNavigationContent unselectable {{$ctrl.getModeString()}}" tabindex="0" keyboard-shortcuts="ctrl-F6" focus-nav-mode="Group" groupindex="1"><div class="background"></div><ul ng-if="!$ctrl.isBookmarkView()" class="pane sections" role="tablist"><carousel auto-resize="true" on-see-all="$ctrl.seeAllSections(event)" is-reading-mode="$ctrl.isReadingMode()"><li class="section static" ng-class="{\'selected\' : page.selected, \'hidden-in-view-mode\': $ctrl.isHiddenInViewMode(page)}" ng-repeat="page in $ctrl.viewModel.exploration.sections"><exploration-navigation-tab class="section dynamic" view-model="page" is-editing="$ctrl.isEditMode()" tab-index="$index" ng-style="page.style" is-only-visible-tab="$ctrl.isOnlySectionVisibleInViewMode(page)" is-hidden-in-view-mode="$ctrl.isHiddenInViewMode(page)"></exploration-navigation-tab></li></carousel><li ng-if="$ctrl.isEditMode()" class="section static create" accessible-click="$ctrl.createSection()" localize-tooltip="Carousel_NewPage" tabindex="0" focus-element role="button"><div class="thumbnail-container"><div class="thumbnail createSectionButton"><svg-use-symbol sheet="exploreCanvasIcons" symbol-id="\'slidethumb_addnew\'"></svg-use-symbol></div></div></li></ul><ul ng-if="$ctrl.isBookmarkView()" class="pane sections" pbi-lazy-load-contents="$ctrl.exploreUIShellConfig"><bookmark-play selected-bookmark="$ctrl.viewModel.exploration.contract.activeBookmark"></bookmark-play></ul></div>'),e.put("components/filter/filter.html",'<li class="card {{$ctrl.getFilterClass()}}" ng-if="!$ctrl.useNewFilterPane || !$ctrl.viewModel.isFilterHidden()" ng-style="{\'background-color\': $ctrl.backgroundColor, \'border-color\': $ctrl.borderColor }"><div class="filterCardTitleSection" accessible-click="$ctrl.toggle($event, $ctrl.viewModel)"><div class="cardHeader" ng-attr-tooltip="$ctrl.viewModel.readOnlyState.invalid" tooltip-config="$ctrl.tooltipConfigManager.getTooltipConfig()"><h2 class="title trimmedTextWithEllipsis unselectable" ng-bind-attr="{title: $ctrl.getTooltip()}" ng-class="{\'hasRestateHighlight\': $ctrl.isFilterApplied()}"><i ng-if="$ctrl.viewModel.readOnlyState.invalid" class="filterPaneIcon error"><svg-use-symbol sheet="filterPaneIcons" symbol-id="\'fieldListError\'"></svg-use-symbol></i><i ng-if="$ctrl.getIconClassName() != null" class="filterPaneIcon {{$ctrl.getIconClassName()}}"><svg-use-symbol sheet="filterPaneIcons" symbol-id="$ctrl.getIconClassName()"></svg-use-symbol></i><span ng-bind="$ctrl.getDisplayName()" class="filterCardTitle" tabindex="0" aria-label="{{$ctrl.getAriaLabelString()}}" role="text"></span></h2><span ng-if="$ctrl.useNewFilterPane && $ctrl.isInOutspacePane && $ctrl.viewModel.contract.isLockedInViewMode" class="lock pbi-glyph-lock glyphicon glyph-mini" localize-tooltip="{{$ctrl.getFilterLockTooltip()}}" dynamic-tooltip-update="true"></span> <button ng-if="$ctrl.showExpandIcon()" class="glyphicon glyph-mini" type="button" ng-class="$ctrl.viewModel.isFilterExpanded() ? \'expand\' : \'collapse\'" ng-bind-attr="{title: $ctrl.viewModel.isFilterExpanded() ?  $ctrl.viewModel.chevronCollapseDescription : $ctrl.viewModel.chevronExpandDescription}"></button> <button class="delete glyphicon pbi-glyph-close glyph-micro" ng-click="$ctrl.deleteFilter($event, $ctrl.viewModel)" localize-tooltip="FilterPane_DeleteFilter" ng-if="$ctrl.viewModel.canDeleteManually"></button></div><div ng-class="{\'cardExpanded\': $ctrl.viewModel.isFilterExpanded()}" class="controlPanel" ng-if="!$ctrl.isInOutspacePane || $ctrl.getRestatement().length> 0"> <button ng-if="$ctrl.showVisibilityIcon()" class="filterPaneIcon hide glyphicon glyph-mini" ng-class="{\'pbi-glyph-view\':!$ctrl.viewModel.contract.isHiddenInViewMode, \'pbi-glyph-hide2\':$ctrl.viewModel.contract.isHiddenInViewMode}" ng-click="$ctrl.toggleFilterVisibility($event, $ctrl.viewModel)" localize-tooltip="{{$ctrl.viewModel.contract.isHiddenInViewMode ? \'FilterPane_ShowFilter\' : \'FilterPane_HideFilter\'}}" dynamic-tooltip-update="true"></button> <button ng-if="$ctrl.showLockIcon()" class="filterPaneIcon lock glyphicon glyph-mini" ng-class="{\'pbi-glyph-lock\': $ctrl.viewModel.contract.isLockedInViewMode, \'pbi-glyph-unlock\': !$ctrl.viewModel.contract.isLockedInViewMode}" ng-click="$ctrl.toggleFilterLockState($event, $ctrl.viewModel)" localize-tooltip="{{$ctrl.getFilterLockTooltip()}}" dynamic-tooltip-update="true"></button> <button ng-if="$ctrl.showClearIcon()" class="filterPaneIcon clear glyphicon glyph-mini pbi-glyph-eraser" ng-style="{\'color\': $ctrl.color }" ng-click="$ctrl.clearFilter($event, $ctrl.viewModel)" localize-tooltip="FilterPane_ClearFilter"></button> <button ng-if="$ctrl.viewModel.hasDefaultValue" class="filterPaneIcon clear glyphicon glyph-mini pbi-glyph-eraser" ng-click="$ctrl.restoreDefaultFilter($event, $ctrl.viewModel)" localize-tooltip="FilterPane_ResetDefault"></button><h2 class="restatement {{$ctrl.viewModel.restatementLineStyleRule}}" ng-bind-attr="{title: $ctrl.getRestatement()}" ng-bind="$ctrl.getRestatement()"></h2></div></div><div ng-if="$ctrl.showLinkFieldOptions()" class=\'linkFieldOptions\'><h2 localize="$ctrl.getResourceIdForAsAggregationDropdown()" class="asAggregationTitle smallFontSize trimmedTextWithEllipsis"></h2> <select class="asAggregation" ng-model="$ctrl.viewModel.isLinkedAsAggregation" ng-options="$ctrl.getLabelForAsAggregationOption(!!item) for item in [true, false]" ng-change="$ctrl.updateLinkAsAggregation()" ng-disabled="$ctrl.viewModel.discourageAggregation"></select></div><div ng-show="$ctrl.viewModel.canExpandManually && $ctrl.viewModel.isFilterExpanded() && !($ctrl.viewModel.isLinkField && $ctrl.viewModel.isLinkedAsAggregation)" class=\'filterContent\'><div ng-if="$ctrl.showFilterTypeSelection()"><h2 class="typeSelectTitle trimmedTextWithEllipsis smallFontSize" localize="FilterCardTypeSwitchLabel"></h2><jq-select classes="typeSwitchOptions" ng-class="{ invalidType: $ctrl.viewModel.cardType.invalid }" options="$ctrl.viewModel.availableTypes" expression="cardType.label for cardType in options track by cardType.label" ng-init="$ctrl.viewModel.cardType" ng-model="$ctrl.viewModel.cardType" ng-change="$ctrl.switchCardType(cardType)"></jq-select></div><ul><advanced-filter view-model="$ctrl.viewModel" ng-if="$ctrl.viewModel.cardType.type === 2"></advanced-filter><filter-visual view-model="$ctrl.viewModel" is-in-outspace-pane="$ctrl.isInOutspacePane" ng-if="($ctrl.viewModel.cardType.type === 0 || $ctrl.viewModel.cardType.type === 4)" expanded="$ctrl.viewModel.readOnlyState.expanded"></filter-visual><top-n-filter view-model="$ctrl.viewModel" ng-if="$ctrl.viewModel.cardType.type === 5"></top-n-filter><relative-date-filter view-model="$ctrl.viewModel" ng-if="$ctrl.viewModel.cardType.type === 8"></relative-date-filter><include-exclude-filter ng-if="($ctrl.viewModel.readOnlyState.type === 6 || $ctrl.viewModel.readOnlyState.type === 7) && $ctrl.viewModel.isFilterExpanded()" filter-view-model="$ctrl.viewModel" is-in-outspace-pane="$ctrl.isInOutspacePane" ng-class="{\'includeExcludeFilterOutspace\': $ctrl.isInOutspacePane}"></include-exclude-filter></ul></div></li>'),e.put("components/filterPane/filterPane.html",'<section class="filterPane filterPaneClassic" ng-class="{filterPaneOutspace: $ctrl.useNewFilterPane}"><h3 id="noFiltersHeader" class="header caption mediumFontSize" ng-if="showNoFiltersHeader()" tabindex="0" localize="No_Filter_For_Visual_FilterPane" ng-style="{ \'font-family\': $ctrl.headerFontFamily, \'font-size\': $ctrl.headerFontSize }"></h3><div id="visualFilterContainer" class="bucket" ng-if="isVisualFiltersVisible()"><div class="header"><h3 class="caption trimmedTextWithEllipsis" tabindex="0" localize="{{::$ctrl.filterPaneHeaderLocalization_Visual}}" localize-tooltip="FilterPane_VisualDescription" ng-style="{ \'font-family\': $ctrl.headerFontFamily, \'font-size\': $ctrl.headerFontSize }"></h3></div> <button ng-if="$ctrl.useNewFilterPane && enableFilterAddExperience()" class="add glyphicon pbi-glyph-addcircle" ng-click="toggleFieldList(0)" localize-tooltip="FilterPane_AddFilter"></button><div class="cards" drop="dropConfig" drop-handler="dropVisualFilter(event, ui, dropAction)" drop-action="getDropAction(dropPosition)"><ul><filter ng-repeat="filter in viewModel.visualFilters" view-model="filter" section-objects="$ctrl.sectionObjects" is-in-outspace-pane="$ctrl.isInOutspacePane"></filter></ul><div ng-if="!$ctrl.isInOutspacePane && viewModeState.getMode() === 1" ng-attr-tabindex="{{viewModel.visualFilters.length === 0 ? 1 : -1}}" class="unselectable trimmedTextWithEllipsis" ng-class="viewModel.visualFilters.length === 0 ? \'dropzone\' : \'end-dropzone\'" title="{{viewModel.visualFilters.length === 0 ? viewModel.addFilterLabel : \'\'}}"> {{viewModel.visualFilters.length === 0 ? viewModel.addFilterLabel : \'\'}}</div></div><div class="fieldListContainer" ng-if="isFieldListShown(0)"><field-list field-list-config="::fieldListConfig" on-property-clicked="createAdhocFilter(property, expr, 0)"></field-list></div></div><div id="pageFilterContainer" class="bucket" ng-if="isPageFiltersVisible()"><div class="header"><h3 class="caption trimmedTextWithEllipsis" tabindex="0" localize="{{::$ctrl.filterPaneHeaderLocalization_Page}}" localize-tooltip="FilterPane_PageDescription" ng-style="{ \'font-family\': $ctrl.headerFontFamily, \'font-size\': $ctrl.headerFontSize }"></h3></div> <button ng-if="$ctrl.useNewFilterPane && enableFilterAddExperience()" class="add glyphicon pbi-glyph-addcircle" ng-click="toggleFieldList(1)" localize-tooltip="FilterPane_AddFilter"></button><div class="cards" drop="dropConfig" drop-handler="dropPageFilter(event, ui, dropAction)" drop-action="getDropAction(dropPosition)"><ul><filter ng-repeat="filter in viewModel.pageFilters" view-model="filter" section-objects="$ctrl.sectionObjects" is-in-outspace-pane="$ctrl.isInOutspacePane"></filter><filter ng-repeat="filter in viewModel.drillthroughFilters" ng-if="$ctrl.isInOutspacePane" view-model="filter" is-in-outspace-pane="$ctrl.isInOutspacePane" section-objects="$ctrl.sectionObjects"></filter></ul><div ng-attr-tabindex="{{viewModel.pageFilters.length === 0 ? 0 : -1}}" ng-if="!$ctrl.isInOutspacePane && (viewModeState.getConfig().alwaysPopulatePanes || viewModeState.getMode() === 1)" class="unselectable trimmedTextWithEllipsis" ng-class="viewModel.pageFilters.length === 0 ? \'dropzone\' : \'end-dropzone\'" title="{{viewModel.pageFilters.length === 0 ? viewModel.addFilterLabel : \'\'}}"> {{viewModel.pageFilters.length === 0 ? viewModel.addFilterLabel : \'\'}}</div></div><div class="fieldListContainer" ng-if="isFieldListShown(1)"><field-list field-list-config="::fieldListConfig" on-property-clicked="createAdhocFilter(property, expr, 1)"></field-list></div></div><div id="drillthroughFilterContainer" class="bucket" ng-if="isDrillthroughFiltersVisible()"><div class="header"><h3 class="caption trimmedTextWithEllipsis" tabindex="0" localize="FilterPane_Drillthrough" localize-tooltip="FilterPane_DrillthroughDescription" ng-style="{ \'font-family\': $ctrl.headerFontFamily, \'font-size\': $ctrl.headerFontSize }"></h3></div><div class="cards" drop="dropConfig" drop-handler="dropDrillthroughFilter(event, ui, dropAction)" drop-action="getDropAction(dropPosition)"><ul><filter ng-repeat="filter in viewModel.drillthroughFilters" view-model="filter" section-objects="$ctrl.sectionObjects" is-in-outspace-pane="$ctrl.isInOutspacePane"></filter></ul><div ng-if="!$ctrl.isInOutspacePane && (viewModeState.getConfig().alwaysPopulatePanes || viewModeState.getMode() === 1)" ng-attr-tabindex="{{viewModel.drillthroughFilters.length === 0 ? 0 : -1}}" class="unselectable trimmedTextWithEllipsis" ng-class="viewModel.drillthroughFilters.length === 0 ? \'dropzone\' : \'end-dropzone\'" title="{{viewModel.drillthroughFilters.length === 0 ? viewModel.addDrillthroughFilterLabel : \'\'}}"> {{viewModel.drillthroughFilters.length === 0 ? viewModel.addDrillthroughFilterLabel : \'\'}}</div></div></div><div pbi-lazy-load-contents="exploreUIShellConfig" ng-if="isTooltipLinksVisible()"><drillthrough-links></drillthrough-links></div><div id="exploreFilterContainer" class="bucket" ng-if="isReportFiltersVisible()"><div class="header"><h3 class="caption trimmedTextWithEllipsis" tabindex="0" localize="{{::$ctrl.filterPaneHeaderLocalization_Report}}" localize-tooltip="FilterPane_ReportDescription" ng-style="{ \'font-family\': $ctrl.headerFontFamily, \'font-size\': $ctrl.headerFontSize }"></h3></div> <button ng-if="$ctrl.useNewFilterPane && enableFilterAddExperience()" class="add glyphicon pbi-glyph-addcircle" ng-click="toggleFieldList(2)" localize-tooltip="FilterPane_AddFilter"></button><div class="cards" drop="dropConfig" drop-handler="dropReportFilter(event, ui, dropAction)" drop-action="getDropAction(dropPosition)"><ul><filter ng-repeat="filter in viewModel.reportFilters" view-model="filter" section-objects="$ctrl.sectionObjects" is-in-outspace-pane="$ctrl.isInOutspacePane"></filter></ul><div ng-if="!$ctrl.isInOutspacePane && (viewModeState.getConfig().alwaysPopulatePanes || viewModeState.getMode() === 1)" ng-attr-tabindex="{{viewModel.reportFilters.length === 0 ? 0 : -1}}" class="unselectable trimmedTextWithEllipsis" ng-class="viewModel.reportFilters.length === 0 ? \'dropzone\' : \'end-dropzone\'" title="{{viewModel.reportFilters.length === 0 ? viewModel.addFilterLabel : \'\'}}"> {{viewModel.reportFilters.length === 0 ? viewModel.addFilterLabel : \'\'}}</div><div class="fieldListContainer" ng-if="isFieldListShown(2)"><field-list field-list-config="::fieldListConfig" on-property-clicked="createAdhocFilter(property, expr, 2)"></field-list></div></div></div></section>'),e.put("components/filterVisual/filterVisual.html",'<div class="filterVisual"><visual ng-if="$ctrl.dataLoaded" view-model="$ctrl.viewModel.readOnlyState.visual"></visual><div class="filterSpinner" ng-if="$ctrl.viewModel.isLoading && !$ctrl.dataLoaded"><spinner></spinner><span class="message" localize="FilterCard_Loading"/></div><div class="filterError" ng-if="$ctrl.hasQueryError"><i class="icon filterPaneIcon error"><svg-use-symbol sheet="filterPaneIcons" symbol-id="\'fieldListError\'"></svg-use-symbol></i><span class="message" localize="FilterCard_ErrorMessage"/></div> <button class="applyFilter smallFontSize" localize="Filter_ApplyFilter" localize-tooltip="Filter_ApplyFilterDescription" ng-if="$ctrl.isApplyButtonVisible()" ng-disabled="!$ctrl.isApplyButtonEnabled()" ng-click="$ctrl.onApplyButtonClicked()"/></div><div class="cardFooter" ng-if="$ctrl.viewModel.readOnlyState.canToggleSingleSelect && !$ctrl.isInOutspacePane"><pbi-context class="required flex vertiPad" context="compact"><pbi-checkbox ng-change="$ctrl.updateRequiredState()" label="PageFilter_SingleSelectionRequired" aria-label="{{::$ctrl.requireSingleSelectLabel}}" ng-disabled="$ctrl.viewModel.isSingleSelectDisabled()" ng-model="$ctrl.viewModel.isSingleSelectionRequired" localize-tooltip="PageFilter_SingleSelectionRequired_Tooltip"></pbi-checkbox></pbi-context></div>'),e.put("components/includeExcludeFilter/includeExcludeFilter.html",'<div class="include-exclude-filter-items"><ng-scrollbars ng-scrollbars-config="::$ctrl.scrollbarsConfig"><div class="include-exclude-filter-item flex" ng-repeat="dataPoint in $ctrl.viewModel.points"><div tabindex="0" class="caption smallFontSize trimmedTextWithEllipsis unselectable item-fill" ng-bind-attr="{title: dataPoint.text}" ng-bind="dataPoint.text"></div> <button ng-if="!$ctrl.filterViewModel.isFilterLocked()" type="button" class="delete glyphicon pbi-glyph-close glyph-micro" ng-click="$ctrl.delete($event, dataPoint, $index)"></button></div></ng-scrollbars></div>'),e.put("components/instancePicker/instancePicker.html",'<visual ng-if="$ctrl.ngModel.$viewValue.field" class="slicerVisual" view-model="$ctrl.visual"></visual>'),e.put("components/penAnnotation/penAnnotation.html",'<canvas class="penAnnotationCanvas"></canvas>'),e.put("components/relativeDateFilter/relativeDateFilter.html",'<form name="$ctrl.filterForm" class="relativeDateFilter" ng-submit="$ctrl.applyFilter()" ng-class="{ invalid: $ctrl.viewModel.cardType.invalid }"><h3 class="description" localize="RelativeDateFilter_ShowItems"></h3><div class="relativeDateFilterSettings"><jq-select classes="filterInput" ng-model="$ctrl.vm.relativeQualifier" ng-style="{ \'background-color\': $ctrl.backgroundColor, \'color\': $ctrl.color }" ng-change="$ctrl.vm.onRelativeQualifierChanged()" options="$ctrl.vm.relativeQualifiers" expression="qualifier.text for qualifier in options track by qualifier.value"></jq-select> <input class="filterInput" type="number" ng-if="$ctrl.vm.isDurationApplicable()" ng-model="$ctrl.vm.duration" ng-style="{ \'background-color\': $ctrl.backgroundColor, \'color\': $ctrl.color }" title="{{\'1-\'+$ctrl.vm.getDurationMax()}}" ng-min="1" ng-max="$ctrl.vm.getDurationMax()"/><jq-select classes="filterInput" ng-if="$ctrl.vm.isDurationApplicable()" ng-model="$ctrl.vm.relativeUnit" ng-style="{ \'background-color\': $ctrl.backgroundColor, \'color\': $ctrl.color }" options="$ctrl.vm.relativeUnitsAll" expression="unit.text for unit in options track by unit.value"></jq-select><jq-select classes="filterInput" ng-if="!$ctrl.vm.isDurationApplicable()" ng-model="$ctrl.vm.relativeUnit" ng-style="{ \'background-color\': $ctrl.backgroundColor, \'color\': $ctrl.color }" options="$ctrl.vm.relativeUnitsCurrent" expression="unit.text for unit in options track by unit.value"></jq-select><div class="footerSection" ng-if="$ctrl.vm.isIncludeTodayApplicable()"> <input type="checkbox" id="includeTodayCheckbox" onclick="event.stopPropagation()" ng-model="$ctrl.vm.includeToday"/><label for="includeTodayCheckbox" localize="RelativeDateFilter_IncludeToday" onclick="event.stopPropagation()"/></div></div> <button type="submit" class="applyFilter smallFontSize" localize="Filter_ApplyFilter" localize-tooltip="Filter_ApplyFilterDescription" ng-disabled="!$ctrl.canApplyFilter()"/></form>'),
e.put("components/singleVisualHost/singleVisualHost.html",'<div class="visualSite"><visual view-model="$ctrl.visualDefinition" allow-deferred-rendering="true"></visual></div>'),e.put("components/standaloneCanvas/standaloneCanvas.html",'<div class="busyMask" ng-class="{showMask: $ctrl.showMask, fadeOnLoading: $ctrl.fadeOnLoading}"><explore-canvas ng-if="$ctrl.viewModel" view-model="$ctrl.viewModel" disable-print="true" canvas-options="$ctrl.canvasOptions" disable-outspace-pane="$ctrl.disableOutspacePane"></explore-canvas></div>'),e.put("components/tooltipActions/tooltipActions.html",'<tooltip-child-menu ng-if="!!$ctrl.childMenu" commands-menu="::$ctrl.childMenu" on-hide="::$ctrl.onHide()"></tooltip-child-menu><div class="tooltip-actions-container"> <button class="action-button close-button" ng-click="$ctrl.hide()"><div class="glyphicon pbi-glyph-close"></div></button> <button class="action-button" ng-repeat="command in $ctrl.commands" ng-class="command.command.title()" ng-click="$ctrl.execute(command.command)" ng-disabled="!command.enabled"><div class=" glyphicon" ng-class="command.command.glyph"></div></button></div>'),e.put("components/tooltipChildMenu/tooltipChildMenu.html",'<div class="tooltip-children-container"> <button class="child-action" ng-repeat="command in $ctrl.commandsMenu" accessible-click="$ctrl.execute(command)"> <label>{{command.title()}}</label><div class="chevron glyphicon pbi-glyph-chevronrightmedium"></div></button></div>'),e.put("components/topNFilter/topNFilter.html",'<form name="$ctrl.topNFilterForm" class="topNFilter" ng-submit="$ctrl.applyFilter()" ng-class="{ invalid: $ctrl.viewModel.cardType.invalid }"><pbi-alert ng-if="$ctrl.viewModel.cardType.invalid" kind="\'warning\'" message-warning="\'TopNFilter_SingleTopNAllowedWarning\'"></pbi-alert><fieldset class="filterOptions" ng-disabled="$ctrl.viewModel.cardType.invalid"><legend localize="TopNFilter_ShowItems"></legend><div class="topNSelector topNInputArea flex"><jq-select ng-if="$ctrl.vm.targetType" ng-style="{\'background-color\': $ctrl.backgroundColor, \'color\': $ctrl.color}" classes="item-fill topNInputBox" options="$ctrl.vm.filterTypes" expression="filterType.text for filterType in options track by filterType.text" ng-model="$ctrl.vm.targetType"></jq-select> <input class="item-fill topNInputBox topNNumber" ng-style="{\'background-color\': $ctrl.backgroundColor, \'color\': $ctrl.color}" type="number" ng-pattern="/^[1-9][0-9]{0,6}$/" ng-model="$ctrl.vm.itemCount"/></div></fieldset><fieldset class="orderBy" ng-disabled="$ctrl.viewModel.cardType.invalid"><legend localize="TopNFilter_Value"></legend><div class="topNInputArea ui-droppable dropzone topNInputBox" ng-class="{filled: $ctrl.vm.orderByDisplayName}" ng-style="{\'background-color\': $ctrl.backgroundColor, \'color\': $ctrl.color}" drop="$ctrl.dropConfig" drop-handler="$ctrl.dropFilterTarget()" drop-action="$ctrl.getDropAction()"><div class="flex orderByPill" ng-style="{\'background-color\': $ctrl.backgroundColor, \'color\': $ctrl.color}" ng-if="$ctrl.vm.orderByDisplayName"><span tabindex="0" class="displayName trimmedTextWithEllipsis item-fill" ng-bind="$ctrl.vm.orderByDisplayName"></span> <button ng-if="$ctrl.vm.availableAggregates.items.length> 0" class="fieldWellIcon dropDown item-auto" type="button" ng-click="$ctrl.showContextMenu($event)"><svg-use-symbol sheet="fieldListPaneIcons" symbol-id="\'fieldListDropdown\'"></svg-use-symbol></button> <button ng-click="$ctrl.removeOrderBy()" localize-tooltip="FieldWell_Remove" class="delete glyphicon pbi-glyph-close glyph-micro item-auto"></button></div><div class="dragHereWatermark trimmedTextWithEllipsis" localize="FieldDropZone_Watermark" ng-if="!$ctrl.vm.orderByDisplayName"></div></div></fieldset> <button type="submit" class="applyFilter smallFontSize" localize="Filter_ApplyFilter" localize-tooltip="Filter_ApplyFilterDescription" ng-disabled="!$ctrl.canApplyFilter()"/></form>'),e.put("components/visualContainer/visualContainer.html",'<watch value="$ctrl.viewModel.errorInfo" on-change="$ctrl.updateDetailVisualVisibility()"></watch><watch value="$ctrl.viewModel.options.disablePin" on-change="$ctrl.updateDisablePin()"></watch><div class="visualContainer unselectable" ng-attr-tabindex="{{$ctrl.getVisualContainerTabindex()}}" skip-children-focus drop="$ctrl.dropConfig" drop-handler="$ctrl.drop(event, ui)" ng-click="$ctrl.toggleSelect($event, false)" double-click="$ctrl.onDoubleClick($event)" fast-focus="$ctrl.toggleSelect($event, true)" fast-touchend="$ctrl.onTouchend($event)" ng-keydown="$ctrl.onKeydown($event)" ng-class="$ctrl.computeStyle()" apply-style="::$ctrl.viewModel.readOnlyState.style" transform="{{!$ctrl.isInViewMode()}}" transform-options="$ctrl.transformOptions" transform-restriction="custom" transform-restrict-draw="{{$ctrl.shouldRestrictTransformDraw()}}" transform-prevent-default="never" auto-scroll-parent-selector=".displayArea" drag-resize-disabled="{{$ctrl.viewModel.disableResize || $ctrl.services.viewModeState.getMode() === 0 || $ctrl.hasPositionOverride() || $ctrl.isLockObjects()}}" toolbar-anchor aria-label="{{$ctrl.viewModel.tooltip}}" preserve-aspect-ratio="{{$ctrl.viewModel.lockAspectRatio}}" touch-action="{{$ctrl.getTouchActionState()}}"><div class="visualContainerBorder" ng-class="{themableBorderColor: !$ctrl.viewModel.isSelected}"></div><div class="visualContainerScreen"></div><toolbar-overlay ng-if="$ctrl.viewModel.toolbarViewModel" view-model="$ctrl.viewModel.toolbarViewModel" focus-nav-mode="Group"></toolbar-overlay><spinner delay="1000" class="xsmall" localize-tooltip="Visual_Loading_AlertText" ng-if="$ctrl.viewModel.showProgressBar"></spinner><visual-container-header visual="::$ctrl.viewModel" menu-options="::$ctrl.menuOptions" disable-pin="$ctrl.disablePin" show-warning-details="$ctrl.errorManager.showWarningDetails()" show-transform-warning-details="$ctrl.errorManager.showTransformWarningDetails()" show-info-details="$ctrl.errorManager.showInfoDetails()" on-visual-container-changed="$ctrl.onVisualContainerChangedAsync()" on-header-destroy="$ctrl.onHeaderDestroy()" on-header-resize="$ctrl.onHeaderResize($width, $height)" ng-if="$ctrl.isHeaderVisible()"></visual-container-header><i class="removeFromLayout itemIcon glyphicon pbi-glyph-close glyph-mini themableColor" ng-click="$ctrl.removeVisualFromLayout()" ng-if="$ctrl.canRemoveFromLayout()"></i><visual-container-pop-out-bar ng-if="$ctrl.isPopOutBarVisible()" view-model="$ctrl.viewModel" on-close-pop-out="$ctrl.onClosePopOut($event)"></visual-container-pop-out-bar><div class="vcBody themableBackgroundColor themableBorderColorSolid " ng-if="!$ctrl.viewModel.showWatermark" apply-style="::$ctrl.viewModel.readOnlyState.visualViewportStyle" ng-click="$ctrl.onVCBodyClick($event)" ng-right-click="$ctrl.onRightClick($event)"><div class="visualTitle preTextWithEllipsis themableBackgroundColor themableColor" ng-if="$ctrl.viewModel.visualTitleVisible()" title="{{$ctrl.viewModel.visualTitle.text}}" apply-style="::$ctrl.viewModel.readOnlyState.titleStyle" ng-bind="$ctrl.viewModel.visualTitle.text"></div><visual aria-hidden="true" ng-if="!$ctrl.viewModel.supportsKeyboardNavigation() && !$ctrl.viewModel.isAnalysisVisual()" view-model="$ctrl.viewModel.visual" ng-show="!$ctrl.isVisualHidden()" allow-deferred-rendering="::$ctrl.viewModel.allowDeferredRendering"></visual><visual keyboard-shortcuts="ctrl-ArrowRight scoped" focus-nav-mode="Group" ng-if="$ctrl.viewModel.supportsKeyboardNavigation() && !$ctrl.viewModel.isAnalysisVisual()" view-model="$ctrl.viewModel.visual" ng-show="!$ctrl.isVisualHidden()" allow-deferred-rendering="::$ctrl.viewModel.allowDeferredRendering"></visual><detail-visual ng-if="$ctrl.viewModel.hasDetailVisual()" view-model="$ctrl.viewModel.readOnlyState.detailVisual"></detail-visual><analysis-visual-host-lazy ng-if="$ctrl.viewModel.isAnalysisVisual()" [visual-definition]="$ctrl.viewModel.visual" [visual-container]="$ctrl.viewModel.contract" ng-show="!$ctrl.isVisualHidden()"></analysis-visual-host-lazy><canvas-visual-error-overlay ng-if="$ctrl.viewModel.errorInfo" error-info="$ctrl.viewModel.errorInfo" view-mode="$ctrl.services.viewModeState.getMode()" viewport="$ctrl.viewModel.position" show-error-details="$ctrl.errorManager.showErrorDetails()" fix-errors="$ctrl.errorManager.fixErrors()"></canvas-visual-error-overlay></div><div class="vcBody" ng-if="$ctrl.viewModel.showWatermark" apply-style="::$ctrl.viewModel.readOnlyState.visualViewportStyle" ng-click="$ctrl.onVCBodyClick($event)" ng-class="vcBodyStyle" ng-attr-title="{{vcBodyTitle}}"><visual-watermark visual-type="$ctrl.viewModel.contract.config.singleVisual.visualType"></visual-watermark></div><div class="vcFooter" ng-if="$ctrl.viewModel.isFooterVisible()" apply-style="::$ctrl.viewModel.readOnlyState.footerStyle"> <button class="applyButton" localize="Apply" localize-tooltip="Filter_ApplyFilterDescription" ng-disabled="!$ctrl.isApplyButtonEnabled()" ng-if="$ctrl.isApplyButtonVisible()" fast-click="$ctrl.onApplyButtonClicked()"/></div></div>'),e.put("components/visualContainerDrill/visualContainerDrill.html",'<visual-header-item-container visual="::$ctrl.visual" ng-if="$ctrl.visual.isHeaderItemVisible(\'drillRoleSelector\') && $ctrl.canDrillOnMoreThanOneRole()"><span localize="Drill_On" apply-style="::$ctrl.visual.readOnlyState.headerForegroundStyle"></span><select ng-model="$ctrl.activeRoleName" ng-change="$ctrl.onRoleChanged()" ng-click="$event.stopPropagation()" apply-style="::$ctrl.visual.readOnlyState.headerForegroundStyle"><option ng-repeat="role in ::$ctrl.drillableRoles track by role.name" label="{{role.value}}" value="{{role.name}}" apply-style="::$ctrl.visual.readOnlyState.headerBackgroundStyle"></option></select></visual-header-item-container><visual-header-item-container visual="::$ctrl.visual" ng-if="$ctrl.visual.isHeaderItemVisible(\'drillUpButton\') && $ctrl.canDrill()"><button aria-label="{{$ctrl.drillUpTitle()}}" tooltip tooltip-config="$ctrl.drillUpTooltipConfig()" class="drillDownLevelGrouped glyphicon glyph-small {{$ctrl.visual.useStylableHeader() ? \'pbi-glyph-drillup-nocircle\' : \'pbi-glyph-drillup\' }}" ng-click="$ctrl.drillUp()" ng-disabled="!$ctrl.canDrillUp" apply-style="::$ctrl.visual.readOnlyState.headerForegroundStyle"></button></visual-header-item-container><visual-container-drill-toggle class="optionSection" ng-if="$ctrl.visual.useStylableHeader() && $ctrl.visual.isHeaderItemVisible(\'drillToggleButton\')" visual="::$ctrl.visual"></visual-container-drill-toggle><visual-header-item-container visual="::$ctrl.visual" ng-if="$ctrl.visual.isHeaderItemVisible(\'drillDownLevelButton\') && $ctrl.canDrill()"><button aria-label="{{$ctrl.drillLevelTitle()}}" tooltip tooltip-config="$ctrl.drillLevelTooltipConfig()" class="drillDownLevelGrouped glyphicon glyph-small {{$ctrl.visual.useStylableHeader() ? \'pbi-glyph-expand-nocircle\' : \'pbi-glyph-expand\' }}" ng-click="$ctrl.drillDownLevel()" ng-disabled="!$ctrl.canDrillDownWithoutCurrentGroup" apply-style="::$ctrl.visual.readOnlyState.headerForegroundStyle"></button></visual-header-item-container><visual-header-item-container visual="::$ctrl.visual" ng-if="$ctrl.visual.isHeaderItemVisible(\'drillDownExpandButton\') && $ctrl.canDrill()"><button aria-label="{{$ctrl.drillLevelGroupedTitle()}}" tooltip tooltip-config="$ctrl.drillLevelGroupedTooltipConfig()" class="drillDownLevelGrouped glyphicon glyph-small {{$ctrl.visual.useStylableHeader() ? \'pbi-glyph-inline-drill-nocircle\' : \'pbi-glyph-inline-drill\' }}" ng-click="$ctrl.drillDownLevelGrouped()" ng-disabled="!$ctrl.canDrillDownWithCurrentGroup" apply-style="::$ctrl.visual.readOnlyState.headerForegroundStyle"></button></visual-header-item-container>'),e.put("components/visualContainerDrillToggle/visualContainerDrillToggle.html",'<visual-header-item-container visual="::$ctrl.visual" ng-if="$ctrl.canDrillDown"><button class="drillDownLevelGrouped glyphicon glyph-small {{$ctrl.visual.useStylableHeader() ? \'pbi-glyph-drilldowndisabled-nocircle\' : \'pbi-glyph-drilldowndisabled\' }}" ng-class="{\'pbi-glyph-drilldownenabled\': $ctrl.isDrillDownEnabled }" ng-click="$ctrl.toggleDrillDown()" aria-label="{{$ctrl.title}}" tooltip tooltip-config="$ctrl.tooltipConfig()" apply-style="::$ctrl.visual.readOnlyState.headerForegroundStyle"></button></visual-header-item-container>'),e.put("components/visualContainerFilterRestatementButton/visualContainerFilterRestatementButton.html",'<visual-header-item-container visual="::$ctrl.visual" ng-if="$ctrl.showButton()"> <button class="vcFilterRestatementBtn" apply-style="::$ctrl.visual.readOnlyState.headerForegroundStyle" aria-label="{{$ctrl.ariaLabel}}" aria-haspopup="true" aria-expanded="false" ng-click="$ctrl.handleMouseClick($event)" ng-mouseEnter="$ctrl.handleMouseEnter($event)" ng-mouseLeave="$ctrl.handleMouseLeave($event)"><i class="glyphicon pbi-glyph-filter glyph-small"></i></button></visual-header-item-container>'),e.put("components/visualContainerHeader/visualContainerHeader.html",'<div class="vcHeader themableBackgroundColorSolid" on-resize="$ctrl.onResize()" keyboard-shortcuts=\'alt-shift-F10 scoped\' focus-nav-mode="Group"><div class="iconContainer" ng-if="$ctrl.visual.isAnyIconVisible()"><visual-header-item-container visual="::$ctrl.visual" ng-if="$ctrl.visual.isWarningVisible() || $ctrl.visual.isDeprecationWarningVisible()"><canvas-visual-header-icon details="($ctrl.visual.isWarningVisible())? $ctrl.visual.warningInfo.details : $ctrl.visual.customVisualDeprecatedWarningInfo.details" icon-type="\'warning\'" ng-click="$ctrl.showWarningDetails()"></canvas-visual-header-icon></visual-header-item-container><visual-header-item-container visual="::$ctrl.visual" ng-if="$ctrl.visual.isErrorVisible()"><canvas-visual-header-icon details="$ctrl.visual.transformWarningInfo.details" icon-type="\'error\'" ng-click="$ctrl.showTransformWarningDetails()" show-by-default="true"></canvas-visual-header-icon></visual-header-item-container><visual-header-item-container visual="::$ctrl.visual" ng-if="$ctrl.visual.isInfoVisible()"><canvas-visual-header-icon details="$ctrl.visual.visualInfo.details" icon-type="\'info\'" ng-click="$ctrl.showInfoDetails()"></canvas-visual-header-icon></visual-header-item-container></div><visual-container-drill ng-if="$ctrl.visual.anyHeaderItemVisible([\'drillRoleSelector\', \'drillUpButton\', \'drillToggleButton\', \'drillDownLevelButton\', \'drillDownExpandButton\'])" visual="::$ctrl.visual"></visual-container-drill><i class="dragGrip glyphicon pbi-glyph-gripperbarhorizontal glyph-small"></i><div class="optionsMenu"><visual-container-relationship-filters class="optionSection visualRelationshipFilters" visual="::$ctrl.visual" on-visual-container-changed="$ctrl.onVisualContainerChanged()" ng-if="$ctrl.canSetVisualRelationshipFilterAction()"></visual-container-relationship-filters><visual-container-drill-toggle class="optionSection" ng-if="::!$ctrl.visual.useStylableHeader()" visual="::$ctrl.visual"></visual-container-drill-toggle><visual-container-pin-button tabindex="-1" class="optionSection" ng-if="$ctrl.visual.isHeaderItemVisible(\'pinButton\')" visual="::$ctrl.visual" disable-pin="$ctrl.disablePin"></visual-container-pin-button><visual-container-filter-restatement-button tabindex="-1" class="optionSection" visual="::$ctrl.visual" ng-if="$ctrl.useNewFilterPane"></visual-container-filter-restatement-button><div class="optionSection"><visual-header-item-container visual="::$ctrl.visual" class="vcPopOutBtn" ng-if="$ctrl.visual.isHeaderItemVisible(\'focusModeButton\')" ng-show="$ctrl.canPopOut()"> <button class="vcPopOutBtn" ng-click="$ctrl.popOutVisualContainer($event)" aria-label="{{::$ctrl.focusModeTitle}}" tooltip tooltip-config="::$ctrl.focusModeTooltipConfig" apply-style="::$ctrl.visual.readOnlyState.headerForegroundStyle"><i class="glyphicon pbi-glyph-miniexpand glyph-small"></i></button></visual-header-item-container><visual-header-item-container visual="::$ctrl.visual" ng-if="$ctrl.visual.isHeaderItemVisible(\'seeDataLayoutToggleButton\') && $ctrl.visual.contract.visibility === 2"> <button class="toggleSeeDataLayout" ng-click="$ctrl.toggleSeeDataLayout($event)" aria-label="{{$ctrl.getSeeDataLayoutTitle()}}" tooltip tooltip-config="$ctrl.getSeeDataLayoutTooltipConfig()" apply-style="::$ctrl.visual.readOnlyState.headerForegroundStyle"><i class="glyphicon pbi-glyph-rotatevertical glyph-small" ng-class="{ \'pbi-glyph-rotatevertical\': $ctrl.visual.contract.detailVisualLayout !== 2, \'pbi-glyph-rotatehorizontal\': $ctrl.visual.contract.detailVisualLayout === 2 }"></i></button></visual-header-item-container><visual-container-options-menu menu-id="::$ctrl.menuId" visual="::$ctrl.visual" menu-options="::$ctrl.menuOptions" ng-if="$ctrl.visual.isHeaderItemVisible(\'optionsMenu\') && $ctrl.menuOptions.hasMoreOptions"></visual-container-options-menu></div></div></div>'),e.put("components/visualContainerPinButton/visualContainerPinButton.html",'<visual-header-item-container visual="::$ctrl.visual" ng-if="$ctrl.canPin()" ng-show="$ctrl.showPin()"><button class="vcPinBtn" ng-disabled="$ctrl.disablePin" ng-click="$ctrl.pinVisualContainer($event)" aria-label="{{$ctrl.getPinTileTitle()}}" tooltip tooltip-config="$ctrl.getPinTileTooltipConfig()" apply-style="::$ctrl.visual.readOnlyState.headerForegroundStyle"><i class="glyphicon pbi-glyph-pinned glyph-small"></i></button></visual-header-item-container>'),e.put("components/visualContainerPopOutBar/visualContainerPopOutBar.html",'<ul class="popOutBar" keyboard-shortcuts="" focus-nav-mode="Group"><li> <button type="button" focus-on="{{$ctrl.viewModel.contract.visibility !== 8 ? \'true\' : undefined}}" ng-click="$ctrl.closePopOut($event)"><i class="glyphicon iconBox pbi-glyph-chevronleftmedium glyph-small"></i><span class="menuItem" localize="VisualContainer_PopOut_BackToReportButton"></span></button></li><li class="divider"></li><li tabindex="0" class="title trimmedTextWithEllipsis" ng-bind="$ctrl.viewModel.readOnlyState.popOutBarTitle" title="{{$ctrl.viewModel.readOnlyState.popOutBarTitle}}"></li><li class="subtitle" ng-bind="$ctrl.viewModel.readOnlyState.popOutBarSubtitle"></li><li class="visualLastRefreshTime" ng-if="$ctrl.viewModel.lastUpdateAttemptTime"><span localize="ReportAppBar_LastRefresh"></span><span class="dataUpdatedTime" ng-bind="$ctrl.viewModel.lastUpdateAttemptTime"></span></li></ul>'),e.put("components/visualContainerRelationshipFilters/visualContainerRelationshipFilters.html",'<visual-header-item-container visual="::$ctrl.visual" ng-if="$ctrl.supportsVisualRelationshipFilterAction(1)"><button class="glyphicon glyph-small alwaysVisible" ng-class="{ \'pbi-glyph-crossfilterfilled\': $ctrl.filterAction === 1,  \'pbi-glyph-crossfilter\': $ctrl.filterAction !== 1}" ng-click="$ctrl.setVisualRelationshipFilterAction($event, 1)" localize-tooltip="VisualRelationships_DataFilter" apply-style="::$ctrl.visual.readOnlyState.headerForegroundStyle"></button></visual-header-item-container><visual-header-item-container visual="::$ctrl.visual" ng-if="$ctrl.supportsVisualRelationshipFilterAction(2)"><button class="glyphicon glyph-small alwaysVisible" ng-class="{ \'pbi-glyph-crosshighlightfilled\': $ctrl.filterAction === 2,  \'pbi-glyph-crosshighlight\': $ctrl.filterAction !== 2}" ng-click="$ctrl.setVisualRelationshipFilterAction($event, 2)" localize-tooltip="VisualRelationships_HighlightFilter" apply-style="::$ctrl.visual.readOnlyState.headerForegroundStyle"></button></visual-header-item-container><visual-header-item-container visual="::$ctrl.visual" ng-if="$ctrl.supportsVisualRelationshipFilterAction(3)"><button class="glyphicon glyph-small alwaysVisible" ng-class="{ \'pbi-glyph-disablefilled\': $ctrl.filterAction === 3, \'pbi-glyph-disable\': $ctrl.filterAction !== 3}" ng-click="$ctrl.setVisualRelationshipFilterAction($event, 3)" localize-tooltip="None" apply-style="::$ctrl.visual.readOnlyState.headerForegroundStyle"></button></visual-header-item-container>'),e.put("components/visualHeaderItemContainer/visualHeaderItemContainer.html",'<div class="visualHeaderItemContainer themeableElement" apply-style="::$ctrl.visual.readOnlyState.headerItemContainerStyle"><ng-transclude></ng-transclude></div>'),e.put("components/visualOptionsMenu/visualContainerOptionsMenu.html",'<visual-header-item-container visual="::$ctrl.visual"><button class="vcMenuBtn" type="button" ng-click="$ctrl.showOptionsMenu($event)" aria-haspopup="true" aria-expanded="false" aria-label="{{::$ctrl.optionsMenuTitle}}" tooltip tooltip-config="::$ctrl.optionsMenuTooltipConfig" apply-style="::$ctrl.visual.readOnlyState.headerForegroundStyle"><i class="glyphicon pbi-glyph-more glyph-small"></i></button></visual-header-item-container>'),e.put("components/visualTooltip/visualTooltip.html",'<div class="visual-tooltip-container"><canvas-tooltip ng-if="::$ctrl.explorationContract" ng-show="$ctrl.showCanvasSection()" tooltip-data-sources="$ctrl.tooltipDataSources" exploration-contract="$ctrl.explorationContract" exploration-capabilities="$ctrl.explorationCapabilities" identities="$ctrl.identities" filter-context="$ctrl.filterContext" section-name="$ctrl.sectionName" show-canvas-mask="$ctrl.isLoading" on-canvas-ready="$ctrl.onCanvasReady()" on-canvas-busy="$ctrl.onCanvasBusy()"></canvas-tooltip><div ng-show="$ctrl.showDefaultSection()" class="data-item-tooltip-container"></div><tooltip-actions ng-if="$ctrl.showActionBar" on-hide="::$ctrl.onHide()" tooltip-shown="$ctrl.tooltipShown" actions-provider="$ctrl.actionsProvider" show-child-menu="::$ctrl.showChildMenu(show)"></tooltip-actions><div ng-if="$ctrl.showLoadingSection()" class="loading-message-container"><div class="loading-message"><spinner></spinner><span localize="Visual_Tooltip_Loading_Message"></span></div></div></div>'),e.put("views/canvasVisualHeaderIcon.html",'<button tooltip tooltip-config="$ctrl.tooltipConfigManager.getTooltipConfig()" ng-disabled="!$ctrl.isClickable()" ng-switch="$ctrl.iconType"><i class="infoIcon glyphicon {{$ctrl.useStylableHeader() ? \'pbi-glyph-info-nocircle\' : \'pbi-glyph-info\'}}" ng-switch-when="info"></i><i class="warningIcon pbi-glyph-warning glyphicon" ng-switch-when="warning"></i><i class="errorIcon pbi-glyph-error glyphicon" ng-switch-when="error"></i></button>'),e.put("views/carousel.html",'<div class="carouselControl" fast-mouseenter="updateNavButtonVisibility()" on-resize="carouselResized()"><div class="navButtonContainer" ng-right-click="onNavButtonContainerRightClick($event)"> <button class="carouselNavButton previousPage" ng-click="isRtl ? scrollToNext() : scrollToPrevious()" localize-tooltip="Carousel_PreviousPages"><i class="glyphicon pbi-glyph-caretleft glyph-mini"></i></button> <button class="carouselNavButton nextPage" ng-click="isRtl ? scrollToPrevious() : scrollToNext()" localize-tooltip="Carousel_NextPages"><i class="glyphicon pbi-glyph-caretright glyph-mini"></i></button></div><div class="carouselScrollPane" ng-transclude></div></div>'),e.put("views/deleteVisualWarningDialog.html",'<div><div class="warningMessage"> {{::deleteVisualWarningText}}</div><div class="buttons warningButtons"> <button class="btn button primary" ng-click="deleteVisual()">{{::deleteVisualButtonText}}</button> <button class="btn button" ng-click="closeDialog()" localize="DeleteVisual_Cancel"></button></div></div>'),e.put("views/dropdowns/visualContainerFilterRestatementOverlay.html",'<dropdown-overlay dropdown-overlay-name="visualContainerFilterRestatementOverlay" focus-nav-mode="Group"><filter-restatement [visual]="visual" [is-hover]="isHover"></filter-restatement></dropdown-overlay>'),e.put("views/esriConsentDialog.html",'<div><div class="esriDialogTitle"><div class="EsriConsentDialog_Esri" localize="EsriConsentDialog_Esri"></div><div class="EsriConsentDialog_WelcomeTo" localize="EsriConsentDialog_WelcomeTo"></div><div class="EsriConsentDialog_ArcGISMaps" localize="ArcGISMapsForPowerBI"></div></div><div class="esriDialogBody"><div class="EsriConsentDialog_GetMore" localize="EsriConsentDialog_GetMore"></div><div class="EsriConsentDialog_ByClicking" ng-bind-html="::byClickingText"></div><div class="EsriConsentDialog_LearnMore"><a ng-href="{{::learnMoreLink}}" target="_blank" localize="EsriConsentDialog_LearnMore"></a></div><div class="buttons warningButtons"> <button class="btn button primary" ng-click="acceptTermsOfService()" localize="EsriConsentDialog_OK"></button> <button class="btn button" ng-click="rejectTermsOfService()" localize="EsriConsentDialog_Cancel"></button></div></div></div>'),e.put("views/exploration.html",'<div tabindex="0" role="application" class="exploration {{isMasterFormFactor()? \'\': \'phone-form-factor-background\'}}" toolbar-container><accessibility-info on-close="focusVisualContainer"></accessibility-info><explore-canvas view-model="viewModel.exploreCanvas" disable-print="disablePrint" canvas-options="canvasOptions" ng-class=\'{"disable-visual-interactivity": isMobileLayoutAuthoring()}\' canvas-scroll></explore-canvas></div>'),e.put("views/explorationHost.html",'<div class="fillAvailableSpace verticalItemsContainer" ng-transclude></div>'),e.put("views/explorationNavigationTab.html",'<div drag="sections" class="thumbnail-container" ng-class="{\'hidden-tab\': isHiddenInViewMode}" ng-dblclick="beginEditSection()" accessible-click="changeSection($event)" role="tab" tabindex="0" aria-selected="{{viewModel.selected}}" ng-right-click="showContextMenu($event)" ng-keydown="onKeyPress($event)"><div><div class="glyphicon glyph-mini pbi-glyph-hide2 sectionHiddenIcon" ng-if="isHiddenInViewMode"></div><editable-label class="section-index" on-blur="renameSection(newName)" display-name="viewModel.displayName" editable="viewModel.isTabEditable && isEditing" disable-click="true"></editable-label><div class="sectionDeleteIcon" ng-if="isEditing && !isOnlyVisibleTab" ng-click="deleteSection($event)" aria-hidden="true" localize-tooltip="Carousel_DeletePage">x</div></div></div>'),e.put("views/explorationPaginator.html",'<div class="paginator unselectable"><span class="prev" ng-click="prev()"></span><span class="status"><span localize="Page"></span> <span>{{getSelectedPageIndex() + 1}}</span><span localize="ReportPaginator_PageOf"></span><span ng-bind="viewModel.exploration.sections.length"></span></span><span class="next" ng-click="next()"></span></div>'),e.put("views/exploreCanvas.html",'<div class="exploreCanvas themeableElement {{getExploreCanvasClass()}}" drop="dropConfig" drop-handler="drop(event, ui)" ng-keydown="keyDown($event)" pinchable="{ \'startHandler\' : \'canvasPinchStart(scale)\', \'endHandler\' : \'canvasPinchEnd(scale)\', \'scrollParentSelector\' : \'.exploration\', \'zoomDisabled\': \'shouldDisableZoom()\', \'childDisplaySelector\': \'.displayArea\' }" enable-pinch="{{canPinch()}}" swipeable="{ enabled: {{canSwipe()}}, ignoreFrom: \'.swipeable-blocked\' }" canvas-navigation="{{canSwipe()}}"><canvas-watermark canvas-view-model="viewModel"></canvas-watermark><div class="backgroundContainer outspaceContainer" ng-class="outspaceBackground.imageFitClass" ng-style="outspaceBackground.backgroundStyle"><div ng-if="showOutspaceImage()" class="backgroundImageContainer outspaceImageContainer"> <img class="backgroundImage outspaceImage" ng-src="{{outspaceBackground.imageSource}}" ng-style="outspaceBackground.imageStyle"/></div></div><div class="canvasBackdrop" ng-if="isCanvasBackdropVisible()"></div><div class="canvasFlexBox"><div class="displayAreaContainer" canvas-scroll ng-click="clearSelection($event)" on-resize="canvasResized()"><div class="displayAreaViewport"></div><div class="displayArea" explore-canvas-printer disable-print="{{::disablePrint}}" ng-style="canvasBackground.displayAreaStyle"><div class="backgroundContainer visualBackgroundContainer themableBackgroundColorSolid" ng-class="canvasBackground.imageFitClass" ng-style="canvasBackground.backgroundStyle"><div ng-if="showBackgroundImage()" class="backgroundImageContainer visualBackgroundImageContainer"> <img class="backgroundImage visualBackgroundImage" ng-src="{{canvasBackground.imageSource}}" ng-style="canvasBackground.imageStyle"/></div></div><div class="visualContainerHost" keyboard-shortcuts="ctrl-F6" focus-nav-mode="Group" tab-order-enabled groupindex="0" ng-dblclick="showQna($event)"><dot-grid ng-if="showDotGrid() && dotGridViewModel" [view-model]="dotGridViewModel"></dot-grid><box-grid ng-if="showBoxGrid() && boxGridLayout" view-model="boxGridLayout"></box-grid><smart-guides ng-if="smartGuideViewModel" [view-model]="smartGuideViewModel"></smart-guides><visual-container tab-order="{{visualContainer.position.tabOrder}}" ng-repeat="visualContainer in viewModel.visualContainers | filter:isVisualContainerVisible" view-model="visualContainer" canvas-layout="$ctrl.layout" ng-repeat-finish-event="visualContainerRepeatFinished"></visual-container></div><pen-annotation ng-if="$ctrl.viewModeState.getConfig().enablePenAnnotation"></pen-annotation></div></div><outspace-pane ng-if="$ctrl.getIsOutspacePaneVisible()" [section-objects]="viewModel.contract.evaluatedObjects"></outspace-pane></div></div>'),e.put("views/inputFields/propertyPaneTextBox.html",'<form name="inputForm" novalidate> <input type="{{::inputType}}" class="inputFieldInSlice" pbi-validate="validators" autocomplete="off" ng-change="onChange()" ng-model="sliceValue" ng-model-options="{ debounce: 400 }" tooltip tooltip-config="getErrorMessage()" placeholder="{{::placeholder}}" maxlength="250" name="inputField" ng-keydown="onKeydown($event)" aria-labelledby="{{labelId}}" ng-disabled="isDisabled"/></form>'),e.put("views/jqSelect.html",'<select class="{{ classes }}" ng-options="{{ expression }}"></select>'),e.put("views/svg/visualsWatermarks.svg",'<?xml version="1.0" encoding="utf-8"?><svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 479 492" enable-background="new 0 0 479 492" xml:space="preserve"><symbol id="100stackedbar"><rect x="0" y="0" fill="#F4F4F4" width="400" height="299.8"/><line fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="93.1" y1="0" x2="93.1" y2="299.5"/><line fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="199.7" y1="0" x2="199.7" y2="299.3"/><line fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="298.6" y1="0" x2="298.6" y2="299.5"/><rect x="0" y="20.6" fill="#E1E2E3" width="380.4" height="39"/><rect x="0" y="74.7" fill="#E1E2E3" width="380.4" height="39"/><rect x="0" y="129.8" fill="#E1E2E3" width="380.4" height="39"/><rect x="0" y="184" fill="#E1E2E3" width="380.4" height="39"/><rect x="0" y="241" fill="#E1E2E3" width="380.4" height="39"/><rect x="0" y="20.6" fill="#D0D2D3" width="313.6" height="39"/><rect x="0" y="74.7" fill="#D0D2D3" width="284.9" height="39"/><rect x="0" y="129.8" fill="#D0D2D3" width="318.8" height="39"/><rect x="0" y="184" fill="#D0D2D3" width="308.6" height="39"/><rect x="0" y="241" fill="#D0D2D3" width="278.6" height="39"/><rect x="0" y="20.6" opacity="0.5" fill="#A6A8AB" width="211.1" height="39"/><rect x="0" y="74.7" opacity="0.5" fill="#A6A8AB" width="186.2" height="39"/><rect x="0" y="129.8" opacity="0.5" fill="#A6A8AB" width="211.1" height="39"/><rect x="0" y="184" opacity="0.5" fill="#A6A8AB" width="200" height="39"/><rect x="0" y="241" opacity="0.5" fill="#A6A8AB" width="184" height="39"/></symbol><symbol id="100stackedcolumn"><rect x="-0.1" y="-0.1" fill="#F4F4F4" width="400.1" height="300"/><line fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="-0.1" y1="73.4" x2="400" y2="73.4"/><line fill="#D0D2D3" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="-0.1" y1="147.8" x2="400" y2="147.8"/><line fill="#D0D2D3" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="-0.1" y1="222.3" x2="400" y2="222.3"/><rect x="19" y="20" fill="#E1E2E3" width="40.9" height="280.1"/><rect x="83.1" y="20" fill="#E1E2E3" width="40.9" height="280.1"/><rect x="147.1" y="20" fill="#E1E2E3" width="40.9" height="280.1"/><rect x="211.1" y="20" fill="#E1E2E3" width="40.9" height="280.1"/><rect x="275.1" y="20" fill="#E1E2E3" width="40.9" height="280.1"/><rect x="339.1" y="20" fill="#E1E2E3" width="40.9" height="280.1"/><rect x="19" y="104.6" fill="#D0D2D3" width="40.9" height="195.5"/><rect x="83.1" y="58" fill="#D0D2D3" width="40.9" height="242.1"/><rect x="147.1" y="94.6" fill="#D0D2D3" width="40.9" height="205.5"/><rect x="211.1" y="99.5" fill="#D0D2D3" width="40.9" height="200.6"/><rect x="275.1" y="60.6" fill="#D0D2D3" width="40.9" height="239.5"/><rect x="339.1" y="136.5" fill="#D0D2D3" width="40.9" height="163.6"/><rect x="19" y="197.6" opacity="0.5" fill="#A6A8AB" width="40.9" height="102.5"/><rect x="83.1" y="173.2" opacity="0.5" fill="#A6A8AB" width="40.9" height="126.9"/><rect x="147.1" y="192.3" opacity="0.5" fill="#A6A8AB" width="40.9" height="107.8"/><rect x="211.1" y="184.7" opacity="0.5" fill="#A6A8AB" width="40.9" height="115.4"/><rect x="275.1" y="162.3" opacity="0.5" fill="#A6A8AB" width="40.9" height="137.8"/><rect x="339.1" y="206" opacity="0.5" fill="#A6A8AB" width="40.9" height="94.1"/></symbol><symbol id="area"><rect x="0.1" fill="#F4F4F4" width="399.8" height="300"/><line fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="0.7" y1="73.5" x2="399.8" y2="73.5"/><line fill="#D0D2D3" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="0.7" y1="147.9" x2="399.8" y2="147.9"/><line fill="#D0D2D3" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="0.7" y1="222.4" x2="399.8" y2="222.4"/><line fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="-0.2" y1="73.5" x2="399.8" y2="73.5"/><line fill="#D0D2D3" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="-0.1" y1="147.9" x2="399.8" y2="147.9"/><line fill="#D0D2D3" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="0.7" y1="222.4" x2="399.8" y2="222.4"/><g><g><g><polygon fill="#E1E2E3" points="345.1,93.4 287.8,77 230.6,82.1 173.9,211.9 115.1,204.3 56.9,217.5 0.1,172.3 0.1,300          399.8,300 399.8,82.3"/></g></g></g><g><polygon fill="#D0D2D3" points="115.1,206.7 175,214.5 231.8,84.9 287.3,80 344.6,96.4 399.8,85.2 399.8,81.1 344.8,92.3      288.1,76.1 287.7,76 229,81.2 172.5,210.1 114.9,202.7 57.5,215.7 0.1,170.2 0.1,175.3 56.5,220"/></g></symbol><symbol id="bar"><rect y="0" fill="#F4F4F4" width="400" height="299.8"/><line fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="93.1" y1="0" x2="93.1" y2="299.5"/><line fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="199.7" y1="0" x2="199.7" y2="299.3"/><line fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="298.6" y1="0" x2="298.6" y2="299.5"/><rect x="0" y="20.6" fill="#D0D2D3" width="179.9" height="39"/><rect x="0" y="74.7" fill="#D0D2D3" width="253.4" height="39"/><rect x="0" y="129.8" fill="#D0D2D3" width="224.6" height="39"/><rect x="0" y="184" fill="#D0D2D3" width="311.1" height="39"/><rect x="0" y="241" fill="#D0D2D3" width="367.2" height="39"/></symbol><symbol id="kpi"><g id="Creation" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" sketch:type="MSPage"><g id="KPI-Canvas" sketch:type="MSArtboardGroup"><rect id="BG" fill="#FAFAFA" sketch:type="MSShapeGroup" x="0" y="0" width="400" height="299.441341"></rect><g id="Rectangle-20-+-Rectangle-21-+-Triangle-3" sketch:type="MSLayerGroup" transform="translate(122.000000, 123.000000)"><rect id="Rectangle-20" fill="#BABABA" sketch:type="MSShapeGroup" x="0" y="0" width="146" height="24"></rect><rect id="Rectangle-21" fill="#DDDDDD" sketch:type="MSShapeGroup" x="32" y="35" width="82" height="10"></rect><polygon id="Triangle-3" fill="#DDDDDD" sketch:type="MSShapeGroup" points="173.444444 1 186.888889 23 160 23 "></polygon></g><path d="M-2.30078125 266.449219 32.9472656 292.931641 66.9375 285.017578 100.927734 291.078125 134.900391 222.228516 167.779297 219.632812 198.302734 227.175781 242.171875 250.173828 286.412109 226.193359 316.695312 229.787109 352.632812 216.943359 425.914062 225.597656 425.914062 367.497434-34.7301703 367.497434-34.7301703 273.284528-2.30078125 266.449219Z" id="Path-2" stroke="#DDDDDD" stroke-width="2" fill="#EAEAEA" sketch:type="MSShapeGroup"></path></g></g></symbol><symbol id="card"><rect x="0" y="0.3" fill="#F4F4F4" width="400" height="299.6"/><rect x="0" y="0.3" fill="#A6A6A6" width="8" height="299.6"/><rect x="221.6" y="42.2" fill="#A6A6A6" width="139.9" height="4"/><rect x="221.6" y="109.7" fill="#A6A6A6" width="139.9" height="4"/><rect x="221.6" y="180" fill="#A6A6A6" width="141.7" height="4"/><rect x="221.6" y="249.5" fill="#A6A6A6" width="141.7" height="4"/><rect x="34.1" y="41.8" opacity="0.5" fill="#A6A8AB" width="142" height="142"/><rect x="36.1" y="249.5" fill="#A6A6A6" width="141.7" height="4"/></symbol><symbol id="clusteredBar"><rect x="-0.1" y="0" fill="#F4F4F4" width="400.1" height="300"/><rect x="0" y="0" fill="#F4F4F4" width="400" height="299.8"/><line fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="93.1" y1="0" x2="93.1" y2="299.5"/><line fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="199.7" y1="0" x2="199.7" y2="299.3"/><line fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="298.6" y1="0" x2="298.6" y2="299.5"/><rect x="0" y="25.1" fill="#E1E2E3" width="290.1" height="13.5"/><rect x="0" y="71.1" fill="#E1E2E3" width="338.1" height="13.5"/><rect x="0" y="103.8" fill="#E1E2E3" width="237.1" height="13.5"/><rect x="0" y="182.6" fill="#E1E2E3" width="237.1" height="13.5"/><rect x="0" y="260.8" fill="#E1E2E3" width="313.1" height="13.5"/><rect x="0" y="38.8" fill="#ACACAC" width="211.1" height="13.5"/><rect x="0" y="136.5" fill="#E1E2E3" width="284.1" height="13.5"/><rect x="0" y="215" fill="#E1E2E3" width="240.1" height="13.5"/><rect x="0" y="150.2" fill="#ACACAC" width="336.1" height="13.5"/><rect x="0" y="228.4" fill="#ACACAC" width="284.1" height="13.5"/></symbol><symbol id="clusteredColumn"><rect x="-0.1" y="-0.1" fill="#F4F4F4" width="400.1" height="300"/><line fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="-0.1" y1="73.4" x2="400" y2="73.4"/><line fill="#D0D2D3" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="-0.1" y1="147.8" x2="400" y2="147.8"/><line fill="#D0D2D3" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="-0.1" y1="222.3" x2="400" y2="222.3"/><rect x="43.7" y="163.6" fill="#D0D2D3" width="40.9" height="135.7"/><rect x="84.4" y="196.8" fill="#ACACAC" width="40.9" height="102.5"/><rect x="147.7" y="52.2" fill="#D0D2D3" width="40.9" height="247.1"/><rect x="315.4" y="131" fill="#D0D2D3" width="40.9" height="168.3"/><rect x="252" y="160.6" fill="#ACACAC" width="40.9" height="138.7"/><rect x="211.1" y="103.8" fill="#D0D2D3" width="40.9" height="195.5"/></symbol><symbol id="column"><rect x="0" fill="#F4F4F4" width="400.1" height="300"/><line fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="0" y1="73.5" x2="400" y2="73.5"/><line fill="#D0D2D3" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="0" y1="147.9" x2="400" y2="147.9"/><line fill="#D0D2D3" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="0" y1="222.4" x2="400" y2="222.4"/><rect x="19.1" y="193.3" fill="#D0D2D3" width="40.9" height="106.9"/><rect x="83.1" y="167.8" fill="#D0D2D3" width="40.9" height="132.4"/><rect x="147.1" y="187.8" fill="#D0D2D3" width="40.9" height="112.4"/><rect x="211.2" y="82.1" fill="#D0D2D3" width="40.9" height="218.1"/><rect x="275.2" y="39.9" fill="#D0D2D3" width="40.9" height="260.3"/><rect x="339.2" y="122.3" fill="#D0D2D3" width="40.9" height="177.9"/></symbol><symbol id="combo"><rect x="0" y="0.3" fill="#F4F4F4" width="399.8" height="299.7"/><line fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="0" y1="73.4" x2="399.7" y2="73.4"/><line fill="#D0D2D3" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="0" y1="147.9" x2="399.7" y2="147.9"/><line fill="#D0D2D3" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="0" y1="222.3" x2="399.7" y2="222.3"/><rect x="20.4" y="189.5" fill="#D0D2D3" width="40.7" height="110.6"/><rect x="84.1" y="163.1" fill="#D0D2D3" width="40.7" height="137"/><rect x="147.9" y="183.8" fill="#D0D2D3" width="40.7" height="116.4"/><rect x="211.6" y="74.4" fill="#D0D2D3" width="40.7" height="225.8"/><rect x="275.3" y="30.7" fill="#D0D2D3" width="40.7" height="269.5"/><rect x="339" y="116.1" fill="#D0D2D3" width="40.7" height="184.1"/><polyline opacity="0.5" fill="none" stroke="#A6A8AB" stroke-width="4" stroke-miterlimit="10" points="399.3,95.6 344.1,106.8    287.4,90.5 230.7,95.6 174.6,224.8 116.4,217.1 58.8,230.3 2.4,185.2 "/></symbol><symbol id="defaultWatermark"><g><rect x="0" y="1" opacity="0.5" fill="#F4F4F4" width="400" height="300"/><path fill="#929497" d="m93.79999 69.79999v47l30.20001 36.09998c10.29999-8.59998 16.79999-21.59998 16.79999-36.09998l0 0c0-25.89999-21.09998-47-47-47z"/><path fill="#D0D2D3" d="m46.7 116.9c0 22.1 15.3 40.49999 35.6 45.7l11.39999-45.7h-47l0 0 0 0z"/><path fill="#E1E2E3" d="m93.79999 116.89999-11.39999 45.69999c3.69998.90001 7.39999 1.5 11.39999 1.5 11.5 0 22-4.09999 30.20001-11l-30.20001-36.19999z"/><path fill="#A6A8AB" d="m93.79999 69.79999c-25.99998 0-46.99998 21-46.99998 47l0 0h46.99998v-47l0 0z"/><g><polygon fill="#E1E2E3" points="200.89999389648438 193.5999755859375 167.70001220703125 185.0999755859375 134.29998779296875 187.70001220703125 101.29998779296875 254.9000244140625 67.10000610351562 251 33.30000305175781 257.79998779296875 0.1999969482421875 234.4000244140625 0.1999969482421875 300.5 399.9000244140625 300.5 399.9000244140625 187.9000244140625 349.20001220703125 182.0999755859375 314.1000061035156 194.5999755859375 286.8999938964844 191.0999755859375 242 214.5 "/></g><g><polyline fill="none" stroke="#D0D2D3" stroke-width="2" stroke-miterlimit="10" points="399.9000244140625 187.70001220703125 349.20001220703125 182.0999755859375 314.1000061035156 194.5999755859375 286.8999938964844 191.0999755859375 242 214.5 200.89999389648438 193.4000244140625 167.70001220703125 185 134.29998779296875 187.5999755859375 101.29998779296875 254.79998779296875 67.10000610351562 251 33.30000305175781 257.70001220703125 0.1999969482421875 234.4000244140625 "/></g><rect x="185.6" y="115.9" fill="#E1E2E3" width="20.7" height="48"/><rect x="217.8" y="104.4" fill="#E1E2E3" width="20.7" height="59.5"/><rect x="250.1" y="113.4" fill="#E1E2E3" width="20.7" height="50.5"/><rect x="282.3" y="66" fill="#E1E2E3" width="20.7" height="97.9"/><rect x="314.6" y="47" fill="#E1E2E3" width="20.7" height="116.9"/><rect x="346.8" y="84" fill="#E1E2E3" width="20.7" height="79.9"/><rect x="185.6" y="129.5" fill="#D0D2D3" width="20.7" height="34.4"/><rect x="217.8" y="121.2" fill="#D0D2D3" width="20.7" height="42.7"/><rect x="250.1" y="127.7" fill="#D0D2D3" width="20.7" height="36.1"/><rect x="282.3" y="93.7" fill="#D0D2D3" width="20.7" height="70.2"/><rect x="314.6" y="80.1" fill="#D0D2D3" width="20.7" height="83.8"/><rect x="346.8" y="106.6" fill="#D0D2D3" width="20.7" height="57.2"/><rect x="185.6" y="145.1" opacity="0.5" fill="#A6A8AB" width="20.7" height="18.7"/><rect x="217.8" y="140.7" opacity="0.5" fill="#A6A8AB" width="20.7" height="23.2"/><rect x="250.1" y="144.1" opacity="0.5" fill="#A6A8AB" width="20.7" height="19.7"/><rect x="282.3" y="125.6" opacity="0.5" fill="#A6A8AB" width="20.7" height="38.2"/><rect x="314.6" y="118.3" opacity="0.5" fill="#A6A8AB" width="20.7" height="45.6"/><rect x="346.8" y="132.7" opacity="0.5" fill="#A6A8AB" width="20.7" height="31.1"/></g></symbol><symbol id="donut"><rect x="1.3" y="0.2" fill="#F4F4F4" width="398.7" height="299.8"/><path fill="#929497" d="M200.6 55.6v94.5l60.6 72.5c20.7-17.3 33.9-43.4 33.9-72.5v0C295.1 97.9 252.8 55.6 200.6 55.6z"/><path fill="#D0D2D3" d="M106.1 150.1c0 44.3 30.5 81.4 71.6 91.7l22.9-91.7H106.1z"/><path fill="#E1E2E3" d="M200.6 150.1l-22.9 91.7c7.3 1.8 15 2.8 22.9 2.8 23.1 0 44.2-8.3 60.6-22L200.6 150.1z"/><path fill="#A6A8AB" d="M200.6 55.6c-52.2 0-94.5 42.3-94.5 94.5v0h94.5V55.6z"/><circle fill="#F4F4F4" cx="200.6" cy="151" r="53.4"/></symbol><symbol id="funnel"><rect x="1.3" y="0" fill="#F4F4F4" width="398.7" height="300"/><g><g><g><rect x="46.5" y="59.7" fill="#D0D2D3" width="317.6" height="33.9"/></g><g><rect x="82.7" y="97.9" fill="#D0D2D3" width="245.2" height="33.9"/></g><g><rect x="141.2" y="136.2" fill="#D0D2D3" width="128.3" height="33.9"/></g><g><rect x="181.2" y="174.4" fill="#D0D2D3" width="48.3" height="33.9"/></g><g><rect x="194.1" y="212.6" fill="#D0D2D3" width="23.4" height="33.9"/></g></g></g></symbol><symbol id="filledMap"><rect x="0.7" y="0" opacity="0.5" fill="#F4F4F4" width="401.4" height="302.1"/><g><defs><rect id="SVGID_1_" x="0.2" y="0" width="401.4" height="302.1"/></defs><clipPath id="SVGID_2_"><use xlink:href="#SVGID_1_" overflow="visible"/></clipPath><path clip-path="url(#SVGID_2_)" fill="#E1E2E3" d="M49.4-9.3l18.3 44.6-97.2 30.3c-2.2.7-3.4 3-2.7 5.2.6 1.8 2.2 2.9 4 2.9.4 0 .8-.1 1.2-.2l57.4-17.9-1.9 32.9-59.3-4c-2.3-.2-4.3 1.6-4.4 3.9-.2 2.3 1.6 4.3 3.9 4.4l59.4 4-6.3 111-50.9-26.4c-2-1.1-4.5-.3-5.6 1.8-1.1 2-.3 4.5 1.8 5.6l56.6 29.4c0 0 0 0 0 0l21.2 11-71 60c-1.1.9-1.6 2.3-1.4 3.7.2 1.4 1 2.6 2.2 3.2l62.9 31.8c.6.3 1.2.4 1.9.4 1.5 0 3-.8 3.7-2.3 1-2 .2-4.5-1.8-5.6l-57.3-29 68.8-58.1 20.9 10.9-4.6 79.7c-.1 2.3 1.6 4.2 3.9 4.4.1 0 .2 0 .2 0 2.2 0 4-1.7 4.1-3.9l4.3-76 39 20.2-41.7 53c-1.4 1.8-1.1 4.4.7 5.8.8.6 1.7.9 2.6.9 1.2 0 2.4-.5 3.3-1.6L180.7 206l54.3 26.3-44.4 89.9c-1 2.1-.2 4.5 1.9 5.6.6.3 1.2.4 1.8.4 1.5 0 3-.8 3.7-2.3l44.4-90 40.4 19.6-34.1 66.7c-1 2-.2 4.5 1.8 5.6.6.3 1.2.5 1.9.5 1.5 0 3-.8 3.7-2.3l34.2-66.8 63.2 30.6-2.9 34c-.2 2.3 1.5 4.3 3.8 4.5.1 0 .2 0 .4 0 2.1 0 3.9-1.6 4.1-3.8l2.9-34.6L400 295c2.2-.5 3.6-2.8 3-5-.5-2.2-2.8-3.6-5-3l-35.5-5.9 4.3-51H399c2.3 0 4.1-1.9 4.1-4.1 0-2.3-1.9-4.1-4.1-4.1h-48.8l-32.4-16.4 1.2-2.4c.1-.3.2-.5.3-.8l3.4-12.9 76.1 2.9c.1 0 .1 0 .2 0 2.2 0 4.1-1.8 4.1-4 .1-2.3-1.7-4.2-4-4.3l-74.2-2.8 14.3-54c14.8 3.5 31.6 5.8 50.3 5.8 3.2 0 6.4-.1 9.6-.2 2.3-.1 4.1-2 4-4.3-.1-2.3-2-4.1-4.3-4-21.6.9-40.8-1.5-57.4-5.5l4.7-17.8c14.6 3.3 27.6 4.2 37.1 4.2 9.7 0 15.8-.9 16.3-1 2.3-.3 3.8-2.5 3.5-4.7-.3-2.3-2.4-3.8-4.7-3.5-.2 0-21.4 3.1-48.3-2.7l5.8-76.7 42.9 3.3c2.3.2 4.3-1.5 4.5-3.8.2-2.3-1.5-4.3-3.8-4.5l-45.4-3.5-17.5-31.4c-1.5-1.5-3.9-1.7-5.6-.3l-62.7 64.2c-9.9-13.8-17.7-30.2-23.5-48.9-.7-2.2-3-3.4-5.2-2.7-2.2.7-3.4 3-2.7 5.2 6.5 20.9 15.2 37.9 25.2 51.6l-19.1 16.1c-2.6-1.8-33.6-24.6-44.4-76.8-.5-2.2-2.7-3.7-4.9-3.2-2.2.5-3.7 2.7-3.2 4.9.7 3.3 1.4 6.5 2.3 9.5l-80.5 25.1c-11.6-10.9-7.7-34.5-7.7-34.8.4-2.3-1.1-4.4-3.4-4.8-2.3-.4-4.4 1.1-4.8 3.4-.2 1.1-4.1 24.4 7.2 38.9l-27.8 8.7c0 0 0 0 0-.1L55.8-15.6c-.8-1.8-2.7-2.9-4.7-2.5M307.8 206.7l-7 13.6-40.7-20.2 10.9-22 16 9.2c.6.3 1.2.5 1.9.6l25.4 1-2.8 10.7-2.2 4.3M286.3 71.9c6.9 5.7 13.9 10.4 20.9 14.3-.1.2-.3.4-.4.6l-8.1 16.4c-12.3-6.2-20.8-12.1-25-15.3l12.4-15.8C286.2 72.1 286.2 72 286.3 71.9zM268.5 94.5c4.5 3.5 13.4 9.8 26.4 16.3l-42.2 85.6-46.3-23.1L268.5 94.5zM316.5 180.6l-26.2-1-15.6-9 27.7-56.2c8.3 3.8 17.9 7.4 28.8 10.4L316.5 180.6zM333.4 116.7c-10.2-2.9-19.3-6.4-27.2-9.9l8-16.3c.1-.2.1-.4.2-.6 6.4 3.1 12.7 5.5 18.7 7.4 1.7.5 3.4 1 5 1.5L333.4 116.7zM333.1-14.8l14.6 28.5-5.8 77.7c-2.1-.6-4.1-1.2-6.2-1.9-25.4-8.2-46.3-22.3-62.4-42.3L333.1-14.8zM280.2 66.5c-.2.2-.4.4-.6.6l-82.9 105.2 0 0-18.4 23.4-51.4-24.9L267 52.3C271.2 57.5 275.6 62.3 280.2 66.5zM86.8 160.6l24.9 12.1-26.9 22.7L86.8 160.6zM87.4 151.6l3-52.7 8.4-4.6 2.2 3.5v14.7c0 2.3 1.9 4.1 4.1 4.1h27.7c1.1 0 2.1-.4 2.9-1.1L165.6 87l20.7 22.7-67.6 57.1L87.4 151.6zM184.9 47.6l4 5.6-57.7 55.1h-21.9V96.6c0-.8-.2-1.6-.6-2.2l-2.6-4L184.9 47.6zM236.3 67.4l-43.7 36.9-21-23.1 25.7-24.5c1.5-1.4 1.7-3.7.5-5.4l-5.5-7.7 16.2-8.8C219.5 53.4 231.5 63.7 236.3 67.4zM204.5 27.5 90.9 89.1l3-53.3L194.9 4.3C197.7 13 201 20.7 204.5 27.5zM38.8 53l46.7-14.6-3.1 53.8-45.7-3.1L38.8 53zM29.8 212l6.5-114.6 45.7 3.1-5.8 102.2-24.4 20.6L29.8 212zM59.7 227.5l15.8-13.4L74.3 235 59.7 227.5zM126.1 261.9l-43.7-22.7 1.9-32.5 35.7-30.2 53.1 25.7L126.1 261.9zM185.9 199.3l15.2-19.3 47.9 23.8-10.4 21L185.9 199.3zM246.1 228.5l10.3-21 40.6 20.2-10.4 20.4L246.1 228.5zM294.1 251.7l12.3-24c0 0 0 0 0 0l0 0 7.7-15 33.3 16.9c.6.3 1.2.4 1.9.4h9.3l-4.3 50.8L294.1 251.7z"/></g><g><polygon fill="#A6A8AB" points="119.4,172.5 81.5,203.8 79.7,244.4 127.5,265.1 178.4,199.4 \t"/><path fill="#A6A8AB" d="M127.5 270.4c-.7 0-1.4-.1-2.1-.4l-47.8-20.7c-2-.9-3.3-2.9-3.2-5.1l1.8-40.5c.1-1.5.8-2.9 1.9-3.8l37.9-31.3c1.6-1.3 3.7-1.6 5.6-.7l59 26.9c1.5.7 2.6 2 2.9 3.5.4 1.6 0 3.2-1 4.5l-50.9 65.7C130.7 269.6 129.1 270.4 127.5 270.4zM85.2 240.9l40.7 17.6 44.3-57.1-50-22.7-33.5 27.7L85.2 240.9z"/></g><g><path fill="#A6A8AB" d="M301.3 108.4l-30.6 62.9L289 183l30.9.6 16-61.9C336 121.7 324 121 301.3 108.4z"/><path fill="#A6A8AB" d="M320 188.9C319.9 188.9 319.9 188.9 320 188.9l-31-.6c-1 0-1.9-.3-2.8-.8l-18.3-11.7c-2.3-1.5-3.1-4.4-1.9-6.8l30.6-62.9c.6-1.3 1.8-2.3 3.2-2.8 1.4-.4 2.9-.3 4.2.4 20.9 11.7 32.2 12.6 32.4 12.6 1.6.1 3 .9 4 2.2.9 1.3 1.2 2.9.9 4.4l-16 61.9C324.5 187.3 322.4 188.9 320 188.9zM290.6 177.7l25.2.5 13.5-52.3c-5.3-1.3-14-4.1-25.7-10.2l-26.1 53.6L290.6 177.7z"/></g><g><polygon fill="#A6A8AB" points="99.7,90.8 104.9,98.1 104.9,111.3 132,111.3 192.9,53.8 185.9,42.8 \t"/><path fill="#A6A8AB" d="M132 116.6h-27.1c-2.9 0-5.3-2.4-5.3-5.3V99.8l-4.3-5.9c-.9-1.2-1.2-2.8-.9-4.3.3-1.5 1.3-2.8 2.6-3.5l86.3-47.9c1.9-1 4.2-.8 5.8.5l6.9 10.9c1.2 1 1.9 2.4 2 3.9.1 1.5-.5 3-1.6 4.1l-60.8 57.5C134.7 116 133.4 116.6 132 116.6zM110.2 106h19.7l54.9-51.9-2.4-1.9-74.9 40.4 1.7 2.4c.7.9 1 2 1 3.1V106z"/></g><g><polygon fill="#A6A8AB" points="4.8,91.4 30.6,92.8 24.6,213.1 4.8,201.8 \t"/><path fill="#A6A8AB" d="M24.6 218.4c-.9 0-1.8-.2-2.6-.7L2.2 206.4c-1.7-.9-2.7-2.7-2.7-4.6V91.4c0-1.4.6-2.8 1.6-3.8 1.1-1 2.5-1.5 3.9-1.4l25.8 1.3c2.9.1 5.2 2.6 5 5.5l-5.9 120.3c-.1 1.8-1.1 3.5-2.7 4.4C26.4 218.1 25.5 218.4 24.6 218.4zM10.1 198.7l9.7 5.5L25 97.8 10.1 97V198.7z"/></g><g><polygon fill="#A6A8AB" points="240.1,229.5 255.4,202.2 301.3,225.5 287.4,251.5 \t"/><path fill="#A6A8AB" d="M287.4 256.8c-.8 0-1.5-.2-2.2-.5l-47.3-22c-1.3-.6-2.4-1.8-2.8-3.2s-.3-2.9.4-4.2l15.3-27.3c1.4-2.5 4.5-3.4 7.1-2.1l45.9 23.3c1.3.6 2.2 1.8 2.7 3.2.4 1.4.3 2.9-.4 4.1l-14 26C291.1 255.8 289.3 256.8 287.4 256.8zM247.6 227.1l37.5 17.4 9-16.7-36.5-18.5L247.6 227.1z"/></g><g><polygon fill="#A6A8AB" points="358.4,272.1 364.6,226.4 396.5,226.4 397,271.7 \t"/><path fill="#A6A8AB" d="M358.4 277.4c-1.5 0-3-.7-4-1.8-1-1.2-1.5-2.7-1.3-4.2l6.2-45.7c.4-2.6 2.6-4.6 5.3-4.6h31.9c2.9 0 5.3 2.4 5.3 5.3l.4 45.3c0 2.9-2.3 5.3-5.3 5.4L358.4 277.4C358.4 277.4 358.4 277.4 358.4 277.4zM369.2 231.7l-4.8 35 27.1-.3-.3-34.7H369.2z"/></g><g><path fill="#A6A8AB" d="M198.6 5c0 0 6.2 34.2 43.5 62.6L314 5.4 198.6 5z"/><path fill="#A6A8AB" d="M242.1 72.9c-1.1 0-2.3-.4-3.2-1.1-38.5-29.3-45.2-64.4-45.5-65.8-.3-1.6.1-3.2 1.2-4.4 1-1.2 2.5-1.9 4.1-1.9L314 .1c2.2 0 4.2 1.4 5 3.5.8 2.1.2 4.4-1.5 5.9l-71.9 62.1C244.6 72.4 243.4 72.9 242.1 72.9zM205.7 10.3c3.5 10.3 13 31.4 36.3 50.3l57.8-49.9L205.7 10.3z"/></g><g><path fill="#A6A8AB" d="M56.3 5l15 31.3 37-11.5c0 0-3.1-4.4-7.9-20.3L56.3 5z"/><path fill="#A6A8AB" d="M71.2 41.5c-2 0-3.9-1.1-4.8-3l-15-31.3c-.8-1.6-.7-3.5.3-5.1s2.6-2.5 4.4-2.5l44.1-.4c0 0 0 0 .1 0 2.3 0 4.4 1.5 5.1 3.7 4.4 14.4 7.2 18.8 7.3 18.9 1 1.4 1.2 3.1.6 4.7-.5 1.6-1.9 2.8-3.5 3.3l-37 11.5C72.3 41.5 71.8 41.5 71.2 41.5zM64.6 10.2 74 29.8l26.7-8.3c-1.2-2.7-2.6-6.5-4.3-11.7L64.6 10.2z"/></g><g><path fill="#A6A8AB" d="M397.4 21.9l-1.6 78.5c-29.3 4.7-49.9-4.7-49.9-4.7L353 17l-8.4-12h53.2L397.4 21.9z"/><path fill="#A6A8AB" d="M379.4 107c-21.2 0-35.1-6.2-35.7-6.4-2.1-.9-3.3-3.1-3.1-5.3l6.9-76.8-7.3-10.4c-1.1-1.6-1.3-3.8-.4-5.5.9-1.8 2.7-2.9 4.7-2.9h53.2c1.4 0 2.8.6 3.8 1.6 1 1 1.5 2.4 1.5 3.9L402.7 22l-1.6 78.5c-.1 2.6-1.9 4.7-4.5 5.2C391 106.6 385.2 107 379.4 107zM351.6 92.2c5 1.6 14.9 4.2 27.8 4.2 3.7 0 7.5-.2 11.2-.6l1.5-74 .3-11.4h-37.5l2.5 3.6c.7 1 1.1 2.3.9 3.5L351.6 92.2z"/></g></symbol><symbol id="gauge"><rect y="0.4" opacity="0.5" fill="#F4F4F4" width="400.1" height="299.6"/><path fill="#E1E2E3" d="M200 82.3c-73.7 0-133.4 59.7-133.4 133.4h51.6c0-45.2 36.6-81.8 81.8-81.8s81.8 36.6 81.8 81.8h51.6C333.4 142 273.7 82.3 200 82.3z"/><path fill="#A6A8AB" d="M94.4 134.3C77 156.8 66.7 185 66.7 215.7h51.6c0-18.9 6.4-36.2 17.1-50.1L94.4 134.3z"/></symbol><symbol id="line"><rect x="0.1" fill="#F4F4F4" width="399.3" height="300.2"/><line fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="0.1" y1="73" x2="399.4" y2="73"/><line fill="#D0D2D3" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="0.1" y1="147" x2="399.4" y2="147"/><line fill="#D0D2D3" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="0.1" y1="220.9" x2="399.4" y2="220.9"/><g><polygon fill="#D0D2D3" points="115.1,206.7 175,214.5 231.8,84.9 287.3,80 344.6,96.4 399.8,85.2 399.8,81.1 344.8,92.3      288.1,76.1 287.7,76 229,81.2 172.5,210.1 114.9,202.7 57.5,215.7 0.1,170.2 0.1,175.3 56.5,220 \t"/></g></symbol><symbol id="map"><g><defs><rect id="SVGID_1_" x="0.9" y="0.2" width="399.1" height="299.6"/></defs><clipPath id="SVGID_2_"><use xlink:href="#SVGID_1_" overflow="visible"/></clipPath><path clip-path="url(#SVGID_2_)" fill="#E1E2E3" d="M54.1-9.8l19.8 48.3L-31.3 71.3c-2.4.7-3.7 3.3-2.9 5.6.6 1.9 2.4 3.2 4.3 3.2.4 0 .9-.1 1.3-.2l62.1-19.4-2 35.6-64.1-4.4c-2.5-.2-4.6 1.7-4.8 4.2-.2 2.5 1.7 4.6 4.2 4.8L31 105l-6.8 120.1-55-28.5c-2.2-1.1-4.9-.3-6.1 1.9-1.1 2.2-.3 4.9 1.9 6.1l61.3 31.8c0 0 0 0 0 0l22.9 11.9-76.8 64.9c-1.2 1-1.7 2.5-1.6 4 .2 1.5 1.1 2.8 2.4 3.5l68.1 34.4c.6.3 1.3.5 2 .5 1.6 0 3.2-.9 4-2.5 1.1-2.2.2-4.9-2-6l-62-31.4 74.4-62.9 22.7 11.8-4.9 86.3c-.1 2.5 1.8 4.6 4.2 4.7.1 0 .2 0 .3 0 2.4 0 4.3-1.8 4.5-4.2l4.7-82.2 42.2 21.9-45.2 57.3c-1.5 1.9-1.2 4.8.7 6.3.8.6 1.8 1 2.8 1 1.3 0 2.6-.6 3.5-1.7l102.9-130.5 58.8 28.5-48 97.3c-1.1 2.2-.2 4.9 2 6 .6.3 1.3.5 2 .5 1.7 0 3.2-.9 4-2.5l48-97.4 43.7 21.2-36.9 72.2c-1.1 2.2-.3 4.9 2 6 .7.3 1.4.5 2 .5 1.6 0 3.2-.9 4-2.4l37-72.3 68.4 33.1-3.1 36.8c-.2 2.5 1.6 4.6 4.1 4.9.1 0 .3 0 .4 0 2.3 0 4.3-1.8 4.5-4.1l3.2-37.5 41.3 5.7c2.4-.6 3.9-3 3.3-5.4-.6-2.4-3-3.9-5.4-3.3l-38.4-6.4 4.7-55.2h34.8c2.5 0 4.5-2 4.5-4.5s-2-4.5-4.5-4.5h-52.8l-35.1-17.8 1.4-2.6c.1-.3.3-.6.3-.9l3.7-14 82.3 3.1c.1 0 .1 0 .2 0 2.4 0 4.4-1.9 4.5-4.3.1-2.5-1.8-4.6-4.3-4.7l-80.3-3 15.5-58.4c16 3.8 34.2 6.3 54.4 6.3 3.4 0 6.9-.1 10.4-.2 2.5-.1 4.4-2.2 4.3-4.7-.1-2.5-2.2-4.4-4.7-4.3-23.3 1-44.1-1.6-62.1-6l5.1-19.3c15.8 3.6 29.9 4.5 40.2 4.5 10.5 0 17.1-1 17.7-1 2.5-.4 4.1-2.7 3.8-5.1-.4-2.5-2.7-4.1-5.1-3.8-.3 0-23.2 3.3-52.3-2.9l6.2-83 46.4 3.6c2.5.2 4.6-1.7 4.8-4.1.2-2.5-1.7-4.6-4.1-4.8L383.6 9l-18.9-34c-1.6-1.7-4.2-1.8-6.1-.4l-67.8 69.5c-10.7-15-19.2-32.6-25.5-52.9-.7-2.4-3.3-3.7-5.6-3-2.4.7-3.7 3.2-3 5.6 7 22.7 16.5 41 27.2 55.9l-20.7 17.5c-2.8-2-36.3-26.7-48-83.1-.5-2.4-2.9-4-5.3-3.5-2.4.5-4 2.9-3.5 5.3.7 3.6 1.6 7 2.5 10.3l-87.1 27.2c-12.6-11.8-8.4-37.4-8.3-37.6.4-2.4-1.2-4.8-3.6-5.2-2.5-.4-4.8 1.2-5.2 3.6-.2 1.2-4.4 26.4 7.8 42.1l-30.1 9.4c0 0 0 0 0-.1L61-16.7c-.8-2-2.9-3.1-5-2.7M333.7 223.9l-7.5 14.7-44-21.9 11.8-23.8 17.3 10c.6.4 1.3.6 2.1.6l27.4 1-3.1 11.6-2.4 4.6M310.5 78c7.4 6.2 15.1 11.3 22.6 15.4-.2.2-.3.4-.4.7l-8.8 17.8c-13.3-6.7-22.5-13.1-27-16.5l13.4-17.1C310.3 78.2 310.4 78.1 310.5 78zM291.2 102.5c4.9 3.8 14.6 10.6 28.6 17.7l-45.7 92.6L224 187.8 291.2 102.5zM343.1 195.6l-28.4-1.1-16.9-9.7 30-60.8c9 4.1 19.4 8 31.2 11.3L343.1 195.6zM361.4 126.5c-11.1-3.1-20.9-6.9-29.4-10.7l8.7-17.7c.1-.2.2-.4.2-.6 7 3.4 13.8 6 20.2 8.1 1.8.6 3.6 1.1 5.4 1.6L361.4 126.5zM361.1-15.8 376.9 15l-6.3 84c-2.2-.6-4.5-1.3-6.8-2-27.5-8.8-50.1-24.2-67.6-45.8L361.1-15.8zM303.8 72.2c-.2.2-.4.4-.6.6l-89.7 113.8 0 0-19.9 25.3-55.7-27L289.5 56.9C294.1 62.5 298.9 67.6 303.8 72.2zM94.6 174l26.9 13-29.1 24.6L94.6 174zM95.2 164.3l3.3-57.1 9.1-4.9 2.4 3.8V122c0 2.5 2 4.5 4.5 4.5h29.9c1.2 0 2.3-.4 3.1-1.2l32.3-30.9 22.4 24.6L129 180.7 95.2 164.3zM200.7 51.7l4.3 6.1-62.5 59.7h-23.7v-12.7c0-.9-.2-1.7-.7-2.4l-2.8-4.4L200.7 51.7zM256.3 73.2 209 113.1l-22.8-25L214 61.6c1.6-1.5 1.9-4 .6-5.8l-5.9-8.3 17.6-9.5C238.2 58.1 251.1 69.2 256.3 73.2zM221.9 30 99 96.7l3.3-57.7L211.5 4.9C214.6 14.3 218.1 22.7 221.9 30zM42.7 57.6l50.5-15.8L89.9 100l-49.4-3.4L42.7 57.6zM32.9 229.6l7.1-124 49.4 3.4L83 219.6l-26.4 22.3L32.9 229.6zM65.2 246.4l17.1-14.5L81 254.6 65.2 246.4zM137 283.6l-47.3-24.5 2-35.2 38.6-32.6 57.5 27.8L137 283.6zM201.8 215.9l16.5-20.9 51.8 25.8-11.2 22.8L201.8 215.9zM267 247.5l11.2-22.7 43.9 21.8-11.3 22L267 247.5zM318.9 272.6l13.3-26c0 0 0 0 0 0l0 0 8.3-16.3 36.1 18.3c.6.3 1.3.5 2 .5h10.1l-4.6 55L318.9 272.6z"/></g><circle fill="#D0D2D3" stroke="#A6A8AB" stroke-width="1.3183" stroke-miterlimit="10" cx="45.5" cy="62.9" r="18.5"/><circle fill="#D0D2D3" stroke="#A6A8AB" stroke-width="1.3183" stroke-miterlimit="10" cx="158.8" cy="177.3" r="12.8"/><circle fill="#D0D2D3" stroke="#A6A8AB" stroke-width="1.3183" stroke-miterlimit="10" cx="228.2" cy="235" r="12.8"/><circle fill="#D0D2D3" stroke="#A6A8AB" stroke-width="1.3183" stroke-miterlimit="10" cx="297.6" cy="157.2" r="6.5"/><circle fill="#D0D2D3" stroke="#A6A8AB" stroke-width="1.3183" stroke-miterlimit="10" cx="20.8" cy="230.1" r="6.5"/><circle fill="#D0D2D3" stroke="#A6A8AB" stroke-width="1.3183" stroke-miterlimit="10" cx="382.6" cy="250.1" r="6.5"/><circle fill="#D0D2D3" stroke="#A6A8AB" stroke-width="1.3183" stroke-miterlimit="10" cx="374.7" cy="22.1" r="6.5"/><circle fill="#D0D2D3" stroke="#A6A8AB" stroke-width="1.3183" stroke-miterlimit="10" cx="240.9" cy="111.1" r="6.5"/><circle fill="#D0D2D3" stroke="#A6A8AB" stroke-width="1.3183" stroke-miterlimit="10" cx="182.7" cy="26" r="6.5"/><circle fill="#D0D2D3" stroke="#A6A8AB" stroke-width="1.3183" stroke-miterlimit="10" cx="268.6" cy="95.6" r="13.6"/><circle fill="#D0D2D3" stroke="#A6A8AB" stroke-width="1.0954" stroke-miterlimit="10" cx="63.2" cy="124.9" r="11.3"/></symbol><symbol id="matrix"><rect x="0" y="0.1" fill="#F4F4F4" width="400" height="299.9"/><rect x="0.3" y="0" fill="#E1E2E3" width="92.8" height="300"/><line fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="93.1" y1="0" x2="93.1" y2="300"/><line fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="199.7" y1="0.5" x2="199.7" y2="299.8"/><line fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="298.6" y1="0" x2="298.6" y2="300"/><rect x="14.7" y="46.4" fill="#A6A6A6" width="61.2" height="3.1"/><rect x="108.8" y="46.4" fill="#A6A6A6" width="76.8" height="3.1"/><rect x="212.2" y="46.4" fill="#A6A6A6" width="76.8" height="3.1"/><rect x="311.1" y="46.4" fill="#A6A6A6" width="76.8" height="3.1"/><rect x="14.7" y="79.7" fill="#A6A6A6" width="61.2" height="3.1"/><rect x="108.8" y="79.7" fill="#A6A6A6" width="76.8" height="3.1"/><rect x="212.2" y="79.7" fill="#A6A6A6" width="76.8" height="3.1"/><rect x="311.1" y="79.7" fill="#A6A6A6" width="76.8" height="3.1"/><rect x="14.7" y="114" fill="#A6A6A6" width="61.2" height="3.1"/><rect x="108.8" y="114" fill="#A6A6A6" width="76.8" height="3.1"/><rect x="212.2" y="114" fill="#A6A6A6" width="76.8" height="3.1"/><rect x="311.1" y="114" fill="#A6A6A6" width="76.8" height="3.1"/><rect x="14.7" y="148.5" fill="#A6A6A6" width="61.2" height="3.1"/><rect x="108.8" y="148.5" fill="#A6A6A6" width="76.8" height="3.1"/><rect x="212.2" y="148.5" fill="#A6A6A6" width="76.8" height="3.1"/><rect x="311.1" y="148.5" fill="#A6A6A6" width="76.8" height="3.1"/><rect x="14.7" y="182.3" fill="#A6A6A6" width="61.2" height="3.1"/><rect x="108.8" y="182.3" fill="#A6A6A6" width="76.8" height="3.1"/><rect x="212.2" y="182.3" fill="#A6A6A6" width="76.8" height="3.1"/><rect x="311.1" y="182.3" fill="#A6A6A6" width="76.8" height="3.1"/><rect x="14.7" y="215.3" fill="#A6A6A6" width="61.2" height="3.1"/><rect x="108.8" y="215.3" fill="#A6A6A6" width="76.8" height="3.1"/><rect x="212.2" y="215.3" fill="#A6A6A6" width="76.8" height="3.1"/><rect x="311.1" y="215.3" fill="#A6A6A6" width="76.8" height="3.1"/><rect x="14.7" y="248.6" fill="#A6A6A6" width="61.2" height="3.1"/><rect x="108.8" y="248.6" fill="#A6A6A6" width="76.8" height="3.1"/><rect x="212.2" y="248.6" fill="#A6A6A6" width="76.8" height="3.1"/><rect x="311.1" y="248.6" fill="#A6A6A6" width="76.8" height="3.1"/><rect x="14.7" y="281.5" fill="#A6A6A6" width="61.2" height="3.1"/><rect x="108.8" y="281.5" fill="#A6A6A6" width="76.8" height="3.1"/><rect x="212.2" y="281.5" fill="#A6A6A6" width="76.8" height="3.1"/><rect x="311.1" y="281.5" fill="#A6A6A6" width="76.8" height="3.1"/><rect x="14.7" y="15.2" fill="#A6A6A6" width="61.2" height="3.1"/><rect x="108.8" y="15.2" fill="#A6A6A6" width="76.8" height="3.1"/><rect x="212.2" y="15.2" fill="#A6A6A6" width="76.8" height="3.1"/><rect x="311.1" y="15.2" fill="#A6A6A6" width="76.8" height="3.1"/><rect x="0" y="0" fill="#D0D2D3" width="399.8" height="30.4"/></symbol><symbol id="multiRowCard"><rect x="-0.1" y="-0.1" fill="#F4F4F4" width="400.1" height="300"/><rect x="22" y="21" fill="#A6A6A6" width="3.1" height="47.2"/><rect x="22" y="91" fill="#A6A6A6" width="3.1" height="47.2"/><rect x="22" y="160.3" fill="#A6A6A6" width="3.1" height="47.2"/><rect x="22" y="231" fill="#A6A6A6" width="3.1" height="47.2"/><rect x="36.7" y="35.5" fill="#ACACAC" width="56.4" height="7.7"/><rect x="36.7" y="46.2" fill="#D0D2D3" width="39.3" height="7.7"/><rect x="36.7" y="105.4" fill="#ACACAC" width="56.4" height="7.7"/><rect x="36.7" y="116.1" fill="#D0D2D3" width="46.3" height="7.7"/><rect x="36.7" y="174.7" fill="#ACACAC" width="65.8" height="7.7"/><rect x="36.7" y="185.4" fill="#D0D2D3" width="39.3" height="7.7"/><rect x="36.7" y="245.5" fill="#ACACAC" width="56.4" height="7.7"/><rect x="36.7" y="256.2" fill="#D0D2D3" width="28.2" height="7.7"/><rect x="163.1" y="35.5" fill="#ACACAC" width="56.4" height="7.7"/><rect x="163.1" y="46.2" fill="#D0D2D3" width="39.3" height="7.7"/><rect x="163.1" y="105.4" fill="#ACACAC" width="56.4" height="7.7"/><rect x="163.1" y="116.1" fill="#D0D2D3" width="46.3" height="7.7"/><rect x="163.1" y="174.7" fill="#ACACAC" width="65.8" height="7.7"/><rect x="163.1" y="185.4" fill="#D0D2D3" width="39.3" height="7.7"/><rect x="163.1" y="245.5" fill="#ACACAC" width="39.3" height="7.7"/><rect x="163.1" y="256.2" fill="#D0D2D3" width="28.2" height="7.7"/><rect x="289.5" y="35.5" fill="#ACACAC" width="56.4" height="7.7"/><rect x="289.5" y="46.2" fill="#D0D2D3" width="75.4" height="7.7"/><rect x="289.5" y="105.4" fill="#ACACAC" width="37.7" height="7.7"/><rect x="289.5" y="116.1" fill="#D0D2D3" width="87.4" height="7.7"/><rect x="289.5" y="174.7" fill="#ACACAC" width="28.2" height="7.7"/><rect x="289.5" y="185.4" fill="#D0D2D3" width="56.4" height="7.7"/><rect x="289.5" y="245.5" fill="#ACACAC" width="56.4" height="7.7"/><rect x="289.5" y="256.2" fill="#D0D2D3" width="87.4" height="7.7"/></symbol><symbol id="pie"><rect y="0.2" fill="#F4F4F4" width="400" height="299.8"/><path fill="#929497" d="M200 55.3v94.8l60.8 72.7c20.8-17.4 34-43.5 34-72.7v0C294.8 97.7 252.3 55.3 200 55.3z"/><path fill="#D0D2D3" d="M105.2 150.1c0 44.4 30.6 81.7 71.8 92l23-92H105.2z"/><path fill="#E1E2E3" d="M200 150.1l-23 92c7.4 1.8 15.1 2.8 23 2.8 23.1 0 44.3-8.3 60.8-22.1L200 150.1z"/><path fill="#A6A8AB" d="M200 55.3c-52.3 0-94.8 42.4-94.8 94.8v0H200V55.3z"/></symbol><symbol id="scatterplot"><rect x="1.3" y="0" fill="#F4F4F4" width="398.7" height="300"/><line fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="133.9" y1="0.4" x2="133.9" y2="298"/><line fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="266.9" y1="0.4" x2="266.9" y2="300"/><line fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="0" y1="149.8" x2="400" y2="149.8"/><circle fill="#D0D2D3" cx="74.9" cy="214.1" r="36.2"/><circle fill="#D0D2D3" cx="186" cy="94" r="12.9"/><circle fill="#D0D2D3" cx="266.9" cy="124.1" r="17.2"/><circle fill="#D0D2D3" cx="310.4" cy="193.8" r="26.3"/><circle fill="#D0D2D3" cx="214.5" cy="176.3" r="18.6"/><circle fill="#D0D2D3" cx="137" cy="150.2" r="12.9"/><circle fill="#D0D2D3" cx="346.4" cy="68.1" r="12.9"/></symbol><symbol id="shapeMap"><rect x="0.7" y="0" opacity="0.5" fill="#F4F4F4" width="401.4" height="302.1"/><g><path fill-rule="evenodd" clip-rule="evenodd" fill="#EEEEEE" d="M379.2 0H400v10.75l-14.2-1.5c-1.672-.266-2.738-1.016-3.2-2.25L379.2 0zM218.775 0h39c7.22 18.663 16.17 35.087 26.85 49.275L261.85 68.55C243.634 49.55 229.275 26.7 218.775 0zM0 62V0h57.725L73.15 38.875 0 62zM78.175 300H1.25l55.925-47.325L80.2 264.775 78.175 300zM231.05 300h-96.475l60.575-76.7 59.575 28.851L231.05 300zM400 206.675v34.575h-18.5l-37.15-18.025 1.825-3.475 3.875-14.825L400 206.675zM400 142.875v55.05l-47.675-1.649 15.725-59.95C378.267 138.94 388.917 141.123 400 142.875zM361.275 125.875c-10.32-2.924-20.153-6.332-29.5-10.225l9.5-19.175c7.915 3.922 16.273 7.272 25.074 10.05L361.275 125.875zM326.425 238.75 281.6 217.025 293.45 193.1l17.3 9.15c1.639.954 3.472 1.454 5.5 1.5l24.4.85-3.7 14.15L326.425 238.75zM304.65 71.4 192.9 212.875l-56.4-27.3 153.325-129.75C294.472 61.398 299.414 66.59 304.65 71.4zM121.25 187.5l-30.1 25.475L93.375 174 121.25 187.5zM39.55 105.2l49.6 3.2-6.375 111.65L56.25 242.475l-24.7-12.949L39.55 105.2zM258.45 244.65l-57.976-28.101 17.075-21.625L270.4 220.5 258.45 244.65z"/><path fill-rule="evenodd" clip-rule="evenodd" fill="#FFFFFF" d="M369.4 0l7.024 14.975L371 99.15c-30.688-8.892-55.647-25.2-74.875-48.925L345.425 0H369.4zM400 114.05v20.15c-10.34-1.591-20.281-3.575-29.825-5.95l5-19.175C383.115 111.174 391.39 112.833 400 114.05zM333.675 0l-42.85 43.325C281.736 30.743 274.086 16.301 267.875 0H333.675zM353.45 300H304l10.05-19.1L353.45 300zM240.55 300l21.825-44.15 43.9 21.275L294.25 300H240.55zM0 212.95V102.675l30.925 1.975-7.75 120.475L0 212.95zM111.975 0H196.1l-75.025 23.725C115.636 18.07 112.603 10.162 111.975 0zM0 290.075v-67.4l49.175 25.8L0 290.075zM124.1 300H86.175l1.775-31.15 42.95 22.525L124.1 300zM392.025 300l5.225-49.85H400V300H392.025zM384.275 300H372.7l-54.75-26.525 22.524-42.875 37.551 18.226c1.563.898 3.389 1.34 5.475 1.325h6L384.275 300zM359.175 133.9l-16.25 62.05L316 195l-18.6-9.875 30.75-62.15C337.978 127.132 348.319 130.773 359.175 133.9zM295.35 96.425l15.5-19.625c7.126 5.878 14.751 11.103 22.875 15.675l-9.774 19.75C313.812 107.567 304.277 102.3 295.35 96.425zM199.925 51.6l4.575 5.9-62 59.75h-25.3l.75-11.25c-.098-2.051-.498-3.617-1.2-4.7L114.3 98 199.925 51.6zM40.075 97l2.575-39.975L93 41.1l-3.375 59.075L40.075 97zM80.75 255.325l-16.475-8.65L82.1 231.6 80.75 255.325zM136.325 284.5 88.5 259.4l2-34.9 39-33 58.075 28.125L136.325 284.5zM310.175 269.7 266.1 248.35l11.95-24.149 44.65 21.649L310.175 269.7z"/><path fill-rule="evenodd" clip-rule="evenodd" fill="#F8F8F8" d="M66.725 0h36.325c.458 11.727 3.549 20.561 9.275 26.5L81.15 36.35 66.725 0zM0 94.425V70.5l33.8-10.675L31.45 96.45 0 94.425zM400 19.825V105.1c-6.929-.898-13.62-2.106-20.075-3.625l5.351-83.225L400 19.825zM223.075 29.2l-125.3 67.925 3.35-58.6L211.05 3.775C214.647 12.659 218.656 21.134 223.075 29.2zM207.675 47.4l19.7-10.7c8.162 13.625 17.57 26 28.225 37.125l-46.875 39.65-23.3-25.825L213.5 60.6c1.147-1.6 1.364-3.2.65-4.8L207.675 47.4zM320.35 119.525l-46.399 93.8-51.3-24.851 67.675-85.7C299.695 108.996 309.704 114.579 320.35 119.525zM179.125 93.725l22.925 25.4-73.775 62.45L93.9 164.925l3.3-57.625 9.7-5.275 2.95 3.975-1 15.1c.133 3.4 1.916 5.15 5.35 5.25h28.65c1.682.015 3.099-.568 4.25-1.75L179.125 93.725z"/><path fill-rule="evenodd" clip-rule="evenodd" fill="#D9D9D9" d="M400 10.75v9.075l-14.725-1.575-5.351 83.225c6.455 1.519 13.146 2.727 20.075 3.625v8.95c-8.61-1.217-16.885-2.875-24.825-4.975l-5 19.175c9.544 2.375 19.485 4.359 29.825 5.95v8.675c-11.083-1.752-21.733-3.935-31.95-6.55l-15.725 59.95L400 197.925v8.75l-49.95-1.75-3.875 14.825-1.825 3.475 37.15 18.025H400v8.9h-2.75L392.025 300h-7.75l5.225-49.85h-6c-2.086.015-3.911-.427-5.475-1.325L340.475 230.6l-22.524 42.875L372.7 300h-19.25l-39.4-19.1L304 300h-9.75l12.025-22.875-43.9-21.275L240.55 300h-9.5l23.675-47.85L195.15 223.3 134.575 300H124.1l6.8-8.625L87.95 268.85 86.175 300h-8l2.025-35.225-23.025-12.101L1.25 300H0v-9.925l49.175-41.601L0 222.675v-9.725l23.175 12.175 7.75-120.475L0 102.675v-8.25l31.45 2.025 2.35-36.625L0 70.5V62l73.15-23.125L57.725 0h9L81.15 36.35l31.175-9.85c-5.726-5.939-8.818-14.773-9.275-26.5h8.925c.627 10.162 3.661 18.07 9.1 23.725L196.1 0h22.675c10.5 26.7 24.858 49.55 43.074 68.55l22.775-19.275c-10.68-14.188-19.63-30.612-26.85-49.275h10.1c6.211 16.301 13.861 30.743 22.95 43.325L333.675 0h11.75l-49.3 50.225C315.353 73.95 340.312 90.258 371 99.15l5.425-84.175L369.4 0h9.8l3.399 7c.462 1.234 1.528 1.984 3.2 2.25L400 10.75zM361.275 125.875l5.074-19.35c-8.801-2.778-17.159-6.128-25.074-10.05l-9.5 19.175C341.122 119.543 350.955 122.951 361.275 125.875zM359.175 133.9c-10.855-3.126-21.197-6.768-31.024-10.925l-30.75 62.15L316 195l26.925.95L359.175 133.9zM326.425 238.75l10.525-20 3.7-14.15-24.4-.85c-2.028-.046-3.861-.546-5.5-1.5l-17.3-9.15L281.6 217.025 326.425 238.75zM304.65 71.4c-5.236-4.81-10.179-10.001-14.825-15.575L136.5 185.575l56.4 27.3L304.65 71.4zM295.35 96.425c8.928 5.875 18.462 11.142 28.601 15.8l9.774-19.75c-8.124-4.572-15.749-9.797-22.875-15.675L295.35 96.425zM223.075 29.2c-4.419-8.066-8.428-16.541-12.025-25.425l-109.925 34.75-3.35 58.6L223.075 29.2zM207.675 47.4l6.476 8.4c.714 1.6.497 3.2-.65 4.8l-28.075 27.05 23.3 25.825 46.875-39.65c-10.654-11.125-20.063-23.5-28.225-37.125L207.675 47.4zM199.925 51.6 114.3 98l2.45 3.3c.703 1.083 1.103 2.649 1.2 4.7l-.75 11.25h25.3l62-59.75L199.925 51.6zM320.35 119.525c-10.646-4.946-20.654-10.529-30.024-16.75l-67.675 85.7 51.3 24.851L320.35 119.525zM179.125 93.725 147.1 124.6c-1.151 1.182-2.568 1.765-4.25 1.75H114.2c-3.434-.1-5.217-1.85-5.35-5.25l1-15.1-2.95-3.975-9.7 5.275-3.3 57.625 34.375 16.65 73.775-62.45L179.125 93.725zM40.075 97l49.55 3.175L93 41.1 42.65 57.025 40.075 97zM121.25 187.5 93.375 174l-2.225 38.975L121.25 187.5zM39.55 105.2l-8 124.325 24.7 12.949 26.525-22.425L89.15 108.4 39.55 105.2zM136.325 284.5l51.25-64.875L129.5 191.5l-39 33-2 34.9L136.325 284.5zM80.75 255.325 82.1 231.6l-17.825 15.075L80.75 255.325zM258.45 244.65l11.95-24.15-52.851-25.575-17.075 21.625L258.45 244.65zM310.175 269.7 322.7 245.85 278.05 224.2 266.1 248.35 310.175 269.7z"/></g></symbol><symbol id="slicer"><rect x="-0.1" y="0" fill="#F4F4F4" width="400.1" height="300"/><rect x="11.8" y="17.7" fill="#D0D2D3" width="34.7" height="15.3"/><rect x="34.1" y="57" fill="#D0D2D3" width="33.8" height="7.7"/><rect x="12.8" y="55" fill="none" stroke="#D0D2D3" stroke-width="2" stroke-miterlimit="10" width="11.3" height="11.3"/><rect x="12.8" y="79" fill="none" stroke="#D0D2D3" stroke-width="2" stroke-miterlimit="10" width="11.3" height="11.3"/><rect x="34.1" y="105" fill="#D0D2D3" width="33.8" height="7.7"/><rect x="12.8" y="103" fill="none" stroke="#D0D2D3" stroke-width="2" stroke-miterlimit="10" width="11.3" height="11.3"/><rect x="34.1" y="129" fill="#D0D2D3" width="33.8" height="7.7"/><rect x="12.8" y="127" fill="none" stroke="#D0D2D3" stroke-width="2" stroke-miterlimit="10" width="11.3" height="11.3"/><rect x="34.1" y="153" fill="#D0D2D3" width="33.8" height="7.7"/><rect x="12.8" y="151" fill="none" stroke="#D0D2D3" stroke-width="2" stroke-miterlimit="10" width="11.3" height="11.3"/><rect x="34.1" y="177" fill="#D0D2D3" width="33.8" height="7.7"/><rect x="12.8" y="175" fill="none" stroke="#D0D2D3" stroke-width="2" stroke-miterlimit="10" width="11.3" height="11.3"/><rect x="34.1" y="201" fill="#D0D2D3" width="33.8" height="7.7"/><rect x="12.8" y="199" fill="none" stroke="#D0D2D3" stroke-width="2" stroke-miterlimit="10" width="11.3" height="11.3"/><rect x="34.1" y="225" fill="#D0D2D3" width="33.8" height="7.7"/><rect x="12.8" y="223" fill="none" stroke="#D0D2D3" stroke-width="2" stroke-miterlimit="10" width="11.3" height="11.3"/><rect x="34.1" y="249" fill="#D0D2D3" width="33.8" height="7.7"/><rect x="12.8" y="247" fill="none" stroke="#D0D2D3" stroke-width="2" stroke-miterlimit="10" width="11.3" height="11.3"/><rect x="34.1" y="273" fill="#D0D2D3" width="33.8" height="7.7"/><rect x="12.8" y="271" fill="none" stroke="#D0D2D3" stroke-width="2" stroke-miterlimit="10" width="11.3" height="11.3"/><rect x="34.1" y="81.7" fill="#D0D2D3" width="33.8" height="7.7"/><line fill="none" stroke="#D0D2D3" stroke-miterlimit="10" x1="3.4" y1="44.3" x2="389.4" y2="44.3"/></symbol><symbol id="stackedarea"><rect id="XMLID_263_" x="0" opacity="0.5" fill="#F1F2F2" width="400" height="300"/><line id="XMLID_262_" opacity="0.5" fill="#F4F4F4" x1="0" y1="38" x2="400" y2="38"/><line id="XMLID_261_" opacity="0.5" fill="#F4F4F4" x1="0" y1="75.4" x2="400" y2="75.4"/><line id="XMLID_260_" opacity="0.5" fill="#F4F4F4" x1="0" y1="112.8" x2="400" y2="112.8"/><line id="XMLID_259_" opacity="0.5" fill="#F4F4F4" x1="0" y1="150.3" x2="400" y2="150.3"/><line id="XMLID_258_" opacity="0.5" fill="#F4F4F4" x1="400" y1="187.7" x2="0" y2="187.7"/><line id="XMLID_257_" opacity="0.5" fill="#F4F4F4" x1="0" y1="225.1" x2="400" y2="225.1"/><line id="XMLID_256_" opacity="0.5" fill="#F4F4F4" x1="0" y1="262.6" x2="400" y2="262.6"/><polygon id="XMLID_242_" fill="#A6A8AB" points="0,107.5 83.6,96.9 139.6,113 200,97.1 265.8,116.6 336,107.7 400,116.3 400,199.3\t  0,199.3 "/><polygon id="XMLID_239_" fill="#D0D2D3" points="0,157.6 60.4,153 132.4,169.6 216.9,159 279.1,177.7 334.2,162.7 400,172.5 400,253.2\t  0,253.2 "/><polygon id="XMLID_236_" fill="#E1E2E3" points="0,224.1 69.3,241.5 156,219.5 252,241.5 332,219.5 400,227.8 400,300 0,300 "/><polyline id="XMLID_138_" fill="none" stroke="#797A7A" stroke-width="4" stroke-miterlimit="10" points="0,107.5 83.6,96.9 139.6,113 200,97.1 265.8,116.6 336,107.7 400,116.3 "/><polyline id="XMLID_294_" fill="none" stroke="#929497" stroke-width="4" stroke-miterlimit="10" points="0,157.6 60.4,153 132.4,169.6 216.9,159 279.1,177.7 334.2,162.7 400,172.5 "/><polyline id="XMLID_301_" fill="none" stroke="#A6A8AB" stroke-width="4" stroke-miterlimit="10" points="0,224.1 69.3,241.5 156,219.5 252,241.5 332,219.5 400,227.8 "/></symbol><symbol id="stackedbar"><rect y="0" fill="#F4F4F4" width="400" height="299.8"/><line fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="93.1" y1="0" x2="93.1" y2="299.5"/><line fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="199.7" y1="0" x2="199.7" y2="299.3"/><line fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="298.6" y1="0" x2="298.6" y2="299.5"/><rect x="0" y="20.6" fill="#E1E2E3" width="179.9" height="39"/><rect x="0" y="74.7" fill="#E1E2E3" width="253.4" height="39"/><rect x="0" y="129.8" fill="#E1E2E3" width="224.6" height="39"/><rect x="0" y="184" fill="#E1E2E3" width="311.1" height="39"/><rect x="0" y="241" fill="#E1E2E3" width="367.2" height="39"/><rect x="0" y="20.6" fill="#D0D2D3" width="138.7" height="39"/><rect x="0" y="74.7" fill="#D0D2D3" width="195.3" height="39"/><rect x="0" y="129.8" fill="#D0D2D3" width="173.1" height="39"/><rect x="0" y="184" fill="#D0D2D3" width="239.8" height="39"/><rect x="0" y="241" fill="#D0D2D3" width="283" height="39"/><rect x="0" y="20.6" opacity="0.5" fill="#A6A8AB" width="90.2" height="39"/><rect x="0" y="74.7" opacity="0.5" fill="#A6A8AB" width="127" height="39"/><rect x="0" y="129.8" opacity="0.5" fill="#A6A8AB" width="112.5" height="39"/><rect x="0" y="184" opacity="0.5" fill="#A6A8AB" width="155.9" height="39"/><rect x="0" y="241" opacity="0.5" fill="#A6A8AB" width="184" height="39"/></symbol><symbol id="stackedcolumn"><rect x="0.2" y="-0.1" fill="#F4F4F4" width="400.1" height="300"/><line fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="0.2" y1="73.4" x2="400.2" y2="73.4"/><line fill="#D0D2D3" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="0.2" y1="147.9" x2="400.2" y2="147.9"/><line fill="#D0D2D3" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="0.2" y1="222.3" x2="400.2" y2="222.3"/><rect x="19.3" y="193.2" fill="#E1E2E3" width="40.9" height="106.9"/><rect x="83.3" y="167.7" fill="#E1E2E3" width="40.9" height="132.4"/><rect x="147.3" y="187.7" fill="#E1E2E3" width="40.9" height="112.4"/><rect x="211.3" y="82" fill="#E1E2E3" width="40.9" height="218.1"/><rect x="275.4" y="39.8" fill="#E1E2E3" width="40.9" height="260.3"/><rect x="339.4" y="122.3" fill="#E1E2E3" width="40.9" height="177.9"/><rect x="19.3" y="219.2" fill="#D0D2D3" width="40.9" height="80.9"/><rect x="83.3" y="199.9" fill="#D0D2D3" width="40.9" height="100.2"/><rect x="147.3" y="215.1" fill="#D0D2D3" width="40.9" height="85"/><rect x="211.3" y="129.8" fill="#D0D2D3" width="40.9" height="170.3"/><rect x="275.4" y="103.2" fill="#D0D2D3" width="40.9" height="197"/><rect x="339.4" y="165.6" fill="#D0D2D3" width="40.9" height="134.6"/><rect x="19.3" y="254" opacity="0.5" fill="#A6A8AB" width="40.9" height="46.1"/><rect x="83.3" y="243" opacity="0.5" fill="#A6A8AB" width="40.9" height="57.1"/><rect x="147.3" y="251.6" opacity="0.5" fill="#A6A8AB" width="40.9" height="48.5"/><rect x="211.3" y="206.1" opacity="0.5" fill="#A6A8AB" width="40.9" height="94.1"/><rect x="275.4" y="187.8" opacity="0.5" fill="#A6A8AB" width="40.9" height="112.3"/><rect x="339.4" y="223.4" opacity="0.5" fill="#A6A8AB" width="40.9" height="76.7"/></symbol><symbol id="table"><rect x="0" y="0" fill="#F4F4F4" width="399.8" height="265.4"/><rect x="0" y="0" fill="#D0D2D3" width="399.8" height="30.1"/><rect x="14.4" y="46.6" fill="#A6A6A6" width="76.7" height="3.1"/><rect x="111.4" y="46.6" fill="#A6A6A6" width="76.7" height="3.1"/><rect x="208.5" y="46.6" fill="#A6A6A6" width="76.7" height="3.1"/><rect x="304.8" y="46.6" fill="#A6A6A6" width="76.7" height="3.1"/><line fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="0" y1="64.8" x2="400" y2="64.8"/><rect x="14.4" y="79.6" fill="#A6A6A6" width="76.7" height="3.1"/><rect x="111.4" y="79.6" fill="#A6A6A6" width="76.7" height="3.1"/><rect x="208.5" y="79.6" fill="#A6A6A6" width="76.7" height="3.1"/><rect x="304.8" y="79.6" fill="#A6A6A6" width="76.7" height="3.1"/><line fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="0" y1="98.6" x2="399.3" y2="98.6"/><rect x="14.4" y="113.4" fill="#A6A6A6" width="76.7" height="3.1"/><rect x="111.4" y="113.4" fill="#A6A6A6" width="76.7" height="3.1"/><rect x="208.5" y="113.4" fill="#A6A6A6" width="76.7" height="3.1"/><rect x="304.8" y="113.4" fill="#A6A6A6" width="76.7" height="3.1"/><line fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="0" y1="132.7" x2="400" y2="132.7"/><rect x="14.4" y="147.5" fill="#A6A6A6" width="76.7" height="3.1"/><rect x="111.4" y="147.5" fill="#A6A6A6" width="76.7" height="3.1"/><rect x="208.5" y="147.5" fill="#A6A6A6" width="76.7" height="3.1"/><rect x="304.8" y="147.5" fill="#A6A6A6" width="76.7" height="3.1"/><line fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="0" y1="166.2" x2="400" y2="166.2"/><rect x="14.4" y="181" fill="#A6A6A6" width="76.7" height="3.1"/><rect x="111.4" y="181" fill="#A6A6A6" width="76.7" height="3.1"/><rect x="208.5" y="181" fill="#A6A6A6" width="76.7" height="3.1"/><rect x="304.8" y="181" fill="#A6A6A6" width="76.7" height="3.1"/><line fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="0" y1="198.8" x2="400" y2="198.8"/><rect x="14.4" y="213.7" fill="#A6A6A6" width="76.7" height="3.1"/><rect x="111.4" y="213.7" fill="#A6A6A6" width="76.7" height="3.1"/><rect x="208.5" y="213.7" fill="#A6A6A6" width="76.7" height="3.1"/><rect x="304.8" y="213.7" fill="#A6A6A6" width="76.7" height="3.1"/><line fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="0" y1="231.7" x2="400" y2="231.7"/><rect x="14.4" y="246.5" fill="#A6A6A6" width="76.7" height="3.1"/><rect x="111.4" y="246.5" fill="#A6A6A6" width="76.7" height="3.1"/><rect x="208.5" y="246.5" fill="#A6A6A6" width="76.7" height="3.1"/><rect x="304.8" y="246.5" fill="#A6A6A6" width="76.7" height="3.1"/><rect x="0" y="265.4" fill="#F4F4F4" width="399.3" height="34.6"/><line fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="0" y1="265.4" x2="400" y2="265.4"/><rect x="14.4" y="281.1" fill="#A6A6A6" width="76.7" height="3.1"/><rect x="111.4" y="281.1" fill="#A6A6A6" width="76.7" height="3.1"/><rect x="208.5" y="281.1" fill="#A6A6A6" width="76.7" height="3.1"/><rect x="304.8" y="281.1" fill="#A6A6A6" width="76.7" height="3.1"/></symbol><symbol id="tree"><rect x="204.3" y="0" fill="#E1E2E3" width="195.3" height="150"/><rect x="0" y="0" fill="#D0D2D3" width="204.3" height="150"/><rect x="0" y="150" fill="#E1E2E3" width="180.9" height="79.6"/><rect x="0" y="229.6" fill="#A6A8AB" width="180.9" height="70.4"/><rect x="180.9" y="150" fill="#F4F4F4" width="121.1" height="103.8"/><rect x="302" y="150" opacity="0.5" fill="#A6A8AB" width="97.7" height="103.8"/><rect x="180.9" y="253.8" fill="#E1E2E3" width="218.8" height="46.2"/></symbol><symbol id="waterfall"><rect x="-0.1" y="0" fill="#F4F4F4" width="400.3" height="299.6"/><line fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="-0.1" y1="73.1" x2="400.2" y2="73.1"/><line fill="#D0D2D3" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="-0.1" y1="147.6" x2="400.2" y2="147.6"/><line fill="#D0D2D3" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="-0.1" y1="222" x2="400.2" y2="222"/><rect x="75.3" y="128" fill="#D0D2D3" width="44" height="89.1"/><rect x="143.8" y="27.1" fill="#D0D2D3" width="44" height="103"/><rect x="212.3" y="27.1" fill="#D0D2D3" width="44" height="205.3"/><rect x="280.8" y="230.2" fill="#D0D2D3" width="44" height="55"/><rect x="349.2" y="283.1" fill="#D0D2D3" width="44" height="16.5"/><rect x="6.9" y="214.9" fill="#D0D2D3" width="44" height="84.7"/><rect x="50.8" y="214.9" fill="#D0D2D3" width="24.5" height="2.1"/><rect x="119.3" y="128" fill="#D0D2D3" width="24.5" height="2.1"/><rect x="187.8" y="27.1" fill="#D0D2D3" width="24.5" height="2.1"/><rect x="256.3" y="230.2" fill="#D0D2D3" width="24.5" height="2.1"/><rect x="324.7" y="283.1" fill="#D0D2D3" width="24.5" height="2.1"/></symbol><symbol id="scriptvisual"><rect x="0" y="0" fill="#F4F4F4" width="400" height="100"/><rect x="0" y="100" fill="#FFFFFF" width="400" height="100"/><rect x="0" y="200" fill="#F4F4F4" width="400" height="100"/><path fill="#E1E2E3" d="M138.8 90h-65.5v-8h65.5V90z"/><path fill="#E1E2E3" d="M22.3 81l-8.2-9.7 25.1-21.2-25.1-21.3 8.2-9.7 35.9 30.3v1.4L22.3 81z"/><path fill="#E1E2E3" d="M168.2 193.4h-14.5v-14.5h14.5V193.4z"/><path fill="#E1E2E3" d="M199.3 160.2v33.4h-16v-87.2h36.3c3 0 6 .5 9.1 1.5 3.1 1.1 5.9 2.6 8.4 4.8 2.5 2.1 4.6 4.9 6.2 8.3 1.6 3.4 2.4 7.5 2.4 12.3 0 3.6-.4 6.6-1.3 9.4-.8 2.8-2 5.1-3.5 7.2-1.5 2-3.2 3.8-5.2 5.2-1.9 1.4-4 2.5-6.2 3.3l18.5 35.1h-17.2l-16.6-33.4h-14.9V160.2zM217.2 145.5c1.4 0 2.8-.2 4.3-.5 1.5-.4 2.9-1.1 4.2-2 1.2-1 2.4-2.2 3.2-3.7.8-1.5 1.2-3.5 1.2-5.9 0-2.4-.4-4.4-1.2-5.9-.9-1.6-1.9-2.8-3.2-3.8-1.2-1-2.6-1.6-4.2-2-1.5-.4-2.9-.6-4.3-.6h-18v24.3L217.2 145.5 217.2 145.5z"/></symbol><symbol id="pythonvisual"><rect x="0" y="0" fill="#F4F4F4" width="400" height="100"/><rect x="0" y="100" fill="#FFFFFF" width="400" height="100"/><rect x="0" y="200" fill="#F4F4F4" width="400" height="100"/><path fill="#E1E2E3" d="M22.3 81l-8.2-9.7 25.1-21.2-25.1-21.3 8.2-9.7 35.9 30.3v1.4L22.3 81z"/><g transform="scale(0.8, 0.8) translate(142, 65)"><path style="fill:#E1E2E3;fill-opacity:1;fill-rule:nonzero;stroke:none;stroke-width:1;stroke-linecap:butt;stroke-linejoin:miter;marker:none;marker-start:none;marker-mid:none;marker-end:none;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1;visibility:visible;display:inline;overflow:visible" d="M99.75 67.46875C71.718268 67.468752 73.46875 79.625 73.46875 79.625L73.5 92.21875 100.25 92.21875 100.25 96 62.875 96C62.875 96 44.9375 93.965724 44.9375 122.25 44.937498 150.53427 60.59375 149.53125 60.59375 149.53125L69.9375 149.53125 69.9375 136.40625C69.9375 136.40625 69.433848 120.75 85.34375 120.75 101.25365 120.75 111.875 120.75 111.875 120.75 111.875 120.75 126.78125 120.99096 126.78125 106.34375 126.78125 91.696544 126.78125 82.125 126.78125 82.125 126.78125 82.124998 129.04443 67.46875 99.75 67.46875zM85 75.9375C87.661429 75.937498 89.8125 78.088571 89.8125 80.75 89.812502 83.411429 87.661429 85.5625 85 85.5625 82.338571 85.562502 80.1875 83.411429 80.1875 80.75 80.187498 78.088571 82.338571 75.9375 85 75.9375z" id="path8615"/><path id="path8620" d="M100.5461 177.31485C128.57784 177.31485 126.82735 165.1586 126.82735 165.1586L126.7961 152.56485 100.0461 152.56485 100.0461 148.7836 137.4211 148.7836C137.4211 148.7836 155.3586 150.81787 155.3586 122.53359 155.35861 94.249323 139.70235 95.252343 139.70235 95.252343L130.3586 95.252343 130.3586 108.37734C130.3586 108.37734 130.86226 124.03359 114.95235 124.03359 99.042448 124.03359 88.421098 124.03359 88.421098 124.03359 88.421098 124.03359 73.514848 123.79263 73.514848 138.43985 73.514848 153.08705 73.514848 162.6586 73.514848 162.6586 73.514848 162.6586 71.251668 177.31485 100.5461 177.31485zM115.2961 168.8461C112.63467 168.8461 110.4836 166.69503 110.4836 164.0336 110.4836 161.37217 112.63467 159.2211 115.2961 159.2211 117.95753 159.2211 120.1086 161.37217 120.1086 164.0336 120.10861 166.69503 117.95753 168.8461 115.2961 168.8461z" style="fill:#E1E2E3;fill-opacity:1;fill-rule:nonzero;stroke:none;stroke-width:1;stroke-linecap:butt;stroke-linejoin:miter;marker:none;marker-start:none;marker-mid:none;marker-end:none;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1;visibility:visible;display:inline;overflow:visible"/></g></symbol><symbol id="visioVisual"><rect x="0" y="0" width="400" height="300" style="fill:#f4f4f4"/><g transform="translate(-99.772966,-149.88962)"><rect x="345.18201" y="266.92099" transform="matrix(-0.7071,0.7071,-0.7071,-0.7071,794.8842,218.5744)" width="13.983" height="13.983" id="rect4171" style="fill:#a6a8ab"/><path d="m220 227.412 0 145.176 90.435 17.412 0-180L220 227.412Zm50.302 108.264-15.251-.554-18.794-70.533 14.875.18 11.474 48.627c.146.602.275 1.183.391 1.746.129-.618.271-1.243.421-1.871l11.512-48.217 14.851.177-19.479 70.445z" style="fill:#a6a8ab"/><path d="m338.261 306.957 0 13.912 10.435 0 0-30.709-11.029-11.029-20.274 0 0 24.348 17.391 0c1.921 0 3.477 1.555 3.477 3.478" style="fill:#a6a8ab"/><path d="m376.521 230.87-59.13 0 0 41.304 16.797 0 16.756-16.752c.336-.343.781-.513 1.229-.513.445 0 .894.17 1.236.513l17.256 17.262c.679.676.679 1.783 0 2.459l-15.014 15.021 0 34.185c0 1.923-1.556 3.479-3.479 3.479l-13.913 0 0 10.435c0 1.923-1.556 3.479-3.479 3.479l-17.391 0 0 27.392 58.797 0c2.106 0 3.812-3.193 3.812-5.299l0-129.487c.002-2.11-1.37-3.478-3.477-3.478" style="fill:#a6a8ab"/><polygon points="317.392,334.782 331.305,334.782 331.305,327.826 331.305,320.869 331.305,310.435 317.392,310.435 " style="fill:#a6a8ab"/></g></symbol><symbol id="ribbon"><rect fill="#F4F4F4" width="400" height="73"/><rect y="75.667" fill="#F4F4F4" width="400" height="73"/><rect y="227" fill="#F4F4F4" width="400" height="73"/><rect y="151.333" fill="#F4F4F4" width="400" height="73"/><path opacity="0.6" fill="none" d="M64.642 247.169c0 0 1.199.312 3.219.09C65.837 246.993 64.642 247.169 64.642 247.169z"/><path opacity="0.6" fill="none" d="M123.897 240.718c2.53.326 4.058.006 4.058.006S126.486 240.223 123.897 240.718z"/><path opacity="0.6" fill="none" d="M233.476 235.959c0 0-1.221-.088-3.23.25C232.257 236.296 233.476 235.959 233.476 235.959z"/><path opacity="0.6" fill="none" d="M170.163 240.724c0 0 1.045.24 2.791.078C171.192 240.569 170.163 240.724 170.163 240.724z"/><path opacity="0.6" fill="#D0D2D3" d="M67.861 247.259c5.631-.62 17.651-5.409 27.929-32.763-14.13-24.423-31.148-22.512-31.148-22.512H22.433v55.185h42.209C64.642 247.169 65.837 246.993 67.861 247.259z"/><path opacity="0.6" fill="#D0D2D3" d="M172.954 240.801c-1.746.163-2.791-.078-2.791-.078h-42.209c0 0-1.528.32-4.058-.006-5.385 1.03-15.622 6.374-27.599 29.532-.28.541-.559 1.073-.837 1.595.28.533.559 1.072.837 1.628 14.44 28.857 31.656 26.303 31.656 26.303h42.209c0 0 19.623 3.06 30.908-31.153l0 0C190.339 245.761 178.283 241.505 172.954 240.801z"/><path opacity="0.6" fill="#BCBEBF" d="M335.358 213.967h42.209v85.808h-42.209l-59.674 0h-42.209c0 0-17.217 2.612-31.656-29.525-.249-.554-.498-1.095-.749-1.628 8.574-25.994 22.823-31.343 29.175-32.413 2.011.087 3.23-.25 3.23-.25h42.209c0 0 21.015.295 29.437-10.848C313.543 213.967 335.358 213.967 335.358 213.967z"/><path opacity="0.6" fill="#BCBEBF" d="M67.861 247.259c-2.02.222-3.219-.09-3.219-.09H22.433v52.605h42.209c0 0 13.485 4.616 30.819-27.93C85.031 252.002 73.372 247.984 67.861 247.259z"/><path opacity="0.6" fill="#BCBEBF" d="M123.897 240.718c2.589-.495 4.058.006 4.058.006h42.209c0 0 1.029-.155 2.791.078 5.789-.539 19.302-5.515 28.139-38.431v0c-12.263-23.359-30.929-23.363-30.929-23.363h-42.209c0 0-17.577-4.662-31.633 34.056-.177.486-.354.961-.532 1.433.476.823.949 1.674 1.418 2.558C107.198 235.888 118.143 239.976 123.897 240.718z"/><path opacity="0.6" fill="#B2B2B2" d="M123.897 240.718c-5.754-.741-16.699-4.83-26.689-23.663-.469-.884-.942-1.735-1.418-2.558-10.278 27.354-22.298 32.143-27.929 32.763 5.511.725 17.17 4.743 27.6 24.585.278-.522.557-1.054.837-1.595C108.275 247.091 118.512 241.747 123.897 240.718z"/><path opacity="0.6" fill="#B2B2B2" d="M230.246 236.209c-5.541-.24-17.102-3.706-25.78-26.346-1.048-2.734-2.181-5.222-3.374-7.493v0c-8.836 32.916-22.35 37.892-28.139 38.431 5.33.703 17.386 4.959 28.117 27.82C209.644 242.627 223.894 237.279 230.246 236.209z"/><path opacity="0.6" fill="#E1E2E3" d="M335.358 129.225h42.209V24.001h-42.209c0 0-22.303-.416-31.726 21.046s-27.948 18.54-27.948 18.54h-42.209c0 0-22.044 1.959-32.816 13.804-10.772 11.845-30.497 12.829-30.497 12.829h-42.209c0 0-18.557-.045-32.423 10.911-13.156 10.395-30.89 10.395-30.89 10.395H22.433v80.459h42.209c0 0 23.238-1.338 32.227-6.606 11.174-6.547 31.086-6.372 31.086-6.372h42.209c0 0 20.992-.409 29.512-7.828 12.867-11.204 33.8-8.966 33.8-8.966h42.209c0 0 20.543 1.101 30.534-16.879S335.358 129.225 335.358 129.225z"/><path opacity="0.6" fill="#D0D2D3" d="M275.685 162.213c0 0 20.543 1.101 30.534-16.879s29.14-16.109 29.14-16.109h42.209v84.742h-42.209c0 0-21.816 0-30.237 11.143-8.421 11.143-29.437 10.848-29.437 10.848h-42.209c0 0-1.221-.088-3.23.25-5.541-.24-17.102-3.706-25.78-26.346-1.048-2.734-2.181-5.222-3.374-7.493 11.502-42.844 32.384-40.157 32.384-40.157H275.685"/><rect x="22.433" y="111.525" fill="#DDDDDD" width="42.209" height="80.459"/><rect x="22.433" y="191.984" fill="#D0D2D3" width="42.209" height="55.185"/><rect x="22.433" y="247.169" fill="#BCBEBF" width="42.209" height="52.605"/><rect x="127.955" y="90.219" fill="#DDDDDD" width="42.209" height="88.788"/><rect x="127.955" y="179.007" fill="#BCBEBF" width="42.209" height="61.717"/><rect x="127.955" y="240.724" fill="#D0D2D3" width="42.209" height="59.051"/><rect x="233.476" y="63.586" fill="#DDDDDD" width="42.209" height="98.627"/><rect x="233.476" y="162.213" fill="#D0D2D3" width="42.209" height="73.746"/><rect x="233.476" y="235.959" fill="#BCBEBF" width="42.209" height="63.816"/><rect x="335.358" y="24.001" fill="#DDDDDD" width="42.209" height="105.224"/><rect x="335.358" y="129.225" fill="#D0D2D3" width="42.209" height="84.742"/><rect x="335.358" y="213.967" fill="#BCBEBF" width="42.209" height="85.808"/></symbol><symbol id="keyDrivers"><rect fill="#F4F4F4" width="400" height="300"/><g style="transform: scale(15)"><rect x="0" y="2" opacity="0.8" fill="#D0D2D3" width="20" height="1"/><rect x="0" y="6" opacity="0.8" fill="#D0D2D3" width="13" height="1"/><rect x="0" y="10" opacity="0.8" fill="#D0D2D3" width="9" height="1"/><circle fill="#898989" cx="21.5" cy="2.5" r="1.75"/><circle fill="#ACACAC" cx="14.5" cy="6.5" r="1.75"/><circle fill="#ACACAC" cx="10.5" cy="10.5" r="1.75"/><rect x="0" y="14" opacity="0.8" fill="#D0D2D3" width="4" height="1"/><circle fill="#ACACAC" cx="5.5" cy="14.5" r="1.75"/><rect fill="none" width="20" height="20"/><g style="transform: translate(5px, -1px)"><path opacity="0.8" fill="#BEBEBE" d="M18 19h-1v-1h-1v1c0 .136.026.265.078.387s.124.229.215.32.198.163.32.215S16.864 20 17 20h1c.141 0 .271-.026.391-.078s.226-.124.316-.215.163-.196.215-.316S19 19.141 19 19v-1h-1V19z"/><path fill="#CBCBCB" d="M15.711 17.234c.104.114.179.233.223.355S16 17.849 16 18h1 1 1c0-.297.099-.555.297-.773.224-.25.397-.515.52-.793S20 15.844 20 15.5s-.065-.668-.195-.973-.309-.57-.535-.797-.492-.405-.797-.535S17.844 13 17.5 13c-.349 0-.676.065-.98.195s-.569.308-.793.531-.401.488-.531.793S15 15.151 15 15.5c0 .344.062.655.184.934S15.481 16.979 15.711 17.234z"/><rect x="17" y="18" fill="#DBDBDB" width="1" height="1"/></g></g></symbol></svg>'),
e.put("views/taskPane.html",'<article class="taskPane sidePane rightSidePane smallFontSize" ng-class="{ isCollapsed: !viewModel.isPaneExpanded }" modeling-context-changer><div class="paneHeader"> <button class="toggleBtn" ng-class="{ isCollapsed: !viewModel.isPaneExpanded }" ng-click="toggleTaskPane()" localize-tooltip="Pane_Toggle"><div class="btnIcon glyphicon pbi-glyph-chevronrightmedium glyph-mini"></div><h2 class="sidePaneHorizontalTitle sidePaneTitle unselectable fieldsTab largeFontSize trimmedTextWithEllipsis" ng-if="viewModel.isPaneExpanded" localize="TaskPane_Fields"></h2><div class="verticalTitle"><h2 class="largeFontSize" localize="TaskPane_Fields"></h2></div></button></div><div class="paneContents" ng-if="viewModel.isPaneExpanded" pbi-lazy-load-contents="exploreUIShellConfig"><field-list field-list-config="::fieldListConfig"></field-list></div></article>'),e.put("views/virtualList.html",'<div class="virtual-list-container"><ng-scrollbars class="virtual-list" ng-scrollbars-config="::scrollbarsConfig"><ng-transclude></ng-transclude></ng-scrollbars></div>'),e.put("views/visualizationPane.html",'<article class="visualizationPane sidePane rightSidePane smallFontSize" keyboard-shortcuts="ctrl-F6" focus-nav-mode="Group" ng-class="{ isCollapsed: !viewModel.isPaneExpanded }" modeling-context-changer><div class="paneHeader"> <button class="toggleBtn" aria-label="{{viewModel.header}}" aria-expanded="{{!!viewModel.isPaneExpanded}}" ng-class="{ isCollapsed: !viewModel.isPaneExpanded }" ng-click="toggle()" localize-tooltip="Pane_Toggle"><div class="btnIcon glyphicon pbi-glyph-chevronrightmedium glyph-mini"></div><div class="sidePaneHorizontalTitle unselectable sidePaneTitle largeFontSize trimmedTextWithEllipsis" ng-bind="viewModel.header" ng-show="viewModel.isPaneExpanded"></div><div class="verticalTitle verticalText" ng-show="!viewModel.isPaneExpanded"><span class="collapsedVisualsTitle largeFontSize" ng-bind="viewModel.header" ng-show="populatePanes"></span><span class="collapsedFiltersTitle largeFontSize" localize="VisualizationPane_Filters" ng-if="showFieldWellOrFilters"></span></div></button></div><div class="paneContents flex" ng-if="viewModel.isPaneExpanded"><section ng-if="showVisualTypes" class="lazy-load-wrapper" pbi-lazy-load-contents="exploreUIShellConfig"><visual-types-container visual-plugin-filter="viewModel.visualPluginFilter"></visual-types-container></section><nav class="sectionHeader item-auto pivotNav visualizationPane" ng-if="viewModel.sections.length && !isNonQueryVisual && populatePanes"><ul role="tablist"><li role="tab" section-tab-key-handler section-length="viewModel.sections.length" current-section="section.sectionType" set-active-section-function="setActiveSection(nextSection)" aria-controls="section-{{section.sectionType}}" aria-label="{{::section.displayName}}" tabindex="{{section.sectionType === viewModel.activeSection ? 0 : -1}}" aria-posinset="{{$index+1}}" aria-setsize="{{viewModel.sections.length}}" aria-selected="{{section.sectionType === viewModel.activeSection}}" ng-repeat="section in viewModel.sections" accessible-click="setActiveSection(section.sectionType)" class="sectionTab" ng-class="{active: section.sectionType === viewModel.activeSection}" title="{{::section.displayName}}"><svg-use-symbol class="sectionIcon" sheet="visualizationPaneIcons" symbol-id="\'visualizationPane\'+section.cssClass.charAt(0).toUpperCase() + section.cssClass.slice(1)"></svg-use-symbol></li></ul><div class="navMarker visualizationPane"></div></nav><nav class="sectionHeader item-auto pivotNav visualizationPane" ng-if="viewModel.pagePaneSections.length && populatePanes"><ul role="tablist"><li role="tab" section-tab-key-handler section-length="viewModel.pagePaneSections.length" current-section="section.sectionType" set-active-section-function="setActivePagePaneSection(nextSection)" aria-controls="section-{{section.sectionType}}" aria-label="{{::section.displayName}}" tabindex="{{section.sectionType === viewModel.activePageSection ? 0 : -1}}" aria-posinset="{{$index+1}}" aria-setsize="{{viewModel.pagePaneSections.length}}" aria-selected="{{section.sectionType === viewModel.activePageSection}}" ng-keydown="onSectionKeyDown($event, section.sectionType, true)" ng-repeat="section in viewModel.pagePaneSections" ng-click="setActivePagePaneSection(section.sectionType)" class="sectionTab" ng-class="{active: section.sectionType === viewModel.activePageSection}" title="{{::section.displayName}}"><svg-use-symbol class="sectionIcon" sheet="visualizationPaneIcons" symbol-id="\'visualizationPane\'+section.cssClass.charAt(0).toUpperCase() + section.cssClass.slice(1)"></svg-use-symbol></li></ul><div class="navMarker visualizationPane"></div></nav><div class="sectionHost item-fill" id="section-0" role="tabpanel" ng-if="showFieldWellOrFilters" section-animation-slider view-model="viewModel" nav-marker-parent="visualizationPane" ng-class="{\'readOnly\' : !populatePanes}"><ng-scrollbars ng-scrollbars-config="::scrollbarsConfig"><section ng-if="showFieldWell" class="lazy-load-wrapper" pbi-lazy-load-contents="exploreUIShellConfig"><field-well></field-well></section><h3 class="sectionHeader" ng-if="showFieldWell || showVisualTypes"><span class="sectionTitle sidePaneTitle unselectable largeFontSize" localize="VisualizationPane_Filters"></span> <button ng-if="useNewFilterPane && viewModeState.getMode() === 1" class="enableFilterPane glyphicon glyph-mini" ng-class="{\'pbi-glyph-view\':isOutspacePaneVisible, \'pbi-glyph-hide2\':!isOutspacePaneVisible}" ng-click="toggleOutspacePaneVisibility()" localize-tooltip="{{isOutspacePaneVisible ? \'FilterPane_HidePane\' : \'FilterPane_ShowPane\'}}" dynamic-tooltip-update="true"></button></h3><filter-pane></filter-pane><section class="lazy-load-wrapper" pbi-lazy-load-contents="exploreUIShellConfig" ng-if="showDrillthroughPane"><drillthrough-pane></drillthrough-pane></section></ng-scrollbars></div><section ng-if="showPropertyPane" focus-nav-mode="Browser" id="section-1" role="tabpanel" section-animation-slider view-model="viewModel" nav-marker-parent="visualizationPane" class="lazy-load-wrapper stretch item-fill" pbi-lazy-load-contents="exploreUIShellConfig"><property-pane></property-pane></section><section ng-if="showPagePropertyPane" focus-nav-mode="Browser" id="section-1" role="tabpanel" section-animation-slider view-model="viewModel" nav-marker-parent="visualizationPane" class="lazy-load-wrapper stretch item-fill" pbi-lazy-load-contents="exploreUIShellConfig"><page-property-pane></page-property-pane></section><section ng-if="showAnalyticsPane" focus-nav-mode="Browser" id="section-2" role="tabpanel" section-animation-slider view-model="viewModel" nav-marker-parent="visualizationPane" class="lazy-load-wrapper stretch item-fill" pbi-lazy-load-contents="exploreUIShellConfig"><analytics-pane class="propertyPaneContents"></analytics-pane></section></div></article>')}]);var powerbi;!(function(e){var t;!(function(t){var i,r=e.visuals.valueFormatter,o=e.explore.components.TopNFilterType,n=jsCommon.StringExtensions;!(function(e){function t(e,t){if(null!=t.itemCount){var i=r.format(t.itemCount,"#,###"),a=t.orderByDisplayName,s=t.targetType.type===o.Top;return a?n.format(e.get(s?"FilterRestatement_TopNBy":"FilterRestatement_BottomNBy"),i,a):n.format(e.get(s?"FilterRestatement_TopN":"FilterRestatement_BottomN"),i)}}e.getRestatement=t})(i=t.TopNFilterHelper||(t.TopNFilterHelper={}))})(t=e.data||(e.data={}))})(powerbi||(powerbi={})),define("ExploreUI/services/clustering",["require","exports"],(function(e,t){function i(e,t,i,r,o,n,a,s,l,c,u,p,d){return{isClusteringColumn:function(e){return!1},createClusters:function(e,t,i){},editClustering:function(e,t){return null},arePartitionNameToClusterIdsMappingsEqual:function(e,t){return!1}}}Object.defineProperty(t,"__esModule",{value:!0}),t.create=i}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){function t(){return{getMetadata:function(e){return null}}}e.createClusteringStateService=t})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={})),powerbi.define("ExploreUI/services/drillToDetails",(function(e){var t=powerbi,i=t.common,r=(i.contracts,t.data),o=t.explore,n=o.constants,a=(o.contracts,o.services),s=a.events,l=o.util,c=jsCommon.ArrayExtensions,u=powerbi.explore.FilterUtils,p=powerbi.explore.services.selectionUtils,d=o.SectionUtils,h=r.SQExpr,v=jsCommon.Utility,g=l.VisualContainerUtils,f=(function(){function e(e,t,i,r,o){this.sourceSection=e,this.sourceVisualContainer=t,this.targetSection=i,this.targetVisualContainer=r,this.navigationState=o}return e.prototype.toSnapshot=function(e){var t=this;if(e.getCurrentSection()===this.targetSection){var i=e.getCurrentExploration(),r=d.findSectionIndexForSection(i,this.sourceSection),o=d.findSectionIndexForSection(i,this.targetSection);return{sourceSectionIndex:r,sourceVisualIndex:_.findIndex(this.sourceSection.visualContainers,(function(e){return e===t.sourceVisualContainer})),targetSectionIndex:o,targetVisualIndex:_.findIndex(this.targetSection.visualContainers,(function(e){return e===t.targetVisualContainer}))}}},e.fromSnapshot=function(t,i){if(t){var r=i.getCurrentExploration(),o=r.sections[t.sourceSectionIndex],n=o.visualContainers[t.sourceVisualIndex],a=r.sections[t.targetSectionIndex],s=a.visualContainers[t.targetVisualIndex];return new e(o,n,a,s,0)}},e})(),y=(function(){function e(e,t,i,r,o,n,a,l,c,u,p,d,h){var v=this;this.conceptualSchemaProxy=e,this.visualAuthoringOperations=t,this.undoRedo=i,this.selectionService=r,this.explorationNavigationService=o,this.explorationSerializer=n,this.visibility=a,this.rootScope=l,this.timeout=c,this.eventBridge=u,this.filterGenerator=p,this.localizationService=d,this.visualPluginService=h,this.eventBridge.createChannelSubscriptionManager().subscribe(s.canvasChanged,(function(){return v.onSectionChanged()})).subscribe(s.visibilityChanged,(function(){return v.onPopOutModeChanged()})).subscribe(s.explorationUnloaded,(function(e,t){return v.clearContext()}))}return e.prototype.drillToDetails=function(e,i,r){var o=this;if(!_.isEmpty(e)){var n=_.head(e);if(n&&!_.isEmpty(n.metadata)){var a=g.getVisualQuery(i);if(a&&a.defn){if(_.isEmpty(n.dataMap)){if(!a.projections)return;var s=g.getDataRolesForVisual(i,this.visualPluginService),l=_(s).filter((function(e){return e.kind!==t.VisualDataRoleKind.Measure})).map((function(e){return e.name})).value();for(var c in a.projections)if(!_.isEmpty(a.projections[c])&&_.includes(l,c))return}var u=a.defn.select().withName(_.head(n.metadata));u&&h.isAggregation(u.expr)&&this.conceptualSchemaProxy.get(r).then((function(t){var r=o.visualAuthoringOperations.drillToDetails(v.generateGuid(),t,[u.expr],e,i);r&&(o.addCrossFilters(i,o.explorationNavigationService.getCurrentSection(),r,!1,t),o.drillToDetailsCore(e,i,r))}),(function(){return _.noop}))}}}},e.prototype.generateDetailsTable=function(e,t,i,r){var o=this.mockVisualContainer(e),n=this.visualAuthoringOperations.drillToDetails(v.generateGuid(),t,i,null,o,r);if(n)return n.config.singleVisual},e.prototype.clear=function(){if(this.drillToDetailsContext){this.drillToDetailsContext.navigationState=1;var e=d.findSectionIndexForSection(this.explorationNavigationService.getCurrentExploration(),this.drillToDetailsContext.sourceSection);this.rootScope.$emit(n.switchSectionEvent,e)}},e.prototype.getContext=function(){return this.drillToDetailsContext},e.prototype.setContext=function(e){this.drillToDetailsContext=e},e.prototype.clearContext=function(){this.drillToDetailsContext=null},e.prototype.hasContext=function(){return!!this.drillToDetailsContext},e.prototype.getDetailsTableTargetMeasures=function(e){var i=this.mockVisualContainer(e),r=g.getVisualQuery(i);if(r&&r.defn){var o=g.getDataRolesForVisual(i,this.visualPluginService);if(!_.isEmpty(o)){for(var n=_(o).filter((function(e){return(e.kind===t.VisualDataRoleKind.Measure||e.kind===t.VisualDataRoleKind.GroupingOrMeasure)&&0!==e.joinPredicate})).map((function(e){return e.name})).value(),a=[],s=0,l=n;s<l.length;s++){var c=l[s],u=r.projections[c];if(!_.isEmpty(u))for(var p=u.all(),d=0,v=p;d<v.length;d++){var f=v[d],y=r.defn.select().withName(f.queryRef);if(y&&h.isAggregation(y.expr))return[y.expr];y&&h.isMeasure(y.expr)&&a.push(y.expr)}}return a}}},e.prototype.mockVisualContainer=function(e){var t={name:v.generateGuid(),config:{singleVisual:e},layouts:c.createWithId(),filters:[]};return t.layouts.push({id:0,position:{x:0,y:0,width:0,height:0}}),t},e.prototype.onSectionChanged=function(){var e=this;if(this.drillToDetailsContext){this.explorationNavigationService.getCurrentSection();switch(this.drillToDetailsContext.navigationState){case 0:this.timeout((function(){p.selectVisualContainer(e.drillToDetailsContext.targetVisualContainer,e.selectionService),e.visibility.set(e.drillToDetailsContext.targetVisualContainer,1)}),0);break;case 1:var t=this.explorationNavigationService.getCurrentExploration(),i=d.findSectionIndexForSection(t,this.drillToDetailsContext.targetSection),r=d.findSectionIndexForSection(t,this.drillToDetailsContext.sourceSection),o=this.drillToDetailsContext.sourceVisualContainer;this.drillToDetailsContext=null,this.rootScope.$emit(n.deleteSectionEvent,{targetSectionIndex:i}),this.timeout((function(){d.findSectionIndexForSection(e.explorationNavigationService.getCurrentExploration(),e.explorationNavigationService.getCurrentSection())===r&&p.selectVisualContainer(o,e.selectionService),e.undoRedo.clear()}),0)}}},e.prototype.onPopOutModeChanged=function(){if(this.drillToDetailsContext){var e=this.explorationNavigationService.getCurrentSection();if(e!==this.drillToDetailsContext.sourceSection){this.visibility.get()!==this.drillToDetailsContext.targetVisualContainer&&this.clear()}}},e.prototype.drillToDetailsCore=function(e,t,i){var r=this.explorationNavigationService.getCurrentSection();if(r){var o=this.explorationSerializer.serializePage(r,1),a=this.explorationSerializer.deserializePage(o),s={name:"Drill to Details",displayName:"Drill to Details",filters:a.filters,size:a.size,visualContainers:[i],transient:!0};this.drillToDetailsContext=new f(r,t,s,i,0),this.rootScope.$emit(n.insertSectionEvent,s)}},e.prototype.addCrossFilters=function(e,t,i,r,o){var n=this.filterGenerator.getVisualContainerCrossFilters(t,e,o);if(n.dataFilters)for(var a=0,s=n.dataFilters;a<s.length;a++){var l=s[a];this.addVisualFilters(i,l,o,!1)}if(r)for(var c=0,u=n.highlightFilters;c<u.length;c++){var l=u[c];this.addVisualFilters(i,l,o,!1)}},e.prototype.addVisualFilters=function(e,t,i,r){if(t&&t.filter){var o=u.convertFilterData(t,e.filters,0);u.add(e,o)}},e})();return{create:function(e,t,i,r,o,n,a,s,c,u,p,d,h,v,g,f,m,S,w,C,b,x,F,D,V){return new y(e,l.createVisualAuthoringOperations(i,r,v,g,c,s,o,t,h,a,f,m,S,w,C,b,x,D,F,V),n,s,c,t,u,p,d,h,C,F,i)},createContext:function(e,t,i,r,o){return new f(e,t,i,r,o)},snapshotToContext:f.fromSnapshot}}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){function r(e,t,i,r,o,a,s){return new n(e,t,i,r,o,a,s)}var o={updateUrl:!0,action:i.SectionNavigationAction.Unknown};i.createExplorationNavigationService=r;var n=(function(){function r(e,t,i,r,o,n,a){this.explorationProxy=e,this.eventBridge=t,this.scope=i,this.selection=r,this.formFactor=o,this.telemetryService=n,this.explorationActivity=a,this.history=[]}return r.prototype.updateActiveSection=function(i){var r=this,o=this.scope.viewModel,n=o.exploration.contract;if(i.forceUpdate||n.activeSectionIndex!==i.targetSectionIndex){var a=null==i.clearSelection||i.clearSelection;this.explorationActivity.changeSection((function(){if(!i.suppressHistory){var e=r.getCurrentSection();e&&!e.transient&&r.history.push({name:e.name})}if(n&&i.targetSectionIndex>-1&&i.targetSectionIndex<n.sections.length){r.selection&&a!==!1&&!_.isEmpty(r.selection.getSelectedElements())&&r.selection.clearSelection();var s=o.exploration.sections;if(!_.isEmpty(s))for(var l=s.length-1;l>=0;--l)s[l].selected=l===i.targetSectionIndex;o.sectionStatus.currentSectionNumber=i.targetSectionIndex;var c=n.sections[i.targetSectionIndex],u=null!==i.canvasLayout&&void 0!==i.canvasLayout?i.canvasLayout:r.formFactor.getCurrentLayout();o.exploration.exploreCanvas=t.viewModels.ViewModelFactory.convertSectionToExploreCanvas(n,c,u);(null==i.clearCrossFilter||i.clearCrossFilter)&&c.crossFilterSource&&(c.crossFilterSource.highlight=void 0),r.goto(c,{action:i.navigationAction})}}),(function(t){return r.telemetryService.startActivity(t,e.telemetry.EXUpdateActiveSection,i.targetSectionIndex,i.forceUpdate,i.suppressHistory,i.canvasLayout,a,!1)}))}},r.prototype.updateExplorationActiveSectionIndex=function(t){var i=t.exploration,r=e.explore.SectionUtils.findSectionIndexForSectionName(i,t.section);if(!(null!=r&&i&&i.sections&&i.sections[r].transient||(i.activeSectionIndex=r,t.suppressTelemetry))){var o=i.sections[r],n=o?o.objectId:void 0;this.telemetryService.logEvent(e.telemetry.ExploreHostChangeReportPage,i.reportId,t.reportGUID,r,n,t.groupObjectId,t.isReadonlyGroup,t.reportPermissions,t.scrubUserInfo)}},r.prototype.goto=function(e,t){if(t=t?_.merge({},o,t):o,this.currentSection=e,this.raiseEvent(),t.updateUrl){var r={name:e.name,displayName:e.displayName,action:t.action};this.eventBridge.publishToChannel(i.events.sectionChanged,r)}},r.prototype.back=function(){if(!_.isEmpty(this.history)){var e=this.history.pop(),t=_.findIndex(this.exploration.sections,(function(t){return t.name===e.name}));t<0||this.updateActiveSection({targetSectionIndex:t,forceUpdated:!0,suppressHistory:!0})}},r.prototype.loadExploration=function(e){this.exploration=e,e&&e.sections&&e.activeSectionIndex>=0&&(this.currentSection=e.sections[e.activeSectionIndex]),this.raiseExplorationLoadedEvent(e)},r.prototype.getCurrentSection=function(){if(this.currentSection)return this.currentSection;var e=this.exploration;return e&&_.inRange(e.activeSectionIndex,0,e.sections.length)?e.sections[e.activeSectionIndex]:void 0},r.prototype.getSectionByName=function(e){return _.find(this.exploration.sections,(function(t){return t.name===e}))},r.prototype.getAllSections=function(){return this.exploration.sections},r.prototype.getCurrentExploration=function(){return this.exploration},r.prototype.getCurrentExplorationAsync=function(){var e=this,t={id:this.exploration.reportId};return this.explorationProxy.get(t).then((function(t){return e.exploration.report=t.exploration.report,t}))},r.prototype.showExplorationMask=function(){this.scope.viewModel.showMask=!0},r.prototype.hideExplorationMask=function(){this.scope.viewModel.showMask=!1},r.prototype.raiseEvent=function(){this.eventBridge.publishToChannel(i.events.canvasChanged)},r.prototype.raiseExplorationLoadedEvent=function(e){this.eventBridge.publishToChannel(i.events.explorationLoaded,e)},r})()})(i=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={})),powerbi.define("ExploreUI/services/explorationStateApplier",(function(e){function t(e,t,i,r,n){return new o(e,t,i,r,n)}var i=powerbi.common.constants.dsrDataReaderType,r=powerbi.explore.util.VisualContainerUtils,o=(function(){function e(e,t,i,r,o){this.dataProxy=e,this.explorationStateManager=t,this.navigation=i,this.featureSwitchService=r,this.visualSyncService=o}return e.prototype.applyDirty=function(e,t,o){if(e){o.stopDataQueries&&this.dataProxy.stopCommunication(i);try{var n=this.explorationStateManager.apply(e,t,o);if(this.syncFilterState(n),o.clearQueryCaches){var a=this.navigation.getCurrentExploration();r.clearExplorationQueryCaches(a)}}finally{o.stopDataQueries&&this.dataProxy.resumeCommunication(i)}}},e.prototype.syncFilterState=function(e){if(this.featureSwitchService.featureSwitches.slicerSyncing&&e)for(var t=0,i=e.visualContainers;t<i.length;t++){var r=i[t];r.config.singleVisual.syncGroup&&this.visualSyncService.syncFilterState(r)}},e})();return{create:t}})),powerbi.define("ExploreUI/services/explorationStateManager",(function(e){function t(e,t,i,r,o,n,a){return new l(e,t,i,r,o,n,a)}var i=powerbi,r=i.explore,o=r.services,n=o.events,a=n.explorationFiltersContainerChanged,s=powerbi.explore.util.VisualContainerUtils,l=(function(){function e(e,t,i,r,o,n,a){this.state=e,this.navigation=t,this.eventBridge=i,this.visibility=r,this.filterGenerator=o,this.explorationActivity=n,this.telemetryService=a}return e.prototype.exploration=function(){return this.navigation.getCurrentExploration()},e.prototype.capture=function(e,t){var i=this.exploration();if(i)return this.state.capture(i,e,t)},e.prototype.apply=function(e,t,i){var r=this.exploration(),o=this.state.apply(e,r,t,i);return this.applyImpact(o,r,i),o},e.prototype.captureFilterState=function(e){return this.state.captureFilterState(e)},e.prototype.applyFilterState=function(e,t,i){if(!_.isEmpty(e)){var r=this.exploration(),o=this.state.applyFilterState(e,t);this.applyImpact(o,r,i)}},e.prototype.applyImpact=function(e,t,i){var o=this;this.explorationActivity.doActivity((function(){if(e.objects&&o.eventBridge.publishToChannel(n.explorationObjectsChanged),2===e.filterScope&&(o.eventBridge.publishToChannel(a,{container:t}),o.eventBridge.publishToChannel(n.visualContainerChanged,{affectContainer:_.noopTrue})),e.activeSection)o.navigation.updateActiveSection({targetSectionIndex:t.activeSectionIndex,forceUpdate:!0});else if(1===e.filterScope){var l=o.navigation.getCurrentSection();o.eventBridge.publishToChannel(r.services.events.sectionFiltersContainerChanged,{container:l}),o.eventBridge.publishToChannel(n.visualContainerChanged,{affectContainer:function(e){return _.includes(l.visualContainers,e)}})}else 0!==e.filterScope&&_.isEmpty(e.visualContainers)||s.notifyVisualContainers(o.eventBridge,e.visualContainers);if(!i.suppressDisplay)if(e.visibility)o.visibility.set(e.visibility.visual,e.visibility.mode);else if(i.targetVisualNames){var c=t.sections[t.activeSectionIndex],u=_.filter(c.visualContainers,(function(e){return _.includes(i.targetVisualNames,e.name)}));o.visibility.clearForVisualContainers(u)}else o.visibility.clear();if(!i.suppressData){var p=e.pendingHighlights,d=o.navigation.getCurrentSection();if(p){o.filterGenerator.setMultipleFiltersOnSelectData(t,d,p);for(var h=0,v=p;h<v.length;h++){var g=v[h],f=g.sourceVisualContainer,y=f.config.singleVisual;y.setSelectedDataPoints?y.setSelectedDataPoints(g.selection):y.pendingSelection=g.selection}}else if(i.targetVisualNames){var c=t.sections[t.activeSectionIndex],u=_.filter(c.visualContainers,(function(e){return _.includes(i.targetVisualNames,e.name)}));o.filterGenerator.clearCrossHighlightForVisualContainers(c,u)}else o.filterGenerator.clearCrossHighlight(d)}}),(function(e){return o.telemetryService.startActivity(e,powerbi.telemetry.EXExplorationStateApplyImpact)}))},e})();return{create:t}}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){function i(e,t,i,r){return new s(e,t,i,r)}function r(e,t){return new l(e,t)}var o=jsCommon.FocusManager,n=jsCommon.FocusGroupNavigation,a=e.explore.dialogs.HotkeyDialogBuilder;t.createFocusService=i;var s=(function(){function e(e,t,i,r){void 0===r&&(r=!1),this.$element=e,this.modalDialogService=t,this.focusManager=o.initialize(document.documentElement,!1,r,i)}return e.prototype.setOnFocusGroupChangedHandler=function(e){this.focusManager.setOnFocusGroupChangedHandler(e)},e.prototype.startListening=function(){this.$element.on("keypress",$.proxy(this.onkeydown,this))},e.prototype.stopListening=function(){this.$element.off("keypress",this.onkeydown)},e.prototype.focusOnGroup=function(e,t,i,r,o){this.focusManager.focusOnGroupByIndex(e,t,i,r,o)},e.prototype.onkeydown=function(e){if("?"===String.fromCharCode(e.charCode)){var t=document.activeElement;if(n.canHandleKeyEvents(e.target))return;new a(this.modalDialogService).show().finally((function(){t&&t.nodeType===Node.ELEMENT_NODE&&t.focus()}))}},e})();t.createFocusServiceNotificator=r;var l=(function(){function t(t,i){t.setOnFocusGroupChangedHandler((function(t,r,o,n,a){return i.publishToChannel(e.explore.services.events.focusGroupChanged,{keycode:t,shift:r,alt:o,ctrl:n,groupIndex:a})}))}return t})()})(i=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={})),powerbi.define("ExploreUI/services/quickCalc",(function(e){var t=powerbi,i=t.data,r=t.explore,o=(r.contracts,r.util),n=t.telemetry,a=t.RejectablePromise,s=i.services.SemanticQuerySerializer,l=i.SQExpr,c=i.SQExprUtils,u=o.VisualContainerUtils,p=(function(){function e(e,t,i,r,o,n,a,s,l,c,u,p){this.aggrOps=e,this.conceptualSchemaProxy=t,this.dataSources=i,this.explorationSerializer=r,this.modalDialogService=o,this.modelAuthoring=n,this.modelChangeHandler=a,this.promiseFactory=s,this.daxTemplateService=l,this.visualAuthoringService=c,this.telemetryService=u,this.lazyScoped=p}return e.prototype.createQuickCalc=function(e,t){var r=this,o=this.promiseFactory.defer();return this.lazyScoped("daxCapabilities").then((function(e){return e.getCapabilities()})).then((function(a){var s=r.dataSources.get();r.conceptualSchemaProxy.get(s).then((function(p){var d,h;if(t)d=_.sortBy(u.getSelectExprs(t.visualContainer),(function(t){return l.equals(e,t.expr)?0:1}));else if(l.isEntity(e))d=[],h=e;else{var v=e,g=v.getMetadata(p);g&&g.type.numeric&&!i.SQExprUtils.discourageAggregation(e,p)&&(v=r.aggrOps.createExprWithAggregate(e,p,!0,[{numeric:!0}])),d=[{expr:v,name:void 0}]}var f=r.telemetryService.logEvent(n.EXQuickMeasuresOpenDialog,t?"FieldWell":"FieldList",d.length),y=r.telemetryService.startChildEvent(f,n.EXQuickMeasuresDialogResult,void 0,void 0),m=r.getFirstEditableSchemaName(p),S=r.showQuickCalcDialog(d,h,m,f);o.promise.catch((function(){return S.reject()})),S.then((function(e){if(y.event.info.connectionType=r.getConnectionType(p,m),!e)return y.event.info.selectedQuickMeasure="Cancel",y.resolve(),r.promiseFactory.reject();var t=r.daxTemplateService.getTemplates(p,a,m,1),i=_.find(t,(function(t){return t.capabilities.name===e.template.name}));return i?(y.event.info.selectedQuickMeasure=i.capabilities.name,y.resolve(),r.createNewMeasure(e,i,p,a)):(y.event.info.selectedQuickMeasure="Cancel",y.resolve(),r.promiseFactory.reject())})).then((function(o){if(t){var n=i.SQExprBuilder.measureRef(i.SQExprBuilder.entity(o.schema,o.entity),o.name);return r.visualAuthoringService.addFieldToVisual(n,s,t.visualContainer).catch((function(){return c.isMeasure(e)?r.visualAuthoringService.replaceProjection(n,t.role,t.index,t.visualContainer,s):r.promiseFactory.resolve()}))}return r.promiseFactory.resolve()})).then((function(){return o.resolve(null)})).catch((function(){return o.reject()}))}))})),a(o)},e.prototype.showQuickCalcDialog=function(e,t,i,r){var o=this.dataSources.get(),n=powerbi.explore.services.createDataSourceSerializer(this.explorationSerializer),a={selects:_.map(e,(function(e){return s.serializeExpr(e.expr)})),dataSources:n.serializeDataSources(o),schemaName:i,openDialogEvent:r,targetEntity:t&&s.serializeExpr(t)},l={dialogName:"DaxTemplateDialog",definitionTemplateCachePath:"components/daxTemplateDialog/daxTemplateDialogDefinition.html",bindings:{args:a},dialogCssClass:"daxTemplateDialog"};return this.modalDialogService.showHostModalDialog(l)},e.prototype.createNewMeasure=function(e,t,i,r){var o=this,n=this.promiseFactory.defer(),a=_.mapValues(e.parameters,(function(e){return{expression:s.deserializeExpr(e.expression)}})),l=t.apply(i,r,{schemaName:e.newMeasureMetadata.schema,inputValues:a}),c={newQuickCalc:{schema:e.newMeasureMetadata.schema,entity:e.newMeasureMetadata.entity,name:e.newMeasureMetadata.measureName,expression:l.dax,daxTemplateName:t.capabilities.name}};return this.applyAndHandleSchemaChange(c,(function(t){var r=t.changes,a=_.find(r,(function(e){return e.newMeasureCreated}));if(a){var s=o.promiseFactory.defer();return o.applyFormatting(a.newMeasureCreated,e,i).then((function(e){n.resolve(e),s.resolve(null)})),s.promise}})),n.promise},e.prototype.applyFormatting=function(e,t,i){var r=this,o=this.promiseFactory.defer(),n=this.getFormattingSchemaChange(t.newMeasureMetadata,e.name,i);return n?this.applyAndHandleSchemaChange(n,(function(t){var i=t.changes;if(_.find(i,(function(e){return e.setFormatting||e.copyFormatting})))return o.resolve(e),r.promiseFactory.resolve()})):o.resolve(e),o.promise},e.prototype.getFormattingSchemaChange=function(e,t,i){if(null!=e.formatType){var r=this.convertFormatToFormatKind(e.formatType);if(r)return{setFormatting:{schema:e.schema,entity:e.entity,property:t,format:r}}}else if(e.formatSource){var o=this.getActualFormattingSource(e.formatSource,i);if(o)return{copyFormatting:{sourceSchema:o.schema,sourceEntity:o.entity,sourceProperty:o.property,schema:e.schema,targetEntity:e.entity,targetProperty:t}}}},e.prototype.getActualFormattingSource=function(e,t){var i=s.deserializeExpr(e);if(l.isMeasure(i)){var r=i.source.getTargetEntity();return r&&{schema:r.schema,entity:r.entity,property:i.ref}}if(l.isAggregation(i)){var o=i.arg.getTargetColumnRef(t);if(!o)return;var n=i.getMetadata(t),a=o.getMetadata(t),r=o.source.getTargetEntity();return n&&a&&r&&n.type.isCompatibleFrom(a.type)&&{schema:r.schema,entity:r.entity,property:o.ref}}},e.prototype.convertFormatToFormatKind=function(e){if(0===e)return"Percentage"},e.prototype.applyAndHandleSchemaChange=function(e,t){var i=this.modelChangeHandler.register(t);this.modelAuthoring.apply({changes:[e]}).finally((function(){return i.stopHandling()}))},e.prototype.getFirstEditableSchemaName=function(e){for(var t=0,i=e.schemas;t<i.length;t++){var r=i[t];if(r.capabilities.canEdit)return r.name}},e.prototype.getConnectionType=function(e,t){return e.schema(t).isExtensionSchema?"LiveConnect":"InternalModel"},e})();return{create:function(e,t,i,r,o,n,a,s,l,c,u,d){return new p(e,t,i,r,o,n,a,s,l,c,u,d)}}})),define("ExploreUI/services/userEmulationService",["require","exports"],(function(e,t){function i(e){return new o(e)}Object.defineProperty(t,"__esModule",{value:!0});var r=powerbi.explore.services.events;t.create=i;var o=(function(){function e(e){this.eventBridge=e,this.isEmulationOn=!1}return e.prototype.setState=function(e){this.isEmulationOn=e,this.eventBridge.publishToChannel(r.emulationChanged)},e.prototype.getState=function(){return this.isEmulationOn},e})()})),powerbi.define("ExploreUI/services/visualSyncService",(function(e){function t(e,t,i,r,o,n){return new h(e,t,i,r,o,n)}var i=powerbi,r=i.data,o=i.explore,n=o.contracts,a=r.DataViewObjectDefinitions,s=r.DataViewObjectDescriptors,l=o.services.ExplorationState,c=r.SemanticFilter,u=r.SQExpr,p=r.SQExprRewriter,d=(n.VisualContainer,powerbi.explore.util.VisualContainerUtils),h=(function(){function e(e,t,i,r,o,n){this.explorationStateManager=e,this.explorationNavigation=t,this.featureSwitchService=i,this.visualPlugin=r,this.conceptualSchemaProxy=o,this.dataSources=n}return e.prototype.getVisualSyncField=function(e){var t=e.query.defn.select();return 1!==t.length?null:t[0].expr},e.prototype.generateUniqueGroupName=function(e,t){for(var i=e,r=1;i in t;)i=e+r++;return i},e.prototype.syncFilterState=function(e){return __awaiter(this,void 0,powerbi.Promise,(function(){var t,i,r,o,n,c,u,p,h,v,g,f,y,m,S,w,C,b;return __generator(this,(function(x){switch(x.label){case 0:return t=e.config.singleVisual,this.canSyncVisual(t)&&t.syncGroup?(i=this.getOtherSectionsInSyncGroup(t),_.isEmpty(i)?[2]:[4,this.conceptualSchemaProxy.get(this.dataSources.get())]):[2];case 1:for(r=x.sent(),o=this.explorationStateManager.captureFilterState(t),n=this.visualPlugin.capabilities(t.visualType),c={clearUnmatchedData:!1,suppressActiveSection:!0,suppressDisplay:!0},u=s.findFilterOutput(n.objects),p=a.getValue(o.objects.merge,u,null),h=[],v=0,g=i;v<g.length;v++)for(f=g[v],d.clearSectionQueryCaches(f.section),y=0,m=f.visualContainers;y<m.length;y++){if(S=m[y],w=o,p){if(C=a.getValue(S.config.singleVisual.objects,u,null),b=this.replaceSemanticFilterField(e.config.singleVisual.query.defn,p,S.config.singleVisual.query.defn,C,r),p&&!b)continue;b!==p&&(w=l.cloneSingleVisual(w),w.cachedFilterDisplayItems=void 0,a.setValue(w.objects.merge,u,null,b))}h.push({visual:S,state:w})}return this.explorationStateManager.applyFilterState(h,r,c),[2]}}))}))},e.prototype.getVisualsAffectByFieldChanges=function(e){
var t=e.config.singleVisual;return this.canSyncVisual(t)&&t.syncGroup.fieldChanges?_.filter(this.getOtherVisualsInSyncGroup(t),(function(e){return e.config.singleVisual.syncGroup.fieldChanges})):[]},e.prototype.canSyncVisual=function(e){if(!this.featureSwitchService.featureSwitches.slicerSyncing||!e.syncGroup)return!1;var t=this.visualPlugin.capabilities(e.visualType).supportsSynchronizingFilterState;return t},e.prototype.getOtherVisualsInSyncGroup=function(e){return this.getVisualsInSectionsSyncGroup(this.getOtherSectionsInSyncGroup(e))},e.prototype.getVisualsInSectionsSyncGroup=function(e){for(var t=[],i=0,r=e;i<r.length;i++){var o=r[i];t.push.apply(t,o.visualContainers)}return t},e.prototype.getOtherSectionsInSyncGroup=function(e){if(!e.syncGroup)return[];if(!e.syncGroup.groupName)return[];for(var t=this.explorationNavigation.getCurrentExploration(),i=[],r=0,o=t.sections;r<o.length;r++){var n=o[r],a=_.filter(n.visualContainers,(function(t){var i=t.config.singleVisual;return i!==e&&i.syncGroup&&i.syncGroup.groupName===e.syncGroup.groupName&&i.visualType===e.visualType}));_.isEmpty(a)||i.push({section:n,visualContainers:a})}return i},e.prototype.replaceSemanticFilterField=function(e,t,i,r,o){if(!t)return t;var n=e.select();if(1===n.length){var a=i.select();if(1===a.length){if(u.equals(n[0].expr,a[0].expr))return t;var s=v.extract(t);if(s){if(!r){var l=t.conditions();if(1!==l.length)return;var p=a[0].expr.getKeyColumns(o);if(1!==p.length)return;var d=g.replaceCondition(l[0],s,p[0]);return c.fromSQExpr(d)}var h=v.extract(r);if(h)return g.replace(t,s,h)}}}},e})(),v=(function(e){function t(){return e.call(this)||this}return __extends(t,e),t.extract=function(e){var i=new t;return e.rewrite(i),i.foundSingleField&&i.fieldExpr},t.prototype.visitHierarchyLevel=function(e){return this.setFieldExpr(e),e},t.prototype.visitColumnRef=function(e){return this.setFieldExpr(e),e},t.prototype.setFieldExpr=function(e){return this.fieldExpr?void(u.equals(this.fieldExpr,e)||(this.foundSingleField=!1)):(this.fieldExpr=e,void(this.foundSingleField=!0))},t})(p),g=(function(e){function t(t,i){var r=e.call(this)||this;return r.before=t,r.after=i,r}return __extends(t,e),t.replace=function(e,i,r){if(u.equals(i,r))return e;var o=new t(i,r);return e.rewrite(o)},t.replaceCondition=function(e,i,r){if(u.equals(i,r))return e;var o=new t(i,r);return e.accept(o)},t.prototype.visitColumnRef=function(e){if(u.equals(e,this.before))return this.after},t})(r.SQExprRewriter);return{create:t}}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(t){var i;!(function(t){function i(e,t,o,n){if(void 0===n&&(n=!0),!_.isEmpty(t)&&!_.isEmpty(e)&&o)for(var a=0;a<t.length;a++){var s=t[a];if(r.isStateBookmark(s)){if(s.name===e)return o(t,s,a)}else{if(s.name===e&&n)return o(t,s,a);var l=i(e,s.children,o,n);if(l)return l}}}var r=e.contracts.Bookmark;t.executeByName=i})(i=t.bookmark||(t.bookmark={}))})(t=e.util||(e.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r,o=e.explore.services.events,n=e.explore.util.ScriptVisualsUtil,a=t.services.selectionUtils;!(function(r){function s(r,o,n,a,s){return __awaiter(this,void 0,e.Promise,(function(){var e,l,p;return __generator(this,(function(d){switch(d.label){case 0:return 2===r.scope.scopeType&&i.VisualContainerUtils.clearExplorationQueryCaches(n),1===r.changeType||2===r.changeType&&!g(r.filter,o)?[4,c(a.dataSources,a.conceptualSchemaProxy)]:[3,2];case 1:return e=d.sent(),l=i.VisualContainerUtils.getVisualCapabilities(s,a.visualPlugin),p=t.viewModels.FilterViewModelFactory.convertFilterContainer(r.filter,e,a.displayNameService,r.scope,a.visualPlugin,a.aggrOps,a.localizationService,l,s&&s.config.singleVisual),0===r.scope.scopeType&&r.scope.container!==s||(o.push(p),u(o,e,a.dataSources,a.visualAuthoring)),[3,3];case 2:0===r.changeType&&_.remove(o,(function(e){return e.contract===r.filter})),d.label=3;case 3:return h(a,r),[2]}}))}))}function l(i,r){return __awaiter(this,void 0,e.Promise,(function(){var e,o,n,a;return __generator(this,(function(s){switch(s.label){case 0:return e=i.explorationNavigation.getCurrentSection(),o=i.explorationCapabilities.getCapabilities(),n=[],!e||o.shouldShowPageFilters&&!o.shouldShowPageFilters(e)?[2,n]:[4,c(i.dataSources,i.conceptualSchemaProxy)];case 1:return a=s.sent(),n=t.viewModels.ViewModelFactory.createFilters({scopeType:1,container:e},a,i.displayNameService,i.visualPlugin,i.aggrOps,i.localizationService,null,r),u(n,a,i.dataSources,i.visualAuthoring),[2,n]}}))}))}function c(t,i){return __awaiter(this,void 0,e.Promise,(function(){var e;return __generator(this,(function(r){switch(r.label){case 0:return e=t.get(),e?[4,i.get(e)]:[2];case 1:return[2,r.sent()]}}))}))}function u(e,t,i,r){if(!_.isEmpty(e)){var o=i.get();r.addConfigToCategoricalFilters(e,t,o)}}function p(e,t,i,r,o,n){var a=o.getDragContext();if(a&&a.field){var s={scopeType:e,container:t},l=r.get();i?n.addDrillthroughFilter(a.field,s,l):n.addFilter(a.field,s,l)}}function d(e,i,r,n){if(!_.isEmpty(r)&&(10===n.changeType||1===n.changeType||2===n.changeType||0===n.changeType))for(var a=v(n.scope.scopeType,5===n.filter.howCreated),s=0,l=r;s<l.length;s++){var c=l[s],u=v(i,5===c.howCreated);if(!(a<u)&&t.FilterUtils.isCategoricalFilter(c.contract.type)&&c.contract!==n.filter){var p={filter:c.contract,changeType:4,scope:c.getFilterContainerScope()};e.eventBridge.publishToChannel(o.filterContainerChanged,p)}}}function h(t,i){var r=t.explorationNavigation,o=r.getCurrentExploration(),s=r.getCurrentSection(),l=i.scope.scopeType,c=a.getSelectedVisual(t.selection),u=n.getScriptVisualIds(l,o,s,c,t.scriptVisuals);if(!_.isEmpty(u)){var p=i.changeType.toString();t.telemetryService.logEvent(e.telemetry.EXFilterScriptVisual,p,JSON.stringify(u))}}function v(e,t){return 0===e?0:1!==e||t?1===e?2:2===e?3:-1:1}function g(e,t){for(var i=0,r=t;i<r.length;i++){if(r[i].contract===e)return!0}return!1}r.onFilterContainerChanged=s,r.getPageScopeFilters=l,r.getConceptualSchema=c,r.addConfigToFilters=u,r.addFilterToScopeFromDrop=p,r.updateCategoricalFiltersIfNeeded=d})(r=i.FilterPaneUtil||(i.FilterPaneUtil={}))})(i=t.util||(t.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));
'use strict';
"use strict";
this.parseTimeMarkers = this.parseTimeMarkers || {};
var marker = this.parseTimeMarkers['reportembed.bundle.min.js'] || {};
marker.startEval = Date.now();
var __assign=this&&this.__assign||Object.assign||function(e){for(var t,r=1,o=arguments.length;r<o;r++){t=arguments[r];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},__extends=this&&this.__extends||(function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function o(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}})(),__awaiter=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))(function(i,a){function n(e){try{c(o.next(e))}catch(e){a(e)}}function s(e){try{c(o.throw(e))}catch(e){a(e)}}function c(e){e.done?i(e.value):new r(function(t){t(e.value)}).then(n,s)}c((o=o.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){function r(e){return function(t){return o([e,t])}}function o(r){if(i)throw new TypeError("Generator is already executing.");for(;c;)try{if(i=1,a&&(n=2&r[0]?a.return:r[0]?a.throw||((n=a.return)&&n.call(a),0):a.next)&&!(n=n.call(a,r[1])).done)return n;switch(a=0,n&&(r=[2&r[0],n.value]),r[0]){case 0:case 1:n=r;break;case 4:return c.label++,{value:r[1],done:!1};case 5:c.label++,a=r[1],r=[0];continue;case 7:r=c.ops.pop(),c.trys.pop();continue;default:if(n=c.trys,!(n=n.length>0&&n[n.length-1])&&(6===r[0]||2===r[0])){c=0;continue}if(3===r[0]&&(!n||r[1]>n[0]&&r[1]<n[3])){c.label=r[1];break}if(6===r[0]&&c.label<n[1]){c.label=n[1],n=r;break}if(n&&c.label<n[2]){c.label=n[2],c.ops.push(r);break}n[2]&&c.ops.pop(),c.trys.pop();continue}r=t.call(e,c)}catch(e){r=[6,e],a=0}finally{i=n=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}var i,a,n,s,c={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return s={next:r(0),throw:r(1),return:r(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s},powerbi;!(function(e){var t;!(function(t){var r;!(function(t){t.contentPackDirtyShowNotification="contentPackDirty",t.reportDeletedEventName="reportDeleted",t.onDatasetAddedEventName="onDatasetAdded",t.deleteModelFailedEventName="deleteModelFailed",t.deleteModelStartedEventName="deleteModelStarted",t.onDashboardShallowEditEventName="onDashboardShallowEdit",t.mergeDashboardContainerModelsReportsAndPackagesEventName="mergeDashboardContainerModelsReportsAndPackages",t.updateDashboardContainerEventName="updateDashboardContainer",t.addOrUpdateDashboardEventName="addOrUpdateDashboard",t.samplesContentProviderId=-1,t.initialDashboardContainerLoadingState="#loading#",t.initialDashboardContainerErrorState="#error#",t.initialDashboardContainerReadyEventName="initialDashboardContainerReady",t.CannotDeleteModelPublishedToOrganizationalAppHeader="CannotDeleteModelPublishedToOrganizationalApp",t.shouldShowEnableCustomVisualsDialog="shouldShowEnableCustomVisualsDialog",t.seenDashboardsStorageKey="seenSharedDashboards",t.ScopedInstanceProviderName="dataServices",t.dashboardElementName=".dashboard";var r;!(function(e){e.reloadExcelWorkbookEventName="reloadExcelWorkbook",e.pinClickedEventName="pinClicked",e.editInExcelOnlineClickedEventName="editInExcelOnlineClicked",e.editInExcelClickedEventName="editInExcelClicked",e.calculateWorkbookClickedEventName="calculateWorkbookClicked",e.bindToExcelWorkbookEventName="bindToExcelWorkbook",e.openWorkbookContextMenuEventName="openWorkbookContextMenu",e.viewWorkbookEventName="viewWorkbook",e.renameWorkbookEventName="renameWorkbook",e.editWorkbookEventName="editWorkbook",e.scheduleRefreshWorkbookEventName="scheduleRefreshWorkbook",e.refreshNowWorkbookEventName="refreshNowWorkbook",e.removeWorkbookEventName="removeWorkbook",e.excelWebAppScriptsLoaded="excelWebAppScriptsLoaded",e.defaultKeepOriginalContentSize=!1,e.workbookAddedEventName="workbookAdded"})(r=t.workbook||(t.workbook={})),t.SingleValueRealTimeWindow=250,t.MultipleValueRealTimeWindow=6e4,t.RealTimeIntervals=[1,5,10,15,20,25,30,45,60],t.RealTimeDataSourceName="_RealTimeSchema_",t.modelPlaceholderImageUrl="/"+e.build+"/images/modelPlaceholder.png",t.packagePublishedSuccessfullyEventName="packagePublishedSuccessfully",t.packageVersionChange="packageVersionChange";var o;!(function(e){e.TileConfigVersion="1.2",e.NoVisualType="No visual type"})(o=t.upgrader||(t.upgrader={}))})(r=t.constants||(t.constants={}))})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){function r(r,o,i,a,n,s,c,l,d,p,u,h,f){var v=t.CustomerAction(o,i,a,n,s,c,l,d,p,u,h,f),m=W(v.info,{reportType:r});return{name:"PBI.Dashboard.RenameReport",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:U(),formatted:function(){return e.extendFormatted({reportType:m.reportType},null,v.formatted())},info:m,loggers:t.DashboardRenameReportLoggers}}function o(r,o,i,a,n,s,c,l,d,p,u,h,f,v,m){var g=t.CustomerAction(a,n,s,c,l,d,p,u,h,f,v,m),y=W(g.info,{reportType:r,reportId:o,reportObjectId:i});return{name:"PBI.Dashboard.DeleteReport",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:U(),formatted:function(){return e.extendFormatted({reportType:y.reportType,reportId:y.reportId,reportObjectId:y.reportObjectId},null,g.formatted())},info:y,loggers:t.DashboardDeleteReportLoggers}}function i(r,o,i,a,n,s,c,l,d,p,u,h){var f=t.Verbose(r,o,i,a,n,s,c,l,d,p,u,h),v=W(f.info,{});return{name:"PBI.Dashboard.InitializeNavigationPaneReports",category:e.TelemetryCategory.Verbose,time:Date.now(),id:U(),formatted:function(){return e.extendFormatted(null,null,f.formatted())},info:v,loggers:t.DashboardInitializeNavigationPaneReportsLoggers}}function a(r,o,i,a,n,s,c,l,d,p,u,h){var f=t.Verbose(r,o,i,a,n,s,c,l,d,p,u,h),v=W(f.info,{});return{name:"PBI.Dashboard.InitializeNavigationPaneModels",category:e.TelemetryCategory.Verbose,time:Date.now(),id:U(),formatted:function(){return e.extendFormatted(null,null,f.formatted())},info:v,loggers:t.DashboardInitializeNavigationPaneModelsLoggers}}function n(r,o,i,a,n,s,c,l,d,p,u,h){var f=t.CustomerAction(r,o,i,a,n,s,c,l,d,p,u,h),v=W(f.info,{});return{name:"PBI.Dashboard.RenameDataset",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:U(),formatted:function(){return e.extendFormatted(null,null,f.formatted())},info:v,loggers:t.DashboardRenameDatasetLoggers}}function s(r,o,i,a,n,s,c,l,d,p,u,h,f,v){var m=t.CustomerAction(i,a,n,s,c,l,d,p,u,h,f,v),g=W(m.info,{cortanaValue:r,qnaValue:o});return{name:"PBI.Dashboard.UpdateModelQnaFeatures",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:U(),formatted:function(){return e.extendFormatted({cortanaValue:g.cortanaValue,qnaValue:g.qnaValue},null,m.formatted())},info:g,loggers:t.DashboardUpdateModelQnaFeaturesLoggers}}function c(r,o,i,a,n,s,c,l,d,p,u,h,f){var v=t.CustomerAction(o,i,a,n,s,c,l,d,p,u,h,f),m=W(v.info,{count:r});return{name:"PBI.Dashboard.UpdateFeaturedQuestions",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:U(),formatted:function(){return e.extendFormatted({count:m.count},null,v.formatted())},info:m,loggers:t.DashboardUpdateFeaturedQuestionsLoggers}}function l(r,o,i,a,n,s,c,l,d,p,u,h){var f=t.CustomerAction(r,o,i,a,n,s,c,l,d,p,u,h),v=W(f.info,{});return{name:"PBI.Dashboard.DeleteDataset",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:U(),formatted:function(){return e.extendFormatted(null,null,f.formatted())},info:v,loggers:t.DashboardDeleteDatasetLoggers}}function d(r,o){var i={tileType:r,message:o};return{name:"PBI.Dashboard.TileError",category:e.TelemetryCategory.CriticalError,time:Date.now(),id:U(),formatted:function(){return e.extendFormatted({tileType:i.tileType,message:i.message},null)},info:i,loggers:t.DashboardTileErrorLoggers}}function p(r,o,i,a,n,s,c,l,d,p,u,h){var f=t.CustomerAction(r,o,i,a,n,s,c,l,d,p,u,h),v=W(f.info,{});return{name:"PBI.Dashboard.AddUpdateDashboard",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:U(),formatted:function(){return e.extendFormatted(null,null,f.formatted())},info:v,loggers:t.DashboardAddUpdateDashboardLoggers}}function u(r,o,i,a,n,s,c,l,d,p,u,h,f,v,m){var g=t.Verbose(a,n,s,c,l,d,p,u,h,f,v,m),y=W(g.info,{numNewUnseenSharedDashboards:r,numSharedDashboards:o,numAllDashboards:i});return{name:"PBI.Dashboard.SharingNewUnseenDashboards",category:e.TelemetryCategory.Verbose,time:Date.now(),id:U(),formatted:function(){return e.extendFormatted({numNewUnseenSharedDashboards:y.numNewUnseenSharedDashboards,numSharedDashboards:y.numSharedDashboards,numAllDashboards:y.numAllDashboards},null,g.formatted())},info:y,loggers:t.DashboardSharingNewUnseenDashboardsLoggers}}function h(r,o,i,a,n,s,c,l,d,p,u,h){var f=t.Verbose(r,o,i,a,n,s,c,l,d,p,u,h),v=W(f.info,{});return{name:"PBI.Dashboard.InitializeNavigationPaneWorkbooks",category:e.TelemetryCategory.Verbose,time:Date.now(),id:U(),formatted:function(){return e.extendFormatted(null,null,f.formatted())},info:v,loggers:t.DashboardInitializeNavigationPaneWorkbooksLoggers}}function f(r,o,i,a,n,s,c,l,d,p,u,h){var f=t.CustomerAction(r,o,i,a,n,s,c,l,d,p,u,h),v=W(f.info,{});return{name:"PBI.Dashboard.UpdateLocalWorkbookNeverShowExplanation",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:U(),formatted:function(){return e.extendFormatted(null,null,f.formatted())},info:v,loggers:t.DashboardUpdateLocalWorkbookNeverShowExplanationLoggers}}function v(r,o,i,a,n,s,c,l,d,p,u,h){var f=t.CustomerAction(r,o,i,a,n,s,c,l,d,p,u,h),v=W(f.info,{});return{name:"PBI.Dashboard.RenameWorkbook",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:U(),formatted:function(){return e.extendFormatted(null,null,f.formatted())},info:v,loggers:t.DashboardRenameWorkbookLoggers}}function m(r,o,i,a,n,s,c,l,d,p,u,h,f,v){var m=t.CustomerAction(i,a,n,s,c,l,d,p,u,h,f,v),g=W(m.info,{storageProvider:r,contentProvider:o});return{name:"PBI.Dashboard.RemoveWorkbook",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:U(),formatted:function(){return e.extendFormatted({storageProvider:g.storageProvider,contentProvider:g.contentProvider},null,m.formatted())},info:g,loggers:t.DashboardRemoveWorkbookLoggers}}function g(r,o,i,a,n,s,c,l,d,p,u,h){var f=t.CustomerAction(r,o,i,a,n,s,c,l,d,p,u,h),v=W(f.info,{});return{name:"PBI.Dashboard.GetWorkbookWopiAccessInformation",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:U(),formatted:function(){return e.extendFormatted(null,null,f.formatted())},info:v,loggers:t.DashboardGetWorkbookWopiAccessInformationLoggers}}function y(r,o,i,a,n,s,c,l,d,p,u,h,f,v,m,g,y){var b=t.Verbose(s,c,l,d,p,u,h,f,v,m,g,y),S=W(b.info,{etagHash:r,correlationId:o,storageProvider:i,permissions:a,contentProvider:n});return{name:"PBI.Dashboard.WorkbookEmbeddingExternalSuccess",category:e.TelemetryCategory.Verbose,time:Date.now(),id:U(),formatted:function(){return e.extendFormatted({etagHash:S.etagHash,correlationId:S.correlationId,storageProvider:S.storageProvider,permissions:S.permissions,contentProvider:S.contentProvider},null,b.formatted())},info:S,loggers:t.DashboardWorkbookEmbeddingExternalSuccessLoggers}}function b(r,o,i,a,n,s,c,l){var d={etagHash:r,errorCode:o,errorDescription:i,correlationId:a,storageProvider:n,permissions:s,contentProvider:c,message:l};return{name:"PBI.Dashboard.WorkbookEmbeddingExternalFailure",category:e.TelemetryCategory.CriticalError,time:Date.now(),id:U(),formatted:function(){return e.extendFormatted({etagHash:d.etagHash,errorCode:d.errorCode,errorDescription:d.errorDescription,correlationId:d.correlationId,storageProvider:d.storageProvider,permissions:d.permissions,contentProvider:d.contentProvider,message:d.message},null)},info:d,loggers:t.DashboardWorkbookEmbeddingExternalFailureLoggers}}function S(r,o,i,a,n,s,c,l,d,p,u,h,f,v){var m=t.Verbose(i,a,n,s,c,l,d,p,u,h,f,v),g=W(m.info,{dashboardId:r,resourcePackagesCount:o});return{name:"PBI.Dashboard.ImportResourcePackagesOnLoad",category:e.TelemetryCategory.Verbose,time:Date.now(),id:U(),formatted:function(){return e.extendFormatted({dashboardId:g.dashboardId,resourcePackagesCount:g.resourcePackagesCount},null,m.formatted())},info:g,loggers:t.DashboardImportResourcePackagesOnLoadLoggers}}function k(r,o,i,a,n,s,c,l,d,p,u,h){var f=t.Verbose(r,o,i,a,n,s,c,l,d,p,u,h),v=W(f.info,{});return{name:"PBI.Dashboard.GetNavigationPanePackage",category:e.TelemetryCategory.Verbose,time:Date.now(),id:U(),formatted:function(){return e.extendFormatted(null,null,f.formatted())},info:v,loggers:t.DashboardGetNavigationPanePackageLoggers}}function D(r,o,i,a){var n={Id:r,packageId:o,objectType:i,message:a};return{name:"PBI.Permissions.ObjectNotFound",category:e.TelemetryCategory.CriticalError,time:Date.now(),id:U(),formatted:function(){return e.extendFormatted({Id:n.Id,packageId:n.packageId,objectType:n.objectType,message:n.message},null)},info:n,loggers:t.PermissionsObjectNotFoundLoggers}}function w(r,o,i,a,n,s,c,l,d,p,u,h,f){var v=t.Verbose(o,i,a,n,s,c,l,d,p,u,h,f),m=W(v.info,{appType:r});return{name:"PBI.Apps.GetApp",category:e.TelemetryCategory.Verbose,time:Date.now(),id:U(),formatted:function(){return e.extendFormatted({appType:m.appType},null,v.formatted())},info:m,loggers:t.AppsGetAppLoggers}}function C(r,o,i,a,n,s,c,l,d,p,u,h,f,v){var m=t.CustomerAction(i,a,n,s,c,l,d,p,u,h,f,v),g=W(m.info,{appGUID:r,contentProviderCategory:o});return{name:"PBI.Apps.UninstallApp",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:U(),formatted:function(){return e.extendFormatted({appGUID:g.appGUID,contentProviderCategory:g.contentProviderCategory},null,m.formatted())},info:g,loggers:t.AppsUninstallAppLoggers}}function T(r,o,i,a,n,s,c,l,d,p,u,h,f){var v=t.Verbose(o,i,a,n,s,c,l,d,p,u,h,f),m=W(v.info,{error:r});return{name:"PBI.TileConfig.UpgradeTileConfig",category:e.TelemetryCategory.Verbose,time:Date.now(),id:U(),formatted:function(){return e.extendFormatted({error:m.error},null,v.formatted())},info:m,loggers:t.TileConfigUpgradeTileConfigLoggers}}function I(r,o,i,a,n,s,c,l,d,p,u,h){var f=t.Verbose(r,o,i,a,n,s,c,l,d,p,u,h),v=W(f.info,{});return{name:"PBI.AppService.GetOrgAppsMetadata",category:e.TelemetryCategory.Verbose,time:Date.now(),id:U(),formatted:function(){return e.extendFormatted(null,null,f.formatted())},info:v,loggers:t.AppServiceGetOrgAppsMetadataLoggers}}function P(r){var o={requestType:r};return{name:"PBI.EmailSubscriptions.Request",time:Date.now(),id:U(),formatted:function(){return e.extendFormatted({requestType:o.requestType},null)},info:o,loggers:t.EmailSubscriptionsRequestLoggers}}function M(){var r={};return{name:"PBI.InstantEmail.Request",time:Date.now(),id:U(),formatted:function(){return e.extendFormatted(null,null)},info:r,loggers:t.InstantEmailRequestLoggers}}function R(r,o,i,a,n,s,c,l,d,p,u,h,f,v){var m=t.CustomerAction(i,a,n,s,c,l,d,p,u,h,f,v),g=W(m.info,{flyoutOperationType:r,navigatedToMobileDashboard:o});return{name:"PBI.MobileAuthoring.DashboardOpenedFromFlyout",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:U(),formatted:function(){return e.extendFormatted({flyoutOperationType:g.flyoutOperationType,navigatedToMobileDashboard:g.navigatedToMobileDashboard},null,m.formatted())},info:g,loggers:t.MobileAuthoringDashboardOpenedFromFlyoutLoggers}}function E(r,o,i,a,n,s,c,l,d,p,u,h,f,v,m){var g=t.CustomerAction(a,n,s,c,l,d,p,u,h,f,v,m),y=W(g.info,{artifactId:r,artifactType:o,isVisible:i});return{name:"PBI.Permissions.UpdateArtifactVisibility",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:U(),formatted:function(){return e.extendFormatted({artifactId:y.artifactId,artifactType:y.artifactType,isVisible:y.isVisible},null,g.formatted())},info:y,loggers:t.PermissionsUpdateArtifactVisibilityLoggers}}function A(r,o,i,a,n,s,c,l,d,p,u,h,f){var v=t.CustomerAction(o,i,a,n,s,c,l,d,p,u,h,f),m=W(v.info,{datapoolGuid:r});return{info:m,formatted:function(){return e.extendFormatted({datapoolGuid:m.datapoolGuid},null,v.formatted())}}}function F(r,o,i,a,n,s,c,l,d,p,u,h,f){var v=A(r,o,i,a,n,s,c,l,d,p,u,h,f),m=W(v.info,{});return{name:"PBI.Datapool.DeleteDatapool",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:U(),formatted:function(){return e.extendFormatted(null,null,v.formatted())},info:m,loggers:t.DatapoolDeleteDatapoolLoggers}}function _(r,o,i,a,n,s,c,l,d,p,u,h,f){var v=A(r,o,i,a,n,s,c,l,d,p,u,h,f),m=W(v.info,{});return{name:"PBI.Datapool.UpdateProperties",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:U(),formatted:function(){return e.extendFormatted(null,null,v.formatted())},info:m,loggers:t.DatapoolUpdatePropertiesLoggers}}function O(r,o,i,a,n,s,c,l,d,p,u,h){var f=t.CustomerAction(r,o,i,a,n,s,c,l,d,p,u,h),v=W(f.info,{});return{name:"PBI.Dataset.OnDemandSmartAlerts",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:U(),formatted:function(){return e.extendFormatted(null,null,f.formatted())},info:v,loggers:t.DatasetOnDemandSmartAlertsLoggers}}function x(r,o,i,a,n,s,c,l,d,p,u,h,f,v){var m=t.Verbose(i,a,n,s,c,l,d,p,u,h,f,v),g=W(m.info,{operation:r,count:o});return{name:"PBI.Http.RequestThrottled",category:e.TelemetryCategory.Verbose,time:Date.now(),id:U(),formatted:function(){return e.extendFormatted({operation:g.operation,count:g.count},null,m.formatted())},info:g,loggers:t.HttpRequestThrottledLoggers}}function L(r,o,i,a,n,s,c,l,d,p,u,h){var f=t.Verbose(r,o,i,a,n,s,c,l,d,p,u,h),v=W(f.info,{});return{name:"PBI.Dataset.GetSharedDatasets",category:e.TelemetryCategory.Verbose,time:Date.now(),id:U(),formatted:function(){return e.extendFormatted(null,null,f.formatted())},info:v,loggers:t.DatasetGetSharedDatasetsLoggers}}var U,N=jsCommon.Utility,W=jsCommon.UnionExtensions.mergeUnionType;U=N?N.generateGuid:Function.prototype,t.DashboardRenameReport=r,t.DashboardDeleteReport=o,t.DashboardInitializeNavigationPaneReports=i,t.DashboardInitializeNavigationPaneModels=a,t.DashboardRenameDataset=n,t.DashboardUpdateModelQnaFeatures=s,t.DashboardUpdateFeaturedQuestions=c,t.DashboardDeleteDataset=l,t.DashboardTileError=d,t.DashboardAddUpdateDashboard=p,t.DashboardSharingNewUnseenDashboards=u,t.DashboardInitializeNavigationPaneWorkbooks=h,t.DashboardUpdateLocalWorkbookNeverShowExplanation=f,t.DashboardRenameWorkbook=v,t.DashboardRemoveWorkbook=m,t.DashboardGetWorkbookWopiAccessInformation=g,t.DashboardWorkbookEmbeddingExternalSuccess=y,t.DashboardWorkbookEmbeddingExternalFailure=b,t.DashboardImportResourcePackagesOnLoad=S,t.DashboardGetNavigationPanePackage=k,t.PermissionsObjectNotFound=D,t.AppsGetApp=w,t.AppsUninstallApp=C,t.TileConfigUpgradeTileConfig=T,t.AppServiceGetOrgAppsMetadata=I,t.EmailSubscriptionsRequest=P,t.InstantEmailRequest=M,t.MobileAuthoringDashboardOpenedFromFlyout=R,t.PermissionsUpdateArtifactVisibility=E,t.BaseDatapoolEvent=A,t.DatapoolDeleteDatapool=F,t.DatapoolUpdateProperties=_,t.DatasetOnDemandSmartAlerts=O,t.HttpRequestThrottled=x,t.DatasetGetSharedDatasets=L})(t=e.telemetry||(e.telemetry={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){e[e.composite=0]="composite",e[e.iframe=1]="iframe",e[e.image=2]="image",e[e.model=3]="model",e[e.ssrs=4]="ssrs",e[e.workbook=5]="workbook",e[e.report=6]="report",e[e.realTime=8]="realTime"})(t=e.TileType||(e.TileType={}));var r;!(function(e){e[e.PowerBIServiceException=0]="PowerBIServiceException",e[e.DSRException=1]="DSRException"})(r=e.QueryResultErrorType||(e.QueryResultErrorType={}));var o;!(function(e){e[e.SingleVisual=0]="SingleVisual"})(o=e.CompositeTileType||(e.CompositeTileType={}))})(t=e.contracts||(e.contracts={}))})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){function t(){var e;return e={},e.Light={name:"Light",foreground:"#000000",background:"#EAEAEA",dataColors:["#01B8AA","#374649","#FD625E","#F2C80F","#5F6B6D","#8AD4EB","#FE9666","#A66999"],tiles:{background:"#FFFFFF",color:"#000000"},visualStyles:{"*":{"*":{"*":[{color:{solid:{color:"#000000"}}}]}}}},e.Dark={name:"Dark",foreground:"#FFFFFF",background:"#484644",dataColors:["#51CFBE","#F55965","#FE9666","#92BEFF","#B577DF","#29B9EF","#3599B8","#DFBFBF"],tableAccent:"#E2A84E",tiles:{background:"#2B2B30",color:"#FFFFFF"},visualStyles:{"*":{"*":{"*":[{color:{solid:{color:"#FFFFFF"}}},{labelColor:{solid:{color:"#CECECE"}}}]}}}},e["Color-blind friendly"]={name:"Color-blind friendly",background:"#EAEAEA",foreground:"#000000",dataColors:["#074650","#009292","#FE6DB6","#FEB5DA","#480091","#B66DFF","#B5DAFE","#6DB6FF","#914800","#23FD23"],tiles:{background:"#FFFFFF",color:"#000000"},visualStyles:{"*":{"*":{"*":[{color:{solid:{color:"#000000"}}}]}}}},e}e.BuiltInThemeNamesResourceValues={Light:"Light",Dark:"Dark","Color-blind friendly":"Color_Blind_Friendly",Custom:"Custom"},e.createBuiltInThemesFactory=t})(t=e.contracts||(e.contracts={}))})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){e[e.Dashboard=0]="Dashboard",e[e.Report=1]="Report",e[e.Model=2]="Model",e[e.Workbook=3]="Workbook"})(t=e.ContentPackItems||(e.ContentPackItems={}))})(t=e.models||(e.models={}))})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){e.AppModelIconColors=["#000","#FFF"],e.AppModelIconBackgroundColors=[{color:"#01B8AA",fontColor:"#000"},{color:"#374649",fontColor:"#FFF"},{color:"#FD625E",fontColor:"#FFF"},{color:"#F2C80F",fontColor:"#000"},{color:"#5F6B6D",fontColor:"#000"},{color:"#8AD4EB",fontColor:"#000"},{color:"#FE9666",fontColor:"#000"},{color:"#A66999",fontColor:"#000"},{color:"#3599B8",fontColor:"#000"},{color:"#DFBFBF",fontColor:"#000"}],e.ServiceAppFallbackColors={color:"#374649",fontColor:"#FFF"},e.AppModelIcons=["financial","emi","group","realtime","image","pc1","paintbrush","world","streaming-data","user","barchart","gauge","globe","piedouble","areachart","comment","visualinteraction","code","shapes","piechart","stackedcolumn","scatter","database","home","insight"]})(t=e.models||(e.models={}))})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(r){var o=e.common.contracts.ContentTileType,i=jsCommon.Lazy;r.DashboardAsyncLayoutDelayMs=100;var a=(function(){function e(e){this.contract=e,this.isEnabled=!0,this.isUsedByContentPack=!1,this.isLoaded=e&&null!=e.tiles,this.hitCount=0,this.lazyTiles=null,this.uniqueId=o.Dashboard+"_"+this.contract.id}return e.prototype.getPermissions=function(){var e;return this.getPermissionsCallback&&null!=(e=this.getPermissionsCallback())?e:this.contract&&this.contract.permissions},e.prototype.increaseHitCount=function(){this.hitCount++},Object.defineProperty(e.prototype,"tiles",{get:function(){return this.lazyTiles||(this.lazyTiles=new i(function(){return[]})),this.lazyTiles.getValue()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"id",{get:function(){return this.contract.id},set:function(e){this.contract.id=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"folderId",{get:function(){return this.contract.folderId},set:function(e){this.contract.folderId=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"objectId",{get:function(){return this.contract.objectId},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"canEdit",{get:function(){return t.DashboardUtils.isWriteable(this.contract)&&!(this.gridLayoutService&&this.gridLayoutService.strategy.isLayoutLocked)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"contentTileType",{get:function(){return o.Dashboard},enumerable:!0,configurable:!0}),e.prototype.isFilled=function(){return this.contract.tiles&&this.tiles.length===this.contract.tiles.length},e.prototype.calculateLayout=function(){this.layoutRequired=!1;var e=this.tiles;if(!_.isEmpty(e))for(var t=0,r=e;t<r.length;t++){var o=r[t];o.calculateLayout()}},e.prototype.applyLayout=function(){var e=this.tiles;if(!_.isEmpty(e))for(var t=0,r=e;t<r.length;t++){var o=r[t];o.applyLayout()}},e.prototype.runLayoutIfRequired=function(){this.layoutRequired&&(this.calculateLayout(),this.applyLayout())},e.prototype.scheduleDelayedLayout=function(e){var t=this;void 0===e&&(e=!1),this.layoutRequired||(this.layoutRequired=!0,e||setTimeout((function(){t.layoutRequired&&(t.calculateLayout(),t.applyLayout())}),r.DashboardAsyncLayoutDelayMs))},e.prototype.findTile=function(e){return _.find(this.tiles,(function(t){return t.id===e}))},e.prototype.findTileByObjectIdOrOriginalObjectId=function(e,t){if(e||t)return _.find(this.tiles,(function(r){return!_.isEmpty(e)&&r.contract.objectId===e||!_.isEmpty(t)&&r.contract.originalTileObjectId===t}))},e.prototype.getTileIndex=function(e){return _.findIndex(this.tiles,(function(t){return t.id===e}))},e.prototype.getTileContractIndex=function(e){return _.findIndex(this.contract.tiles,(function(t){return t.id===e}))},e.prototype.getUniquePackageId=function(){var e=this.contract;return e.originalPackageId?e.originalPackageId:e.packageIds&&1===e.packageIds.length?e.packageIds[0]:void 0},e.prototype.hasModel=function(e){return _.some(this.tiles,(function(t){return t.contract.modelId===e}))},e.prototype.hasOwnerInfo=function(){return!_.isEmpty(this.ownerFullname)||!_.isEmpty(this.ownerMail)},e})();r.Dashboard=a})(r=t.models||(t.models={}))})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(o){function i(e,t,r,o,i,a,n,s,c,l,d,p){return new S(e,t,r,o,i,a,n,s,c,l,d,p)}var a=jsCommon.ArrayExtensions,n=e.common.contracts,s=n.ContentProviderCategory,c=n.ContentTileType,l=t.models,d=jsCommon.GzipUtility,p=jsCommon.JsonExtensions,u=jsCommon.Lazy,h=e.common.helpers.ModelConverterHelper,f=jsCommon.PerfTimer,v=n.PublishOrRefreshStatus,m=e.common.models.Report,g=t.contracts.TileType,y=jsCommon.Utility,b=jsCommon.Version;o.createDataServiceModelConverter=i;var S=(function(){function i(e,t,r,o,i,a,n,s,c,l,d,p){this.geolocationService=e,this.telemetryService=t,this.visualPlugins=r,this.visualPluginOps=o,this.featureSwitchService=i,this.geocoder=a,this.promiseFactory=n,this.moduleLoader=s,this.permissionService=c,this.tileConfigUpgraderService=l,this.localizationService=d,this.explorationSerializer=p}return i.prototype.setModelMerger=function(e){this.modelMerger=e},i.prototype.convertCompositeTile=function(r){if(!r||r.type!==g.composite)return null;var i=this.convertTileConfig(r);this.convertTileLayoutConfig(r);var a;if(!i||!i.visualContainer)return null;a=new o.SingleVisualCompositeTileModel(r,this.visualPlugins,this.visualPluginOps,this.featureSwitchService,this.geolocationService,this.geocoder,this.promiseFactory,this.moduleLoader,this.telemetryService),a.config=i.visualContainer,a.displayText=r.displayText,a.subDisplayText=r.subDisplayText;var n=t.ContractUtils.getMasterLayoutPosition(r);if(a.size={rowSpan:n.height,colSpan:n.width},a.isLoading=o.TileFactory.isTileLoading(r),r.queryResultError){a.isError=!0;var s=r.queryResultError;this.telemetryService.logEvent(e.telemetry.DashboardTileError,g[g.composite],jsCommon.StringExtensions.format("{0}:{1} with rootActivityId:{2}, modelId:{3} and tileId:{4}",jsCommon.EnumExtensions.toString(t.contracts.QueryResultErrorType,s.type),s.errorDetail,s.rootActivityId,r.modelId.toString(),r.id.toString()));var c=t.TileUtils.getTileErrorDetailsFromQueryResultError(s);c?(a.errorDetails=c,a.errorText=c.message):a.errorText=e.common.localize.get("Tile_ErrorText")}return a},i.prototype.convertTileData=function(t){if(t.tileDataSet)return t.tileDataSet;var r=this.convertTileConfig(t);try{t.tileDataSet=this.parseTileData(t,r.tileDataType)}catch(r){throw this.telemetryService.logEvent(e.telemetry.DashboardTileError,g[g.composite],jsCommon.StringExtensions.format("DsrParseError:{0} with modelId:{1} and tileId:{2}",r.message,t.modelId.toString(),t.id.toString())),y.ensureError(r)}return t.tileDataSet},i.prototype.convertDashboard=function(e,t,r,o){var i=this,a=this.convertDashboardShallow(e);return e.tiles&&(a.lazyTiles=new u(function(){return _.map(e.tiles,(function(e){return i.convertTile(e,t,r,o)}))})),a},i.prototype.convertDashboardShallow=function(e){var t=this,r=new o.Dashboard(e);return r.getPermissionsCallback=function(){return t.permissionService.getDashboardEffectivePermissions(e)},r.dataClassificationId=e.dataClassificationId,r.folderId=e.folderId,this.modelMerger.mergeDashboardShallow(r,e),r},i.prototype.convertIframeTile=function(e){if(!e||e.type!==g.iframe)return null;var t=new o.IframeTileModel(e),r=this.convertTileConfig(e);return this.convertTileLayoutConfig(e),r&&r.iframe&&(t.srcUrl=r.iframe.srcUrl,t.embedCode=r.iframe.embedCode),t.isLoading=o.TileFactory.isTileLoading(e),t},i.prototype.convertImageTile=function(e){if(!e||e.type!==g.image)return null;var r=new o.ImageTileModel(e);return this.convertTileLayoutConfig(e),r.displayText=e.displayText,r.subDisplayText=e.subDisplayText,"number"!=typeof r.contract.reportId||e.config?(r.isStatic=!1,r.imageUrl=this.getImageUrl(e)):(r.isStatic=!0,r.imageUrl=t.constants.modelPlaceholderImageUrl),r.isLoading=o.TileFactory.isTileLoading(e),r},i.prototype.convertContentPackBase=function(e){if(e){var r,o,i,a,n=p.tryParseJSON(e.providerConfig),c=e.category;c===s.Organizational||c===s.OrganizationalApp||c===s.OrganizationalTemplate||c===s.OrganizationalTemplateApp?a=n:i=n,n&&(i?(r=i.shortDescription||i.description,o=i.author):a&&(r=a.description,o=a.author));return{providerContract:e,providerConfig:i,organizationalProviderConfig:a,providerId:e.providerId,displayText:e.displayText,iconUrl:e.iconUrl||"",description:r,publishTime:t.DateUtils.convertDate(e.publishTime),providerKey:e.providerKey,author:o,category:e.category,allowCopyContent:!0,dashboardIds:e.dashboardIds||[],reportIds:e.reportIds||[],modelIds:e.modelIds||[],workbookIds:e.workbookIds||[]}}},i.prototype.convertAppModelBase=function(e){var o=p.tryParseJSON(e.providerConfig);if(o&&o.appSettings){var i=o.appSettings;return{icon:i.iconName,iconColor:i.iconColor,iconBackgroundColor:i.iconBackgroundColor,headerBackgroundColor:i.headerBackgroundColor||t.AppUtils.getAppHeaderBackgroundColor(i.iconBackgroundColor),defaultContent:i.defaultAppArtifact,defaultContentOption:i.defaultAppArtifact?1:0,appPush:!!i.appPush,canExploreDataset:!!i.exploreDataset}}if(e.category===s.ServiceApp||e.category===s.Services)return{iconColor:r.ServiceAppFallbackColors.fontColor,iconBackgroundColor:r.ServiceAppFallbackColors.color,headerBackgroundColor:t.AppUtils.getAppHeaderBackgroundColor(r.ServiceAppFallbackColors.color),defaultContentOption:0}},i.prototype.convertInstalledAppModel=function(e,r){var o=this.convertContentPackBase(e);if(o){var i=this.convertAppModelBase(e),a=p.tryParseJSON(e.providerConfig),n=__assign({objectId:e.providerKey,contentTileType:c.OrgApp,packageId:r.id,uniqueId:r.id,displayName:e.displayText,publishTime:t.DateUtils.convertDate(e.publishTime),getPermissions:function(){return 17},dashboards:[],models:[],reports:[],workbooks:[],displayDate:t.AppUtils.convertDisplayDate(a&&a.creationTime||e.publishTime,this.localizationService),isFavorite:!1,isFavoriteDisabled:!1,favoriteInfo:void 0,groupObjectId:e.groupObjectId},o,i);return t.AppUtils.isOrgApp(e)||(n.displayDate=t.AppUtils.convertDisplayDate(r.lastRefreshTime,this.localizationService)),n}},i.prototype.convertModel=function(e){var t=this.convertModelShallow(e);return this.updateModelProperties(t,e),t},i.prototype.convertModelTile=function(e){if(!e||e.type!==g.model)return null;var t=new o.ModelTileModel(e);return this.convertTileLayoutConfig(e),t.displayText=e.displayText,t.isLoading=o.TileFactory.isTileLoading(e),t.subDisplayText=e.subDisplayText,t},i.prototype.convertModelShallow=function(t){return new e.common.models.Model(t)},i.prototype.convertCdsaModel=function(e){var t=this.convertCdsaModelShallow(e);return this.modelMerger.mergeCdsaModel(t,e),t},i.prototype.convertCdsaModelShallow=function(t){return new e.common.models.CdsaModel(t)},i.prototype.convertPackage=function(e){var t=this,r=this.convertPackageShallow(e);return e&&(r.contract=e,
r.id=e.id,r.contentProviderId=e.contentProviderId,r.lastRefreshTime=e.lastRefreshTime,r.latestVersion=e.latestVersion,r.version=e.version,r.name=e.name,r.publishOrRefreshStatus=e.publishOrRefreshStatus||v.FinishedSuccessfully,r.packageType=e.packageType,r.originalPackageId=e.originalPackageId,r.getPermissionsCallback=function(){return t.permissionService.getPackageEffectivePermissions(e)}),r},i.prototype.convertPackageShallow=function(e){return new l.Package(e)},i.prototype.convertRealTimeTile=function(e){if(!e||e.type!==g.realTime)return null;var r=this.convertTileConfig(e);this.convertTileLayoutConfig(e);var i=new o.RealTimeTileModel(e,this.visualPlugins,this.visualPluginOps,this.featureSwitchService,this.geolocationService,this.geocoder,this.promiseFactory,this.moduleLoader,this.telemetryService);r&&r.realTimeVisual&&(i.config=r.realTimeVisual),i.displayText=e.displayText,i.subDisplayText=e.subDisplayText;var a=t.ContractUtils.getMasterLayoutPosition(e);return i.size={rowSpan:a.height,colSpan:a.width},i},i.prototype.convertReport=function(e){var t=this,r=this.convertReportShallow(e);return e&&(r.id=e.id,r.modelId=e.modelId,r.reportUrl=e.reportUrl,r.packagePublishStatus=e.packagePublishStatus||v.FinishedSuccessfully,r.name=e.name,r.displayName=e.displayName,r.description=e.description,r.fileName=e.fileName,r.packageId=e.packageId,r.packageVersion=e.packageVersion,r.contentProviderId=e.contentProviderId,r.objectId=e.objectId,r.isNew=e.isNew,r.isHidden=e.isHidden,r.sharedTime=e.sharedTime||"/Date(0)/",e.ownerInfo&&this.modelMerger.mergeArtifactOwnerInfo(r,e.ownerInfo),r.getPermissionsCallback=function(){return t.permissionService.getReportEffectivePermissions(e)},this.fillReport(r,e)),r},i.prototype.convertReportShallow=function(e){return new m(e)},i.prototype.convertReportTile=function(e){return e&&e.type===g.report?(this.convertTileLayoutConfig(e),new o.ReportTileModel(e)):null},i.prototype.convertSpecificTileShallow=function(e,r){switch(this.convertTileLayoutConfig(e),e.type){case g.composite:var i=this.convertTileConfig(e);if(i&&i.visualContainer&&(r.composite=new o.SingleVisualCompositeTileModel(e,this.visualPlugins,this.visualPluginOps,this.featureSwitchService,this.geolocationService,this.geocoder,this.promiseFactory,this.moduleLoader,this.telemetryService)),r.composite){var a=t.ContractUtils.getMasterLayoutPosition(e);r.composite.size={rowSpan:a.height,colSpan:a.width},r.composite.isLoading=o.TileFactory.isTileLoading(e)}break;case g.iframe:r.iframe=new o.IframeTileModel(e),r.iframe.isLoading=o.TileFactory.isTileLoading(e);break;case g.image:r.image=new o.ImageTileModel(e),r.image.isLoading=o.TileFactory.isTileLoading(e);break;case g.model:r.model=new o.ModelTileModel(e),r.model.isLoading=o.TileFactory.isTileLoading(e);break;case g.ssrs:r.model=new o.SsrsTileModel(e),r.model.isLoading=o.TileFactory.isTileLoading(e);break;case g.workbook:r.workbook=new o.WorkbookTileModel(e,r),r.workbook.isLoading=o.TileFactory.isTileLoading(e);break;case g.report:r.model=new o.ReportTileModel(e),r.model.isLoading=o.TileFactory.isTileLoading(e);break;case g.realTime:this.convertTileConfig(e),r.realTime=new o.RealTimeTileModel(e,this.visualPlugins,this.visualPluginOps,this.featureSwitchService,this.geolocationService,this.geocoder,this.promiseFactory,this.moduleLoader,this.telemetryService)}},i.prototype.convertSsrsTile=function(e){if(!e||e.type!==g.ssrs)return null;this.convertTileLayoutConfig(e);var t=new o.SsrsTileModel(e);return e.config&&(t.imageUrl=this.getSsrsImageUrl(e)),t.isLoading=o.TileFactory.isTileLoading(e),t},i.prototype.convertTile=function(e,t,r,o){this.convertTileLayoutConfig(e);var i=this.convertTileShallow(e,t,r);if(this.modelMerger.mergeTile(i,e,t,r,o),null!=e.reportId){var a=this.getTileReport(e.reportId,r);a&&(i.report=i.report||new m(a),this.fillReport(i.report,a))}return i},i.prototype.convertTileLayoutConfig=function(e){if(!e.$layoutConfig){var t={x:e.col,y:e.row,width:e.colSpan,height:e.rowSpan},r=void 0;if(e.layoutConfig)try{r=JSON.parse(e.layoutConfig);a.extendWithId(r.layouts).withId(0).position=t}catch(e){}else r={layouts:[{id:0,position:t}]};e.$layoutConfig=r,e.layoutConfig=JSON.stringify(r)}return e.$layoutConfig},i.prototype.convertTileAction=function(e){var t=e.$action;if(!t){var r;if(e.action&&0===e.action.indexOf("{"))try{r=JSON.parse(e.action)}catch(e){}else r={action:e.action};t=e.$action=r}return t},i.prototype.convertTileConfig=function(e){var t=e.$config;if(!t){var r=f.start("Parse tile config");try{t=e.$config=this.deserializeTileConfig(e.config);var o=t.visualContainer||t.realTimeVisual;this.deserializeVisualContainer(o);var i=o||t.visual;this.deserializeModelExtensions(i),this.tileConfigUpgraderService.upgrade(e.id,t,e.query)}catch(e){}finally{r()}}return t},i.prototype.deserializeTileConfig=function(e){var t=p.tryParseJSON(e);return null==t&&(t={version:b.ZeroStr}),t},i.prototype.deserializeVisualContainer=function(e){e&&e.visualContainer&&!e.$visualContainer&&(e.$visualContainer=this.explorationSerializer.deserializeVisualContainer(e.visualContainer))},i.prototype.deserializeModelExtensions=function(e){e&&e.modelExtensions&&!e.$modelExtensions&&(e.$modelExtensions=this.explorationSerializer.deserializeModelExtensions(e.modelExtensions))},i.prototype.convertTileShallow=function(e,t,r){this.convertTileLayoutConfig(e);var i=new o.Tile(e,this.localizationService);return this.modelMerger.mergeTileShallow(i,e,t,r),i},i.prototype.convertWorkbook=function(e){var t=this,r=this.convertWorkbookShallow(e);return e&&(r.id=e.id,r.modelId=e.modelId,r.viewUrl=this.getWorkbookViewUrl(e),r.editUrl=this.getWorkbookEditUrl(e),r.embedUrl=this.getWorkbookEmbedView(e),r.name=e.name,r.displayName=e.displayName,r.description=e.description,r.fileName=e.fileName,r.packageId=e.packageId,r.isNew=e.isNew,r.getPermissionsCallback=function(){return t.permissionService.getWorkbookEffectivePermissions(e)}),r},i.prototype.convertWorkbookShallow=function(e){return new o.Workbook(e)},i.prototype.convertWorkbookTile=function(e,r,i){if(!e||e.type!==g.workbook)return null;this.convertTileLayoutConfig(e);var a=new o.WorkbookTileModel(e,i);a.displayText=e.displayText,a.subDisplayText=e.subDisplayText,a.isLoading=o.TileFactory.isTileLoading(e),a.image=e.tileDataBinaryBase64Encoded,e.$config.workbookTile&&e.$config.workbookTile.keepOriginalContentSize?a.keepOriginalContentSize=e.$config.workbookTile.keepOriginalContentSize:a.keepOriginalContentSize=t.constants.workbook.defaultKeepOriginalContentSize;var n=e.$config.workbookTile;return r&&(n&&(a.embedUrl=r.embedUrl+"&item="+n.item),r.contract&&(a.webUri=r.contract.webUri)),a},i.prototype.fillDashboardChildren=function(e,t,r,o){var i=this,a=e.contract;e.displayName!==a.displayName&&(e.displayName=a.displayName),a.tiles&&(e.lazyTiles=new u(function(){return a.tiles.map((function(e){return i.convertTile(e,t,r,o)}))}))},i.prototype.fillModel=function(e,t){e.id=t.id,e.contract=t},i.prototype.fillReport=function(e,t){e.id=t.id,e.contract=t,e.reportUrl=t.reportUrl},i.prototype.getImageUrl=function(e){var t=this.convertTileConfig(e);if(t&&t.imageTile)return t.imageTile.imageUrl},i.prototype.getSsrsImageUrl=function(e){var t=this.convertTileConfig(e);if(t&&t.ssrsTile)return t.ssrsTile.imageUrl},i.prototype.getTileModel=function(e,t){var r;if(t){var o=a.indexOf(t,(function(t){return t&&t.id===e}));o!==-1&&(r=t[o])}return r},i.prototype.getTileReport=function(e,t){var r;if(t){var o=a.indexOf(t,(function(t){return t&&t.id===e}));o!==-1&&(r=t[o])}return r},i.prototype.getTileWorkbook=function(e,t,r){var o;if(r){var i=a.indexOf(r,(function(r){return r.id===e&&r.packageId===t}));i!==-1&&(o=r[i])}return o},i.prototype.resolveTilePackage=function(e,t){if(e.packageId){var r=a.indexOf(t,(function(t){return t.id===e.packageId}));r!==-1&&(e.tilePackage=t[r])}},i.prototype.getWorkbookViewUrl=function(e){return this.getWorkbookActionUrl(e,"view")},i.prototype.getWorkbookEditUrl=function(e){return this.getWorkbookActionUrl(e,"edit")},i.prototype.getWorkbookEmbedView=function(e){return this.getWorkbookActionUrl(e,"embedview")},i.prototype.getWorkbookActionUrl=function(e,t){return e.webUri&&e.etagHash?e.webUri+"/_layouts/WopiFrame.aspx?sourcedoc={"+e.etagHash+"}&action="+t:""},i.prototype.updateModelProperties=function(e,t){var r=this;t&&(e.id=t.id,e.isNew=t.isNew,e.cloudRlsEnabled=t.cloudRlsEnabled,e.name=t.name,e.displayName=t.displayName,e.description=t.description,e.fileName=t.fileName,e.packageId=t.packageId,e.packageVersion=t.packageVersion,e.contentProviderId=t.contentProviderId,e.isHidden=t.isHidden||!1,e.isRefreshInProgress=t.currentRefreshStartingTime&&h.convertRefreshTimeToJsDateTime(t.currentRefreshStartingTime).getTime()+18e5>Date.now(),e.dbName=t.dbName,e.vsName=t.vsName,e.realTimeMode=t.realTimeMode,e.getPermissionsCallback=function(){return r.permissionService.getModelEffectivePermissions(t)},this.fillModel(e,t))},i.prototype.parseTileData=function(e,t){var r,o=f.start("Parse tile data");try{if(e.tileDataBinaryBase64Encoded){var i=d.uncompress(e.tileDataBinaryBase64Encoded);r=JSON.parse(i)}else e.tileData&&(r=JSON.parse(e.tileData));return{type:t,data:r}}finally{o()}},i})()})(r=t.models||(t.models={}))})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(r){function o(e,t){return new c(e,t)}var i=jsCommon.ArrayExtensions,a=jsCommon.Lazy,n=e.common.helpers.ModelConverterHelper,s=e.common.helpers.UserInfoHelper;r.createDataServiceModelMerger=o;var c=(function(){function e(e,t){this.modelConverter=e,this.permissionService=t}return e.prototype.mergeCdsaModel=function(e,t){e.contract=t,e.name=t.name,e.displayName=t.displayName,e.description=t.description,e.id=t.id,e.currentRefreshStatus=t.lastRefreshStatus},e.prototype.mergeDashboard=function(e,t,r,o,i){var n=this,s=this.modelConverter.convertDashboard(t,r,o,i);e.contract=t,e.displayName=s.displayName,e.getPermissionsCallback=function(){return n.permissionService.getDashboardEffectivePermissions(t)},e.contract.modelIds=t.modelIds,e.contract.reportIds=t.reportIds,e.contract.packageIds=t.packageIds,e.contract.workbookIds=t.workbookIds,e.qnaEnabled=t.qnaEnabled,e.gravityEnabled=t.gravityEnabled,e.annotationsEnabled=t.annotationsEnabled,e.isSharedFromSecurityGroup=t.isSharedFromSecurityGroup,e.isHidden=t.isHidden;var c=e.tiles;e.lazyTiles=new a(function(){var e=[];if(_.isEmpty(s.tiles))return e;for(var t=function(t){var a=_.find(c,(function(e){return e.id===t.id}));a?(e.push(a),n.mergeTile(a,t.contract,r,o,i)):e.push(t)},a=0,l=s.tiles;a<l.length;a++){t(l[a])}return e})},e.prototype.mergeArtifactOwnerInfo=function(e,t){e.ownerFullname=s.getFullName(t.givenName,t.familyName),e.ownerMail=t.emailAddress,t.userObjectId&&(e.ownerUserObjectId=t.userObjectId),t.groupObjectId&&(e.ownerGroupObjectId=t.groupObjectId),e.contract.ownerInfo||(e.contract.ownerInfo=t)},e.prototype.mergeDashboardShallow=function(e,t){var r=this;if(t.displayName&&(e.displayName=t.displayName),void 0!==t.permissions&&(e.getPermissionsCallback=function(){return r.permissionService.getDashboardEffectivePermissions(t)},e.contract.permissions=t.permissions),t.modelIds&&(e.contract.modelIds=t.modelIds),t.reportIds&&(e.contract.reportIds=t.reportIds),t.workbookIds&&(e.contract.workbookIds=t.workbookIds),t.packageIds&&(e.contract.packageIds=t.packageIds),void 0!==t.isStaging&&(e.contract.isStaging=t.isStaging),void 0!==t.qnaEnabled&&(e.qnaEnabled=t.qnaEnabled),void 0!==t.gravityEnabled&&(e.gravityEnabled=t.gravityEnabled),void 0!==t.annotationsEnabled&&(e.annotationsEnabled=t.annotationsEnabled),void 0!==t.isSharedFromSecurityGroup&&(e.isSharedFromSecurityGroup=t.isSharedFromSecurityGroup),void 0!==t.isHidden&&(e.isHidden=t.isHidden),void 0!==t.ownerInfo){var o=t.ownerInfo;this.mergeArtifactOwnerInfo(e,o)}e.sharedTime=t.sharedTime||"/Date(0)/"},e.prototype.mergeDashboardTiles=function(e,t){var r=t.models||[],o=t.reports||[],i=t.workbooks||[],a=t.packages||[],n=e.contract.tiles;if(n)for(var s=0,c=n;s<c.length;s++){var l=c[s];this.modelConverter.resolveTilePackage(l,a)}var d=e.tiles;if(d)for(var p=0,u=d;p<u.length;p++){var h=u[p];this.mergeTile(h,h.contract,r,o,i)}},e.prototype.mergeModel=function(e,t){var r=this;e&&t&&(e.contract=t,e.id=t.id||e.id,e.isNew=t.isNew||e.isNew,e.getPermissionsCallback=function(){return r.permissionService.getModelEffectivePermissions(t)},e.name=t.name||e.name,e.displayName=t.displayName||e.displayName,e.description=t.description||e.description,e.fileName=t.fileName||e.fileName,e.packageId=t.packageId||e.packageId,e.packageVersion=t.packageVersion||e.packageVersion,e.contentProviderId=t.contentProviderId||e.contentProviderId,e.packagePublishStatus=null!=t.packagePublishStatus?t.packagePublishStatus:e.packagePublishStatus,e.isRefreshInProgress=t.currentRefreshStartingTime&&n.convertRefreshTimeToJsDateTime(t.currentRefreshStartingTime).getTime()+18e5>Date.now(),e.cloudRlsEnabled=t.cloudRlsEnabled,e.realTimeMode=t.realTimeMode)},e.prototype.mergeModelContentProviderId=function(e,r){if(e)for(var o=0,i=e;o<i.length;o++){var a=i[o];a.contentProviderId=a.contentProviderId||t.ContractUtils.findContentProviderId(r,a.packageId)}},e.prototype.mergeReport=function(e,t){var r=this;e&&t&&(e.contract=t,e.id=t.id||e.id,e.objectId=t.objectId||e.objectId,e.modelId=t.modelId||e.modelId,e.reportUrl=t.reportUrl||e.reportUrl,e.getPermissionsCallback=function(){return r.permissionService.getReportEffectivePermissions(t)},e.packagePublishStatus=t.packagePublishStatus||e.packagePublishStatus,e.name=t.name||e.name,e.displayName=t.displayName||e.displayName,e.description=t.description||e.description,e.fileName=t.fileName||e.fileName,e.packageId=t.packageId||e.packageId,e.packageVersion=t.packageVersion||e.packageVersion,e.contentProviderId=t.contentProviderId||e.contentProviderId,e.isHidden=t.isHidden,t.ownerInfo&&this.mergeArtifactOwnerInfo(e,t.ownerInfo))},e.prototype.mergeTileShallow=function(e,t,o,i){this.modelConverter.convertTileLayoutConfig(t),e.contract=t,e.type=t.type,this.mergeTileLayoutConfig(e,t),e.displayText=t.displayText,e.subDisplayText=t.subDisplayText,e.backgroundImageUrl=this.modelConverter.getImageUrl(t),e.errorCode=t.errorCode;var a=this.modelConverter.getTileReport(t.reportId,i);if(t.query&&t.query.modelQuery&&(e.utterance=t.query.modelQuery.utterance),e.action=this.modelConverter.convertTileAction(t),e.config=this.modelConverter.convertTileConfig(t),e.isLoading=r.TileFactory.isTileLoading(t),e.isLocked=r.TileFactory.isTileLocked(t),t.modelId){var n=this.modelConverter.getTileModel(t.modelId,o);n&&(e.vsName=n.vsName,e.dbName=n.dbName)}t.reportId&&(e.report=e.report||this.modelConverter.convertReport(a),e.report.id=t.reportId),a&&(this.modelConverter.fillReport(e.report,a),e.action||(e.action={action:"/openReport"})),this.modelConverter.convertSpecificTileShallow(t,e)},e.prototype.mergeTileLayoutConfig=function(e,t){if(!(e.layoutPosition.x&&e.layoutPosition.y&&e.layoutPosition.width&&e.layoutPosition.height)){var r=i.extendWithId(t.$layoutConfig.layouts),o=e.gridLayoutContext,a=o?o.getActiveLayout():0,n=r.withId(a);n&&this.mergeLayoutPosition(e.layoutPosition,n.position)}},e.prototype.mergeLayoutPosition=function(e,t){t&&(e.x=e.x||t.x,e.y=e.y||t.y,e.width=e.width||t.width,e.height=e.height||t.height)},e.prototype.mergeTile=function(e,t,o,i,a,n){var s=e.composite,c=e.realTime;this.mergeTileShallow(e,t,o,i),e.composite=this.modelConverter.convertCompositeTile(t),s&&e.composite&&(e.composite.setDataLoadEventDelegate(s.dataLoadEventDelegate),e.composite.copyDependencies(s),s instanceof r.SingleVisualCompositeTileModel&&e.composite instanceof r.SingleVisualCompositeTileModel&&this.mergeVisual(e.composite.visual,s.visual),s.tileDataIsVolatile&&s.tileData&&s.tileData.data&&(e.composite.tileData=s.tileData)),e.iframe=this.modelConverter.convertIframeTile(t),e.image=this.modelConverter.convertImageTile(t),e.model=this.modelConverter.convertModelTile(t),e.ssrs=this.modelConverter.convertSsrsTile(t);var l=this.modelConverter.convertRealTimeTile(t);if(this.updateTileRealTimeModel(e,c,l),e&&e.reportTile){var d=e.reportTile.exploration;e.reportTile=this.modelConverter.convertReportTile(t),e.reportTile.exploration=d}else e.reportTile=this.modelConverter.convertReportTile(t);if(!_.isEmpty(a)){var p=this.modelConverter.getTileWorkbook(t.workbookId,t.packageId,a);if(p){var u=this.modelConverter.convertWorkbook(p);e.workbook=this.modelConverter.convertWorkbookTile(t,u,e)}}if(i){var h=this.modelConverter.getTileReport(t.reportId,i);h?(e.report=e.report||this.modelConverter.convertReport(h),this.modelConverter.fillReport(e.report,h)):e.report=null,e.contractsReport=this.modelConverter.getTileReport(t.reportId,i)}else if(n){for(var f=void 0,v=0,m=n.length;v<m;v++)if(t.reportId===n[v].id){f=n[v];break}f&&(e.report=e.report||f,this.modelConverter.fillReport(e.report,f.contract),e.contractsReport=f.contract)}t.modelId&&(e.contractsModel=this.modelConverter.getTileModel(t.modelId,o))},e.prototype.mergeWorkbook=function(e,t){var r=this;e&&t&&(e.contract=t,e.id=t.id||e.id,e.getPermissionsCallback=function(){return r.permissionService.getWorkbookEffectivePermissions(t)},e.name=t.name||e.name,e.displayName=t.displayName||e.displayName,e.description=t.description||e.description,e.packageId=t.packageId||e.packageId)},e.prototype.mergePackage=function(e,t){var r=this;e&&t&&(e.contract=t,e.contentProviderId=t.contentProviderId,e.id=t.id,e.lastRefreshTime=t.lastRefreshTime,e.latestVersion=t.latestVersion,e.name=t.name,e.publishOrRefreshStatus=t.publishOrRefreshStatus,e.version=t.version,e.originalPackageId=t.originalPackageId||e.originalPackageId,e.packageType=t.packageType||e.packageType,e.getPermissionsCallback=function(){return r.permissionService.getPackageEffectivePermissions(t)})},e.prototype.mergeInstalledAppModel=function(e,t,r){var o=this.modelConverter.convertInstalledAppModel(t,r);delete o.isFavorite,delete o.isFavoriteDisabled,delete o.favoriteInfo,_.extend(e,o)},e.prototype.updateTileRealTimeModel=function(e,t,r){e.realTime=r,t&&e.realTime&&e.realTime.copyRealTimeModelDependencies(t)},e.prototype.mergeVisual=function(e,t){t.visual&&e.type===t.type&&(e.visual=t.visual),e.viewport=t.viewport},e})();r.DataServiceModelMerger=c})(r=t.models||(t.models={}))})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(e){this.contract=e}return e.prototype.getPermissions=function(){var e;return this.getPermissionsCallback&&(e=this.getPermissionsCallback()),e?e:this.contract&&this.contract.permissions},e.prototype.hasUpdate=function(){return this.version&&this.latestVersion&&this.version!==this.latestVersion},e})();e.Package=t})(t=e.models||(e.models={}))})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){var r=e.common.models.DefaultGridLayoutStrategy,o=e.common.directives.InViewport,i=(function(t){function r(e,r){var o=t.call(this)||this;return o.displayWidth=e,o.displayHeight=r,o.minNumOfColumns=2,o.isLayoutLocked=!0,o}return __extends(r,t),r.prototype.calculateDisplayPositions=function(e){t.prototype.calculateDisplayPositions.call(this,e),this.scaleDashboard(e)},r.prototype.scaleDashboard=function(t){var i=this.getDashboardSize(t),a=r.calculateDashboardScaleFactor(i.width,this.displayWidth);if(!(a<=0)){var n={transform:"scale("+a+")",width:i.width+"px",height:this.displayHeight/a+"px",left:0};$(e.dataServices.constants.dashboardElementName).css(n);o.getRefreshAllHandler()()}},r.prototype.getDashboardSize=function(t){var r=this.getMaxColumnInLayout(t),o=this.getMaxRowInLayout(t);r<this.minNumOfColumns&&(r=this.minNumOfColumns);var i=e.common.GridLayoutConstants.defaultGridItemSpacing;return{width:r*this.gridWidth+i,height:o*this.gridHeight+i}},r.calculateDashboardScaleFactor=function(e,t){return t/e},r.prototype.getMaxRowInLayout=function(e){return _.maxBy(_.map(e,(function(e){return e.displayRow-1+e.displaySize.rowSpan})))},r.prototype.getMaxColumnInLayout=function(e){return _.maxBy(_.map(e,(function(e){return e.displayCol-1+e.displaySize.colSpan})))},r})(r);t.PhoneLandscapeTileLayoutStrategy=i})(r=t.models||(t.models={}))})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){var r,o=e.dataServices.contracts.TileType;!(function(e){e.tileSpacing=12,e.smallTileRowSpan=4,e.defaultTileRowSpan=6,e.mediumTileRowSpan=7,e.largeTileRowSpan=9,e.resizeBuffer=10,e.aspectRatio=.1111})(r=t.PhoneTileLayoutConstants||(t.PhoneTileLayoutConstants={}));var i=(function(){function t(t){this.isLayoutLocked=!0,this.willOverrideDisplayPosition=!0,this.gridItemSpacing=r.tileSpacing,this.tileTypeRowSpanMap={},this.visualTypeRowSpanMap={},this.gridWidth=t-this.gridItemSpacing,this.gridHeight=Math.round(this.gridWidth*r.aspectRatio),this.gridMinWidthOnResize=this.gridWidth-r.resizeBuffer,this.gridMinHeightOnResize=this.gridHeight-r.resizeBuffer,this.gridMaxWidthOnResize=this.gridWidth*e.common.models.gridLayoutConstants.gridMaxColSpan,this.gridMaxHeightOnResize=this.gridHeight*e.common.models.gridLayoutConstants.gridMaxColSpan,this.tileTypeRowSpanMap[o.report]=r.mediumTileRowSpan,this.visualTypeRowSpanMap[e.visuals.plugins.card.name]=r.smallTileRowSpan,this.visualTypeRowSpanMap[e.visuals.plugins.animatedNumber.name]=r.smallTileRowSpan,this.visualTypeRowSpanMap[e.visuals.plugins.textbox.name]=r.smallTileRowSpan}return t.prototype.calculateDisplayPositions=function(t){for(var r=e.dataServices.DashboardUtils.orderItems(_.map(t,(function(e){return{getActiveLayoutPosition:function(){return e.getLayoutPosition()},getItem:function(){return e}}}))),o=1,i=0,a=r;i<a.length;i++){var n=a[i];n.displayCol=1,n.displayRow=o,this.calculateDisplaySize(n),o+=n.displaySize.rowSpan}this.removeScale()},t.prototype.calculateDisplaySize=function(e){var t=this.getRowSpan(e);e.displaySize={colSpan:1,rowSpan:t}},t.prototype.getRowSpan=function(e){var t=e.gridItem,o=this.tileTypeRowSpanMap[t.type];if(!o&&t.composite){var i=t.composite;null!==i&&(o=this.visualTypeRowSpanMap[i.visual.type])}return o||r.defaultTileRowSpan},t.prototype.removeScale=function(){$(e.dataServices.constants.dashboardElementName).removeAttr("style")},t.prototype.isDynamic=function(){return!1},t})();t.PhonePortraitTileLayoutStrategy=i})(r=t.models||(t.models={}))})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(t){var r=(function(){function t(e,t){this.datasetInfo=e,this.definition=t}return Object.defineProperty(t.prototype,"databaseName",{get:function(){return this.datasetInfo.databaseName},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"primaryKey",{get:function(){return this.datasetInfo.resourceKey},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"secondaryKey",{get:function(){return this.datasetInfo.resourceKeySecondary},enumerable:!0,configurable:!0}),t.prototype.getPushUrl=function(){var e=window.tenantId,t=window.apiUri;"https://wabi-staging-us-east-redirect.analysis.windows.net"===window.clusterUri&&(t="https://powerbistagingapi.analysis.windows.net");var r="/beta/"+e+"/datasets/"+this.databaseName+"/rows",o=jsCommon.Utility.urlCombine(t,r),i={};return i.key=this.primaryKey,jsCommon.QueryStringUtil.addOrUpdateQueryStringToUrl(o,i)},t.createRealTimeDatasetDefinition=function(r,o,i){var a=i.schema(e.constants.RealTimeDataSourceName).entities,n=_.head(a),s=[];return _.map(n.properties,(function(e){s.push({name:e.displayName,dataType:t.convertToRealTimeDataType(e.type)})})),{name:r,columns:s,mode:o,tableName:n.name}},t.convertToRealTimeDataType=function(e){switch(e.primitiveType){case 3:case 4:return 1;case 7:return 2;case 1:return 0;case 5:return 3}},t})();t.RealTimeModel=r})(t=e.models||(e.models={}))})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){var r=e.common.GridLayoutConstants,o=(function(e){function t(t,r){var o=e.call(this,t,r)||this;return o.maxColumnsToDisaply=7,o.minColumnsToDisplay=3,o.portionOfNextColumn=.2,o}return __extends(t,e),t.prototype.getDashboardSize=function(e){var t=this.getMaxColumnInLayout(e),o=this.getMaxRowInLayout(e);t>this.maxColumnsToDisaply?t=this.maxColumnsToDisaply+this.portionOfNextColumn:t<this.minColumnsToDisplay&&(t=this.minColumnsToDisplay);var i=r.defaultGridItemSpacing;return{width:t*this.gridWidth+i,height:o*this.gridHeight+i}},t})(t.PhoneLandscapeTileLayoutStrategy);t.TabletTileLayoutStrategy=o})(r=t.models||(t.models={}))})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(r){var o,i=e.common.GridLayoutConstants,a=e.data.services.DataViewObjectSerializer,n=e.data.services.DataViewTransformActionsSerializer,s=e.common.models.gridLayoutConstants,c=e.explore.contracts.PinData,l=t.constants.upgrader.TileConfigVersion,d=t.contracts.TileType,p=jsCommon.Utility;!(function(r){function o(e,t,r){for(var o=0,i=r.length;o<i;o++){var a=r[o];if(a.vsName===e&&a.dbName===t)return a}}function u(e,t,r,o){return I(e,d.composite,t,r,o)}function h(e,t){var r=f(e,t),o={version:l};if(null!=e.realTimeDataWindow){var i=r;i.dataWindow=e.realTimeDataWindow,o.realTimeVisual=i}else o.visualContainer=r;return o}function f(t,r){var o={$visualContainer:t.visualContainer,$modelExtensions:t.modelExtensions,themeCollection:e.visualHost.ThemeUtils.cloneThemeCollection(t.themeCollection)};return v(o,t.dataTransforms,t.elements,t.tileLayoutType,t.queryMetadata,t.tileFilterDetails,t.tileHeading,t.tileSubDisplay,r,c.getVisualType(t)),o}function v(e,t,r,o,i,a,s,c,l,d){o&&(e.layoutType=o),r&&(e.elements=r),i&&(e.queryMetadata=i),s&&(e.heading1=s),a&&(e.heading2=a),c&&(e.heading3=c);var p=l.capabilities(d);t&&(e.transform=n.serializeTransformActions(n.serializeDataViewTransformActions(t,p&&p.objects)))}function m(e,t,r){var o=h(t,e);t.tileDataType&&(o.tileDataType=t.tileDataType);var i=I(o,null!=t.realTimeDataWindow?d.realTime:d.composite,t.query,t.dataViewSource,r);return i.publishState=2,t.action&&(i.action=JSON.stringify(t.action)),null!=t.utterance&&(i.query.modelQuery.utterance=t.utterance),t.name&&(i.name=t.name),i.reportId=t.reportId,t.modelId&&(i.modelId=t.modelId),t.packageId&&(i.packageId=t.packageId),i.resourcePackageIds=t.resourcePackageIds,i}function g(e){var r=_.omitBy({id:++M,type:e.type,query:e.query,action:e.action,$config:e.$config,tileData:e.tileData,tileDataSet:e.tileDataSet,publishState:e.publishState,displayText:e.displayText,subDisplayText:e.subDisplayText,modelId:e.modelId,reportId:e.reportId,workbookId:e.workbookId,packageId:e.packageId,name:e.name},(function(e){return void 0===e})),o=t.ContractUtils.getMasterLayoutPosition(e),i=t.ContractUtils.createMasterLayoutConfig({height:o.height,width:o.width});return r.$layoutConfig=i,r.layoutConfig=JSON.stringify(i),r}function y(e,r,o,a,n,c,p,u,h,f,v,m){var g={version:l};(u||h)&&(g.reportTile={pod:u,filters:h});var y;f&&(y={modelQuery:{utterance:f}});var b=2*i.defaultGridWidth,S=2*i.defaultGridHeight,k=v?v/b:2,D=m?m/S:2;0===Math.round(k)&&(k=2),0===Math.round(D)&&(k=2);var w=Math.round(i.gridItemMediumLandscapeColSpan*k),C=Math.round(i.gridItemMediumLandscapeRowSpan*D);w=w>s.gridMaxColSpan?s.gridMaxColSpan:w,C=C>s.gridMaxRowSpan?s.gridMaxRowSpan:C;var T=t.ContractUtils.createMasterLayoutConfig({width:w,height:C});return{id:++M,type:d.report,displayText:n,subDisplayText:c,action:JSON.stringify(p),reportId:e,sectionId:a,modelId:r,packageId:o,publishState:2,query:y,config:g?JSON.stringify(g):void 0,$config:g,layoutConfig:JSON.stringify(T),$layoutConfig:T}}function b(e){return 1===e.publishState}function S(e){return 20===e.errorCode}function k(){var e=[],t=C();t&&!_.isEmpty(t.tiles)&&e.push(t);var r=T();return r&&!_.isEmpty(r.tiles)&&e.push(r),_.cloneDeep(e)}function D(e){for(var t=k(),r=0,o=t;r<o.length;r++){var i=o[r],a=_.find(i.tiles,(function(t){return t.id===e}));if(null!=a)return a.template}return null}function w(e){if(void 0!==e)return JSON.stringify(e,(function(e,t){return e&&e.charAt&&"$"===e.charAt(0)?void 0:t}))}function C(){var r=[{id:1,title:e.common.localize.get("AddWidgetModal_IframeOption_Title"),description:e.common.localize.get("AddWidgetModal_IframeOption_Description"),iconClass:"pbi-glyph-iframe",template:"<edit-iframe-widget></edit-iframe-widget>",defaultTileContract:{type:d.iframe,$action:{action:null,targetUrl:"",openInSameTab:!1},$config:{iframe:{srcUrl:"",embedCode:""},version:"1.0",widget:{id:1,name:"webContent"}},$layoutConfig:t.ContractUtils.createMasterLayoutConfig()}},{id:2,title:e.common.localize.get("Image"),description:e.common.localize.get("AddWidgetModal_ImageOption_Description"),iconClass:"pbi-glyph-image",template:"<edit-image-widget></edit-image-widget>",defaultTileContract:{type:d.image,$action:{action:null,targetUrl:"",openInSameTab:!1},$config:{imageTile:{imageUrl:""},version:"1.0",widget:{id:2,name:"image"}},$layoutConfig:t.ContractUtils.createMasterLayoutConfig()}},{id:3,title:e.common.localize.get("Textbox"),description:e.common.localize.get("AddWidgetModal_TextOption_Description"),iconClass:"pbi-glyph-font",template:"<edit-text-widget></edit-text-widget>",defaultTileContract:{type:d.composite,$action:{action:null,targetUrl:"",openInSameTab:!1},$config:{version:"1.0",visualContainer:{layoutType:e.common.contracts.TileLayoutType.Default,$visualContainer:{name:p.generateGuid(),config:{singleVisual:{objects:{},visualType:"textbox"}}},themeCollection:{}},widget:{id:3,name:"textbox"}},$layoutConfig:t.ContractUtils.createMasterLayoutConfig()}},{id:4,title:e.common.localize.get("AddWidgetModal_VideoOption_Title"),description:e.common.localize.get("AddWidgetModal_VideoOption_Description"),iconClass:"pbi-glyph-slideshow",template:"<edit-video-widget></edit-video-widget>",defaultTileContract:{type:d.iframe,$action:{action:null,targetUrl:"",openInSameTab:!1},$config:{iframe:{srcUrl:"",embedCode:""},version:"1.0",widget:{id:4,name:"video"}},$layoutConfig:t.ContractUtils.createMasterLayoutConfig()}}];return{title:e.common.localize.get("Add_Widgets_Section_Title"),tiles:r}}function T(){var r=[];return r.push({id:6,title:e.common.localize.get("Realtime_TileTitle"),description:e.common.localize.get("Realtime_TileDetails"),iconClass:"pbi-glyph-streaming-data",defaultTileContract:{type:d.realTime,$action:{action:null,targetUrl:"",openInSameTab:!1},$config:{realTimeVisual:{dataWindow:null,layoutType:e.common.contracts.TileLayoutType.Default,$visualContainer:{name:p.generateGuid(),config:{singleVisual:null}},themeCollection:{}},version:"1.0"},$layoutConfig:t.ContractUtils.createMasterLayoutConfig({width:i.gridItemSmallLandscapeColSpan,height:i.gridItemSmallLandscapeRowSpan})}}),{title:e.common.localize.get("Add_Realtime_Section_Title"),tiles:r}}function I(r,o,a,n,s){var c=i.gridItemMediumLandscapeColSpan,l=i.gridItemMediumLandscapeRowSpan;t.TileUtils.getVisualType(r)===e.visuals.plugins.card.name&&(c=i.gridItemSmallLandscapeColSpan,l=i.gridItemSmallLandscapeRowSpan);var d=a?{modelQuery:{sq:JSON.stringify(a)}}:null,p=t.ContractUtils.createMasterLayoutConfig({width:c,height:l}),u={id:++M,type:o,query:d,$config:r,tileData:n?w(n.data):null,tileDataSet:n,layoutConfig:JSON.stringify(p),$layoutConfig:p},h=r.visualContainer;return h&&(u.displayText=h.heading1,u.subDisplayText=h.heading3),s&&(u.modelId=s.id),u}function P(t,r,o,i){if(t){var n=_.cloneDeep(t),s=n.realTimeVisual||n.visualContainer;if(s){if(i){var c=t.realTimeVisual||t.visualContainer;s.visualContainer=r.serializeVisualContainer(c.$visualContainer)}else{var l=s.$visualContainer.config.singleVisual,d=e.data.DataViewObjectDefinitions.getValue(l.vcObjects,{objectName:"stylePreset",propertyName:"name"},void 0);d&&d.value&&(s.stylePresetName=d.value),s.visual=l.visualType,s.columnProperties=l.columnProperties;var c=t.realTimeVisual||t.visualContainer,p=c.$visualContainer.config.singleVisual.objects;
if(p){var u=o.capabilities(l.visualType);u&&u.objects&&(s.objects=a.serializeObjects(p,u.objects))}n.visualContainer&&(n.visual=s,delete n.visualContainer),n.version="0.1"}s.$modelExtensions&&(s.modelExtensions=r.serializeModelExtensions(s.$modelExtensions)),delete s.$visualContainer,delete s.$modelExtensions}return JSON.stringify(n)}}var M=100;r.findModel=o,r.createCompositeTile=u,r.createTileConfig=h,r.createTileForPinData=m,r.createNonVisualTileFromExisting=g,r.createReportTileForExploreData=y,r.isTileLoading=b,r.isTileLocked=S,r.getTileGalleryGroups=k,r.getTileTemplate=D,r.serializeTileConfig=P})(o=r.TileFactory||(r.TileFactory={}))})(r=t.models||(t.models={}))})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){var r=e.common.contracts.ContentTileType,o=jsCommon.EnumExtensions,i=e.common.models.ReportResource,a=(function(e){function t(t){var r=e.call(this,"undefined"==typeof t?0:t.id,1,"undefined"==typeof t?0:t.packageId)||this;return r.contract=t,r}return __extends(t,e),t.prototype.getPermissions=function(){var e;return this.getPermissionsCallback&&(e=this.getPermissionsCallback()),e?e:this.contract&&this.contract.permissions},Object.defineProperty(t.prototype,"contentTileType",{get:function(){return r.Workbook},enumerable:!0,configurable:!0}),t.prototype.isOwner=function(){return o.hasFlag(this.getPermissions(),7)},t.prototype.isPersonalized=function(){var e=this.getPermissions();return o.hasFlag(e,11)&&!o.hasFlag(e,7)},t.prototype.isEditable=function(){var e=this.editUrl;return this.isOwner()&&null!==e&&void 0!==e&&""!==e},Object.defineProperty(t.prototype,"displayNameWithExtension",{get:function(){var e=jsCommon.FileUtils.getFileExtension(this.contract.sourceFilePath);return this.displayName.concat(".").concat(e)},enumerable:!0,configurable:!0}),t})(i);t.Workbook=a})(r=t.models||(t.models={}))})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(r){var o=e.explore.services.createVisualHostServices,i=e.data.services.DataViewTransformActionsSerializer,a=e.common.models.gridLayoutConstants,n=e.common.helpers.ModelConverterHelper,s=e.explore.util.ThemeUtils,c=(function(){function e(e,t,r){this.useSmallPlotArea=!1,this.contract=e,this.visualPluginService=t,this.pluginOps=r}return Object.defineProperty(e.prototype,"type",{get:function(){return null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tileData",{get:function(){return null},set:function(e){},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tileDataIsVolatile",{get:function(){return!1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isError",{get:function(){return this._isError},set:function(e){this._isError=e,this.onErrorDelegate&&this.onErrorDelegate()},enumerable:!0,configurable:!0}),e.prototype.isDataStale=function(e){return!1},e.prototype.setDependencies=function(e){this.dataProxy=e},e.prototype.setDataLoadEventDelegate=function(e){this.dataLoadEventDelegate=e},e.prototype.copyDependencies=function(e){e.dataProxy&&this.setDependencies(e.dataProxy)},e})();r.CompositeTileModel=c,r.staleDataDeltaInMs=36e5;var l=(function(c){function l(e,t,r,o,i,a,n,s,l){var d=c.call(this,e,t,r)||this;return d.requiresResize=!1,d.geoLocationService=i,d.geocoder=a,d.featureSwitches=o,d.promiseFactory=n,d.moduleLoader=s,d.telemetryService=l,d._visual={hostServices:d.createHostServices(),themeCollection:{}},d}return __extends(l,c),Object.defineProperty(l.prototype,"type",{get:function(){return t.contracts.CompositeTileType.SingleVisual},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"visual",{get:function(){return this._visual},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"themeCollection",{get:function(){return this._visual&&this._visual.themeCollection},enumerable:!0,configurable:!0}),l.prototype.setThemeName=function(e){this.ensureVisual();var t=this._visual.themeCollection;(t.customTheme=t.customTheme||s.getThemeMetadata(e,1)).name=e},l.prototype.isDataStale=function(e){if(!e)return!1;var t=this.contract,o=n.convertRefreshTimeToJsDateTime(t.tileDataUpdatedTime),i=o&&o.getTime();return!!i&&e-i>r.staleDataDeltaInMs},l.prototype.setData=function(e,t,r){this.ensureVisual(),this._visual.data=e,this._visual.dataTransforms=t,this._visual.type=r},l.prototype.createHostServices=function(){var t=this;return e.Prototype.inherit(o(this.promiseFactory,this.moduleLoader,this.geoLocationService,this.geocoder),(function(r){r.authenticationService=function(){return e.visualHost.createCustomVisualsAuthenticationService(t.promiseFactory,t.telemetryService)},r.canExpandCollapse=function(){return!!t.featureSwitches.featureSwitches.expandCollapse}}))},l.prototype.ensureVisual=function(){this._visual||(this._visual={hostServices:this.createHostServices(),themeCollection:{}},this.calculateLayout())},Object.defineProperty(l.prototype,"config",{get:function(){return this._config},set:function(t){if(this._config=t,this._visual){var r=t.$visualContainer.config.singleVisual,o=r.visualType;this._visual.type=o;var a=e.data.DataViewObjectDefinitions.getValue(r.vcObjects,{objectName:"stylePreset",propertyName:"name"},void 0);this._visual.stylePresetName=a&&a.value,this._visual.themeCollection=_.cloneDeep(t.themeCollection);var n,s,c=this.visualPluginService.capabilities(o);c&&(n=c.objects,s=r.objects);var l=jsCommon.JsonExtensions.tryParseJSON(t.transform);l?this._visual.dataTransforms=i.deserializeDataViewTransformActions(l,n):this._visual.dataTransforms=i.createTransformActions(t.queryMetadata,t.elements,n,s)}},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"tileData",{get:function(){return this._tileData},set:function(e){this._tileData=e,this.readDataView(!0)},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"tileDataIsVolatile",{get:function(){return this.contract.tileDataIsVolatile},enumerable:!0,configurable:!0}),l.prototype.refreshData=function(){this.readDataView(!1)},l.prototype.setDependencies=function(e){var t=!this.dataProxy&&this._tileData&&!this.isLoading;c.prototype.setDependencies.call(this,e),t&&this.refreshData()},l.prototype.readDataView=function(r){return __awaiter(this,void 0,e.Promise,(function(){var o,i,a,n,s,c,l,d,p,u,h;return __generator(this,(function(f){switch(f.label){case 0:if(o=this._visual.type,i=e.visualHost.utils.shouldDisableVisual(o,e.common.localize.shouldDisableMap()),this.visual&&!this.requiresData()&&!i)return[2];if(a=this.dataProxy,!a)return[2];if(this.contract.queryResultError&&(n=t.TileUtils.getTileErrorDetailsFromQueryResultError(this.contract.queryResultError),n?(this.isError=!0,this.errorDetails=n,this.errorText=n.message):this.errorText=e.common.localize.get("Tile_ErrorText")),!this._tileData||!this._tileData.data)return this.isLoading=!this.isError,[2];s=this._tileData,c={type:s.type,query:{dataSources:null,command:s.data},allowCache:r,perfId:o,kinds:this.pluginOps.dataViewKinds(o)},l=null,this.dataLoadEventDelegate&&(l=this.dataLoadEventDelegate(),this.dataLoadEventDelegate=null),f.label=1;case 1:return f.trys.push([1,3,,4]),[4,a.execute(c)];case 2:return d=f.sent(),p={dataView:d&&d.dataReaderResult?d.dataReaderResult.dataView:null,dataViewSource:d&&d.dataViewSource?d.dataViewSource:null},u=d.dataReaderResult.error,i&&(u={code:"NotSupportedForLocale",debugInfo:"",getDetails:function(e){return{displayableErrorInfo:[{errorInfoKey:e.get("VisualContainer_NotSupportedForLocaleKey"),errorInfoValue:e.get("VisualContainer_NotSupportedForLocaleValue")}],message:e.get("VisualContainer_NotSupportedForLocaleMessage")}},ignorable:!1,requestId:""},this.errorDetails=u.getDetails(e.common.localize),this.errorText=this.errorDetails.message),this._visual.data=p,this.isError=this.isError||null!=u,l&&(this.isError?l.reject():l.resolve()),[3,4];case 3:return h=f.sent(),this.isError=!0,l&&l.reject(),[3,4];case 4:return[2]}}))}))},l.prototype.applyLayout=function(t){if(this.requiresResize){if(!this.featureSwitches.featureSwitches.skipVisualManualUpdate){var r=this.visual;if(r&&r.visual){var o=r.visual,i=t===a.changeType.resized?2:t===a.changeType.resizing?1:void 0;o.update({viewport:r.viewport,dataViews:r.dataViews,suppressAnimations:!0,type:e.VisualUpdateType.Resize,resizeMode:i})}}this.requiresResize=!1}},l.prototype.calculateLayout=function(t,o){if(t&&(this.viewport&&this.viewport.height===t.height&&this.viewport.width===t.width||(this.requiresResize=!0),this.viewport=t),null!=o&&this.useSmallPlotArea!==o&&(this.useSmallPlotArea=o,this.requiresResize=!0),this.viewport){var i=this.viewport.height,a=this.viewport.width;switch(this._config&&this._config.layoutType){case e.common.contracts.TileLayoutType.Full:break;default:i-=this.useSmallPlotArea?r.TileConstants.VisualSmallVerticalMargin:r.TileConstants.VisualVerticalMargin,a-=r.TileConstants.VisualHorizontalMargin}this._visual&&(this._visual.viewport={height:i,width:a,scale:1})}},l.prototype.canResizeTo=function(t){var r=this._visual&&this._visual.visual;return!!r&&(!r.canResizeTo||r.canResizeTo(e.common.GridLayoutConstants.getDefaultGridItemViewport(t)))},l.prototype.getErrorLocId=function(e,t){return""},l.prototype.requiresData=function(){var e=this.visual,t=this.pluginOps;if(e){if(e&&e.type){if(!t)return!0;if(!t.isQueryVisual(e.type))return!1}return!0}},l.prototype.updateVisualInteractivityOptions=function(e){var t=this.visualPluginService.getInteractivityOptions(this._visual.type);"undefined"!=typeof t.isInteractiveLegend&&(t.isInteractiveLegend=t.isInteractiveLegend&&e),this._visual.interactivityOptions=t},l})(c);r.SingleVisualCompositeTileModel=l})(r=t.models||(t.models={}))})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(e){this.tileModel=e}return Object.defineProperty(e.prototype,"isSelected",{get:function(){return this.tileModel.isSelected},set:function(e){this.tileModel.isSelected=e},enumerable:!0,configurable:!0}),e})();e.DashboardTileModel=t})(t=e.models||(e.models={}))})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){var r=(function(){function t(e){this.contract=e}return t.prototype.canResizeTo=function(t){return t.rowSpan===e.common.GridLayoutConstants.gridItemMediumLandscapeRowSpan||t.colSpan===e.common.GridLayoutConstants.gridItemSmallLandscapeColSpan},t.prototype.getErrorLocId=function(e,t){return""},t})();t.IframeTileModel=r})(r=t.models||(t.models={}))})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){var r=(function(){function t(e){this.contract=e}return Object.defineProperty(t.prototype,"imageUrl",{get:function(){return this._imageUrl},set:function(e){this._imageUrl=e,e&&!this.isStatic&&0!==e.indexOf("data:")&&(this._imageUrl=jsCommon.Utility.getAbsoluteUri(e))},enumerable:!0,configurable:!0}),t.prototype.canResizeTo=function(t){return t.rowSpan===e.common.GridLayoutConstants.gridItemMediumLandscapeRowSpan||t.colSpan===e.common.GridLayoutConstants.gridItemSmallLandscapeColSpan},t.prototype.getErrorLocId=function(e,t){return""},t})();t.ImageTileModel=r})(r=t.models||(t.models={}))})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){var r=(function(){function t(e){this.contract=e}return t.prototype.canResizeTo=function(t){return t.rowSpan===e.common.GridLayoutConstants.gridItemSmallLandscapeRowSpan},t.prototype.getErrorLocId=function(e,t){return""},t})();t.ModelTileModel=r})(r=t.models||(t.models={}))})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(r){var o=t.constants.SingleValueRealTimeWindow,i=e.data.EmptyDataClientError,a=e.data.FailedRealTimeUpdateClientError,n=(function(n){function s(e,t,r,o,i,a,s,c,l){var d=n.call(this,e,t,r,o,i,a,s,c,l)||this;return d._visual=null,d}return __extends(s,n),s.prototype.setModelId=function(e){this.contract.modelId=e,this.initialize()},Object.defineProperty(s.prototype,"realTimeModelId",{get:function(){var e=this.contract,t=this.modelService?this.modelService.findModel(e.modelId,e.packageId):null;return t&&t.contract?{id:t.id,originalModelId:t.contract.originalModelId,tableName:this.getSchemaTableName(),schema:this.getRealTimeConceptualSchema(),packageId:e.packageId}:null},enumerable:!0,configurable:!0}),s.prototype.setRealTimeModelDependencies=function(e,t,r,o,i){n.prototype.setDependencies.call(this,e),this.visualQueryGenerator=t,this.conceptualSchemaProxy=r,this.realTimeDataService=o,this.modelService=i},s.prototype.copyRealTimeModelDependencies=function(e){e.schema&&(this.schema=e.schema),e.dataProxy&&e.realTimeDataService&&e.visualQueryGenerator&&e.conceptualSchemaProxy&&(this.setRealTimeModelDependencies(e.dataProxy,e.visualQueryGenerator,e.conceptualSchemaProxy,e.realTimeDataService,e.modelService),e.onErrorDelegate&&!this.onErrorDelegate&&(this.onErrorDelegate=e.onErrorDelegate),this.realTimeDataService.replaceListener(e.realTimeModelId,e,this))},s.prototype.onDataChanged=function(){var t=this;if(this.singleVisualConfig){var r=o,a=this.config;a&&a.dataWindow&&(r=a.dataWindow);var n=this.visualQueryGenerator.execute({dataSources:this.datasources,schema:this.schema,config:this.singleVisualConfig,additionalFilters:null,dataWindow:r});if(!n||n.error){var s=void 0;n&&n.error&&(s=n.error.getDetails(e.common.localize)),this.onError(s)}else this.dataProxy.execute(n.options).then((function(e){t.isError=!1;var r={dataView:e&&e.dataReaderResult?e.dataReaderResult.dataView:null},o=t.lastCategoryValue;try{var i=t.getLastDateOrNumericCategoryValue(r.dataView);if(null!=o&&null!=i&&o.valueOf()>=i.valueOf())return;t.lastCategoryValue=i}catch(e){}t.setData(r,n.transforms,t.config.$visualContainer.config.singleVisual.visualType),t.isLoading=!1}),(function(r){if(!(r instanceof i)){var o=r&&r.getDetails(e.common.localize);t.onError(o)}}))}},s.prototype.onError=function(t){t||(t=(new a).getDetails(e.common.localize)),this.setErrorDetails(t)},Object.defineProperty(s.prototype,"datasources",{get:function(){var e=this.realTimeModelId;if(e)return r.RealTimeModelUtility.getRealTimeDataSource(e.id,e.originalModelId)},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"singleVisualConfig",{get:function(){return this.config.$visualContainer.config.singleVisual},set:function(e){this.config.$visualContainer.config.singleVisual=e,this.onDataChanged()},enumerable:!0,configurable:!0}),s.prototype.isDataStale=function(){return!1},s.prototype.initialize=function(){var e=this,r=t.ContractUtils.getMasterLayoutPosition(this.contract);this.size={rowSpan:r.height,colSpan:r.width};var o=this.datasources;o&&this.conceptualSchemaProxy.get(o).then((function(t){e.fixUpSchema(t),e.schema=t,e.realTimeDataService.subscribe(e.realTimeModelId,e)}))},s.prototype.unsubscribe=function(){this.realTimeModelId&&this.realTimeDataService.unsubscribe(this.realTimeModelId,this)},s.prototype.fixUpSchema=function(r){for(var o=r.schema(t.constants.RealTimeDataSourceName).entities,i=o[0].properties,a=0,n=i;a<n.length;a++){var s=n[a];s.type!==e.ValueType.fromDescriptor({numeric:!0})&&s.type!==e.ValueType.fromDescriptor({integer:!0})||(s.kind=1)}},s.prototype.getSchemaTableName=function(){var e=this.getRealTimeConceptualSchema();if(e){var t=e.entities;return _.head(t).name}},s.prototype.getRealTimeConceptualSchema=function(){if(this.schema)return this.schema.schema(t.constants.RealTimeDataSourceName)},s.prototype.setErrorDetails=function(e){this.errorDetails=e,this.errorText=e.message,this.isError=!0},s.prototype.getLastDateOrNumericCategoryValue=function(e){var t=e&&e.categorical;if(t){var r=_.head(t.categories),o=r&&r.values;if(!_.isEmpty(o)){var i=_.last(o);return i&&!_.isBoolean(i)&&(_.isDate(i)||_.isNumber(i))?i:void 0}}},s})(r.SingleVisualCompositeTileModel);r.RealTimeTileModel=n})(r=t.models||(t.models={}))})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(r){var o,i=r.RealTimeModel;!(function(r){function o(r,o){if(r&&!(r<0))return e.explore.contracts.createDataSourceArray([{id:r,type:e.data.tabular.type,name:t.constants.RealTimeDataSourceName,tabular:{modelId:null!=o?o:r}}])}function a(t){var r=e.data.tabular.getColumnsMetadata(t);if(r){for(var o=[],a=0,n=r;a<n.length;a++){var s=n[a];o.push({name:s.name,dataType:i.convertToRealTimeDataType(e.ValueType.fromDescriptor(s.type))})}return o}}r.getRealTimeDataSource=o,r.convertToColumnsDefinition=a})(o=r.RealTimeModelUtility||(r.RealTimeModelUtility={}))})(r=t.models||(t.models={}))})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){var r=(function(){function t(e){this.contract=e,this.exploration={contract:void 0,exploreCanvas:void 0,sections:[]},this.isError=!1,this.tilesUpdated=!1}return t.prototype.canResizeTo=function(t){return t.rowSpan===e.common.GridLayoutConstants.gridItemMediumLandscapeRowSpan||t.colSpan===e.common.GridLayoutConstants.gridItemSmallLandscapeColSpan},t.prototype.getErrorLocId=function(e,t){return""},t})();t.ReportTileModel=r})(r=t.models||(t.models={}))})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){var r=(function(){function t(e){this.contract=e}return Object.defineProperty(t.prototype,"imageUrl",{get:function(){return this._imageUrl},set:function(e){e&&(0!==e.indexOf("data:")?this._imageUrl=jsCommon.Utility.getAbsoluteUri(e):this._imageUrl=e)},enumerable:!0,configurable:!0}),t.prototype.canResizeTo=function(t){return t.rowSpan===e.common.GridLayoutConstants.gridItemLargeLandscapeRowSpan||t.colSpan===e.common.GridLayoutConstants.gridItemLargeLandscapeColSpan},t.prototype.getErrorLocId=function(e,t){return""},t})();t.SsrsTileModel=r})(r=t.models||(t.models={}))})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(r){function o(e){if(!(_.isEmpty(e)||e.length<r.DashboardIntraDomainNavigationPrefix.length)&&i(e))return e.substr(r.DashboardIntraDomainNavigationPrefix.length)}function i(e){return!_.isEmpty(e)&&0===e.toLowerCase().indexOf(r.DashboardIntraDomainNavigationPrefix)}function a(e){return!_.isEmpty(e)&&0===e.toLowerCase().indexOf(r.ReportIntraDomainNavigationPrefix)}function n(e){return!_.isEmpty(e)&&0===e.toLowerCase().indexOf(r.WorkbookIntraDomainNavigationPrefix)}function s(e){return i(e)||a(e)||n(e)}var c,l=jsCommon.ArrayExtensions,d=jsCommon.DateExtensions,p=e.common.utils.DateFormatter,u=e.common.helpers.ModelConverterHelper,h=jsCommon.UrlUtils;!(function(e){e[e.Dashboard=0]="Dashboard",e[e.Report=1]="Report"})(c=r.IntraDomainNavigationType||(r.IntraDomainNavigationType={})),r.getDashboardGuidFromUrl=o,r.IsDashboardIntraDomainPrefix=i,r.IsReportIntraDomainPrefix=a,r.IsWorkbookIntraDomainPrefix=n,r.IsValidIntraDomainPrefix=s,r.DashboardIntraDomainNavigationPrefix="/dashboards/",r.ReportIntraDomainNavigationPrefix="/reports/",r.WorkbookIntraDomainNavigationPrefix="/workbooks/";var f;!(function(e){e.SubtitleHeight=10,e.TileDefaultPadding=10,e.RegularHeaderHeight=50,e.SmallHeaderHeight=42,e.LargeHeaderHeight=65,e.VisualVerticalMargin=20,e.VisualHorizontalMargin=20,e.VisualSmallVerticalMargin=8})(f=r.TileConstants||(r.TileConstants={}));var v=(function(){function r(e,t){this.isSelected=!1,this.hasConversation=!1,this.hasSpotlight=!1,this.contract=e,this.tileHeaderSize=1,this.layoutPosition={},this.localizationService=t,this.themeName="Light",this.tileStyles={},this.tileHeaderStyles={},this.tileBackground={}}return Object.defineProperty(r.prototype,"gridLayouts",{get:function(){return this.contract.$layoutConfig.layouts},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"id",{get:function(){return this.contract.id},set:function(e){this.contract.id=e},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"objectId",{get:function(){return this.contract.objectId},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"details",{get:function(){switch(this.type){case t.contracts.TileType.composite:return this.composite;case t.contracts.TileType.iframe:return this.iframe;case t.contracts.TileType.image:return this.image;case t.contracts.TileType.model:return this.model;case t.contracts.TileType.ssrs:return this.ssrs;case t.contracts.TileType.workbook:return this.workbook;case t.contracts.TileType.report:return this.reportTile;case t.contracts.TileType.realTime:return this.realTime;default:return null}},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"shouldBeIncludedInTelemetryMeasurement",{get:function(){return this.details&&!!this.details.shouldBeIncludedInTelemetryMeasurement},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"isTemporary",{get:function(){return this.id<=0},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"isTileLoading",{get:function(){return this.composite?this.composite.isLoading&&!this.composite.isError:this.isLoading},enumerable:!0,configurable:!0}),r.prototype.calculateLayout=function(t){var r=this.getHeaderSizeByType(this.tileHeaderSize);if(this.compositeTile&&t){var o=t,i=2===this.tileHeaderSize;if(i)if(this.hasTitle())o.height-=r;else{var a=this.composite&&this.composite.config&&this.composite.config.layoutType;a!==e.common.contracts.TileLayoutType.Full&&(o.height-=f.TileDefaultPadding)}else this.hasTitle()&&(this.hasSubtitle()?o.height-=r:o.height-=r-f.SubtitleHeight);this.compositeTile.calculateLayout(o,i)}},r.prototype.applyLayout=function(e){this.compositeTile&&this.compositeTile.applyLayout(e)},r.prototype.invalidateLayout=function(){this.tryPopulateLayoutPositionValues()&&this.gridLayoutContext.onLayoutInvalidated()},r.prototype.tryPopulateLayoutPositionValues=function(){if(!this.gridLayoutContext||this.gridLayoutContext.isLayoutUpdateLocked)return!1;var e=this.gridLayoutContext.getActiveLayout(),t=l.extendWithId(this.contract.$layoutConfig.layouts),r=t.withId(e);return r&&r.position&&(this.layoutPosition=_.cloneDeep(r.position)),!0},r.prototype.applyChanges=function(){if(this.contract&&this.gridLayoutContext){var e=_.cloneDeep(this.layoutPosition),t=this.contract.$layoutConfig;this.addOrUpdateLayoutPosition(t,e),this.contract.layoutConfig=JSON.stringify(this.contract.$layoutConfig)}},r.isValidUrl=function(e,t){return!_.isEmpty(e)&&(h.isValidHttpUrl(e,!1)||t&&s(e))},r.prototype.getDisplayText=function(){if(this.displayText)return this.displayText;if(this.compositeTile){var e=this.compositeTile.config;if(e&&!_.isEmpty(e.heading1))return e.heading1}return""},r.prototype.getSubDisplayText=function(){if(this.displayText&&this.subDisplayText)return this.subDisplayText;if(this.compositeTile){var e=this.compositeTile.config;if(!this.displayText&&e&&!_.isEmpty(e.heading3))return e.heading3}return""},r.prototype.shouldPlaceBulletSeperator=function(){return this.displayText&&this.displayText.length>0&&this.subDisplayText&&this.subDisplayText.length>0&&this.config&&this.config.lastRefreshTimeEnabled},Object.defineProperty(r.prototype,"hrefTarget",{get:function(){return this.action.openInSameTab?"_self":"_blank"},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"lastRefreshTimeInLocaleString",{get:function(){var e=u.convertRefreshTimeToJsDateTime(this.contract.tileDataUpdatedTime);return e?e.toLocaleString():this.datasetModel?this.datasetModel.lastRefreshTimeInLocaleString:void 0},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"formattedTime",{get:function(){var e;if(this.workbook){var t=this.contract.tilePackage;e=t?u.convertRefreshTimeToJsDateTime(t.lastRefreshTime):null}else e=u.convertRefreshTimeToJsDateTime(this.contract.tileDataUpdatedTime);if(e){var r=m,o=d.isContainedInTimeFrame,i=d.isMomentPresent();return i&&o(e,r.Minute,r.MaxMinuteThreshold,!1)?p.getPrettyRelativeDate(e,this.localizationService):i&&o(e,r.Day,r.SameDayThreshold,!0)?d.GetTime(this.localizationService.currentLanguageLocale,e):i&&o(e,r.Day,r.YesterdayThreshold,!0)?this.localizationService.format("DashboardTile_YesterdayTemplate",[d.GetTime(this.localizationService.currentLanguageLocale,e)]):i&&o(e,r.Day,r.WeekThreshold,!0)?d.GetDayWithTime(this.localizationService.currentLanguageLocale,e):d.GetFullDateWithTime(this.localizationService.currentLanguageLocale,e)}if(this.datasetModel)return this.datasetModel.lastRefreshTimeInLocaleString},enumerable:!0,configurable:!0}),r.prototype.setDatasetModelAndPackageInfo=function(e,t){e&&(this.datasetModel=e,t&&(this.datasetModel.packagePublishStatus=t.publishOrRefreshStatus))},r.prototype.hasTitle=function(){if(this.config&&this.config.hideTitle)return!1;var e=this.compositeTile?this.compositeTile.config:null;return!_.isEmpty(this.displayText)||e&&!_.isEmpty(e.heading1)},r.prototype.hasSubtitle=function(){var e=this.config;return(!e||!e.hideTitle)&&(!_.isEmpty(this.subDisplayText)||e&&e.lastRefreshTimeEnabled)},r.prototype.lastRefreshTimeInLocaleWithLabel=function(){if(this.config&&this.config.lastRefreshTimeEnabled)return this.localizationService.format("DashboardTile_LastRefreshTimeTemplate",[this.formattedTime])},r.prototype.setTileHeaderSize=function(e){this.tileHeaderSize!==e&&(this.tileHeaderSize=e,this.invalidateLayout())},Object.defineProperty(r.prototype,"compositeTile",{get:function(){return this.composite||this.realTime},enumerable:!0,configurable:!0}),r.prototype.hasLayoutDefinition=function(e){return!!l.extendWithId(this.contract.$layoutConfig.layouts).withId(e)},r.prototype.hasLayoutPosition=function(e){return!!t.ContractUtils.getLayoutPosition(this.contract,e)},r.prototype.removeLayoutPosition=function(e){return void 0===e&&(e=1),this.hasLayoutDefinition(e)&&(this.addLayout({id:e,position:null},e),this.resetTileLayoutSizeAndPosition()),this.getCurrentTileLayoutDescriptor()},r.prototype.resetTileLayoutSizeAndPosition=function(){this.layoutPosition.x=null,this.layoutPosition.y=null,this.layoutPosition.height=null,this.layoutPosition.width=null,this.gridLayoutContext=null},r.prototype.removeLayoutDefinition=function(e,t){return void 0===e&&(e=1),void 0===t&&(t=!0),this.hasLayoutDefinition(e)&&(_.remove(this.contract.$layoutConfig.layouts,(function(t){return t.id===e})),t&&this.resetTileLayoutSizeAndPosition()),this.getCurrentTileLayoutDescriptor()},r.prototype.applyLayoutSize=function(e,t){this.compositeTile&&(this.compositeTile.size={colSpan:e.colSpan,rowSpan:e.rowSpan}),this.applyLayout(t)},r.prototype.getCurrentTileLayoutDescriptor=function(e,t){var r=e?e:this.contract.$layoutConfig;return{id:this.id,row:null,col:null,rowSpan:null,colSpan:null,layoutConfig:JSON.stringify(r),query:t?t[0]:null,updatedQuery:t?t[1]:null,modelId:this.contract.modelId}},r.prototype.buildLayoutDescriptor=function(){var e=_.cloneDeep(this.layoutPosition),t=_.cloneDeep(this.contract.$layoutConfig);this.addOrUpdateLayoutPosition(t,e);var r=this.updateTileQueryAfterResize(e);return this.getCurrentTileLayoutDescriptor(t,r)},r.prototype.updateTileQueryAfterResize=function(r){var o=this.composite&&this.composite.contract&&this.composite.contract.query;if(o){var i=t.ContractUtils.convertToTileDataQuery(o);if(!i)return;for(var a=_.cloneDeep(o),n=r.width*e.common.GridLayoutConstants.defaultGridWidth,s=r.height*e.common.GridLayoutConstants.defaultGridHeight,c=!1,l=0,d=i.Commands;l<d.length;l++){var p=d[l],u=p.ScriptVisualCommand;if(u){var h=u.ViewportWidthPx,f=u.ViewportHeightPx;h===n&&f===s||(u.ViewportWidthPx=n,u.ViewportHeightPx=s,p.ScriptVisualCommand=u,c=!0)}}if(c){this.composite.contract.query.modelQuery.sq=JSON.stringify(i);return[a,JSON.stringify(this.composite.contract.query)]}}},r.prototype.addOrUpdateLayoutPosition=function(e,t){var r=this.gridLayoutContext.getActiveLayout(),o=l.extendWithId(e.layouts),i=o.withId(r);i||(i={id:r,position:{}},o.push(i)),i.position=t},r.prototype.addLayout=function(e,t){return this.removeLayoutDefinition(t),this.contract.$layoutConfig.layouts.push(e),this.getCurrentTileLayoutDescriptor()},r.prototype.getHeaderSizeByType=function(e){switch(e){case 0:return f.LargeHeaderHeight;case 2:return f.SmallHeaderHeight;case 1:default:return f.RegularHeaderHeight}},r})();r.Tile=v;var m;!(function(e){e.Minute="minute",e.Day="day",e.MaxMinuteThreshold=15,e.SameDayThreshold=0,e.YesterdayThreshold=1,e.WeekThreshold=6})(m||(m={}))})(r=t.models||(t.models={}))})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){var r=(function(){function t(e,t){this.contract=e,this.tileModel=t}return t.prototype.canResizeTo=function(t){return t.rowSpan===e.common.GridLayoutConstants.gridItemMediumLandscapeRowSpan||t.colSpan===e.common.GridLayoutConstants.gridItemSmallLandscapeColSpan},t.prototype.getErrorLocId=function(e,t){var r,o=[];switch(e){case 10:r="WorkbookTile_GeneralError";break;case 11:r="WorkbookTile_FileNotFound";break;case 12:r="WorkbookTile_ObjectNotFound",o=this.contract.$config.workbookTile?[this.contract.$config.workbookTile.item]:["pinned object"];break;case 13:r="WorkbookTile_Unauthorized";break;default:return""}return t.format(r,o)},t.prototype.hasImages=function(){return this.hasWorkbookTileConfig&&this.tileModel.config.workbookTile.images&&this.tileModel.config.workbookTile.images.length>0},Object.defineProperty(t.prototype,"images",{get:function(){return this.hasWorkbookTileConfig?this.tileModel.config.workbookTile.images:null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasWorkbookTileConfig",{get:function(){return!!this.tileModel&&!!this.tileModel.config&&!!this.tileModel.config.workbookTile},enumerable:!0,configurable:!0}),t})();t.WorkbookTileModel=r})(r=t.models||(t.models={}))})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){function r(e,t,r){return new i(e,t,r)}var o=jsCommon.HttpConstants;t.createCdsaModelHttpService=r;var i=(function(){function t(e,t,r){this.syncService=e,this.httpService=t,this.featureSwitchService=r,this.baseUri="metadata/dataflows",this.requestTimeout=3e4}return t.prototype.updateExistingDataflowModel=function(e,t){var r=this.baseUri+"/build/update",o=this.httpService.powerbiRequestOptions(t,"createDataflowModelFromExistingModel");return this.httpService.post(r,e,o)},t.prototype.saveDataflowModel=function(t,r,o,i){var a=this.baseUri+"/"+r,n=this.httpService.powerbiRequestOptions(t,"saveDataflowModel");n.timeout=this.requestTimeout,this.syncService.addDashboardMetadataEditRequestId(n.headers[e.telemetryConstants.httpRequestIdHeader]);var s={model:o,modelVersion:i};return this.httpService.put(a,s,n)},t.prototype.getDataflowModelData=function(e,t){var r=this.baseUri+"/"+t,o=this.httpService.powerbiRequestOptions(e,"getDataflowModel");return o.timeout=this.requestTimeout,this.httpService.get(r,o)},t.prototype.refreshCdsaModel=function(e,t){var r=this.baseUri+"/"+e+"/refresh";if(this.featureSwitchService.featureSwitches.cdsaIncrementalRefreshUI){r=r+"?refreshTime="+encodeURIComponent(moment(new Date).format("YYYY-MM-DDTHH:mm:ssZ"))}var o=this.httpService.powerbiRequestOptions(t,"refreshCdsaModel");return this.httpService.post(r,null,o)},t.prototype.deleteCdsaModel=function(t,r){var o=this.baseUri+"/"+t.id,i=this.httpService.powerbiRequestOptions(r,"deleteCdsaModel");return this.syncService.addDashboardMetadataEditRequestId(i.headers[e.telemetryConstants.httpRequestIdHeader]),this.httpService.delete(o,i)},t.prototype.downloadCdsaModel=function(e,t){var r=this.baseUri+"/"+e+"/export",i=this.httpService.powerbiRequestOptions(t,"downloadCdsaModel");return i.responseType=o.JsonContentType,this.httpService.get(r,i)},t.prototype.getCdsaModel=function(e,t){var r=this.baseUri+"/"+e+"/info",o=this.httpService.powerbiRequestOptions(t,"getCdsaModel");return this.httpService.get(r,o);
},t.prototype.renameExternalDataflow=function(e,t,r,o){var i=this.baseUri+"/"+e+"/referenceMetadata",a=this.httpService.powerbiRequestOptions(o,"renameExternalDataflow");a.timeout=this.requestTimeout;var n={name:t,description:r};return this.httpService.put(i,n,a)},t})()})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){function r(e,t,r,o,i,a){return new s(e,t,r,o,i,a)}function o(t,r){var o="Unknown";if(t&&r)if(6===r)o="Excel Workbook";else if(7===r)o="Power BI Designer File";else if(17===r)o="OrgContent";else if(60===r)o="CSV File";else{var i=_.find(t,{id:r});i&&(o=i.clientCategory===e.common.contracts.ContentProviderClientCategory.Organizational?"OrgContent":i.displayText)}return o}var i=jsCommon.Utility,a=e.common.contracts.ContentProviderCategory,n=e.common.contracts.contentProviderManifest;t.createContentProviderHttpService=r,t.findContentProviderName=o;var s=(function(){function t(e,t,r,o,i,a){this.featureSwitchService=e,this.activeFolderIdService=t,this.telemetryService=r,this.promiseFactory=o,this.httpService=i,this.syncService=a}return t.prototype.getNonBuiltInContentProviders=function(e,t){return e.filter((function(e){return(e.category===a.Services||e.category===a.ServiceApp)&&(!e.featureSwitch||t&&e.featureSwitch===t)}))},t.prototype.getFilteredBuiltinContentProviders=function(e){return this.getBuiltInContentProviders().filter((function(t){return!_.some(e,(function(e){return t.displayText===e.displayText}))}))},t.prototype.getBuiltInContentProvidersAsync=function(r){return __awaiter(this,void 0,e.Promise,(function(){var o,i,n,s,c,l,d,p,u;return __generator(this,(function(h){switch(h.label){case 0:o=a[a.BuiltIn],i=this.telemetryService.startChildEvent(r,e.telemetry.ContentProviderHttpGetContentProviders,o),h.label=1;case 1:return h.trys.push([1,3,,4]),n=this.httpService.powerbiRequestOptions(r,"GetContentProviders"),s=t.powerBIContentProvidersEndpoint+"?category="+o,[4,this.httpService.get(s,n)];case 2:return c=h.sent(),i.resolve(),[2,c.data];case 3:return l=h.sent(),d=this.promiseFactory.defer(),p=e.errorDetailsHelper.getTelemetryErrorDetails(l.error),i.reject(p),u=this.getErrorCode(l),d.reject({errorCode:u,requestId:l.requestId,error:l.error}),[2,d.promise];case 4:return[2]}}))}))},t.prototype.getBuiltInContentProviders=function(){var t=this,r=n.filter((function(e){return!e.featureSwitch||e.featureSwitch&&t.featureSwitchService.featureSwitches[e.featureSwitch]}));return this.featureSwitchService.featureSwitches.builtInContentProvidersDisabled&&(r=r.filter((function(e){return e.category!==a.BuiltIn}))),r=this.activeFolderIdService.isInFolder?this.filterProvidersForFolder(r):r.filter((function(t){return t.id!==e.common.constants.groupOneDriveContentProviderId}))},t.prototype.getServiceAppContentProviders=function(e){var r=this.httpService.powerbiRequestOptions(e,"getServiceAppContentProviders"),o=t.powerBIContentProvidersEndpoint+"?owned=true&category=PowerBIServiceApp";return o=this.activeFolderIdService.appendFolderToQueryStringIfExists(o),this.httpService.get(o,r)},t.prototype.getContentProviders=function(e){var r=this.httpService.powerbiRequestOptions(e,"GetContentProviders"),o=t.powerBIContentProvidersEndpoint;this.featureSwitchService.featureSwitches.includeFlightingContentProviders&&(o+="?includeFlightedContentProviders=true");var i=this.activeFolderIdService.isInFolder,n=[a.OrganizationalApp,a.OrganizationalTemplateApp,a.ServiceApp];return this.httpService.get(o,r).then((function(e){return i&&(e.data=_.filter(e.data,(function(e){return!_.includes(n,e.category)}))),e}))},t.prototype.getTenantContentProviders=function(e){var r=this.httpService.powerbiRequestOptions(e,"GetTenantContentProviders"),o=t.powerBIContentProvidersEndpoint+"?category=OrganizationalTemplate&owned=true";return this.httpService.get(o,r)},t.prototype.getContentProvidersFromCluster=function(e,r){var o=this.httpService.powerbiRequestOptions(e,"GetContentProviders"),i=r+t.powerBIContentProvidersEndpoint;return this.featureSwitchService.featureSwitches.includeFlightingContentProviders&&(i+="?includeFlightedContentProviders=true"),this.httpService.get(i,o)},t.prototype.getOrganizationalContentProviders=function(e,r){var o,i=[a[a.Organizational],a[a.OrganizationalApp]];this.templateProvidersEnabled()&&i.push(a[a.OrganizationalTemplate],a[a.OrganizationalTemplateApp]),this.featureSwitchService.featureSwitches.insightApps&&i.push(a[a.PowerBIServiceApp]),o=t.powerBIContentProvidersEndpoint+"?category="+i.join(",")+"&owned=true";var n;_.isNumber(e)&&(o=o+"&folderId="+e,n={dismissGroupObjectId:!0});var s=this.httpService.powerbiRequestOptions(r,"GetContentProviders",n);return this.httpService.get(o,s)},t.prototype.getOrganizationalContentProviderById=function(e,t){return this.getContentProviderById(e,t,!1,!1)},t.prototype.getServiceContentProviderById=function(e,t){return this.getContentProviderById(e,t,!0,!1)},t.prototype.getNonInstantiatedOrganizationalContentProviderByProviderKey=function(e,t){return this.getContentProviderByProviderKey(e,t,!1,!0)},t.prototype.getConfiguration=function(r,o,a,n){e.contract.checkValue(r,"getConfiguration: contentProviderId"),e.contract.checkValue(o,"getConfiguration: type");var s=i.urlCombine(t.powerBIContentProvidersEndpoint,r+"/configuration");n&&(s=i.urlCombine(s,n.toString())),s=i.urlCombine(s,"?type="+o);var c=this.httpService.powerbiRequestOptions(a,"GetConfiguration");return this.httpService.get(s,c)},t.prototype.storeConfiguration=function(t,r,o,i){e.contract.checkValue(i.activeDashboardId,"storeConfiguration: dashboardId"),e.contract.checkValue(t,"storeConfiguration: contentProviderId"),e.contract.checkValue(r,"storeConfiguration: dataAccessInfo");var a=this.buildConfigurationUrl(t,i),n={dataAccessInfo:r},s=this.httpService.powerbiRequestOptions(o,"StoreConfiguration");return s.retryCount=0,i.ignoreSyncServiceUpdates&&this.syncService.addMetadataEditRequestId(s.headers[e.telemetryConstants.httpRequestIdHeader]),this.httpService.put(a,n,s)},t.prototype.getOrganizationalContentProviderMetadata=function(e,r){var o=this.httpService.powerbiRequestOptions(e,"getOrganizationalContentProviderMetadata"),i=t.metadataAppModelEndpoint+"contentprovidermetadata?id="+r;return this.httpService.get(i,o)},t.prototype.uninstallContentProvider=function(e,t,r){var o=this.httpService.powerbiRequestOptions(e,"UninstallApp"),i="/powerbi/content/providers/organization/"+t+"/?packageid="+r+"&uninstall=true";return this.httpService.delete(i,o)},t.prototype.getContentProviderByProviderKey=function(e,r,o,i){var a=this.httpService.powerbiRequestOptions(e,"GetContentProviderByProviderKey"),n=t.metadataAppModelEndpoint+"contentprovider?providerKey="+r;return o&&(n+="&isService=true"),i&&(n+="&includeNonInstantiated=true"),this.httpService.get(n,a)},t.prototype.getContentProviderById=function(e,r,o,i){var a=this.httpService.powerbiRequestOptions(e,"GetContentProviderById"),n=t.metadataAppModelEndpoint+"contentprovider?id="+r;return o&&(n+="&isService=true"),i&&(n+="&includeNonInstantiated=true"),this.httpService.get(n,a)},t.prototype.buildConfigurationUrl=function(e,r){var o=t.powerBIContentProvidersEndpoint,a=r.appsEnabled&&this.canUseAppConfiguration(e,r.category),n=a?"/appconfiguration":"/configuration";o=r.contentProviderKey?i.urlCombine(o,"/"+r.contentProviderKey+n):i.urlCombine(o,"/"+e.toString(10)+n);var s="?currentDashboardId="+r.activeDashboardId;return a&&this.isServiceApp(r.category)&&(s=s.concat("&installServiceContentAsApplication=true")),this.featureSwitchService.featureSwitches.workspacesV2&&r.folderId&&(s=s.concat("&folderId="+r.folderId)),o=i.urlCombine(o,s)},t.prototype.templateProvidersEnabled=function(){return this.featureSwitchService.featureSwitches.templatePublishEnabled||this.featureSwitchService.featureSwitches.templatePublishFlightingWorkAroundEnabled},t.prototype.canUseAppConfiguration=function(e,t){var r=this.featureSwitchService.featureSwitches;if(!e||null==t)return!1;switch(t){case a.OrganizationalTemplateApp:return r.appTemplatesEnabled;case a.ServiceApp:case a.Services:return r.serviceAppsEnabled;default:return!1}},t.prototype.isServiceApp=function(e){return e===a.ServiceApp||e===a.Services},t.prototype.getErrorCode=function(e){var t;return e&&(e.error?t=e.error.code:e.status&&(t=e.status.toString())),t},t.prototype.filterProvidersForFolder=function(t){var r,o=this.activeFolderIdService;if(o.folderObjectIdToNumericIdMapping[o.activeFolderObjectId])r=t.filter((function(t){return t.id!==e.common.constants.groupOneDriveContentProviderId&&t.id!==e.common.constants.personalOneDriveContentProviderId}));else{r=[];for(var i=0,a=t;i<a.length;i++){var n=a[i];n.id!==e.common.constants.oneDriveProContentProviderId&&n.id!==e.common.constants.personalOneDriveContentProviderId&&r.push(n),n.id===e.common.constants.groupOneDriveContentProviderId&&(n.displayText="OneDrive - "+o.folderDisplayName)}}return r},t.powerBIContentProvidersEndpoint="/powerbi/content/providers/",t.metadataAppModelEndpoint="/metadata/appmodel/",t})()})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){function t(e){var t=i.tryParseJSON(e.layoutConfig),r=o.extendWithId(t.layouts).withId(0);e.col=r.position.x,e.row=r.position.y,e.colSpan=r.position.width,e.rowSpan=r.position.height}function r(e){for(var t=0,r=e;t<r.length;t++){var a=r[t],n=i.tryParseJSON(a.layoutConfig),s=o.extendWithId(n.layouts).withId(0);a.col=s.position.x,a.row=s.position.y,a.colSpan=s.position.width,a.rowSpan=s.position.height}}var o=jsCommon.ArrayExtensions,i=jsCommon.JsonExtensions;e.conformOutgoingTile=t,e.conformOutgoingTileLayoutDescriptors=r})(t=e.compatibility||(e.compatibility={}))})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){function r(e,t,r,o,i,a,n,c){return new s(e,t,r,o,i,a,n,c)}var o=jsCommon.GzipUtility,i=t.models.TileFactory,a=jsCommon.QueryStringUtil;t.createDashboardHttpService=r;var n=1048576,s=(function(){function r(e,t,r,o,i,a,n,s){this.syncService=e,this.promiseFactory=t,this.notificationToastService=r,this.explorationSerializer=o,this.featureSwitchService=i,this.visualPlugin=a,this.httpThrottler=n,this.httpService=s,this.batchedDashboardRequests=[]}return r.prototype.getDashboardContainer=function(e){var t=this.httpService.powerbiRequestOptions(e,"GetDashboardContainer");return this.httpService.get("powerbi/metadata/dashboards",t)},r.prototype.getDashboards=function(e,t,r,o,i){return this.getDashboardsInternal(e,t,r,o,void 0,i)},r.prototype.getDashboardContainerByObjectId=function(e,t){var r=this.httpService.powerbiRequestOptions(t,"GetDashboardByObjectId"),o=this.getDashboardContainerByObjectIdUrl(e);return this.httpService.get(o,r)},r.prototype.batchGetDashboards=function(e,t,r){var o=this.httpService.powerbiRequestOptions(r,"GetDashboardsByIds");return o.enableTelemetry=!0,this.httpService.post("powerbi/metadata/getDashboardsByIds",JSON.stringify(t),o)},r.prototype.getDashboardMetadata=function(e,t,r){var o=this.httpService.powerbiRequestOptions(r,"GetDashboardMetadata");return o.enableTelemetry=!0,this.httpService.get("powerbi/metadata/dashboards/"+t+"/metadata",o)},r.prototype.getDashboardUrl=function(e,t){return"powerbi/metadata/dashboards/"+e+"?preferReadOnlySession="+t},r.prototype.getDashboardContainerByObjectIdUrl=function(e){return"metadata/embed/dashboard/"+e},r.prototype.addDashboard=function(t,r){var o=this.httpService.powerbiRequestOptions(r,"AddDashboard");this.syncService.addDashboardMetadataEditRequestId(o.headers[e.telemetryConstants.httpRequestIdHeader]);var i={displayName:t.displayName},n="powerbi/metadata/dashboards";return t.folderId&&(n=a.addOrUpdateQueryStringToUrl(n,{folderId:t.folderId.toString()})),o.enableTelemetry=!0,this.httpService.put(n,i,o)},r.prototype.renameDashboard=function(r,o,i){t.DashboardUtils.isWriteable(r)||this.notifyReadOnly(r.id);var a=this.httpService.powerbiRequestOptions(i,"RenameDashboard");return this.syncService.addDashboardMetadataEditRequestId(a.headers[e.telemetryConstants.httpRequestIdHeader]),a.enableTelemetry=!0,this.httpService.post("powerbi/metadata/dashboards/"+r.id+"/name",JSON.stringify(o),a)},r.prototype.duplicateDashboard=function(r,o,i){t.DashboardUtils.isWriteable(r)||this.notifyReadOnly(r.id);var a=this.httpService.powerbiRequestOptions(i,"DuplicateDashboard");return this.syncService.addDashboardMetadataEditRequestId(a.headers[e.telemetryConstants.httpRequestIdHeader]),a.enableTelemetry=!0,this.httpService.post("powerbi/metadata/dashboards/"+r.id+"/copy",JSON.stringify(o),a)},r.prototype.setQnaEnabledForDashboard=function(t,r,o){var i=this.httpService.powerbiRequestOptions(o,"SetQnaEnabled");return this.syncService.addDashboardMetadataEditRequestId(i.headers[e.telemetryConstants.httpRequestIdHeader]),i.enableTelemetry=!0,this.httpService.post("powerbi/metadata/dashboards/"+t+"/qnaEnabled",JSON.stringify(r),i)},r.prototype.deleteDashboard=function(r,o){t.DashboardUtils.isWriteable(r)||this.notifyReadOnly(r.id);var i=this.httpService.powerbiRequestOptions(o,"DeleteDashboard");this.syncService.addDashboardMetadataEditRequestId(i.headers[e.telemetryConstants.httpRequestIdHeader]),i.enableTelemetry=!0;var a="powerbi/metadata/dashboards/"+r.id;return this.httpService.delete(a,i)},r.prototype.exportDashboard=function(r,o,i){if(!t.DashboardUtils.isWriteable(r))return this.notificationToastService.notify({title:e.common.localize.get("Warning_Title"),message:e.common.localize.get("DashboardReadOnlyExportWarning_Message"),notificationType:1}),null;var a=this.httpService.powerbiRequestOptions(i,"ExportDashboard");return a.responseType="blob",a.enableTelemetry=!0,this.httpService.get("powerbi/resource/packages/"+r.id+"/?packageType="+o,a)},r.prototype.addTile=function(r,a,s,c,l){if(!t.DashboardUtils.isWriteable(r))return this.httpService.getResolvedHttpChain();var d=this.httpService.powerbiRequestOptions(l);this.syncService.addDashboardMetadataEditRequestId(d.headers[e.telemetryConstants.httpRequestIdHeader]);var p={id:0,type:a.type,config:i.serializeTileConfig(a.$config,this.explorationSerializer,this.visualPlugin,this.featureSwitchService.featureSwitches.visualContainerTileConfig),displayText:a.displayText,subDisplayText:a.subDisplayText,name:a.name,action:a.action,image:a.image,query:a.query,tileDataBinaryBase64Encoded:o.compress(a.tileData),layoutConfig:a.layoutConfig,publishState:a.publishState,resourcePackageIds:a.resourcePackageIds};return p.modelId=a.modelId,p.reportId=a.reportId,p.workbookId=a.workbookId,p.sectionId=a.sectionId,"number"==typeof a.packageId&&(p.packageId=a.packageId),t.compatibility.conformOutgoingTile(p),JSON.stringify(p).length>n?this.promiseFactory.reject({data:p,headers:function(){return null},status:413,error:{code:"AddTileRequestTooLarge","pbi.error":{code:"AddTileRequestTooLarge",parameters:[],details:[],exceptionCulprit:1}}}):(d.telemetryDescription="AddTile",d.enableTelemetry=!0,this.httpService.put("powerbi/metadata/tiles/"+r.id,p,d))},r.prototype.updateTile=function(t,r,o){var i,a={};return _.isEqual(t.displayText,r.displayText)||(a.displayText=r.displayText),_.isEqual(t.subDisplayText,r.subDisplayText)||(a.subDisplayText=r.subDisplayText),_.isEqual(t.action,r.action)||(a.action=r.action),_.isEqual(t.config,r.config)||(a.config=r.config),_.isEqual(t.query,r.query)||(a.query=r.query),_.isEqual(t.tileData,r.tileData)||(a.tileDataBinaryBase64Encoded=jsCommon.GzipUtility.compress(r.tileData)),i=this.httpService.powerbiRequestOptions(o,"UpdateTile"),i.enableTelemetry=!0,this.syncService.addDashboardMetadataEditRequestId(i.headers[e.telemetryConstants.httpRequestIdHeader]),this.httpService.patch("powerbi/metadata/tiles/"+t.id,JSON.stringify(a),i)},r.prototype.deleteTile=function(r,o,i){t.DashboardUtils.isWriteable(r)||this.notifyReadOnly(r.id);var a=this.httpService.powerbiRequestOptions(i,"DeleteTile");return this.syncService.addDashboardMetadataEditRequestId(a.headers[e.telemetryConstants.httpRequestIdHeader]),a.enableTelemetry=!0,this.httpService.delete("powerbi/metadata/tiles/"+o,a)},r.prototype.getTile=function(e,t){var r=this.httpService.powerbiRequestOptions(t,"GetTile");return r.enableTelemetry=!0,this.httpService.get("powerbi/metadata/tiles/"+e,r)},r.prototype.getTileEmbed=function(e,t,r,o){var i=this.httpService.powerbiRequestOptions(r,"GetTile");i.enableTelemetry=!0;var a="metadata/dashboards/"+t+"/tiles/"+e;return o&&(a+="/?$filter="+encodeURIComponent(o)),this.httpService.get(a,i)},r.prototype.batchGetTiles=function(e,t,r,o){var i=this,a="BatchGetTiles",n=this.httpService.powerbiRequestOptions(r,a);n.enableTelemetry=!0;var s=function(){return i.httpService.post("powerbi/metadata/dashboard/"+e+"/tiles",JSON.stringify(t),n)};if(o){var c=_.join(t,",");return this.httpThrottler.debounce(a,"d:"+e+",t:"+c,s)}return s()},r.prototype.renameTile=function(t,r,o,i){var a=this.httpService.powerbiRequestOptions(i,"RenameTile");this.syncService.addDashboardMetadataEditRequestId(a.headers[e.telemetryConstants.httpRequestIdHeader]);var n={id:t,displayText:r,subDisplayText:o};return a.enableTelemetry=!0,this.httpService.post("powerbi/metadata/tiles/"+t+"/displayText",JSON.stringify(n),a)},r.prototype.getTileShortUrl=function(e,t,r){var o=this.httpService.powerbiRequestOptions(r,"GetTileShortUrl");return o.enableTelemetry=!0,this.httpService.get("metadata/dashboards/"+e+"/tiles/"+t+"/shortUrl",o)},r.prototype.batchUpdateTileSizePosition=function(e,r,o,i){if(t.compatibility.conformOutgoingTileLayoutDescriptors(o),!t.DashboardUtils.isWriteable(r))return this.isDashboardBatchTilePositionUpgrade(r,o)||this.notifyReadOnly(r.id),null;var a=o.filter((function(e){return!!e.updatedQuery})),n=o.filter((function(e){return!e.updatedQuery})),s=this.batchUpdateTileSizePositionInternal(r,n,i,!0),c=this.batchUpdateTileSizePositionInternal(r,a,i,!1),l=[];return s&&l.push(s),c&&l.push(c),e.allSettled(l)},r.prototype.batchUpdateTileSizePositionInternal=function(t,r,o,i){if(void 0===i&&(i=!0),r&&0!==r.length){var a=this.httpService.powerbiRequestOptions(o,"SetTileSizePosition"),n=a.headers[e.telemetryConstants.httpRequestIdHeader];return i?this.syncService.addDashboardMetadataEditRequestId(n):this.syncService.addDashboardTransactionFilter(n,(function(t){return t.changeType!==e.common.contracts.MetadataChangeType.TileDataChange})),a.enableTelemetry=!0,this.httpService.post("/powerbi/metadata/dashboard/"+t.id+"/tiles/sizeandposition",r,a)}},r.prototype.isDashboardBatchTilePositionUpgrade=function(t,r){for(var o={},i=t.tiles,a=0,n=i.length;a<n;++a){var s=i[a];o[s.id]=s}for(var a=0,n=r.length;a<n;++a){var c=r[a],s=o[c.id];if(s&&s.row>e.common.constants.contractRowProtocolThreshold)return!0}return!1},r.prototype.setActiveDashboardId=function(e,t,r){var o=this.httpService.powerbiRequestOptions(r,"SetActiveDashboard");o.enableTelemetry=!0;var i=null;return t&&t.length>0&&(i=JSON.stringify(t)),this.httpService.post("/powerbi/metadata/user/activedashboard/"+e,i,o)},r.prototype.refreshTileData=function(e,t,r,o){var i=this.httpService.powerbiRequestOptions(r,"SetActiveDashboard",o);i.enableTelemetry=!0,t=_.uniq(t);var a=null;return t&&t.length>0&&(a=JSON.stringify(t)),this.httpService.post("/powerbi/metadata/user/activedashboard/"+e+"/refresh",a,i)},r.prototype.notifyReadOnly=function(t,r){var o="NotifiedReadOnlyDashboard"+t;(r||!e.common.sessionStorageService.getData(o))&&(this.notificationToastService.notify({title:e.common.localize.get("Warning_Title"),message:e.common.localize.get("DashboardReadOnlyWarning_Message"),notificationType:1}),e.common.sessionStorageService.setData(o,!0))},r.prototype.addDashboardRequestToBatch=function(t,r,o,i){for(var a=this.batchedDashboardRequests,n=0,s=a.length;n<s;++n){var c=a[n];if(c.dashboardId===r&&c.requestType===i)return c.deferred.promise()}var l=$.Deferred(),d={dashboardId:r,deferred:l,requestType:i};return a.push(d),void 0===d.requestType||null===d.requestType||d.requestType===e.common.DashboardRequestType.Default?this.getDashboards(t,[r],o,void 0).then((function(e){return e&&e.length>0?l.resolve(e[0].data):l.reject()}),(function(){l.reject()})):d.requestType===e.common.DashboardRequestType.Metadata&&this.getDashboardMetadata(t,r,void 0).then((function(e){return e?l.resolve(e.data):l.reject()}),(function(){l.reject()})),l.promise()},r.prototype.getDashboardsInternal=function(e,t,r,o,i,a){var n=this;if(_.isEmpty(t))return null;i=i||e.defer();var s=a?{groupObjectIdOverride:a}:void 0;return this.httpService.getAll(t.map((function(e){return n.getDashboardUrl(e,r)})),t.map((function(){var e=n.httpService.powerbiRequestOptions(o,"GetDashboard",s);return e.enableTelemetry=!0,e}))).then((function(e){i.resolve(e)}),(function(t){for(var a=[],s=[],c=0,l=t.length;c<l;c++){var d=t[c];200===d.status?a.push(d):s.push(d)}var p=!!s.length;a.length?(i.resolve(a),p&&n.getDashboardsInternal(e,s.map((function(e){return e.data.dashboards[0].id})),r,o,i)):i.reject(s)})),i.promise},r.prototype.updateDashboardSetting=function(t,r,o){var i=this.httpService.powerbiRequestOptions(o,"UpdateDashboardSetting");return this.syncService.addDashboardMetadataEditRequestId(i.headers[e.telemetryConstants.httpRequestIdHeader]),i.enableTelemetry=!0,this.httpService.post("powerbi/metadata/dashboards/"+t+"/settings",JSON.stringify(r),i)},r})()})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){function r(t,r,i){return e.dataServices.modelHttpService=new o(t,r,i),e.dataServices.modelHttpService}t.createModelHttpService=r;var o=(function(){function t(e,t,r){this.syncService=e,this.httpThrottler=t,this.httpService=r}return t.prototype.getModels=function(e){var t=this.httpService.powerbiRequestOptions(e,"GetModels");return this.httpService.get("powerbi/metadata/models",t)},t.prototype.getModel=function(e,t,r,o){var i=this,a=this.httpService.powerbiRequestOptions(r,"GetModel"),n=function(){return t?i.httpService.get("powerbi/metadata/models/"+e+"/?modelOptions=Default&packageId="+t,a):i.httpService.get("powerbi/metadata/models/"+e+"/?modelOptions=Default",a)};return o?this.httpThrottler.debounce("GetModel","p:"+t+",m:"+e,n):n()},t.prototype.getModelForRefresh=function(e,t,r){var o=this.httpService.powerbiRequestOptions(r,"GetModelForRefresh");return t?this.httpService.get("powerbi/metadata/models/"+e+"/?modelOption=Refresh&packageId="+t,o):this.httpService.get("powerbi/metadata/models/"+e+"/?modelOption=Refresh",o)},t.prototype.getModelAndPackageForRefresh=function(t,r,o){var i=this.httpService.powerbiRequestOptions(o,"GetModelAndPackageForRefresh");return this.syncService.addDashboardMetadataEditRequestId(i.headers[e.telemetryConstants.httpRequestIdHeader]),this.httpService.get("powerbi/metadata/models/"+t+"/?modelOption=PackageModelRefresh&packageId="+r,i)},t.prototype.renameModel=function(t,r,o){var i=this.httpService.powerbiRequestOptions(o,"RenameModel");return this.syncService.addDashboardMetadataEditRequestId(i.headers[e.telemetryConstants.httpRequestIdHeader]),this.httpService.post("powerbi/metadata/models/"+t.id+"/name",JSON.stringify(r),i)},t.prototype.deleteModel=function(e,t){var r=this.httpService.powerbiRequestOptions(t,"DeleteModel");return this.httpService.delete("powerbi/content/models/"+e.id+"/?packageId="+e.packageId,r)},t.prototype.getPackageModels=function(e,t){var r=this.httpService.powerbiRequestOptions(t,"GetPackageModels");return this.httpService.get("powerbi/metadata/packages/"+e+"/models",r)},t.prototype.getModelRefreshHistories=function(e,t){var r=this.httpService.powerbiRequestOptions(t,"GetModelRefreshHistories");return this.httpService.get("powerbi/metadata/models/"+e+"/refreshhistories",r)},t.prototype.getPackageRefreshHistories=function(e,t){var r=this.httpService.powerbiRequestOptions(t,"GetPackageRefreshHistories");return this.httpService.get("powerbi/metadata/packages/"+e+"/refreshhistories",r)},t.prototype.updateFeaturedQuestions=function(e,t,r){var o=this.httpService.powerbiRequestOptions(r,"UpdateFeaturedQuestions");return this.httpService.put("powerbi/metadata/models/"+e+"/featuredQuestions",JSON.stringify(t),o)},t.prototype.disableRlsModel=function(e,t){var r=this.httpService.powerbiRequestOptions(t,"DisableRlsModel");return this.httpService.post("metadata/model/"+e+"/rlsdisabled",JSON.stringify(!1),r)},t.prototype.updateModelQnaFeatures=function(e,t,r){var o=this.httpService.powerbiRequestOptions(r,"UpdateModelQnaFeatures");return this.httpService.post("powerbi/metadata/models/"+e+"/qnafeatures",JSON.stringify(t),o)},t.prototype.updateModelCaching=function(t,r,o){var i=e.common.httpService.powerbiRequestOptions(o,"UpdateModelCaching");return e.common.httpService.post("powerbi/metadata/models/"+t+"/caching",JSON.stringify(r),i)},t.prototype.getSharedDatasets=function(e){var t=this.httpService.powerbiRequestOptions(e,"GetSharedDatasets");return this.httpService.get("metadata/gallery/SharedDatasets",t)},t})()})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){function t(e){return new r(e)}e.createPackageHttpService=t;var r=(function(){function e(e){this.httpService=e}return e.prototype.getPackage=function(e,t){var r=this.httpService.powerbiRequestOptions(t,"GetPackage");return this.httpService.get("powerbi/metadata/packages/"+e,r)},e})()})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){function r(e,t){return new o(e,t)}t.createReportHttpService=r;var o=(function(){function t(e,t){this.httpService=e,this.syncService=t}return t.prototype.getReports=function(e){var t=this.httpService.powerbiRequestOptions(e,"GetReports");return this.httpService.get("powerbi/metadata/reports",t)},t.prototype.getReport=function(e,t){var r=this.httpService.powerbiRequestOptions(t,"GetReport");return this.httpService.get("powerbi/metadata/reports/"+e,r)},t.prototype.renameReport=function(t,r,o){var i=this.httpService.powerbiRequestOptions(o,"RenameReport");return this.syncService.addDashboardMetadataEditRequestId(i.headers[e.telemetryConstants.httpRequestIdHeader]),this.httpService.post("powerbi/metadata/reports/"+t.id+"/name",JSON.stringify(r),i)},t.prototype.deleteReport=function(e,t){var r=this.httpService.powerbiRequestOptions(t,"DeleteReport");return this.httpService.delete("powerbi/content/reports/"+e.id+"/",r)},t.prototype.getReportShortUrl=function(e,t,r){var o=this.httpService.powerbiRequestOptions(r,"GetReportShortUrl");o.enableTelemetry=!0;var i="metadata/reports/"+e+"/shortUrl";return null!=t&&t.trim().length>0&&(i=i+"?reportPage="+t),this.httpService.get(i,o)},t.prototype.updateArtifactVisibility=function(e,t,r,o){var i=this.httpService.powerbiRequestOptions(o,"updateArtifactVisibility");return this.httpService.put("metadata/workspaceartifact/"+e+"/"+t+"/isVisible",r,i)},t})()})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){function t(e){return new r(e)}e.createSmartAlertsHttpService=t;var r=(function(){function e(e){this.httpService=e,this.endpoint="metadata/smartalerts"}return e.prototype.onDemandSmartAlerts=function(e,t){var r=this.httpService.powerbiRequestOptions(t,"onDemandSmartAlerts");return this.httpService.post(this.endpoint,JSON.stringify(e),r)},e})()})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){function r(e,t,r){return new a(e,t,r)}var o=jsCommon.StringExtensions,i="EmailSubscriptionLicensingCheckFailed";t.createSubscriptionsHttpService=r;var a=(function(){function t(e,t,r){this.httpService=e,this.promiseFactory=t,this.telemetryService=r,this.endpoint="metadata/emailsubscriptions"}return t.prototype.createSubscription=function(t,r){var o=this,i=this.promiseFactory.defer(),a=this.telemetryService.startChildEvent(r,e.telemetry.EmailSubscriptionsRequest,"Create");return this.httpService.post(this.endpoint,t,this.httpService.powerbiRequestOptions()).then((function(e){a.resolve(),i.resolve(e.data)}),(function(r){var n=e.errorDetailsHelper.getTelemetryErrorDetails(r.error);a.reject(n);var s=e.errorDetailsHelper.getErrorCode(r),c=o.getPBIErrorDetails(r);i.reject({ErrorCode:s,RequestId:r.requestId,PBIErrorDetails:c,SubscriptionObjectId:t.objectId})})),i.promise},t.prototype.sendReportInstantEmail=function(t,r){return __awaiter(this,void 0,e.Promise,(function(){var o,i,a,n,s,c,l;return __generator(this,(function(d){switch(d.label){case 0:o=this.promiseFactory.defer(),i=this.telemetryService.startChildEvent(r,e.telemetry.InstantEmailRequest),a=this.endpoint+"/instant",d.label=1;case 1:return d.trys.push([1,3,,4]),[4,this.httpService.post(a,t,this.httpService.powerbiRequestOptions())];case 2:return n=d.sent(),i.resolve(),o.resolve(n.data),[3,4];case 3:return s=d.sent(),c=e.errorDetailsHelper.getTelemetryErrorDetails(s.error),i.reject(c),l=e.errorDetailsHelper.getErrorCode(s),o.reject({ErrorCode:l,RequestId:s.requestId}),[3,4];case 4:return[2,o.promise]}}))}))},t.prototype.getAllSubscriptions=function(t){var r=this.promiseFactory.defer(),o=this.telemetryService.startChildEvent(t,e.telemetry.EmailSubscriptionsRequest,"Get");return this.httpService.get(this.endpoint,this.httpService.powerbiRequestOptions()).then((function(e){o.resolve(),r.resolve(e.data)}),(function(t){var i=e.errorDetailsHelper.getTelemetryErrorDetails(t.error);o.reject(i);var a=e.errorDetailsHelper.getErrorCode(t);r.reject({ErrorCode:a,RequestId:t.requestId})})),r.promise},t.prototype.updateSubscription=function(t,r){var o=this,i=this.promiseFactory.defer(),a=this.telemetryService.startChildEvent(r,e.telemetry.EmailSubscriptionsRequest,"Update");return this.httpService.put(this.endpoint,t,this.httpService.powerbiRequestOptions()).then((function(e){a.resolve(),i.resolve(e.data)}),(function(r){var n=e.errorDetailsHelper.getTelemetryErrorDetails(r.error);a.reject(n);var s=e.errorDetailsHelper.getErrorCode(r),c=o.getPBIErrorDetails(r);i.reject({ErrorCode:s,RequestId:r.requestId,PBIErrorDetails:c,SubscriptionObjectId:t.objectId})})),i.promise},t.prototype.deleteSubscription=function(t,r){var i=this.promiseFactory.defer(),a=this.telemetryService.startChildEvent(r,e.telemetry.EmailSubscriptionsRequest,"Delete"),n=this.endpoint+"/{0}";return this.httpService.delete(o.format(n,t.toString()),this.httpService.powerbiRequestOptions()).then((function(e){a.resolve(),i.resolve(e.data)}),(function(t){var r=e.errorDetailsHelper.getTelemetryErrorDetails(t.error);a.reject(r);var o=e.errorDetailsHelper.getErrorCode(t);i.reject({ErrorCode:o,RequestId:t.requestId})})),i.promise},t.prototype.getReportSubscription=function(t,r){var i=this.promiseFactory.defer(),a=this.telemetryService.startChildEvent(r,e.telemetry.EmailSubscriptionsRequest,"Get");return this.httpService.get(o.format("metadata/emailsubscriptions/report/{0}",t.toString()),this.httpService.powerbiRequestOptions()).then((function(e){a.resolve(),i.resolve(e.data)}),(function(t){var r=e.errorDetailsHelper.getTelemetryErrorDetails(t.error);a.reject(r);var o=e.errorDetailsHelper.getErrorCode(t);i.reject({ErrorCode:o,RequestId:t.requestId})})),i.promise},t.prototype.getDashboardSubscription=function(t,r){return __awaiter(this,void 0,e.Promise,(function(){var i,a,n,s,c,l,d;return __generator(this,(function(p){switch(p.label){case 0:i=this.promiseFactory.defer(),a="metadata/emailsubscriptions/dashboard/{0}",n=this.telemetryService.startChildEvent(r,e.telemetry.EmailSubscriptionsRequest,"Get"),p.label=1;case 1:return p.trys.push([1,3,,4]),[4,this.httpService.get(o.format(a,t.toString()),this.httpService.powerbiRequestOptions())];case 2:return s=p.sent(),n.resolve(),i.resolve(s.data),[3,4];case 3:return c=p.sent(),l=e.errorDetailsHelper.getTelemetryErrorDetails(c.error),n.reject(l),d=e.errorDetailsHelper.getErrorCode(c),i.reject({ErrorCode:d,RequestId:c.requestId}),[3,4];case 4:return[2,i.promise]}}))}))},t.prototype.getPBIErrorDetails=function(e){var t="";if(e&&e.error){e.error.code===i&&(t=e.error["pbi.error"].details[0].detail.value)}return t},t;
})()})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){function r(e){return new a(e)}var o,i=jsCommon.QueryStringUtil;!(function(e){e[e.Changed=0]="Changed",e[e.Unchanged=1]="Unchanged",e[e.Error=2]="Error"})(o=t.SetKeyResult||(t.SetKeyResult={})),t.createTutorialDataStoreService=r;var a=(function(){function t(t,r){this.httpService=t,this.promiseFactory=r||e.createJQueryPromiseFactory(),this.loadedDeferred=this.promiseFactory.defer()}return t.prototype.setJsonData=function(e){if(!i.getQueryStringValue(t.IgnoreQueryParam)){if(this.store={},!i.getQueryStringValue(t.ShowAllQueryParam))try{_.extend(this.store,JSON.parse(e))}catch(e){}this.loadedDeferred.resolve({})}},t.prototype.onReady=function(e){this.store?e():this.loadedDeferred.promise.then((function(){return e()}))},t.prototype.hasKey=function(e){return!!this.store&&(this.store.hasOwnProperty(e)&&this.store[e])},t.prototype.getKey=function(e){return this.store?this.store[e]:null},t.prototype.setKey=function(r,a,n){var s=this;if(!this.store)return this.promiseFactory.reject(o.Error);var c=this.store[r];if(this.store[r]=a,c===a)return this.promiseFactory.resolve(o.Unchanged);if(!i.getQueryStringValue(t.ShowAllQueryParam)){var l=this.httpService.powerbiRequestOptions(n.event,"SetGettingStartedStatus",{dismissGroupObjectId:!0}),d=JSON.stringify(JSON.stringify(this.store));return this.httpService.post(t.ServerURL,d,l).then((function(){return n.resolve(),s.promiseFactory.resolve(o.Changed)}),(function(t){return n.reject(e.errorDetailsHelper.getTelemetryErrorDetails(t.error,t.status)),s.store[r]=c,s.promiseFactory.reject(o.Error)}))}return this.promiseFactory.reject(o.Error)},t.ServerURL="powerbi/metadata/user/gettingStartedStatus",t.IgnoreQueryParam="ignoreGettingStartedPopups",t.ShowAllQueryParam="showGettingStartedPopups",t})();t.TutorialDataStoreService=a})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){function t(e){return new r(e)}e.createWorkbookHttpService=t;var r=(function(){function e(e){this.httpService=e}return e.prototype.getWorkbooks=function(e){var t=this.httpService.powerbiRequestOptions(e,"GetWorkbooks");return this.httpService.get("powerbi/metadata/workbooks",t)},e.prototype.getWorkbook=function(e,t,r){var o=this.httpService.powerbiRequestOptions(r,"GetWorkbook");return this.httpService.get("powerbi/metadata/workbooks/"+e+"/?packageId="+t,o)},e.prototype.renameWorkbook=function(e,t,r){var o=this.httpService.powerbiRequestOptions(r,"RenameWorkbook");return this.httpService.post("powerbi/metadata/workbooks/"+e.id+"/name",JSON.stringify(t),o)},e.prototype.deleteWorkbook=function(e,t){var r=this.httpService.powerbiRequestOptions(t,"DeleteWorkbook");return this.httpService.delete("powerbi/content/workbooks/"+e.id+"/?packageId="+e.packageId,r)},e.prototype.getWorkbookWopiData=function(e,t){var r=this.httpService.powerbiRequestOptions(t,"WopiWorkbook");return this.httpService.post("powerbi/metadata/workbooks/wopiaccessinfo",JSON.stringify(e),r)},e})()})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){function r(e,t,r,i,a,n,s,c,l,d){return new o(e,t,r,i,a,n,s,c,l,d)}t.createAppMetadataService=r;var o=(function(){function r(e,t,r,o,i,a,n,s,c,l){var d=this;this.rootScope=e,this.promiseFactory=t,this.resourcePackagesService=r,this.resourcePackageGateService=o,this.visualPluginService=i,this.telemetryService=a,this.editableFeatureSwitchService=n,this.groupStore=s,this.metadataStore=c,this.httpService=l,this.gettingAppMetadata=!1,this.getAppMetadataDeferred=this.promiseFactory.defer(),this.getAppMetadataDeferred.promise.then((function(e){d.editableFeatureSwitchService.featureSwitches.ngrxStore&&d.metadataStore.loadInitialMetadata(e)}))}return r.prototype.getAppMetadata=function(){var e=this;if(!this.gettingAppMetadata)if(window.initialDashboardContainer)if(window.initialDashboardContainer===t.constants.initialDashboardContainerLoadingState){this.gettingAppMetadata=!0;var r=this.rootScope.$on(t.constants.initialDashboardContainerReadyEventName,(function(){e.editableFeatureSwitchService.registerFeatureSwitches(window.initialDashboardContainer.featureSwitches),e.importResourcePackages(window.initialDashboardContainer.resourcePackages).finally((function(){e.getAppMetadataDeferred.resolve(window.initialDashboardContainer),e.gettingAppMetadata=!1,r()}))}))}else window.initialDashboardContainer!==t.constants.initialDashboardContainerErrorState?(this.editableFeatureSwitchService.registerFeatureSwitches(window.initialDashboardContainer.featureSwitches),this.importResourcePackages(window.initialDashboardContainer.resourcePackages).finally((function(){e.getAppMetadataDeferred.resolve(window.initialDashboardContainer)}))):this.getAppMetadataDeferred.reject();else this.getAppMetadataDeferred.reject();return this.getAppMetadataDeferred.promise},r.prototype.getOrgAppsMetadata=function(){var e=this,t=this.getAppMetadataDeferred.promise;return t.then((function(){var r=window.initialGroupGUID;return _.isEmpty(r)?t:e.requestMyWorkspaceMetadata()})).catch((function(){return e.requestMyWorkspaceMetadata()}))},r.prototype.requestMyWorkspaceMetadata=function(){var t=this;if(null!=this.getMyWorkSpaceAppMetadataDeferred)return this.getMyWorkSpaceAppMetadataDeferred.promise;var r=this.telemetryService.startEvent(e.telemetry.AppServiceGetOrgAppsMetadata);this.getMyWorkSpaceAppMetadataDeferred=this.promiseFactory.defer();var o=this.httpService.powerbiRequestOptions(r.event,"AppServiceGetOrgAppsMetadata",{dismissGroupObjectId:!0});return o.params={preferReadOnlySession:"true"},this.httpService.get("powerbi/metadata/app",o).then((function(e){t.getMyWorkSpaceAppMetadataDeferred.resolve(e.data),r.resolve()}),(function(o){t.getMyWorkSpaceAppMetadataDeferred.reject(null),r.reject(e.errorDetailsHelper.getTelemetryErrorDetails(o.error,o.status))})),this.getMyWorkSpaceAppMetadataDeferred.promise},r.prototype.importResourcePackages=function(t){var r=this;if(this.importResourcePackagesDeferred)return this.importResourcePackagesDeferred.promise;this.importResourcePackagesDeferred=this.promiseFactory.defer();var o=window.initialDashboardContainer.activeDashboardId;if(_.isEmpty(t))this.importResourcePackagesDeferred.resolve(null),window.initialDashboardContainer&&o&&this.telemetryService.logEvent(e.telemetry.DashboardImportResourcePackagesOnLoad,o.toString(),0);else{var i;window.initialDashboardContainer&&o&&(i=this.telemetryService.startEvent(e.telemetry.DashboardImportResourcePackagesOnLoad,window.initialDashboardContainer.activeDashboardId.toString(),t.length));var a=_.map(t,(function(e){return e.id.toString()}));this.resourcePackageGateService.shouldShowWarning(a,o.toString())?(this.importResourcePackagesDeferred.resolve(null),i&&i.resolve()):(this.resourcePackagesService.registerPackages(t),this.visualPluginService.ensurePlugins(t,!1).catch((function(){i&&i.reject()})).finally((function(){i&&i.resolve(),r.importResourcePackagesDeferred.resolve(null)})))}return this.importResourcePackagesDeferred.promise},r})()})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){function r(){return new i}var o=e.common.contracts.ContentProviderCategory;t.createAppCollectionService=r;var i=(function(){function e(){this.apps=[]}return e.prototype.findServiceContentProvider=function(e){return _.find(this.apps,(function(t){return t.providerId===e&&(t.category===o.ServiceApp||t.category===o.Services)}))},e.prototype.findOrganizationalContentProvider=function(e){return _.find(this.apps,(function(t){return t.providerId===e&&(t.category===o.Organizational||t.category===o.OrganizationalApp||t.category===o.OrganizationalTemplate||t.category===o.OrganizationalTemplateApp)}))},e.prototype.findContentProviderByKey=function(e){if(null!=e)return _.find(this.apps,(function(t){return t.providerKey===e}))},e})()})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){function r(e,t,r,o,i,a,n,s,c,d,p,u,h,f,v,m,g,y){return new l(e,t,r,o,i,a,n,s,c,d,p,u,h,f,v,m,g,y)}function o(e){return new d(e)}var i=e.common.contracts.ContentProviderCategory,a=e.errorDetailsHelper,n=e.common.dialog.MessageDialogBuilder,s=e.common.NotifyCollection,c=e.common.contracts.PackageType;t.createAppService=r;var l=(function(){function t(e,t,r,o,a,c,l,d,p,u,h,f,v,m,g,y,b,S){var k,D=this;this.appMetadataService=e,this.dashboardDataService=t,this.appCollectionService=r,this.modelService=o,this.reportService=a,this.workbookService=c,this.promiseFactory=l,this.dataServiceModelConverter=d,this.asyncFeatureSwitchService=p,this.telemetryService=u,this.modalDialogService=h,this.errorService=f,this.localizationService=v,this.contentProviderHttpService=m,this.packageCollectionService=g,this.appStore=y,this.packageService=b,this.httpService=S,this.orgAppCategories=[i.OrganizationalApp,i.OrganizationalTemplateApp],this.serviceAppCategories=[i.ServiceApp,i.Services],this.asyncFeatureSwitchService.getFeatureSwitches().then((function(e){D.storeEnabled=e.ngrxStore})),this.inFlightAppRequests=(k={},k.org={},k.service={},k),this.appInstanceRequests={},this.apps=[],this.instances=new s,this.messageDialogBuilder=new n(this.modalDialogService)}return Object.defineProperty(t.prototype,"apps",{get:function(){return this.appCollectionService.apps},set:function(e){this.appCollectionService.apps=e},enumerable:!0,configurable:!0}),t.prototype.ensureAppsInitialization=function(){return null!=this.appsInitializationDeferred?this.appsInitializationDeferred.promise:this.getOrgAppsMetadata().promise},t.prototype.getAppByCategory=function(e){return _.filter(this.apps,(function(t){return t.category===e}))},t.prototype.getAppByGUID=function(e){return _.find(this.apps,(function(t){return t.providerKey===e}))},t.prototype.updateAppsCollection=function(e,t){var r=this;this.apps=_.filter(e,(function(e){return r.isAppContentProvider(e)}))||[],this.instances.setItems([]);var o=_.filter(t,(function(e){return e.packageType===c.AppInstance}));if(!_.isEmpty(o))for(var i=0,a=o;i<a.length;i++){var n=a[i];this.onInstanceAdded(n)}},t.prototype.addApp=function(e){!this.isInstalledApp(e)&&this.isAppContentProvider(e)&&this.apps.push(e)},Object.defineProperty(t.prototype,"appInstances",{get:function(){return this.instances.items},enumerable:!0,configurable:!0}),t.prototype.onInstanceAdded=function(e){var t=this.promiseFactory;if(e.packageType!==c.AppInstance)return t.reject();var r=this.getAppInstance(e.id);if(null!=r)return t.resolve(r);var o,i;e.contentProviderRefId?(i=e.contentProviderRefId,o="org"):(i=e.serviceContentProviderId,o="service");var a=this.getInstalledAppDefinition(i,o);if(a){var n=this.dataServiceModelConverter.convertInstalledAppModel(a,e);return this.addInstance(n),t.resolve(n)}return this.onAppInstanceAddedInternal(e,i,o)},t.prototype.onInstanceDeleted=function(e){this.storeEnabled&&this.packageService.deletePackage(e);var t=this.instances.deleteItems((function(t){return t.packageId===e}));if(!_.isEmpty(t)){this.storeEnabled&&this.appStore.remove(e);var r=this.getAppInstancesForApp(t[0].objectId);_.isEmpty(r)&&_.pull(this.apps,t[0].providerContract)}},t.prototype.deleteInstance=function(e){var t=this,r=this.getAppInstanceInternal(e);if(null==r)return this.promiseFactory.reject();var o=this.promiseFactory.defer();return this.messageDialogBuilder.show("UninstallAppDialog",{titleText:this.localizationService.get("AppModel_UninstallAppTitle"),messageText:this.localizationService.get("AppModel_UninstallAppMessage"),okButtonText:this.localizationService.get("ModalDialogButtonText_Delete"),cancelButtonText:this.localizationService.get("ModalDialogButtonText_Cancel")}).then((function(e){0===e?t.deleteInstanceInternal(r,o):o.reject()})),o.promise},t.prototype.getAppInstance=function(e){return this.getAppInstanceInternal(e)},t.prototype.getAppArtifact=function(e,t){var r=e.packageId;if(t.dashboardOriginalGUID){var o=t.dashboardOriginalGUID;return _.find(this.dashboardDataService.dashboards,(function(e){return e.contract.originalDashboardObjectId===o&&e.contract.originalPackageId===r}))}if(t.reportOriginalGUID){var i=t.reportOriginalGUID;return _.find(this.reportService.reports,(function(e){return e.contract.originalReportObjectId===i&&e.packageId===r}))}if(t.workbookID){var a=t.workbookID;return _.find(this.workbookService.workbooks,(function(e){return e.uniqueId===a&&e.packageId===r}))}},t.prototype.subscribeToInstanceEvents=function(e){this.appInstancesCollectionChangedHandlers||(this.appInstancesCollectionChangedHandlers=[],this.setupAppInstanceListener()),this.appInstancesCollectionChangedHandlers.push(e)},t.prototype.unsubscribeToInstanceEvents=function(e){this.appInstancesCollectionChangedHandlers&&(_.pull(this.appInstancesCollectionChangedHandlers,e),_.isEmpty(this.appInstancesCollectionChangedHandlers)&&(this.appInstancesCollectionChangedHandlers=null,this.instances.unsubscribe(this.appInstanceListener)))},t.prototype.getAppInstancesForApp=function(e){return _.filter(this.appInstances,(function(t){return t.providerContract.providerKey===e}))},t.prototype.getAppInstanceInternal=function(e){return _.find(this.instances.items,(function(t){return t.packageId===e}))},t.prototype.setupAppInstanceListener=function(){var e=this;this.appInstanceListener||(this.appInstanceListener={onAdded:function(t){return e.notifyListeners((function(e){return e.onInstanceInstalled&&e.onInstanceInstalled(t)}))},onDeleted:function(t){return e.notifyListeners((function(e){return e.onInstanceUninstalled&&e.onInstanceUninstalled(t)}))},onReset:function(){return e.notifyListeners((function(e){return e.onInstancesReset&&e.onInstancesReset()}))}}),this.instances.subscribe(this.appInstanceListener)},t.prototype.getOrgAppsMetadata=function(){var e=this;if(null==this.appsInitializationDeferred){this.appsInitializationDeferred=this.promiseFactory.defer();var t=this.appMetadataService.getOrgAppsMetadata?this.appMetadataService.getOrgAppsMetadata():this.appMetadataService.getAppMetadata();this.promiseFactory.all([t,this.modelService.modelsPromise,this.asyncFeatureSwitchService.getFeatureSwitches(),this.dashboardDataService.getDashboards(),this.reportService.ensureReportsInitialization(),this.workbookService.ensureWorkbookInitialization()]).then((function(t){e.initializeAppCategories(e.asyncFeatureSwitchService);var r=t[0];r&&(r.apps||r.packages)&&e.updateAppsCollection(r.apps,r.packages);var o={onPackageAdded:function(t){t.packageType===c.AppInstance&&e.onInstanceAdded(t.contract)},onPackageDeleted:function(t){t.packageType===c.AppInstance&&e.onInstanceDeleted(t.id)},onPackagesReset:function(){return _.noop}};e.packageCollectionService.subscribe(o),e.appsInitializationDeferred.resolve(e)}),(function(){e.appsInitializationDeferred.reject()}))}return this.appsInitializationDeferred},t.prototype.notifyListeners=function(e){var t=this.appInstancesCollectionChangedHandlers;if(!_.isEmpty(t)&&e)for(var r=t.length-1;r>=0;r--)e(t[r])},t.prototype.onAppInstanceAddedInternal=function(e,t,r){var o=this,i=this.appInstanceRequests[e.id];if(i)return i.promise;var a=e.id;i=this.appInstanceRequests[a]=this.promiseFactory.defer();var n=this.storeEnabled&&"org"===r;return(n?this.getOrgAppMetadata(t):this.getAppDefinitionByType(t,r)).then((function(t){var r=t.contentProvider,a=t.packageContractOverride,s=o.getAppByGUID(r.providerKey),c=o.dataServiceModelConverter.convertInstalledAppModel(s||r,a||e);s||o.addApp(r),o.addInstance(c),o.storeEnabled&&!n&&o.appStore.add(c),i.resolve(c)}),(function(e){o.storeEnabled&&o.appStore.remove(a),i.reject(e)})).finally((function(){delete o.appInstanceRequests[a]})),i.promise},t.prototype.deleteInstanceInternal=function(t,r){var o=this,n=t.providerContract.providerKey,s=t.packageId;this.onInstanceDeleted(s);var c=this.telemetryService.startEvent(e.telemetry.AppsUninstallApp,n,i[t.category]),l=this.httpService.powerbiRequestOptions(c.event,"UninstallApp");l.enableTelemetry=!0,this.httpService.delete("/powerbi/content/providers/organization/"+n+"/?packageid="+s+"&uninstall=true",l).then((function(){c.resolve(),r.resolve(null)}),(function(e){o.storeEnabled&&o.appStore.add(t),o.addApp(t.providerContract),o.addInstance(t),c.reject(a.getTelemetryErrorDetails(e.error,e.status)),o.errorService.error(o.localizationService.get("AppModel_FailToUninstallAppMessage"),"AppModel_FailToUninstallApp",{requestId:e.requestId,statusCode:e.status.toString()}),r.reject()}))},t.prototype.getInstalledAppDefinition=function(e,t){var r="org"===t?this.orgAppCategories:this.serviceAppCategories;return _.find(this.apps,(function(t){return t.providerId===e&&_.includes(r,t.category)}))},t.prototype.getOrgAppMetadata=function(e){var t=this,r=this.inFlightAppRequests.org[e];return r?r.promise:(r=this.inFlightAppRequests.org[e]=this.promiseFactory.defer(),this.appStore.loadMetadata(e).then((function(e){var t={contentProvider:e.App,packageContractOverride:e.packages[0]};return r.resolve(t),null}),(function(e){r.reject(e)})),r.promise.finally((function(){delete t.inFlightAppRequests.org[e]})),r.promise)},t.prototype.getAppDefinitionByType=function(t,r){var o=this,i=this.inFlightAppRequests[r][t];if(i)return i.promise;i=this.inFlightAppRequests[r][t]=this.promiseFactory.defer();var n=this.telemetryService.startEvent(e.telemetry.AppsGetApp,r);return("service"===r?this.contentProviderHttpService.getServiceContentProviderById(n.event,t):this.contentProviderHttpService.getOrganizationalContentProviderById(n.event,t)).then((function(e){var t=e&&e.data;t&&o.isAppContentProvider(t)?i.resolve({contentProvider:t}):i.reject(e),n.resolve()}),(function(e){var t=a.getTelemetryErrorDetails(e.error,e.status);n.reject(t),i.reject(e)})).finally((function(){delete o.inFlightAppRequests[r][t]})),i.promise},t.prototype.isInstalledApp=function(e){return!!this.getAppByGUID(e.providerKey)},t.prototype.isAppCategory=function(e){return _.includes(this.validAppCategories,e)},t.prototype.isAppContentProvider=function(e){return!!e&&this.isAppCategory(e.category)},t.prototype.initializeAppCategories=function(e){this.validAppCategories=[],e.featureSwitches.appsEnabled&&this.validAppCategories.push(i.OrganizationalApp),e.featureSwitches.appTemplatesEnabled&&this.validAppCategories.push(i.OrganizationalTemplateApp),e.featureSwitches.serviceAppsEnabled&&(this.validAppCategories.push(i.ServiceApp),this.validAppCategories.push(i.Services)),e.featureSwitches.insightApps&&this.validAppCategories.push(i.PowerBIServiceApp)},t.prototype.addInstance=function(e){null==this.getAppInstance(e.packageId)&&this.instances.addItem(e)},t})();t.createMockAppService=o;var d=(function(){function e(e){this.promiseFactory=e}return Object.defineProperty(e.prototype,"apps",{get:function(){return[]},set:function(e){},enumerable:!0,configurable:!0}),e.prototype.ensureAppsInitialization=function(){return this.promiseFactory.reject()},e.prototype.getAppByCategory=function(e){return[]},e.prototype.getAppByGUID=function(e){return null},e.prototype.updateAppsCollection=function(e){},e.prototype.addApp=function(e){},e.prototype.isAppCategory=function(e){return!1},e.prototype.onInstanceAdded=function(e){return this.promiseFactory.reject(null)},e.prototype.onInstanceDeleted=function(e){},e.prototype.deleteInstance=function(e){return this.promiseFactory.reject()},e.prototype.getAppInstance=function(e){return null},e.prototype.getAppArtifact=function(e,t){return null},e.prototype.subscribeToInstanceEvents=function(e){},e.prototype.unsubscribeToInstanceEvents=function(e){},e.prototype.getAppInstancesForApp=function(e){},e})()})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){function r(e,t,r,i){return new o(e,t,r,i)}t.createPermissionRefreshService=r;var o=(function(){function t(e,t,r,o){this.userInfo=e,this.dashboardSyncService=t,this.dashboardDataService=r,this.promiseFactory=o,this.inFlightSyncRequests={}}return t.prototype.refreshDashboardTilePermissionsUponLoad=function(t){return __awaiter(this,void 0,e.Promise,(function(){var e,r,o,i,a,n,s,c,l,d,p,u,h=this;return __generator(this,(function(f){switch(f.label){case 0:return e=this.promiseFactory.resolve(null),r=t.contract&&t.contract.tiles,_.isEmpty(r)?[2,e]:(o=this.userInfo,i=this.dashboardDataService,a=t.id,(n=this.inFlightSyncRequests[t.id])?[2,n.promise]:(s=20,o.isUserMetadataRefreshed||!_.some(r,(function(e){return e.errorCode===s}))||i.dropDashboardfromMemoryIfNotActive(a)?[2,e]:(n=this.inFlightSyncRequests[t.id]=this.promiseFactory.defer(),c=function(){return delete h.inFlightSyncRequests[t.id],n.resolve(null),n.promise},[4,this.userInfo.userMetadataPromise])));case 1:for(f.sent(),l=[],d=0,p=r;d<p.length;d++)u=p[d],u.errorCode===s&&l.push(u.id);return _.isEmpty(l)||i.dropDashboardfromMemoryIfNotActive(a)?[2,c()]:[4,this.dashboardSyncService.onTilesAddedOrUpdated(a,l)];case 2:return f.sent(),[2,c()]}}))}))},t})()})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){function r(){return new i}var o=e.common.NotifyCollection;t.createDashboardCollectionService=r;var i=(function(){function e(){this.listeners=[],this.collection=new o}return Object.defineProperty(e.prototype,"dashboards",{get:function(){return this.collection.items},set:function(e){this.collection.setItems(e)},enumerable:!0,configurable:!0}),e.prototype.getDashboardContracts=function(){return _.map(this.dashboards,(function(e){return e.contract}))},e.prototype.findDashboardContract=function(e){var t=this.getDashboardContracts();return _.find(t,(function(t){return t.id===e}))},e.prototype.onAdded=function(e){for(var t=this.listeners,r=0,o=t;r<o.length;r++){var i=o[r];i.onDashboardAdded&&i.onDashboardAdded(e)}},e.prototype.onDeleted=function(e){for(var t=this.listeners,r=0,o=t;r<o.length;r++){var i=o[r];i.onDashboardDeleted&&i.onDashboardDeleted(e)}},e.prototype.onReset=function(){for(var e=this.listeners,t=0,r=e;t<r.length;t++){var o=r[t];o.onDashboardsReset&&o.onDashboardsReset()}},e.prototype.addDashboard=function(e){this.collection.addItem(e)},e.prototype.removeDashboard=function(e){this.collection.deleteItems((function(t){return t.id===e}))},e.prototype.subscribe=function(e){this.listeners.length<1&&this.collection.subscribe(this),this.listeners.push(e)},e.prototype.unsubscribe=function(e){_.pull(this.listeners,e),this.listeners.length<1&&this.collection.unsubscribe(this)},e})()})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){function r(e,t,r,o,i,n,s,c,l){return new a(e,t,r,o,i,n,s,c,l)}var o=e.common.DashboardRequestType;t.createDashboardDataService=r;var i=3e3,a=(function(){function r(e,t,r,o,i,a,n,s,c){var l=this;this.dashboardHttpService=e,this.promiseFactory=t,this.featureSwitchService=r,this.modelMerger=o,this.modelService=i,this.dashboardCollectionService=a,this.$timeout=n,this.dashboardStore=s,this.appMetadataService=c,this.refreshStateListeners=[],this.InEditMobileLayoutMode=!1,this.dashboardCollectionService=a,this.dashboardsDeferred=t.defer(),this.isQnaEnabled=!1,this.modelService.addModelUpdateListener(this),this.refreshState=0,this.appMetadataService.getAppMetadata().then((function(){l.storeEnabled=l.featureSwitchService.featureSwitches.ngrxStore,l.storeEnabled&&l.dashboardStore.selectedDashboard.subscribe((function(e){l.activeDashboardId=e?e.id:-1,l.initializeUponSettingActiveDashboard(e)}))}))}return r.prototype.registerRefreshStateListener=function(e){_.includes(this.refreshStateListeners,e)||this.refreshStateListeners.push(e)},r.prototype.unregisterRefreshStateListener=function(e){_.remove(this.refreshStateListeners,e)},r.prototype.onDashboardTileRefreshStarted=function(e){this.activeDashboardId===e&&0===this.refreshState&&this.notify(1,e)},r.prototype.onDashboardTileRefreshFinished=function(e){var t=this;this.activeDashboardId===e&&1===this.refreshState&&(this.notify(2,e),this.$timeout((function(){return t.notify(0,e)}),i))},r.prototype.notify=function(e,t){this.refreshState=e;for(var r=0,o=this.refreshStateListeners;r<o.length;r++){o[r].onStateChange(this.refreshState,t)}},Object.defineProperty(r.prototype,"dashboards",{get:function(){return this.dashboardCollectionService.dashboards},set:function(e){this.dashboardCollectionService.dashboards=e},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"visibleDashboards",{get:function(){return _.filter(this.dashboardCollectionService.dashboards,(function(e){return!e.isHidden}))},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"activeDashboard",{get:function(){return this.activeDashboardId===-1?null:this.findDashboard(this.activeDashboardId)},set:function(e){e?this.activeDashboardId=e.id:this.activeDashboardId=-1,this.storeEnabled?this.dashboardStore.select(e?e.contract:null):this.initializeUponSettingActiveDashboard(),this.refreshState=0},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"activeDashboardContainsQnaSupportedModel",{get:function(){return t.DashboardUtils.containsQnaSupportedModel(this.activeDashboardModels,this.modelService,this.featureSwitchService)},enumerable:!0,configurable:!0}),r.prototype.initializeUponSettingActiveDashboard=function(e){this.updateActiveDashboardModelsInternal(e)},Object.defineProperty(r.prototype,"displayName",{get:function(){return this.activeDashboard?this.activeDashboard.displayName:""},enumerable:!0,configurable:!0}),r.prototype.addDashboard=function(e){if(e){this.getDashboardIndex(e.id)<0&&this.dashboardCollectionService.addDashboard(e)}},r.prototype.addOrReplaceDashboard=function(e){var t=this.getDashboardIndex(e.id);t<0?this.dashboardCollectionService.addDashboard(e):this.dashboards.splice(t,1,e)},r.prototype.deleteDashboardAtServerSide=function(t,r){var o=this.promiseFactory.defer(),i=this.dashboards.filter((function(e){return e.id===t}))[0];return i?this.dashboardHttpService.deleteDashboard(i.contract,r.event).then((function(){r.resolve(),o.resolve(null)}),(function(t){r.reject(e.errorDetailsHelper.getTelemetryErrorDetails(t.error,t.status)),o.reject(t)})):o.reject(),o.promise},r.prototype.deleteDashboard=function(e){this.removeDashboard(e)},r.prototype.deleteTile=function(e,t){var r=this,i=this.promiseFactory.defer(),a=this.findDashboard(e);return a?this.tryUpdateTile(a,t,(function(e,t){if(e>=0&&t>=0){var n=a.contract.tiles[e];a.contract.tiles.splice(e,1),a.tiles.splice(t,1),a.hasModel(n.modelId)||r.dashboardHttpService.addDashboardRequestToBatch(r.promiseFactory,a.id,!1,o.Default).done((function(e){r.modelMerger.mergeDashboardShallow(a,e.dashboards[0]),r.updateActiveDashboardModels(),i.resolve(null)})).fail((function(){i.reject()}))}else i.resolve(null)})):i.resolve(null),i.promise},r.prototype.dropDashboardfromMemoryIfNotActive=function(e){var t=this.activeDashboard;if(!t||t.id!==e){var r=this.findDashboard(e);return r&&(r.contract.tiles=null,r.isLoaded=!1),!0}return!1},r.prototype.findDashboard=function(e){return _.find(this.dashboards,(function(t){return t.id===e}))},r.prototype.findDashboardByGUID=function(e){for(var t=0,r=this.dashboards;t<r.length;t++){var o=r[t];if(o.objectId===e)return o}},r.prototype.findDashboardsByPackageId=function(e){var t=this.dashboards;if(t)return _.filter(t,(function(t){return!(!t.contract||!t.contract.originalPackageId)&&t.contract.originalPackageId===e}))},r.prototype.retrieveDashboardForApp=function(e,t){return _.find(this.dashboards,(function(r){return r.getUniquePackageId()===e&&r.contract.originalDashboardObjectId===t}))},r.prototype.getDashboardIndex=function(e){for(var t=this.dashboards,r=0,o=t.length;r<o;r++)if(t[r].id===e)return r;return-1},r.prototype.registerDashboards=function(e){this.dashboards=e},r.prototype.tryUpdateTile=function(e,t,r){if(e){var o=e.getTileContractIndex(t),i=e.getTileIndex(t);r(o,i),e.scheduleDelayedLayout(this.activeDashboard!==e)}},r.prototype.updateActiveDashboardModels=function(){var e=this.activeDashboard&&this.activeDashboard.contract;this.updateActiveDashboardModelsInternal(e)},r.prototype.updateActiveDashboardModelsInternal=function(r){return __awaiter(this,void 0,e.Promise,(function(){return __generator(this,(function(e){switch(e.label){case 0:return r||(r=this.activeDashboard&&this.activeDashboard.contract),[4,this.modelService.modelsPromise];case 1:return e.sent(),this.activeDashboardModels=t.DashboardUtils.getDashboardModels(r,this.modelService.getModelContracts()),this.updateIsQnaEnabled(),[2]}}))}))},r.prototype.isActiveDashboardModelRefreshDisabled=function(){var e=this.activeDashboardModels;if(_.isEmpty(e))return!1;for(var t=this.modelService,r=0,o=e;r<o.length;r++){var i=o[r],a=t.findModel(i.id,i.packageId);if(a&&a.isRefreshDisabledDueToInactivity())return!0}return!1},r.prototype.activeDashboardHasRlsModel=function(){var e=this.activeDashboardModels;if(_.isEmpty(e))return!1;for(var t=this.modelService,r=0,o=e;r<o.length;r++){var i=o[r],a=t.findModel(i.id,i.packageId);if(a&&(a.cloudRlsEnabled||a.contract.onPremModelConnectionString))return!0}return!1},r.prototype.updateIsQnaEnabled=function(){this.activeDashboard?"undefined"!=typeof this.activeDashboard.qnaEnabled?this.isQnaEnabled=this.activeDashboard.qnaEnabled:this.isQnaEnabled=this.activeDashboardContainsQnaSupportedModel:this.isQnaEnabled=!1},r.prototype.onModelUpdated=function(e,t){this.modelService.findModel(e,t)&&this.updateActiveDashboardModels()},r.prototype.getDashboards=function(){var e=this;return this.dashboardsDeferred.promise.then((function(){return e.dashboards}))},r.prototype.resolveDashboardDeferred=function(){this.dashboardsDeferred.resolve(this)},r.prototype.rejectDashboardDeferred=function(){this.dashboardsDeferred.reject()},r.prototype.removeDashboard=function(e){this.dashboardCollectionService.removeDashboard(e)},r.prototype.setQnaEnabled=function(e,t){var r=this.findDashboard(e);r&&(r.qnaEnabled=t,this.updateIsQnaEnabled())},r.prototype.subscribe=function(e){this.dashboardCollectionService.subscribe(e)},r.prototype.unsubscribe=function(e){this.dashboardCollectionService.unsubscribe(e)},r.prototype.onDeleted=function(e){this.dashboardCollectionService.onDeleted(e)},r})();t.DashboardDataService=a})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){function r(e,t,r,o,i,n,s,c,l,d,p,u,h,f,v,m,g,y,b){return new a(e,t,r,o,i,n,s,c,l,d,p,u,h,f,v,m,g,y,b)}var o=e.common.DashboardRequestType,i=e.common.contracts.SyncEntityType;t.createDashboarSyncService=r;var a=(function(){function r(e,t,r,o,a,n,s,c,l,d,p,u,h,f,v,m,g,y,b){var S=this;this.rootScope=e,this.dashboardDataService=t,this.dashboardHttpService=r,this.modelConverter=o,this.modelMerger=a,this.modelService=n,this.promiseFactory=s,this.reportService=c,this.resourcePackageGateService=l,this.resourcePackageListenerService=d,this.resourcePackagesService=p,this.telemetryService=h,this.tutorialDataStore=f,this.userInfo=v,this.workbookService=m,this.dashboardStore=g,this.featureSwitchService=y,this.fetchEntityService=b;var k={onTilesAddedOrUpdated:function(e,t){return S.onTilesAddedOrUpdated(e,t)},onTileDeleted:function(e,t){S.dashboardDataService.dropDashboardfromMemoryIfNotActive(e)||S.dashboardDataService.deleteTile(e,t)},onDashboardAdded:function(e){return S.addOrDeepEditDashboard(e)},onDashboardDeleted:function(e){return S.onDashboardDeleted(e)},onDashboardShallowEdit:function(e){return S.onDashboardShallowEdit(e)},onDashboardDeepEdit:function(e){S.dashboardDataService.dropDashboardfromMemoryIfNotActive(e)||S.addOrDeepEditDashboard(e)},onDashboardTileDataChange:function(e){S.onTilesAddedOrUpdated(e,[]),S.dashboardDataService.onDashboardTileRefreshFinished(e)},onClearBatchedDashboardRequests:function(){return S.dashboardHttpService.batchedDashboardRequests=[]}};u.addDashboardRefreshListener(k);var D={ensureFetched:function(e){return S.ensureFetched(e)}};b.addFetchEntityHandler(i.Dashboard,D),this.featureSwitchService.getFeatureSwitches().then((function(e){S.storeEnabled=e.ngrxStore}))}return r.prototype.onTilesAddedOrUpdated=function(e,t){var r=this,o=this.promiseFactory;
if(this.customTilesUpdate)return this.customTilesUpdate(e,t),o.resolve(null);if(this.dashboardDataService.dropDashboardfromMemoryIfNotActive(e))return o.resolve(null);if(this.dashboardDataService.selectedDashboardTile){0===t.length&&(t=this.dashboardDataService.activeDashboard.tiles.map((function(e){return e.id})));var i=t.indexOf(this.dashboardDataService.selectedDashboardTile.tileModel.id);if(i>=0&&(t.splice(i,1),0===t.length))return o.resolve(null)}return this.dashboardHttpService.batchGetTiles(e,t,void 0,!0).then((function(t){var o=t.data;if(!_.isEmpty(o))for(var i=0,a=o.length;i<a;++i){var n=o[i];r.registerAndUpdateTile(e,n)}}))},r.prototype.addOrDeepEditDashboard=function(r){var i=this,a=this.telemetryService.startEvent(e.telemetry.DashboardAddUpdateDashboard),n=this.promiseFactory.defer();return this.dashboardHttpService.addDashboardRequestToBatch(this.promiseFactory,r,!1,o.Default).done((function(e){i.addOrUpdateDashboard(e),i.rootScope.$emit(t.constants.updateDashboardContainerEventName,[e]),i.dashboardDataService.onDashboardTileRefreshFinished(r),a.resolve(),n.resolve(null)})).fail((function(){a.reject(),n.reject(null)})),n.promise},r.prototype.ensureFetched=function(e){var t=e.id;return this.dashboardDataService.findDashboard(t)?this.promiseFactory.resolve(null):this.addOrDeepEditDashboard(t)},r.prototype.addOrUpdateCustomVisualTile=function(e,r,o,i){var a=this;this.isResourcePackageInCache(e)?this.addOrUpdateTile(r,o,this.modelService.getModelContracts()):this.resourcePackageListenerService.getAndLoadVisualPlugin(e).then((function(){a.addOrUpdateTile(r,o,a.modelService.getModelContracts()),i&&(a.resourcePackageGateService.resetResourceFlag(),a.rootScope.$emit(t.constants.shouldShowEnableCustomVisualsDialog))}))},r.prototype.addOrUpdateDashboard=function(e){var r=e.dashboards[0],o=this.modelConverter.convertDashboard(r,e.models,e.reports),i=this.dashboardDataService.getDashboardIndex(r.id),a=i<0;if(this.storeEnabled)this.dashboardStore.addOrUpdate(r);else if(this.modelConverter.fillDashboardChildren(o,e.models,e.reports,this.workbookService.getWorkbookContracts()),i>=0){var n=this.dashboardDataService.dashboards[i];this.modelMerger.mergeDashboard(n,r,e.models,e.reports);for(var s=n.tiles.length,c=0;c<s;c++){var l=n.tiles[c];l.invalidateLayout()}}else this.dashboardDataService.addDashboard(o),o.isNew=!0,o.isNotified=!1,o.isLoaded=!0,r.ownerInfo&&this.userInfo.addOrUpdateDashboardOwnerInfoCache(r.ownerInfo);this.rootScope.$emit(t.constants.addOrUpdateDashboardEventName,e,a),this.dashboardDataService.onDashboardTileRefreshFinished(o.id)},r.prototype.addOrUpdateTile=function(e,t,r){var o=this;e&&(r=r||[],this.updateModelsIfRequired(e,t),this.dashboardDataService.tryUpdateTile(e,t.id,(function(i,a){var n=o.reportService.findReport(t.reportId),s=null;i>=0?(e.contract.tiles[i]=t,a>=0&&(s=e.tiles[a],o.modelMerger.mergeTile(s,t,r,null,o.workbookService.getWorkbookContracts(),o.reportService.reports))):(s=o.modelConverter.convertTile(t,r,null,o.workbookService.getWorkbookContracts()),e.contract.tiles.push(t),e.tiles.push(s)),s&&(s.invalidateLayout(),n&&(s.report=n))})))},r.prototype.clearSeenDashboards=function(){var r=this.telemetryService.startEvent(e.telemetry.DashboardSharingNewUnseenDashboards,0,0,0);this.tutorialDataStore.setKey(t.constants.seenDashboardsStorageKey,{},r)},r.prototype.registerAndUpdateTile=function(e,t){var r=this.dashboardDataService.findDashboard(e),o=$.map(t.resourcePackageIds,(function(e){return e.toString()})),i=this.resourcePackageGateService.shouldShowWarning(o,this.dashboardDataService.activeDashboard.objectId);if(t.resourcePackageIds&&t.resourcePackageIds.length>0)for(var a=t.resourcePackageIds.length,n=0;n<a;++n)this.addOrUpdateCustomVisualTile(t.resourcePackageIds[n],r,t,i);else this.addOrUpdateTile(r,t,this.modelService.getModelContracts())},r.prototype.onDashboardDeleted=function(t){return __awaiter(this,void 0,e.Promise,(function(){var e=this;return __generator(this,(function(r){return this.beforeDashboardDeleting&&this.beforeDashboardDeleting(t),this.storeEnabled&&this.dashboardStore.findAll(t).then((function(r){e.dashboardStore.delete(r[0],!0),e.afterDashboardDeleting&&e.afterDashboardDeleting(t)})),this.dashboardDataService.deleteDashboard(t),[2]}))}))},r.prototype.onDashboardShallowEdit=function(r){var o=this,i=this.dashboardDataService.findDashboard(r);i&&this.dashboardHttpService.addDashboardRequestToBatch(this.promiseFactory,r,!1,e.common.DashboardRequestType.Metadata).done((function(e){var r=e.dashboards[0],a=r.isHidden&&!i.isHidden;o.modelMerger.mergeDashboardShallow(i,r),a&&o.dashboardDataService.deleteDashboard(i.id),o.rootScope.$emit(t.constants.onDashboardShallowEditEventName,i,r)}))},r.prototype.updateModelsIfRequired=function(e,r){var i=this,a=e.getTileContractIndex(r.id),n=a!==-1&&2===r.publishState&&1===e.contract.tiles[a].publishState;!n&&e.hasModel(r.modelId)||this.dashboardHttpService.addDashboardRequestToBatch(this.promiseFactory,e.id,!1,o.Default).done((function(r){n&&(i.modelMerger.mergeDashboardTiles(e,r),i.rootScope.$emit(t.constants.mergeDashboardContainerModelsReportsAndPackagesEventName,r),i.modelMerger.mergeModelContentProviderId(r.models,r.packages)),i.modelMerger.mergeDashboardShallow(e,r.dashboards[0]),i.dashboardDataService.updateActiveDashboardModels()}))},r.prototype.isResourcePackageInCache=function(e){var t=this.resourcePackagesService.getAllPackages();return _.some(t,(function(t){return t.id===e}))},r})();t.DashboardSyncService=a})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t=(function(){function e(e){this.folderService=e}return e.prototype.getProgressDelayStringForGivenFileSize=function(e){var t=this.getDurationInSecondsForGivenFileSizeInMB(e);return this.getDelayDurationStringForProgressBarAnimation(t)},e.prototype.getEstimatedLoadingTimeForGivenFileSize=function(e){return this.getDurationInSecondsForGivenFileSizeInMB(e)},e.prototype.getProgressBarDetailsForGivenFileSize=function(e){var t,r=this.getEstimatedLoadingTimeForGivenFileSize(e);return t={estimatedLoadingTimeInMinutes:Math.floor(r/60),delayDurationString:this.getDelayDurationStringForProgressBarAnimation(r)}},e.prototype.isLargeModelNotInPremium=function(e){return!(this.folderService&&this.folderService.activeFolder&&null!=this.folderService.activeFolder.capacity)&&e>1024},e.prototype.getDurationInSecondsForGivenFileSizeInMB=function(e){var t=1024;return e>0&&e<t?0:30*Math.floor(e/t)},e.prototype.getDelayDurationStringForProgressBarAnimation=function(e){var t=0,r=e+t;return t+"s, "+r+"s, "+2*r+"s, "+3*r+"s"},e})();e.DatasetSizeService=t})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){function r(e,t,r,i,a,n,s){return new o(e,t,r,i,a,n,s)}t.createHostAppMetadataService=r;var o=(function(){function t(e,t,r,o,i,a,n){this.promiseFactory=e,this.telemetryService=t,this.eventFactory=r,this.editableFeatureSwitchService=o,this.httpService=i,this.errorCallback=a,this.getAppMetadataDeferred=this.promiseFactory.defer(),this.requestAppMetadata(o,n)}return t.prototype.getAppMetadata=function(){return this.getAppMetadataDeferred.promise},t.prototype.requestAppMetadata=function(r,o){var i=this,a=this.telemetryService.startEvent(this.eventFactory),n=this.httpService.powerbiRequestOptions(a.event,"DashboardHostGetAppMetadata",{isAdminRequest:o});n.params={preferReadOnlySession:"true"},this.httpService.get("powerbi/metadata/app",n).then((function(e){var t=e.data;window.initialDashboardContainer=t,i.editableFeatureSwitchService.registerFeatureSwitches(t.featureSwitches),i.getAppMetadataDeferred.resolve(t),a.resolve()}),(function(r){i.getAppMetadataDeferred.reject(null),a.reject(e.errorDetailsHelper.getTelemetryErrorDetails(r.error,r.status)),i.errorCallback&&i.errorCallback(t.pageRefreshErrorMessage)}))},t.pageRefreshErrorMessage="GetAppMetadataRequestFailed",t})()})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){function r(e){return new o(e)}t.createHttpThrottler=r;var o=(function(){function t(e){this.telemetryService=e,this.requests={}}return t.prototype.debounce=function(t,r,o){var i=this,a=t+r,n=this.requests[a];if(n)return n.throttleCount++,n.promise;var s=o();return this.requests[a]={operationName:t,promise:s,throttleCount:0},s.finally((function(){var t=i.requests[a];i.requests[a]=void 0,t.throttleCount>0&&i.telemetryService.logEvent(e.telemetry.HttpRequestThrottled,t.operationName,t.throttleCount)})),s},t})()})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){function r(e,t,r,o,i){return new c(e,t,r,o,i)}var o={title:"PinTile_Success",message:"PinTile_EditMobileAuthoringMessage",actionButtons:[{displayText:"EditMobileAuthoring_Button",action:void 0}]},i={title:"PinTile_Success",message:"PinTile_CreateMobileAuthoringMessage",actionButtons:[{displayText:"ToastNotification_GoToDashboard",action:void 0}]},a={title:"AddedTileMobileAuthoringTitle",message:"AddedTileEditMobileAuthoringMessage",actionButtons:[{displayText:"EditMobileAuthoring_Button",action:void 0}]},n={title:"AddedTileMobileAuthoringTitle",message:"AddedTileCreateMobileAuthoringMessage",actionButtons:[{displayText:"CreateMobileAuthoring_Button",action:void 0}]},s={title:"RemovedTileMobileAuthoringTitle",message:"RemovedTileMobileAuthoringMessage",actionButtons:[{displayText:"DeleteMobileAuthoring_Button",action:void 0}]};t.createMobileAuthoringService=r;var c=(function(){function t(e,t,r,o,i){this.gridLayout=e,this.localizationService=t,this.navigationService=r,this.notificationToastService=o,this.telemetryService=i,this.unpinTileFromMobileListeners=[]}return t.prototype.onUnpinTileFromMobileSimulator=function(){for(var e=0,t=this.unpinTileFromMobileListeners;e<t.length;e++){t[e].onTileUnpined()}},t.prototype.registerUnpinTileFromMobileListener=function(e){_.includes(this.unpinTileFromMobileListeners,e)||this.unpinTileFromMobileListeners.push(e)},t.prototype.unregisterUnpinTileFromMobileListener=function(e){_.remove(this.unpinTileFromMobileListeners,e)},t.prototype.showMobileIndicationMessage=function(t,r,o,i,a,n){var s=this,c=this.getOperationType(r),l=[],d=a?function(){s.telemetryService.logEvent(e.telemetry.MobileAuthoringDashboardOpenedFromFlyout,c,!1),s.navigationService.navigateToDashboardByGUID(t)}:function(){i?n():(s.telemetryService.logEvent(e.telemetry.MobileAuthoringDashboardOpenedFromFlyout,c,!0),s.navigationService.navigateToDashboardMobileAuthoringByGUID(t))};a&&l.push({displayText:this.localizationService.get("CreateMobileAuthoring_Button"),action:n});var p=this.getIndicationMessage(r);return l.push({displayText:this.localizationService.get(p.actionButtons[0].displayText),action:d}),this.notificationToastService.notify({title:this.localizationService.get(p.title),message:this.localizationService.get(p.message),actionButtons:l,notificationType:o})},t.prototype.switchLayoutStrategy=function(e,t,r){e.gridLayoutService||(e.gridLayoutService=this.gridLayout),e.gridLayoutService.strategy=t,e.gridLayoutService.displayLayout=r,this.updateDashboardTilesWithDisplayLayout(e,r)},t.prototype.updateDashboardTilesWithDisplayLayout=function(e,t){if(e&&e.tiles)for(var r=0,o=e.tiles;r<o.length;r++){var i=o[r];i.gridLayoutContext&&(i.gridLayoutContext.setActiveLayout(t),i.invalidateLayout())}},t.prototype.getIndicationMessage=function(e){switch(e){case 0:return n;case 1:return a;case 2:return i;case 3:return o;case 4:return s}},t.prototype.getOperationType=function(e){switch(e){case 0:case 1:return"Add";case 2:case 3:return"Pin";case 4:return"Remove"}},t})();t.MobileAuthoringService=c})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){function r(){return new i}var o=e.common.NotifyCollection;t.createPackageCollectionService=r;var i=(function(){function e(){this.collection=new o,this.listeners=[],this.packages=[]}return Object.defineProperty(e.prototype,"packages",{get:function(){return this.collection.items},set:function(e){this.collection.setItems(e),this.idToPackageMap=_.keyBy(e,(function(e){return e.id}))},enumerable:!0,configurable:!0}),e.prototype.findPackage=function(e){return this.idToPackageMap[e]},e.prototype.findPackageContract=function(e){var t=this.findPackage(e);return t?t.contract:void 0},e.prototype.addPackage=function(e){this.idToPackageMap[e.id]||(this.idToPackageMap[e.id]=e,this.collection.addItem(e))},e.prototype.removePackage=function(e){this.collection.deleteItems((function(t){return t.id===e.id}));delete this.idToPackageMap[e.id]},e.prototype.subscribe=function(e){_.isEmpty(this.listeners)&&this.subscribeToCollectionEvents(),this.listeners.push(e)},e.prototype.unsubscribe=function(e){_.remove(this.listeners,e),_.isEmpty(this.listeners)&&this.unsubscribeToCollectionEvents()},e.prototype.subscribeToCollectionEvents=function(){var e=this;this.collectionListener={onAdded:function(t){return e.notifyListeners((function(e){return e.onPackageAdded(t)}))},onDeleted:function(t){return e.notifyListeners((function(e){return e.onPackageDeleted(t)}))},onReset:function(){return e.notifyListeners((function(e){return e.onPackagesReset()}))}},this.collection.subscribe(this.collectionListener)},e.prototype.unsubscribeToCollectionEvents=function(){this.collection.unsubscribe(this.collectionListener),this.collectionListener=null},e.prototype.notifyListeners=function(e){var t=this.listeners;if(!_.isEmpty(t)&&e)for(var r=t.length-1;r>=0;r--)e(t[r])},e})()})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){function r(e,t,r,o,i,a,n,s,c,d,p,u,h,f,v,m,g){return new l(e,t,r,o,i,a,n,s,c,d,p,u,h,f,v,m,g)}var o=t.models.ContentPackItems,i=e.common.contracts.ContentProviderCategory,a=e.common.contracts.PackageType,n=e.common.contracts.PublishOrRefreshStatus,s=e.common.contracts.StorageProviderType,c=e.common.contracts.SyncEntityType;t.createPackageService=r;var l=(function(){function r(e,t,r,o,i,a,n,s,l,d,p,u,h,f,v,m,g){var y=this;this.rootScope=e,this.telemetryService=t,this.errorService=r,this.modelMerger=o,this.modelConverter=i,this.reportService=a,this.modelService=n,this.syncService=s,this.localizationService=l,this.appMetadataService=d,this.workbookService=p,this.packageCollectionService=u,this.promiseFactory=h,this.asyncFeatureSwitchService=f,this.packageStore=v,this.fetchEntityService=m,this.packageHttpService=g,this.initPackages();var b={onPackageDeleted:function(e){return y.deletePackage(e)},onPackagePublishEdit:function(e){return y.onPackagePublishEdit(e)},onPackagePublishRefreshCompleted:function(e){return y.onPackagePublishRefreshCompleted(e)}};this.syncService.addPackageRefreshListener(b);var S={ensureFetched:function(e){return y.ensureFetched(e)}};this.fetchEntityService.addFetchEntityHandler(c.Package,S)}return r.prototype.deletePackage=function(e){if(this.ngrxStore)return void this.packageStore.delete(e);var t=this.findPackage(e);t&&(t.contract.reports&&this.reportService.deleteReportForPackage(e),this.modelService.deleteModelForPackage(e),this.workbookService.deleteWorkbookForPackage(e),this.packageCollectionService.removePackage(t))},r.prototype.ensurePackagesInitialization=function(){return this.packagesInitializationDeferred.promise},Object.defineProperty(r.prototype,"packages",{get:function(){return this.packageCollectionService.packages},enumerable:!0,configurable:!0}),r.prototype.findPackage=function(e){return this.packageCollectionService.findPackage(e)},r.prototype.getWorkbookStorageProvider=function(e){var t=this.findPackage(e);return t&&t.contract?t.contract.storageProviderType:null},r.prototype.getWorkbookContentProvider=function(e){var t=this.findPackage(e);return t?t.contentProviderId:null},r.prototype.getInstalledOrgPackage=function(e){return _.find(this.packages,(function(t){return t.contract&&t.contract.contentProviderRefId&&t.contract.contentProviderRefId===e&&t.packageType===a.AppInstance}))},r.prototype.isLocalWorkbook=function(e){var t=this.findPackage(e);return t&&t.contract&&t.contract.storageProviderType===s.Local},r.prototype.getPackagesByProviderId=function(e,t){switch(t){case i.BuiltIn:return _.filter(this.packages,(function(t){return t.contract.contentProviderId===e}));case i.Organizational:case i.OrganizationalApp:case i.OrganizationalTemplate:case i.OrganizationalTemplateApp:return _.filter(this.packages,(function(t){return t.contract.contentProviderRefId===e}));case i.ServiceApp:case i.Services:return _.filter(this.packages,(function(t){return t.contract.serviceContentProviderId===e}))}},r.prototype.getPackagesByProviderIdAndPackageType=function(e,t,r){switch(t){case i.BuiltIn:return _.filter(this.packages,(function(t){return t.contract.contentProviderId===e&&t.packageType===r}));case i.Organizational:case i.OrganizationalApp:case i.OrganizationalTemplate:case i.OrganizationalTemplateApp:return _.filter(this.packages,(function(t){return t.contract.contentProviderRefId===e&&t.packageType===r}));case i.ServiceApp:case i.Services:return _.filter(this.packages,(function(t){return t.contract.serviceContentProviderId===e&&t.packageType===r}))}},r.prototype.getAllAppPackagesByType=function(e){return _.filter(this.packages,(function(t){return t.packageType===e}))},r.prototype.isRefreshNowEnabledForWorkbook=function(e){if(this.asyncFeatureSwitchService.featureSwitches.disallowWorkbookRefresh)return!1;if(!e)return!1;if(!e.isOwner())return!1;var t=this.findPackage(e.packageId);return!(!t||!t.contract)},r.prototype.isScheduleRefreshEnabledForWorkbook=function(e){return!(!e||!e.contract)&&(!!this.isRefreshNowEnabledForWorkbook(e)&&(void 0!==e.modelId&&!!e.contract.isPowerPivotVersionSupportsRefresh))},r.prototype.initPackages=function(){var e=this;this.packagesInitializationDeferred=this.promiseFactory.defer(),this.asyncFeatureSwitchService.getFeatureSwitches().then((function(t){return e.ngrxStore=t.ngrxStore,t.ngrxStore?(e.packageStore.packages.subscribe((function(t){var r=t.map((function(t){var r=_.find(e.packages,(function(e){return e.id===t.id}));return r?(r.contract!==t&&e.modelMerger.mergePackage(r,t),r):e.modelConverter.convertPackage(t)}));e.packageCollectionService.packages=r})),void e.packagesInitializationDeferred.resolve(e)):void e.appMetadataService.getAppMetadata().then((function(t){e.loadPackages(t),e.packagesInitializationDeferred.resolve(e)}),(function(){return e.packagesInitializationDeferred.reject()}))}))},r.prototype.loadPackages=function(e){e&&e.packages&&this.updatePackageCollection(e.packages)},r.prototype.updatePackageCollection=function(e){var t=this,r=_.map(e,(function(e){return t.modelConverter.convertPackage(e)}));this.packageCollectionService.packages=r},r.prototype.mergePackageCollection=function(e){if(this.ngrxStore)return void this.packageStore.addMany(e);if(!_.isEmpty(e))for(var t=0,r=e;t<r.length;t++){var o=r[t];this.packageCollectionService.addPackage(this.modelConverter.convertPackage(o))}},r.prototype.updatePackage=function(e){if(e&&e.id){var r=this.findPackage(e.id);r?this.modelMerger.mergePackage(r,e):(r=this.modelConverter.convertPackage(e),this.packageCollectionService.addPackage(r)),r.hasUpdate()&&this.rootScope.$emit(t.constants.packageVersionChange,e.id)}},r.prototype.onPackagePublishRefreshCompleted=function(t){var r=this;if(this.packageStore.findById(t))return this.promiseFactory.resolve(null);var o=this.telemetryService.startEvent(e.telemetry.DashboardGetNavigationPanePackage);if(this.ngrxStore){var i=this.promiseFactory.defer();this.packageStore.addOrUpdate(t,o,i);return i.promise.then((function(){var o=r.packageStore.findById(t);o&&o.publishOrRefreshStatus===n.FinishedSuccessfully&&r.rootScope.$emit(e.dataServices.constants.packagePublishedSuccessfullyEventName,o.id)}))}return this.packageHttpService.getPackage(t,o.event).then((function(i){var a=i.data;if(r.updatePackage(a),a.models)for(var s=0,c=a.models.length;s<c;s++){var l=a.models[s],d=r.modelService.findModel(l.id,t);d?r.updateExistingModel(d,l,a.publishOrRefreshStatus):r.modelService.onModelAdded(l.id,t)}if(a.reports)for(var s=0,p=a.reports.length;s<p;s++){var u=a.reports[s],h=r.reportService.updateReport(u);h?h.packagePublishStatus=a.publishOrRefreshStatus:r.reportService.addContractReport(u)}if(a.workbooks)for(var s=0,f=a.workbooks.length;s<f;s++){var v=a.workbooks[s],m=r.workbookService.updateWorkbook(v);m||r.workbookService.onWorkbookAdded(v.id,t)}a.publishOrRefreshStatus===n.FinishedSuccessfully&&r.rootScope.$emit(e.dataServices.constants.packagePublishedSuccessfullyEventName,a.id),o.resolve()}),(function(){o.reject()}))},r.prototype.onPackagePublishEdit=function(r){var i=this,a=this.telemetryService,s=a.startEvent(e.telemetry.DashboardGetNavigationPanePackage),c=!1,l=0;if(this.ngrxStore){var d=this.packageStore.addOrUpdate(r,s);return void s.promise.then((function(){var a=i.packageStore.findById(r);d&&d.publishOrRefreshStatus===n.FinishedSuccessfully||a.publishOrRefreshStatus!==n.FinishedSuccessfully||i.rootScope.$emit(e.dataServices.constants.packagePublishedSuccessfullyEventName,a.id);for(var s=function(e){var r=i.modelConverter.convertReport(_.find(d.reports,(function(t){return t.id===e.id})));if(r&&r.packageVersion!==e.packageVersion&&r.isUsedByContentPack)return i.rootScope.$emit(t.constants.contentPackDirtyShowNotification,e.id,o.Report),{value:void 0}},c=0,l=a.reports;c<l.length;c++){var p=l[c],u=s(p);if("object"==typeof u)return u.value}}))}this.packageHttpService.getPackage(r,s.event).then((function(a){var d=a.data;if(d.models)for(var p=0,u=d.models.length;p<u;p++){var h=d.models[p],f=i.modelService.findModel(h.id,r);f&&i.updateExistingModel(f,h,d.publishOrRefreshStatus)}if(d.reports)for(var p=0,v=d.reports.length;p<v;p++){var m=d.reports[p],g=i.reportService.findReport(m.id);g&&g.packageVersion!==m.packageVersion&&g.isUsedByContentPack&&(c=!0,l=m.id);var y=i.reportService.updateReport(m);if(y){y.modelId=m.modelId;var b=i.modelService.findModel(m.modelId,r);y.model=b&&b.contract,y.packagePublishStatus=d.publishOrRefreshStatus}}if(d.workbooks)for(var p=0,S=d.workbooks.length;p<S;p++){var k=d.workbooks[p];i.workbookService.updateWorkbook(k)}var D=i.findPackage(d.id),w=D?D.publishOrRefreshStatus:null;i.updatePackage(d),w!==n.FinishedSuccessfully&&d.publishOrRefreshStatus===n.FinishedSuccessfully&&i.rootScope.$emit(e.dataServices.constants.packagePublishedSuccessfullyEventName,d.id),d.publishOrRefreshStatus===n.PublishError&&i.deletePackageOnPublishFailure(a),c&&(i.rootScope.$emit(t.constants.contentPackDirtyShowNotification,l,o.Report),c=!1),s.resolve()}),(function(){s.reject()}))},r.prototype.ensureFetched=function(e){return this.onPackagePublishRefreshCompleted(e.id)},r.prototype.updateExistingModel=function(e,t,r){e.dbName=t.dbName,e.vsName=t.vsName,e.contract.packagePublishStatus=r,e.packagePublishStatus=r},r.prototype.deletePackageOnPublishFailure=function(e){var t=this,r=this.localizationService.get("NavigationPane_PackagePublishErrorTitle"),o=this.localizationService.get("NavigationPane_PackagePublishErrorContent"),i={label:this.localizationService.get("ModalDialogButtonText_Delete"),resultValue:"delete",cssClass:"primary"},a={label:this.localizationService.get("ModalDialogButtonText_Cancel"),resultValue:"cancel"},n=[i,a],s=function(r){if("delete"===r)for(var o=e.data.models.length,i=0;i<o;i++)t.modelService.deleteModel(e.data.models[i].id)};this.errorService.error(o,"deletePackageOnPublishFailure",{title:r,dialogOptions:n,dismissCallback:s,isDismissable:!0,showAdditionalErrorInfo:!0,requestId:e?e.requestId:"",statusCode:e?e.status.toString():""})},r})();t.PackageService=l})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){function r(e,t,r,o,i,n,s,c){return new a(e,t,r,o,i,n,s,c)}var o=jsCommon.EnumExtensions,i=e.common.contracts.PackageType;t.createPermissionService=r;var a=(function(){function r(e,t,r,o,i,a,n,s){this.activeFolderIdService=e,this.impersonationService=t,this.appCollectionService=r,this.packageCollectionService=o,this.modelCollectionService=i,this.reportCollectionService=a,this.dashboardCollectionService=n,this.telemetryService=s,this.errorsLogged={}}return Object.defineProperty(r.prototype,"activeWorkSpacePermission",{get:function(){return this.activeFolderIdService.isReadOnly?1:7},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"isActiveWorkspaceIsReadOnly",{get:function(){return this.impersonationService.impersonating||!o.hasFlag(this.activeWorkSpacePermission,2)},enumerable:!0,configurable:!0}),r.prototype.isGroupWorkspaceReadOnly=function(e,t){var r=e&&!t?1:7;return!o.hasFlag(r,2)},r.prototype.getReportEffectivePermissions=function(e){var r=e&&e.permissions;return null==r?this.logErrorIfItemNotFoundForType("report",e.id):e&&e.packageId&&(t.PermissionsUtils.markDashboardAndReportsAsCopyableIfPartOfTemplateInstance(null,[e.id],null,e.packageId,this.modelCollectionService,this.reportCollectionService,this.dashboardCollectionService,this.packageCollectionService,this.appCollectionService),r=e&&e.permissions),r},r.prototype.getModelEffectivePermissions=function(e){var t=e&&e.permissions;return t=this.calculateDerivedPermissionsFromPackage(t,e.packageId),null==t&&this.logErrorIfItemNotFoundForType("model",e.id,e.packageId),t},r.prototype.getDashboardEffectivePermissions=function(e){var r=e&&e.permissions;return null==r?this.logErrorIfItemNotFoundForType("dashboard",e.id):e&&e.originalPackageId&&(t.PermissionsUtils.markDashboardAndReportsAsCopyableIfPartOfTemplateInstance([e.id],null,null,e.originalPackageId,this.modelCollectionService,this.reportCollectionService,this.dashboardCollectionService,this.packageCollectionService,this.appCollectionService),r=e&&e.permissions),r},r.prototype.getWorkbookEffectivePermissions=function(e){var t=e&&e.permissions;return t=this.calculateDerivedPermissionsFromPackage(t,e.packageId),null==t&&this.logErrorIfItemNotFoundForType("workbook",e.id),t},r.prototype.getPackageEffectivePermissions=function(e){var t=e&&e.permissions;return null==t&&this.logErrorIfItemNotFoundForType("package",e.id,e.id),t},r.prototype.isOriginalWorkbook=function(e){var t=this.packageCollectionService.findPackageContract(e.packageId);return!!t&&!t.contentProviderRefId},r.prototype.isOwnedOriginalModel=function(e){var t=e.getPermissions();if(!o.hasFlag(t,7))return!1;if(o.hasFlag(t,17))return!1;var r=this.packageCollectionService.findPackageContract(e.packageId);return!!r&&!r.contentProviderRefId&&r.packageType!==i.AppInstance},r.prototype.isExplorableModel=function(e,t){var r=this.packageCollectionService.findPackageContract(e.packageId);return this.isExplorableModelPermission(e.getPermissions(),r,t)},r.prototype.isExplorableModelPermission=function(e,t,r){return r?2===(2&e)||8===(8&e):t&&t.permissions?1===(1&e)&&2===(2&t.permissions)&&(t.packageType!==i.AppInstance||!t.serviceContentProviderId):3===(3&e)},r.prototype.calculateDerivedPermissionsFromPackage=function(e,t){var r=16,o=this.packageCollectionService.findPackageContract(t),i=!!o&&o.permissions;if(!i)return e;var a=0;return a|=e&~r,a|=i&r},r.prototype.logErrorIfItemNotFoundForType=function(t,r,o){this.errorsLogged[t]||(this.errorsLogged[t]=!0,this.telemetryService.logEvent(e.telemetry.PermissionsObjectNotFound,r,o,t))},r})()})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){function r(e,t,r,o){return new i(e,t,r,o)}var o=e.visualHost.utils.ResourcePackageUtils;t.createResourcePackageListenerService=r;var i=(function(){function e(e,t,r,o){this.httpService=e,this.resourcePackageService=t,this.promiseFactory=r,this.visualPluginService=o}return e.prototype.onResourcePackageAdded=function(e){return this.getAndLoadVisualPlugin(e)},e.prototype.getResourcePackageByResourceId=function(e){var t=this,r=this.promiseFactory.defer(),o=this.resourcePackageService.getPackageById(e);if(o)return r.resolve([o]),r.promise;var i=this.httpService.powerbiRequestOptions(null,"GetResourcePackageByResourceId");return this.httpService.post("/powerbi/metadata/resourcePackage",[e],i).then((function(o){var i=t.resourcePackageService.getPackageById(e);return i?void r.resolve([i]):(t.resourcePackageService.registerPackages(o.data),void r.resolve(o.data))}),(function(e){r.reject()})),r.promise},e.prototype.getAndLoadVisualPlugin=function(e){var t=this,r=this.promiseFactory.defer();return this.getResourcePackageByResourceId(e).then((function(e){t.visualPluginService.ensurePlugins(e).then((function(){return r.resolve(e)}),(function(){return r.reject()}))}),(function(){return r.reject()})),r.promise},e.prototype.getAndLoadVisualPluginsForDashboard=function(e){var t=this,r=this.getAllRequiredResourcePackageIds(e);return this.loadRequiredResourcePackagesAndVisualPlugins(r).then((function(e){var r=_.chain(e).filter((function(e){return 0===e.type})).map((function(e){return t.getCustomVisualTypesFromResourcePackages(e.value)})).flatten(!1).uniq().value();return t.promiseFactory.resolve(r)}))},e.prototype.getCustomVisualTypesFromResourcePackages=function(e){return o.getCustomVisualTypes(e)},e.prototype.getLoadedCustomVisualTypesForDashboard=function(e){var t=[];if(e&&e.tiles)for(var r=0,i=e.tiles;r<i.length;r++){var a=i[r],n=a.contract.resourcePackageIds;if(n)for(var s=0,c=n;s<c.length;s++){var l=c[s],d=this.resourcePackageService.getPackageById(l);o.isCustomVisualResourcePackage(d)&&t.push(d.name)}}return _.uniq(t)},e.prototype.getAllRequiredResourcePackageIds=function(e){var t=[];if(e&&e.tiles)for(var r=0,o=e.tiles;r<o.length;r++){var i=o[r],a=i.contract.resourcePackageIds;if(a)for(var n=0,s=a;n<s.length;n++){var c=s[n];t.push(c)}}return _(t).uniq().value()},e.prototype.getAllRequiredResourcePackageIdStrings=function(e){var t=this.getAllRequiredResourcePackageIds(e);return $.map(t,(function(e){return e.toString()}))},e.prototype.loadRequiredResourcePackagesAndVisualPlugins=function(e){for(var t=[],r=0,o=e;r<o.length;r++){var i=o[r];t.push(this.getAndLoadVisualPlugin(i))}return this.promiseFactory.allSettled(t)},e})();t.ResourcePackageListenerService=i})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){function r(e,t,r,o){return new i(e,t,r,o)}var o=e.errorDetailsHelper;t.createSmartAlertsService=r;var i=(function(){function t(e,t,r,o){this.telemetryService=e,this.errorService=t,this.localizationService=r,this.smartAlertsHttpService=o}return t.prototype.onDemandSmartAlerts=function(t){var r=this,i={modelId:t.id,databaseName:t.dbName,virtualServerName:t.vsName},a=this.telemetryService.startEvent(e.telemetry.DatasetOnDemandSmartAlerts);this.smartAlertsHttpService.onDemandSmartAlerts(i,a.event).then((function(){a.resolve()}),(function(e){a.reject(o.getTelemetryErrorDetails(e.error,e.status)),r.errorService.error(r.localizationService.get("SmartAlerts_FailToGenerateSmartAlerts"),"SmartAlerts_FailToGenerateSmartAlerts",{requestId:e.requestId,statusCode:e.status.toString()})}))},t})();t.SmartAlertsService=i})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t,r=jsCommon.ArrayExtensions;!(function(e){function t(e,t){if(e)for(var r=e.length,o=0;o<r;o++)if(e[o].id===t)return e[o].contentProviderId;return null}function o(e){var t=i(e);if(t&&t.Commands&&t.Commands.length>0){var r=t.Commands[0].SemanticQueryDataShapeCommand;return{defn:r.Query,shape:r.Binding}}return null}function i(e){if(e&&e.modelQuery&&e.modelQuery.sq){var t;try{t=JSON.parse(e.modelQuery.sq)}catch(e){}if(t){var r=null;return l(t)?r=t.dataQuery:d(t)?r=t:p(t)&&(r={Commands:[{SemanticQueryDataShapeCommand:{Query:t.defn,Binding:t.shape}}]}),r}}}function a(e){return void 0===e&&(e={}),{layouts:[{id:0,position:e}]}}function n(e){var t=s(e,0);return t}function s(e,t){var o=r.extendWithId(e.$layoutConfig.layouts),i=o.withId(t);return i?i.position:null}function c(e){switch(e){case 0:return"pbix";case 1:return"rdl";default:return"unknown"}}function l(e){return e.dataQuery&&e.dataQuery.Commands&&e.dataQuery.Commands.length>0;
}function d(e){return e.Commands&&e.Commands.length>0}function p(e){return e.defn}e.findContentProviderId=t,e.convertToSemanticQueryWithDataShapeBinding=o,e.convertToTileDataQuery=i,e.createMasterLayoutConfig=a,e.getMasterLayoutPosition=n,e.getLayoutPosition=s,e.reportTypeToString=c})(t=e.ContractUtils||(e.ContractUtils={}))})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){function r(e,t,r,o,i,n,s,c,l,d,p,u,h,f,v,m){return new a(e,t,r,o,i,n,s,c,l,d,p,u,h,f,v,m)}var o=jsCommon.EnumExtensions,i=e.common.contracts.SyncEntityType;t.createReportService=r;var a=(function(){function r(e,t,r,o,a,n,s,c,l,d,p,u,h,f,v,m){var g=this;this.rootScope=e,this.telemetryService=t,this.errorService=r,this.modelMerger=o,this.modelConverter=a,this.syncService=n,this.reportHttpService=s,this.localizationService=c,this.appMetadataService=l,this.promiseFactory=d,this.reportCollectionService=p,this.permissionService=u,this.reportStore=h,this.asyncFeatureSwitchService=f,this.userInfo=v,this.fetchEntityService=m,this.reportsDeferred=this.promiseFactory.defer(),this.syncService.addReportRefreshListener(this);var y={ensureFetched:function(e){return g.ensureFetched(e)}};this.fetchEntityService.addFetchEntityHandler(i.Report,y),this.asyncFeatureSwitchService.getFeatureSwitches().then((function(e){g.storeEnabled=e.ngrxStore,g.storeEnabled?g.subscribeReports():g.initReports()}))}return r.prototype.subscribeReports=function(){var e=this;this.appMetadataService.getAppMetadata().then((function(){e.reportStore.reports.subscribe((function(t){e.reportCollectionService.reports=t.map((function(t){var r=_.find(e.reportCollectionService.reports,(function(e){return e.objectId===t.objectId}));return r?(e.modelMerger.mergeReport(r,t),r):e.modelConverter.convertReport(t)})),e.reportsDeferred.resolve(e)})),e.reportStore.selectedReport.subscribe((function(t){e.currentActiveReport=t?{id:t.id,displayName:t.displayName,guid:t.objectId}:null}))}))},r.prototype.ensureReportsInitialization=function(){return this.reportsDeferred.promise},Object.defineProperty(r.prototype,"reports",{get:function(){return this.reportCollectionService.reports},set:function(e){this.reportCollectionService.reports=e},enumerable:!0,configurable:!0}),r.prototype.getReports=function(){return this.reportsDeferred.promise.then((function(e){return e.reports}))},r.prototype.updateCurrentActiveReport=function(e){this.reportStore.select(e)},r.prototype.onReportAdded=function(t){return __awaiter(this,void 0,e.Promise,(function(){var e,r,o=this;return __generator(this,(function(i){return this.storeEnabled?(e=this.promiseFactory.defer(),this.reportStore.addFromSyncService(t,e),[2,e.promise]):(r=this.findReport(t),!r||jsCommon.StringExtensions.isNullOrUndefinedOrWhiteSpaceString(r.displayName)?[2,this.reportHttpService.getReport(t,null).then((function(e){var i=e.data;if(r=o.findReport(t))o.modelMerger.mergeReport(r,i);else{var a=o.modelConverter.convertReport(i);a.isNew=!0,o.addReport(a)}}),(function(){}))]:[2,this.promiseFactory.resolve(null)])}))}))},r.prototype.onReportDeleted=function(e){if(this.storeEnabled){var t=this.findReport(e);if(!t)return;return this.reportStore.delete(t.contract,!0),void this.reportCollectionService.onDeleted(t)}var r=this.findReport(e);r&&this.removeReport(r.objectId)},r.prototype.onReportSlideThumbnailEdit=function(){},r.prototype.onReportUpdated=function(t){return __awaiter(this,void 0,e.Promise,(function(){var r,o=this;return __generator(this,(function(i){if(this.storeEnabled)this.reportStore.load(t);else{if(this.reports.length<0)return[2];r=this.findReport(t),r&&this.reportHttpService.getReport(t,null).then((function(i){o.modelMerger.mergeReport(r,i.data),o.currentActiveReport={id:t,displayName:r.displayName,guid:r.objectId},o.rootScope.$emit(e.common.constants.currentActiveReportInfoChangedEventName,o.currentActiveReport)}),_.noop)}return[2]}))}))},r.prototype.ensureFetched=function(e){var t=e.id;return this.findReport(t)?this.promiseFactory.resolve(null):this.onReportAdded(t)},r.prototype.retrieveReportForApp=function(e,t){if(null!=e&&!_.isEmpty(t))return _.find(this.reports,(function(r){return r.packageId===e&&r.contract.originalReportObjectId===t}))},r.prototype.updateReportCollection=function(e){var t=[];if(!_.isEmpty(e))for(var r=0,o=e.length;r<o;++r)t.push(this.modelConverter.convertReport(e[r]));this.reports=t},r.prototype.mergeReportCollection=function(e){if(!_.isEmpty(e))for(var t=_.keyBy(this.reports,"id"),r=0,o=e;r<o.length;r++){var i=o[r];t[i.id]||this.addReport(this.modelConverter.convertReport(i))}},r.prototype.updateReport=function(e){var t=this.findReport(e.id);return t&&this.modelMerger.mergeReport(t,e),t},r.prototype.getReportContracts=function(){return this.reportCollectionService.getReportContracts()},Object.defineProperty(r.prototype,"copyAndEditReports",{get:function(){var e=this.permissionService;return _.filter(this.reports,(function(t){var r=e.getReportEffectivePermissions(t.contract);return o.hasFlag(r,2)||o.hasFlag(r,17)}))},enumerable:!0,configurable:!0}),r.prototype.deleteReportsForModel=function(e,t){for(var r=_.filter(this.reports,(function(r){return r.modelId===e&&r.packageId===t})),o=0,i=r.length;o<i;++o)this.onReportDeleted(r[o].id);return r},r.prototype.deleteReportForPackage=function(e){for(var t=_.filter(this.reports,(function(t){return t.packageId===e})),r=0,o=t.length;r<o;++r)this.onReportDeleted(t[r].id)},r.prototype.addContractReport=function(e){if(e&&null!=e.id){var t=this.modelConverter.convertReport(e);this.reports&&!_.find(this.reports,(function(t){return t.id===e.id}))&&(t.isNew=!0,this.addReport(t))}},r.prototype.addReport=function(e){this.storeEnabled?(this.reportCollectionService.addReport(e),this.reportStore.ensure(e.contract)):this.reportCollectionService.addReport(e)},r.prototype.tryAddReport=function(e){var t=e.id;if(t){if(!this.findReport(t)){var r=this.modelConverter.convertReport(e);return r.isNew=!0,this.addReport(r),r}}},r.prototype.removeReport=function(e){var t=this.findReportByGUID(e);if(null!=t)return this.reportCollectionService.removeReport(t.id),t},r.prototype.deleteReport=function(e){this.deleteReportInternal(e)},r.prototype.updateReportVisibility=function(t,r){return __awaiter(this,void 0,e.Promise,(function(){var o,i,a,n;return __generator(this,(function(s){switch(s.label){case 0:if(o=this.findReportByGUID(t),this.storeEnabled)return i=this.telemetryService.startEvent(e.telemetry.PermissionsUpdateArtifactVisibility,o.id,2,r),this.reportStore.updateVisibility(o.contract,r,i),[2];s.label=1;case 1:return s.trys.push([1,3,,4]),[4,this.updateArtifactVisibility(2,o.id,r)];case 2:return a=s.sent(),o.isHidden=a.data&&a.data.isHidden,[3,4];case 3:return n=s.sent(),this.errorService.error(this.localizationService.get("Sharing_FailedToUpdateArtifactVisibility"),"Sharing_FailedToUpdateArtifactVisibility",{requestId:n.requestId,statusCode:n.status&&n.status.toString()}),[2];case 4:return[2]}}))}))},r.prototype.updateArtifactVisibility=function(t,r,o){var i=this.telemetryService.startEvent(e.telemetry.PermissionsUpdateArtifactVisibility,r,t,o);return this.reportHttpService.updateArtifactVisibility(t,r,o,i.event).then((function(e){return i.resolve(),e}),(function(t){throw i.reject(e.errorDetailsHelper.getTelemetryErrorDetails(t.error,t.status)),t}))},r.prototype.findReport=function(e){return null!=e?_.find(this.reports,(function(t){return t.id===e})):null},r.prototype.findReportByGUID=function(e){return null!=e?_.find(this.reports,(function(t){return t.objectId===e})):null},r.prototype.findReportByOriginalReportId=function(e){return null!=e?_.find(this.reports,(function(t){return t.contract.originalReportId===e})):null},r.prototype.findReportsByPackageId=function(e){return _.filter(this.reports,(function(t){return t.packageId===e}))},r.prototype.renameReport=function(r,o){var i=this;if(!_.isEmpty(r.trim())){var a=this.findReport(o),n=this.telemetryService.startEvent(e.telemetry.DashboardRenameReport,a?t.ContractUtils.reportTypeToString(a.reportType):"");if(this.storeEnabled)this.reportStore.rename(a.contract,r,n);else{if(!a)return;var s=a.contract.displayName;s!==r&&(a.displayName=r,this.reportHttpService.renameReport(a,r,n.event).then((function(){n.resolve(),a&&a.isUsedByContentPack&&i.rootScope.$emit(t.constants.contentPackDirtyShowNotification,a.id,t.models.ContentPackItems.Report),i.rootScope.$emit(e.common.constants.currentActiveReportInfoChangedEventName,{id:o,displayName:a.displayName,guid:a.objectId})}),(function(e){401===e.status?i.errorService.error(i.localizationService.get("Report_NoPermissionToRenameMessage"),"Report_NoPermissionToRename",{requestId:e.requestId,statusCode:e.status.toString()}):i.errorService.error(i.localizationService.get("Report_FailToRenameReportMessage"),"Report_FailToRenameReport",{requestId:e.requestId,statusCode:e.status.toString()}),a.displayName=s,n.reject()})))}}},r.prototype.initReports=function(){var e=this;this.appMetadataService.getAppMetadata().then((function(t){e.loadReports(t)}),(function(){e.loadReports()}))},r.prototype.deleteReportInternal=function(r){return __awaiter(this,void 0,e.Promise,(function(){var o,i,a,i,n=this;return __generator(this,(function(s){if(this.asyncFeatureSwitchService.featureSwitches.ngrxStore)o=this.findReportByGUID(r),i=this.telemetryService.startEvent(e.telemetry.DashboardDeleteReport,o?t.ContractUtils.reportTypeToString(o.reportType):"",o?o.id:-1,o?o.objectId:void 0),this.reportStore.delete(o,!1,i),this.reportCollectionService.onDeleted(o);else{if(a=this.removeReport(r),i=this.telemetryService.startEvent(e.telemetry.DashboardDeleteReport,a?t.ContractUtils.reportTypeToString(a.reportType):"",a?a.id:-1,a?a.objectId:void 0),null==a)return i.resolve(),[2];this.reportHttpService.deleteReport(a.contract,i.event).then((function(){n.rootScope.$emit(t.constants.reportDeletedEventName,a.id),i.resolve(),a&&a.isUsedByContentPack&&n.rootScope.$emit(t.constants.contentPackDirtyShowNotification,a.id,t.models.ContentPackItems.Report)}),(function(e){401===e.status?n.errorService.error(n.localizationService.get("Report_NoPermissionToDeleteMessage"),"Report_NoPermissionToDelete",{requestId:e.requestId,statusCode:e.status.toString()}):n.errorService.error(n.localizationService.get("Report_FailToDeleteReportMessage"),"Report_FailToDeleteReport",{requestId:e.requestId,statusCode:e.status.toString()}),n.addReport(a),i.reject()}))}return[2]}))}))},r.prototype.loadReports=function(t){var r=this;if(t)t.reports&&(this.updateReportCollection(t.reports),this.reportsDeferred.resolve(this));else{var o=this.telemetryService.startEvent(e.telemetry.DashboardInitializeNavigationPaneReports);this.reportHttpService.getReports(o.event).then((function(e){var t=e.data;r.updateReportCollection(t),o.resolve(),r.reportsDeferred.resolve(r)}),(function(){o.reject(),r.reportsDeferred.reject()}))}},r.prototype.reportsOwnersMergedPromise=function(){return this.reportsOwnersMergedDeferred||(this.reportsOwnersMergedDeferred=this.promiseFactory.defer(),this.mergeReportOwnerInfoOnPageLoad()),this.reportsOwnersMergedDeferred.promise},r.prototype.mergeReportOwnerInfoOnPageLoad=function(){var e=this;this.userInfo.userMetadataPromise.then((function(t){t?(e.mergeReportOwnerInfo(t),e.reportsOwnersMergedDeferred.resolve(null)):e.reportsOwnersMergedDeferred.reject()}),(function(){e.reportsOwnersMergedDeferred.reject()}))},r.prototype.mergeReportOwnerInfo=function(e){if(e&&e.artifactOwnerInfo)for(var t=0,r=e.artifactOwnerInfo;t<r.length;t++){var o=r[t];if(2===o.artifactType){var i=this.findReport(o.artifactId);i&&this.modelMerger.mergeArtifactOwnerInfo(i,o)}}},r.prototype.subscribe=function(e){this.reportCollectionService.subscribe(e)},r.prototype.unsubscribe=function(e){this.reportCollectionService.unsubscribe(e)},r})();t.ReportService=a})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){function r(){return new i}var o=e.common.NotifyCollection;t.createReportCollectionService=r;var i=(function(){function e(){this.listeners=[],this.collection=new o}return Object.defineProperty(e.prototype,"reports",{get:function(){return this.collection.items},set:function(e){this.collection.setItems(e)},enumerable:!0,configurable:!0}),e.prototype.getReportContracts=function(){return _.map(this.reports,(function(e){return e.contract}))},e.prototype.findReportContract=function(e){var t=this.getReportContracts();return _.find(t,(function(t){return t.id===e}))},e.prototype.onAdded=function(e){for(var t=this.listeners,r=0,o=t;r<o.length;r++){var i=o[r];i.onReportAdded&&i.onReportAdded(e)}},e.prototype.onDeleted=function(e){for(var t=this.listeners,r=0,o=t;r<o.length;r++){var i=o[r];i.onReportDeleted&&i.onReportDeleted(e)}},e.prototype.onReset=function(){for(var e=this.listeners,t=0,r=e;t<r.length;t++){var o=r[t];o.onReportsReset&&o.onReportsReset()}},e.prototype.addReport=function(e){this.collection.addItem(e)},e.prototype.removeReport=function(e){this.collection.deleteItems((function(t){return t.id===e}))},e.prototype.subscribe=function(e){this.listeners.length<1&&this.collection.subscribe(this),this.listeners.push(e)},e.prototype.unsubscribe=function(e){_.pull(this.listeners,e),this.listeners.length<1&&this.collection.unsubscribe(this)},e})()})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r=e.common.models.ReportPermissions,o=e.common.helpers.UserInfoHelper,i=(function(){function t(e){this.userInfo=e}return t.prototype.mapReportOwnerFullnames=function(e,t,r,o){this.mapResourceOwnerFullnames(e,t,r,o,"reportIds")},t.prototype.mapWorkbookOwnerFullnames=function(e,t,r,o){this.mapResourceOwnerFullnames(e,t,r,o,"workbookIds")},t.prototype.mapResourceOwnerFullnames=function(e,t,r,o,i){for(var a=0,n=e;a<n.length;a++){var s=n[a];s.ownerFullname||(s.ownerFullname=this.getOwnerFullname(s.getPermissions(),s.packageId,i,s.id,t,r,o))}},t.prototype.getOwnerFullnameFromUserInfo=function(){var e=this.userInfo;return e?o.getFullName(e.givenName,e.surname):""},t.prototype.hasPermission=function(e,t){return(e&t)===t},t.prototype.getOwnerFromGroupOrUser=function(t,r){return t===e.common.constants.myWorkspaceFolderId?this.getOwnerFullnameFromUserInfo():r},t.prototype.getOwnerFromUserInfo=function(e,t,o){return this.hasPermission(e,r.Personalized)?this.getOwnerFromGroupOrUser(t,o):""},t.prototype.getOwnerFromDashboard=function(e){return e&&e.ownerFullname||""},t.prototype.getOwnerFullname=function(e,t,r,o,i,a,n){for(var s,c,l,d=0,p=i;d<p.length;d++){var u=p[d],h=u.contract;if(t){if(h.originalPackageId===t){s=u;break}!c&&h.packageIds&&_.includes(h.packageIds,t)&&(c=u)}!l&&h[r]&&_.includes(h[r],o)&&(l=u)}var f=s||c||l;return f?this.getOwnerFromDashboard(f):17===e?"":this.getOwnerFromUserInfo(e,a,n)},t})();t.ResourceOwnershipService=i})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){function r(){return new a}var o=e.common.models.Model,i=e.common.NotifyCollection;t.createModelCollectionService=r;var a=(function(){function e(){this.listeners=[],this.collection=new i,this.modelsMap={}}return Object.defineProperty(e.prototype,"models",{get:function(){return this.collection.items},set:function(e){this.collection.setItems(e),this.modelsMap={};for(var t=0,r=e;t<r.length;t++){var o=r[t];this.modelsMap[o.uniqueId]=o}},enumerable:!0,configurable:!0}),e.prototype.getModelContracts=function(){return _.map(this.models,(function(e){return e.contract}))},e.prototype.onAdded=function(e){for(var t=this.listeners,r=0,o=t;r<o.length;r++){var i=o[r];i.onModelAdded&&i.onModelAdded(e)}},e.prototype.onDeleted=function(e){for(var t=this.listeners,r=0,o=t;r<o.length;r++){var i=o[r];i.onModelDeleted&&i.onModelDeleted(e)}},e.prototype.onReset=function(){for(var e=this.listeners,t=0,r=e;t<r.length;t++){var o=r[t];o.onModelsReset&&o.onModelsReset()}},e.prototype.findModel=function(e,t){return this.modelsMap[o.getUniqueId(e,t)]},e.prototype.addModel=function(e){this.collection.addItem(e),this.modelsMap[e.uniqueId]=e},e.prototype.removeModel=function(e,t){var r;return r=t?function(r){return r.id===e&&r.packageId===t}:function(t){return t.id===e},!_.isEmpty(this.removeModels(r))},e.prototype.removeModels=function(e){var t=this.collection.deleteItems(e);if(!_.isEmpty(t))for(var r=this.modelsMap,o=0,i=t;o<i.length;o++){var a=i[o];delete r[a.uniqueId]}return t},e.prototype.subscribe=function(e){this.listeners.length<1&&this.collection.subscribe(this),this.listeners.push(e)},e.prototype.unsubscribe=function(e){_.pull(this.listeners,e),this.listeners.length<1&&this.collection.unsubscribe(this)},e})()})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){function r(e,t,r,o,i,a,n,c,l,d,p,u,h,f,v,m,g){return new s(e,t,r,o,i,a,n,c,l,d,p,u,h,f,v,m,g)}var o=jsCommon.EnumExtensions,i=e.common.contracts.PermissionArtifactType,a=jsCommon.StringExtensions,n=e.common.contracts.SyncEntityType;t.createModelService=r;var s=(function(){function r(e,t,r,o,i,a,s,c,l,d,p,u,h,f,v,m,g){var y=this;this.rootScope=e,this.telemetryService=t,this.errorService=r,this.modelMerger=o,this.modelConverter=i,this.syncService=a,this.modelHttpService=s,this.localizationService=c,this.reportService=l,this.appMetadataService=d,this.promiseFactory=p,this.dataProxy=u,this.modelCollectionService=h,this.permissionService=f,this.asyncFeatureSwitchService=v,this.datasetStore=m,this.fetchEntityService=g,this.modelUpdateListeners=[],this.syncService.addModelRefreshListener(this);var b={ensureFetched:function(e){return y.ensureFetched(e)}};this.fetchEntityService.addFetchEntityHandler(n.Model,b),this._modelsDeferred=this.promiseFactory.defer(),this.asyncFeatureSwitchService.getFeatureSwitches().then((function(e){y.isStoreEnabled=e.ngrxStore,y.isInsightAppEnabled=e.insightApps,y.explorePermissionOnDataset=e.explorePermissionOnDataset,y.sharedDatasetDiscoveryEnabled=e.sharedDatasetDiscovery,y.isStoreEnabled?y.subscribeDataset():y.initModels()}))}return Object.defineProperty(r.prototype,"models",{get:function(){return this.modelCollectionService.models},set:function(e){this.modelCollectionService.models=e},enumerable:!0,configurable:!0}),r.prototype.applyModelUpdated=function(e,t){for(var r=0,o=this.modelUpdateListeners;r<o.length;r++){o[r].onModelUpdated(e,t)}},r.prototype.onModelAdded=function(e,t){if(this.findModel(e,t))return this.promiseFactory.resolve(null);if(this.isStoreEnabled){var r=this.promiseFactory.defer();return this.datasetStore.add(e,t,r),r.promise}var o=this.findModels(e,t);if(_.isEmpty(o))return this.addOrUpdateModel(e,t);for(var i=[],n=0,s=o;n<s.length;n++){var c=s[n];if(a.isNullOrUndefinedOrWhiteSpaceString(c.displayName)){var l=this.addOrUpdateModel(c.id,c.packageId,c);i.push(l)}}return this.promiseFactory.all(i)},r.prototype.addOrUpdateModel=function(e,r,o){var i=this;return this.modelHttpService.getModel(e,r,null,!0).then((function(r){var a=r.data,n=i.modelConverter.convertModel(a);o=i.findModel(e,a.packageId),o?(i.modelMerger.mergeModel(o,a),i.applyModelUpdated(o.id,o.packageId)):(n.isNew=!0,i.pushModel(n),i.rootScope.$emit(t.constants.onDatasetAddedEventName,a)),i.updateTimestamp()}))},r.prototype.pushModel=function(e){this.modelCollectionService.addModel(e)},r.prototype.removeModel=function(e,t){if(_.isEmpty(this.models))return!1;var r=this.modelCollectionService.removeModel(e,t);return r&&this.updateTimestamp(),r},r.prototype.onModelDeleted=function(t,r){return __awaiter(this,void 0,e.Promise,(function(){var e,o=this;return __generator(this,(function(i){switch(i.label){case 0:return this.isStoreEnabled?(e=void 0,r?[4,this.datasetStore.findById(t,r)]:[3,2]):[3,5];case 1:return e=[i.sent()],[3,4];case 2:return[4,this.datasetStore.findAll(t)];case 3:e=i.sent(),i.label=4;case 4:return e.forEach((function(e){return o.datasetStore.delete(e,!0)})),this.updateTimestamp(),[2];case 5:return this.models?(this.removeModel(t,r),[2]):[2]}}))}))},r.prototype.onModelsUpdated=function(e){var t=this;if(this.isStoreEnabled){var r=this.promiseFactory.defer();return r.promise.then((function(e){for(var r=0,o=e;r<o.length;r++){var i=o[r];t.applyModelUpdated(i.modelId,i.packageId)}t.updateTimestamp()})),void this.datasetStore.bulkLoad(e,r)}for(var o=0,i=e;o<i.length;o++){var a=i[o];this.onModelUpdated(a.modelId,a.packageId)}},r.prototype.onModelUpdated=function(e,t){var r=this;if(this.models){var o=this.findModels(e,t);if(!_.isEmpty(o))for(var i=function(t){a.modelHttpService.getModel(e,t.packageId,null,!0).then((function(e){r.modelMerger.mergeModel(t,e.data),r.applyModelUpdated(t.id,t.packageId),r.updateTimestamp();var o=e.data;r.dataProxy.clearCache("dsr",[{dbName:o.dbName,modelId:o.id,vsName:o.vsName,schemaName:void 0}])}))},a=this,n=0,s=o;n<s.length;n++){var c=s[n];i(c)}}},r.prototype.ensureFetched=function(e){return this.onModelAdded(e.id,void 0)},r.prototype.addModelUpdateListener=function(e){this.modelUpdateListeners.push(e)},r.prototype.removeModelUpdateListener=function(e){_.pull(this.modelUpdateListeners,e)},Object.defineProperty(r.prototype,"modelsPromise",{get:function(){return this._modelsDeferred.promise},enumerable:!0,configurable:!0}),r.prototype.updateDatasetCollection=function(e){var t=[];if(!_.isEmpty(e))for(var r=0,o=e.length;r<o;++r)t.push(this.modelConverter.convertModel(e[r]));this.modelCollectionService.models=t,this.updateTimestamp()},r.prototype.mergeDatasetCollection=function(e){if(!_.isEmpty(e))for(var t=_.keyBy(this.models,"id"),r=0,o=e;r<o.length;r++){var i=o[r];t[i.id]?this.updateContractModel(i):this.pushModel(this.modelConverter.convertModel(i))}},r.prototype.getModelContracts=function(){return this.modelCollectionService.getModelContracts()},r.prototype.deleteModelForPackage=function(e){for(var t=this.getModelsByPackageId(this.models,e),r=0,o=t.length;r<o;++r)this.onModelDeleted(t[r].id,e)},r.prototype.updateContractModel=function(e){if(e){var t=this.findModel(e.id,e.packageId);t&&(this.modelMerger.mergeModel(t,e),this.applyModelUpdated(t.id,t.packageId))}},r.prototype.addContractModel=function(e){if(e){var t=this.modelConverter.convertModel(e);this.getModelIndex(t.id,t.packageId)<0&&(t.isNew=!0,this.addModel(t))}},r.prototype.addModel=function(e){if(e){this.getModelIndex(e.id,e.packageId)<0&&(this.modelCollectionService.addModel(e),this.updateTimestamp())}},r.prototype.deleteModel=function(r,o){var i=this,a=this.findModels(r,o);if(!_.isEmpty(a))for(var n=function(o){var a=s.telemetryService.startEvent(e.telemetry.DashboardDeleteDataset);if(s.getModelIndex(r,o.packageId)<0)return a.resolve(),"continue";if(s.isStoreEnabled)return s.datasetStore.delete(o.contract,!1,a),{value:void 0};var n=s.reportService.deleteReportsForModel(r,o.packageId);s.removeModel(r,o.packageId),s.modelHttpService.deleteModel(o.contract,a.event).then((function(){a.resolve(),i.rootScope.$emit(t.constants.deleteModelStartedEventName,r),i.updateTimestamp()}),(function(s){401===s.status?i.errorService.error(i.localizationService.get("Model_NoPermissionToDeleteMessage"),"Model_NoPermissionToDelete",{requestId:s.requestId,statusCode:s.status.toString()}):400===s.status&&s.headers(e.common.PowerBIErrorHeader)===t.constants.CannotDeleteModelPublishedToOrganizationalAppHeader?i.errorService.error(i.localizationService.get("Model_DeleteWaitMessage"),"Model_DeleteWaitMessage",{requestId:s.requestId,statusCode:s.status.toString()}):i.errorService.error(i.localizationService.get("Model_FailToDeleteModelMessage"),"Model_FailToDeleteModel",{requestId:s.requestId,statusCode:s.status.toString()}),i.pushModel(o);for(var c=0,l=n.length;c<l;++c)i.reportService.addReport(n[c]);i.rootScope.$emit(t.constants.deleteModelFailedEventName,r),a.reject()}))},s=this,c=0,l=a;c<l.length;c++){var d=l[c],p=n(d);if("object"==typeof p)return p.value}},r.prototype.getModelIndex=function(e,t){if(this.models.length>0)for(var r=0,o=this.models.length;r<o;r++){var i=this.models[r];if(i.id===e&&i.packageId===t)return r}return-1},r.prototype.getModelIndices=function(e){var t=[];if(this.models.length>0)for(var r=0,o=this.models.length;r<o;r++){var i=this.models[r];i.id===e&&t.push(r)}return t},r.prototype.getModelRefreshSchedule=function(e,t){return this.findModel(e,t).contract.refreshSchedule},r.prototype.findModel=function(e,t,r){var i=this.findModels(e);if(!_.isEmpty(i)){if(1===i.length)return i[0];var a;return null!=t&&(a=this.getModelByPackageId(i,t),a||!r)?a:(a=_.find(i,(function(e){return o.hasFlag(e.getPermissions(),7)})),a||i[0])}},r.prototype.findModels=function(e,t){var r=this.getSearchableModelList();return t?_.filter(r,(function(r){return r.id===e&&r.packageId===t})):_.filter(r,(function(t){return t.id===e}))},r.prototype.findModelByDBName=function(e,t){var r,o=this.getSearchableModelList();return r=t?_.find(o,(function(r){return r.dbName===e&&r.packageId===t})):this.findFirstOwnedModelByDBName(e),r||t||(r=_.find(o,(function(t){return t.dbName===e}))),r},r.prototype.findFirstOwnedModelByDBName=function(e){return _.find(this.getSearchableModelList(),(function(t){return t.dbName===e&&7===(7&t.getPermissions())}))},r.prototype.findFirstExplorableModelByDBName=function(e){var t=this;return _.find(this.getSearchableModelList(),(function(r){return r.dbName===e&&t.permissionService.isExplorableModel(r,t.explorePermissionOnDataset)}))},r.prototype.findModelsByDBName=function(e){return _.filter(this.getSearchableModelList(),(function(t){return t.dbName===e}))},r.prototype.findModelByPackageId=function(e){return this.getModelByPackageId(this.getSearchableModelList(),e)},r.prototype.findModelsByPackageId=function(e){return this.getModelsByPackageId(this.getSearchableModelList(),e)},Object.defineProperty(r.prototype,"editableModels",{get:function(){var e=this;return _.filter(this.models,(function(t){return e.editableModel(t)}))},enumerable:!0,configurable:!0}),r.prototype.canReshare=function(e){var t=this.findModel(e);return this.editableModel(t)},r.prototype.editableModel=function(e){return null!=e&&!e.contract.isHidden&&(t.PermissionsUtils.canReshare(e.getPermissions(),i.Dataset)&&null==e.contract.originalModelId)},r.prototype.isExplorableNonLegacySampleModel=function(e){var r=e.getPermissions();return e.contentProviderId!==t.constants.samplesContentProviderId&&(this.permissionService.isExplorableModel(e,this.explorePermissionOnDataset)||o.hasFlag(r,17))},r.prototype.isActionAllowed=function(e,t){return!(this.isInsightAppEnabled&&o.hasFlag(e.deniedActions,t))},Object.defineProperty(r.prototype,"copyAndEditModels",{get:function(){var e=this;return _.filter(this.models,(function(t){return e.isExplorableNonLegacySampleModel(t)}))},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"sanitizedCopyAndEditModels",{get:function(){var e=this;return _.filter(this.models,(function(t){return e.isExplorableNonLegacySampleModel(t)&&!a.isNullOrUndefinedOrWhiteSpaceString(t.displayName)&&!t.realTimeMode}))},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"streamingModels",{get:function(){var e=this;return _.filter(this.models,(function(t){return e.isExplorableNonLegacySampleModel(t)&&!!t.realTimeMode}))},enumerable:!0,configurable:!0}),r.prototype.renameModel=function(r,o,i){var a=this;if(!_.isEmpty(r.trim())){var n=this.findModel(o,i);if(n){var s=n.contract.displayName;if(s!==r){var c=this.telemetryService.startEvent(e.telemetry.DashboardRenameDataset);if(this.isStoreEnabled)return void this.datasetStore.rename(n.contract,r,c);n.displayName=r,this.modelHttpService.renameModel(n,r,c.event).then((function(){c.resolve();var e=a.findModel(n.id,n.packageId);e&&e.isUsedByContentPack&&a.rootScope.$emit(t.constants.contentPackDirtyShowNotification,e.id,t.models.ContentPackItems.Model)}),(function(e){401===e.status?a.errorService.error(a.localizationService.get("Model_NoPermissionToRenameMessage"),"Model_NoPermissionToRename",{requestId:e.requestId,statusCode:e.status.toString()}):a.errorService.error(a.localizationService.get("Model_FailToRenameModelMessage"),"Model_FailToRenameModel",{requestId:e.requestId,statusCode:e.status.toString()}),n.displayName=s,c.reject()}))}}}},r.prototype.updateModelQnaFeatures=function(t,r){var o=this.promiseFactory.defer(),i=this.telemetryService.startEvent(e.telemetry.DashboardUpdateModelQnaFeatures,r.cortanaEnabled,r.powerBIQnaEnabled);return this.modelHttpService.updateModelQnaFeatures(t,r,i.event).then((function(){i.resolve(),o.resolve({})}),(function(){i.reject(),o.reject()})),o.promise},r.prototype.updateFeaturedQuestions=function(t,r){var o=this.promiseFactory.defer(),i=this.telemetryService.startEvent(e.telemetry.DashboardUpdateFeaturedQuestions,r.length);return this.modelHttpService.updateFeaturedQuestions(t,r,i.event).then((function(){i.resolve(),o.resolve({})}),(function(){i.reject(),o.reject()})),o.promise},r.prototype.removeModels=function(e){this.modelCollectionService.removeModels((function(t){return _.includes(e,t.id)}))&&this.updateTimestamp()},Object.defineProperty(r.prototype,"lastUpdatedTimestamp",{get:function(){return this._lastUpdatedTimestamp},enumerable:!0,configurable:!0}),r.prototype.updateTimestamp=function(){this._lastUpdatedTimestamp=(new Date).getTime()},r.prototype.initModels=function(){var e=this;this.appMetadataService.getAppMetadata().then((function(t){e.loadModels(t)}),(function(){e.loadModels()}))},r.prototype.loadModels=function(t){var r=this;if(t)t.models&&(this.updateDatasetCollection(t.models),this._modelsDeferred.resolve(this.models));else{var o=this.telemetryService.startEvent(e.telemetry.DashboardInitializeNavigationPaneModels);this.modelHttpService.getModels(o.event).then((function(e){r.updateDatasetCollection(e.data),r._modelsDeferred.resolve(r.models),o.resolve()}),(function(){r._modelsDeferred.reject(),o.reject()}))}},r.prototype.getModelByPackageId=function(e,t){return _.find(e,(function(e){return e.packageId===t}))},r.prototype.getModelsByPackageId=function(e,t){return _.filter(e,(function(e){return e.packageId===t}))},r.prototype.subscribe=function(e){this.modelCollectionService.subscribe(e)},r.prototype.unsubscribe=function(e){this.modelCollectionService.unsubscribe(e)},r.prototype.subscribeDataset=function(){var e=this;this.appMetadataService.getAppMetadata().then((function(){e.datasetStore.datasets.subscribe((function(t){var r=e.modelCollectionService;r.models=t.map((function(t){var o=r.findModel(t.id,t.packageId);return o?(o.contract!==t&&e.modelMerger.mergeModel(o,t),o):e.modelConverter.convertModel(t)})),e._modelsDeferred.resolve(e.modelCollectionService.models)}))}))},r.prototype.populateSharedModelInfo=function(){if(!this.sharedDatasetDiscoveryEnabled)return this.promiseFactory.reject();var e=this.promiseFactory.defer();return this.datasetStore.loadShared(e),e.promise},r.prototype.getSearchableModelList=function(){var e=this.models;return this.sharedDatasetDiscoveryEnabled&&(e=e.concat(this.datasetStore.explorableModels)),e},r})();t.ModelService=s})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){function r(){return new i(new o)}var o=e.common.NotifyCollection;t.createCdsaModelCollectionService=r;var i=(function(){function e(e){this.collection=e,this.listeners=[]}return Object.defineProperty(e.prototype,"cdsaModels",{get:function(){return this.collection.items},set:function(e){this.collection.setItems(e)},enumerable:!0,configurable:!0}),e.prototype.onAdded=function(e){for(var t=this.listeners,r=0,o=t;r<o.length;r++){var i=o[r];i.onCdsaModelAdded&&i.onCdsaModelAdded(e)}},e.prototype.onDeleted=function(e){for(var t=this.listeners,r=0,o=t;r<o.length;r++){var i=o[r];i.onCdsaModelDeleted&&i.onCdsaModelDeleted(e)}},e.prototype.onReset=function(){for(var e=this.listeners,t=0,r=e;t<r.length;t++){var o=r[t];o.onCdsaModelsReset&&o.onCdsaModelsReset()}},e.prototype.subscribe=function(e){_.isEmpty(this.listeners)&&this.collection.subscribe(this),this.listeners.push(e)},e.prototype.unsubscribe=function(e){_.pull(this.listeners,e),_.isEmpty(this.listeners)&&this.collection.unsubscribe(this)},e})()})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;
!(function(e){var t;!(function(t){function r(e,t,r,o,i,n,s,c,l,d,p,u,h,f,v){return new a(e,t,r,o,i,n,s,c,l,d,p,u,h,v,f)}var o=jsCommon.StringExtensions;t.createCdsaModelService=r;var i=".json",a=(function(){function t(e,t,r,o,i,a,n,s,c,l,d,p,u,h,f){var v=this;this.appMetadataService=e,this.telemetryService=t,this.asyncFeatureSwitchService=r,this.cdsaModelCollectionService=o,this.cdsaModelHttpService=i,this.cdsaModelStore=a,this.errorService=n,this.fileSaver=s,this.localizationService=c,this.modelConverter=l,this.modelMerger=d,this.notificationToast=p,this.promiseFactory=u,h.addCdsaModelRefreshListener(f),this.cdsaModelsDeferred=this.promiseFactory.defer(),this.asyncFeatureSwitchService.getFeatureSwitches().then((function(e){v.ngrxStoreEnabled=e.ngrxStore,v.ngrxStoreEnabled?v.subscribeCdsaModels():v.getCdsaModelsFromAppMetadata()}))}return Object.defineProperty(t.prototype,"cdsaModels",{get:function(){return this.cdsaModelCollectionService.cdsaModels},set:function(e){this.cdsaModelCollectionService.cdsaModels=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cdsaModelsPromise",{get:function(){return this.cdsaModelsDeferred.promise},enumerable:!0,configurable:!0}),t.prototype.deleteCdsaModel=function(t){var r=this.findCdsaModelById(t);if(r){var o=this.telemetryService.startEvent(e.telemetry.DatapoolDeleteDatapool,r.objectId);this.cdsaModelStore.delete(t,!1,o)}},t.prototype.downloadDplx=function(t,r){return __awaiter(this,void 0,e.Promise,(function(){var e,a,n,s;return __generator(this,(function(c){switch(c.label){case 0:e=this.showDownloadNotification(0),c.label=1;case 1:return c.trys.push([1,3,,4]),[4,this.cdsaModelHttpService.downloadCdsaModel(t)];case 2:return a=c.sent(),n=JSON.stringify(a.data),this.notificationToast.hide(e),this.fileSaver.saveAs(n,o.normalizeFileName(r+i)),this.showDownloadNotification(1,r),[3,4];case 3:return s=c.sent(),this.notificationToast.hide(e),[3,4];case 4:return[2]}}))}))},t.prototype.findCdsaModelByObjectId=function(e){return _.find(this.cdsaModels,(function(t){return t.contract.objectId===e}))},t.prototype.subscribe=function(e){this.cdsaModelCollectionService.subscribe(e)},t.prototype.unsubscribe=function(e){this.cdsaModelCollectionService.unsubscribe(e)},t.prototype.refreshNow=function(t){return __awaiter(this,void 0,e.Promise,(function(){return __generator(this,(function(e){switch(e.label){case 0:return[4,this.cdsaModelHttpService.refreshCdsaModel(t.contract.id)];case 1:return e.sent(),this.cdsaModelStore.updateCurrentRefreshStatus(t.id,4),this.notificationToast.notify({title:this.localizationService.get("RefreshingData"),notificationType:3}),[2]}}))}))},t.prototype.updateCdsaModelCollection=function(e){var t=[];_.isEmpty(e)||(t=this.convertCdsaModels(e)),this.cdsaModelCollectionService.cdsaModels=t},t.prototype.validateDataflowRename=function(e,t){var r=_.filter(this.cdsaModels,(function(r){return r.id!==t&&_.isEqual(_.trim(r.displayName.toLowerCase()),_.trim(e.toLowerCase()))}));return _.isEmpty(r)},t.prototype.updateProperties=function(t,r,o){return __awaiter(this,void 0,e.Promise,(function(){var i,a,n,s,c,l,d,p;return __generator(this,(function(u){switch(u.label){case 0:if(i=this.findCdsaModelById(t),!i)return[2];if(!this.validateDataflowRename(r,t))return i.displayName=i.contract.displayName,i.description=i.contract.description,this.errorService.infoCustom(this.localizationService.get("CdsaModel_CantRenameTitle"),this.localizationService.get("CdsaModel_NameAlreadyExistsMessage")),[2];if(a=this.telemetryService.startEvent(e.telemetry.DatapoolUpdateProperties,i.objectId),this.ngrxStoreEnabled)return this.cdsaModelStore.updateProperties(t,r,o,a),[2];u.label=1;case 1:return u.trys.push([1,5,,6]),[4,this.cdsaModelHttpService.getDataflowModelData(a.event,t)];case 2:return n=u.sent(),s=n.data,c={model:s.model,authoring:{name:r,description:o}},[4,this.cdsaModelHttpService.updateExistingDataflowModel(JSON.stringify(c))];case 3:return l=u.sent(),d=l.data,[4,this.cdsaModelHttpService.saveDataflowModel(a.event,t,d.model,s.modelVersion)];case 4:return u.sent(),a.resolve(),[3,6];case 5:return p=u.sent(),i.displayName=i.contract.displayName,i.description=i.contract.description,this.errorService.error(this.localizationService.get("CdsaModel_FailToUpdatePropertiesMessage"),"FailToUpdateProperties",{requestId:p.requestId,statusCode:p.status.toString()}),a.reject(),[3,6];case 6:return[2]}}))}))},t.prototype.subscribeCdsaModels=function(){var e=this;this.appMetadataService.getAppMetadata().then((function(){e.cdsaModelStore.cdsaModels.subscribe((function(t){e.cdsaModelCollectionService.cdsaModels=t.map((function(t){var r=_.find(e.cdsaModelCollectionService.cdsaModels,(function(e){return e.id===t.id}));return r?(e.modelMerger.mergeCdsaModel(r,t),r):e.modelConverter.convertCdsaModel(t)})),e.cdsaModelsDeferred.resolve(e.cdsaModelCollectionService.cdsaModels)}))}))},t.prototype.findCdsaModelById=function(e){return _.find(this.cdsaModels,(function(t){return t.contract.id===e}))},t.prototype.getCdsaModelsFromAppMetadata=function(){return __awaiter(this,void 0,e.Promise,(function(){var e,t;return __generator(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,this.appMetadataService.getAppMetadata()];case 1:return e=r.sent(),this.loadCdsaModels(e),[3,3];case 2:return t=r.sent(),this.loadCdsaModels(),[3,3];case 3:return[2]}}))}))},t.prototype.loadCdsaModels=function(e){return e?(this.cdsaModels=e.cdsaModels?this.convertCdsaModels(e.cdsaModels):[],void this.cdsaModelsDeferred.resolve(this.cdsaModels)):void this.cdsaModelsDeferred.reject()},t.prototype.convertCdsaModels=function(e){var t=this;return _.map(e,(function(e){return t.modelConverter.convertCdsaModel(e)}))},t.prototype.showDownloadNotification=function(e,t){var r=this.localizationService;switch(e){case 0:return this.notificationToast.notify({title:r.get("ExportingDatapool"),message:r.get("ExportingDatapool_Subtitle"),notificationType:3,sticky:!0});case 1:return this.notificationToast.notify({title:this.localizationService.get("ExportingDatapool_Succeeded"),message:this.localizationService.format("ExportingDatapool_Succeeded_Subtitle",[t]),notificationType:4});default:return}},t})()})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){function r(e,t,r,o,i,a,n,c,l,d,p,u,h,f,v,m,g,y,b){return new s(e,t,r,o,i,a,n,c,l,d,p,u,h,f,v,m,g,y,b)}var o,i=e.common.constants,a=e.common.contracts.SyncEntityType;!(function(e){e[e.NamedRange=0]="NamedRange",e[e.Parameter=1]="Parameter",e[e.Table=2]="Table",e[e.PivotTable=3]="PivotTable",e[e.Chart=4]="Chart",e[e.WebExtension=5]="WebExtension"})(o=t.EwaNamedItemType||(t.EwaNamedItemType={})),t.createWorkbookService=r;var n=".xlsx,.xlsm",s=(function(){function r(e,t,r,o,i,n,s,c,l,d,p,u,h,f,v,m,g,y,b){var S=this;this.asyncFeatureSwitchService=l,this.workbookStore=y,this.fetchEntityService=b,this.workbookCollectionService=m,this.telemetryService=t,this.rootScope=e,this.errorService=r,this.modelMerger=o,this.modelConverter=i,this.syncService=n,this.workbookHttpService=s,this.localizationService=c,this.appMetadataService=d,this.windowService=p,this.promiseFactory=u,this.tutorialDataStore=h,this.compile=f,this.localFileService=v,this.permissionService=g,this.spoAuthenticationTelemetryCollected=!1,this.wopiDataTTL=new Array,this.deferredWopiData=Array(),this.workbooksDeferred=u.defer(),this.syncService.addWorkbookRefreshListener(this);var k={ensureFetched:function(e){return S.ensureFetched(e)}};this.fetchEntityService.addFetchEntityHandler(a.Workbook,k),this.replaceWorkbookScope=this.rootScope.$new(),this.replaceWorkbookScope.shouldReplaceLocalWorkbook=!1,this.asyncFeatureSwitchService.getFeatureSwitches().then((function(e){S.isStoreEnabled=e.ngrxStore,S.isStoreEnabled?S.subscribeWorkbooks():S.initWorkbooks()}))}return Object.defineProperty(r.prototype,"workbooks",{get:function(){return this.workbookCollectionService.workbooks},set:function(e){this.isStoreEnabled,this.workbookCollectionService.workbooks=e},enumerable:!0,configurable:!0}),r.prototype.addContractWorkbook=function(e){if(e&&null!=e.id){var t=this.modelConverter.convertWorkbook(e);this.getWorkbookIndex(t.id,t.packageId)<0&&this.addWorkbook(t)}},r.prototype.addWorkbook=function(e){if(e&&null!=e.id){this.getWorkbookIndex(e.id,e.packageId)<0&&(this.workbookCollectionService.addWorkbook(e),this.updateTimestamp())}},r.prototype.deleteWorkbookForPackage=function(e){for(var t=_.filter(this.workbooks,(function(t){return t.packageId===e})),r=0,o=t.length;r<o;++r)this.onWorkbookDeleted(t[r].id,e)},r.prototype.postUploadWorkbookErrorMessage=function(e){this.postErrorForWorkbook(e,"UploadExcel_FailedToUploadWorkbook_Title","UploadExcel_FailedToUploadWorkbook_Message")},r.prototype.postReplaceWorkbookErrorMessage=function(e){this.postErrorForWorkbook(e,"UploadExcel_FailedToReplaceWorkbook_Title","UploadExcel_FailedToReplaceWorkbook_Message")},r.prototype.postErrorForWorkbook=function(t,r,o){var a=t.headers(e.common.PowerBIErrorHeader),n=o;if(a){var s=e.common.KnownContentProviderErrors[i.excelContentProviderId],c=s&&s[a];c&&c.messageId&&(n=c.messageId)}this.errorService.error(e.common.localize.get(n),n,{requestId:t.requestId,statusCode:t.status.toString(),title:e.common.localize.get(r)})},r.prototype.replaceLocalWorkbook=function(e){var t=this,r=this.findWorkbookByUniqueId(e);this.replaceWorkbookScope.workbookToUpdate=r;var o,i=this.promiseFactory.defer();o=function(){t.localFileService.chooseLocalFile(i,n)},i.promise.then((function(e){t.getUserConsentToReplace(o,e)})),o=function(){t.replaceWorkbook()},this.localFileService.chooseLocalFile(i,n)},r.prototype.showReplaceWorkbookTutorialIfNeeded=function(e){var t=this;return this.neverShowUpdateExplanation=this.tutorialDataStore.hasKey(r.UpdateLocalWorkbookExplanation),this.neverShowUpdateExplanation?void e():void this.showInputDialog("ReplaceLocalWorkbook_Title","ReplaceLocalWorkbook_Message","ReplaceLocalWorkbook_ReplaceFile","UploadReplace_CancelButton",e,"ToastNotification_DontShowThisAgain",(function(){t.neverShowUpdateExplanation=!t.neverShowUpdateExplanation}))},r.prototype.getUserConsentToReplace=function(e,t){if(t){this.replaceWorkbookScope.localWorkbookToUpload=t;var r=t.name;this.replaceWorkbookScope.workbookToUpdate&&this.replaceWorkbookScope.workbookToUpdate.displayNameWithExtension.toLowerCase()!==r.toLowerCase()?this.showInputDialog("ReplaceLocalWorkbook_DifferentName_Title","ReplaceLocalWorkbook_DifferentName_Message","ReplaceLocalWorkbook_ReplaceFile","UploadReplace_CancelButton",e):this.showReplaceWorkbookTutorialIfNeeded(e)}},r.prototype.showInputDialog=function(e,t,r,o,i,a,n){var s,c=this,l=this.errorService.control(),d=[new InJs.ModalDialogAction(this.localizationService.get(r),function(){l.hideDialog(),c.dismissExplanationPermanentlyIfNeeded(),i()}),new InJs.ModalDialogAction(this.localizationService.get(o),function(){l.hideDialog()})];a&&(s=new InJs.ModalDialogAction(this.localizationService.get(a),function(){n()}));var p=this.localizationService.get(e),u=this.localizationService.get(t);l.showCustomDialog(p,angular.element("<div/>").text(u),d,(function(e){e.parent().find('input[value="'+c.localizationService.get(r)+'"]').focus()}),!1,null,null,null,null,null,null,null,null,null,s)},r.prototype.dismissExplanationPermanentlyIfNeeded=function(){if(this.neverShowUpdateExplanation){var t=this.telemetryService.startEvent(e.telemetry.DashboardUpdateLocalWorkbookNeverShowExplanation);this.tutorialDataStore.setKey(r.UpdateLocalWorkbookExplanation,!0,t)}},r.prototype.replaceWorkbook=function(){this.replaceWorkbookScope.shouldReplaceLocalWorkbook=!0,this.updateLocalWorkbookElement||(this.updateLocalWorkbookTemplate=angular.element(r.HtmlTemplateUpdate),this.updateLocalWorkbookElement=this.compile(this.updateLocalWorkbookTemplate)(this.replaceWorkbookScope),$("body").append(this.updateLocalWorkbookElement)),this.replaceWorkbookScope.$applyAsync()},r.prototype.finishReplacingLocalWorkbook=function(){this.replaceWorkbookScope.shouldReplaceLocalWorkbook=!1},r.prototype.onWorkbookAdded=function(r,o){return __awaiter(this,void 0,e.Promise,(function(){var e,i,a,n=this;return __generator(this,(function(s){switch(s.label){case 0:return this.isStoreEnabled?[4,this.workbookStore.findById(r,o)]:[3,4];case 1:return(e=s.sent())?[3,3]:(i=this.promiseFactory.defer(),this.workbookStore.add(r,o,i),[4,i.promise]);case 2:s.sent(),s.label=3;case 3:return[3,6];case 4:return a=this.findWorkbook(r,o),a?[3,6]:[4,this.workbookHttpService.getWorkbook(r,o,null).then((function(e){a=n.findWorkbook(r,o);var i=e.data;a?n.modelMerger.mergeWorkbook(a,i):(a=n.modelConverter.convertWorkbook(i),a.isNew=!0,n.workbookCollectionService.addWorkbook(a),n.updateTimestamp(),n.rootScope.$emit(t.constants.workbook.workbookAddedEventName,a.uniqueId))}),(function(){}))];case 5:s.sent(),s.label=6;case 6:return[2]}}))}))},r.prototype.onWorkbookDeleted=function(t,r){return __awaiter(this,void 0,e.Promise,(function(){var e;return __generator(this,(function(o){switch(o.label){case 0:return this.isStoreEnabled?[4,this.workbookStore.findById(t,r)]:[3,2];case 1:return e=o.sent(),this.workbookStore.delete(e,!0),[3,3];case 2:if(0===this.workbooks.length)return[2];this.workbookCollectionService.removeWorkbook(t,r)&&this.updateTimestamp(),o.label=3;case 3:return[2]}}))}))},r.prototype.onWorkbookUpdated=function(t){return __awaiter(this,void 0,e.Promise,(function(){var e,r,o,i,a,n,s,c=this;return __generator(this,(function(l){switch(l.label){case 0:return this.isStoreEnabled?[4,this.workbookStore.findAll(t)]:[3,2];case 1:if(e=l.sent())for(r=0,o=e;r<o.length;r++)i=o[r],this.workbookStore.load(i.id,i.packageId);return[3,3];case 2:if(0===this.workbooks.length)return[2];if(a=this.findWorkbooks(t))for(n=0,s=a.length;n<s;n++)this.workbookHttpService.getWorkbook(t,a[n].packageId,null).then((function(e){var t=e.data,r=c.findWorkbook(t.id,t.packageId);c.modelMerger.mergeWorkbook(r,t)}),(function(){}));l.label=3;case 3:return[2]}}))}))},r.prototype.ensureFetched=function(e){return this.onWorkbookAdded(e.id,void 0)},r.prototype.findWorkbooks=function(e){return _.filter(this.workbooks,(function(t){return t.id===e}))},r.prototype.updateWorkbook=function(e){var t=this.findWorkbook(e.id,e.packageId);return t&&this.modelMerger.mergeWorkbook(t,e),t},r.prototype.getWorkbookContracts=function(){return this.workbookCollectionService.getWorkbookContracts()},Object.defineProperty(r.prototype,"copyAndEditWorkbooks",{get:function(){var e=this.permissionService;return _.filter(this.workbooks,(function(t){var r=e.getWorkbookEffectivePermissions(t.contract);return 2===(2&r)||17===(17&r)}))},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"editAndReShareWorkbooks",{get:function(){var e=this.permissionService;return _.filter(this.workbooks,(function(t){var r=e.getWorkbookEffectivePermissions(t.contract);return 2===(2&r)&&4===(4&r)}))},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"lastUpdatedTimestamp",{get:function(){return this._lastUpdatedTimestamp},enumerable:!0,configurable:!0}),r.prototype.ensureWorkbookInitialization=function(){return this.workbooksDeferred.promise},r.prototype.updateTimestamp=function(){this._lastUpdatedTimestamp=(new Date).getTime()},r.prototype.initWorkbooks=function(){var e=this;this.appMetadataService.getAppMetadata().then((function(t){e.loadWorkbooks(t)}),(function(){e.loadWorkbooks()}))},r.prototype.loadWorkbooks=function(t){var r=this;if(t)t.workbooks&&(t.workbooks.forEach((function(e){var t=r.modelConverter.convertWorkbook(e);r.workbookCollectionService.addWorkbook(t)})),this.workbooksDeferred.resolve(this),this.updateTimestamp());else{var o=this.telemetryService.startEvent(e.telemetry.DashboardInitializeNavigationPaneWorkbooks);this.workbookHttpService.getWorkbooks(o.event).then((function(e){r.updateWorkbooks(e.data),o.resolve(),r.workbooksDeferred.resolve(r),r.updateTimestamp()}),(function(){o.reject(),r.workbooksDeferred.reject()}))}},r.prototype.updateWorkbookCollection=function(e){this.updateWorkbooks(e),this.updateTimestamp()},r.prototype.mergeWorkbookCollection=function(t){if(!_.isEmpty(t))for(var r=_.keyBy(this.workbooks,"uniqueId"),o=0,i=t;o<i.length;o++){var a=i[o];r[e.common.models.ReportResource.getUniqueId(1,a.id,a.packageId)]||this.workbookCollectionService.addWorkbook(this.modelConverter.convertWorkbook(a))}this.updateTimestamp()},r.prototype.updateWorkbooks=function(e){var t=this,r=[];_.isEmpty(e)||(r=_.map(e,(function(e){return t.modelConverter.convertWorkbook(e)}))),this.workbookCollectionService.workbooks=r},r.prototype.getWorkbookIndex=function(e,t){for(var r=0,o=this.workbooks.length;r<o;r++){var i=this.workbooks[r];if(i.id===e&&i.packageId===t)return r}return-1},r.prototype.findWorkbook=function(e,t){return t?_.find(this.workbooks,(function(r){return r.id===e&&r.packageId===t})):_.find(this.workbooks,(function(t){return t.id===e&&t.isOwner()}))},r.prototype.findWorkbooksByPackageId=function(e){if(null!=e)return _.filter(this.workbooks,(function(t){return t.packageId===e}))},r.prototype.findWorkbookByEtagHash=function(e){return _.find(this.workbooks,(function(t){return t.contract.etagHash===e}))},r.prototype.findWorkbookByUniqueId=function(e){return _.find(this.workbooks,(function(t){return t.uniqueId===e}))},r.prototype.getWorkbookUniqueId=function(e){return e.uniqueId},r.prototype.subscribeWorkbooks=function(){var e=this;this.appMetadataService.getAppMetadata().then((function(){e.workbookStore.workbooks.subscribe((function(t){e.workbookCollectionService.workbooks=t.map((function(t){var r=_.find(e.workbookCollectionService.workbooks,(function(e){return e.id===t.id&&e.packageId===t.packageId}));return r?(e.modelMerger.mergeWorkbook(r,t),r):e.modelConverter.convertWorkbook(t)})),e.workbooksDeferred.resolve(e)}))}))},Object.defineProperty(r.prototype,"originalWorkbooks",{get:function(){var e=this.permissionService;return _.filter(this.workbooks,(function(t){return t.isOwner()&&e.isOriginalWorkbook(t)}))},enumerable:!0,configurable:!0}),r.prototype.renameWorkbook=function(t,r,o){var i=this;if(!_.isEmpty(t.trim())){var a=this.findWorkbook(r,o);if(a){var n=this.telemetryService.startEvent(e.telemetry.DashboardRenameWorkbook);if(this.isStoreEnabled)this.workbookStore.rename(a.contract,t,n);else{var s=a.contract.displayName;s!==t&&(a.displayName=t,this.workbookHttpService.renameWorkbook(a,t,n.event).then((function(){n.resolve()}),(function(e){401===e.status?i.errorService.error(i.localizationService.get("Workbook_NoPermissionToRenameMessage"),"Workbook_NoPermissionToRename",{requestId:e.requestId,statusCode:e.status.toString()}):i.errorService.error(i.localizationService.get("Workbook_FailToRenameWorkbookMessage"),"Workbook_FailToRenameWorkbook",{requestId:e.requestId,statusCode:e.status.toString()}),a.displayName=s,n.reject()})))}}}},r.prototype.removeWorkbook=function(t,r,o,i){return __awaiter(this,void 0,e.Promise,(function(){var a,n,s,c=this;return __generator(this,(function(l){switch(l.label){case 0:return a=this.telemetryService.startEvent(e.telemetry.DashboardRemoveWorkbook,o,i),this.isStoreEnabled?[4,this.workbookStore.findById(t,r)]:[3,2];case 1:return n=l.sent(),this.workbookStore.delete(n,!1,a),[3,3];case 2:if(s=this.workbookCollectionService.removeWorkbook(t,r),!s)return a.resolve(),[2];this.workbookHttpService.deleteWorkbook(s.contract,a.event).then((function(){a.resolve(),c.updateTimestamp()}),(function(e){401===e.status?c.errorService.error(c.localizationService.get("Workbook_NoPermissionToRemoveMessage"),"Workbook_NoPermissionToRemove",{requestId:e.requestId,statusCode:e.status.toString()}):c.errorService.error(c.localizationService.get("Workbook_FailToRemoveWorkbookMessage"),"Workbook_FailToRemoveWorkbook",{requestId:e.requestId,statusCode:e.status.toString()}),c.workbookCollectionService.addWorkbook(s),a.reject()})),l.label=3;case 3:return[2]}}))}))},r.prototype.haveWorkbookEmbedAccessData=function(e){var t=this.deferredWopiData[e],r=this.wopiDataTTL[e];return!(!t||r&&!(r>(new Date).getTime()))},r.prototype.getWorkbookEmbedAccessData=function(t,r,o){var i=this;if(o)var a=this.telemetryService.startChildEvent(o,e.telemetry.DashboardGetWorkbookWopiAccessInformation);else var a=this.telemetryService.startEvent(e.telemetry.DashboardGetWorkbookWopiAccessInformation);if(this.haveWorkbookEmbedAccessData(t))return a.resolve(),this.deferredWopiData[t].promise;var n=this.promiseFactory.defer();this.deferredWopiData[t]=n,this.wopiDataTTL[t]=null;var s=!1;return this.workbookHttpService.getWorkbookWopiData(t,a.event).then((function(e){if(!e.data||!e.data.accessToken||!e.data.url)return void(s=!0);var r=e.data;i.wopiDataTTL[t]=r.accessTokenTtl,i.deferredWopiData[t].resolve(r),a.resolve()}),(function(){s=!0})).finally((function(){s&&(i.deferredWopiData[t].reject(),i.deferredWopiData[t]=null,a.reject())})),n.promise},r.prototype.createExcelWebAppEmbedUrlParams=function(e,t){var r=[{key:"dsdiv",value:e},{key:"dswp",value:"1"},{key:"dsts",value:"None"},{key:"dsat",value:"1"},{key:"dspti",value:"1"},{key:"dsfl",value:"1"},{key:"dsacs",value:this.asyncFeatureSwitchService.featureSwitches.ffxlChartSelectionEnabled?"1":"0"},{key:"dsrc",value:"pplr"}];return t&&r.push({key:"dssc",value:t}),r.map((function(e){return"&"+e.key+"="+e.value})).join("")},r.prototype.embedWorkbook=function(t,r,o,i,a,n,s,c,l,d){var p=this;if(null!==r&&null!==o){var u=this.promiseFactory.defer(),h=this.promiseFactory.defer(),f=l?"&wdPublishedInPbiHint=true":"";return h.promise.then((function(){var l=p.createExcelWebAppEmbedUrlParams(r.targetDiv,d),h=o+"&access_token="+i+"&access_token_ttl="+a+l+f,v=p.promiseFactory.defer();v.promise.then((function(o){o.getSucceeded()?(p.telemetryService.logEvent(e.telemetry.DashboardWorkbookEmbeddingExternalSuccess,t,o.getCorrelationId(),n,c,s),u.resolve({ewaControl:o.getReturnValue(),window:r})):(p.telemetryService.logEvent(e.telemetry.DashboardWorkbookEmbeddingExternalFailure,t,o.getCode(),o.getDescription(),o.getCorrelationId(),n,c,s),u.reject())}),(function(){p.telemetryService.logEvent(e.telemetry.DashboardWorkbookEmbeddingExternalFailure,t,-1,null,null,n,c,s),u.reject()})),r.loadEwaScripts(h,v)})),r.loadEvent=h,r.loaded&&h.resolve(null),u.promise}},r.prototype.getDefaultTileTitle=function(e,t){var r=t,o=e.sheetName;if(o)r+=", "+o.replace(/\''/g,"'");else{var i=e.item.split("!");i.length>1&&(r+=", "+i[0].substr(1,i[0].length-2))}return r},r.prototype.getDefaultTileSubtitle=function(e){var t=e.split("!");return t.length>1?t[1]:e},r.prototype.getTileSelectionQuery=function(e,t,r,i){var a="";return r===o.Chart&&i&&(a="Sheets('"+i+"')/"),a+=this.getNamedItemTypeAsString(r)+"('",e?a+=e:t&&(a+=t),encodeURIComponent(a+"')")},r.prototype.encodeImageTileQueryString=function(e){var t=encodeURI(e);return t=t.replace(/\'/g,"%27"),t=t.replace(/\(/g,"%28"),t=t.replace(/\)/g,"%29")},r.prototype.getNamedItemTypeAsString=function(e){switch(e){case o.NamedRange:return"Ranges";case o.Parameter:return"Parameters";case o.Table:return"Tables";case o.PivotTable:return"PivotTables";case o.Chart:return"Charts"}return"Ranges"},r.prototype.getWorkbookTilePreviewImageUrl=function(e){var t=this,r=this.promiseFactory.defer();return this.getWorkbookEmbedAccessData(e.workbookId,e.packageId).then((function(o){if(e.$config.workbookTile){var i=o.url.replace(/ExcelJs.ashx/i,"/XlRestInternal.aspx");i+="&framemode=proxy&wdRestQuery=$format=image&wdRestPart=Model/"+t.encodeImageTileQueryString(t.getTileSelectionQuery(e.$config.workbookTile.item,e.$config.workbookTile.activeSelection,e.$config.workbookTile.itemType,e.$config.workbookTile.sheetName))+"&access_token="+o.accessToken+"&access_token_ttl="+o.accessTokenTtl,r.resolve(i)}else r.reject()}),(function(){r.reject()})),r.promise},r.prototype.getWorkbookTileBestImageUrl=function(t){if(t.hasImages()){var r=t.images,o=-1,i=-1,a=t.tileModel.layoutPosition,n=e.common.GridLayoutConstants.getDefaultGridItemViewport({colSpan:a.width,rowSpan:a.height}),s=Number.MAX_VALUE,c=Number.MIN_VALUE,l=window.devicePixelRatio;if(n.width=n.width*l,n.height=n.height*l,t.keepOriginalContentSize)return jsCommon.Utility.getAbsoluteUri(r[0].imageUrl);for(var d=0;d<r.length;d++){r[d].width>c&&(c=r[d].width,i=d);var p=r[d].width-n.width,u=r[d].height-n.height,h=Math.max(p,u);h>=0&&h<s&&(s=h,o=d)}return o===-1&&(o=i),jsCommon.Utility.getAbsoluteUri(r[o].imageUrl)}return t.image?"data:image/png;base64,"+t.image:""},r.prototype.setModelDynamicImageUrl=function(e){e.dynamicImageUrl=this.getWorkbookTileBestImageUrl(e),e.dynamicImageUrl||(e.dynamicImageUrl=e.previewImageUrl)},r.prototype.getWorkbooks=function(){return this.workbooksDeferred.promise.then((function(e){return e.workbooks}))},r.prototype.subscribe=function(e){this.workbookCollectionService.subscribe(e)},r.prototype.unsubscribe=function(e){this.workbookCollectionService.unsubscribe(e)},r.HtmlTemplateUpdate="<content-provider-local-file selected-file='localWorkbookToUpload' is-update-from-element-flow='true' ng-if='shouldReplaceLocalWorkbook' element-to-update='workbookToUpdate'></content-provider-local-file>",r.UpdateLocalWorkbookExplanation="updateLocalWorkbookExplanation",r})();t.WorkbookService=s})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){function r(){return new i}var o=e.common.NotifyCollection;t.createWorkbookCollectionService=r;var i=(function(){function e(){this.listeners=[],this.collection=new o}return Object.defineProperty(e.prototype,"workbooks",{get:function(){return this.collection.items},set:function(e){this.collection.setItems(e)},enumerable:!0,configurable:!0}),e.prototype.getWorkbookContracts=function(){return _.map(this.workbooks,(function(e){return e.contract}))},e.prototype.addWorkbook=function(e){this.collection.addItem(e)},e.prototype.removeWorkbook=function(e,t){var r=this.collection.deleteItems((function(r){return r.id===e&&r.packageId===t}));return _.head(r)},e.prototype.onAdded=function(e){for(var t=this.listeners,r=0,o=t;r<o.length;r++){var i=o[r];i.onWorkbookAdded&&i.onWorkbookAdded(e)}},e.prototype.onDeleted=function(e){for(var t=this.listeners,r=0,o=t;r<o.length;r++){var i=o[r];i.onWorkbookDeleted&&i.onWorkbookDeleted(e)}},e.prototype.onReset=function(){for(var e=this.listeners,t=0,r=e;t<r.length;t++){var o=r[t];o.onWorkbooksReset&&o.onWorkbooksReset()}},e.prototype.subscribe=function(e){this.listeners.length<1&&this.collection.subscribe(this),this.listeners.push(e)},e.prototype.unsubscribe=function(e){_.pull(this.listeners,e),this.listeners.length<1&&this.collection.unsubscribe(this)},e})()})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(t){function r(e,t,r){return new i(e,t,r)}var o=jsCommon.Version;t.createTileConfigUpgraderService=r;var i=(function(){function r(e,r,o){this.upgraders=[t.v0_1.createVersionUpgrader(),t.v1_1.createVersionUpgrader(e,r),t.v1_2.createVersionUpgrader(e,o)]}return r.prototype.upgrade=function(t,r,i){if(r){var a=e.ContractUtils.convertToSemanticQueryWithDataShapeBinding(i);r&&(r.version||(r.version=o.ZeroStr));for(var n=0,s=this.upgraders;n<s.length;n++){var c=s[n];o.lt(r.version,c.version)&&c.upgrade(t,r,a)}}},r})();t.TileConfigUpgraderService=i})(t=e.upgrader||(e.upgrader={}))})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){var r;!(function(t){function r(){return new o}t.createVersionUpgrader=r;var o=(function(){function t(){this.version="0.1"}return t.prototype.upgrade=function(t,r,o){if(r.version=this.version,o&&o.defn&&!o.defn.Version&&r.visual&&!_.isEmpty(r.visual.elements)&&r.visual.visual===e.visuals.plugins.scatterChart.name){var i=r.visual.elements;if(i[0].DataRoles){for(var a=i[0].DataRoles,n=!1,s=!1,c=!1,l=void 0,d=0,p=a;d<p.length;d++){var u=p[d];"Category"===u.Name&&(n=!0,l=u.Projection),s=s||"Series"===u.Name,c=c||"Size"===u.Name}c&&n&&!s&&a.push({Name:"Series",Projection:l})}}},t})()})(r=t.v0_1||(t.v0_1={}))})(r=t.upgrader||(t.upgrader={}))})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(r){var o;!(function(r){function o(e,t){return new s(e,t)}var i=e.explore.services.upgrade.ExplorationVersions,a=e.explore.util.ThemeUtils,n=t.constants.upgrader;r.createVersionUpgrader=o;var s=(function(){function t(e,t){this.pluginService=e,this.telemetryService=t,this.version="1.1"}return t.prototype.upgrade=function(t,r,o){r.version=this.version;var s=r.visual||r.realTimeVisual;if(s){s.visual||this.telemetryService.logEvent(e.telemetry.TileConfigUpgradeTileConfig,n.NoVisualType);var c={visualType:s.visual};s.stylePresetName&&(c.vcObjects={stylePreset:[{properties:{name:e.data.SQExprBuilder.text(s.stylePresetName)}}]}),c.columnProperties=s.columnProperties;var l=this.pluginService.getPlugin(s.visual),d=l&&l.capabilities.objects,p=e.data.services.DataViewObjectSerializer.deserializeObjects(s.objects,d);p&&(c.objects=p);var u={name:"tile"+t,config:{singleVisual:c}};if(o&&o.defn){var h=e.data.services.SemanticQuerySerializer.tryDeserializeQuery(o.defn);if(h){var f=h.select(),v={};s.elements||(s.elements=[]);for(var m=0,g=e.VisualElement.getDataRolesFromVisualElements(s.elements);m<g.length;m++){var y=g[m],b=f[y.Projection];if(b){var S=y.Name,k=v[S];k||(v[S]=k=new e.data.QueryProjectionCollection([])),k.all().push({queryRef:b.name}),y.isActive&&k.addActiveQueryReference(b.name)}}u.filters=e.explore.FilterUtils.deriveFromSQFilters(h.from(),h.where(),s.queryMetadata),c.query=new e.explore.contracts.VisualQuery(h.where([],new e.data.SQFrom),v,[])}}else delete s.transform;var D={$visualContainer:u,dataWindow:r.realTimeVisual&&r.realTimeVisual.dataWindow,elements:s.elements,heading1:s.heading1,heading2:s.heading2,heading3:s.heading3,layoutType:s.layoutType,queryMetadata:s.queryMetadata,transform:s.transform,$modelExtensions:s.$modelExtensions,themeCollection:s.themeCollection||{}};s.themeName&&!D.themeCollection.customTheme&&(D.themeCollection.customTheme=a.getThemeMetadata(s.themeName,1,i.v3_18)),s.baseThemeName&&!D.themeCollection.baseTheme&&(D.themeCollection.baseTheme=a.getThemeMetadata(s.baseThemeName,2,i.v3_18)),D=_.omitBy(D,(function(e){return void 0===e})),r.realTimeVisual?r.realTimeVisual=D:r.visualContainer=D}},t})()})(o=r.v1_1||(r.v1_1={}))})(r=t.upgrader||(t.upgrader={}))})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){var r;!(function(t){function r(e,t){return new l(e,t)}var o=e.data.DataViewObjectDefinitions,i=e.data.services.DataViewTransformActionsSerializer,a=e.explore.services.upgrade.v3_19,n=e.explore.services.upgrade.v3_20,s=jsCommon.JsonExtensions,c=e.data.SQExprBuilder;t.createVersionUpgrader=r;var l=(function(){function t(e,t){this.pluginService=e,this.featureSwitchService=t,this.version="1.2"}return t.prototype.upgrade=function(e,r,o){r.version=this.version;var i=r.visualContainer||r.realTimeVisual;if(i){var s=i.$visualContainer.config&&i.$visualContainer.config.singleVisual;if(s){var c=s.visualType,l=this.pluginService.getPlugin(c),d=l&&l.capabilities.objects,p=_.includes(t.responsiveCartesians,c),u=a.needsToUpgradeDefaultCategoryColor(c);p&&this.upgradeSingleVisual(s),(p||u)&&i.transform&&this.upgradeSerializedTransform(i,d,p,u),u&&a.upgradeDefaultCategoryColorToFill(s.objects),this.featureSwitchService.featureSwitches.cartesianConditionalFormatting&&n.upgradeGradientOnObjectDef(s.objects,s.query,c)}}},t.prototype.upgradeSingleVisual=function(e){e.objects||(e.objects={}),this.applyResponsiveLegacy(e.objects)},t.prototype.upgradeSerializedTransform=function(e,t,r,o){var n=this.deserializeTransform(e.transform,t);n&&(n.objects||(n.objects={}),r&&this.applyResponsiveLegacy(n.objects),o&&a.upgradeDefaultCategoryColorToFill(n.objects),e.transform=i.serializeTransformActions(i.serializeDataViewTransformActions(n,t)))},t.prototype.deserializeTransform=function(e,t){var r=s.tryParseJSON(e);if(r)return i.deserializeDataViewTransformActions(r,t)},t.prototype.applyResponsiveLegacy=function(e){
o.ensure(e,"general",void 0).properties.responsiveLegacy=c.boolean(!0)},t.responsiveCartesians=[e.visuals.plugins.barChart.name,e.visuals.plugins.clusteredBarChart.name,e.visuals.plugins.clusteredColumnChart.name,e.visuals.plugins.columnChart.name,e.visuals.plugins.dataDotClusteredColumnComboChart.name,e.visuals.plugins.dataDotStackedColumnComboChart.name,e.visuals.plugins.hundredPercentStackedBarChart.name,e.visuals.plugins.hundredPercentStackedColumnChart.name,e.visuals.plugins.lineChart.name,e.visuals.plugins.areaChart.name,e.visuals.plugins.stackedAreaChart.name,e.visuals.plugins.lineClusteredColumnComboChart.name,e.visuals.plugins.lineStackedColumnComboChart.name,e.visuals.plugins.scatterChart.name,e.visuals.plugins.waterfallChart.name,e.visuals.plugins.realTimeLineChart.name,e.visuals.plugins.ribbonChart.name],t})()})(r=t.v1_2||(t.v1_2={}))})(r=t.upgrader||(t.upgrader={}))})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t,r=jsCommon.DateExtensions,o=jsCommon.Utility;!(function(e){function t(e){var t=o.getDateFromWcfJsonString(e,!0);return t||(t=r.parseIsoDate(e)),t}e.convertDate=t})(t=e.DateUtils||(e.DateUtils={}))})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r,o=t.models.AppModelIconBackgroundColors,i=jsCommon.Color,a=e.common.contracts.ContentProviderCategory,n=e.common.models.Model,s=jsCommon.Utility,c=t.models.Workbook;!(function(e){function r(e,t){var r=e.defaultContent;if(0!==e.defaultContentOption&&r)return t.getAppArtifact(e,{dashboardOriginalGUID:r.dashboardObjectId,reportOriginalGUID:r.reportObjectId,workbookID:r.workbookObjectId})}function l(e){return e&&e.category===a.OrganizationalApp}function d(e,t){var r=t.getAppInstance(e);return r&&l(r.providerContract)}function p(e){return e.category===a.OrganizationalTemplateApp||e.category===a.ServiceApp||e.category===a.Services}function u(e,t){var r=t.getAppInstance(e);return r&&p(r.providerContract)}function h(e,t){if(e&&e.contract){return v(e.getUniquePackageId&&e.getUniquePackageId(),t)}}function f(e,t){if(e)return v(e.packageId,t)}function v(e,t){if(e){var r=t.getAppInstance(e);return r&&r.providerContract.providerKey}}function m(e,t,r){var o=e.getAppInstancesForApp(r);if(!_.isEmpty(o)){var i=o[0];return i.category===a.OrganizationalApp,i.packageId}}function g(e,r){var o=t.DateUtils.convertDate(e);return o&&o.toLocaleDateString(r.currentLanguageLocale,{month:"short",day:"numeric",year:"numeric"})}function y(e){return!(e.icon||_.isEmpty(e.iconUrl)&&_.isEmpty(e.localAppLogoImageData))}function b(e,t){if(y(e)){if(e.localAppLogoImageData)return"url("+e.localAppLogoImageData+")";if(e.iconUrl){var r=e;return"url("+s.urlCombine(t,r.iconUrl)+")"}}}function S(e){var t=_.find(o,(function(t){return t.color===e}));return t&&t.fontColor||T}function k(e){if(e){return i.calculateHighlightColor(i.parseColorString(e),.8,.2)}}function D(e){return e instanceof n?e.dbName:e instanceof c?e.uniqueId:e.objectId}function w(e){var t=jsCommon.JsonExtensions.tryParseJSON(e.providerConfig);if(t)return t.author}function C(e,t){var r=t.findPackage(e);return!!(r&&r.contract&&r.contract.folderId)&&_.some(t.packages,(function(e){return e.contract.folderId===r.contract.folderId&&e.contract.serviceAppObjectId}))}var T="#FFF";e.getDefaultAppArtefact=r,e.isOrgApp=l,e.isOrgAppInstance=d,e.isParameterizedApp=p,e.isParameterizedAppInstance=u,e.getDashboardAppGUID=h,e.getResourceAppGUID=f,e.getAppGUIDByPackageId=v,e.getPackageIDByOrgAppGUID=m,e.convertDisplayDate=g,e.hasAppLogoImage=y,e.getAppLogoImageUrlStyle=b,e.getAppHeaderFontColor=S,e.getAppHeaderBackgroundColor=k,e.getAppContentModelObjectId=D,e.getAppAuthor=w,e.isServiceApp=C})(r=t.AppUtils||(t.AppUtils={}))})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r,o=e.common.helpers.ModelConverterHelper,i=3;!(function(e){function t(e){return 2===(2&e.permissions)}function r(e,t,r){var i=r.featureSwitches;return _.some(e,(function(e){if(t){var r=t.findModel(e.id,e.packageId);return!!r&&o.getIsQnaSupported(r.contract,i)}return o.getIsQnaSupported(e,i)}))}function a(e,t){var r=[];if(!e)return r;var o=[],i=e.modelIds;_.isEmpty(i)||(o=i.slice(0));var a=e.tiles;if(_.map(a,(function(e){null!=e.modelId&&o.push(e.modelId)})),_.isEmpty(o))return r;o=_.uniq(o);for(var n=0,s=o.length;n<s;n++){var c=_.filter(t,(function(e){return e.id===o[n]}));_.isEmpty(c)||r.push(c[0])}return r}function n(e){for(var t=[],r=1e3,o=_.sortBy(e,(function(e){var t=e.getActiveLayoutPosition();return t.y*r+t.x})),i=0,a=o;i<a.length;i++){var n=a[i],l=n.getActiveLayoutPosition();s(t,l.y,l.height)}for(var d=[],p=1e3,u=_.sortBy(e,(function(e){var t=e.getActiveLayoutPosition();return t.x*p+t.y})),h=0,f=u;h<f.length;h++){var n=f[h],l=n.getActiveLayoutPosition();s(d,l.x,l.width)}for(var v=c(t,d,o,u),m=0===v?t:d,g=0===v?u:o,y=[],b=0,S=0,k=m;S<k.length;S++){for(var D=k[S],w=b+1;w<D.startPosition;w++)y.push(void 0);for(var C=D.startPosition;C<D.startPosition+D.size;C++)y.push(D.startPosition),b=C}for(var T=_.groupBy(g,(function(e){return y[(0===v?e.getActiveLayoutPosition().y:e.getActiveLayoutPosition().x)-1]})),I=[],P=0,M=m;P<M.length;P++){var D=M[P];I=I.concat(T[D.startPosition])}return _.map(I,(function(e){return e.getItem()}))}function s(e,t,r){var o=e.length,i=e[o-1];!_.isEmpty(e)&&t>=i.startPosition&&t<i.startPosition+i.size?t+r>i.startPosition+i.size&&(i.size=t+r-i.startPosition):e.push({startPosition:t,size:r})}function c(e,t,r,o){var i,a=_.isEmpty(e)?-(1/0):_.maxBy(e,(function(e){return e.size})).size,n=_.isEmpty(t)?-(1/0):_.maxBy(t,(function(e){return e.size})).size,s=_.every(e,(function(t){return t.size===e[0].size})),c=_.every(t,(function(e){return e.size===t[0].size}));return i=l(e,a,s)?0:l(t,n,c)?1:a<=n?0:1}function l(e,t,r){return e.length>1&&r&&t<=i}function d(e,t,r){if(!r||!r.tiles)return!1;switch(e){case 0:return _.some(r.tiles,(function(e){return e.hasLayoutDefinition(t)}));case 1:return _.some(r.tiles,(function(e){return e.hasLayoutPosition(t)}))}}function p(e){for(var t=[],r=0,o=e.tiles;r<o.length;r++){var i=o[r];i.hasLayoutDefinition(1)?i.shouldNewBadgeAppear=!1:(i.shouldNewBadgeAppear=!0,t.push(i.addLayout({id:1,position:null},1)))}return t}e.isWriteable=t,e.containsQnaSupportedModel=r,e.getDashboardModels=a,e.orderItems=n,e.containsLayout=d,e.markTilesAsNewIfNeeded=p})(r=t.DashboardUtils||(t.DashboardUtils={}))})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r,o=t.contracts,i=e.visuals.plugins,a="__default__",n=1;!(function(e){function t(e,t){void 0===t&&(t=1);var i=r[t];if(!i)return n;var s=o.TileType[e.type];if(!i[s]&&e.composite){var c=e.composite;c&&(s=c.visual.type)}return i[s]||i[a]}var r={},s={};s[o.TileType[o.TileType.report]]=6,s[i.card.name]=2,s[i.animatedNumber.name]=2,s[i.textbox.name]=2,s[a]=3,r[1]=s,e.getRowSpan=t})(r=t.TileDefaultSizesUtils||(t.TileDefaultSizesUtils={}))})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r,o=jsCommon.JsonExtensions,i=t.contracts.TileType;!(function(r){function a(r,o,a,n,s,c,l,d,p){var u=r.realTime,f=d.execute({dataSources:u.datasources,schema:s,config:o,additionalFilters:null,dataWindow:a}),v=c.getPinData({name:"tile"+r.id,config:{singleVisual:o},layouts:void 0},e.common.contracts.TileLayoutType.Default,u.datasources,{},null,null,f,s);v.realTimeDataWindow=a;var m=t.models.TileFactory.createTileForPinData(l,v,n),g=m.$config;if(!g)return void p.logEvent(e.telemetry.DashboardTileError,i[i.realTime],h);g.hideTitle=r.config.hideTitle,r.config=g,r.realTime.config=g.realTimeVisual;var y=r.contract;if(y.query=m.query,y.modelId=m.modelId,r.isTemporary){var b=t.ContractUtils.getMasterLayoutPosition(y),S=t.ContractUtils.getMasterLayoutPosition(m);b.width=S.width,b.height=S.height;var k={colSpan:b.width,rowSpan:b.height};r.calculateLayout(e.common.GridLayoutConstants.getDefaultGridItemViewport(k)),r.invalidateLayout()}u.singleVisualConfig=o}function n(e){if(e){var t=e.visualContainer||e.realTimeVisual;return t&&t.$visualContainer?t.$visualContainer.config.singleVisual.visualType:void 0}}function s(e,t){return r.isScriptVisualTile(e,t)||r.reportTileContainsScriptVisuals(e,t)}function c(e,t){return e&&e.type===i.composite&&t.isScriptVisual(r.getVisualType(e.config))}function l(t,r){var o=t&&t.reportTile&&t.reportTile.exploration&&t.reportTile.exploration.sections;if(!o||t.type!==i.report)return!1;for(var a=0,n=o;a<n.length;a++)for(var s=n[a],c=0,l=s.contract.visualContainers;c<l.length;c++){var d=l[c],p=e.explore.util.VisualContainerUtils.getVisualType(d);if(p&&r&&r.isScriptVisual(p))return!0}return!1}function d(e,t){return"tile_"+e.id+"_dash_"+t}function p(e,r,o){var i,a=1,n=6,s=t.TileDefaultSizesUtils.getRowSpan(o,a),c={id:a,position:{y:e,x:r,width:n,height:s}};return i=o.addLayout(c,a),o.layoutPosition.y=e,o.layoutPosition.x=r,o.layoutPosition.height=s,o.layoutPosition.width=n,i}function u(t){var r=o.tryParseJSON(t.errorDetail);if(r&&!_.isEmpty(r.DataShapes)){var i=r.DataShapes[0]["odata.error"];if(i){return new e.DsrClientError(i).getDetails(e.common.localize)}}}var h="Invalid tile config object";r.UpdateRealTimeTile=a,r.getVisualType=n,r.tileContainsScriptVisuals=s,r.isScriptVisualTile=c,r.reportTileContainsScriptVisuals=l,r.tileTrackerFn=d,r.createDefaultPhoneByTile=p,r.getTileErrorDetailsFromQueryResultError=u})(r=t.TileUtils||(t.TileUtils={}))})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r,o=e.common.contracts.ContentProviderCategory,i=jsCommon.EnumExtensions,a=e.common.contracts.PackageType,n=e.common.contracts.PermissionArtifactType;!(function(e){function t(e,t,o,i,a,n,s,c,l){if(t=t||[],r(e,t,o,i,a,n,s,c,l)){var d=void 0;if(!_.isEmpty(e))for(var p=0,u=e;p<u.length;p++){var h=u[p];d=s.findDashboardContract(h),d&&(d.permissions=f,t=_.union(t,d.reportIds))}var v=void 0;if(!_.isEmpty(t))for(var m=0,g=t;m<g.length;m++){var y=g[m];v=n.findReportContract(y),v&&(v.permissions=f)}}}function r(e,t,r,o,i,a,n,l,d){var p=l.findPackageContract(o);return!!s(p,d)&&c(e,t,r,p.id,i,a,n)}function s(e,t){if(!e||e.packageType!==a.AppInstance)return!1;if(e.contentProviderId||e.serviceContentProviderId)return!0;var r=null;return!!e.contentProviderRefId&&(r=t.findOrganizationalContentProvider(e.contentProviderRefId),r&&r.category===o.OrganizationalTemplateApp)}function c(e,t,r,o,i,a,n){return!(_.isEmpty(e)&&_.isEmpty(t)&&_.isEmpty(r))&&(p(r,o,i)&&d(t,o,a)&&l(e,o,n))}function l(e,t,r){if(!_.isEmpty(e)){var o=_.uniq(e),i=_.filter(r.dashboards,(function(e){return e.contract&&e.contract.originalPackageId===t&&_.includes(o,e.id)}));if(_.isEmpty(i)||i.length!==o.length)return!1}return!0}function d(e,t,r){if(!_.isEmpty(e)){var o=_.uniq(e),i=_.filter(r.reports,(function(e){return e.packageId===t&&_.includes(o,e.id)}));if(_.isEmpty(i)||i.length!==o.length)return!1}return!0}function p(e,t,r){if(!_.isEmpty(e)){var o=_.uniq(e),i=_.filter(r.models,(function(e){return e.packageId===t&&_.includes(o,e.id)}));if(_.isEmpty(i)||i.length!==o.length)return!1}return!0}function u(e,t){return t===n.Workbook?i.hasFlag(e,6):i.hasFlag(e,6)}function h(e){return jsCommon.EnumExtensions.hasFlag(e,2)}var f=17;e.markDashboardAndReportsAsCopyableIfPartOfTemplateInstance=t,e.areArtifactsFromTemplateInstance=r,e.isPackageTemplateInstance=s,e.canReshare=u,e.hasWriteFlag=h})(r=t.PermissionsUtils||(t.PermissionsUtils={}))})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){function r(e,t,r,o,i,a,n,s,l,d,p,u,h,f){return new c(e,t,r,o,i,a,n,s,l,d,p,u,h,f)}var o=e.dataServices.ContractUtils,i=e.explore.QueryProjectionBuilderCoreUtils,a=e.data.services.SemanticQuerySerializer,n=e.dataServices.contracts.TileType;t.createExportDataService=r;var s="sobe_onpremisevirtualserver",c=(function(){function r(e,t,r,o,i,a,n,s,c,l,d,p,u,h){this.promiseFactory=e,this.notificationToastService=t,this.localizationService=r,this.conceptualSchemaProxy=o,this.visualPluginService=i,this.visualPluginOps=a,this.featureSwitchService=n,this.displayNameService=s,this.aggrOps=c,this.filterRestatementService=l,this.fileSaver=d,this.lazyScoped=p,this.modelService=u,this.lazyScopedSync=h}return r.prototype.exportTileDataToCsv=function(r){var n=this,s=r.composite,c=r.contract,l=r.config,d=t.TileUtils.getVisualType(l),p=this.getDataSources(r),u=this.promiseFactory.defer(),h=this.localizationService,f=this.notificationToastService,v=f.notify({title:h.get("ExportData_LoadingTitle"),message:h.get("ExportData_LoadingMessage"),notificationType:3});return this.conceptualSchemaProxy.get(p).then((function(t){f.hide(v);var r=o.convertToSemanticQueryWithDataShapeBinding(c.query),h=a.deserializeQuery(r.defn),m=l.visualContainer.elements,g=m&&m.length>0?m[0].DataRoles:null,y=n.visualPluginService.getPlugin(d),b=i.createProjectionBuilderFromDataRoles(y,g,h,t);if(n.visualPluginService.capabilities(d)){var S=l.visualContainer.$visualContainer.config.singleVisual.objects,k={objects:S,visualType:d,query:new e.explore.contracts.VisualQuery(h,b.build(r.shape),[])};n.exportVisualDataToCsv(l.visualContainer.heading1,{data:s.visual.data,dataTransforms:s.visual.dataTransforms},p,k,null).then((function(e){u.resolve(e)}),(function(e){u.reject(e)}))}}),(function(){f.hide(v)})),u.promise},r.prototype.exportVisualDataToCsv=function(e,t,r,o,i){var a=this.localizationService,n=this.notificationToastService,s=n.notify({title:a.get("ExportData_LoadingTitle"),message:a.get("ExportData_LoadingMessage"),notificationType:3,sticky:!0}),c=this.lazyScoped("exportVisualData").then((function(a){return a.exportToCsv(e,t,r,o,i)}));return this.handleExportDataResult(c,s)},r.prototype.exportVisualDataToExcel=function(e,t,r,o,i,a){var n=this,s=this.localizationService,c=this.notificationToastService,l=this.promiseFactory.defer(),d=c.notify({title:s.get("ExportData_LoadingTitle"),message:s.get("ExportData_LoadingMessage"),notificationType:3,sticky:!0});return this.conceptualSchemaProxy.get(t).then((function(s){var c=r,d=n.featureSwitchService.featureSwitches.exportExcelExcludeMeasures;if(i){var p=n.lazyScopedSync("drillToDetails").generateDetailsTable(r,s,a,d);if(!p)return void l.reject({blob:null,error:4});c=p}n.generateFiltersDescriptionPromise(s,o,c).then((function(r){n.lazyScoped("exportVisualData").then((function(i){return i.exportToExcel(e,t,c,o,r)})).then((function(e){l.resolve(e)}),(function(e){l.reject(e)}))}),(function(){l.reject({blob:null,error:5})}))}),(function(){l.reject({blob:null,error:3})})),this.handleExportDataResult(l.promise,d)},r.prototype.canExportTileData=function(t){if(!this.featureSwitchService.featureSwitches.exportDataEnabled)return!1;if(t.type!==n.composite)return!1;var r=t.composite&&t.composite.visual&&t.composite.visual.type;if(!this.visualPluginService.getPlugin(r))return!1;if(!t.composite.tileData)return!1;if(!this.visualPluginOps.isQueryVisual(r))return!1;try{var i=t&&t.contract&&t.contract.query,a=o.convertToSemanticQueryWithDataShapeBinding(i),s=a.defn;if(!s||!s.Version||s.Version<e.data.SemanticQueryVersions.Version2)return!1}catch(e){return!1}return!0},r.prototype.getExportDataToExcelUnsupportedType=function(e,t){var r=e.objects,o=e.visualType;return r&&r.forecast?3:r&&r.clustering?2:this.visualPluginService.isScriptVisual(o)?4:this.visualPluginService.isCustomVisual(o)?5:this.modelService.isActionAllowed(t.contract,8)?0:6},r.prototype.isDataModelASOnPremises=function(e){return e&&e.vsName&&e.vsName===s},r.prototype.generateFiltersDescriptionPromise=function(e,t,r){var o={filtersNamesAndRestatements:[]},i=this.promiseFactory.defer();if(!t||_.isEmpty(t.dataFiltersUnmerged))return i.resolve(o),i.promise;for(var a=this.visualPluginService.capabilities(r.visualType),n=0,s=t.dataFiltersUnmerged;n<s.length;n++){var c=s[n],l=this.displayNameService.getFilterRestatementForOverlay(c,e,a,null,r);if(!_.isEmpty(l))for(var d=0,p=l;d<p.length;d++){var u=p[d];o.filtersNamesAndRestatements.push({displayName:u.fieldName,qualifiedDisplayName:u.fieldNameToolTip,restatement:u.restatements.join(this.localizationService.get("ListJoin_Separator"))})}}return i.resolve(o),i.promise},r.prototype.getDataSources=function(t){var r=t.contract,o=e.explore.contracts.createDataSourceArray(),i={type:"dsr",id:r.modelId,name:r.modelName,dsr:{schemaName:r.modelName,vsName:t.vsName,dbName:t.dbName,modelId:r.modelId}};o.push(i);var a=e.explore.constants.ExplorationSchemaName,n={type:e.explore.dataReaderPlugins.ExplorationDataReaderType,id:r.id,name:a,extends:r.modelName,exploration:{schemaName:a,extends:r.modelName,getModelExtensions:function(){return t.config.visualContainer.$modelExtensions}}};return o.push(n),o},r.prototype.saveResult=function(e){switch(e.format){case 0:this.fileSaver.saveAs(e.blob,e.fileName,{type:"text/csv;charset=utf-8;"});break;case 1:this.fileSaver.saveAs(e.blob,e.fileName,{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;"})}},r.prototype.handleExportDataResult=function(e,t){var r=this,o=this.promiseFactory.defer(),i=this.localizationService,a=this.notificationToastService;return e.then((function(e){null!=e.error?(a.notify({title:i.get("ExportData_FailureTitle"),message:i.get("ExportData_FailureMessage"),notificationType:2}),o.reject(e)):(e.isPartialResult&&a.notify({title:i.get("ExportData_PartialDataTitle"),message:i.get("ExportData_PartialDataMessage"),notificationType:5}),r.saveResult(e),o.resolve(e))}),(function(e){var t="ExportData_FailureMessage";6===e.error&&(t="ExportData_EmptyColumnName"),a.notify({title:i.get("ExportData_FailureTitle"),message:i.get(t),notificationType:2}),o.reject(e)})).finally((function(){return a.hide(t)})),o.promise},r})();t.ExportDataService=c})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){angular.module("powerbi.dataServices",[]);var r=["powerbi.common","powerbi.visualHost"];angular.module("powerbi.dataServices",r).factory("appCollection",[function(){return e.dataServices.createAppCollectionService()}]).factory("dashboardCollection",[function(){return e.dataServices.createDashboardCollectionService()}]).factory("modelCollection",[function(){return e.dataServices.createModelCollectionService()}]).factory("cdsaModelCollection",[function(){return e.dataServices.createCdsaModelCollectionService()}]).factory("packageCollection",[function(){return e.dataServices.createPackageCollectionService()}]).factory("reportCollection",[function(){return e.dataServices.createReportCollectionService()}]).factory("workbookCollection",[function(){return e.dataServices.createWorkbookCollectionService()}]).factory("appCollection",[function(){return e.dataServices.createAppCollectionService()}]).factory("httpThrottler",["telemetryService",function(t){return e.dataServices.createHttpThrottler(t)}]).factory("permissionService",["activeFolderId","impersonationService","appCollection","packageCollection","modelCollection","reportCollection","dashboardCollection","telemetryService",function(t,r,o,i,a,n,s,c){return e.dataServices.createPermissionService(t,r,o,i,a,n,s,c)}]).factory("appMetadataService",["$rootScope","promiseFactory","resourcePackagesService","resourceGateService","visualPlugin","telemetryService","editableFeatureSwitchService","groupStore","metadataStore","httpService",function(t,r,o,i,a,n,s,c,l,d){return e.dataServices.createAppMetadataService(t,r,o,i,a,n,s,c,l,d)}]).factory("cdsaModelHttpService",["syncService","httpService","featureSwitchService",function(t,r,o){return e.dataServices.createCdsaModelHttpService(t,r,o)}]).factory("modelHttpService",["syncService","httpThrottler","httpService",function(t,r,o){return e.dataServices.createModelHttpService(t,r,o)}]).factory("reportHttpService",["httpService","syncService",function(t,r){return e.dataServices.createReportHttpService(t,r)}]).factory("workbookHttpService",["httpService",function(t){return e.dataServices.createWorkbookHttpService(t)}]).factory("dashboardHttpService",["syncService","promiseFactory","notificationToast","explorationSerializer","featureSwitchService","visualPlugin","httpThrottler","httpService",function(t,r,o,i,a,n,s,c){return e.dataServices.createDashboardHttpService(t,r,o,i,a,n,s,c)}]).factory("contentProviderHttpService",["promiseFactory","telemetryService","featureSwitchService","activeFolderId","syncService","httpService",function(t,r,o,i,a,n){return e.dataServices.createContentProviderHttpService(o,i,r,t,n,a)}]).factory("reportService",["$rootScope","telemetryService","errorService","dataServiceModelMerger","dataServiceModelConverter","syncService","reportHttpService","localizationService","appMetadataService","promiseFactory","reportCollection","permissionService","reportStore","asyncFeatureSwitchService","userInfo","fetchEntityService",function(t,r,o,i,a,n,s,c,l,d,p,u,h,f,v,m){return e.dataServices.createReportService(t,r,o,i,a,n,s,c,l,d,p,u,h,f,v,m)}]).factory("workbookService",["$rootScope","telemetryService","errorService","dataServiceModelMerger","dataServiceModelConverter","syncService","workbookHttpService","localizationService","asyncFeatureSwitchService","appMetadataService","$window","promiseFactory","tutorialDataStore","$compile","localFileService","workbookCollection","permissionService","workbookStore","fetchEntityService",function(t,r,o,i,a,n,s,c,l,d,p,u,h,f,v,m,g,y,b){return e.dataServices.createWorkbookService(t,r,o,i,a,n,s,c,l,d,p,u,h,f,v,m,g,y,b)}]).factory("modelService",["$rootScope","telemetryService","errorService","dataServiceModelMerger","dataServiceModelConverter","syncService","modelHttpService","localizationService","reportService","appMetadataService","promiseFactory","dataProxy","modelCollection","permissionService","asyncFeatureSwitchService","datasetStore","fetchEntityService",function(t,r,o,i,a,n,s,c,l,d,p,u,h,f,v,m,g){return e.dataServices.createModelService(t,r,o,i,a,n,s,c,l,d,p,u,h,f,v,m,g)}]).factory("cdsaModelService",["appMetadataService","telemetryService","asyncFeatureSwitchService","cdsaModelCollection","cdsaModelHttpService","cdsaModelStore","errorService","fileSaver","localizationService","dataServiceModelConverter","dataServiceModelMerger","notificationToast","promiseFactory","cdsaModelSyncService","syncService",function(t,r,o,i,a,n,s,c,l,d,p,u,h,f,v){return e.dataServices.createCdsaModelService(t,r,o,i,a,n,s,c,l,d,p,u,h,f,v)}]).factory("cdsaModelSyncService",["cdsaModelStore",function(t){return e.dataServices.createCdsaModelSyncService(t)}]).factory("dashboardDataService",["dashboardHttpService","promiseFactory","asyncFeatureSwitchService","dataServiceModelMerger","modelService","dashboardCollection","$timeout","dashboardStore","appMetadataService",function(t,r,o,i,a,n,s,c,l){return e.dataServices.createDashboardDataService(t,r,o,i,a,n,s,c,l)}]).factory("dashboardSyncService",["$rootScope","dashboardDataService","dashboardHttpService","dataServiceModelConverter","dataServiceModelMerger","modelService","promiseFactory","reportService","resourceGateService","resourcePackageListenerService","resourcePackagesService","syncService","telemetryService","tutorialDataStore","userInfo","workbookService","dashboardStore","asyncFeatureSwitchService","fetchEntityService",function(t,r,o,i,a,n,s,c,l,d,p,u,h,f,v,m,g,y,b){return e.dataServices.createDashboarSyncService(t,r,o,i,a,n,s,c,l,d,p,u,h,f,v,m,g,y,b)}]).factory("schemaRefresh",["conceptualSchemaProxy","navigation","reportService","syncService",function(t,r,o,i){return e.dataServices.createSchemaRefreshService(t,r,o,i)}]).factory("resourcePackageListenerService",["httpService","resourcePackagesService","promiseFactory","visualPlugin",function(t,r,o,i){return e.dataServices.createResourcePackageListenerService(t,r,o,i)}]).factory("tileConfigUpgraderService",["visualPlugin","telemetryService","featureSwitchService",function(e,r,o){return t.upgrader.createTileConfigUpgraderService(e,r,o)}]).factory("dataServiceModelConverter",["geolocationService","geocoder","promiseFactory","moduleLoader","telemetryService","visualPlugin","featureSwitchService","permissionService","tileConfigUpgraderService","localizationService","explorationSerializer",function(t,r,o,i,a,n,s,c,l,d,p){return e.dataServices.models.createDataServiceModelConverter(t,a,n,e.explore.services.createVisualPluginOps(n),s,r,o,i,c,l,d,p)}]).factory("dataServiceModelMerger",["dataServiceModelConverter","permissionService",function(t,r){var o=e.dataServices.models.createDataServiceModelMerger(t,r);return t.setModelMerger(o),o}]).factory("tutorialDataStore",["httpService",function(e){return t.createTutorialDataStoreService(e)}]).factory("packageHttpService",["httpService",function(e){return t.createPackageHttpService(e)}]).factory("packageService",["$rootScope","telemetryService","errorService","dataServiceModelMerger","dataServiceModelConverter","reportService","modelService","syncService","localizationService","appMetadataService","workbookService","packageCollection","promiseFactory","asyncFeatureSwitchService","packageStore","fetchEntityService","packageHttpService",function(t,r,o,i,a,n,s,c,l,d,p,u,h,f,v,m,g){return e.dataServices.createPackageService(t,r,o,i,a,n,s,c,l,d,p,u,h,f,v,m,g)}]).factory("appService",["appMetadataService","dashboardDataService","appCollection","modelService","reportService","workbookService","promiseFactory","dataServiceModelConverter","asyncFeatureSwitchService","telemetryService","modalDialogService","errorService","localizationService","contentProviderHttpService","packageCollection","appStore","packageService","httpService",function(e,r,o,i,a,n,s,c,l,d,p,u,h,f,v,m,g,y){return t.createAppService(e,r,o,i,a,n,s,c,l,d,p,u,h,f,v,m,g,y)}]).factory("subscriptionsHttp",["httpService","promiseFactory","telemetryService",function(e,r,o){return t.createSubscriptionsHttpService(e,r,o)}]).factory("mobileAuthoringService",["gridLayout","localizationService","navigation","notificationToast","telemetryService",function(t,r,o,i,a){return e.dataServices.createMobileAuthoringService(t,r,o,i,a)}]).factory("datasetSizeService",["folderService",function(e){return new t.DatasetSizeService(e)}]).service("resourceOwnershipService",["userInfo",e.dataServices.ResourceOwnershipService]).factory("permissionRefresh",["userInfo","dashboardSyncService","dashboardDataService","promiseFactory",function(e,r,o,i){return t.createPermissionRefreshService(e,r,o,i)}]).factory("appSourceHttpService",["httpService",function(t){return e.dataServices.createAppSourceHttpService(t)}]).factory("smartAlertsHttpService",["httpService",function(t){return e.dataServices.createSmartAlertsHttpService(t)}]).factory("smartAlertsService",["telemetryService","errorService","localizationService","smartAlertsHttpService",function(t,r,o,i){return e.dataServices.createSmartAlertsService(t,r,o,i)}]).factory("fetchEntityService",["promiseFactory",function(t){return e.dataServices.createFetchEntityService(t)}]).factory("rdlReportService",["httpService","promiseFactory",function(t,r){return e.dataServices.createRdlReportsService(r,t)}]).run(["scopedProvider",function(e){e.register("exportData",{services:["promiseFactory","notificationToast","localizationService","conceptualSchemaProxy","featureSwitchService","visualPlugin","displayNameService","aggrOps","fileSaver","modelService"],scopedServices:["filterRestatement","lazyScoped","lazyScopedSync","visualPluginOps"],fn:function(e,r,o,i,a,n,s,c,l,d,p,u,h,f){return t.createExportDataService(e,r,o,i,n,f,a,s,c,p,l,u,d,h)}})}])})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){function t(e){return new r(e)}e.createAppSourceHttpService=t;var r=(function(){function e(e){this.httpService=e}return e.prototype.getRecommendedApps=function(e){var t=this.httpService.powerbiRequestOptions(e,"GetSpzaApps",{dismissGroupObjectId:!0});return this.httpService.get("/v1.0/orgapp/v1.0/spza/applications",t)},e})()})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){function t(e,t,o,i,a,n,s,c){return new r(e,t,o,i,a,n,s,c)}e.createAppInstanceService=t;var r=(function(){function e(e,t,r,o,i,a,n,s){this.app=e,this.dashboardDataService=t,this.modelService=r,this.reportService=o,this.workbookService=i,this.featureSwitchService=a,this.appStore=n,this.promiseFactory=s}return e.prototype.getAppSyncModel=function(){if(this.app){var e=this.app.packageId,t=_.extend({},this.app,{dashboards:this.dashboardDataService.findDashboardsByPackageId(e)||[],reports:this.reportService.findReportsByPackageId(e)||[],workbooks:this.workbookService.findWorkbooksByPackageId(e)||[],models:this.modelService.findModelsByPackageId(e)||[]});return t.dashboardIds=_.map(t.dashboards,(function(e){return e.id})),t.reportIds=_.map(t.reports,(function(e){return e.id})),t.modelIds=_.map(t.models,(function(e){return e.id})),t.workbookIds=_.map(t.workbooks,(function(e){return e.id})),t}},e.prototype.subscribe=function(e){var t=this;this.unsubscribe(),this.appStore.select(this.app.providerContract.providerKey,this.app.packageId);var r=this.featureSwitchService.featureSwitches,o=this.promiseFactory.defer();return r.explorePermissionOnDataset&&r.ngrxStore?this.subscription=this.appStore.selectedApp.subscribe((function(e){if(t.appSyncModel)t.updateAppSyncModel(t.appSyncModel,e);else{var r=t.appSyncModel=t.getInitialAppSyncModel(t.app,e);o.resolve(r)}})):(this.appSyncModel=this.getAppSyncModel(),this.changeHandler=e,this.setupArtifactListeners(),o.resolve(this.appSyncModel)),o.promise},e.prototype.unsubscribe=function(){this.dashboardListener&&(this.dashboardDataService.unsubscribe(this.dashboardListener),this.dashboardListener=null),this.reportListener&&(this.reportService.unsubscribe(this.reportListener),this.reportListener=null),this.workbookListener&&(this.workbookService.unsubscribe(this.workbookListener),this.workbookListener=null),this.modelListener&&(this.modelService.unsubscribe(this.modelListener),this.modelListener=null),this.subscription&&(this.subscription.unsubscribe(),this.subscription=null),this.appSyncModel=null,this.changeHandler=null},e.prototype.getInitialAppSyncModel=function(e,t){var r=this.dashboardDataService,o=this.reportService,i=this.workbookService,a=this.modelService,n=_.extend({},e,{dashboards:_(t.dashboards).map((function(e){return r.findDashboardByGUID(e.objectId)})).compact().value(),reports:_(t.reports).map((function(e){return o.findReportByGUID(e.objectId)})).compact().value(),workbooks:_(t.workbooks).map((function(e){return i.findWorkbook(e.id,e.packageId)})).compact().value(),models:_(t.models).map((function(e){return a.findModel(e.id,e.packageId)})).compact().value()});return n.dashboardIds=_.map(n.dashboards,(function(e){return e.id})),n.reportIds=_.map(n.reports,(function(e){return e.id})),n.modelIds=_.map(n.models,(function(e){return e.id})),n.workbookIds=_.map(n.workbooks,(function(e){return e.id})),n},e.prototype.updateAppSyncModel=function(e,t){var r=this.dashboardDataService,o=this.reportService,i=this.workbookService,a=this.modelService,n=_(t.dashboards).map((function(e){return r.findDashboardByGUID(e.objectId)})).compact().value();this.onArtifactsReset(n,e.dashboardIds,e.dashboards);var s=_(t.reports).map((function(e){return o.findReportByGUID(e.objectId)})).compact().value();this.onArtifactsReset(s,e.reportIds,e.reports);var c=_(t.workbooks).map((function(e){return i.findWorkbook(e.id,e.packageId)})).compact().value();this.onArtifactsReset(c,e.workbookIds,e.workbooks);var l=_(t.models).map((function(e){return a.findModel(e.id,e.packageId)})).compact().value();this.onArtifactsReset(l,e.modelIds,e.models)},e.prototype.onArtifactAdded=function(e,t,r){_.includes(t,e.id)||(t.push(e.id),r.push(e),this.changeHandler&&this.changeHandler(e,0))},e.prototype.onArtifactDeleted=function(e,t,r){_.includes(t,e.id)&&(_.pull(t,e.id),_.pull(r,e),this.changeHandler&&this.changeHandler(e,1))},e.prototype.onArtifactsReset=function(e,t,r){for(var o=[],i={},a=0,n=e;a<n.length;a++){var s=n[a],c=s.id;
o.push(c),i[c]=s}for(var l=_.difference(t,o),d=_.difference(o,t),p=function(e){var o=_.find(r,(function(t){return t.id===e}));u.onArtifactDeleted(o,t,r)},u=this,h=0,f=l;h<f.length;h++){var c=f[h];p(c)}for(var v=0,m=d;v<m.length;v++){var c=m[v];this.onArtifactAdded(i[c],t,r)}},e.prototype.setupArtifactListeners=function(){var e=this;if(this.appSyncModel){var t=this.appSyncModel,r=t.packageId;this.dashboardListener={onDashboardAdded:function(o){o.contract.originalPackageId===r&&e.onArtifactAdded(o,t.dashboardIds,t.dashboards)},onDashboardDeleted:function(o){o.contract.originalPackageId===r&&e.onArtifactDeleted(o,t.dashboardIds,t.dashboards)},onDashboardsReset:function(){var o=e.dashboardDataService.findDashboardsByPackageId(r)||[];e.onArtifactsReset(o,t.dashboardIds,t.dashboards)}},this.dashboardDataService.subscribe(this.dashboardListener),this.reportListener={onReportAdded:function(o){o.packageId===r&&e.onArtifactAdded(o,t.reportIds,t.reports)},onReportDeleted:function(o){o.packageId===r&&e.onArtifactDeleted(o,t.reportIds,t.reports)},onReportsReset:function(){var o=e.reportService.findReportsByPackageId(r)||[];e.onArtifactsReset(o,t.reportIds,t.reports)}},this.reportService.subscribe(this.reportListener),this.workbookListener={onWorkbookAdded:function(o){o.packageId===r&&e.onArtifactAdded(o,t.workbookIds,t.workbooks)},onWorkbookDeleted:function(o){o.packageId===r&&e.onArtifactDeleted(o,t.workbookIds,t.workbooks)},onWorkbooksReset:function(){var o=e.workbookService.findWorkbooksByPackageId(r)||[];e.onArtifactsReset(o,t.workbookIds,t.workbooks)}},this.workbookService.subscribe(this.workbookListener),this.modelListener={onModelAdded:function(o){o.packageId===r&&e.onArtifactAdded(o,t.modelIds,t.models)},onModelDeleted:function(o){o.packageId===r&&e.onArtifactDeleted(o,t.modelIds,t.models)},onModelsReset:function(){var o=e.modelService.findModelsByPackageId(r)||[];e.onArtifactsReset(o,t.modelIds,t.models)}},this.modelService.subscribe(this.modelListener)}},e})()})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){function t(e){return new r(e)}e.createCdsaModelSyncService=t;var r=(function(){function e(e){this.cdsaModelStore=e}return e.prototype.onCdsaModelAdded=function(e){this.cdsaModelStore.load(e)},e.prototype.onCdsaModelDeleted=function(e){this.cdsaModelStore.delete(e,!0)},e.prototype.onCdsaModelUpdated=function(e){this.cdsaModelStore.load(e)},e})()})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){function r(e){return new o(e)}var o=(function(){function t(e){this.promiseFactory=e,this.fetchEntityHandlers={}}return t.prototype.addFetchEntityHandler=function(t,r){e.contract.checkValue(t,"pre-condition: addFetchEntityHandler() entityType"),e.contract.checkValue(r,"pre-condition: addFetchEntityHandler() handler");var o=this.fetchEntityHandlers[t];o?o.push(r):this.fetchEntityHandlers[t]=[r]},t.prototype.ensureFetched=function(e){if(_.isEmpty(e))return this.promiseFactory.resolve(null);for(var t=[],r=0,o=e;r<o.length;r++){var i=o[r],a=this.fetchEntityHandlers[i.type];if(_.isEmpty(a))break;for(var n=0,s=a;n<s.length;n++){var c=s[n],l=c.ensureFetched(i);l&&t.push(l)}}return this.promiseFactory.all(t)},t})();t.FetchEntityService=o,t.createFetchEntityService=r})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){function r(e,t){return new o(e,t)}t.createRdlReportsService=r;var o=(function(){function t(e,t){this.httpService=t,this.promiseFactory=e}return t.prototype.discoverDataSources=function(t){return __awaiter(this,void 0,e.Promise,(function(){var e;return __generator(this,(function(r){return e=this.promiseFactory.defer(),this.httpService.get("metadata/rdl/"+t+"/datasources/monikers",this.httpService.powerbiRequestOptions()).then((function(t){e.resolve(t.data)}),(function(t){e.reject(t)})),[2,e.promise]}))}))},t.prototype.getRdlReportDataSources=function(t){return __awaiter(this,void 0,e.Promise,(function(){var e;return __generator(this,(function(r){return e=this.promiseFactory.defer(),this.httpService.get("metadata/rdl/"+t+"/datasources",this.httpService.powerbiRequestOptions()).then((function(t){e.resolve(t.data)}),(function(t){e.reject(t)})),[2,e.promise]}))}))},t.prototype.bindRdlToGateway=function(t){return __awaiter(this,void 0,e.Promise,(function(){var e;return __generator(this,(function(r){return e=this.promiseFactory.defer(),this.httpService.post("metadata/rdl/datasources/monikers/bind",t,this.httpService.powerbiRequestOptions()),[2,e.promise]}))}))},t.prototype.takeoverDatasource=function(e){var t=this.promiseFactory.defer();return this.httpService.post("metadata/rdl/"+e+"/datasources/takeover",null,this.httpService.powerbiRequestOptions()).then((function(e){t.resolve(e)}),(function(e){t.reject(e)})),t.promise},t})();t.RdlReportsService=o})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){function r(e,t,r,i){return new o(e,t,r,i)}t.createSchemaRefreshService=r;var o=(function(){function t(e,t,r,o){this.conceptualSchemaProxy=e,this.navigation=t,this.reportService=r,this.syncService=o}return t.prototype.init=function(){this.syncService.addModelRefreshListener(this)},t.prototype.onModelAdded=function(){},t.prototype.onModelDeleted=function(){},t.prototype.onModelsUpdated=function(e){for(var t=0,r=e;t<r.length;t++){var o=r[t];this.onModelUpdated(o.modelId,o.packageId)}},t.prototype.onModelUpdated=function(t,r){if(!this.IsActiveReportModel(t)){var o=e.explore.contracts.createDataSourceArray([{type:"dsr",id:t,packageId:r,name:void 0}]);this.conceptualSchemaProxy.clearCache(null,o)}},t.prototype.IsActiveReportModel=function(e){if(this.navigation.inReportView()){var t=this.reportService.findReportByGUID(this.navigation.currentReportGUID);if(t)return t.modelId===e}return!1},t})()})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));;"use strict";var __awaiter=this&&this.__awaiter||function(e,t,i,o){return new(i||(i=Promise))(function(r,s){function n(e){try{l(o.next(e))}catch(e){s(e)}}function a(e){try{l(o.throw(e))}catch(e){s(e)}}function l(e){e.done?r(e.value):new i(function(t){t(e.value)}).then(n,a)}l((o=o.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){function i(e){return function(t){return o([e,t])}}function o(i){if(r)throw new TypeError("Generator is already executing.");for(;l;)try{if(r=1,s&&(n=2&i[0]?s.return:i[0]?s.throw||((n=s.return)&&n.call(s),0):s.next)&&!(n=n.call(s,i[1])).done)return n;switch(s=0,n&&(i=[2&i[0],n.value]),i[0]){case 0:case 1:n=i;break;case 4:return l.label++,{value:i[1],done:!1};case 5:l.label++,s=i[1],i=[0];continue;case 7:i=l.ops.pop(),l.trys.pop();continue;default:if(n=l.trys,!(n=n.length>0&&n[n.length-1])&&(6===i[0]||2===i[0])){l=0;continue}if(3===i[0]&&(!n||i[1]>n[0]&&i[1]<n[3])){l.label=i[1];break}if(6===i[0]&&l.label<n[1]){l.label=n[1],n=i;break}if(n&&l.label<n[2]){l.label=n[2],l.ops.push(i);break}n[2]&&l.ops.pop(),l.trys.pop();continue}i=t.call(e,l)}catch(e){i=[6,e],s=0}finally{r=n=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}var r,s,n,a,l={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return a={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a};window.DEBUG=!1;var powerbi;!(function(e){var t;!(function(t){function i(i,r,n,a,l,c,p,u,d,h,v,g,m,y){var b=t.CustomerAction(n,a,l,c,p,u,d,h,v,g,m,y),f=s(b.info,{action:i,booleanValue:r});return{name:"PBI.ExplorationAppBar.Action",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:o(),formatted:function(){return e.extendFormatted({action:f.action,booleanValue:f.booleanValue},null,b.formatted())},info:f,loggers:t.ExplorationAppBarActionLoggers}}var o,r=jsCommon.Utility,s=jsCommon.UnionExtensions.mergeUnionType;o=r?r.generateGuid:Function.prototype,t.ExplorationAppBarAction=i})(t=e.telemetry||(e.telemetry={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){function o(t){var i=[{name:"AppBarFlyoutMenu",blockType:2,consumerHostFlags:362},{name:"ExplorationAppBar",blockType:2,consumerHostFlags:362},{name:"ExplorationContainer",blockType:1,consumerHostFlags:330}];r.registerBuildingBlocksForHost(t,i,{componentsTarget:"powerbi.explore.components",componentsMap:e.explore.components,directivesTarget:"powerbi.explore.directives",directivesMap:e.explore.directives,filtersTarget:"powerbi.explore.filters",filtersMap:e.explore.filters})}var r=e.common;angular.module("powerbi.explore").run(["scopedProvider",function(e){e.register("explorationContainerMixins",{services:[],scopedServices:["mixinScoped"],fn:function(e){return e.get("explorationContainer")}}).register("customVisualLoader",{services:["promiseFactory","resourceGateService","resourcePackagesService","telemetryService","embedModeService","$rootScope"],scopedServices:["eventBridge","visualPlugin"],fn:function(e,i,o,r,s,n,a,l){return new t.services.CustomVisualLoader(a,e,i,o,l,r,s,n)}}).register("explorationAppBarMixins",{services:[],scopedServices:["mixinScoped"],fn:function(e){return e.get("explorationAppBar")}})}]),i.registerBuildingBlocksForHost=o})(i=t.exploration||(t.exploration={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){e.openReportFinished="OpenReportFinished",e.serverErrorPrefix="ServerError_",e.configureScheduledRefreshLink="https://go.microsoft.com/fwlink/?linkid=844603"})(t=e.constants||(e.constants={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t="Flyout",i=(function(){function e(e,t){this.services=t}return e.createOptions=function(){return{additionalServices:["dropdown","overlayService"]}},e.prototype.$onDestroy=function(){this.services.dropdown.hideAll()},e.prototype.openFlyout=function(e){var i=this,o=this.menuOverlayName+t,r=this.services.overlayService.getOverlayElement(o);if(_.isEmpty(r.length)){var s={menuOverlayName:o,menuItemClass:this.menuItemClass,glyphSmall:this.glyphSmall,menuActionSelected:function(e){return i.menuActionSelected({$item:e})},getMenuActions:function(){return i.flyoutItem.flyoutActions},getMode:function(){return i.getMode()}},n={anchorElement:$(e.currentTarget),blurNeeded:!1,disableAnimation:!0,preferLeft:!1,horizontal:!0};this.services.dropdown.showMenu(s,"appBarMenu.html",n)}},e})();e.AppBarFlyoutMenuController=i})(t=e.controllers||(e.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){i.AppBarFlyoutMenu={templateUrl:"components/appBarFlyoutMenu/appBarFlyoutMenu.html",controller:e.common.createController(t.controllers.AppBarFlyoutMenuController),bindings:{flyoutItem:"<",menuOverlayName:"<",menuItemClass:"<",glyphSmall:"<",getMode:"&",menuActionSelected:"&"}}})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t,i=jsCommon.EnumExtensions;!(function(e){e[e.SaveToDashboard=0]="SaveToDashboard",e[e.SaveAs=1]="SaveAs",e[e.EmbedSnapshot=2]="EmbedSnapshot",e[e.EmbedSharepoint=3]="EmbedSharepoint",e[e.ImportCustom=4]="ImportCustom",e[e.Print=5]="Print",e[e.ShowDiagnosticInfo=6]="ShowDiagnosticInfo",e[e.ExportPowerPoint=7]="ExportPowerPoint",e[e.DownloadReport=8]="DownloadReport",e[e.SecurePublishToWeb=9]="SecurePublishToWeb",e[e.Dynamic=10]="Dynamic",e[e.ActualSize=11]="ActualSize",e[e.FitToWidth=12]="FitToWidth",e[e.FitToPage=13]="FitToPage",e[e.ShowGrid=14]="ShowGrid",e[e.ShowSmartGuides=15]="ShowSmartGuides",e[e.SnapToGrid=16]="SnapToGrid",e[e.ShowBookmarks=17]="ShowBookmarks",e[e.ShowCanvasItems=18]="ShowCanvasItems",e[e.ShowSyncGroupPane=19]="ShowSyncGroupPane",e[e.LockObjects=20]="LockObjects",e[e.HighContrast1=21]="HighContrast1",e[e.HighContrast2=22]="HighContrast2",e[e.HighContrastBlack=23]="HighContrastBlack",e[e.HighContrastWhite=24]="HighContrastWhite",e[e.HighContrastNone=25]="HighContrastNone",e[e.EditInWebApp=26]="EditInWebApp",e[e.EditInDesktop=27]="EditInDesktop",e[e.SeeData=28]="SeeData",e[e.ExpandVisual=29]="ExpandVisual",e[e.ExpandVisualGrouped=30]="ExpandVisualGrouped",e[e.DrillUp=31]="DrillUp",e[e.DrillDown=32]="DrillDown",e[e.Drillthrough=33]="Drillthrough",e[e.SeeRecords=34]="SeeRecords",e[e.InsertShape=35]="InsertShape",e[e.InsertActionButton=36]="InsertActionButton",e[e.EditVisualInteractionsMode=37]="EditVisualInteractionsMode",e[e.DrillFilterOtherVisuals=38]="DrillFilterOtherVisuals",e[e.AlignLeft=39]="AlignLeft",e[e.AlignCenter=40]="AlignCenter",e[e.AlignRight=41]="AlignRight",e[e.AlignTop=42]="AlignTop",e[e.AlignMiddle=43]="AlignMiddle",e[e.AlignBottom=44]="AlignBottom",e[e.DistributeHorizontal=45]="DistributeHorizontal",e[e.DistributeVertical=46]="DistributeVertical",e[e.AnalyzeInExcel=47]="AnalyzeInExcel",e[e.ExportStaticReport=48]="ExportStaticReport",e[e.GenerateQR=49]="GenerateQR"})(t=e.AppBarAction||(e.AppBarAction={}));var o;!(function(e){e[e.Rectangle=0]="Rectangle",e[e.Oval=1]="Oval",e[e.Line=2]="Line",e[e.Triangle=3]="Triangle",e[e.Arrow=4]="Arrow"})(o=e.Shape||(e.Shape={}));var r;!(function(e){function r(e,i,o,r,n,a,l){void 0===l&&(l=!0);var c=[{text:e.get("ReportAppBar_ViewFitToPage"),action:t.FitToPage,itemClass:"pbi-glyph-fittopage2",type:DropDownMenuItemType.Item,disabled:!1,checked:1===n,tooltip:e.get("ReportAppBar_ViewFitToPageDescription")},{text:e.get("ReportAppBar_ViewFitToWidth"),action:t.FitToWidth,itemClass:"pbi-glyph-fittowidth",type:DropDownMenuItemType.Item,disabled:!1,checked:2===n,tooltip:e.get("ReportAppBar_ViewFitToWidthDescription")},{text:e.get("ReportAppBar_ViewActualSize"),action:t.ActualSize,itemClass:"pbi-glyph-actualsize",type:DropDownMenuItemType.Item,disabled:!1,checked:3===n,tooltip:e.get("ReportAppBar_ViewActualSizeDescription")},{action:null,type:DropDownMenuItemType.Separator},s(e,a)];return r&&(c.push({type:DropDownMenuItemType.Separator}),o.featureSwitches.redlineAlignment&&c.push({text:e.get("ReportAppBar_ShowSmartGuides"),action:t.ShowSmartGuides,itemClass:"pbi-glyph-smartguides",type:DropDownMenuItemType.Item,disabled:!1,checkbox:!0,checked:i.getShowSmartGuides(),tooltip:e.get("ReportAppBar_ShowSmartGuidesDescription")}),c.push({text:e.get("ReportAppBar_ShowGrid"),action:t.ShowGrid,itemClass:"pbi-glyph-showgrid",type:DropDownMenuItemType.Item,disabled:!1,checkbox:!0,checked:i.getShowGridlines(),tooltip:e.get("ReportAppBar_ShowGridDescription")}),c.push({text:e.get("ReportAppBar_SnapToGrid"),action:t.SnapToGrid,itemClass:"pbi-glyph-snaptogrid",type:DropDownMenuItemType.Item,disabled:!1,checkbox:!0,checked:i.getSnapToGrid(),tooltip:e.get("ReportAppBar_SnapToGridDescription")}),c.push({text:e.get("ReportAppBar_LockObjects"),action:t.LockObjects,itemClass:"pbi-glyph-lock",type:DropDownMenuItemType.Item,disabled:!1,checkbox:!0,checked:!1})),c.push({type:DropDownMenuItemType.Separator}),c.push({text:e.get("ReportAppBar_Selection"),action:t.ShowCanvasItems,itemClass:"pbi-glyph-show",type:DropDownMenuItemType.Item,disabled:!1,checkbox:!0,checked:!1,tooltip:e.get("ReportAppBar_Selection")}),l&&c.push({text:e.get("ReportAppBar_Bookmarks"),action:t.ShowBookmarks,itemClass:"pbi-glyph-bookmark",type:DropDownMenuItemType.Item,disabled:!1,checkbox:!0,checked:!1,tooltip:e.get("ReportAppBar_Bookmarks")}),r&&o.featureSwitches.slicerSyncing&&c.push({text:e.get("ReportAppBar_SyncGroupPane"),action:t.ShowSyncGroupPane,itemClass:"pbi-glyph-filtersync",type:DropDownMenuItemType.Item,disabled:!1,checkbox:!0,checked:!1,tooltip:e.get("ReportAppBar_SyncGroupPane")}),c}function s(e,i){var o=[{text:e.get("None"),action:t.HighContrastNone,itemClass:"pbi-glyph-blank",type:DropDownMenuItemType.Item,checked:null==i},{text:e.get("HighContrastMode_1"),action:t.HighContrast1,itemClass:"pbi-glyph-blank",type:DropDownMenuItemType.Item,checked:"HighContrast1"===i},{text:e.get("HighContrastMode_2"),action:t.HighContrast2,itemClass:"pbi-glyph-blank",type:DropDownMenuItemType.Item,checked:"HighContrast2"===i},{text:e.get("HighContrastMode_Black"),action:t.HighContrastBlack,itemClass:"pbi-glyph-blank",type:DropDownMenuItemType.Item,checked:"HighContrastBlack"===i},{text:e.get("HighContrastMode_White"),action:t.HighContrastWhite,itemClass:"pbi-glyph-blank",type:DropDownMenuItemType.Item,checked:"HighContrastWhite"===i}];return{text:e.get("HighContrastMode"),itemClass:"pbi-glyph-blankflyout",type:DropDownMenuItemType.Flyout,flyoutActions:o}}function n(e,i){return[{text:e.get("ReportAppBar_EditReportInWebApp"),description:e.get("ReportAppBar_EditReportInWebAppDescription"),action:t.EditInWebApp,itemClass:"pbi-glyph-powerbi-service",type:DropDownMenuItemType.Item,tooltip:e.get("ReportAppBar_EditReportInWebAppDescription")},{text:e.get("ReportAppBar_EditReportInDesktop"),description:e.get("ReportAppBar_EditReportInDesktopDescription"),action:t.EditInDesktop,itemClass:"pbi-glyph-powerbi",type:DropDownMenuItemType.Item,disabled:!i,tooltip:i?e.get("ReportAppBar_EditReportInDesktopDescription"):e.get("ReportAppBar_DisabledEditReportInDesktopTooltip")}]}function a(){return[{type:DropDownMenuItemType.CustomComponent,lazyModulePath:"@powerbi/SharedViews/shared-views.module#SharedViewsModule",lazyComponentId:"WebBookmarksComponentId"}]}function l(e){var i=e.localizationService,o=[];if(e.showSave&&o.push({text:i.get("ReportAppBar_SaveToDashboard"),description:i.get("ReportAppBar_SaveToDashboardDescription"),action:t.SaveToDashboard,itemClass:"pbi-glyph-save",type:DropDownMenuItemType.Item,tooltip:i.get("ReportAppBar_SaveToDashboardDescription")}),e.showSaveAs&&o.push({text:i.get("ReportAppBar_SaveAs"),description:i.get("ReportAppBar_SaveAsDescription"),action:t.SaveAs,itemClass:"pbi-glyph-saveas",type:DropDownMenuItemType.Item,tooltip:i.get("ReportAppBar_SaveAsDescription")}),e.showPrint&&o.push({text:i.get("ReportAppBar_Print"),description:i.get("ReportAppBar_PrintDescription"),action:t.Print,itemClass:"pbi-glyph-print",type:DropDownMenuItemType.Item,tooltip:i.get("ReportAppBar_PrintDescription")}),e.showSecurePublishToWeb&&o.push({text:i.get("Embed"),description:i.get("PublishToWebSecure_Description"),action:t.SecurePublishToWeb,itemClass:"pbi-glyph-publishtoweb",type:DropDownMenuItemType.Item,tooltip:i.get("PublishToWebSecure_Description")}),e.showSharepointEmbed&&o.push({text:i.get("ReportAppBar_SharePointEmbed"),description:i.get("ReportAppBar_SharePointEmbedDescription"),action:t.EmbedSharepoint,itemClass:"pbi-glyph-sharepoint",type:DropDownMenuItemType.Item,tooltip:i.get("ReportAppBar_SharePointEmbedDescription")}),e.showEmbed&&o.push({text:i.get("ReportAppBar_SnapshotEmbed"),description:i.get("ReportAppBar_SnapshotEmbedDescription"),action:t.EmbedSnapshot,itemClass:"pbi-glyph-publishtoweb",type:DropDownMenuItemType.Item,tooltip:i.get("ReportAppBar_SnapshotEmbedDescription")}),e.showDiagnostics&&o.push({text:i.get("ReportAppBar_Diagnostics"),description:i.get("ReportAppBar_DiagnosticsDescription"),action:t.ShowDiagnosticInfo,itemClass:"pbi-glyph-code",type:DropDownMenuItemType.Item,tooltip:i.get("ReportAppBar_DiagnosticsDescription")}),e.showPowerPoint&&o.push({text:i.get("ReportAppBar_PowerPoint"),description:i.get("ReportAppBar_PowerPointDescription"),action:t.ExportPowerPoint,itemClass:"pbi-glyph-powerpoint",type:DropDownMenuItemType.Item,tooltip:i.get("ReportAppBar_PowerPointDescription")}),e.showDownloadReport){var r=!e.canDownloadReport||e.downloadReportDenied,s=i.get("ReportAppBar_DownloadReportDescription");r&&(s=e.canDownloadReport?i.get("DatasetContextMenu_DownloadDatasetDeniedTooltip"):i.get("ReportAppBar_DisabledDownloadReportTooltip")),o.push({text:i.get("ReportAppBar_DownloadReport"),description:i.get("ReportAppBar_DownloadReportDescription"),action:t.DownloadReport,itemClass:"pbi-glyph-download2",type:DropDownMenuItemType.Item,disabled:r,tooltip:s})}return o}function c(e,i){return[{text:e.get("VisualContainer_SeeData_Enable"),action:t.SeeData,itemClass:"pbi-glyph-seedata",type:DropDownMenuItemType.Item,disabled:!0,checkbox:!0,tooltip:i.isSeeDataMode?e.get("VisualContainer_SeeData_Disable"):e.get("VisualContainer_SeeData_Enable")},{type:DropDownMenuItemType.Separator},{text:e.get("DrillDownLevel"),action:t.ExpandVisual,itemClass:"pbi-glyph-expand",type:DropDownMenuItemType.Item,disabled:!0,checked:!1,tooltip:e.get("DrillDownLevel_ToolTip")},{text:e.get("DrillDownLevelGrouped"),action:t.ExpandVisualGrouped,itemClass:"pbi-glyph-inline-drill",type:DropDownMenuItemType.Item,disabled:!0,checked:!1,tooltip:e.get("DrillDownLevelGrouped_ToolTip")},{text:e.get("DrillUp"),action:t.DrillUp,itemClass:"pbi-glyph-drillup",type:DropDownMenuItemType.Item,disabled:!0,checked:!1,tooltip:e.get("DrillUp_ToolTip")},{type:DropDownMenuItemType.Separator},{text:e.get("DrillDown"),action:t.DrillDown,itemClass:"pbi-glyph-drilldowndisabled",type:DropDownMenuItemType.Item,checkbox:!0,disabled:!0,tooltip:i.isDrillDownMode?e.get("DrillMode_ToolTip"):e.get("DrillDown_ToolTip")},{text:e.get("Drillthrough"),action:t.Drillthrough,itemClass:"pbi-glyph-drillthrough",type:DropDownMenuItemType.Item,checkbox:!0,disabled:!0,tooltip:i.isDrillthroughMode?e.get("DrillthroughMode_ToolTip"):e.get("Drillthrough_ToolTip")},{text:e.get("DrillToDetails"),action:t.SeeRecords,itemClass:"pbi-glyph-drilltodetail",type:DropDownMenuItemType.Item,checkbox:!0,disabled:!0,tooltip:i.isDrillToDetailsMode?e.get("DrillToDetailsMode_ToolTip"):e.get("DrillToDetails_ToolTip")}]}function p(e){return[h(e.get("ReportAppBar_ShapeRectangle"),e.get("ReportAppBar_ShapeRectangleDescription"),"shapeRectangle",o.Rectangle,t.InsertShape),h(e.get("ReportAppBar_ShapeOval"),e.get("ReportAppBar_ShapeOvalDescription"),"shapeOval",o.Oval,t.InsertShape),h(e.get("ReportAppBar_ShapeLine"),e.get("ReportAppBar_ShapeLineDescription"),"shapeLine",o.Line,t.InsertShape),h(e.get("ReportAppBar_ShapeTriangle"),e.get("ReportAppBar_ShapeTriangleDescription"),"shapeTriangle",o.Triangle,t.InsertShape),h(e.get("ReportAppBar_ShapeArrow"),e.get("ReportAppBar_ShapeArrowDescription"),"shapeArrow",o.Arrow,t.InsertShape)]}function u(e){for(var i=new Array,o=[{name:"ReportAppBar_LeftArrow",glyphClass:"back",param:"leftArrow"},{name:"ReportAppBar_RightArrow",glyphClass:"rightarrow",param:"rightArrow"},{name:"Reset",glyphClass:"reload",param:"reset"},{name:"Generic_Back",glyphClass:"backarrow",param:"back"},{name:"ReportAppBar_InfoIcon",glyphClass:"info",param:"information"},{name:"Generic_Help",glyphClass:"help",param:"help"},{name:"Generic_Qna",glyphClass:"qna",param:"qna"},{name:"Generic_Bookmark",glyphClass:"bookmark",param:"bookmarks"},{name:"ReportAppBar_Blank",glyphClass:"blank",param:"blank"}],r=0,s=o;r<s.length;r++){var n=s[r];i.push({text:e.get(n.name),action:t.InsertActionButton,itemClass:"pbi-glyph-"+n.glyphClass,type:DropDownMenuItemType.Item,param:n.param})}return i}function d(e,i){var o=[{text:e.get("ReportAppBar_EditVisualInteractions"),action:t.EditVisualInteractionsMode,itemClass:"pbi-glyph-visualinteraction",type:DropDownMenuItemType.Item,disabled:!1,checkbox:!0,checked:!1,tooltip:e.get("ReportAppBar_EditVisualInteractionsDescription")}];return o.push({text:e.get("ReportAppBar_DrillFilterOtherVisuals"),action:t.DrillFilterOtherVisuals,itemClass:"pbi-glyph-drillFilterOtherVisuals",type:DropDownMenuItemType.Item,disabled:!1,checkbox:!0,checked:!1,tooltip:e.get("ReportAppBar_DrillFilterOtherVisualsDescription")}),o}function h(e,t,r,s,n){return{text:e,description:t,action:n,itemClass:"displayOption "+r,type:DropDownMenuItemType.Item,param:i.toString(o,s).toLowerCase()}}function v(e){return[{text:e.get("ReportAppBar_Left"),description:e.get("Align_Left"),action:t.AlignLeft,itemClass:"alignAction",type:DropDownMenuItemType.Item},{text:e.get("ReportAppBar_Center"),description:e.get("Align_Center"),action:t.AlignCenter,itemClass:"alignAction",type:DropDownMenuItemType.Item},{text:e.get("ReportAppBar_Right"),description:e.get("Align_Right"),action:t.AlignRight,itemClass:"alignAction",type:DropDownMenuItemType.Item},{text:e.get("Top"),description:e.get("Align_Top"),action:t.AlignTop,itemClass:"alignAction",type:DropDownMenuItemType.Item},{text:e.get("Middle"),description:e.get("Align_Middle"),action:t.AlignMiddle,itemClass:"alignAction",type:DropDownMenuItemType.Item},{text:e.get("Bottom"),description:e.get("Align_Bottom"),action:t.AlignBottom,itemClass:"alignAction",type:DropDownMenuItemType.Item}]}function g(e){return[{text:e.get("ReportAppBar_Horizontal"),description:e.get("ReportAppBar_HorizontalDescription"),action:t.DistributeHorizontal,itemClass:"distributeAction",type:DropDownMenuItemType.Item},{text:e.get("ReportAppBar_Vertical"),description:e.get("ReportAppBar_VerticalDescription"),action:t.DistributeVertical,itemClass:"distributeAction",type:DropDownMenuItemType.Item}]}function m(e,i,o,r,s,n){var a=[];if(s&&a.push({text:e.get("Report_GenerateQRCode"),action:t.GenerateQR,tooltip:e.get("Report_GenerateQRCode"),type:DropDownMenuItemType.Item}),i.isAnalyzeInExcelSupported(o,r)){var l=n?e.get("AnalyzeInExcelDenied_Tooltip"):e.get("ReportAppBar_AnalyzeInExcelMenuItem_Text");a.push({text:e.get("ReportAppBar_AnalyzeInExcelMenuItem_Text"),action:t.AnalyzeInExcel,tooltip:l,disabled:n,type:DropDownMenuItemType.Item})}return o.featureSwitches.staticExportReportEnabled&&a.push({text:e.get("ReportAppBar_ExportAsImage"),action:t.ExportStaticReport,tooltip:e.get("ReportAppBar_ExportAsImage"),type:DropDownMenuItemType.Item}),a}e.createViewMenuActions=r,e.createEditReportMenuActions=n,e.createBookmarksMenuActions=a,e.createFileMenuActions=l,e.createExploreMenuActions=c,e.createShapeMenuActions=p,e.createActionButtonMenuActions=u,e.createVisualInteractionsActions=d,e.createAlignmentMenuActions=v,e.createDistributeMenuActions=g,e.createReportMoreOptionsMenuItems=m})(r=e.ExplorationAppBarViewModelFactory||(e.ExplorationAppBarViewModelFactory={}))})(t=e.models||(e.models={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var o=t.services,r=t.models.AppBarAction,s=e.dataServices.AppUtils,n=t.contracts.Bookmark,a=e.common.models.CollapsiblePaneExpandedWidth,l=o.events,c=e.telemetry.ExplorationAppBarAction,p=t.models.ExplorationAppBarViewModelFactory,u=e.common.dialog.MessageDialogBuilder,d=o.selectionUtils,h=jsCommon.StringExtensions,v=e.telemetry,g=e.common.angularInjectorController,m=(function(){function i(e,t){this.scope=e,this.services=t,this.extensions={},this.viewModeState=this.services.viewModeState}return i.createOptions=function(){return{additionalServices:["applicationOptions","activeFolderId","dropdown","localizationService","modalDialogService","explorationSerializer","featureSwitchService","errorService","checkUnsavedService","telemetryService","$window","analyzeInExcel","powerBIDesktopLauncher","overlayService","auditing","downloadReport","userInfo","settingsService","taskPaneSliderService","lazy","conceptualSchemaProxy","reportService","appService","modelService","$element","permissionService"],scopedDependencies:["eventBridge","viewModeState","explorationNavigation","explorationCapabilities","explorationAppBarMixins","visibility","drill","selection","visualAuthoring","lazyScoped","dataSources","formFactor"]}},i.prototype.$onInit=function(){var t=this;this.shapeMenuActions=p.createShapeMenuActions(this.services.localizationService),this.alignActions=p.createAlignmentMenuActions(this.services.localizationService),this.distributeActions=p.createDistributeMenuActions(this.services.localizationService),this.actionButtonMenuActions=p.createActionButtonMenuActions(this.services.localizationService),this.services.featureSwitchService.featureSwitches.pauseQueriesEnabled&&(this.canPause=!0),this.scope.$watch((function(){return t.services.viewModeState.getMode()}),(function(e){t.onViewModeChanged(e)})),this.subscriptionManager=this.services.eventBridge.createChannelSubscriptionManager().subscribe(l.visibilityChanged,(function(){t.isPopOutMode=!!t.services.visibility.get()})).subscribe(l.canvasChanged,(function(){var e=t.services.explorationNavigation.getCurrentSection();t.isTransientPage=e.transient})),this.unsubscribeReportChangedEvent=this.services.rootScope.$on(e.common.constants.onReportChangedEventName,(function(e,i){t.pinnedToReportPage&&(t.pinReportPage(),t.pinnedToReportPage=!1)}));var i=this;this.services.explorationAppBarMixins.update(new(function(){function e(){}return Object.defineProperty(e.prototype,"viewModel",{get:function(){return i.viewModel},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"extensions",{get:function(){return i.extensions},enumerable:!0,configurable:!0}),e}()));var o=this.extensions&&this.extensions.appConsumptionOperations;o&&(this.appConsumptionLazyLoadPath=o.getAppConsumptionModulePath(),this.appConsumptionNavPaneToggleWrapperLazyComponentId=o.getAppNavigationPaneToggleWrapperComponentId())},i.prototype.$onDestroy=function(){this.subscriptionManager&&this.subscriptionManager.unsubscribeAll(),this.unsubscribeReportChangedEvent&&this.unsubscribeReportChangedEvent(),this.services.explorationAppBarMixins.destroy()},i.prototype.resetUserState=function(){return __awaiter(this,void 0,e.Promise,(function(){var e,t,i;return __generator(this,(function(o){switch(o.label){case 0:return e=new u(this.services.modalDialogService),t={titleText:"Reset_To_Default",okButtonText:"Reset",cancelButtonText:"Cancel_ButtonText",messageText:"Reset_UserState_Confirmation"},[4,e.show("ConfirmResetUserState",t)];case 1:return i=o.sent(),0===i&&this.services.eventBridge.publishBubbling(this.scope,l.resetPersistentUserState),[2]}}))}))},i.prototype.isResetUserStateVisible=function(){var e=this.services,t=this.extensions.persistentState,i=e.explorationNavigation.getCurrentExploration(),o=0===this.viewModeState.getMode(),r=t&&t.isEnabled(),s=r||this.isUserStateDisabledByAuthor(i)||this.hasActiveStateBookmark(i);return o&&s},i.prototype.isResetUserStateDisabled=function(){var e=this.services.explorationNavigation.getCurrentExploration();return!(this.extensions.persistentState&&this.extensions.persistentState.isClearEnabled(e)||this.hasActiveStateBookmark(e))},i.prototype.getUserStateTooltip=function(){var e=this.services,t=e.explorationNavigation.getCurrentExploration();return this.isUserStateDisabledByAuthor(t)?"PersistentUserState_ResetDisabledByAuthor":this.isResetUserStateDisabled()?"PersistentUserState_ResetDisabled":"PersistentUserState_Reset"},i.prototype.isCommentingEnabled=function(){return!(!this.extensions.annotations||!this.extensions.annotations.isEnabled())},i.prototype.getCommentingTooltip=function(){return this.isCommentingEnabled()?"Comments_Pane_Expand":"Comments_Disabled_Report"},i.prototype.expandCommentingPane=function(){this.extensions.annotations;this.extensions.annotations.togglePane()},i.prototype.showAppNavToggle=function(){var e=this.extensions&&this.extensions.appConsumptionOperations;return!!e&&e.isEnabled()},i.prototype.hasActiveStateBookmark=function(e){return e&&e.activeBookmark?n.isStateBookmark(e.activeBookmark):!(!e||!e.activeWebBookmark)},i.prototype.onViewModeChanged=function(t){return __awaiter(this,void 0,e.Promise,(function(){var e,i,o,r,s;return __generator(this,(function(n){switch(n.label){case 0:return(e=1===t)?(this.scope.$emit("EditMode"),[4,this.services.lazyScoped("qnaExplore")]):[3,4];case 1:return i=n.sent(),[4,this.services.conceptualSchemaProxy.get(this.services.dataSources.get())];case 2:return o=n.sent(),r=this.services.explorationCapabilities.getCapabilities(),s=this,[4,i.isSupported(o,!e,!1,r&&r.qna,{DatabaseName:this.viewModel.datasetModel.dbName,VirtualServerName:this.viewModel.datasetModel.vsName})];case 3:return s.isQnaEnabled=n.sent(),[3,5];case 4:e||(this.scope.$emit("ViewMode"),this.isQnaEnabled=!1,this.viewModeState.updateConfig((function(e){e.showRelationships&&(e.showRelationships=!1)}))),n.label=5;case 5:return[2]}}))}))},i.prototype.getMoreOptionsMenuActions=function(){var e=!this.services.modelService.isActionAllowed(this.viewModel.datasetModel.contract,16);return p.createReportMoreOptionsMenuItems(this.services.localizationService,this.services.analyzeInExcel,this.services.featureSwitchService,this.viewModel.reportPermission,this.canGenerateQR(),e)},i.prototype.isSnapshotAllowed=function(){var e=this.services.featureSwitchService.featureSwitches,t=e.snapshotEmbedEnabled||e.anonymousEmbeddingEnabled,i=this.viewModel,o=i&&i.canEdit&&i.canWrite,r=this.viewModel.exploration,s=r&&r.contract,n=s&&void 0!==s.reportId,a=s&&s.modelExtensions,l=i.datasetModel,c=l&&l.contract,p=l&&l.cloudRlsEnabled,u=c&&c.originalModelId,d=c&&c.onPremModelConnectionString,h=this.services.featureSwitchService.featureSwitches.publishToWebEnabled,v=this.services.activeFolderId.isReadOnly,g=this.services.explorationCapabilities.getCapabilities().disableSnapshot,m=this.isUsageMetricsReport();return t&&!v&&o&&n&&!a&&!u&&!d&&h&&!p&&!g&&!m},i.prototype.isSecurePublishToWebAllowed=function(){var e=this.services.featureSwitchService.featureSwitches.securePublishToWeb,t=this.services.userInfo.isPremiumUser,i=this.viewModel.exploration,o=i&&i.contract&&i.contract.report&&null!=i.contract.report.objectId;return e&&t&&o&&!this.isUsageMetricsReport()},i.prototype.isSharePointEmbedAllowed=function(){var e=this.services.explorationCapabilities.getCapabilities(),t=this.services.featureSwitchService.featureSwitches.sharePointEmbedEnabled&&!e.disableSharePointEmbed,i=this.services.userInfo.isPremiumUser,o=this.viewModel.exploration,r=o&&o.contract&&o.contract.report&&void 0!==o.contract.report.objectId;return t&&i&&r&&!this.isUsageMetricsReport()},i.prototype.isExportToPowerPointAllowed=function(){var e=this.services.featureSwitchService.featureSwitches,t=this.services.explorationCapabilities.getCapabilities(),i=e.exportReportToPowerPointEnabled&&e.exportToPowerPointEnabled&&!t.disableExportToPowerPoint,o=this.viewModel.exploration,r=o&&o.contract&&void 0!==o.contract.reportId;return i&&r&&!this.isUsageMetricsReport()&&this.isNonExternalUser()},i.prototype.canDuplicatePage=function(){return this.canSaveReport()&&!this.isPopOutMode&&!this.isTransientPage},i.prototype.canSaveReport=function(){var e=this.viewModeState.getMode(),t=this.services.featureSwitchService.featureSwitches.explorePermissionOnDataset?this.viewModel.canEdit:this.viewModel.canWrite;return 1===e&&t},i.prototype.canPinPage=function(){var e=this.viewModel,t=this.services.featureSwitchService.featureSwitches.explorePermissionOnDataset?this.viewModel.canEdit:this.viewModel.canWrite,i=this.services.featureSwitchService.featureSwitches.pinReadable?this.canPin():t;return e&&i&&e.exploration&&e.exploration.contract.reportId&&!this.isTransientPage},i.prototype.pinPageDisabled=function(){var e=this.viewModel;return this.services.featureSwitchService.featureSwitches.pinReadable?e&&!this.canPin():e&&!e.canCopy&&!e.canEdit},i.prototype.showPinPage=function(){return!this.services.explorationCapabilities.getCapabilities().disablePin},i.prototype.canGenerateQR=function(){return!this.services.explorationCapabilities.getCapabilities().disableQRGeneration&&this.viewModel&&this.viewModel.exploration&&void 0!==this.viewModel.exploration.contract.reportId&&!this.isUsageMetricsReport()},i.prototype.getFileMenuActions=function(){var e=this.createFileMenuActions(),t=_.find(e,(function(e){return e.action===r.SaveAs})),i=this.viewModel.datasetModel,o=i&&i.contract&&i.contract.contentProviderId;if(!o||!t)return e;var s=this.services.localizationService,n="ReportAppBar_SaveAsDescriptionForUsageMetrics";return 103===o?t.description=s.format(n,[s.get("ReportAppBar_DashboardsKeyword")]):102===o&&(t.description=s.format(n,[s.get("ReportAppBar_ReportsKeyword")])),e},i.prototype.onEmbed=function(){return __awaiter(this,void 0,e.Promise,(function(){return __generator(this,(function(e){switch(e.label){case 0:return this.services.telemetryService.logEvent(c,r[r.EmbedSnapshot],void 0),[4,this.extensions.onEmbed()];case 1:return e.sent(),[2]}}))}))},i.prototype.onSecurePublishToWeb=function(){return __awaiter(this,void 0,e.Promise,(function(){return __generator(this,(function(e){switch(e.label){case 0:return this.services.telemetryService.logEvent(c,r[r.SecurePublishToWeb],void 0),[4,this.extensions.onSecurePublishToWeb()];case 1:return e.sent(),[2]}}))}))},i.prototype.onSharepointEmbed=function(){return __awaiter(this,void 0,e.Promise,(function(){return __generator(this,(function(e){switch(e.label){case 0:return this.services.telemetryService.logEvent(c,r[r.EmbedSharepoint],void 0),[4,this.extensions.onSharepointEmbed()];case 1:return e.sent(),[2]}}))}))},i.prototype.addQnaContainer=function(){this.services.eventBridge.publishToChannel(l.addQnaContainer)},i.prototype.insertTextbox=function(){this.services.eventBridge.publishToChannel(l.createTextbox)},i.prototype.showSwitchMode=function(){return!this.services.explorationCapabilities.getCapabilities().disableSwitchMode},i.prototype.showReportMoreOptionsMenu=function(){return!this.services.explorationCapabilities.getCapabilities().disableMoreOptions&&!!this.viewModel.reportPermission&&this.getMoreOptionsMenuActions().length>0},i.prototype.fileMenuActionSelected=function(e){if(!e.disabled)switch(e.action){case r.SaveToDashboard:this.save(0);break;case r.SaveAs:this.saveAs();break;case r.EmbedSnapshot:this.onEmbed();break;case r.EmbedSharepoint:this.onSharepointEmbed();break;case r.Print:this.print();break;case r.ShowDiagnosticInfo:this.showDiagnosticInfo();break;case r.ExportPowerPoint:this.exportToPowerPoint();break;case r.DownloadReport:this.downloadReport();break;case r.SecurePublishToWeb:this.onSecurePublishToWeb()}},i.prototype.createFileMenuActions=function(){var e=this.services.featureSwitchService.featureSwitches,t=this.viewModeState.getMode(),i=this.services.explorationCapabilities.getCapabilities(),o={localizationService:this.services.localizationService,
showSave:!i.disableSave&&1===t,showSaveAs:!i.disableSaveAs&&this.viewModel&&(this.viewModel.canEdit||this.canCopyAppReport()),showPrint:e.printingEnabled!==!1&&!i.disablePrint,showEmbed:this.isSnapshotAllowed(),showSecurePublishToWeb:this.isSecurePublishToWebAllowed(),showSharepointEmbed:this.isSharePointEmbedAllowed(),showPowerPoint:this.isExportToPowerPointAllowed(),showDiagnostics:this.services.applicationOptions.diagnostics,showDownloadReport:e.downloadReportEnabled&&e.exportDataEnabled&&this.viewModel&&this.viewModel.canEdit&&!i.disableDownload,canDownloadReport:this.viewModel&&this.viewModel.isReportFromPbix,downloadReportDenied:!this.services.modelService.isActionAllowed(this.viewModel.datasetModel.contract,1)};return p.createFileMenuActions(o)},i.prototype.showDiagnosticInfo=function(){if(this.viewModel.exploration&&this.viewModel.exploration.contract){var e=this.services.rootScope.$new(),t=this.services.explorationSerializer.serializeExploration(this.viewModel.exploration.contract),i=h.stringifyAsPrettyJSON(t),o={dialogName:"",isDismissable:!0,scope:e,template:"<custom-modal-dialog></custom-modal-dialog>",dialogCssClass:"monotype",notificationText:i};this.services.modalDialogService.showLegacyWebModalDialog(o)}},i.prototype.alignActionSelected=function(e){switch(e.action){case r.AlignLeft:this.align(0);break;case r.AlignCenter:this.align(1);break;case r.AlignRight:this.align(2);break;case r.AlignTop:this.align(3);break;case r.AlignMiddle:this.align(4);break;case r.AlignBottom:this.align(5)}},i.prototype.distributeActionSelected=function(e){switch(e.action){case r.DistributeHorizontal:this.align(6);break;case r.DistributeVertical:this.align(7)}},i.prototype.align=function(e){var t={alignmentType:e};this.services.eventBridge.publishToChannel(l.align,t)},i.prototype.print=function(){window.print(),this.services.telemetryService.logEvent(v.DashboardAndReportsPrint,"Report");var t=this.viewModel.exploration&&this.viewModel.exploration.contract&&this.viewModel.exploration.contract.reportId;this.services.auditing.auditEvent(t,e.common.contracts.AuditEntityType.Report,e.common.contracts.AuditActivityType.printReport)},i.prototype.saveFromButton=function(){this.save(1)},i.prototype.save=function(e){var t={overrideSaveRouting:this.services.explorationCapabilities.getCapabilities().overrideSaveRouting,source:e};this.services.eventBridge.publishBubbling(this.scope,l.saveExploration,t)},i.prototype.saveAs=function(){var e=this.isUsageMetricsReport(),t={overrideSaveRouting:this.services.explorationCapabilities.getCapabilities().overrideSaveRouting,isUsageMetrics:e,source:0};this.services.featureSwitchService.featureSwitches.explorePermissionOnDataset||(t.saveAsWithoutPrompt=e),this.services.eventBridge.publishBubbling(this.scope,l.saveAsExploration,t)},i.prototype.refresh=function(){if(this.viewModel.exploration&&this.viewModel.exploration.contract){var e=this.viewModel.exploration.contract;e.report&&this.services.telemetryService.logEvent(v.EXRefreshReport,e.report.objectId,e.activeSectionIndex)}this.services.eventBridge.publishBubbling(this.scope,l.refreshExploration)},i.prototype.edit=function(){this.services.settingsService.setLockObjects(!1),this.services.eventBridge.publishToChannel(l.requestViewModeChange,1),this.services.telemetryService.logEvent(c,r[r.EditInWebApp],!0)},i.prototype.stopEditing=function(){this.setFormFactor(0),this.services.eventBridge.publishToChannel(l.requestViewModeChange,0)},i.prototype.navigateBack=function(){this.services.$window.history.back()},i.prototype.exportToPowerPoint=function(){this.services.eventBridge.publishBubbling(this.scope,l.exportToPowerPoint)},i.prototype.viewMenuActionSelected=function(e){if(null!=e.action)if(e.action===r.ShowGrid){var t=e.checked=!this.services.settingsService.getShowGridlines(),i=this.services.telemetryService.startEvent(c,r[e.action],t);this.services.settingsService.setShowGridlines(t,i)}else if(e.action===r.ShowSmartGuides){var t=e.checked=!this.services.settingsService.getShowSmartGuides(),o=this.services.telemetryService.startEvent(c,r[e.action],t);this.services.settingsService.setShowSmartGuides(t,o)}else if(e.action===r.SnapToGrid){var t=e.checked=!this.services.settingsService.getSnapToGrid(),s=this.services.telemetryService.startEvent(c,r[e.action],t);this.services.settingsService.setSnapToGrid(t,s)}else if(e.action===r.ShowBookmarks)this.viewModel.bookmarksPane.isPaneVisible=e.checked=!this.viewModel.bookmarksPane.isPaneVisible,this.services.telemetryService.logEvent(c,r[e.action],e.checked);else if(e.action===r.ShowCanvasItems)this.viewModel.canvasItemsPane.isPaneVisible=e.checked=!this.viewModel.canvasItemsPane.isPaneVisible,this.services.telemetryService.logEvent(c,r[e.action],e.checked);else if(e.action===r.LockObjects){var t=e.checked=!this.services.settingsService.getLockObjects();this.services.telemetryService.logEvent(c,r[e.action],t),this.services.settingsService.setLockObjects(t)}else if(e.action===r.ShowSyncGroupPane)this.viewModel.syncGroupPane.isPaneVisible=e.checked=!this.viewModel.syncGroupPane.isPaneVisible,this.services.telemetryService.logEvent(c,r[e.action],e.checked);else if(e.action===r.HighContrast1||e.action===r.HighContrast2||e.action===r.HighContrastBlack||e.action===r.HighContrastWhite||e.action===r.HighContrastNone){var n=void 0;switch(e.action){case r.HighContrast1:n="HighContrast1";break;case r.HighContrast2:n="HighContrast2";break;case r.HighContrastBlack:n="HighContrastBlack";break;case r.HighContrastWhite:n="HighContrastWhite";break;case r.HighContrastNone:default:n="None"}this.services.eventBridge.publishToChannel(l.highContrastModeChanged,n),this.services.telemetryService.logEvent(c,r[e.action],void 0)}else{var a=void 0;switch(e.action){case r.Dynamic:a=0;break;case r.ActualSize:a=3;break;case r.FitToWidth:a=2;break;case r.FitToPage:a=1}this.services.eventBridge.publishToChannel(l.canvasDisplayChanged,a),this.services.telemetryService.logEvent(c,r[e.action],void 0)}},i.prototype.visualInteractionsMenuActionSelected=function(e){null!=e.action&&(e.action===r.EditVisualInteractionsMode?(this.toggleEditVisualInteractionsMode(),e.checked=this.viewModeState.getConfig().showRelationships,this.services.telemetryService.logEvent(c,r[e.action],e.checked)):e.action===r.DrillFilterOtherVisuals&&(this.toggleSelectedVisualDrillFilterOtherVisuals(),e.checked=this.getDrillFilterOtherVisualsSetting(),this.services.telemetryService.logEvent(c,r[e.action],e.checked)))},i.prototype.getDrillFilterOtherVisualsSetting=function(){var e=d.getSelectedVisual(this.services.selection);return e&&e.drillFilterOtherVisuals},i.prototype.editReportMenuActionSelected=function(e){if(this.services.overlayService.hideAllDropdowns(),!e.disabled)switch(e.action){case r.EditInWebApp:this.edit();break;case r.EditInDesktop:var t=this.services.activeFolderId.activeFolderObjectId,i=this.viewModel&&this.viewModel.exploration&&this.viewModel.exploration.contract&&this.viewModel.exploration.contract.report&&this.viewModel.exploration.contract.report.objectId;t&&i&&this.services.powerBIDesktopLauncher(i,t)}},i.prototype.isEditInDesktopEnabled=function(){return this.services.featureSwitchService.featureSwitches.editInDesktopEnabled},i.prototype.shapeMenuActionSelected=function(e){this.services.eventBridge.publishToChannel(l.createBasicShape,{shapeType:e.param})},i.prototype.actionButtonMenuActionSelected=function(e){this.services.eventBridge.publishToChannel(l.createActionButton,{shapeType:e.param})},i.prototype.togglePlayPause=function(){this.services.eventBridge.publishBubbling(this.scope,l.pauseQueriesChanged)},i.prototype.showRelatedContentPane=function(){var e=this.viewModel.exploration,t=e&&e.contract&&e.contract.report;t&&this.services.taskPaneSliderService.expandPane(17,a.Default,t.id)},i.prototype.showSendInstantEmailPane=function(){this.extensions.email.showSendInstantEmailPane()},i.prototype.showSubscriptionPane=function(){this.extensions.email.showSubscriptionPane()},i.prototype.isReportFavoritesEnabled=function(){return this.services.featureSwitchService.featureSwitches.reportFavoritesUI&&1!==this.viewModeState.getMode()&&!this.isUsageMetricsReport()&&this.isNonExternalUser()&&this.isReportLoaded()},i.prototype.isEmailSubscriptionEnabled=function(){return this.extensions.email&&this.extensions.email.isEmailSubscriptionEnabled(this.isUsageMetricsReport(),this.isNonExternalUser(),this.isReportLoaded())},i.prototype.canShareReport=function(){if(!this.isReportLoaded()||0!==this.viewModeState.getMode()||!this.isReportSharingEnabled()||!this.isNonExternalUser()||this.isUsageMetricsReport()||!this.services.reportService||!this.services.reportService.findReport)return!1;if(!this.extensions.showShareSlider)return!1;var e=this.services.reportService.findReport(this.viewModel.exploration.contract.report.id),t=e&&e.getPermissions();return 4===(4&t)||2===(2&t)},i.prototype.isReportSharingEnabled=function(){return this.services.featureSwitchService.featureSwitches.reportSharingUI},i.prototype.showShareSlider=function(){return __awaiter(this,void 0,e.Promise,(function(){return __generator(this,(function(e){switch(e.label){case 0:return[4,this.extensions.showShareSlider()];case 1:return e.sent(),[2]}}))}))},i.prototype.isViewRelatedContentEnabled=function(){var e=this.services.explorationCapabilities.getCapabilities(),t=!e.disableViewRelatedContent;return 1!==this.viewModeState.getMode()&&t&&!this.isUsageMetricsReport()&&this.isReportLoaded()},i.prototype.canOpenEditReport=function(){return this.showSwitchMode()&&0===this.viewModeState.getMode()&&this.viewModel.canEdit&&!this.isEditInDesktopEnabled()&&!this.isUsageMetricsReport()},i.prototype.showEditReportDisabled=function(){return 0===this.viewModeState.getMode()&&(this.viewModel.canEdit===!1||this.viewModel.canCopy)&&!this.isUsageMetricsReport()},i.prototype.showViewMenu=function(){return!(this.isPopOutMode||0!==this.getCanvasLayout())},i.prototype.showReadingViewButton=function(){return this.showSwitchMode()&&1===this.viewModeState.getMode()&&this.viewModel.canEdit},i.prototype.showEditDropdownMenu=function(){return 0===this.viewModeState.getMode()&&this.viewModel.canEdit&&this.isEditInDesktopEnabled()},i.prototype.showWebLayoutButton=function(){return 0!==this.getCanvasLayout()&&this.showReadingViewButton()},i.prototype.showPhoneLayoutButton=function(){return 0===this.getCanvasLayout()&&this.showReadingViewButton()},i.prototype.showAppBarRight=function(){return 0===this.services.formFactor.getCurrentLayout()},i.prototype.canOpenUsageMetricsReport=function(){var e=this.services,t=this.viewModel,i=this.viewModel.exploration;return e.featureSwitchService.featureSwitches.usageMetricsEnabled&&e.userInfo.isPremiumUser&&t.canEdit&&i&&i.contract&&_.isNumber(i.contract.id)&&!this.isUsageMetricsReport()&&0===this.viewModeState.getMode()&&this.canOpenUsageMetricsForFolder()},i.prototype.canOpenUsageMetricsForFolder=function(){return!!this.services.featureSwitchService.featureSwitches.workspacesV2UsageMetrics||!(this.viewModel&&this.viewModel.datasetModel&&this.viewModel.datasetModel.contract&&this.viewModel.datasetModel.contract.folderId)},i.prototype.openUsageMetricsReport=function(){var t=this.viewModel&&this.viewModel.exploration&&this.viewModel.exploration.contract&&this.viewModel.exploration.contract.report;this.services.rootScope.$emit(e.common.constants.openUsageMetricsReport,t,this.services.activeFolderId.activeFolderObjectId)},i.prototype.getReportModel=function(){var e=this.viewModel.exploration,t=e&&e.contract&&e.contract.reportId;if(t)return this.services.reportService.findReport(t)},i.prototype.showPinReportPageDialog=function(){var t=this;if(!this.services.featureSwitchService.featureSwitches.pinReadable&&this.viewModel.canCopy)return void this.scope.$emit(e.common.constants.onReportPersonalizedEventName,this.viewModel.exploration.contract.reportId);if(1===this.viewModeState.getMode()&&this.services.checkUnsavedService.userHasUnsavedWork){var i=this.services.errorService.control(),o=this.services.localizationService.get("PinLiveReport_UnsavedTitle"),r=this.services.localizationService.get("PinLiveReport_UnsavedChangesMessage"),s=[new InJs.ModalDialogAction(this.services.localizationService.get("PinLiveReport_SaveAndPin"),function(e,o){t.save(3),i.hideDialog(),t.pinnedToReportPage=!0}),new InJs.ModalDialogAction(this.services.localizationService.get("PinLiveReport_GoBack"),function(e,t){i.hideDialog()})];i.showPrompt(o,r,s,!0)}else this.pinReportPage()},i.prototype.setFormFactor=function(e){this.services.formFactor.changeFormFactor(e,this.viewModel)},i.prototype.getCanvasLayout=function(){return this.services.formFactor.getCurrentLayout()},i.prototype.setPhonePortraitFormFactor=function(){this.setFormFactor(1)},i.prototype.setMasterFormFactor=function(){this.setFormFactor(0)},i.prototype.pinReportPage=function(){var e=this.services.explorationNavigation.getCurrentSection();if(e){var t={exploration:this.viewModel.exploration,section:e,reportId:this.viewModel.exploration.contract.reportId,modelId:this.viewModel.datasetModel.id,packageId:this.viewModel.datasetModel.packageId};this.extensions.pinReportPage(t)}},i.prototype.duplicateReportPage=function(){var e=this.services.explorationNavigation.getCurrentSection(),i=t.SectionUtils.findSectionIndexForSection(this.viewModel.exploration.contract,e);this.services.eventBridge.publishToChannel(l.duplicateSection,i)},i.prototype.showDatasetErrorDetails=function(){if(this.viewModel.datasetModel){var e=this.services.localizationService;this.services.errorService.error(e.get("InternalSystemErrorMessage"),"ExplorationAppBar_DatasetError",{title:e.get("InternalSystemErrorTitle")})}},i.prototype.toggleEditVisualInteractionsMode=function(){this.services.eventBridge.publishToChannel(l.visualRelationshipsModeChanged)},i.prototype.toggleSelectedVisualDrillFilterOtherVisuals=function(){this.services.visualAuthoring.toggleDrillFilterOtherVisualsSetting()},i.prototype.reportMoreOptionsMenuSelected=function(i){switch(i.action){case t.models.AppBarAction.AnalyzeInExcel:this.services.telemetryService.logEvent(v.DashboardAndReportsAnalyzeInExcel,"Report More Options Menu",this.viewModel.datasetModel.contentProviderId,this.viewModel.datasetModel.contract.modelFeatures,this.viewModel.datasetModel.dbName),this.services.analyzeInExcel.startAnalyzeInExcel(this.viewModel.datasetModel);var o=this.viewModel.exploration&&this.viewModel.exploration.contract&&this.viewModel.exploration.contract.reportId;this.services.auditing.auditEvent(o,e.common.contracts.AuditEntityType.Report,e.common.contracts.AuditActivityType.analyzeInExcel);break;case t.models.AppBarAction.GenerateQR:this.services.eventBridge.publishBubbling(this.scope,l.generateReportQR);break;case t.models.AppBarAction.ExportStaticReport:this.services.eventBridge.publishBubbling(this.scope,l.exportAsImage)}},i.prototype.exploreMenuActionSelected=function(e,t){if(!e.disabled)switch(e.action){case r.SeeData:this.toggleSeeDataMode();break;case r.ExpandVisual:this.drillDownLevel(3);break;case r.ExpandVisualGrouped:this.drillDownLevel(2);break;case r.DrillUp:this.drillUp();break;case r.DrillDown:this.setDrillMode(1,t);break;case r.Drillthrough:this.setDrillMode(3,t);break;case r.SeeRecords:this.setDrillMode(2,t)}},i.prototype.isUsageMetricsReport=function(){return this.viewModel.options&&this.viewModel.options.isUsageMetricsReport},i.prototype.getExploreMenuActions=function(){for(var e=this.getSelectedVisual(),t=this.services.explorationCapabilities.getCapabilities().disableExploreActions,i=this.services.visibility.get(),o=i&&this.services.visibility.isSeeDataMode(i.visibility),s=this.services.drill.isDrillModeEnabled(e,1),n=this.services.drill.isDrillModeEnabled(e,3),a=this.services.drill.isDrillModeEnabled(e,2),l={isSeeDataMode:o,isDrillDownMode:s,isDrillthroughMode:n,isDrillToDetailsMode:a},c=p.createExploreMenuActions(this.services.localizationService,l),u=0,d=c;u<d.length;u++){var h=d[u];switch(h.action){case r.SeeData:h.checked=o,h.disabled=t||!this.services.drill.canSeeData(e);break;case r.ExpandVisual:h.disabled=t||!this.services.drill.canDrillByDirection(e,4);break;case r.ExpandVisualGrouped:h.disabled=t||!this.services.drill.canDrillByDirection(e,2);break;case r.DrillDown:h.checked=s;var v=this.services.drill.canDrillByDirection(e,4),g=this.services.drill.canDrillByDirection(e,1);h.disabled=t||!v&&!g;break;case r.Drillthrough:h.checked=n,h.disabled=t||!this.services.drill.canDrillthrough(e);break;case r.DrillUp:h.disabled=t||!this.services.drill.canDrillByDirection(e,1);break;case r.SeeRecords:h.checked=a,h.disabled=t||!this.services.drill.canDrillToDetails(e)}}return c},i.prototype.toggleSeeDataMode=function(){var e=this.services.visibility.get()||this.getSelectedVisual();if(e){var t=e.visibility;2===t||8===t?this.services.visibility.clear():this.services.visibility.set(e,2)}},i.prototype.drillUp=function(){this.services.visualAuthoring.drillUp(null,this.getSelectedVisual())},i.prototype.drillDownLevel=function(e){this.services.visualAuthoring.drillDownLevel(null,this.getSelectedVisual(),e)},i.prototype.setDrillMode=function(e,t){var i=this.getSelectedVisual();if(i){var o=i.drillMode,s=o===e?0:e;this.services.drill.setDrillMode(i,s);for(var n=0,a=t;n<a.length;n++){var l=a[n];l.action===r.DrillDown?l.checked=this.services.drill.isDrillModeEnabled(i,1):l.action===r.Drillthrough?l.checked=this.services.drill.isDrillModeEnabled(i,3):l.action===r.SeeRecords&&(l.checked=this.services.drill.isDrillModeEnabled(i,2))}}},i.prototype.getFileMenuProperties=function(e){return{menuName:"fileMenu",displayOptions:{anchorElement:e,blurNeeded:!1,disableAnimation:!0,preferLeft:!1},menuActions:this.getFileMenuActions(),menuActionSelected:this.fileMenuActionSelected}},i.prototype.getViewMenuProperties=function(e){return{menuName:"viewMenu",menuItemClass:"view-menu",glyphSmall:!0,displayOptions:{anchorElement:e,blurNeeded:!1,disableAnimation:!0,preferLeft:!1},menuActions:this.getViewMenuActions(),menuActionSelected:this.viewMenuActionSelected}},i.prototype.getBookmarksMenuProperties=function(e){var t=244,i=e.offset(),o={x:i.left,y:i.top+e.outerHeight(!0)},r=i.left+t-this.services.$window.innerWidth;return r>0&&(o.x-=r),{menuName:"bookmarksMenu",menuItemClass:"bookmarks-menu",glyphSmall:!0,displayOptions:{blurNeeded:!1,disableAnimation:!0,position:o},menuActions:this.getBookmarksMenuActions(),menuActionSelected:this.viewMenuActionSelected}},i.prototype.getActionButtonMenuProperties=function(e){return{menuName:"actionButtonMenu",menuItemClass:"actionButton-menu",glyphSmall:!0,displayOptions:{anchorElement:e,blurNeeded:!1,disableAnimation:!0,preferLeft:!1},menuActions:this.actionButtonMenuActions,menuActionSelected:this.actionButtonMenuActionSelected}},i.prototype.getEditReportMenuProperties=function(e){return{menuName:"editReportMenu",displayOptions:{anchorElement:e,blurNeeded:!1,disableAnimation:!0,preferLeft:!1},menuActions:this.getEditReportMenuActions(),menuActionSelected:this.editReportMenuActionSelected}},i.prototype.getExploreMenuProperties=function(e){var t=this,i=this.getExploreMenuActions();return{menuName:"exploreMenu",menuItemClass:"explore",glyphSmall:!0,displayOptions:{anchorElement:e,blurNeeded:!1,disableAnimation:!0,preferLeft:!1},menuActions:i,menuActionSelected:function(e){return t.exploreMenuActionSelected(e,i)}}},i.prototype.getVisualInteractionsMenuProperties=function(e){return{menuName:"visualInteractionsMenu",menuItemClass:"visualInteractions-menu",glyphSmall:!0,displayOptions:{anchorElement:e,blurNeeded:!1,disableAnimation:!0,preferLeft:!1},menuActions:this.getVisualInteractionsMenuActions(),menuActionSelected:this.visualInteractionsMenuActionSelected}},i.prototype.getMoreOptionsMenuProperties=function(e){return{menuName:"reportMoreOptionsMenu",menuItemClass:"moreOptions",displayOptions:{anchorElement:e,blurNeeded:!1,preferLeft:!0},menuActions:this.getMoreOptionsMenuActions(),menuActionSelected:this.reportMoreOptionsMenuSelected}},i.prototype.isMenuDisabled=function(e){return _.every(e.menuActions,(function(e){return e.disabled||!e.action}))},i.prototype.showMenu=function(e,t){var i=this,o=this.services.dropdown,r=function(e,t){e(t),o.hideAll()},s=t.bind(this)($(e.currentTarget)),n={menuOverlayName:s.menuName,menuItemClass:s.menuItemClass,glyphSmall:s.glyphSmall,menuActionSelected:function(e){return r(s.menuActionSelected.bind(i),e)},getMenuActions:function(){return s.menuActions},getMode:function(){return i.viewModeState.getMode()}};o.showMenu(n,"appBarMenu.html",s.displayOptions,this.services.$element.inheritedData(g))},i.prototype.getSelectedVisual=function(){return d.getSelectedVisual(this.services.selection)},i.prototype.getDisplayOption=function(){return this.viewModel&&this.viewModel.exploration&&this.viewModel.exploration.exploreCanvas&&this.viewModel.exploration.exploreCanvas.contract&&this.viewModel.exploration.exploreCanvas.contract.size&&this.viewModel.exploration.exploreCanvas.contract.size.displayOption},i.prototype.getViewMenuActions=function(){for(var e=this.getDisplayOption(),t=this.services.explorationCapabilities.getCapabilities(),i=this.services.explorationNavigation.getCurrentExploration(),o=i.themeCollection.highContrastTheme,s=p.createViewMenuActions(this.services.localizationService,this.services.settingsService,this.services.featureSwitchService,1===this.viewModeState.getMode(),this.getDisplayOption(),o&&o.name,!t.disableBookmarksPane),n=0,a=s;n<a.length;n++){var l=a[n];l.action===r.Dynamic?l.checked=0===e:l.action===r.FitToPage?l.checked=1===e:l.action===r.FitToWidth?l.checked=2===e:l.action===r.ActualSize?l.checked=3===e:l.action===r.ShowGrid?l.checked=this.services.settingsService.getShowGridlines():l.action===r.ShowSmartGuides?l.checked=this.services.settingsService.getShowSmartGuides():l.action===r.SnapToGrid?l.checked=this.services.settingsService.getSnapToGrid():l.action===r.ShowBookmarks?l.checked=this.viewModel.bookmarksPane.isPaneVisible:l.action===r.ShowCanvasItems?l.checked=this.viewModel.canvasItemsPane.isPaneVisible:l.action===r.LockObjects?l.checked=this.services.settingsService.getLockObjects():l.action===r.ShowSyncGroupPane&&(l.checked=this.viewModel.syncGroupPane.isPaneVisible)}return s},i.prototype.getBookmarksMenuActions=function(){return p.createBookmarksMenuActions()},i.prototype.getEditReportMenuActions=function(){return p.createEditReportMenuActions(this.services.localizationService,this.viewModel&&this.viewModel.isReportFromPbix)},i.prototype.getVisualInteractionsMenuActions=function(){for(var e=p.createVisualInteractionsActions(this.services.localizationService,this.services.featureSwitchService),t=0,i=e;t<i.length;t++){var o=i[t];o.action===r.EditVisualInteractionsMode&&(o.checked=this.viewModeState.getConfig().showRelationships),o.action===r.DrillFilterOtherVisuals&&(o.checked=this.getDrillFilterOtherVisualsSetting(),o.disabled=!this.getSelectedVisual())}return e},i.prototype.downloadReport=function(){var e=this.viewModel&&this.viewModel.exploration&&this.viewModel.exploration.contract&&this.viewModel.exploration.contract.report;if(e){var t=e.objectId,i=e.displayName;if(t&&i){var o={id:t,filename:h.normalizeFileName(i)};this.services.downloadReport.downloadReport(o)}}},i.prototype.isNonExternalUser=function(){var e=window;return _.isEmpty(e.powerBIExternalTenantId)},i.prototype.isReportLoaded=function(){var e=this.viewModel.exploration;return null!=(e&&e.contract&&e.contract.report)},i.prototype.canPin=function(){if(!this.isReportLoaded())return!1;var e=this.viewModel.exploration.contract.reportId,t=this.services.reportService.findReport(e);return!(this.viewModel.canCopy&&!s.getResourceAppGUID(t,this.services.appService))&&(this.extensions.canPinReportPage&&this.extensions.canPinReportPage(t))},i.prototype.isUserStateDisabledByAuthor=function(e){return!!(e&&e.settings&&e.settings.isPersistentUserStateDisabled)},i.prototype.canCopyAppReport=function(){var e=this.viewModel.exploration,t=e&&e.contract&&e.contract.report&&e.contract.report.packageId,i=!!this.services.appService.getAppInstance(t),o=this.viewModel.datasetModel&&this.services.permissionService.isExplorableModel(this.viewModel.datasetModel,this.services.featureSwitchService.featureSwitches.explorePermissionOnDataset);return this.services.featureSwitchService.featureSwitches.allowExploreDatasetOfApp&&i&&o},i})();i.ExplorationAppBarController=m})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){i.ExplorationAppBar={bindings:{viewModel:"="},templateUrl:"components/explorationAppBar/explorationAppBar.html",controller:e.common.createController(t.controllers.ExplorationAppBarController)}})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){function i(e){return{errorCode:r(e),errorSource:o(e)}}function o(e){var i=e&&e.clientError,o=r(e);return _.includes(t.UserErrors,o)?"User":_.includes(t.ExternalErrors,o)?"External":i&&null!=i.source?i.source:"PowerBI"}function r(t){var i=t&&t.serviceError&&t.serviceError.errorCode,o=t&&t.clientError&&t.clientError.code;return i||o||e.ModelFailednoErrorInfo}t.UserErrors=[e.DM_GWPipeline_Gateway_CancellationError,e.DM_GWPipeline_Gateway_CancellationOrTimeoutError,e.DM_GWPipeline_Gateway_ImpersonationError,e.DM_GWPipeline_Gateway_InvalidConnectionCredentials,e.DM_GWPipeline_Gateway_TimeoutError,e.DMTS_DatasourceHasNoCredentialError,e.DMTS_NoGatewayWithAllDatasourcesToBindError,e.DMTS_MultipleGatewaysWithAllDatasourcesToBindError,e.DMTS_OAuthTokenRefreshFailedError,e.DMTS_UserNotFoundInADGraphError,e.DMTS_UserLostPermissionToDatasourceError,e.PowerBINotAuthorizedException,e.ModelSizeExceedsSharedCapacityLimit,e.TokenExpired,e.UserNotLicensed,e.RS_AccessDenied,e.RS_AccessDeniedDueToRLSGroup,e.RS_ErrorOpeningConnection,"HttpStatusCode = -1","HttpStatusCode = 401",(new e.IgnorableClientError).code],t.ExternalErrors=[e.DM_GWPipeline_Gateway_ConnectionBrokenException,e.DM_GWPipeline_Client_GatewayUnreachable,e.DM_GWPipeline_Gateway_DataSourceAccessError,e.DM_GWPipeline_Gateway_AdomdConnectError,e.DM_GWPipeline_Gateway_UnprocessedStructureError,e.DM_GWPipeline_Gateway_MashupDataAccessError],t.getTelemetryErrorDetails=i,t.getErrorSource=o,t.getErrorCode=r})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=2e3,i=(function(){function e(e,t){this.newQueryResultUpdates=[],this.explorationId=e,this.explorationProxy=t}return e.prototype.onNewQueryCacheResultAvailable=function(e){var i=this,o=_.find(this.newQueryResultUpdates,(function(t){return t.visualContainerId===e.visualContainerId}));return o?(o.query=e.query,void(o.dataTransforms=e.dataTransforms)):(this.newQueryResultUpdates.push(e),void(1===this.newQueryResultUpdates.length&&setTimeout((function(){var e={visualQueryResults:_.map(i.newQueryResultUpdates,(function(e){return{visualContainerId:e.visualContainerId,query:e.query,dataTransforms:e.dataTransforms}}))};i.explorationProxy.saveVisualContainerQueries(i.explorationId,e),i.newQueryResultUpdates=[]}),t)))},e})();e.VisualContainerQueryUpdater=i})(t=e.helpers||(e.helpers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){function i(e){for(var t=e.sections,i={},o=0,r=t;o<r.length;o++)for(var s=r[o],n=s.visualContainers,a=0,l=n;a<l.length;a++){var c=l[a],p=c.config.singleVisual.visualType;i[p]=!0}return i}var o=e.constants,r=e.visualHost.utils.ResourcePackageUtils,s=(function(){function t(e,t,i,o,r,s,n,a){this.eventBridge=e,this.promiseFactory=t,this.resourceGateService=i,this.resourcePackagesService=o,this.visualPlugin=r,this.telemetryService=s,this.embedModeService=n,this.rootScope=a}return t.prototype.reset=function(){this.initializationPromise=void 0,this.initializationFilteredResources=!1},t.prototype.setState=function(e){this.filterUnusedCustomVisualResources=e},t.prototype.ensureCustomVisualResources=function(e){return this.initializationPromise&&this.initializationFilteredResources===this.filterUnusedCustomVisualResources||(this.initializationFilteredResources=this.filterUnusedCustomVisualResources,this.initializationPromise=this.loadCustomVisualResources(e,this.filterUnusedCustomVisualResources)),this.initializationPromise},t.prototype.loadCustomVisualResources=function(t,s){return __awaiter(this,void 0,e.Promise,(function(){var n,a,l=this;return __generator(this,(function(c){switch(c.label){case 0:return n=t.resourcePackages,_.isEmpty(n)?[2,this.promiseFactory.resolve()]:(this.telemetryService.logEvent(e.telemetry.EXEnableCustomViz,this.embedModeService.getEmbedTypeDescription()),this.resourceGateService.setResourceFlag(),this.resourcePackagesService.registerPackages(n),s&&(a=i(t),n=_.filter(n,(function(e){return a[e.name]}))),[4,this.visualPlugin.ensurePlugins(n).finally((function(){l.eventBridge.publishToChannel(e.explore.services.events.visualPluginsChanged);var t=r.getCustomVisualTypes(n);_.isEmpty(t)||l.rootScope.$emit(o.reloadEmptyVisuals,{visualTypes:t})}))]);case 1:return c.sent(),[2]}}))}))},t})();t.CustomVisualLoader=s,t.getVisualTypeUsageTable=i})(i=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var o=e.explore.contracts.Bookmark,r=e.common.constants,s=e.common.events,n=e.constants,a=jsCommon.CssConstants.createClassAndSelector,l=e.common.contracts.DataCacheModeType,c=e.explore.contracts.DataSource,p=t.constants.DefaultBaseThemeName,u=t.constants.DefaultDrillFilterOtherVisuals,d=e.common.constants.dsrDataReaderType,h=e.data.DataViewObjectDefinitions,v=e.errorDetailsHelper,g=e.explore.services.events,m=e.explore.constants.explorationLoadedEventName,y=t.util.ExplorationTrustedVisualUtil,b=e.common.dialog.MessageDialogBuilder,f=e.common.constants.onReportChangedEventName,S=e.contracts.ResourcePackageItemType,w=e.explore.ScopeUtils,x=e.explore.util.ScriptVisualsUtil,M=e.explore.SectionUtils,D=e.visualHost.ThemeUtils,E=e.explore.services.undoRedoStrategy.UndoRedoStack,C=e.explore.viewModels.ViewModelFactory,P=e.explore.viewModels,A=t.util.VisualContainerUtils,R=t.contracts.VisualLink,T=a("explorationHost"),I=a("horizontalItemsContainer"),k=(function(){function i(i,o){var n=this;this.services=o,this.extensions={},this.scope=i,this.scope.$on(e.explore.constants.exploreCanvasVisualRendered,(function(){n.resolveOpenExplorationTelemetryEvent()})),this.scope.viewModeState=this.services.viewModeState,this.scope.exploreUIShellConfig=t.modules.ExploreUIShellModule,this.scope.jQueryUIConfig=e.common.modules.JQueryUIModule,w.defineDataSourcesOnScopeLegacy(this.scope,this.services.dataSources);var a=P.createFieldListViewModelFactory(P.createFieldListMenuItemFactory(this.services.localizationService,this.services.featureSwitchService),P.createFieldListPropertyTemplateGenerator(),this.services.localizationService,this.services.featureSwitchService);this.scope.fieldListConfig={viewModelFactory:a,alwaysHasActiveItem:!0,isVisualizationPaneVisible:function(){return n.scope.viewModel.visualizationPane.isPaneExpanded}},this.initialize(this.scope.viewModel),this.unregisterViewModelWatch=this.scope.$watch("viewModel",(function(e){n.initialize(e)}));var l=this.services.rootScope.$on(s.loadPowerViewReportEventName,(function(e,t){e.stopPropagation(),n.onLoadPowerViewReport(t)})),c=this.services.rootScope.$on(s.refreshReportData,(function(e){e.stopPropagation(),n.onRefreshReportData()})),p=this.services.eventBridge.setBubblingScope(i).subscribe(g.refreshExploration,(function(e){return n.refresh(e)})).subscribe(g.deleteVisual,(function(e,t){return n.deleteVisual(e,t)})).subscribe(g.pauseQueriesChanged,(function(e){return n.pauseQueriesChanged(e)})).subscribe(g.reportVisualError,(function(e,t){return n.showErrorNotification(e,t)})),u=this.services.eventBridge.createChannelSubscriptionManager().subscribe(g.sectionChanged,(function(e,t){
return n.onSectionChange(t)})).subscribe(g.requestViewModeChange,(function(e,t){return n.onRequestViewModeChange(t)})).subscribe(g.saveKeyPressedEvent,(function(e){return n.saveOnKeypress(e)})).subscribe(g.deleteSectionInitiated,(function(e,t){return n.onDeleteSection(t)})).subscribe(g.addVisualContainer,(function(e,t){return n.onAddVisualContainer(e,t)})).subscribe(g.addInsightContainer,(function(e,t){return n.onAddInsightContainer(e,t)})).subscribe(g.addQnaContainer,(function(e,t){return n.onAddQnaContainer(e,t)})).subscribe(g.showQnaPopout,(function(e,t){return n.onShowQnaPopout(e,t)})).subscribe(g.importVisual,(function(e){return n.importVisual(e)})).subscribe(g.visualRelationshipsModeChanged,(function(e){n.services.viewModeState.updateConfig((function(e){e.showRelationships=!e.showRelationships}))})).subscribe(g.visibilityChanged,(function(){var e=!!n.services.visibility.get();!!n.isPopOutMode===e||n.isActiveSectionTransient?n.isPopOutMode=e:(n.isPopOutMode=e,n.updateNavigationPaneVisibility())})).subscribe(g.createBasicShape,(function(e,t){return n.onCreateBasicShape(e,t)})).subscribe(g.createActionButton,(function(e,t){return n.onCreateActionButton(e,t)})).subscribe(g.createTextbox,(function(e){return n.onCreateTextbox(e)})).subscribe(g.refreshExploration,(function(e){return n.refresh(e)})).subscribe(g.newQueryCacheResultAvailable,(function(e,t){return n.onNewQueryCacheResultAvailable(e,t)})).subscribe(g.filterContainerChanged,(function(e,t){return n.filterContainerChanged(t)})).subscribe(g.visualDrillFilterOtherVisualsSettingChanged,(function(e,t){return n.onVisualDrillFilterOtherVisualsSettingChanged(t)})).subscribe(g.visualPluginsChanged,(function(e,t){return n.updateCapabilitiesFromSettings(n.services.explorationNavigation.getCurrentExploration())})).subscribe(g.highContrastModeChanged,(function(e,t){return n.setHighContrastMode(t)})).subscribe(g.explorationObjectsChanged,(function(e,t){return n.evaluateExplorationObjects()})).subscribe(g.explorationLoaded,(function(e,t){return n.evaluateExplorationObjects()})).subscribe(g.formFactorChanged,(function(e,t){return n.updateCapabilitiesFromSettings(n.exploration)})),d=this.services.rootScope.$on(g.reportVisualError.name,(function(e,t,i,o){n.showErrorNotificationWithModel(i,t,o)}));this.scope.featureSwitchService=this.services.featureSwitchService,this.scope.isFooterVisible=function(){return n.isFooterVisible()},this.scope.isVisualizationPaneVisible=function(){return n.isVisualizationPaneVisible()},this.scope.isMobileVisualizationPaneVisible=function(){return n.isMobileVisualizationPaneVisible()},this.scope.isTaskPaneVisible=function(){return n.isTaskPaneVisible()},this.scope.isBookmarksPaneVisible=function(){return n.isBookmarksPaneVisible()},this.scope.isSyncGroupPaneVisible=function(){return n.isSyncGroupPaneVisible()},this.scope.isCanvasItemsPaneVisible=function(){return n.isCanvasItemsPaneVisible()},this.scope.isAnnotationsPaneVisible=function(){return n.isAnnotationsPaneVisible()};var h=this.scope.$on(r.navigation.stateChangeSuccess,(function(e,t,i,o,r){return n.handleStateChange(e,t,i,o,r)}));this.scope.$on("$destroy",(function(){n.removeKeyHandler(),n.removeHighContrastStyle(),l(),h(),d(),n.unregisterViewModelWatch&&n.unregisterViewModelWatch(),c(),p.unsubscribeAll(),u.unsubscribeAll(),n.services.explorationContainerMixins.destroy()})),this.scope.inAppArtifactView=function(){return n.services.featureSwitchService.featureSwitches.appsEnabled&&n.extensions.navigation&&n.extensions.navigation.inAppArtifactView()};var v=this;this.services.explorationContainerMixins.update(new(function(){function e(){}return Object.defineProperty(e.prototype,"reportId",{get:function(){return v.reportId},set:function(e){v.reportId=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"packageId",{get:function(){return v.model&&v.model.packageId},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"model",{get:function(){return v.model},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewModel",{get:function(){return v.scope.viewModel},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"extensions",{get:function(){return v.extensions},enumerable:!0,configurable:!0}),e}()))}return i.createOptions=function(){return{additionalServices:["$element","checkUnsavedService","conceptualSchemaProxy","cssGenerationService","dataProxy","datasetSizeService","displayNameService","errorService","explorationProxy","explorationSerializer","featureSwitchService","gatewaysMetadataService","localizationService","modalDialogService","modelHttpService","moduleLoader","notificationBar","overlayService","packageService","pbiLazyLoad","permissionService","promiseFactory","reportService","resourceGateService","selectGatewayService","telemetryService","themeService","userInfo","visualStylePresetService","trustedVisual","subscription","activeFolderId","viewRelatedContentService","lazy","lazySync"],scopedServiceRoot:!0,scopedDependencies:["canvasKeyHandler","clipboard","colorPicker","customVisualLoader","dataSources","deleteVisual","eventBridge","explorationCapabilities","explorationContainerMixins","explorationNavigation","filterGenerator","formFactor","importVisual","lazyScopedSync","modelChangeHandler","visibility","staticResourceReferences","resourceLoader","resourceRegistration","scriptVisuals","selection","sort","undoRedo","viewModeState","visualAuthoring","visualPlugin","visualQueryGenerator","lazyScoped"]}},i.prototype.$onInit=function(){this.scope.annotationsModulePath=this.extensions.annotations&&this.extensions.annotations.getModulePath()},i.prototype.isMobileVisualizationPaneVisible=function(){return this.services.viewModeState.getConfig().displayOptions.showMobilePane},i.prototype.isTaskPaneVisible=function(){var e=this.services.viewModeState.getMode();return(1===e||2===e)&&0===this.services.formFactor.getCurrentLayout()},i.prototype.isFooterVisible=function(){var e=this.scope.viewModel;return!!e&&((e.options.showNavContentPane||null!=this.services.viewModeState.getViewState().bookmarkView)&&!this.services.viewModeState.getConfig().displayOptions.hideNavigationPane)},i.prototype.isVisualizationPaneVisible=function(){var e=this.scope.viewModel;if(!e)return!1;var t=!this.exploration;this.exploration&&this.exploration.settings&&this.exploration.settings.useNewFilterPaneExperience&&(t=0===this.services.viewModeState.getMode());return!t&&e.options.showVisualizationPane&&!this.services.viewModeState.getConfig().displayOptions.hideVisualizationPane&&!this.isMobileVisualizationPaneVisible()},i.prototype.isBookmarksPaneVisible=function(){var e=this.scope.viewModel;return!!e&&(e.bookmarksPane.isPaneVisible&&this.isInMasterLayout())},i.prototype.isSyncGroupPaneVisible=function(){var e=this.scope.viewModel;return!!e&&(e.syncGroupPane.isPaneVisible&&this.isInMasterLayout())},i.prototype.isCanvasItemsPaneVisible=function(){var e=this.scope.viewModel;return!!e&&(e.canvasItemsPane.isPaneVisible&&this.isInMasterLayout())},i.prototype.isAnnotationsPaneVisible=function(){var e=this.extensions.annotations;return e&&e.isEnabled()},i.prototype.isInMasterLayout=function(){return 0===this.services.formFactor.getCurrentLayout()},i.prototype.setViewModelExploration=function(e,t,i){var o=null!==i&&void 0!==i?i:this.services.formFactor.getCurrentLayout();this.scope.viewModel.exploration=C.convertExploration(e,o,t),this.exploration=e},i.prototype.onDeleteSection=function(t){var i=this;if(t.supportMinervaDialog){var o=t.sectionIndex,r=this.services.rootScope.$new(),s=this.scope.viewModel,n=this.services.errorService.control(),a=[new InJs.ModalDialogAction(this.services.localizationService.get("ExplorationNavigationTab_Delete"),function(t,r){n.hideDialog();var s={targetSectionIndex:o,addToUndoRedoStack:!0};i.services.rootScope.$emit(e.explore.constants.deleteSectionEvent,s)}),new InJs.ModalDialogAction(this.services.localizationService.get("PBI_Button_Label_Cancel"),function(e,t){n.hideDialog()})];r.message=this.services.localizationService.get("ExplorationNavigationTab_DeleteWarningMessage");var l={dialogName:this.services.localizationService.get("ExplorationNavigationTab_DeleteWarningTitle"),isDismissable:!0,scope:r,template:"<custom-modal-dialog></custom-modal-dialog>",dialogCssClass:"customModalDialog",dialogActions:a},c=s&&s.exploration&&s.exploration.sections&&s.exploration.sections[o]&&s.exploration.sections[o].contract?s.exploration.sections[o].contract.id:void 0;this.extensions.customizeDeleteSectionOptions&&this.extensions.customizeDeleteSectionOptions(l,c),this.services.modalDialogService.showLegacyWebModalDialog(l)}},i.prototype.onNewQueryCacheResultAvailable=function(e,i){var o=this.scope.viewModel.exploration,r=this.services.explorationCapabilities.getCapabilities();o&&!r.disableCacheUpdates&&(this.visualContainerQueryUpdater||(this.visualContainerQueryUpdater=new t.helpers.VisualContainerQueryUpdater(o.contract.id,this.services.explorationProxy)),this.visualContainerQueryUpdater.onNewQueryCacheResultAvailable(i)),e.stopPropagation&&e.stopPropagation()},i.prototype.filterContainerChanged=function(e){var i=this.services.explorationNavigation.getCurrentSection();if(1===e.changeType&&1!==i.type&&5===e.filter.howCreated&&this.scope.viewModel&&this.scope.viewModel.exploration){_.some(i.visualContainers,(function(e){var i,o=e.config.singleVisual,r=h.getObjectDefinition(o.vcObjects,"visualLink",void 0),s=r&&r.properties;return s&&(i={show:s.show&&s.show.value,qna:s.qna,bookmark:s.bookmark&&s.bookmark.value,type:s.type&&s.type.value}),i&&i.show&&R.getType(i)===t.contracts.VisualLink.Back}))||this.services.visualAuthoring.addVisualContainerDrillthroughBackButton(this.scope.viewModel.exploration.exploreCanvas)}},i.prototype.onVisualDrillFilterOtherVisualsSettingChanged=function(e){if(e.visualContainer){var t=this.services.explorationNavigation.getCurrentSection();this.services.filterGenerator.updateCrossFilterOnDrill(t,e.visualContainer)}},i.prototype.initialize=function(e){if(this.scope.explorationContainerOptions&&this.services.explorationCapabilities.setCapabilities(this.scope.explorationContainerOptions),e){e.showSpinner=!0,e.options||(e.options=this.services.explorationCapabilities.getCapabilities());var t=e.options;this.explorationNotificationIds=[];var i=this.services.featureSwitchService;this.services.viewModeState.updateConfig((function(e){e.supportsPinning=!t.visualContainerOptions.disablePin,e.supportsDeletion=!0,e.supportsExportData=!t.disableExport&&i.featureSwitches.exportDataEnabled})),e.shouldHideFilterPane&&(t.showVisualizationPane=!1),t.showAppBar=!e.shouldHideAppBar&&t.showAppBar,this.isPopOutMode&&this.services.visibility.clear(),this.updateNavigationPaneVisibility(),this.exploration&&this.removeHighContrastStyle(),e.shouldHideTileMenu&&(t.visualContainerOptions.hideHeader=!0),t.overrideSectionSize=e.overrideSectionSize||t.overrideSectionSize,t.disableViewRelatedContent=this.services.viewRelatedContentService.disableViewRelated}},i.prototype.notifyIfModelRefreshDisabledBySelectiveRefresh=function(){var i=this.services,o=this.scope.viewModel.datasetModel;if(o&&o.isRefreshDisabledDueToInactivity()){var r={notificationName:"inactiveModelRefreshDisabled",notificationId:i.notificationBar.notify({message:i.localizationService.get("Notification_InactiveModelRefreshDisabled"),notificationType:e.common.NotificationBarType.Warning,secondaryLink:{displayText:i.localizationService.get("LearnMore"),urlString:t.constants.configureScheduledRefreshLink}})};this.addNotification(r)}},i.prototype.deleteVisual=function(e,t){var i=this.services.rootScope.$new(),o=this.scope.viewModel.exploration.contract;i.deleteVisualService=this.services.deleteVisual,i.errorService=this.services.errorService,i.explorationContract=o,i.customVisuals=[t.visual],i.deleteVisualButtonText=this.services.localizationService.get("DeleteVisual_Delete");var r=A.getVisualContainerCount(this.exploration,t.visual);r>0?i.deleteVisualWarningText=this.services.localizationService.format("DeleteVisual_CustomVisualUsedMessage",[r]):i.deleteVisualWarningText=this.services.localizationService.format("DeleteVisual_CustomVisualNotUsedMessage",[r]);var s={dialogName:this.services.localizationService.get("DeleteVisual_DialogHeader"),isDismissable:!0,scope:i,template:"<delete-visual-warning-dialog></delete-visual-warning-dialog>",dialogCssClass:"deleteVisualWarning"};this.services.modalDialogService.showLegacyWebModalDialog(s),e.stopPropagation()},i.prototype.importVisual=function(e){var t=this,i=new b(this.services.modalDialogService),o=this.services.localizationService;i.show("ImportVisualWarning",{titleText:o.get("ImportVisual_CautionDialogHeader"),messageText:o.get("ImportVisual_CautionDialogMessage"),okButtonText:o.get("ImportVisual_Import"),cancelButtonText:o.get("ImportVisual_Cancel")}).then((function(e){0===e&&t.services.importVisual.importWithDialog(t.scope.viewModel.exploration.contract)}))},i.prototype.onCreateTextbox=function(e){this.onAddVisualContainer(e,{visualType:"textbox",telemetrySource:4})},i.prototype.onCreateBasicShape=function(e,t){this.services.visualAuthoring.addVisualContainerShapeVisual(this.scope.viewModel.exploration.exploreCanvas,t.shapeType,0)},i.prototype.onCreateActionButton=function(e,t){this.services.visualAuthoring.addVisualContainerShapeVisual(this.scope.viewModel.exploration.exploreCanvas,t.shapeType,1)},i.prototype.onAddVisualContainer=function(t,i){e.explore.util.CanvasVisualsUtility.addVisualContainerToCanvas(i,this.scope.viewModel.exploration.exploreCanvas,this.services.dataSources.get(),this.services.visualAuthoring,this.services.telemetryService),t.stopPropagation&&t.stopPropagation(),i.actionAfterAddition&&i.actionAfterAddition()},i.prototype.onAddInsightContainer=function(e,t){e.stopPropagation&&e.stopPropagation(),this.services.visualAuthoring.addVisualContainerFromConfig(t.visualContainer.config,t.visualContainer.filters,this.scope.viewModel.exploration.exploreCanvas)},i.prototype.onAddQnaContainer=function(t,i){return __awaiter(this,void 0,e.Promise,(function(){var t;return __generator(this,(function(o){switch(o.label){case 0:return[4,this.services.pbiLazyLoad.load(e.infonav.modules.QnaCoreModule)];case 1:return o.sent(),[4,this.services.lazyScoped("qnaLaunch")];case 2:return t=o.sent(),[4,t.tryAddQnaContainerToCanvas(this.scope,this.scope.viewModel.exploration.exploreCanvas,i,this.services,{DatabaseName:this.scope.viewModel.datasetModel.dbName,VirtualServerName:this.scope.viewModel.datasetModel.vsName})];case 3:return o.sent(),[2]}}))}))},i.prototype.onShowQnaPopout=function(t,i){return __awaiter(this,void 0,e.Promise,(function(){var t,o,r,s,n,a;return __generator(this,(function(l){switch(l.label){case 0:return[4,this.services.pbiLazyLoad.load(e.infonav.modules.QnaCoreModule)];case 1:return l.sent(),[4,this.services.pbiLazyLoad.load(e.infonav.modules.QnaWebModule)];case 2:return l.sent(),[4,this.services.lazyScoped("qnaLaunch")];case 3:return t=l.sent(),o=this.scope.viewModel.datasetModel,[4,t.supportsQna(this.services,{DatabaseName:o.dbName,VirtualServerName:o.vsName},!0)];case 4:return r=l.sent(),r?[4,this.services.lazyScoped("qnaPopoutBuilder")]:[3,6];case 5:return s=l.sent(),n=this.services.$element.find(T.selector),a=n.find(I.selector),s.show({parentScope:this.scope,anchorElement:a,container:n,visualLink:i.visualLink,sourceFilters:i.sourceFilters}),[3,7];case 6:this.services.errorService.infoCustom(this.services.localizationService.get("Qna_NotSupported_Title"),this.services.localizationService.get("Qna_NotSupported_MessageService")),l.label=7;case 7:return[2]}}))}))},i.prototype.removeKeyHandler=function(){this.currentKeyHandler&&($(window).off("keydown",this.currentKeyHandler),this.currentKeyHandler=void 0)},i.prototype.addKeyHandler=function(){var e=this;this.currentKeyHandler||(this.currentKeyHandler=function(t){if(e.scope.viewModel&&e.scope.viewModel.exploration&&!$(t.target).is(jsCommon.DOMConstants.EditableTextElements)&&!$(t.target).is(jsCommon.DOMConstants.EditableNumericElements))return e.services.canvasKeyHandler.onKeyDown(t,e.scope.viewModel.exploration.exploreCanvas)},$(window).on("keydown",this.currentKeyHandler))},i.prototype.handleStateChange=function(e,t,i,o,r){this.scope.viewModel.showSpinner=!0,this.hideAllExplorationWarnings(),this.extensions.navigation&&(this.extensions.navigation.inReportView()||this.extensions.navigation.inDatasetView())||(this.removeKeyHandler(),this.clearExploration()),this.services.overlayService.hideAllDropdowns()},i.prototype.onSectionChange=function(e){var t,i=this.scope.viewModel,o=i.exploration.contract,r=this.services.featureSwitchService.featureSwitches;r&&r.trackUserInfo&&!r.usageMetricsTrackUserLevelInfoEnabled&&(t=!0);var s={exploration:o,section:e.name,reportGUID:this.extensions&&this.extensions.navigation&&this.extensions.navigation.currentReportGUID()||this.exploration&&this.exploration.report&&this.exploration.report.objectId,reportPermissions:i.reportPermission,groupObjectId:this.services.activeFolderId.activeFolderObjectId,isReadonlyGroup:this.services.permissionService.isActiveWorkspaceIsReadOnly,scrubUserInfo:t};this.services.explorationNavigation.updateExplorationActiveSectionIndex(s);var n=this.services.explorationNavigation.getCurrentSection(),a=n&&n.transient;!!this.isActiveSectionTransient==!!a||this.isPopOutMode?this.isActiveSectionTransient=a:(this.isActiveSectionTransient=a,this.updateNavigationPaneVisibility()),n&&this.services.filterGenerator.updateCrossDrillOfSectionOperation(n)},i.prototype.logRTelemetry=function(e,t){this.scope.viewModel.options.disableLogRTelemetry||this.services.telemetryService.logEvent(e,t.totalVisualsCount,t.scriptVisualsUniqueIds.length,JSON.stringify(t.scriptVisualsUniqueIds),this.services.userInfo.userLicense())},i.prototype.onRequestViewModeChange=function(e){var t=this,i=1===e;if(!i||this.scope.viewModel.canEdit){var o=this.scope.viewModel.exploration.contract,r=function(){t.changeToEditMode(o,i)};if(this.extensions.saveExploration){var s=this.services.promiseFactory.defer();s.promise.then(r),this.extensions.saveExploration.handleUnsavedIfAny(s)}else r()}},i.prototype.changeToEditMode=function(t,o){var s=this.scope.viewModel,n=o?1:0,a=this.services.viewModeState,l=a.getMode();a.setMode(n),o&&(s.taskPane.isPaneExpanded=!0,s.visualizationPane.isPaneExpanded=!0,this.services.featureSwitchService.featureSwitches.pivotTableVisualEnabled&&i.hasLegacyTableOrMatrix(t)&&this.extensions.tutorial&&this.extensions.tutorial.showConvertTableTutorial()),this.services.customVisualLoader.setState(o),this.services.customVisualLoader.ensureCustomVisualResources(t);var c=x.getVisualStasInExploration(this.exploration,this.services.scriptVisuals);o||this.logRTelemetry(e.telemetry.EXLoadReportWithScriptVis,c),this.services.rootScope.$emit(e.common.constants.navigation.stateChangeStart,{},{viewMode:n},{name:r.navigation.states.reportPage},{viewMode:l}),s.isNavPaneCollapsed=!o,this.updateCapabilitiesFromSettings(this.exploration),this.services.eventBridge.publishToChannel(g.changeViewMode,n)},i.prototype.hideAllExplorationWarnings=function(){for(var e=this.explorationNotificationIds;e.length>0;)this.services.notificationBar.hide(e.pop().notificationId);this.explorationNotificationIds=[]},i.prototype.hideExplorationWarning=function(e){for(var t=this.explorationNotificationIds,i=0,o=t;i<o.length;i++){var r=o[i];if(e&&r.notificationName===e){this.services.notificationBar.hide(r.notificationId),t.splice(t.indexOf(r),1);break}}this.explorationNotificationIds=t},i.prototype.isNotificationShown=function(e){for(var t=this.explorationNotificationIds,i=0,o=t;i<o.length;i++){var r=o[i];if(e&&r.notificationName===e)return r.notificationId}},i.prototype.addNotification=function(e){e&&(this.isNotificationShown(e.notificationName)&&this.hideExplorationWarning(e.notificationName),this.explorationNotificationIds.push(e))},i.prototype.updateNavigationPaneVisibility=function(e){if(void 0===e&&(e=!0),e)if(this.isPopOutMode||this.isActiveSectionTransient)this.oldNavPaneOptions=_.cloneDeep(this.scope.viewModel.options);else if(this.oldNavPaneOptions){var t=this.services.explorationCapabilities.getCapabilities();t.showNavContentPane=this.oldNavPaneOptions.showNavContentPane,this.oldNavPaneOptions=null}var i=!this.isPopOutMode&&!this.isActiveSectionTransient&&this.services.explorationCapabilities.getCapabilities().showNavContentPane;this.scope.viewModel.options.showNavContentPane=!this.scope.viewModel.shouldHideSlideBar&&i},i.hasLegacyTableOrMatrix=function(e){var t=e.sections;if(_.isEmpty(t))return!1;for(var i=0,o=t;i<o.length;i++){var r=o[i],s=r.visualContainers;if(!_.isEmpty(s))for(var n=0,a=s;n<a.length;n++){var l=a[n],c=l.config.singleVisual.visualType;if("table"===c||"matrix"===c)return!0}}return!1},i.prototype.saveOnKeypress=function(e){if(this.scope.viewModel.canEdit&&this.extensions.saveExploration){var t=this.scope.viewModel.options,i={overrideSaveRouting:t.overrideSaveRouting,source:2};0!==this.scope.viewModeState.getMode()||t.disableSaveOnKeyPress?this.extensions.saveExploration.save(e,i):this.extensions.saveExploration.saveAs(e,i)}},i.prototype.refresh=function(t){var i={changes:[],hasQueryImpact:!0};this.services.modelChangeHandler.applyChange({change:this.services.promiseFactory.resolve(i),leaveUndo:!0,cacheResponseOnServer:!this.services.checkUnsavedService.userHasUnsavedWork}),this.hideExplorationWarning("lastErrorNotifyId"),t&&t.stopPropagation&&t.stopPropagation();var o=x.getVisualStasInExploration(this.exploration,this.services.scriptVisuals);this.logRTelemetry(e.telemetry.EXExplorationRefresh,o)},i.prototype.loadModelAndNotifyIfFailed=function(){var e=this;this.scope.viewModel.showSpinner=!1;var i=this.generateProgressBarNotificationAndGetId(),o=this.services.dataSources.get();this.services.conceptualSchemaProxy.get(o).then((function(){i&&e.services.notificationBar.hide(i)})).catch((function(o){var r=t.getTelemetryErrorDetails(o);e.rejectOpenExplorationTelemetryEvent(r),i&&e.services.notificationBar.hide(i),o&&o.serviceError&&t.helpers.ReportUtility.shouldDisplayErrorAsNotificationBar(o.serviceError.errorCode)?e.services.eventBridge.publishBubbling(e.scope,g.reportVisualError,{error:{code:o.serviceError.errorCode,"pbi.error":{code:o.serviceError.errorCode,parameters:[],details:o.serviceError.errorDetails}},showNotification:!0}):t.util.handleConceptualSchemaError(o,e.services.errorService,e.services.localizationService.get("ExplorationContainer_FailedToLoadModel"),"ExplorationContainer_FailedToLoadModel_DefaultDetails",e.services.localizationService,e.model)}))},i.prototype.loadLinguisticSchemaAndNotifyIfFailed=function(e){var t=this;this.services.lazySync("linguisticSchemaProxy").init(e.reportId,e.reportHasLinguisticSchema).catch((function(e){return t.showError(e,t.services.localizationService.get("ExplorationContainer_FailedToLoadReport"),"ExplorationContainer_FailedToLoadReport_DefaultDetails")}))},i.prototype.evaluateExplorationObjects=function(){var e=this.services.explorationNavigation.getCurrentExploration();t.util.ThemeUtils.evaluateObjects(e,this.services.themeService),this.services.eventBridge.publishToChannel(g.explorationObjectsLoaded,e)},i.prototype.setHighContrastMode=function(i,o,r){return void 0===o&&(o=!1),__awaiter(this,void 0,e.Promise,(function(){var s,n,a;return __generator(this,(function(l){switch(l.label){case 0:return s=r?r:this.services.explorationNavigation.getCurrentExploration(),n=s.themeCollection,a=n.highContrastTheme||t.util.ThemeUtils.getThemeMetadata("None",2),a.name===i?[2]:"None"===i?[3,2]:(this.services.resourceRegistration.add(i,2,S.HighContrastTheme),[4,D.loadHighContrastTheme(this.services.promiseFactory,this.services.resourceLoader,this.services.themeService,s.resourcePackages,i)]);case 1:return l.sent(),a.name=i,this.services.cssGenerationService.applyHighContrastStyle(a),n.highContrastTheme=a,[3,3];case 2:this.services.cssGenerationService.removeHighContrastStyle(),delete n.highContrastTheme,l.label=3;case 3:return o||this.services.eventBridge.publishToChannel(e.events.visualThemeChanged),[2]}}))}))},i.prototype.removeHighContrastStyle=function(){this.exploration&&this.exploration.themeCollection&&this.exploration.themeCollection.highContrastTheme&&this.services.cssGenerationService.removeHighContrastStyle()},i.prototype.initializeExploration=function(i,r,s,n,a,c,d,h,g,b,f,w,x,D){return __awaiter(this,void 0,e.Promise,(function(){var E,P,A,R,T,I,k,B,V,z,N,F,G=this;return __generator(this,(function(O){switch(O.label){case 0:return this.services.customVisualLoader.reset(),this.services.customVisualLoader.setState(a),this.services.visualPlugin.removeAllCustomVisuals&&this.services.visualPlugin.removeAllCustomVisuals(),this.services.resourceGateService.setResourceFlag(),E=this.scope.viewModel.options,n?(P=[],A=[],this.services.featureSwitchService.featureSwitches.spoIntegration&&D?[4,this.services.moduleLoader.require({javascript:"tutorialResources/explorationResources"})]:[3,2]):[3,6];case 1:R=O.sent(),P=R.getExplorationTutorialVisuals(),A=R.getExplorationResourceItems(),O.label=2;case 2:return T=t.contracts.createDefaultExploration(void 0,P,this.services.featureSwitchService),T.defaultDrillFilterOtherVisuals=u,M.fillDefaultSectionDisplayNames(T,this.services.localizationService),this.extensions.explorationResolver&&this.extensions.explorationResolver.init(d),[4,this.addODataFilterFromQuery(T,g)];case 3:return O.sent(),this.setDataSource(T,c),[4,this.tryAddJsonFilters(T,b)];case 4:if(O.sent(),this.scope.viewModel.exploration=C.convertExploration(T,this.services.formFactor.getCurrentLayout()),this.services.telemetryService.logEvent(e.telemetry.EXInitExploration,f,c&&c.directQueryMode===!0,c&&!_.isEmpty(c.onPremModelConnectionString),c&&l[c.dataCacheMode]),this.setSectionStatus(0),this.services.explorationNavigation.loadExploration(T),I=this.services.resourceRegistration,this.services.featureSwitchService.featureSwitches.spoIntegration&&D&&!_.isEmpty(A))for(k=0,B=A;k<B.length;k++)V=B[k],I.add(V,2,S.Image);return I.add(p,2,S.BaseTheme),[4,this.initializeThemes(T)];case 5:return O.sent(),this.evaluateExplorationObjects(),this.setVisualThemeDataColors(T.themeCollection),jsCommon.BrowserUtils.isInternetExplorerOrEdge()&&this.registerHighContrastMediaQuery(),E.disableLinguisticSchemaInitialization||this.loadLinguisticSchemaAndNotifyIfFailed(T),this.scope.$broadcast(m),this.loadModelAndNotifyIfFailed(),this.services.explorationNavigation.updateActiveSection({targetSectionIndex:0,forceUpdate:!0,suppressHistory:!0}),this.resolveOpenExplorationTelemetryEventWhenNoVisualContainers(),this.setViewModelExploration(T,0),[3,9];case 6:return this.scope.viewModel.showSpinner=!0,z=function(i){return __awaiter(G,void 0,e.Promise,(function(){var n,p,u,d,h,v,S,D,C=this;return __generator(this,(function(P){switch(P.label){case 0:for(n=i.exploration,this.extensions.explorationResolver&&this.extensions.explorationResolver.init(n),E.disableLinguisticSchemaInitialization||this.loadLinguisticSchemaAndNotifyIfFailed(n),p=0,u=n.sections;p<u.length;p++)d=u[p],h=this.scope.viewModel.options.overrideSectionSize,h&&_.isNumber(h.displayOption)?d.size={displayOption:h.displayOption,width:h.width||d.size.width,height:h.height||d.size.height}:null!=this.scope.viewModel.options.defaultDisplayOption&&0===d.size.displayOption&&(d.size.displayOption=this.scope.viewModel.options.defaultDisplayOption);return this.shouldApplyBookmarkPage(x)&&o.isStateBookmark(x)?v=M.findSectionIndexForSectionName(n,x.explorationState.activeSection):r?v=M.findSectionIndexForSectionName(n,r):s?v=M.findSectionIndexForSectionName(n,s):_.isNumber(n.activeSectionIndex)&&(v=n.activeSectionIndex),null!=v&&_.inRange(v,0,n.sections.length)||(v=0),n.activeSectionIndex=v,M.fillDefaultSectionDisplayNames(n,this.services.localizationService),[4,this.addODataFilterFromQuery(n,g)];case 1:return P.sent(),this.setDataSource(n,c),this.updateCapabilitiesFromSettings(n),this.setSectionStatus(v),this.extensions.saveExploration&&this.extensions.saveExploration.setOriginalExploration(i),this.services.explorationNavigation.loadExploration(n),[4,this.initializeThemes(n)];case 2:return P.sent(),this.evaluateExplorationObjects(),this.setVisualThemeDataColors(n.themeCollection),jsCommon.BrowserUtils.isInternetExplorerOrEdge()&&this.registerHighContrastMediaQuery(),this.services.telemetryService.logEvent(e.telemetry.EXInitExploration,f,c&&c.directQueryMode===!0,c&&!_.isEmpty(c.onPremModelConnectionString),c&&l[c.dataCacheMode]),this.loadModelAndNotifyIfFailed(),y.acquireTrustedVisuals(n,this.services.trustedVisual).then((function(e){return C.reloadTrustedVisuals(e)})),[4,this.applyArtifactsToExploration(n,v,x,b,r)];case 3:return v=P.sent(),this.setViewModelExploration(n,v,w),this.afterViewModelInit(n,v,a),this.scope.$broadcast(m),this.resolveOpenExplorationTelemetryEventWhenNoVisualContainers(),this.services.rootScope.$emit(t.constants.openReportFinished,"",!1),this.extensions.navigation&&this.extensions.navigation.inReportSubscriptionView()&&(S=this.services.explorationNavigation.getCurrentSection(),D=M.getVisibleSections(n.sections),this.services.subscription.expandPaneForReportSubscription({currentSection:M.isSectionHidden(S)?D[0]:S,report:this.services.explorationNavigation.getCurrentExploration().report,modelId:this.services.explorationNavigation.getCurrentExploration().dataSources[0].id,sections:D},this.extensions.navigation.currentSubscriptionGUID())),[2]}}))}))},d?[4,z({wireContractJSON:h,exploration:d})]:[3,8];case 7:return O.sent(),[3,9];case 8:N=this.services.telemetryService.startEvent(e.telemetry.EXFetchExploration,f),F={id:i,model:c},this.services.explorationProxy.get(F).then((function(t){return __awaiter(G,void 0,e.Promise,(function(){return __generator(this,(function(e){switch(e.label){case 0:return this.exploration=t.exploration,[4,z(t)];case 1:return e.sent(),N.resolve(),[2]}}))}))}),(function(e){G.showError(e,G.services.localizationService.get("ExplorationContainer_FailedToLoadReport"),"ExplorationContainer_FailedToLoadReport_DefaultDetails"),G.scope.viewModel.showSpinner=!1,G.services.rootScope.$emit(t.constants.openReportFinished,e&&e.error?e.error.message:"",!0),N.reject(),G.rejectOpenExplorationTelemetryEvent(v.getTelemetryErrorDetails(e&&e.error))})),O.label=9;case 9:return[2]}}))}))},i.prototype.applyArtifactsToExploration=function(t,i,o,r,s){return __awaiter(this,void 0,e.Promise,(function(){var e,n,a,l,c,p,u;return __generator(this,(function(h){switch(h.label){case 0:if(!_.isEmpty(t.sections))for(e=0,n=t.sections;e<n.length;e++)a=n[e],this.services.filterGenerator.updateCrossDrillOfSectionOperation(a);return[4,this.tryApplyBookmark(o)];case 1:return h.sent(),[4,this.tryAddJsonFilters(t,r)];case 2:return h.sent(),l=this.extensions.persistentState,l?[4,l.init(t)]:[3,4];case 3:h.sent(),h.label=4;case 4:return(c=this.extensions.bookmark)?(this.services.dataProxy.stopCommunication(d),[4,c.init(t,s)]):[3,6];case 5:p=h.sent(),p&&p.activeSection&&(i=t.activeSectionIndex,this.setSectionStatus(i)),h.label=6;case 6:return(u=this.extensions.slicers)?(this.services.dataProxy.stopCommunication(d),[4,u.init(t)]):[3,8];case 7:h.sent(),h.label=8;case 8:return[2,i]}}))}))},i.prototype.afterViewModelInit=function(e,t,i){var o=!0,r=!0,s=this.extensions.bookmark;if(s){var n=s.afterInit(e);o=!(n&&n.visibility),r=!(n&&n.pendingHighlights)}this.services.dataProxy.resumeCommunication(d),this.services.explorationNavigation.updateActiveSection({targetSectionIndex:t,forceUpdate:!0,suppressHistory:!0,navigationAction:void 0,canvasLayout:void 0,clearSelection:o,clearCrossFilter:r}),this.changeToEditMode(e,i)},i.prototype.pauseQueriesChanged=function(e){var t=!this.scope.viewModeState.getConfig().pauseQueryExecution;this.scope.viewModeState.updateConfig((function(e){e.pauseQueryExecution=t})),t?this.services.dataProxy.stopCommunication(r.dsrDataReaderType):this.services.dataProxy.resumeCommunication(r.dsrDataReaderType),e.stopPropagation()},i.prototype.shouldApplyBookmarkPage=function(e){if(!e||o.isBookmarkGroup(e))return!1;
var t=!e.options||e.options.suppressActiveSection!==!1,i=e.explorationState&&e.explorationState.activeSection;return t&&!_.isEmpty(i)},i.prototype.tryApplyBookmark=function(t){return __awaiter(this,void 0,e.Promise,(function(){var e;return __generator(this,(function(i){switch(i.label){case 0:return!t||o.isBookmarkGroup(t)?[2]:[4,this.services.lazyScoped("bookmark")];case 1:return e=i.sent(),t.options=t.options||{},t.options.suppressActiveSection=!1,[4,e.applyBookmark(t,!0)];case 2:return[2,i.sent()]}}))}))},i.prototype.tryAddJsonFilters=function(t,i){return __awaiter(this,void 0,e.Promise,(function(){var e,o,r,s,n,a,l,c,p,u,d;return __generator(this,(function(h){switch(h.label){case 0:return i&&_.isArray(i)?(e=this.services.dataSources.get(),[4,this.services.conceptualSchemaProxy.get(e)]):[2];case 1:return o=h.sent(),[4,this.getJsonFilterParser()];case 2:if(r=h.sent(),!r)return[2];s=[],n=0,a=i,h.label=3;case 3:return n<a.length?(l=a[n],[4,r.tryCreateFilterContainer(t,o,l)]):[3,6];case 4:if(c=h.sent(),!c)return[2];s.push(c),h.label=5;case 5:return n++,[3,3];case 6:if(_.isEmpty(s))return[2];for(t.filters=t.filters||[],p=0,u=s;p<u.length;p++)d=u[p],t.filters.push(d);return this.updateExplorationCacheCapabilities(!0,!1),[2]}}))}))},i.prototype.addODataFilterFromQuery=function(t,i){return __awaiter(this,void 0,e.Promise,(function(){var e,o,r,s,n;return __generator(this,(function(a){switch(a.label){case 0:return i?[4,this.services.lazy("odataFilterParserService")]:[3,2];case 1:if(e=a.sent(),o=e.tryGetFilters(i),_.isEmpty(o))return[2];for(t.filters||(t.filters=[]),r=0,s=o;r<s.length;r++)n=s[r],t.filters.push(n);this.updateExplorationCacheCapabilities(!0,!1),a.label=2;case 2:return[2]}}))}))},i.prototype.updateExplorationCacheCapabilities=function(e,t){var i=this.services.explorationCapabilities,o=i.getCapabilities();o.visualContainerOptions.disableQueryCacheUpdates=e,o.persistentUserStateEnabled=t,i.setCapabilities(o)},i.prototype.updateCapabilitiesFromSettings=function(e){if(e){var t=e.settings,i=this.services.viewModeState,o=this.services.explorationCapabilities,r=o.getCapabilities();t&&t.isPersistentUserStateDisabled&&(r.persistentUserStateEnabled=!1),r.visualContainerOptions.useStylableHeader=t&&t.useStylableVisualContainerHeader,r.visualContainerOptions.hideHeader=i&&0===i.getMode()&&t&&t.hideVisualContainerHeader,o.setCapabilities(r)}},i.prototype.setSectionStatus=function(e){this.scope.viewModel.sectionStatus.currentSectionNumber=e},i.prototype.setVisualThemeDataColors=function(e){var t=this.services.themeService,i=t.getDataColors(e);this.services.colorPicker.setDataColors(i)},i.prototype.initializeThemes=function(t){return __awaiter(this,void 0,e.Promise,(function(){return __generator(this,(function(e){switch(e.label){case 0:return[4,D.loadThemeAndBaseTheme(this.services.promiseFactory,this.services.resourceLoader,this.services.themeService,t.resourcePackages,t.themeCollection)];case 1:return e.sent(),[2,t]}}))}))},i.prototype.registerHighContrastMediaQuery=function(){for(var t=this,i=[window.matchMedia("(-ms-high-contrast:active)"),window.matchMedia("(-ms-high-contrast:white-on-black)"),window.matchMedia("(-ms-high-contrast:black-on-white)")],o=function(o,r){return __awaiter(t,void 0,e.Promise,(function(){return __generator(this,(function(e){switch(e.label){case 0:return i[0].matches?i[1].matches?[4,this.setHighContrastMode("HighContrastBlack",r)]:[3,2]:[3,7];case 1:return e.sent(),[3,6];case 2:return i[2].matches?[4,this.setHighContrastMode("HighContrastWhite",r)]:[3,4];case 3:return e.sent(),[3,6];case 4:return[4,this.setHighContrastMode("HighContrast1",r)];case 5:e.sent(),e.label=6;case 6:return[3,9];case 7:return[4,this.setHighContrastMode("None",r)];case 8:e.sent(),e.label=9;case 9:return[2]}}))}))},r=0,s=i;r<s.length;r++){s[r].addListener(o)}o(null,!0)},i.prototype.setDataSource=function(e,i){this.model=i;var o=e.dataSources;if(!o.withId(i.id)){o.push(t.contracts.dataSourceForModel(i));var r=t.constants.DefaultSchemaName;if(null!=e.id){var s=t.constants.ExplorationSchemaName;o.push({type:t.dataReaderPlugins.ExplorationDataReaderType,id:e.id,name:s,extends:r,exploration:{schemaName:s,extends:r,getModelExtensions:function(){return e.modelExtensions}}})}}this.services.dataSources.set(o)},i.prototype.showError=function(e,t,i){this.services.errorService.error(t,i,{requestId:e?e.requestId:void 0,statusCode:e&&e.httpStatusCode?e.httpStatusCode.toString():void 0},null,"PowerBI")},i.prototype.clearExploration=function(){this.rejectOpenExplorationTelemetryEvent({errorSource:"User",errorMessage:"cancelled by user",errorCode:"cancelled"}),this.extensions.saveExploration&&this.extensions.saveExploration.setOriginalExploration(null),this.extensions.explorationResolver&&this.extensions.explorationResolver.init(null),this.scope.viewModel.exploration=null,this.setSectionStatus(-1),this.services.dataSources.set(null),this.legacyReportExists=!1,this.services.eventBridge.publishToChannel(g.explorationUnloaded)},i.prototype.canWrite=function(e){return!this.services.permissionService.isActiveWorkspaceIsReadOnly&&e&&e.canWrite},i.prototype.canExplore=function(e,t){return!this.services.permissionService.isActiveWorkspaceIsReadOnly&&e&&e.contract&&(e.canExplore||this.canWrite(e))&&this.services.permissionService.isExplorableModel(t,this.services.featureSwitchService.featureSwitches.explorePermissionOnDataset)},i.prototype.canCopy=function(e){return!this.services.permissionService.isActiveWorkspaceIsReadOnly&&e&&e.canCopy},i.prototype.isReportFromPbix=function(e){return e&&e.contract&&e.contract.isFromPbix},i.prototype.reloadTrustedVisuals=function(t){t&&t.length>0&&(this.services.visualPlugin.ensureTrustedVisualPlugins(t),this.services.eventBridge.publishToChannel(e.explore.services.events.visualPluginsChanged),this.services.rootScope.$emit(n.reloadEmptyVisuals,{visualTypes:t.map((function(e){return e.name}))}))},i.prototype.resolveOpenExplorationTelemetryEventWhenNoVisualContainers=function(){this.scope.viewModel.exploration.exploreCanvas&&!_.isEmpty(this.scope.viewModel.exploration.exploreCanvas.visualContainers)||this.resolveOpenExplorationTelemetryEvent()},i.prototype.resolveOpenExplorationTelemetryEvent=function(){if(this.openExplorationTelemetryEvent){var e=this.openExplorationTelemetryEvent.event.info,t=this.scope.viewModel.exploration.contract,i=A.getVisualTypesAndCountsFromActiveSection(t);e.visualTypesAndCounts=JSON.stringify(i),this.exploration&&this.exploration.tags&&(e.tags=JSON.stringify(this.exploration.tags).substr(0,300));var o=A.getImprovedFilterExperienceTelemetry(t,this.services.viewModeState.getMode());e.improvedFilterExperienceState=JSON.stringify(o),this.openExplorationTelemetryEvent.resolve(),this.openExplorationTelemetryEvent=null}},i.prototype.rejectOpenExplorationTelemetryEvent=function(e){this.openExplorationTelemetryEvent&&(this.openExplorationTelemetryEvent.reject(e),this.openExplorationTelemetryEvent=null)},i.prototype.setOpenExplorationTelemetryEvent=function(e){this.resolveOpenExplorationTelemetryEvent(),this.openExplorationTelemetryEvent=e},i.prototype.onLoadPowerViewReport=function(i){return __awaiter(this,void 0,e.Promise,(function(){var o,r,s,n,a,l,c,p,u,d,h,v,m=this;return __generator(this,(function(y){switch(y.label){case 0:return[4,this.services.activeFolderId.initialFolderIdReadyPromise];case 1:return y.sent(),this.extensions.persistentState?[4,this.extensions.persistentState.registerHandler((function(e,t){m.extensions.saveExploration&&m.extensions.saveExploration.showSavePrompt(e,t)}))]:[3,3];case 2:y.sent(),y.label=3;case 3:return this.services.rootScope.$emit(f,!1),this.services.eventBridge.publishToChannel(g.onReportChanged,{explorationContentChanged:!1}),o=i.instantiationMode!==e.common.contracts.reportServer.ReportInstantiationMode.None,i.report.objectId&&(r=this.services.activeFolderId.activeFolderObjectId,s=i.report.contract.originalReportObjectId,o=!1,n=!1,this.services.reportService.findReportByGUID&&(a=this.services.reportService.findReportByGUID(i.report.objectId),n=a&&this.extensions.usageMetricsOperations&&this.extensions.usageMetricsOperations.isUsageMetricsArtifact(a)),!n&&this.extensions.updateMRU&&this.extensions.updateMRU(1,i.report.objectId,i.report.displayName,i.report.getPermissions(),r,s,i.report.packageId)),this.clearExploration(),this.addKeyHandler(),l=i.instantiationMode!==e.common.contracts.reportServer.ReportInstantiationMode.None,this.reportId=o?void 0:i.report.id,this.extensions.saveExploration&&this.extensions.saveExploration.init(i.report),this.model=i.model.contract,this.legacyReportExists=!t.helpers.ReportUtility.IsReportSavedAsExploration(i.report.contract),this.scope.viewModel.displayName=o?void 0:i.report.contract.displayName,this.scope.viewModel.canEdit=this.canExplore(i.report,i.model),this.scope.viewModel.canCopy=this.canCopy(i.report),this.scope.viewModel.canWrite=this.canWrite(i.report),this.pinEnabled=!!this.extensions.enablePin&&this.extensions.enablePin(i.report),!this.services.featureSwitchService.featureSwitches.pinReadable&&i.model&&17===i.model.getPermissions()&&(this.scope.viewModel.options.visualContainerOptions.showPin=!1),this.services.viewModeState.setMode(l?1:0),this.scope.viewModel.taskPane.isPaneExpanded=l,this.scope.viewModel.visualizationPane.isPaneExpanded=l,this.scope.viewModel.isNavPaneCollapsed=!l,this.scope.viewModel.datasetModel=i.model,this.scope.viewModel.reportPermission=i.report.getPermissions(),this.scope.viewModel.isReportFromPbix=this.isReportFromPbix(i.report),c=this.scope.viewModel.datasetModel,p=this.model&&this.model.packageId,u=this.services.packageService.findPackage(p),u&&(c.packagePublishStatus=u.publishOrRefreshStatus,c.contract.isPackageRefreshEnabled=u.contract.IsRefreshEnabled),d=this.scope.viewModel.options,d.visualContainerOptions.disablePin=!this.pinEnabled,this.services.viewModeState.updateConfig((function(e){e.supportsExportData=!d.disableExport&&m.services.featureSwitchService.featureSwitches.exportDataEnabled})),this.setOpenExplorationTelemetryEvent(i.openExplorationTelemetryEvent),[4,this.initializeExploration(i.report.id,i.reportPage,i.report.activeSlideId,o,l,i.report.model,i.exploration,i.wireContractJSON,i.additionalODataFilter,i.additionalJsonFilters,i.report.objectId,i.canvasLayout,i.bookmark,i.addTutorialVisualsToExploration)];case 4:return y.sent(),h=e.explore.util.ExploreUndoRedoHandlerUtility.createUndoRedoHandler(this.scope.viewModel,this.services.timeout,this.services.selection,this.services.filterGenerator,this.services.featureSwitchService,this.services.lazyScopedSync,this.services.formFactor,this.services.explorationSerializer,this.services.explorationNavigation,this.services.lazySync("linguisticSchemaProxy"),this.services.eventBridge,this.services.visualPlugin,this.services.staticResourceReferences),v=new E(h,this.services.staticResourceReferences),this.services.undoRedo.setStrategy(v),this.services.clipboard.setHandler(e.explore.util.ExploreClipboardHandlerUtility.createClipboardHandler(this.scope.viewModel,this.services.explorationSerializer,this.services.localizationService,this.services.modalDialogService,this.services.conceptualSchemaProxy,this.services.dataSources,this.services.displayNameService,this.services.lazyScopedSync,this.services.selection,this.services.visualAuthoring,this.services.visualPlugin,this.services.filterGenerator,this.services.formFactor,this.services.visualStylePresetService,this.services.telemetryService,this.services.featureSwitchService.featureSwitches.slicerSyncing)),this.notifyIfModelRefreshDisabledBySelectiveRefresh(),[2]}}))}))},i.prototype.showErrorNotification=function(e,t){if(t.error.code&&t.showNotification){var i=this.scope.viewModel.datasetModel;this.showErrorNotificationWithModel(t,i),e.stopPropagation()}},i.prototype.showErrorNotificationWithModel=function(e,t,i){var o=this;e&&e.showNotification&&(t.contract.creatorUser?this.notifyError(e.error,t,i):this.services.modelHttpService.getModel(t.id,t.packageId,null).then((function(r){r.data.creatorUser&&(t.contract.creatorUser=r.data.creatorUser,o.notifyError(e.error,t,i))})))},i.prototype.notifyError=function(e,t,i){var o=this;i||(i=function(){o.refresh()}),this.requiresGatewayInfo(e.code)?this.services.gatewaysMetadataService.getModelDataSources(t.id).then((function(r){var s=o.services.selectGatewayService.getSelectedGateway(r);o.notify(e,t,s,i)}),(function(r){o.notify(e,t,null,i)})):this.notify(e,t,null,i)},i.prototype.notify=function(e,t,i,o){var r=this.getErrorNotificationParameter(e,t,i,o);if(r){var s={notificationName:"lastErrorNotifyId",notificationId:this.services.notificationBar.notify(r)};this.addNotification(s)}},i.prototype.requiresGatewayInfo=function(t){return t===e.DM_GWPipeline_Client_GatewayUnreachable},i.prototype.getErrorNotificationParameter=function(i,o,r,s){var n=this,a=i.code,l=o.contract.creatorUser,c=l.emailAddress;c.match(e.common.controllers.EmailValidator)||(c=l.AlternateEmailAddress);var p,u,d,h,v,g=c===e.session.UserInfoUtils.getUPN();switch(a){case e.DMTS_NoGatewayWithAllDatasourcesToBindError:var m=this.getDatabaseName(i);p=this.services.localizationService.format("ExplorationContainer_Notification_DMTS_NoGatewayWithAllDatasourcesToBindError_Message",m),d=[{displayText:m},this.createDatasetsSettingPageActionLink(m)],h=this.createErrorDialogActionLink("ExplorationContainer_Notification_DataSourceUnreachable","ExplorationContainer_Notification_DMTS_NoGatewayWithAllDatasourcesToBindError_ModalDialog",d);break;case e.DM_GWPipeline_Gateway_GatewayUpgradeRequired:p=this.services.localizationService.get("ExplorationContainer_Notification_DM_GWPipeline_Client_GatewayUpgradeRequired");break;case e.DMTS_MultipleGatewaysWithAllDatasourcesToBindError:g=!1,m=this.getDatabaseName(i),p=this.services.localizationService.format("ExplorationContainer_Notification_DMTS_MultipleGatewaysWithAllDatasourcesToBindError_NotificationBar",m),u=g?"ExplorationContainer_Notification_DMTS_MultipleGatewaysWithAllDatasourcesToBindError_Message":"ExplorationContainer_Notification_DMTS_MultipleGatewaysWithAllDatasourcesToBindError_NotOwner_Message",d=[{displayText:m}],g?d.push(this.createDatasetsSettingPageActionLink(m)):d.push({displayText:l.givenName,urlString:"mailto:"+c}),h=this.createErrorDialogActionLink("ExplorationContainer_Notification_DataSourceInaccessible",u,d);break;case e.DMTS_DatasourceHasNoCredentialError:m=this.getDatabaseName(i),p=this.services.localizationService.format("ExplorationContainer_Notification_CredentialsRequired_NotificationBar",m),u=g?"ExplorationContainer_Notification_CredentialsRequired_Message":"ExplorationContainer_Notification_CredentialsRequired_NotOwner_Message",d=[{displayText:m}],g?d.push(this.createDatasetsSettingPageActionLink(m)):d.push({displayText:l.givenName,urlString:"mailto:"+c}),h=this.createErrorDialogActionLink("ExplorationContainer_Notification_DataSourceCredentialsMissing",u,d);break;case e.DM_GWPipeline_Client_GatewayUnreachable:var y=r.gatewayName;m=this.getDatabaseName(i),p=this.services.localizationService.format("ExplorationContainer_Notification_DM_GWPipeline_Client_GatewayUnreachable_NotificationBar",m,y),u=g?"ExplorationContainer_Notification_DM_GWPipeline_Client_GatewayUnreachable_ModalDialog_Owner":"ExplorationContainer_Notification_DM_GWPipeline_Client_GatewayUnreachable_ModalDialog_NotOwner",d=[{displayText:m},{displayText:y}],g?d.push(this.createDatasetsSettingPageActionLink(m)):d.push({displayText:l.givenName,urlString:"mailto:"+c}),h=this.createErrorDialogActionLink("ExplorationContainer_Notification_DataGatewayUnreachable",u,d);break;case e.DM_GWPipeline_Gateway_DataSourceConnectionError:p=g?this.services.localizationService.get("ExplorationContainer_Notification_DMTS_DatasourceConnectionError_Message"):this.services.localizationService.format("ExplorationContainer_Notification_DMTS_MultipleGatewaysWithAllDatasourcesToBindError_NotOwner_Message",[l.givenName]),h=null;break;case e.RS_CannotRetrieveModel:p=this.services.localizationService.get("DsrError_CanNotRetrieveModelMessage"),h=null;break;case e.RS_AccessDeniedDueToRLSGroup:p=this.services.localizationService.get("DsrError_NoPermissionDueToRLSGroupMessage_NotificationBar"),d=[{displayText:c,urlString:"mailto:"+c}],h=this.createErrorDialogActionLink("DsrError_NoPermissionToViewMessage_Title","DsrError_NoPermissionDueToRLSGroupMessage_ModalDialog",d);break;case e.RS_AccessDenied:p=this.services.localizationService.get("DsrError_NoPermissionToViewMessage"),d=[{displayText:c,urlString:"mailto:"+c}],h=this.createErrorDialogActionLink("DsrError_NoPermissionToViewMessage_Title","DsrError_NoPermissionToViewMessage_ModalDialog",d);break;case e.DMTS_UserNotFoundInADGraphError:p=this.services.localizationService.format("ExplorationContainer_Notification_DMTS_UserNotFoundInADGraphError_NotificationBar",c),d=[{displayText:c},this.createDatasetsSettingPageActionLink(m)],h=this.createErrorDialogActionLink("ExplorationContainer_Notification_DataSetOwnerNotFound","ExplorationContainer_Notification_DMTS_UserNotFoundInADGraphError_Message",d);break;case e.DMTS_UserLostPermissionToDatasourceError:case e.DM_GWPipeline_Gateway_ImpersonationError:p=g?this.services.localizationService.get("ExplorationContainer_Notification_DMTS_UserLostPermissionToDatasourceError_Message"):this.services.localizationService.format("ExplorationContainer_Notification_DMTS_MultipleGatewaysWithAllDatasourcesToBindError_NotOwner_Message",[l.givenName]),h=g?{displayText:this.services.localizationService.get("ExplorationContainer_Notification_DMTS_UserLostPermissionToDatasourceError_ActionText"),action:function(){n.services.selectGatewayService.bindModelToGateway(o.id,(function(){n.refresh(),n.hideExplorationWarning("lastErrorNotifyId")}),(function(){n.services.errorService.error(n.services.localizationService.get("ExplorationContainer_FailedToBindToGatewayMessage"),"ExplorationContainer_FailedToBindToGateway")}),(function(){}))}}:{displayText:this.services.localizationService.format("Email_Someone",[l.givenName]),urlString:"mailto:"+c};break;case e.DM_GWPipeline_Gateway_DataSourceAccessError:p=g?this.services.localizationService.get("ExplorationContainer_Notification_DMTS_DatasourceAccessError_Message"):this.services.localizationService.format("ExplorationContainer_Notification_DMTS_MultipleGatewaysWithAllDatasourcesToBindError_NotOwner_Message",[l.givenName]),h=null;break;case e.DM_GWPipeline_Gateway_SqlTimeoutException:m=this.getDatabaseName(i),p=this.services.localizationService.format("ServerError_DM_GWPipeline_Gateway_GenericTimeoutException_NotificationBar",m),d=[{displayText:m}],h=this.createErrorDialogActionLink("ServerError_DM_GWPipeline_Gateway_GenericTimeoutException_Title",t.constants.serverErrorPrefix+a,d);break;case e.DM_GWPipeline_Gateway_AdomdTimeoutException:m=this.getDatabaseName(i),p=this.services.localizationService.format("ServerError_DM_GWPipeline_Gateway_GenericTimeoutException_NotificationBar",m),d=[{displayText:m}],h=this.createErrorDialogActionLink("ServerError_DM_GWPipeline_Gateway_GenericTimeoutException_Title","ServerError_DM_GWPipeline_Gateway_AdomdTimeoutException",d);break;case e.DM_GWPipeline_Gateway_InvalidObjectNameException:m=this.getDatabaseName(i),p=this.services.localizationService.get("ServerError_DM_GWPipeline_Gateway_InvalidObjectNameException"),d=[{displayText:m}],h=this.createErrorDialogActionLink("ServerError_DataSourceSchemaChanged","ServerError_DM_GWPipeline_Gateway_InvalidObjectNameException_ModalDialog",d);break;case e.DM_GWPipeline_Gateway_ConnectionBrokenException:m=this.getDatabaseName(i),p=this.services.localizationService.format("ServerError_DM_GWPipeline_Gateway_ConnectionBrokenException",m),d=[{displayText:m}],h=this.createErrorDialogActionLink("ServerError_DataSourceConnectionFailed","ServerError_DM_GWPipeline_Gateway_ConnectionBrokenException_ModalDialog",d);break;case e.DM_GWPipeline_Gateway_MashupDataAccessError:m=this.getDatabaseName(i),p=this.services.localizationService.format("ServerError_DM_GWPipeline_Gateway_MashupDataAccessError",m),d=[{displayText:m},this.createDatasetsSettingPageActionLink(m)],h=this.createErrorDialogActionLink("ServerError_DataSourceConnectionFailed","ServerError_DM_GWPipeline_Gateway_MashupDataAccessError_ModalDialog",d);break;case e.DM_GWPipeline_Gateway_InvalidMashupConnectionString:case e.DM_GWPipeline_Gateway_DatabaseLoginError:case e.DM_GWPipeline_Gateway_MemoryError:case e.DM_GWPipeline_Gateway_MissingStructureError:case e.DM_GWPipeline_Gateway_UnprocessedStructureError:case e.DM_GWPipeline_Gateway_ModelLoadError:case e.DM_GWPipeline_Gateway_CancellationError:case e.DM_GWPipeline_Gateway_QueryExecutionError:case e.DM_GWPipeline_Gateway_RecalculationRequiredError:case e.DM_GWPipeline_Gateway_AdomdConnectError:default:p=this.services.localizationService.get(t.constants.serverErrorPrefix+a),h=null}return{message:p,notificationType:e.common.NotificationBarType.Error,secondaryLink:h,embeddedMessageAction:v}},i.prototype.getContactInfo=function(t){if(t){var i=e.gateways.models.GatewayModelConverter.getGatewayAnnotation(t);if(i){var o=i.gatewayContactInformation,r="";if(o)for(var s=0,n=0,a=o;n<a.length;n++){var l=a[n];r+=l,s<o.length-1&&(r+="; "),s++}return r}}return""},i.prototype.getServerName=function(e){if(e["pbi.error"]){var t=e["pbi.error"].details;if(t&&t.length>0)return t[0].detail.value}return""},i.prototype.getDatabaseName=function(e){if(e["pbi.error"]){var t=e["pbi.error"].details;if(t&&t.length>1)return t[1].detail.value}return""},i.prototype.onRefreshReportData=function(){var e=c.dataReaderDataSources(c.queried(this.services.dataSources.get(),null));e&&(this.services.dataProxy.clearCache(r.dsrDataReaderType,e),this.services.eventBridge.publishToChannel(t.services.events.visualContainerChanged,{affectContainer:function(){return!0}}))},i.prototype.generateProgressBarNotificationAndGetId=function(){var t,i=1024,o=this.scope.viewModel.datasetModel&&this.scope.viewModel.datasetModel.contract;o&&(t=o.sizeInMBs);var r=this.services,s=r.localizationService;if(!t||t<i){if(!r.featureSwitchService.featureSwitches.reportLoadIndicator)return;return r.notificationBar.notify({message:s.get("DataLoaderSpinner_LoadingMessage1"),hideOnStateChange:!0,notificationType:e.common.NotificationBarType.Loading})}var n=r.datasetSizeService,a=n.getProgressBarDetailsForGivenFileSize(t);return r.notificationBar.notify({message:s.format("DataLoaderSpinner_EstimatedTimeInMinutes",[a.estimatedLoadingTimeInMinutes]),hideOnStateChange:!0,notificationType:e.common.NotificationBarType.Loading,progressBarInfo:{progressDelays:a.delayDurationString}})},i.prototype.getJsonFilterParser=function(){return __awaiter(this,void 0,e.Promise,(function(){var e,t;return __generator(this,(function(i){switch(i.label){case 0:return this.jsonFilterParser?[3,3]:[4,this.services.moduleLoader.require({javascript:"JSONFilter/services/jsonFilterParser"})];case 1:return e=i.sent(),t=this,[4,e.create(this.services.promiseFactory,this.services.moduleLoader,this.services.telemetryService)];case 2:t.jsonFilterParser=i.sent(),i.label=3;case 3:return[2,this.jsonFilterParser]}}))}))},i.prototype.createErrorDialogActionLink=function(e,t,i){var o=this;return{displayText:this.services.localizationService.get("Generic_ShowDetails"),action:function(){return o.showModalDialog(e,t,i)}}},i.prototype.createDatasetsSettingPageActionLink=function(e){var t=this;return{displayText:this.services.localizationService.get("ExplorationContainer_Notification_DatasetSettingsPage"),action:function(){return t.services.rootScope.$emit(r.navigateToDatasetSettingsEventName,e)},dismissDialogAfterActionPerformed:!0}},i.prototype.showModalDialog=function(t,i,o){return __awaiter(this,void 0,e.Promise,(function(){var e,r;return __generator(this,(function(s){switch(s.label){case 0:return[4,this.services.moduleLoader.require({javascript:"PowerBIDialogs/components/reportServiceErrorMessageDialog/reportServiceErrorMessageDialogBuilder"})];case 1:return e=s.sent(),r=e.createReportServiceErrorMessageDialogBuilder(this.services.modalDialogService),[4,r.show(t,i,o)];case 2:return s.sent(),[2]}}))}))},i})();i.ExplorationContainerController=k})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var o=(function(){function i(){this.restrict="E",this.replace=!0,this.scope={viewModel:"=",canvasOptions:"<",explorationContainerOptions:"<"},this.controller=e.common.createController(t.controllers.ExplorationContainerController),this.templateUrl="views/explorationContainer.html"}return i})();i.ExplorationContainer=o})(i=t.directives||(t.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={})),angular.module("powerbi.explore").run(["$templateCache",function(e){e.put("components/appBarFlyoutMenu/appBarFlyoutMenu.html",'<button class="dropdown-item {{$ctrl.menuItemClass}}" ng-click="$ctrl.openFlyout($event); $event.stopPropagation(); $event.preventDefault()" ng-disabled="$ctrl.flyoutItem.disabled" ng-class="{\'selected\': $ctrl.flyoutItem.checked}" role="menuitem"><div class="dropdown-content {{::$ctrl.flyoutItem.itemClass}}"><i class="glyphicon glyph {{::$ctrl.flyoutItem.itemClass}}" ng-class="::{\'glyph-small\': $ctrl.glyphSmall}" title="{{::$ctrl.flyoutItem.tooltip || $ctrl.flyoutItem.text}}"></i><span class="dropdown-label" ng-bind="::$ctrl.flyoutItem.text" title="{{::$ctrl.flyoutItem.tooltip || $ctrl.flyoutItem.text}}"></span><span ng-if="::$ctrl.flyoutItem.description" class="dropdown-description" ng-bind="::$ctrl.flyoutItem.description"></span><i class="glyphicon pbi-glyph-chevronrightmedium glyph-small" title="{{::$ctrl.flyoutItem.tooltip || $ctrl.flyoutItem.text}}"></i></div></button>'),e.put("components/explorationAppBar/explorationAppBar.html",'<div class="appBarContent trimmedTextWithEllipsis unselectable appThemable"><div class="appBarSection left" pbi-auto-focus focus-nav-mode="Browser" keyboard-shortcuts="ctrl-F6"><ul><pbi-lazy-load ng-if="$ctrl.showAppNavToggle()" [module-path]="$ctrl.appConsumptionLazyLoadPath" [component-id]="$ctrl.appConsumptionNavPaneToggleWrapperLazyComponentId"></pbi-lazy-load><li ng-if="$ctrl.viewModel.options.showBackButtonOnAppBar"> <button ng-click="$ctrl.navigateBack()" localize-tooltip="PinLiveReport_GoBack"><i class="glyphicon pbi-glyph-pageleft glyph-small backBtn"></i></button></li><li> <button class="file-menu" localize-tooltip="File" ng-click="$ctrl.showMenu($event, $ctrl.getFileMenuProperties);selected=!selected" role="menuitem"><span localize="File"></span><i class="glyphicon pbi-glyph-chevrondownmedium glyph-mini"></i></button></li><li ng-if="$ctrl.showViewMenu()"> <button class="pageview-menu" localize-tooltip="ItemAction_View" ng-click="$ctrl.showMenu($event, $ctrl.getViewMenuProperties)" role="menuitem"><span localize="ItemAction_View"></span><i class="glyphicon pbi-glyph-chevrondownmedium glyph-mini"></i></button></li><li ng-if="$ctrl.showReadingViewButton()"> <button localize-tooltip="ReportAppBar_SwitchModeButton" accessible-click="$ctrl.stopEditing()" class="switch"><span localize="ReportAppBar_SwitchModeButton"></span></button></li><li ng-if="$ctrl.canOpenEditReport()"> <button class="edit" localize-tooltip="ReportAppBar_EditReportButton" ng-click="$ctrl.edit()"><span localize="ReportAppBar_EditReportButton"></span></button></li><li ng-if="$ctrl.showEditReportDisabled()"> <button class="edit-disabled" disabled localize-tooltip="ReportAppBar_EditReportButtonSharedDisabled" localize="ReportAppBar_EditReportButton"></button></li><li ng-if="$ctrl.showEditDropdownMenu()"> <button class="editreport-menu" accessible-click="$ctrl.showMenu($event, $ctrl.getEditReportMenuProperties)" localize-tooltip="ReportAppBar_EditReportButton" role="menuitem"><span localize="ReportAppBar_EditReportButton"></span><i class="glyphicon pbi-glyph-chevrondownmedium glyph-mini"></i></button></li><li ng-if="$ctrl.showPhoneLayoutButton()"> <button localize-tooltip="ReportAppBar_MobileLayout" class="phone-layout-button" accessible-click="$ctrl.setPhonePortraitFormFactor()"><span localize="ReportAppBar_MobileLayout"></span></button></li><li ng-if="$ctrl.showWebLayoutButton()"> <button localize-tooltip="ReportAppBar_WebLayout" class="web-layout-button" accessible-click="$ctrl.setMasterFormFactor()"><span localize="ReportAppBar_WebLayout"></span></button></li></ul></div><div class="appBarSection right" ng-show="$ctrl.showAppBarRight()"><ul><li ng-if="$ctrl.viewModeState.getMode() === 0" class="appBarDivider" role="separator"></li><li ng-if="$ctrl.viewModeState.getMode() === 0"> <button class="explore" localize-tooltip="ReportAppBar_ExploreTooltip" ng-disabled="$ctrl.isMenuDisabled($ctrl.getExploreMenuProperties())" ng-click="$ctrl.showMenu($event, $ctrl.getExploreMenuProperties)" role="menuitem"><i class="glyphicon pbi-glyph-seedata glyph-small"></i><span localize="ReportAppBar_ExploreButton"></span><i class="glyphicon pbi-glyph-chevrondownmedium glyph-mini"></i></button></li><li ng-if="$ctrl.viewModeState.getMode() === 0"> <button ng-click="$ctrl.refresh()" class="refresh" localize-tooltip="ReportAppBar_RefreshButton"><i class="glyphicon pbi-glyph-refresh glyph-mini" aria-hidden="true"></i><span localize="ReportAppBar_RefreshButton"></span></button></li><li ng-if="$ctrl.viewModeState.getMode() === 0 && $ctrl.showPinPage() && $ctrl.canPinPage()"> <button localize-tooltip="ReportAppBar_PinPage" class="pin-report" ng-click="$ctrl.showPinReportPageDialog()"><i class="glyphicon pbi-glyph-pinned glyph-small"></i><span localize="ReportAppBar_PinPage"></span></button></li><li class="rightFloatedItem"></li><li ng-if="!$ctrl.isPopOutMode && $ctrl.isQnaEnabled"> <button class="qna" localize-tooltip="AskAQuestion" ng-click="$ctrl.addQnaContainer()"><i class="glyphicon pbi-glyph-qna glyph-small"></i><span localize="AskAQuestion"></span></button></li><li ng-if="$ctrl.viewModeState.getMode() === 1"> <button class="explore" localize-tooltip="ReportAppBar_ExploreTooltip" ng-disabled="$ctrl.isMenuDisabled($ctrl.getExploreMenuProperties())" ng-click="$ctrl.showMenu($event, $ctrl.getExploreMenuProperties)" role="menuitem"><i class="glyphicon pbi-glyph-seedata glyph-small"></i><span localize="ReportAppBar_ExploreButton"></span><i class="glyphicon pbi-glyph-chevrondownmedium glyph-mini"></i></button></li><li ng-if="$ctrl.viewModeState.getMode() === 1 && !$ctrl.isPopOutMode"> <button class="insert-textbox" localize-tooltip="Textbox" ng-click="$ctrl.insertTextbox()"><i class="glyphicon pbi-glyph-inserttextbox glyph-small"></i><span localize="Textbox"></span></button></li><li dropdown-menu dropdown-items="$ctrl.shapeMenuActions" dropdown-class="explorationAppBarMenu" dropdown-on-item-selected="$ctrl.shapeMenuActionSelected(selected)" localize-tooltip="ReportAppBar_ShapeButton" ng-if="$ctrl.viewModeState.getMode() === 1 && $ctrl.shapeMenuActions && !$ctrl.isPopOutMode"> <button role="menuitem" class="insert-shape"><i class="glyphicon pbi-glyph-shapes glyph-small"></i><span localize="ReportAppBar_ShapeButton"></span><i class="glyphicon pbi-glyph-chevrondownmedium glyph-mini"></i></button></li><li ng-if="$ctrl.viewModeState.getMode() === 1 && $ctrl.actionButtonMenuActions && !$ctrl.isPopOutMode"> <button role="menuitem" class="insert-button" localize-tooltip="ReportAppBar_Buttons" ng-click="$ctrl.showMenu($event, $ctrl.getActionButtonMenuProperties)"><i class="glyphicon pbi-glyph-buttons glyph-small"></i><span localize="ReportAppBar_Buttons"></span><i class="glyphicon pbi-glyph-chevrondownmedium glyph-mini"></i></button></li><li ng-if="$ctrl.viewModeState.getMode() === 1 && $ctrl.toggleEditVisualInteractionsMode && !$ctrl.isPopOutMode"> <button class="visualInteractions-menu" localize-tooltip="ReportAppBar_VisualInteractionsTooltip" role="menuitem" ng-click="$ctrl.showMenu($event, $ctrl.getVisualInteractionsMenuProperties)"><i class="glyphicon pbi-glyph-visualsinteraction glyph-small"></i><span localize="ReportAppBar_VisualInteractionsButton"></span><i class="glyphicon pbi-glyph-chevrondownmedium glyph-mini"></i></button></li><li ng-if="$ctrl.viewModeState.getMode() === 1"> <button ng-click="$ctrl.refresh()" class="refresh" localize-tooltip="ReportAppBar_RefreshButton"><i class="glyphicon pbi-glyph-refresh glyph-mini" aria-hidden="true"></i><span localize="ReportAppBar_RefreshButton"></span></button></li><li ng-if="$ctrl.canDuplicatePage()"> <button ng-click="$ctrl.duplicateReportPage()" localize-tooltip="ReportAppBar_duplicateButton_Text" class="duplicate"><i class="glyphicon pbi-glyph-chromerestore glyph-small" aria-hidden="true"></i><span localize="ReportAppBar_duplicateButton_Text"></span></button></li><li ng-if="$ctrl.canSaveReport()"> <button ng-click="$ctrl.saveFromButton()" localize-tooltip="ReportAppBar_SaveToDashboardDescription" class="save"><i class="glyphicon pbi-glyph-save glyph-small" aria-hidden="true"></i><span localize="ReportAppBar_SaveReportButton"></span></button></li><li ng-if="$ctrl.viewModeState.getMode() === 1 && $ctrl.showPinPage() && $ctrl.canPinPage()"> <button localize-tooltip="ReportAppBar_PinPage" class="pin-report" ng-click="$ctrl.showPinReportPageDialog()"><i class="glyphicon pbi-glyph-pinned glyph-small"></i><span localize="ReportAppBar_PinPage"></span></button></li><li ng-if="$ctrl.showPinPage() && $ctrl.pinPageDisabled()"> <button localize-tooltip="PinTile_NotSupportedTitle" class="pin-disabled" disabled><i class="glyphicon pbi-glyph-pinned glyph-small"></i><span localize="ReportAppBar_PinPage"></span></button></li><li ng-if="$ctrl.canPause && !$ctrl.viewModeState.getConfig().pauseQueryExecution"> <button class="pause" localize-tooltip="ReportAppBar_PauseQueries" ng-click="$ctrl.togglePlayPause()"><span localize="ReportAppBar_PauseQueries"></span></button></li><li ng-if="$ctrl.canPause && $ctrl.viewModeState.getConfig().pauseQueryExecution"> <button class="play" localize-tooltip="ReportAppBar_ResumeQueries" ng-click="$ctrl.togglePlayPause()"><span localize="ReportAppBar_ResumeQueries"></span></button></li><li ng-if="$ctrl.isResetUserStateVisible()"> <button class="resetUserState" localize-tooltip="{{$ctrl.getUserStateTooltip()}}" dynamic-tooltip-update ng-click="$ctrl.resetUserState()" ng-disabled="$ctrl.isResetUserStateDisabled()"><i class="glyphicon pbi-glyph-undo glyph-mini"></i><span localize="Reset_To_Default"></span></button></li><li feature-switch="reportAnnotationsUI"> <button localize-tooltip="{{$ctrl.getCommentingTooltip()}}" dynamic-tooltip-update ng-click="$ctrl.expandCommentingPane()" ng-disabled="::!$ctrl.isCommentingEnabled()"><i class="glyphicon pbi-glyph-comment glyph-mini"></i><span localize="Comments"></span></button></li><li ng-if="$ctrl.viewModeState.getMode() === 0" feature-switch="personalBookmarksUI"> <button class="bookmarks-menu" localize-tooltip="ExplorationBookmarksPane_Title" ng-click="$ctrl.showMenu($event, $ctrl.getBookmarksMenuProperties)" role="menuitem"><i class="glyphicon pbi-glyph-bookmark glyph-small"></i><span localize="ExplorationBookmarksPane_Title"></span><i class="glyphicon pbi-glyph-chevrondownmedium glyph-mini"></i></button></li><li ng-if="$ctrl.canOpenUsageMetricsReport()"> <button localize-tooltip="UsageMetrics_Tooltip" ng-click="$ctrl.openUsageMetricsReport()" class="usageMetricsReport"><i class="glyphicon pbi-glyph-chart glyph-small"></i><span localize="UsageMetrics_Label"></span></button></li><li ng-if="$ctrl.isViewRelatedContentEnabled()"> <button class="related" localize-tooltip="DashboardAppBar_ViewRelated" ng-click="$ctrl.showRelatedContentPane()"><i class="glyphicon pbi-glyph-relationship glyph-small"></i><span localize="DashboardAppBar_ViewRelated"></span></button></li><li class="noMinWidth" ng-if="$ctrl.isReportFavoritesEnabled()"><favorite-menu view-model="::$ctrl.getReportModel()" show-labels="true"/></li><li ng-if="$ctrl.isEmailSubscriptionEnabled()"> <button class="subscription" localize-tooltip="ReportAppBar_Subscribe" ng-click="$ctrl.showSubscriptionPane()"><i class="glyphicon pbi-glyph-mail glyph-small"></i><span localize="ReportAppBar_Subscribe"></span></button></li><li ng-if="$ctrl.canShareReport()"> <button ng-click="$ctrl.showShareSlider()" class="shareReportButton" localize-tooltip="ReportAppBar_ShareButton"><i class="glyphicon pbi-glyph-share glyph-small"></i><span localize="ReportAppBar_ShareButton"></span></button></li><li class="moreOptionsItem" ng-if="$ctrl.showReportMoreOptionsMenu()"> <button class="moreOptionsDashboardButton glyphicon glyph-small pbi-glyph-more" ng-click="$ctrl.showMenu($event, $ctrl.getMoreOptionsMenuProperties)" localize-tooltip="Options_Menu" role="menuitem"></button></li></ul></div></div>'),
e.put("views/dropdowns/appBarMenu.html",'<dropdown-overlay dropdown-overlay-name="{{menuOverlayName}}"><ul class="angular-dropdown explorationAppBarMenu active" ng-class="{dark: getMode() === 0}" focus-trap role="menu"><li ng-repeat="item in getMenuActions()" ng-switch="::item.type" class="themeYellowDark"> <button ng-switch-when="0" class="dropdown-item {{menuItemClass}}" ng-click="menuActionSelected(item); $event.stopPropagation(); $event.preventDefault()" ng-disabled="item.disabled" ng-class="{\'selected\': item.checked}" aria-checked="{{!!item.checked }}" role="checkbox"><div class="dropdown-content {{::item.itemClass}}"><i class="glyphicon glyph {{::item.itemClass}}" ng-class="::{\'glyph-small\': glyphSmall}" title="{{::item.tooltip || item.text}}"></i><span class="dropdown-label" ng-bind="::item.text" title="{{::item.tooltip || item.text}}"></span><span ng-if="::item.description" class="dropdown-description" ng-bind="::item.description"></span><pbi-toggle ng-if="item.checkbox" ng-model="item.checked" ng-disabled="item.disabled" no-label on-state-text="ToggleSwitchOn" off-state-text="ToggleSwitchOff"></pbi-toggle></div></button><div ng-switch-when="1" ng-bind="::item.text"></div><div ng-switch-when="2" class="dropdown-separator" role="separator"></div><app-bar-flyout-menu ng-switch-when="3" flyout-item="item" menu-overlay-name="menuOverlayName" menu-item-class="menuItemClass" glyph-small="glyphSmall" get-mode="getMode()" menu-action-selected="menuActionSelected($item)"/><pbi-lazy-load ng-switch-when="4" [module-path]="item.lazyModulePath" [component-id]=\'item.lazyComponentId\'></pbi-lazy-load></li></ul></dropdown-overlay>'),e.put("views/explorationContainer.html",'<div class="explorationContainer explorationWithChrome themeableElement" ng-class="{\'editing\' : (viewModeState.getMode() === 1 || viewModeState.getMode() === 2),    \'reading\': viewModeState.getMode() === 0}" pbi-lazy-load-contents="jQueryUIConfig" prevent-focus-loss="false"><exploration-scoped-services-bridge><section class="appBar" ng-if="viewModel.options.showAppBar"><exploration-app-bar view-model="viewModel"></exploration-app-bar><app-action-menu ng-if="inAppArtifactView()"></app-action-menu></section><notification-bar></notification-bar><div class="explorationHost" ng-class="{ \'explorationHostNoAppBar\': !viewModel.options.showAppBar }"><exploration-host view-model="viewModel" id="pvExplorationHost"><flyout class="rightSidePane" ng-if="::isAnnotationsPaneVisible()" [lazy-load-path]="annotationsModulePath" [lazy-component-id]="\'ReportPaneComponentId\'"></flyout><div class="sidePane rightSidePane smallFontSize" pbi-lazy-load-contents="exploreUIShellConfig" ng-if="isMobileVisualizationPaneVisible()"><mobile-visualization-pane></mobile-visualization-pane></div><task-pane view-model="viewModel.taskPane" ng-if="isTaskPaneVisible()" keyboard-shortcuts="ctrl-F6" focus-nav-mode="Group" field-list-config="::fieldListConfig" ng-show="viewModel.options.showTaskPane" resizable resizable-containerid="pvExplorationHost" resizable-sibling="visualizationPane" resizable-expanded="{{viewModel.taskPane.isPaneExpanded}}" resizable-default-width="180" resizable-min-width="180" resizable-max-width="420" resizable-collapsed-width="32"></task-pane><visualization-pane view-model="viewModel.visualizationPane" ng-if="isVisualizationPaneVisible()" resizable resizable-containerid="pvExplorationHost" resizable-sibling="taskPane" resizable-expanded="{{viewModel.visualizationPane.isPaneExpanded}}" resizable-default-width="180" resizable-min-width="180" resizable-max-width="420" resizable-collapsed-width="32"></visualization-pane><div class="sidePane visualizationPane rightSidePane smallFontSize" ng-class="{ isCollapsed: !viewModel.bookmarksPane.isPaneExpanded }" ng-if="isBookmarksPaneVisible()" pbi-lazy-load-contents="exploreUIShellConfig" resizable resizable-containerid="pvExplorationHost" resizable-sibling="taskPane" resizable-expanded="{{viewModel.bookmarksPane.isPaneExpanded}}" resizable-default-width="180" resizable-min-width="180" resizable-max-width="420" resizable-collapsed-width="32"><bookmarks-pane view-model="viewModel.bookmarksPane" bookmarks="viewModel.exploration.contract.bookmarks" selected-bookmark="viewModel.exploration.contract.activeBookmark"></bookmarks-pane></div><div class="sidePane visualizationPane rightSidePane smallFontSize" ng-class="{ isCollapsed: !viewModel.syncGroupPane.isPaneExpanded }" ng-if="isSyncGroupPaneVisible()" pbi-lazy-load-contents="exploreUIShellConfig" resizable resizable-containerid="pvExplorationHost" resizable-sibling="taskPane" resizable-expanded="{{viewModel.syncGroupPane.isPaneExpanded}}" resizable-default-width="180" resizable-min-width="180" resizable-max-width="420" resizable-collapsed-width="32" feature-switch="slicerSyncing"><sync-group-pane exploration="viewModel.exploration" explore-canvas="viewModel.exploration.exploreCanvas" view-model="viewModel.syncGroupPane"></sync-group-pane></div><div class="sidePane visualizationPane rightSidePane smallFontSize" ng-class="{ isCollapsed: !viewModel.canvasItemsPane.isPaneExpanded }" ng-if="viewModel.canvasItemsPane.isPaneVisible" pbi-lazy-load-contents="exploreUIShellConfig" resizable resizable-containerid="pvExplorationHost" resizable-sibling="taskPane" resizable-expanded="{{viewModel.canvasItemsPane.isPaneExpanded}}" resizable-default-width="180" resizable-min-width="180" resizable-max-width="420" resizable-collapsed-width="32" feature-switch="canvasItemsPane"><canvas-items-pane view-model="viewModel.canvasItemsPane" explore-canvas="viewModel.exploration.exploreCanvas"></canvas-items-pane></div><div class="horizontalItemsContainer"><exploration view-model="viewModel.exploration" ng-class="{\'exploreCanvasToBottom\': !isFooterVisible()}" canvas-options="canvasOptions" should-set-focus="true"></exploration><exploration-footer ng-if="isFooterVisible()" view-model="viewModel"></exploration-footer></div></exploration-host></div><div class="explorationMask" ng-if="viewModel.showMask"><div class="centeredSpinner"><spinner></spinner></div></div><div class="canvasSpinnerBackground" ng-if="viewModel.showSpinner"><pbi-data-loader-spinner class="centered"></pbi-data-loader-spinner></div></exploration-scoped-services-bridge></div>')}]);var powerbi;!(function(e){var t;!(function(t){var i=e.explore.services.events,o=e.explore.dialogs.ExportDataDialogBuilder,r=e.common.dialogs.FeatureNotSupportedDialogBuilder,s=e.explore.util.VisualContainerUtils;t.ExportDataMixinFactory={ng:["auditing","featureSwitchService","licenseEnforcementService","localizationService","modalDialogService","optionsDialogBuilder","telemetryService","userInfo"],scoped:["dataSources","eventBridge","explorationCapabilities","exportData","lazyScopedSync"],fn:function(e){return new n(e)}};var n=(function(){function t(e){var t=this;this.services=e,this.unsubscribe=this.services.eventBridge.createChannelSubscriptionManager().subscribe(i.exportVisualData,(function(e,i){return t.exportVisualData(e,i)}))}return t.prototype.update=function(e){this.explorationContainer=e},t.prototype.destroy=function(){this.unsubscribe.unsubscribeAll()},t.prototype.exportVisualData=function(e,t){e.stopPropagation();var i=this.services,o=i.licenseEnforcementService;if(!o.supportsExportData||o.supportsExportData(!0)){var r=i.featureSwitchService.featureSwitches,s=i.explorationCapabilities.getCapabilities();r.exportVisualToExcelEnabled&&!s.disableExportToExcel?this.isVisualInSeeRecordsMode(t.visualConfig.query)?this.showOptionsDialog(t):this.showExportDataDialogFromVisual(t):this.exportVisualDataToFile(t,0,0)}},t.prototype.showExportDataDialogFromVisual=function(e){var t,i=this,r=new o(this.services.modalDialogService,this.services.localizationService),s=this.services.exportData.getExportDataToExcelUnsupportedType(e.visualConfig,this.explorationContainer.viewModel.datasetModel);0===s&&(t=this.services.lazyScopedSync("drillToDetails").getDetailsTableTargetMeasures(e.visualConfig));var n=this.explorationContainer.viewModel.exploration.contract.settings,a=n&&n.exportDataMode;r.show(s,_.some(t),a).then((function(o){o&&i.exportVisualDataToFile(e,o.format,o.dataType,t)}))},t.prototype.isVisualInSeeRecordsMode=function(e){return s.hasGroupByItems(e)},t.prototype.exportVisualDataToFile=function(t,i,o,r){var s,n=this.services.dataSources.get(),a=this.services,l=a.userInfo.isPremiumUser,c=a.telemetryService.startEvent(e.telemetry.EXExportVisualData,t.visualConfig.visualType,"Report",!1,i,l,this.isVisualInSeeRecordsMode(t.visualConfig.query),o),p=1===o;s=0===i?a.exportData.exportVisualDataToCsv(t.visualTitle,t.visualData,n,t.visualConfig,t.additionalFilters):a.exportData.exportVisualDataToExcel(t.visualTitle,n,t.visualConfig,t.additionalFilters,p,r),s.then((function(e){c.event.info.isPartialResult=e.isPartialResult,c.resolve()}),(function(e){c.reject({errorCode:e.error.toString()})})),this.services.auditing.auditEvent(this.explorationContainer.reportId,e.common.contracts.AuditEntityType.Report,e.common.contracts.AuditActivityType.exportReportTile)},t.prototype.showOptionsDialog=function(e){var t=this,i=[{name:this.services.localizationService.get("ModalDialog_ExportDataFormatXL"),action:function(){return 1===t.services.exportData.getExportDataToExcelUnsupportedType(e.visualConfig,t.explorationContainer.viewModel.datasetModel)?void new r(t.services.modalDialogService).show("ExlFormat_UnsupportedDatasetDialogTitle","ExlFormat_ToolTipDescription_AsOnPrem","https://go.microsoft.com/fwlink/?linkid=834313"):void t.exportVisualDataToFile(e,1,0)}},{name:this.services.localizationService.get("ModalDialog_ExportDataFormatCsv"),action:function(){t.exportVisualDataToFile(e,0,0)}}];this.services.optionsDialogBuilder.show(this.services.localizationService.get("ModalDialog_ExportDataTitle"),this.services.localizationService.get("ModalDialog_ExportDataText"),"exportDataDialog",i,this.services.localizationService.get("ModalDialogButtonText_Export"),this.services.localizationService.get("PBI_Button_Label_Cancel"))},t})()})(t=e.mixins||(e.mixins={}))})(powerbi||(powerbi={}));;"use strict";function showSignIn(e,r){reportEmbedController?reportEmbedController.showSignIn(e,r):(isShowSignInMessagePending=!0,tokenPassedFromView=e,reportIdPassedFromView=r)}function loadReport(e,r,t,o,i,s,n,a,l,c,d,p,u,m){setHideErrors(i);var v=jsCommon.QueryStringUtil.parseQueryString();if(!reportEmbedController)return void globalErrorService.error("Controller not initialized","Invalid setup");var h=reportEmbedController.getEmbedMessageProxyService();if(setAccessToken(r,l)){if(!e&&(e=v.reportId,jsCommon.StringExtensions.isNullOrUndefinedOrWhiteSpaceString(e)))return globalErrorService.error("reportId parameter is not valid","Invalid parameters"),void h.postErrorInvalidReportId();var g;"2"!==v.w&&(g=p||v.groupId),o||(o=v.pageName),t||(t=v.filter||v.$filter);var b=v.appId;return reportEmbedController.loadReport(e,g,t,void 0,o,i,s,n,a,c,d,u,m,b)}}function renderReport(e,r,t,o,i,s,n,a,l,c,d){setHideErrors(o);var p=jsCommon.QueryStringUtil.parseQueryString();if(!reportEmbedController)return void globalErrorService.error("Controller not initialized","Invalid setup");var u=reportEmbedController.getEmbedMessageProxyService();if(setAccessToken(r,a)){if(!e&&(e=p.reportId,jsCommon.StringExtensions.isNullOrUndefinedOrWhiteSpaceString(e)))return globalErrorService.error("reportId parameter is not valid","Invalid parameters"),void u.postErrorInvalidReportId();var m;return"2"!==p.w&&(m=c||p.groupId),t||(t=p.pageName),reportEmbedController.renderReport(e,m,t,o,i,n,l,d)}}function createReport(e,r,t,o,i,s){if(setHideErrors(t),setAccessToken(r,o)){if(!reportEmbedController)return void globalErrorService.error("Controller not initialized","Invalid setup");var n,a=jsCommon.QueryStringUtil.parseQueryString();return"2"!==a.w&&(n=i||a.groupId),reportEmbedController.createReport(e,t,n,s)}}function loadQna(e,r,t,o,i,s,n,a){if(setHideErrors(i),setAccessToken(r,s)){if(!reportEmbedController)return void globalErrorService.error("Controller not initialized","Invalid setup");var l,c=jsCommon.QueryStringUtil.parseQueryString();return"2"!==c.w&&(l=n||c.groupId),reportEmbedController.loadQna(e,t,o,i,l,a)}}function setAccessToken(e,r){var t=reportEmbedController.getEmbedMessageProxyService();if(e&&(window.powerBIAccessToken=e),jsCommon.StringExtensions.isNullOrUndefinedOrWhiteSpaceString(window.powerBIAccessToken))return globalErrorService.error("powerbiToken parameter not specified","Invalid parameters"),t.postErrorInvalidAccessToken(),!1;if(globalEmbedModeService.isAppTokenEmbed()){if(0===r)return!1;window.powerBIAppToken=e}else 1!==r||globalEmbedModeService.isAnonymousLiveEmbed()||(window.powerBIEmbedToken=e);return!0}function setHideErrors(e){e&&null!=e.hideErrors&&(globalErrorService.hideErrors=e.hideErrors)}var __awaiter=this&&this.__awaiter||function(e,r,t,o){return new(t||(t=Promise))(function(i,s){function n(e){try{l(o.next(e))}catch(e){s(e)}}function a(e){try{l(o.throw(e))}catch(e){s(e)}}function l(e){e.done?i(e.value):new t(function(r){r(e.value)}).then(n,a)}l((o=o.apply(e,r||[])).next())})},__generator=this&&this.__generator||function(e,r){function t(e){return function(r){return o([e,r])}}function o(t){if(i)throw new TypeError("Generator is already executing.");for(;l;)try{if(i=1,s&&(n=2&t[0]?s.return:t[0]?s.throw||((n=s.return)&&n.call(s),0):s.next)&&!(n=n.call(s,t[1])).done)return n;switch(s=0,n&&(t=[2&t[0],n.value]),t[0]){case 0:case 1:n=t;break;case 4:return l.label++,{value:t[1],done:!1};case 5:l.label++,s=t[1],t=[0];continue;case 7:t=l.ops.pop(),l.trys.pop();continue;default:if(n=l.trys,!(n=n.length>0&&n[n.length-1])&&(6===t[0]||2===t[0])){l=0;continue}if(3===t[0]&&(!n||t[1]>n[0]&&t[1]<n[3])){l.label=t[1];break}if(6===t[0]&&l.label<n[1]){l.label=n[1],n=t;break}if(n&&l.label<n[2]){l.label=n[2],l.ops.push(t);break}n[2]&&l.ops.pop(),l.trys.pop();continue}t=r.call(e,l)}catch(e){t=[6,e],s=0}finally{i=n=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}var i,s,n,a,l={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return a={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a},powerbi;!(function(e){var r;!(function(e){var r;!(function(e){var r;!(function(e){e.reportLoadUrl="/report/load",e.loadReport="loadReport",e.error="error",e.minimumReportDataRefreshIntervalInMinutes=1,e.defaultId="defaultId",e.PageFilterLevel="page",e.VisualFilterLevel="visual",e.reportPageLoaded="reportPageLoaded",e.reportRenderFinished="reportRenderFinished",e.modelsAndExplorationReadyEventName="modelsAndExplorationReady",e.conceptualSchemaReadyEventName="conceptualSchemaReady",e.showSocialSharingOverlayEventName="showSocialSharingOverlay",e.qnaVisualRendered="qnaVisualRendered",e.minimumRefreshTokenInterval=3e4,e.bufferTimeToCheckTokenExpiry=12e4;var r;!(function(e){e.POST="POST"})(r=e.HttpMethods||(e.HttpMethods={}));var t;!(function(e){e.anonymousEmbedFailedToInitialize="Anonymous embed error: Fail to initialize - Could not initialize report embed",e.anonymousEmbedFailedToParseObjectId="Anonymous embed error: Fail to load - Could not parse the reportObjectId from the searchBar.",e.applyBookmarkByNameAndStateIsInvalid="Cannot apply a bookmark when both a name and a state are provided",e.appTokenNotSupported="This feature is not supported for App Token embed.",e.bookmarkNotFound="Could not find bookmark",e.changeViewModeFailed="Could not change view mode",e.clearAllFiltersFailed="Could not clear all filters",e.commandFailed="Handling command failed",e.createReportFailed="Create report failed",e.failedGettingJsonFilterParser="Failed to get json filter parser",e.failedGettingSchema="Error: Could not get schema",e.failedToInitializeCreate="Fail to initialize - Could not initialize create report",e.filtersSerializationError="Could not serialize filters to json syntax.",e.getAvailableSizeFailed="Could not get available display area size",e.getAllPagesFailed="Could not get all pages",e.getAllVisualsFailed="Could not get all visuals",e.getFiltersFailed="Could not get filters",e.getReportFailed="Get report failed",e.insufficientPermissions="Could not load Edit mode: insufficient Permissions",e.interpretUtteranceAllowedInResultViewQnaModeOnly="Please enter Result View QnA mode for sending interpret requests",e.interpretUtteranceNonValidDatasetCollection="Requested datasets for interpret utterance through SDK must be a valid subset of initial datasets collection",e.interpretUtteranceFailed='Could not interpret "{0}"',e.invalidAccessToken="Invalid access token",e.invalidBookmarkRequest="Invalid bookmark request",e.invalidBookmarkState="Invalid bookmark state",e.invalidCloneVisualRequest="Invalid clone visual request",e.invalidFilter="Invalid filter definition",e.invalidSlicerRequest="Invalid slicer request",e.invalidIcon="Invalid control icon. only base64 image is allowed",e.invalidPageName="Invalid page name",e.invalidViewMode="Invalid view mode",e.invalidVisualName="Invalid visual name",e.invalidVisualSettings="Invalid visual settings",e.invalidVisualHeader="Invalid visual header",e.loadReportFailed="Could not load a report",e.missingReportId="Invalid or no ReportId",e.mobileLayoutNotFound='Warning: Mobile layout was not found for current page: "{0}", loading page in default layout',e.mobileLayoutPermissionNotSupported="These permissions are not supported with mobile layout",e.notInMobileMode="Warning: Not In Mobile Mode, loading page in default layout",e.operationIsSupportedOnlyForSlicers="Operation is only supported for visuals of type slicer",e.failedToParseObjectId="Fail to load - Could not parse the reportObjectId.",e.pageNotActive="Operation is allowed only on active page",e.pageNotFound='Could not find page "{0}"',e.phasedEmbedNotInitialized="Invalid operation - prepare report required prior to render",e.phasedEmbedIdMismatch="Report or group ID do not match loaded configuration",e.powerBIEntityNotFound="PowerBI entity not found",e.publishToWebNotSupported="This feature is not supported for Publish To Web.",e.qnaFailedToInitialize="Fail to initialize - Could not initialize qna embed",e.renderQnaVisualFailed='Could not render a qna visual for "{0}"',e.renderReportVisualFailed="{0}. Could not render a report visual titled: {1}",e.reportNotFound="Report not found",e.routeNotFound="Not Found. Url: {0} was not found.",e.saveExplorationFailed="Could not save report",e.saveReportNotAllowedInViewMode="Save report is not allowed in view mode",e.failedToInitialize="Fail to initialize - Could not initialize report embed",e.failedToResolveCluster="Fail to initialize - Could not resolve cluster",e.setFilterFailed="Could not set a filter",e.setPageFailed="Could not set a page",e.setSlicerIsNotSupported="Set slicer value is not supported",e.slicerFilterIsRequired="Slicer filter is required",e.slicerModeIsInvalid="Could not get slicer mode from persisted filter",e.slicerSerializationFailed="Failed to serialize slicer filters to json object",e.slicerSupportsOnlyOneFilter="Slicer supports only one filter",e.slicerTargetDoesNotMatch="Filters target doesn't match slicer target",e.tooManyRefreshRequests="Report refresh limit of one request every {0} seconds reached. Please try again later.",e.unsupportedVisuals="Unsupported visuals",e.updateSettingsFailed="Error occurred while updating settings.",e.visualContainerConfigIsNotInitialized="Visual container config is not initialized",e.visualNameIsMissingInSlicerSelector="Visual name is missing in slicer selector",e.visualNotFound='Could not find visual "{0}" in page "{1}"',e.featureNotSupported="Feature not supported"})(t=e.ErrorMessages||(e.ErrorMessages={}));var o;!(function(e){e.generalFailure="Export visual data has failed",e.generateDetailsTable="Error generating details table",e.generateFiltersDescription="Error handling filters",e.invalidRequest="Invalid export data request",e.noData="Visual has no data",e.notSupportedForVisual="Export data is not supported for this visual",e.queryError="Error running visual data query",e.schemaLoadingError="Error loading schema",e.columnNameCannotBeEmpty="Column name can not be empty"})(o=e.ExportDataErrorMessages||(e.ExportDataErrorMessages={}));var i;!(function(e){e.qnaVisualRendered="QnaVisualRendered",e.SwipeStart="swipeStart",e.SwipeEnd="swipeEnd"})(i=e.Events||(e.Events={}));var s;!(function(e){e.addBookmarkFailed="addBookmarkFailed",e.applyBookmarkFailed="applyBookmarkFailed",e.playBookmarkFailed="playBookmarkFailed",e.commandFailed="CommandFailed",e.createReportFailed="CreateReportFailed",e.exportDataFailed="ExportDataFailed",e.failedGettingJsonFilterParser="FailedGettingJsonFilterParser",e.failedGettingSchema="FailedGettingSchema",e.featureNotSupported="NotSupported",e.filterError="filterError",e.getAllPagesFailed="getAllPagesFailed",e.getDatasetFailed="GetDatasetFailed",e.getReportFailed="GetReportFailed",e.getSlicerFiltersFailed="getSlicerFiltersFailed",e.insufficientPermissions="insufficientPermissions",e.interpretQnaUtteranceFailed="InterpretQnaUtteranceFailed",e.interpretUtteranceFailed="interpretFailure",e.invalidAccessToken="InvalidAccessToken",e.invalidCloneVisualRequest="invalidCloneVisualRequest",e.invalidFilter="InvalidFilter",e.invalidSlicerRequest="invalidSlicerRequest",e.invalidReportObjectId="InvalidReprtObjectId",e.invalidVisualSettings="InvalidVisualSettings",e.invalidVisualHeader="InvalidVisualHeader",e.missingAccessToken="InvalidOrNoPowerBIAccessToken",e.missingReportId="InvalidOrNoReportId",e.missingViewMode="InvalidViewMode",e.mobileLayoutError="mobileLayoutError",e.notAuthorized="NotAuthorized",e.noExploration="noExploration",e.notFound="ReportNotFound",e.operationIsSupportedOnlyForSlicers="operationIsSupportedOnlyForSlicers",e.pageNotActive="pageNotActive",e.pageNotFound="pageNotFound",e.phasedEmbedError="phasedEmbedError",e.powerBIEntityNotFound="PowerBIEntityNotFound",e.qnaLoadFailed="LoadQnaFailed",e.qnaRenderFailed="QnaRenderFailed",e.reportLoadFailed="LoadReportFailed",e.reportRenderFailed="ReportRenderFailed",e.saveReportFailed="SaveReportFailed",e.saveReportNotSupported="SaveReportNotSupported",e.setPageFailed="SetPageFailed",e.slicerFilterIsRequired="slicerFilterIsRequired",e.slicerModeIsInvalid="slicerModeIsInvalid",e.slicerSerializationFailed="slicerSerializationFailed",e.slicerSupportsOnlyOneFilter="slicerSupportsOnlyOneFilter",e.slicerTargetDoesNotMatch="slicerTargetDoesNotMatch",e.updateSettingsFailed="updateSettingsFailed",e.visualConfigIsNotInitialized="visualConfigIsNotInitialized",e.visualIsNotASlicer="visualIsNotASlicer",e.visualizeQnaFailed="visualizeQnaFailed",e.visualNameIsMissing="visualNameIsMissing",e.visualNotFound="VisualNotFound"})(s=e.ErrorCodes||(e.ErrorCodes={}));var n;!(function(e){e.loadReportUIDMissingWarning="Warning: Received load report message that does not contain uid in request headers. Update your load message with the uid, otherwise emitted events will not contain uid associated with that report.",e.createReportUIDMissingWarning="Warning: Received create report message that does not contain uid in request headers. Update your create message with the uid, otherwise emitted events will not contain uid associated with that dataset.",e.loadQnaUIDMissingWarning="Warning: Received load qna message that does not contain uid in request headers. Update your load message with the uid, otherwise emitted events will not contain uid associated with that dataset."})(n=e.WarningMessages||(e.WarningMessages={}));var a;!(function(e){e.OK=200,e.Accepted=202,e.BadRequest=400,e.NotFound=404,e.TooManyRequests=429,e.InternalServerError=500})(a=e.StatusCodes||(e.StatusCodes={}));var l;!(function(e){e.Loading="#Loading#",e.Error="#Error#"})(l=e.ModelsAndExplorationState||(e.ModelsAndExplorationState={}));var c;!(function(e){e.Loading="#Loading#",e.Error="#Error#"})(c=e.ConceptualSchemaState||(e.ConceptualSchemaState={}));var d;!(function(e){e.maxWidthMobileUI=480,e.maxHeightMobileUI=338,e.maxSizeTabletUI=768})(d=e.CssStyles||(e.CssStyles={}));var p;!(function(e){e.refreshFrequencyInSeconds=15})(p=e.ThrottlingLimits||(e.ThrottlingLimits={}));var u;!(function(e){e.maxRowsLimit=3e4})(u=e.ExportDataLimits||(e.ExportDataLimits={}));var m;!(function(e){var r;!(function(e){e.QnA={EmbedResult:"embedQnaResult",Interactive:"embedQnaInteractive"}})(r=e.States||(e.States={}))})(m=e.Embed||(e.Embed={}));var v;!(function(e){e.VisualName="http://powerbi.com/product/schema#visualSelector",e.VisualType="http://powerbi.com/product/schema#visualTypeSelector"})(v=e.SelectorSchemas||(e.SelectorSchemas={}))})(r=e.constants||(e.constants={}))})(r=e.reportembed||(e.reportembed={}))})(r=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var r;!(function(r){var t;!(function(r){var t;!(function(t){var o=(function(){function t(e,t){this.scope=e,this.services=t,this.scope.inputControlDisabled=!this.services.$state.current.data.qnaInputControl,this.scope.questionBoxOutput={utterance:"",showPinButton:!1,interpretUtterance:null,updateUtteranceWithoutInterpret:null,clearQuestionBox:null},this.scope.showErrorMessage=!1;var o=r.createQnaExplorationCapabilities(this.services.embedModeService,this.scope.inputControlDisabled,this.services.reportEmbedState.currentSettings);this.scope.infoNavContainerOptions=o}return t.createOptions=function(){return{additionalServices:["$state","$window","embedModeService","localizationService","promiseFactory","reportEmbedState","lazy"],scopedDependencies:["lazyScoped"]}},t.prototype.$onInit=function(){return __awaiter(this,void 0,e.Promise,(function(){var e,r,t,o,i=this;return __generator(this,(function(s){switch(s.label){case 0:return[4,this.services.lazyScoped("qnaService")];case 1:return e=s.sent(),r=e.InputData,this.scope.models=r.models,this.scope.utterance=r.utterance,this.scope.getAdditionalODataFilter=r.getAdditionalODataFilter,this.scope.inputControlDisabled||_.isEmpty(this.scope.utterance)?this.scope.inputControlDisabled&&e.interpretUtterance():t=this.scope.$watch("questionBoxOutput.interpretUtterance",(function(e){e&&(e(i.scope.utterance),t())})),o={getInitialVisualState:function(){return i.scope.inputControlDisabled?3:4},onStateChanged:function(e,r){i.onStateChanged(r,e)},setInterpretListener:function(r){i.scope.infoNavContainerInterpretListener=r,e.setInterpretListener(r)},updateRenderedVisualUtteranceData:function(e){i.onQnaVisualDataRendered(e)}},this.scope.infoNavHostService=o,[2]}}))}))},t.prototype.onStateChanged=function(e,r){switch(e){case 2:this.onQnaVisualDataRendered(r,!0,r&&r.interpretResult&&r.interpretResult.error),this.scope.inputControlDisabled&&(this.scope.errorMessage=this.services.localizationService.get("ServerError_UnknownError"),this.scope.showErrorMessage=!0);break;case 3:this.scope.showErrorMessage&&(this.scope.errorMessage=void 0,this.scope.showErrorMessage=!1)}},t.prototype.getActiveUserQuestion=function(){return this.scope.inputControlDisabled?this.scope.utterance:this.scope.questionBoxOutput&&this.scope.questionBoxOutput.utterance},t.prototype.onQnaVisualDataRendered=function(e,t,o){var i=e&&e.configs&&!_.isEmpty(e.configs)&&e.configs[0];this.scope.utterance=e&&e.utterance;var s={utterance:e&&e.utterance,userQuestion:this.getActiveUserQuestion(),restatement:e&&e.restatement,visualType:i&&i.VisualizationType.toString(),queryDefinition:i&&i.Query,error:t?o?o:r.HostCommunicationHelper.buildInterpretUtteranceFailedError(this.getActiveUserQuestion()).message:void 0};this.lastQnaDataRenderedArgs&&this.lastQnaDataRenderedArgs.restatement===s.restatement||(this.lastQnaDataRenderedArgs=s,this.services.lazyScoped("qnaService").then((function(e){e.notifyQnaVisualRendered(s)})))},t})();t.QnaContainerController=o})(t=r.controllers||(r.controllers={}))})(t=r.reportembed||(r.reportembed={}))})(r=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var r;!(function(r){var t;!(function(r){var t;!(function(t){t.QnaContainer={templateUrl:"components/qnaContainer/qnaContainer.html",controller:e.common.createController(r.controllers.QnaContainerController)}})(t=r.components||(r.components={}))})(t=r.reportembed||(r.reportembed={}))})(r=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var r;!(function(e){var r;!(function(e){function r(e,r,t){var o=i(e,!0,!0);return o.embedded=!0,o.disableQnaInput=r,o.showVisualizationPane=!(!t||void 0===t.filterPaneEnabled)&&t.filterPaneEnabled,o.showTaskPane=!1,o}function t(e,r,t,i){var s=o(e,r,t,i);return s.showAppBar=!0,s}function o(e,r,t,o){return i(e,!s.hasFlag(t,r.Permissions.ReadWrite),!s.hasFlag(t,r.Permissions.Copy)&&!s.hasFlag(t,r.Permissions.Create),o)}function i(e,r,t,o){var i=n.parseQueryString(window.location.search),s="false"!==i.filterPaneEnabled,a="false"!==i.navContentPaneEnabled,l="true"===i.bookmarksPaneEnabled,c={};"true"===i.dynamicDisplayOption&&(c={displayOption:0});var d=!e.isSaasEmbed(),p=e.isAnonymousLiveEmbed(),u=!p&&s,m=!p&&a,v=p||!l||e.isAppTokenEmbed(),h=p,g=!p,b=p,y={showAppBar:!1,showTaskPane:!0,customVisualsAlwaysEnabled:h,showVisualizationPane:u,showNavContentPane:m,disableBookmarksPane:v,visualContainerOptions:{showMenu:g,showPin:!1,disablePin:!1,showContextMenu:!0},showBackButtonOnAppBar:!1,disableExport:b,disableLinguisticSchemaInitialization:!0,disableLogRTelemetry:!0,disableSaveOnKeyPress:!0,overrideSectionSize:c,disableExportToExcel:d,disableCacheUpdates:p,shouldUseMenuScrollbars:!0,disableExportToPowerPoint:!0,disableMoreOptions:!0,disableSnapshot:!0,disableSharePointEmbed:!0,disablePin:!0,disableQRGeneration:!0,disableSave:r,disableSaveAs:t,disablePrint:!0,disableDownload:!0,disableExploreActions:!1,disableSwitchMode:!0,overrideSaveRouting:!0,disableCustomVisualPluginActions:!0,disableViewRelatedContent:!0,qna:!p,allowVisualLinks:!0,allowPopouts:!0};return o?_.merge(y,o):y}var s=jsCommon.EnumExtensions,n=jsCommon.QueryStringUtil;e.createQnaExplorationCapabilities=r,e.createReportExplorationCapabilities=t,e.getEmbedCommonCapabilities=o})(r=e.reportembed||(e.reportembed={}))})(r=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var r;!(function(e){var r;!(function(e){var r=(function(){function e(){}return e.getSectionByName=function(e,r){return e?_.find(e.sections,(function(e){return e.name===r})):null},e.getPageIndexByName=function(e,r){return r&&r.sections?r.sections.map((function(e){return e.name})).indexOf(e):-1},e.isPageExists=function(r,t){return e.getPageIndexByName(r,t)>=0},e.isVisualExists=function(r,t,o){var i=e.getPageIndexByName(r,o);return!(i<0)&&o.sections[i].visualContainers.map((function(e){return e.name})).indexOf(t)>=0},e.getVisualContainerByName=function(e,r){return e?_.find(e.visualContainers,(function(e){return e.name===r})):null},e.getVisualContainerViewModel=function(e,r){if(!e)return null;var t=e.exploreCanvas.visualContainers.filter((function(e){return e.contract.name===r}));return _.isEmpty(t)?null:t[0]},e})();e.ExplorationHelper=r})(r=e.reportembed||(e.reportembed={}))})(r=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var r;!(function(r){var t;!(function(r){function t(e){return new c(e)}var o=e.explore.reportembed.constants.ErrorCodes,i=e.errorDetailsHelper,s=e.explore.reportembed.constants.ErrorMessages,n=e.explore.reportembed.constants,a=jsCommon.StringExtensions,l=jsCommon.TraceType;r.getHostCommunicationHelper=t;var c=(function(){function r(e){this.windowService=e}return r.buildErrorMessage=function(e){return{event:n.error,error:e}},r.prototype.postErrorMessageToParent=function(e){var r={event:n.error,error:e};this.windowService.parent.postMessage(JSON.stringify(r),"*")},r.prototype.postReportLoadMessageToParent=function(){var e={event:n.reportPageLoaded,error:""};this.windowService.parent.postMessage(JSON.stringify(e),"*")},r.prototype.postErrorLoadReportFailed=function(){this.postErrorMessageToParent(o.reportLoadFailed)},r.prepareEmbedTelemetryErrorDetails=function(e,r,t,o,s){var n,a,l=e?e:"";return r&&(n=i.getTelemetryErrorDetails(r,t),a=r.code),s&&(l+=" message: "+s),{errorSource:n?n.errorSource:"PowerBI",errorCode:a||o,httpStatusCode:t,errorMessage:l}},r.buildPageNotFoundErrorMessage=function(e){var t=a.format(s.pageNotFound,e);return r.createError(o.pageNotFound,t,{level:l.Error})},r.buildVisualNotFoundErrorMessage=function(e,r){return{message:a.format(s.visualNotFound,e,r)}},r.buildRenderedFailedError=function(e){return{message:e.code,detailedMessage:a.format(s.renderReportVisualFailed,e.message,e.target),technicalDetails:{requestId:e.details[0]}}},r.buildInterpretUtteranceFailedError=function(e,r){return{message:a.format(s.interpretUtteranceFailed,e),detailedMessage:r,errorCode:o.interpretUtteranceFailed}},r.buildNotSupportedByPublishToWebMessage=function(){return r.createError(o.featureNotSupported,s.publishToWebNotSupported,{level:l.Fatal})},r.buildNotSupportedByAppTokenEmbedMessage=function(){return r.createError(o.featureNotSupported,s.appTokenNotSupported,{level:l.Fatal})},r.buildErrorObjectFromResult=function(e,t,o,i){var s=e&&e.httpStatusCode,n=e&&e.error,a=e&&e.requestId,l=n&&n.code?n.code:t,c=n&&n.message?n.message:o,d={requestId:a,statusCode:s?s.toString():void 0,level:i};return r.createError(l,c,d)},r.createError=function(e,r,t,o){return{message:e,detailedMessage:r,errorCode:t&&t.statusCode,level:t&&t.level,technicalDetails:{requestId:t&&t.requestId,errorInfo:o}}},r.buildIErrorFromConceptualSchemaError=function(t){var i;if(t&&t.serviceError)i=e.helpers.PowerBIServiceExceptionErrorHelper.GetErrorDetailsFromServiceError(t.serviceError,t.requestId);else{if(!t||!t.clientError)return r.createError(o.failedGettingSchema,s.failedGettingSchema,{level:l.Error});i=e.helpers.PowerBIServiceExceptionErrorHelper.GetErrorDetailsFromClientError(t.clientError)}i.then((function(e){var r=[];return e&&e.displayableErrorInfo&&(r=_.map(e.displayableErrorInfo,(function(e){return{key:e.errorInfoKey,value:e.errorInfoValue}}))),{message:o.failedGettingSchema,detailedMessage:e.message?e.message:s.failedGettingSchema,level:l.Error,technicalDetails:{requestId:t&&t.requestId,errorInfo:r}}}))},r})();r.HostCommunicationHelper=c})(t=r.reportembed||(r.reportembed={}))})(r=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var r;!(function(r){var t;!(function(r){var t=e.explore.reportembed.constants,o=(function(){function r(){}return r.createJsonFilterParser=function(r,o,i){return __awaiter(this,void 0,e.Promise,(function(){var e,s,n;return __generator(this,(function(a){switch(a.label){case 0:return[4,o.require({javascript:"JSONFilter/services/jsonFilterParser"})];case 1:return e=a.sent(),[4,e.create(r,o,i)];case 2:if(s=a.sent(),!s)throw n={message:t.ErrorCodes.failedGettingJsonFilterParser,detailedMessage:t.ErrorMessages.failedGettingJsonFilterParser};return[2,s]}}))}))},r})();r.JsonFilterHelper=o})(t=r.reportembed||(r.reportembed={}))})(r=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var r;!(function(r){var t;!(function(r){var t=e.explore.reportembed.constants.SelectorSchemas,o=(function(){function e(){}return e.match=function(e,r){if(!r)return!0;var o=_.cloneDeep(r);return o.$schema=o.$schema||t.VisualName,this.isVisualTypeSelector(o)?e.config.singleVisual.visualType===o.visualType:!!this.isVisualNameSelector(o)&&e.name===o.visualName},e.isVisualTypeSelector=function(e){return e.$schema===t.VisualType},e.isVisualNameSelector=function(e){return e.$schema===t.VisualName},e})();r.SelectorsHelper=o})(t=r.reportembed||(r.reportembed={}))})(r=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var r;!(function(r){var t;!(function(r){var t;!(function(r){var t=e.helpers.ClusterLocationHelper,o="https://go.microsoft.com/fwlink/?LinkID=620319",i="https://go.microsoft.com/fwlink/?LinkID=722383&clcid=0x409",s=(function(){function r(r,t,o){void 0===o&&(o=navigator.userAgent);var i=this;this.scope=r,this.services=t,this.userAgent=o,this.scope.isAnonymousLiveEmbed=t.embedModeService.isAnonymousLiveEmbed(),this.scope.showAboutDialog=function(){return i.showAboutDialog()},this.scope.useTitleForAnchor=function(){return i.useTitleForAnchor()},this.scope.showFlag=this.scope.isAnonymousLiveEmbed,this.scope.showFullScreen=this.scope.isAnonymousLiveEmbed,this.setEmailLink(),this.setPowerBILink(),this.scope.toggleFullScreenMode=function(){var r=document;i.services.fullScreen.enterFullScreenSupported&&(r.fullscreenEnabled||r.webkitFullscreenEnabled||r.mozFullScreenEnabled||r.msFullscreenEnabled)&&(i.services.fullScreen.toggleFullScreen(),i.services.fullScreen.fullScreenMode&&i.services.telemetryService.logEvent(e.telemetry.ReportEmbedEnterFullScreen))},this.scope.isFullScreen=function(){return i.services.fullScreen.fullScreenMode},this.services.featureSwitchService.getFeatureSwitches().then((function(e){i.scope.socialSharingFeatureEnabled=i.scope.isAnonymousLiveEmbed&&e.socialSharingEnabled}))}return r.createOptions=function(){return{additionalServices:["embedModeService","errorService","localizationService","telemetryService","fullScreen","featureSwitchService"]}},r.prototype.showAboutDialog=function(){var r=this.services.errorService.control(),t=this.getFormattedDialogTemplate();if(e.build){var o=[new InJs.ModalDialogAction(this.services.localizationService.get("ReportEmbed_PrivacyPolicy"),function(e,r){window.open("https://go.microsoft.com/fwlink/?LinkId=248681","_blank")}),new InJs.ModalDialogAction(this.services.localizationService.get("ReportEmbed_Close"),function(e,t){r.hideDialog()})],i=t.replace("{{version}}",e.build);r.showCustomDialog(null,$(i),o,null,!0,!0,"","small")}},r.prototype.getFormattedDialogTemplate=function(){var e,o=this;return this.services.localizationService.ensureLocalization((function(){var i=new Date;if(e=jsCommon.StringExtensions.format(r.InnerAboutDialogTemplate,o.services.localizationService.get("TopNav_PowerBILogoTextNoPreview"),o.services.localizationService.format("PowerBI_Copyright_Text",[i.getFullYear().toString()]),o.services.localizationService.get("PowerBI_Build_Version_Text"),o.services.localizationService.get("AdditionalErrorInfo_ActivityIdText"),o.services.telemetryService.sessionId,o.services.localizationService.get("AdditionalErrorInfo_TimestampText"),i.toString()),!o.scope.isAnonymousLiveEmbed){var s=t.getClusterLocation(clusterUri,o.services.localizationService);e+=r.TemplateLocationString,e=jsCommon.StringExtensions.format(e,o.services.localizationService.get("AdditionalErrorInfo_DataLocationText"),s)}e+=r.TemplateClosingString})),e},r.prototype.setEmailLink=function(){var e=window.location.href;this.scope.linkToShare=e,this.scope.mailToLink="mailto:pbicontentconcern@microsoft.com?subject=Inappropriate%20Content&body=(Fill%20in%20the%20reason%20for%20your%20concern%20below)%0A%0APower%20BI%20Team%2C%0AI%20am%20reporting%20a%20concern%20with%20content%20linked%20below.%0A%0A%3CProvide%20your%20reason%3E%0A%0AURL%20to%20embedded%20content%3A%0A%7B%7BembedUrl%7D%7D%0A%0A---------------------%0AWe%20aim%20to%20review%20all%20concerns%20within%2048%20hours.%20We%20will%20contact%20you%20if%20we%20have%20additional%20questions%20related%20to%20your%20concern.".replace("%7B%7BembedUrl%7D%7D",encodeURIComponent(e))},r.prototype.setPowerBILink=function(){this.scope.isAnonymousLiveEmbed?this.scope.powerbiLink=i:this.scope.powerbiLink=o},r.prototype.useTitleForAnchor=function(){return this.userAgent.toLowerCase().indexOf(" edge/")>-1},r.InnerAboutDialogTemplate='<div class="aboutDialog"><div class="dialogIcon"><i class= "glyphicon pbi-glyph-powerbi icon"> </i></div><div class="info"><div class="title">{0}</div><div class="copyright">&copy;{1}</div><span class="field">{2}</span><span class="value">{{version}}</span><br><span class="field">{3}</span><span class="value">{4}</span><br><span class="field">{5}</span><span class="value">{6}</span>',r.TemplateLocationString='<br><span class="field">{0}</span><span class="value">{1}</span>',r.TemplateClosingString="</div></div>",r})();r.LogoBarController=s})(t=r.controllers||(r.controllers={}))})(t=r.reportembed||(r.reportembed={}))})(r=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var r;!(function(r){var t;!(function(t){var o;!(function(t){var o=jsCommon.BrowserUtils,i=e.explore.services.events,s=(function(){function t(r,t){var o=this;this.scope=r,this.services=t,this.scope.showOverlay=!1,this.scope.currentPageNumber=0,this.scope.isRtl=this.isRtlLayout(),this.scope.toggleOverlay=function(){return o.toggleOverlay()},this.scope.navigationPreviousPage=function(){return o.navigationPreviousPage()},this.scope.navigationNextPage=function(){return o.navigationNextPage()},this.scope.goToSection=function(e){return o.goToSection(e)},this.services.featureSwitchService.getFeatureSwitches().then((function(e){o.scope.socialSharingFeatureEnabled=t.embedModeService.isAnonymousLiveEmbed()&&e.socialSharingEnabled})),this.scope.chevronRightArrowClass=function(){return o.chevronRightArrowClass()},this.scope.chevronLeftArrowClass=function(){return o.chevronLeftArrowClass()},this.scope.navigateTo=function(e){return o.navigateTo(e)},this.scope.leftPageNumber=function(){return o.leftPageNumber()},this.scope.rightPageNumber=function(){return o.rightPageNumber()},r.reportEmbedExplorationService=this.services.reportEmbedExplorationService,r.$watch("reportEmbedExplorationService.exploration.sections",(function(e){if(_.isArray(e)){o.allSections=e;var t=_.filter(e,(function(e){return!(1&e.visibility)}));r.allPagesCount=t.length,r.sections=t}})),r.$watch("reportEmbedExplorationService.exploration.activeSectionIndex",(function(e){if(_.isNumber(e)){var t=o.allSections[e];r.currentPageNumber=_.findIndex(o.scope.sections,(function(e){return e.name===t.name}))}}));var i=r.$on(e.explore.reportembed.constants.showSocialSharingOverlayEventName,(function(e,r){o.setHidePageNavigationFlyout(r)}));r.$on(e.common.constants.scopeDestroyEventName,(function(){i(),o.subscriptionManager&&o.subscriptionManager.unsubscribeAll()}))}return t.createOptions=function(){return{additionalServices:["reportEmbedExplorationService","embedModeService","featureSwitchService","explorationContainerScopedServices"]}},
t.prototype.setHidePageNavigationFlyout=function(e){this.scope.hidePageNavigationFlyout=e},t.prototype.toggleOverlay=function(){this.showPageNavigation()&&(this.scope.showOverlay=!this.scope.showOverlay)},t.prototype.navigationPreviousPage=function(){this.ensureSectionChangedHandler();var r=this.scope.currentPageNumber;(r>0||r===-1)&&this.scope.$emit(e.explore.constants.explorationPreviousPageEvent)},t.prototype.navigationNextPage=function(){this.ensureSectionChangedHandler(),this.scope.currentPageNumber<this.scope.allPagesCount-1&&this.scope.$emit(e.explore.constants.explorationNextPageEvent)},t.prototype.goToSection=function(e){if(this.ensureSectionChangedHandler(),e){var t=e.name,o=_.findIndex(this.allSections,(function(e){return e.name===t}));this.scope.$emit(r.constants.switchSectionEvent,o),this.toggleOverlay()}},t.prototype.showPageNavigation=function(){return this.scope.allPagesCount>1||this.scope.isSmallScreen},t.prototype.ensureSectionChangedHandler=function(){var e=this;this.subscriptionManager||(this.subscriptionManager=this.services.explorationContainerScopedServices.getEventBridge().createChannelSubscriptionManager().subscribe(i.sectionChanged,(function(r,t){return e.updateSectionIndex(t)})))},t.prototype.updateSectionIndex=function(r){var t=this.scope.reportEmbedExplorationService.exploration,o=e.explore.SectionUtils.findSectionIndexForSectionName(t,r.name);!_.isNumber(o)||o&&t&&t.sections&&t.sections[o].transient||(t.activeSectionIndex=o)},t.prototype.isRtlLayout=function(){var e=o.getLanguage(),r=Globalize.cultures[e];return r=r?r:Globalize.cultures[Globalize.cultures.default.name],!!r&&r.isRTL},t.prototype.chevronRightArrowClass=function(){return this.scope.isRtl?0===this.scope.currentPageNumber?"inactive":"active":this.scope.currentPageNumber===this.scope.allPagesCount-1?"inactive":"active"},t.prototype.chevronLeftArrowClass=function(){return this.scope.isRtl?this.scope.currentPageNumber===this.scope.allPagesCount-1?"inactive":"active":0===this.scope.currentPageNumber?"inactive":"active"},t.prototype.navigateTo=function(e){"left"===e?this.scope.isRtl?this.scope.navigationNextPage():this.scope.navigationPreviousPage():this.scope.isRtl?this.scope.navigationPreviousPage():this.scope.navigationNextPage()},t.prototype.leftPageNumber=function(){return this.scope.isRtl?this.scope.allPagesCount:this.scope.currentPageNumber+1},t.prototype.rightPageNumber=function(){return this.scope.isRtl?this.scope.currentPageNumber+1:this.scope.allPagesCount},t})();t.LogoBarNavigationController=s})(o=t.controllers||(t.controllers={}))})(t=r.reportembed||(r.reportembed={}))})(r=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var r;!(function(r){var t;!(function(r){var t;!(function(r){var t="mailto:someone@example.com?subject=Sharing%20Power%20BI%20Report&body=Hi%2C%0D%0A%0D%0ATake%20a%20look%20at%20this%20Power%20BI%20report%20I%E2%80%99d%20like%20to%20share%20with%20you.%0D%0A%0D%0AURL%20to%20embedded%20content%3A%0D%0A%7B%7BembedUrl%7D%7D%0D%0A%0D%0A---------------------------%0D%0APowered%20by%20Power%20BI%20%0D%0Awww.powerbi.com",o=(function(){function r(e,r){var t=this;this.windowSpec="menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=450,width=600",this.scope=e,this.services=r,this.scope.reportEmbedExplorationService=this.services.reportEmbedExplorationService,this.scope.$watch("reportEmbedExplorationService.exploration.sections",(function(e){_.isArray(e)&&(t.sectionNames=e.map((function(e){return e.name})))})),this.scope.$watch("reportEmbedExplorationService.exploration.activeSectionIndex",(function(e){_.isNumber(e)&&(t.currentPageNumber=e||0,t.prepareShareLinks())})),this.scope.closeSocialSharing=function(){return t.closeSocialSharing()},this.scope.toggleSocialSharing=function(){return t.toggleSocialSharing()},this.scope.openUsingWindow=function(e){return t.openUsingWindow(e)},this.embedType=this.services.embedModeService.getEmbedTypeDescription(),this.embedUrl=this.services.embedModeService.getPublicEmbedUrl(),this.embedReferrer=this.services.embedModeService.getPublicEmbedReferrer()}return r.createOptions=function(){return{additionalServices:["reportEmbedExplorationService","$window","$document","$element","telemetryService","embedModeService"]}},r.prototype.toggleSocialSharing=function(){this.scope.socialSharingVisible=!this.scope.socialSharingVisible,this.scope.isSmallScreen&&this.emitSocialSharingOverlayEvent()},r.prototype.closeSocialSharing=function(){this.scope.socialSharingVisible=!1,this.scope.isSmallScreen&&this.emitSocialSharingOverlayEvent()},r.prototype.emitSocialSharingOverlayEvent=function(){this.scope.$emit(e.explore.reportembed.constants.showSocialSharingOverlayEventName,this.scope.socialSharingVisible)},r.prototype.prepareShareLinks=function(){this.setShareLink(),this.setSharingEmailLink()},r.prototype.setShareLink=function(){var e=this.getPageLink();this.scope.textShareLink=e,this.scope.shareLink=encodeURIComponent(e)},r.prototype.getPageLink=function(){var e=jsCommon.QueryStringUtil.parseQueryString(),r=e.shareUrl,t=this.embedReferrer;return t&&"false"!==r?t:this.getEmbedPageUrl(this.embedUrl)},r.prototype.getEmbedPageUrl=function(e){var r="";return this.sectionNames&&this.currentPageNumber<this.sectionNames.length&&(r="&pageName="+this.sectionNames[this.currentPageNumber]),e+r},r.prototype.setSharingEmailLink=function(){this.scope.socialSharingEmailLink=t.replace("%7B%7BembedUrl%7D%7D",this.scope.shareLink)},r.prototype.openUsingWindow=function(e){var r=e.currentTarget,t=r.href;this.logSocialSharingEvent(t),this.scope.isSmallScreen||(this.services.$window.open(r.href,"",this.windowSpec),e.stopPropagation(),e.preventDefault())},r.prototype.logSocialSharingEvent=function(r){var t=this.scope.reportEmbedExplorationService.exploration.report.objectId;this.services.telemetryService.logEvent(e.telemetry.ReportEmbedSocialSharing,r,t,this.embedType,this.embedUrl,this.embedReferrer)},r})();r.LogoBarSocialSharingController=o})(t=r.controllers||(r.controllers={}))})(t=r.reportembed||(r.reportembed={}))})(r=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var r;!(function(r){var t;!(function(t){var o;!(function(o){var i=e.common.contracts,s=jsCommon.EnumExtensions,n=e.explore.reportembed.constants.ErrorCodes,a=e.explore.reportembed.constants.ErrorMessages,l=e.explore.services.events,c=e.explore.util.PropertyPaneUtils,d=e.explore.reportembed.constants,p=i.reportServer.ReportInstantiationMode,u=jsCommon.TraceType,m=e.explore.viewModels,v=e.explore.util.VisualContainerUtils,h=e.common.events,g=e.explore.constants,b=e.explore.reportembed.SelectorsHelper,y=(function(){function o(r,o){var i=this;this.scope=r,this.services=o,this.scope.showErrorMessage=!1,this.scope.backgroundCssClass="",this.scope.promptForLogin=function(){return i.promptForLogin()},this.scope.optimizePublishToWeb=this.optimizePublishToWeb(),this.scope.clickToInteract=function(){return i.clickToInteract()},this.scope.isUserUnauthorized=!1,this.windowMessageHelper=t.getHostCommunicationHelper(this.services.windowService),this.scope.isAccessTokenExpired=!1,this.PowerBIModelsModule=this.services.moduleLoader.require({javascript:"powerbi-models"}),this.scope.$on(g.openReportFinished,(function(r,o,s){return __awaiter(i,void 0,e.Promise,(function(){var e,r=this;return __generator(this,(function(i){switch(i.label){case 0:return this.reportLoadedFired?[3,4]:(this.reportLoadedFired=!0,s?(this.getEmbedMessageProxyService().isEmbedMessageProxyServiceUsed()||this.windowMessageHelper.postErrorLoadReportFailed(),this.pageLoadedEvent&&(e=t.HostCommunicationHelper.prepareEmbedTelemetryErrorDetails(o),this.pageLoadedEvent.reject(e)),[3,4]):[3,1]);case 1:return this.isMobile?[4,this.setExploreConfiguration(!0,!0)]:[3,3];case 2:i.sent(),i.label=3;case 3:this.getEmbedMessageProxyService().isEmbedMessageProxyServiceUsed()||this.windowMessageHelper.postReportLoadMessageToParent(),this.pageLoadedEvent&&this.pageLoadedEvent.resolve(),this.services.embedModeService.isAnonymousLiveEmbed()&&this.reportEmbedState.refreshEnabled&&setInterval((function(){return r.refreshReportData()}),60*this.reportEmbedState.refreshIntervalInMinutes*1e3),i.label=4;case 4:return[2]}}))}))})),this.scope.canvasOptions={autoLayoutVisualPadding:0,scrollbarOffset:0,disableFocusOnExploreCanvas:!0},this.services.embedMessageProxyService.setupController(this)}return Object.defineProperty(o.prototype,"exploration",{get:function(){return this.scope.exploreContainer&&this.scope.exploreContainer.exploration?this.scope.exploreContainer.exploration.contract:this.reportEmbedState.baseExploration},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"currentSettings",{get:function(){return this.reportEmbedState.currentSettings},set:function(e){this.reportEmbedState.currentSettings=e},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"embedType",{get:function(){return this.services.embedModeService.getEmbedTypeDescription()},enumerable:!0,configurable:!0}),o.prototype.promptForLogin=function(){var e=jsCommon.QueryStringUtil.parseQueryString(window.location.search);return!_.isEmpty(e.autoAuth)&&(_.isEmpty(window.powerBIAccessToken)||this.scope.isAccessTokenExpired)},o.prototype.optimizePublishToWeb=function(){var e=jsCommon.QueryStringUtil.parseQueryString(window.location.search);return!_.isEmpty(e.optimizeReportLoading)},o.prototype.loadReport=function(r,o,i,s,l,c,d,p,m,v,h,g,b,y){return __awaiter(this,void 0,e.Promise,(function(){var f,S,E,C,I,w,P,x,M,R,F,T,L,A,k,_=this;return __generator(this,(function(D){switch(D.label){case 0:return this.reportEmbedState.loadReportCalled&&(window.conceptualSchemaPromise=null),this.reportEmbedState.loadReportCalled=!0,f=this,[4,this.PowerBIModelsModule];case 1:return f.PowerBIModels=D.sent(),this.setHideErrors(c),[4,this.validateOdataFilter(i)];case 2:if(S=D.sent(),E=this.services.embedModeService.isAnonymousLiveEmbed(),m===this.PowerBIModels.ViewMode.Edit){if(E)throw t.HostCommunicationHelper.buildNotSupportedByPublishToWebMessage();if(this.isMobile)throw this.services.embedMessageProxyService.postReportErrorEvent(t.HostCommunicationHelper.createError(n.insufficientPermissions,a.mobileLayoutPermissionNotSupported,{level:u.Fatal}));if(!p)throw this.showError(),this.services.embedMessageProxyService.postReportErrorEvent(t.HostCommunicationHelper.createError(n.insufficientPermissions,a.insufficientPermissions,{level:u.Fatal}))}I=!!window.modelsAndExplorationPromise,w=d&&d.length?d.length:0,P=g&&g.length?g.length:0,x=!!h,M=!!l,R=!!i,F=!(!c||!c.visualSettings);try{E&&(r=this.resolveReportIdForAnonymousEmbed(s))}catch(o){throw r="",this.showError(),this.fireLoadReportStartUpTelemetry(r),C=this.services.telemetryService.startEvent(e.telemetry.ReportEmbedLoadEmbeddedReport,I,w,P,x,M,v,m,F,R,b,r,this.embedType,this.embedUrl,this.embedReferrer),T=t.HostCommunicationHelper.prepareEmbedTelemetryErrorDetails(o.message),T.errorSource="User",C.reject(T),o}return this.reportEmbedState.reportObjectId=r,this.reportEmbedState.groupId=o,this.fireLoadReportStartUpTelemetry(r),C=this.services.telemetryService.startEvent(e.telemetry.ReportEmbedLoadEmbeddedReport,I,w,P,x,M,v,m,F,R,b,r,this.embedType,this.embedUrl,this.embedReferrer),this.renderReportCallback=void 0,this.reportLoadedFired=!1,this.reportEmbedState.pageName=l,this.reportEmbedState.bookmark=h,this.reportEmbedState.loadPowerViewReportEventEmitted=!1,this.reportEmbedState.isEditing=m===this.PowerBIModels.ViewMode.Edit,this.reportEmbedState.slicers=g,c=c||{},this.currentSettings={filterPaneEnabled:c.filterPaneEnabled||!1,navContentPaneEnabled:c.navContentPaneEnabled||!1,layoutType:c.layoutType||0,background:c.background||this.PowerBIModels.BackgroundType.Default,visualSettings:c.visualSettings},[4,this.createAndSetEmbedExplorationCapabilities(c,p)];case 3:return D.sent(),this.setExtensions(c),this.reportEmbedState.baseExploration=null,L=null,E?(this.scope.showLogoBar=!0,this.services.activeFolderIdService.activeFolderObjectId=o,L=this.loadReportForAnonymous(r),[3,10]):[3,4];case 4:return this.services.embedModeService.isAppTokenEmbed()?(this.scope.showLogoBar=!1,this.reportEmbedState.additionalODataFilter=S,this.reportEmbedState.additionalJsonFilters=d,this.services.activeFolderIdService.activeFolderObjectId=o,L=this.loadReportForAppToken(r,p,m),[3,10]):[3,5];case 5:this.reportEmbedState.additionalODataFilter=S,this.reportEmbedState.additionalJsonFilters=d,D.label=6;case 6:return D.trys.push([6,8,,9]),[4,this.initClusterUri()];case 7:return D.sent(),[3,9];case 8:throw A=D.sent(),k=this.createPropagatedErrors(A,a.failedToResolveCluster,n.reportLoadFailed,a.failedToResolveCluster,A&&A.error),C.reject(k.telemetryError),k.hostError;case 9:this.services.activeFolderIdService.activeFolderObjectId=o,L=this.initializeReportEmbed(r,a.failedToInitialize,p,m,c,v,y),D.label=10;case 10:return[2,new e.Promise(function(r,t){return __awaiter(_,void 0,e.Promise,(function(){var e;return __generator(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,L];case 1:return o.sent(),C.resolve(),r(null),[3,3];case 2:return e=o.sent(),C.reject(e.telemetryError),t(e.hostError),[3,3];case 3:return[2]}}))}))})]}}))}))},o.prototype.createReport=function(r,o,i,s){return __awaiter(this,void 0,e.Promise,(function(){var l,c,d,p,u,m,v,u,h,b,y=this;return __generator(this,(function(f){switch(f.label){case 0:if(this.setHideErrors(o),this.services.embedModeService.isAnonymousLiveEmbed())throw t.HostCommunicationHelper.buildNotSupportedByPublishToWebMessage();return this.reportEmbedState.loadPowerViewReportEventEmitted=!1,this.reportLoadedFired=!1,this.reportEmbedState.reportObjectId=this.reportEmbedState.baseExploration=null,l=this.services.telemetryService.startEvent(e.telemetry.ReportEmbedCreateReport,s,r,this.embedType,this.embedUrl,this.embedReferrer),c=this,[4,this.PowerBIModelsModule];case 1:c.PowerBIModels=f.sent(),f.label=2;case 2:return f.trys.push([2,4,,5]),[4,this.initClusterUri()];case 3:return f.sent(),[3,5];case 4:throw d=f.sent(),p=this.services.embedModeService.isAppTokenEmbed()?a.failedToResolveCluster:a.failedToResolveCluster,u=this.createPropagatedErrors(d,p,n.createReportFailed,null,d&&d.error),l.reject(u.telemetryError),u.hostError;case 5:this.services.activeFolderIdService.activeFolderObjectId=i,f.label=6;case 6:return f.trys.push([6,8,,9]),[4,this.services.reportEmbedModelService.getModel(r,l)];case 7:return m=f.sent(),[3,9];case 8:throw v=f.sent(),u=this.createPropagatedErrors(v,a.failedToInitializeCreate,n.getDatasetFailed,a.createReportFailed,v&&v.error),l.reject(u.telemetryError),u.hostError;case 9:return h=t.createReportExplorationCapabilities(this.services.embedModeService,this.PowerBIModels,this.PowerBIModels.Permissions.Create),this.scope.explorationContainerOptions=h,this.setExtensions(o),this.setCommandsSettings(this.exploration,o),this.reportEmbedState.isEditing=!0,this.reportEmbedState.useCustomSaveAsDialog=o&&o.useCustomSaveAsDialog,b=this.loadPowerViewForModel(m,o),[2,new e.Promise(function(r,t){return __awaiter(y,void 0,e.Promise,(function(){var e;return __generator(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,b];case 1:return o.sent(),l.resolve(),this.scope.$emit(g.openReportFinished),r(null),[3,3];case 2:return e=o.sent(),l.reject(e.telemetryError),t(e.hostError),[3,3];case 3:return[2]}}))}))})]}}))}))},o.prototype.loadQna=function(r,o,i,s,l,c){var d=this;if(this.setHideErrors(s),this.services.embedModeService.isAnonymousLiveEmbed())return this.services.promiseFactory.reject(t.HostCommunicationHelper.buildNotSupportedByPublishToWebMessage());if(this.services.embedModeService.isAppTokenEmbed())return this.services.promiseFactory.reject(t.HostCommunicationHelper.buildNotSupportedByAppTokenEmbedMessage());var p=r[0],u=this.services.promiseFactory.defer(),m=this.services.telemetryService.startEvent(e.telemetry.QnaEmbedLoadQna,i,c,p,this.embedType,this.embedUrl,this.embedReferrer);return this.reportEmbedState.currentSettings=s||this.reportEmbedState.currentSettings,this.PowerBIModelsModule.then((function(r){d.PowerBIModels=r;var t=d.isSaaSEmbedWithAADToken();return d.services.clusterResolverService.getClusterUrl(t).then((function(r){clusterUri=r.backendUrl,d.services.reportEmbedModelService.getModel(p,m).then((function(r){return __awaiter(d,void 0,e.Promise,(function(){var e,t,s=this;return __generator(this,(function(n){switch(n.label){case 0:return this.hideLoadingSplash(),e=i!==this.PowerBIModels.QnaMode.Interactive,t={models:[r],utterance:o,getAdditionalODataFilter:function(){return s.services.reportEmbedNavigationService.additionalODataFilter}},[4,this.loadInfoNavAndQnaService(t)];case 1:return n.sent(),this.services.reportEmbedNavigationService.showEmbedQna(!e),m.resolve(),u.resolve(null),[2]}}))}))}),(function(e){var r=d.createPropagatedErrors(e,a.qnaFailedToInitialize,n.qnaLoadFailed,n.getDatasetFailed,e&&e.error);m.reject(r.telemetryError),u.reject(r.hostError)}))}),(function(e){var r=d.createPropagatedErrors(e,a.failedToResolveCluster,n.qnaLoadFailed,null,e&&e.error);m.reject(r.telemetryError),u.reject(r.hostError)}))})),this.services.activeFolderIdService.activeFolderObjectId=l,u.promise},o.prototype.renderReport=function(r,o,i,s,l,c,d,p){return __awaiter(this,void 0,e.Promise,(function(){return __generator(this,(function(e){switch(e.label){case 0:if(!this.renderReportCallback)throw this.services.embedMessageProxyService.postReportErrorEvent(t.HostCommunicationHelper.createError(n.phasedEmbedError,a.phasedEmbedNotInitialized,{level:u.Fatal}));if(r!==this.reportEmbedState.reportObjectId||o!==this.reportEmbedState.groupId)throw this.services.embedMessageProxyService.postReportErrorEvent(t.HostCommunicationHelper.createError(n.phasedEmbedError,a.phasedEmbedIdMismatch,{level:u.Fatal}));return s?[4,this.updateSettings(s,!0)]:[3,2];case 1:e.sent(),e.label=2;case 2:return[4,this.renderReportCallback(i,d,s,l,c,p)];case 3:return e.sent(),[2]}}))}))},o.prototype.load=function(e,r,t,o){return loadReport(e.id,e.accessToken,t,e.pageName,e.settings,e.filters,e.permissions,e.viewMode,e.tokenType,r,e.bookmark,e.groupId,e.slicers,o)},o.prototype.create=function(e,r){return createReport(e.datasetId,e.accessToken,e.settings,e.tokenType,e.groupId,r)},o.prototype.loadQnaView=function(e,r){return loadQna(e.datasetIds,e.accessToken,e.question,e.viewMode,e.settings,e.tokenType,e.groupId,r)},o.prototype.render=function(e){return renderReport(e.id,e.accessToken,e.pageName,e.settings,e.filters,e.permissions,e.viewMode,e.tokenType,e.bookmark,e.groupId,e.slicers)},o.prototype.getPages=function(){var e=this;if(!this.exploration||!this.exploration.sections)return null;var r=this.exploration.activeSectionIndex;return this.exploration.sections.map((function(t,o){var i=c.getPageSizeTypeBySection(t.size,e.exploration,t);return{name:t.name,displayName:t.displayName,isActive:o===r,visibility:e.services.sdkModelsConverter.getSdkSectionVisibility(t.visibility),defaultDisplayOption:e.services.sdkModelsConverter.getSdkSectionDisplayOption(t.size.displayOption),defaultSize:{type:e.PowerBIModels.PageSizeType[i],width:t.size.width,height:t.size.height}}}))},o.prototype.setPage=function(o){return __awaiter(this,void 0,e.Promise,(function(){var i,s,l,c,d,p=this;return __generator(this,(function(m){switch(m.label){case 0:return this.exploration?[3,1]:(i=t.HostCommunicationHelper.createError(n.setPageFailed,a.setPageFailed,{level:u.Warning}),[3,8]);case 1:return s=t.ExplorationHelper.getPageIndexByName(o,this.exploration),s>=0?(this.reportEmbedState.pageName=o,this.isMobile&&this.reportEmbedState.isMobileLayout()?(c=void 0,[4,this.services.lazyScoped("reportEmbedMobileService")]):[3,7]):[3,8];case 2:return d=m.sent(),this.currentSettings.layoutType!==this.PowerBIModels.LayoutType.MobilePortrait?[3,4]:[4,d.hasPortraitLayout(this.exploration,this.exploration.sections[s])];case 3:return m.sent()?(l=1,c=this.PowerBIModels.LayoutType.MobilePortrait):(l=0,c=this.PowerBIModels.LayoutType.MobileLandscape),[3,5];case 4:c=this.PowerBIModels.LayoutType.MobileLandscape,m.label=5;case 5:return[4,d.setExploreConfiguration(this.PowerBIModels,c)];case 6:m.sent(),m.label=7;case 7:this.scope.$applyAsync((function(){p.scope.$emit(r.constants.switchSectionEvent,s,l)})),this.services.telemetryService.logEvent(e.telemetry.ReportEmbedSwitchPage,this.embedType,this.embedUrl,this.embedReferrer),m.label=8;case 8:return[2,i]}}))}))},o.prototype.getVisuals=function(e,r){var o=this;if(!this.exploration||!this.exploration.sections)return null;var i=t.ExplorationHelper.getSectionByName(this.exploration,e);return i?i.visualContainers.map((function(e,t){if(!e.config||!e.config.singleVisual)return{name:e.name,title:"",type:"",layout:null};var i=e.config.singleVisual,s=o.services.visualPlugin.capabilities(i.visualType),n=o.services.displayNameService.getTitleText(i,r,s),a=o.services.sdkModelsConverter.getSdkVisualLayout(e);return{name:e.name,title:n,type:i.visualType,layout:a}})):null},o.prototype.updateSettings=function(r,t){return __awaiter(this,void 0,e.Promise,(function(){var e,o,i,s,l,c;return __generator(this,(function(d){switch(d.label){case 0:return d.trys.push([0,5,,6]),this.setHideErrors(r),this.currentSettings.filterPaneEnabled=null!=r.filterPaneEnabled?r.filterPaneEnabled:this.currentSettings.filterPaneEnabled,this.currentSettings.navContentPaneEnabled=null!=r.navContentPaneEnabled?r.navContentPaneEnabled:this.currentSettings.navContentPaneEnabled,null!=r.hideErrors&&(this.services.errorService.hideErrors=r.hideErrors),this.isMobile&&null!=r.layoutType&&this.currentSettings.layoutType!==r.layoutType?(this.currentSettings.layoutType=r.layoutType,[4,this.setExploreConfiguration()]):[3,2];case 1:d.sent(),d.label=2;case 2:return[4,this.trySetVisualSettings(this.exploration,r,!0)];case 3:return d.sent(),[4,this.checkAndUpdateExplorationCapabilities(r,t)];case 4:return e=d.sent(),i=this.services.scopedServices.getExplorationCapabilities(),i&&i.setCapabilities(e),o=this.setExtensions(r),this.setCommandsSettings(this.exploration,r),s={filterPaneEnabled:e.showVisualizationPane,navContentPaneEnabled:e.showNavContentPane,bookmarksPaneEnabled:!e.disableBookmarksPane,extensions:o},[2,s];case 5:throw l=d.sent(),c={detailedMessage:a.updateSettingsFailed,message:n.updateSettingsFailed};case 6:return[2]}}))}))},o.prototype.setAccessToken=function(e,r){return setAccessToken(e,r)?null:t.HostCommunicationHelper.createError(n.invalidAccessToken,a.invalidAccessToken,{level:u.Fatal})},o.prototype.interpretQnaUtterance=function(e){return!this.services.reportEmbedNavigationService.inQnaView()||this.services.reportEmbedNavigationService.inInteractiveQnaView()?this.services.promiseFactory.reject(t.HostCommunicationHelper.createError(n.interpretUtteranceFailed,a.interpretUtteranceAllowedInResultViewQnaModeOnly,{level:u.Error})):this.interpretQnaUtteranceInternal(e)},o.prototype.visualizeQna=function(r){return __awaiter(this,void 0,e.Promise,(function(){var e;return __generator(this,(function(o){switch(o.label){case 0:return!this.services.reportEmbedNavigationService.inQnaView()||this.services.reportEmbedNavigationService.inInteractiveQnaView()?[2,this.services.promiseFactory.reject(t.HostCommunicationHelper.createError(n.visualizeQnaFailed,a.interpretUtteranceAllowedInResultViewQnaModeOnly,{level:u.Error}))]:[4,this.services.lazyScoped("qnaService")];case 1:return e=o.sent(),e.visualizeQna(r),[2]}}))}))},o.prototype.getEmbedMessageProxyService=function(){return this.services.embedMessageProxyService},o.prototype.hasLayout=function(r,t){return __awaiter(this,void 0,e.Promise,(function(){var e,o,i,s;return __generator(this,(function(n){switch(n.label){case 0:if(!r||null==t)return[2,!1];switch(e=this.PowerBIModels.LayoutType,o=t){case e.Master:return[3,1];case e.MobileLandscape:return[3,2];case e.Custom:return[3,3];case e.MobilePortrait:return[3,4]}return[3,6];case 1:return[2,!0];case 2:return[2,!0];case 3:return[2,this.currentSettings.layoutType===e.Custom];case 4:return i=this.getSectionByName(r),[4,this.services.lazyScoped("reportEmbedMobileService")];case 5:return s=n.sent(),[2,s.hasPortraitLayout(this.exploration,i)];case 6:return[2,!1]}}))}))},o.prototype.validateOdataFilter=function(r){return __awaiter(this,void 0,e.Promise,(function(){var e,t,o;return __generator(this,(function(i){switch(i.label){case 0:if(!r)return[3,4];i.label=1;case 1:return i.trys.push([1,3,,4]),[4,this.services.lazy("odataFilterParserService")];case 2:return e=i.sent(),t=e.tryGetFilters(r),_.isEmpty(t)&&this.services.embedMessageProxyService.postErrorInvalidFilter(),[3,4];case 3:return o=i.sent(),this.services.embedMessageProxyService.postErrorInvalidFilter(),[2,""];case 4:return[2,r]}}))}))},o.prototype.loadInfoNavAndQnaService=function(r){return __awaiter(this,void 0,e.Promise,(function(){var e;return __generator(this,(function(o){switch(o.label){case 0:return[4,this.services.pbiLazyLoad.load(t.modules.InfoNavBootstrapModule)];case 1:return o.sent(),[4,this.services.pbiLazyLoad.load(t.modules.QnaCoreModule)];case 2:return o.sent(),[4,this.services.pbiLazyLoad.load(t.modules.QnaWebModule)];case 3:return o.sent(),[4,this.services.lazyScoped("qnaService")];case 4:return e=o.sent(),e.InputData=r,[2]}}))}))},o.prototype.fireLoadingEventAndFlush=function(r){var t=this.services.telemetryService;t.logEvent(e.telemetry.ReportEmbedLoadingStarted,r,this.embedType,this.embedUrl,this.embedReferrer);var o=this.services.promiseFactory.defer();o.promise.then((function(){t&&t.flush()})),o.resolve(null)},o.prototype.loadReportForAnonymous=function(r){return __awaiter(this,void 0,e.Promise,(function(){var e;return __generator(this,(function(t){switch(t.label){case 0:if(jsCommon.StringExtensions.isNullOrUndefinedOrWhiteSpaceString(r))throw this.createPropagatedErrors(null,a.anonymousEmbedFailedToParseObjectId,n.reportLoadFailed,n.invalidReportObjectId);return[4,this.getClusterUriIfTenantIdExists(this.reportEmbedState.targetTenantId,clusterUri)];case 1:return e=t.sent(),clusterUri=o.getAPIMHostUrl(e),[4,this.initializeReportEmbed(r,a.anonymousEmbedFailedToInitialize)];case 2:return t.sent(),[2]}}))}))},o.prototype.resolveReportIdForAnonymousEmbed=function(r){var t,o=jsCommon.QueryStringUtil.parseQueryString(r);o.k?t=o.k:o.key&&(t=o.key);var i="",s=o.r;if(this.reportEmbedState.targetTenantId=void 0,s){var n=void 0;try{n=JSON.parse(atob(s))}catch(e){i=e}n&&(n.t&&(this.reportEmbedState.targetTenantId=n.t),n.k?t=n.k:i="Wrong format of encoded report - JSON object  doesn't contain a key")}if(this.reportEmbedState.setRefreshTime(o.refresh),jsCommon.StringExtensions.isNullOrUndefinedOrWhiteSpaceString(t))throw i=a.anonymousEmbedFailedToParseObjectId+i,this.services.telemetryService.logEvent(e.telemetry.ReportEmbedInvalidReportResourceKey,i),{message:i};return window.powerBIAccessToken=t,window.powerBIResourceKey=t,t},o.prototype.fireLoadReportStartUpTelemetry=function(r){if("number"==typeof window.viewLoadingStarted){var t=this.services.telemetryService.startEvent(e.telemetry.ReportEmbedScriptLoaded,r,this.embedType,this.embedUrl,this.embedReferrer);t.event.time=window.viewLoadingStarted,t.resolve(),this.pageLoadedEvent=this.services.telemetryService.startEvent(e.telemetry.ReportEmbedPageLoaded,r,this.embedType,this.embedUrl,this.embedReferrer),this.pageLoadedEvent.event.time=window.viewLoadingStarted}this.fireLoadingEventAndFlush(r)},o.prototype.loadReportForAppToken=function(r,t,o){return __awaiter(this,void 0,e.Promise,(function(){var e;return __generator(this,(function(i){switch(i.label){case 0:if(jsCommon.StringExtensions.isNullOrUndefinedOrWhiteSpaceString(r))throw this.createPropagatedErrors(null,a.failedToParseObjectId,n.reportLoadFailed,n.invalidReportObjectId);i.label=1;case 1:return i.trys.push([1,3,,4]),[4,this.initClusterUri()];case 2:return i.sent(),[3,4];case 3:throw e=i.sent(),this.createPropagatedErrors(e,a.failedToResolveCluster,n.reportLoadFailed,null,e&&e.error);case 4:return[4,this.initializeReportEmbed(r,a.failedToInitialize,t,o)];case 5:return i.sent(),[2]}}))}))},o.prototype.createPropagatedErrors=function(e,r,o,i,s){var n=e&&e.httpStatusCode,a=e&&e.error,l=t.HostCommunicationHelper.buildErrorObjectFromResult(e,o,i,u.Fatal),c=t.HostCommunicationHelper.prepareEmbedTelemetryErrorDetails(r,a,n,o,i);return this.services.embedMessageProxyService.postReportErrorEvent(l),this.showError(s),{hostError:l,telemetryError:c}},o.prototype.initializeReportEmbed=function(r,t,o,i,s,l,c){return __awaiter(this,void 0,e.Promise,(function(){var d,p,u,m;return __generator(this,(function(v){switch(v.label){case 0:this.services.embedModeService.isAnonymousLiveEmbed()||(this.scope.showLogoBar=!1),v.label=1;case 1:return v.trys.push([1,3,,9]),this.scope.optimizePublishToWeb?[2]:[4,this.services.reportEmbedExplorationService.getModelsAndExploration(r,!0)];case 2:return d=v.sent(),this.services.telemetryHostService.updateHostData(this.isSaaSEmbedWithAADToken()),this.services.telemetryService.restart(),[3,9];case 3:return p=v.sent(),u=p&&p.httpStatusCode,m=p&&p.error,401!==u||!this.isSaaSEmbedWithAADToken()&&!this.services.embedModeService.isSecurePublishToWeb()?[3,8]:m&&"PowerBINotAuthorizedException"===m.code?jsCommon.StringExtensions.isNullOrUndefinedOrWhiteSpaceString(c)?[4,this.pushAccess(r,t,p,o,i,s,p&&p.error)]:[3,5]:[3,7];case 4:return v.sent(),[2];case 5:return[4,this.tryInstallOrgApp(c,r,t,p,o,i,s)];case 6:return v.sent(),[2];case 7:if(this.reportEmbedState.groupId!==e.common.constants.myWorkspaceFolderId)return this.services.activeFolderIdService.activeFolderObjectId=e.common.constants.myWorkspaceFolderId,this.reportEmbedState.groupId=e.common.constants.myWorkspaceFolderId,this.reportEmbedState.shouldForceRefreshGroups=!1,this.initializeReportEmbed(r,t,o,i,s,l),[2];v.label=8;case 8:if(this.services.embedModeService.isSecurePublishToWeb())return this.redirectToRequestAccess(),[2];throw this.createPropagatedErrors(p,t,n.reportLoadFailed,a.getReportFailed,p&&p.error);case 9:return[4,this.loadPowerViewReport(d,o,i,s,l)];case 10:return v.sent(),[2]}}))}))},o.prototype.redirectToRequestAccess=function(){this.scope.isUserUnauthorized=!0},o.prototype.isSaaSEmbedWithAADToken=function(){return this.services.embedModeService.isSaasEmbed()&&void 0===window.powerBIEmbedToken},o.prototype.tryInstallOrgApp=function(r,t,o,i,s,l,c){return __awaiter(this,void 0,e.Promise,(function(){var e,d,p,u,m;return __generator(this,(function(v){switch(v.label){case 0:return v.trys.push([0,4,,5]),[4,this.services.lazyProviderModern.get("@powerbi/EmbedContentProvider/embed-content-provider.module#EmbedContentProviderModule","embedContentProviderService")];case 1:return d=v.sent(),[4,d.tryInstallOrgApp(r)];case 2:return v.sent(),[4,this.services.reportEmbedExplorationService.getModelsAndExploration(t,!1)];case 3:return e=v.sent(),[3,5];case 4:throw p=v.sent(),u=p&&p.detailedMessage?p.detailedMessage:a.getReportFailed,m=p&&p.message?p.message:n.reportLoadFailed,this.createPropagatedErrors(p,o,m,u,i&&i.error);case 5:return[4,this.loadPowerViewReport(e,s,l,c)];case 6:return v.sent(),[2]}}))}))},o.prototype.pushAccess=function(r,t,o,i,s,l,c){return __awaiter(this,void 0,e.Promise,(function(){var d,p,u,m,v,h,g,b,y,f,S,E,C=this;return __generator(this,(function(I){switch(I.label){case 0:return d=this.services.telemetryService.startEvent(e.telemetry.ReportEmbedPushAccess,null,null,r,this.embedType,this.embedUrl,this.embedReferrer),[4,this.services.moduleLoader.require({javascript:"PowerBIDialogs/components/progressDialog/progressDialogBuilder"})];case 1:p=I.sent(),u=p.createProgressDialogBuilder(this.services.modalDialogService,this.services.promiseFactory),m=u.show("RequestAccess","RequestAccess_CheckingPermissionsTitle","RequestAccess_CheckingPermissionsMessage",!0),v=!1,m.dialogClosedPromise.then((function(e){if(v=1===e){if(d.reject(),C.services.embedModeService.isSecurePublishToWeb())return;var r=o&&o.error&&c;throw C.createPropagatedErrors(o,t,n.reportLoadFailed,a.getReportFailed,r)}})),I.label=2;case 2:return I.trys.push([2,5,,6]),[4,this.services.lazy("pushAccessHttp")];
case 3:return g=I.sent(),[4,g.pushReportAccess(d.event,r,this.reportEmbedState.shouldForceRefreshGroups)];case 4:return b=I.sent(),h=b&&b.data&&b.data.hasAccess,d.event.info.hasAccess=!!h,[3,6];case 5:if(y=I.sent(),d.reject(),u.hide(m),this.services.embedModeService.isSecurePublishToWeb())return[2];throw this.createPropagatedErrors(y,t,n.reportLoadFailed,n.getReportFailed,o&&o.error);case 6:if(v)return[2];if(u.hide(m),!h){if(d.reject(),this.services.embedModeService.isSecurePublishToWeb())return this.redirectToRequestAccess(),[2];throw f=o&&o.error&&c,this.createPropagatedErrors(o,t,n.reportLoadFailed,a.getReportFailed,f)}I.label=7;case 7:return I.trys.push([7,9,,10]),[4,this.services.reportEmbedExplorationService.getModelsAndExploration(r,!1)];case 8:return S=I.sent(),d.event.info.modelsAndExplorationSucceed=!0,d.resolve(),[3,10];case 9:if(E=I.sent(),d.event.info.modelsAndExplorationSucceed=!1,d.reject(),this.services.embedModeService.isSecurePublishToWeb())return this.redirectToRequestAccess(),[2];throw this.createPropagatedErrors(E,t,n.reportLoadFailed,n.getReportFailed,o&&o.error);case 10:return[4,this.loadPowerViewReport(S,i,s,l)];case 11:return I.sent(),[2]}}))}))},o.prototype.loadPowerViewReport=function(r,t,o,i,s){return __awaiter(this,void 0,e.Promise,(function(){var n,a,l=this;return __generator(this,(function(c){switch(c.label){case 0:return this.scope.exploreContainer=m.ViewModelFactory.createExplorationContainer(),this.scope.exploreContainer.options=this.scope.explorationContainerOptions,this.reportEmbedState.baseExploration=r.exploration,this.reportEmbedState.model=this.createModel(r.models[0]),this.reportEmbedState.report.id=this.reportEmbedState.baseExploration.reportId,this.reportEmbedState.report.objectId=this.reportEmbedState.reportObjectId,this.reportEmbedState.report.permissions=this.services.sdkModelsConverter.getPermissions(t),this.reportEmbedState.baseExploration.report&&(this.reportEmbedState.report.permissions=this.reportEmbedState.report.permissions&this.reportEmbedState.baseExploration.report.permissions),r.package&&this.services.packageCollection.addPackage(this.services.modelConverter.convertPackage(r.package)),this.isMobile?[4,this.setExploreConfiguration(!1,!1,this.reportEmbedState.pageName)]:[3,2];case 1:a=c.sent(),n=a===this.PowerBIModels.LayoutType.MobilePortrait?1:void 0,c.label=2;case 2:return this.renderReportCallback=function(r,t,o,i,s,a){return __awaiter(l,void 0,e.Promise,(function(){var e,l=this;return __generator(this,(function(c){switch(c.label){case 0:return this.reportEmbedState.pageName=r,this.reportEmbedState.bookmark=t,this.reportEmbedState.isEditing=s===this.PowerBIModels.ViewMode.Edit,null!=a&&(this.reportEmbedState.slicers=a),this.reportEmbedState.additionalJsonFilters=i,[4,this.setCustomLayout(this.reportEmbedState.baseExploration,!0,o)];case 1:return c.sent(),[4,this.trySetVisualSettings(this.reportEmbedState.baseExploration,o)];case 2:return c.sent(),this.setReportContainer(this.reportEmbedState.report),e=s===this.PowerBIModels.ViewMode.Edit,this.services.$timeout((function(){return l.emitLoadPowerViewReportEvent(e?p.Exploration:p.None,n)}),0),[2]}}))}))},s?(this.scope.$emit(g.openReportFinished),[3,5]):[3,3];case 3:return[4,this.renderReportCallback(this.reportEmbedState.pageName,this.reportEmbedState.bookmark,i,this.reportEmbedState.additionalJsonFilters,o)];case 4:c.sent(),c.label=5;case 5:return[2]}}))}))},o.prototype.setCustomLayout=function(r,t,o){return __awaiter(this,void 0,e.Promise,(function(){var e;return __generator(this,(function(i){switch(i.label){case 0:return o&&o.layoutType&&o.layoutType===this.PowerBIModels.LayoutType.Custom?[4,this.customLayoutService]:[2];case 1:return e=i.sent(),[4,e.setCustomLayout(this.PowerBIModels,r,t,o)];case 2:return[2,i.sent()]}}))}))},o.prototype.trySetVisualSettings=function(r,t,o){return __awaiter(this,void 0,e.Promise,(function(){var e,i,s;return __generator(this,(function(n){switch(n.label){case 0:return r&&t&&t.visualSettings?[4,this.visualSettingsService]:[2];case 1:return e=n.sent(),i=e.applySettings(this.PowerBIModels,r,t),o&&(s=this.services.scopedServices.getEventBridge(),s&&v.notifyVisualContainers(s,i)),[2]}}))}))},o.prototype.loadPowerViewForModel=function(r,t){return __awaiter(this,void 0,e.Promise,(function(){var e=this;return __generator(this,(function(t){return this.scope.exploreContainer=m.ViewModelFactory.createExplorationContainer(),this.reportEmbedState.model=this.createModel(r,this.PowerBIModels.Permissions.Create),this.setReportContainer(this.reportEmbedState.model.contract,this.PowerBIModels.Permissions.Create),this.services.$timeout((function(){return e.emitLoadPowerViewReportEvent(p.Exploration)}),0),[2]}))}))},o.prototype.setReportContainer=function(e,r){var t=this.createReportModel(e,r);t.model=this.reportEmbedState.model,this.reportEmbedState.reportContainer=this.services.modelConverter.convertReportContainer(e),this.reportEmbedState.reportContainer.report=t},o.prototype.showError=function(e){if(!this.services.errorService.hideErrors){var r="https://go.microsoft.com/fwlink/?LinkID=722383&clcid=0x409",t="https://go.microsoft.com/fwlink/?linkid=860904",o="Content_Not_Available_Error_Message";if(e)switch(e.code){case"AppNotEnabled":o="ReportEmbed_Insufficient_Plan_Error_Message";break;case"UserNotLicensed":o="ReportEmbed_User_Not_Licensed_Error_Message";break;default:o="Content_Not_Available_Error_Message"}this.scope.errorLink=this.services.embedModeService.isAnonymousLiveEmbed()?r:t,this.scope.errorMessage=this.services.localizationService.get(o),this.scope.showErrorMessage=!0}this.hideLoadingSplash()},o.prototype.emitLoadPowerViewReportEvent=function(r,t){if(!this.reportEmbedState.loadPowerViewReportEventEmitted){this.shouldLoadCachedData()||(this.reportEmbedState.loadCachedData=!1);var o;if(this.reportEmbedState.baseExploration){var i=1!==this.reportEmbedState.report.permissions,s=this.services.telemetryService.startEvent(e.telemetry.ReportEmbedExplorationDeepCopy,i,this.reportEmbedState.reportObjectId,this.embedType,this.embedUrl,this.embedReferrer);if(i){var n={withData:this.reportEmbedState.loadCachedData,withQuery:!0,featureUsage:{}};o=this.services.explorationSerializer.deepCopyExploration(this.reportEmbedState.baseExploration,n),o.report=this.reportEmbedState.baseExploration.report}else o=this.reportEmbedState.baseExploration;s.resolve()}this.reportEmbedState.loadPowerViewReportEventEmitted=!0;var a={report:this.reportEmbedState.reportContainer.report,model:this.reportEmbedState.model,instantiationMode:r,exploration:o,additionalODataFilter:this.reportEmbedState.additionalODataFilter,reportPage:this.reportEmbedState.pageName,additionalJsonFilters:this.reportEmbedState.additionalJsonFilters,canvasLayout:t,bookmark:this.getApplyBookmarkRequest()};this.hideLoadingSplash(),this.scope.$emit(h.loadPowerViewReportEventName,a)}},o.prototype.getApplyBookmarkRequest=function(){var e=this.reportEmbedState.bookmark,r=this.reportEmbedState.bookmark;if(e||r){if(r&&r.state&&e&&e.name)return void this.services.embedMessageProxyService.postReportErrorEvent(t.HostCommunicationHelper.createError(n.applyBookmarkFailed,a.applyBookmarkByNameAndStateIsInvalid,{level:u.Warning}));if(r&&r.state)return this.services.sdkModelsConverter.getBookmarkFromBase64State(r.state);if(e&&e.name){if(_.isEmpty(this.exploration.bookmarks))return void this.services.embedMessageProxyService.postReportErrorEvent(t.HostCommunicationHelper.createError(n.applyBookmarkFailed,a.bookmarkNotFound,{level:u.Warning}));var o=this.exploration.bookmarks.map((function(e){return e.name})).indexOf(e.name);return o<0?void this.services.embedMessageProxyService.postReportErrorEvent(t.HostCommunicationHelper.createError(n.applyBookmarkFailed,a.bookmarkNotFound,{level:u.Warning})):this.exploration.bookmarks[o]}}},o.prototype.createModel=function(e,r){var t=this,o=this.services.modelConverter.convertModel(e);return null!=r&&(o.getPermissionsCallback=function(){var e=1;return(s.hasFlag(r,t.PowerBIModels.Permissions.Create)||s.hasFlag(r,t.PowerBIModels.Permissions.ReadWrite))&&(e|=3),s.hasFlag(r,t.PowerBIModels.Permissions.All)&&(e=7),e}),o},o.prototype.createReportModel=function(e,r){var t=this,o=this.services.modelConverter.convertReport(e);return r&&(this.reportEmbedState.report.permissions=this.services.sdkModelsConverter.getPermissions(r),o.getPermissionsCallback=function(){return t.reportEmbedState.report.permissions}),this.services.modelConverter.fillReport(o,e),o},o.prototype.hideLoadingSplash=function(){var e=angular.element("#pbi-loading");0!==e.length&&e.remove()},o.prototype.getClusterUriIfTenantIdExists=function(r,t){return __awaiter(this,void 0,e.Promise,(function(){return __generator(this,(function(e){return r?[2,this.getClusterUriForTenant(r,t)]:[2,t]}))}))},o.prototype.getClusterUriForTenant=function(r,t){return __awaiter(this,void 0,e.Promise,(function(){var e,i;return __generator(this,(function(s){switch(s.label){case 0:return e=o.getAPIMHostUrl(t),[4,this.services.clusterResolverService.getPublicClusterForTenant(r,e)];case 1:return i=s.sent(),[2,i.backendUrl]}}))}))},o.prototype.initClusterUri=function(){return __awaiter(this,void 0,e.Promise,(function(){var e,r;return __generator(this,(function(t){switch(t.label){case 0:return e=this.isSaaSEmbedWithAADToken(),[4,this.services.clusterResolverService.getClusterUrl(e)];case 1:return r=t.sent(),clusterUri=r.backendUrl,[2,clusterUri]}}))}))},o.getAPIMHostUrl=function(e){var r=jsCommon.Utility.getProtocolFromUrl(e),t=jsCommon.Utility.getHostNameForUrl(e),o=t.split(".");return o[0]=o[0].replace("-redirect",""),o[0]=o[0].replace("global-",""),o[0]=o[0]+"-api",r+"://"+o.join(".")},o.prototype.refreshReportData=function(){this.scope.$emit(h.refreshReportData)},o.prototype.getPageByName=function(e){var r,t=this.exploration&&this.exploration.sections?this.exploration.sections.filter((function(r){return r.name===e})):null;return t&&t.length>0&&(r={name:t[0].name,displayName:t[0].displayName}),r},o.prototype.createAndSetEmbedExplorationCapabilities=function(r,o){return __awaiter(this,void 0,e.Promise,(function(){var e;return __generator(this,(function(i){switch(i.label){case 0:return e=t.getEmbedCommonCapabilities(this.services.embedModeService,this.PowerBIModels,o),r?[4,this.checkAndUpdateExplorationCapabilities(r,!0,e)]:[3,2];case 1:return e=i.sent(),this.reportEmbedState.useCustomSaveAsDialog=r.useCustomSaveAsDialog,[3,3];case 2:this.scope.explorationContainerOptions=e,this.scope.exploreContainer&&_.merge(this.scope.exploreContainer.options,e),i.label=3;case 3:return[2,e]}}))}))},o.prototype.setExtensions=function(e){return e&&e.extensions?(this.services.explorationExtensibilityService.setExtensions(e.extensions),e.extensions):null},o.prototype.setCommandsSettings=function(r,t){if(r&&t&&t.commands){for(var o=this.services.telemetryService.startEvent(e.telemetry.ReportEmbedCommandsSettings,this.reportEmbedState.reportObjectId,this.embedType,this.embedUrl,this.embedReferrer),i=0,s=r.sections;i<s.length;i++)for(var n=s[i],a=0,l=n.visualContainers;a<l.length;a++)for(var c=l[a],d=0,p=t.commands;d<p.length;d++){var u=p[d];for(var m in u){var v=u[m];b.match(c,v.selector)&&this.services.explorationExtensibilityService.setCommandDisplayOption(c.name,m,this.getCommandDisplayOption(v.displayOption))}}o.resolve()}},o.prototype.getCommandDisplayOption=function(e){switch(e){case this.PowerBIModels.CommandDisplayOption.Disabled:return 1;case this.PowerBIModels.CommandDisplayOption.Hidden:return 2;default:return 0}},o.prototype.checkAndUpdateExplorationCapabilities=function(r,t,o){return __awaiter(this,void 0,e.Promise,(function(){var e,i,s,n,a,c;return __generator(this,(function(d){switch(d.label){case 0:return r?(this.reportEmbedState.isEditing&&(r.filterPaneEnabled=!0,r.navContentPaneEnabled=!0),e=o?o:this.scope.exploreContainer.options||this.scope.explorationContainerOptions,r.layoutType!==this.PowerBIModels.LayoutType.MobilePortrait&&r.layoutType!==this.PowerBIModels.LayoutType.MobileLandscape?[3,2]:[4,this.services.lazyScoped("reportEmbedMobileService")]):[2,null];case 1:i=d.sent(),e=i.getExploreCapabilityOptions(this.PowerBIModels,e,r.layoutType),d.label=2;case 2:return e.showVisualizationPane=void 0!==r.filterPaneEnabled?r.filterPaneEnabled:e.showVisualizationPane,e.showNavContentPane=void 0!==r.navContentPaneEnabled?r.navContentPaneEnabled:e.showNavContentPane,e.disableBookmarksPane=void 0!==r.bookmarksPaneEnabled?!r.bookmarksPaneEnabled:e.disableBookmarksPane,e.showAppBar=this.reportEmbedState.isEditing,s=this.exploration,r.customLayout?s?[4,this.setCustomLayout(s,t,r)]:[3,4]:[3,6];case 3:d.sent(),d.label=4;case 4:return r.layoutType!==this.PowerBIModels.LayoutType.Custom?[3,6]:[4,this.customLayoutService];case 5:n=d.sent(),a=n.getSectionSize(this.PowerBIModels,r.customLayout),a&&(e.overrideSectionSize=e.overrideSectionSize||{},_.merge(e.overrideSectionSize,a),s&&_.defaults(e.overrideSectionSize,s.sections[s.activeSectionIndex].size)),e.overrideSectionSize&&!t&&(c=this.services.scopedServices.getEventBridge(),c.publishToChannel(l.canvasDisplayChanged,e.overrideSectionSize.displayOption),c.publishToChannel(l.canvasDimensionChanged,e.overrideSectionSize)),d.label=6;case 6:return this.scope.explorationContainerOptions=e,this.scope.exploreContainer&&_.merge(this.scope.exploreContainer.options,e),null!=e.disableBookmarksPane&&this.scope.exploreContainer&&this.scope.exploreContainer.bookmarksPane&&(this.scope.exploreContainer.bookmarksPane.isPaneVisible=!e.disableBookmarksPane),this.reportEmbedState.useCustomSaveAsDialog=void 0!==r.useCustomSaveAsDialog?r.useCustomSaveAsDialog:this.reportEmbedState.useCustomSaveAsDialog,null!=r.background&&(this.scope.backgroundCssClass=this.getBackgroundCssClass(r.background)),[2,e]}}))}))},o.prototype.getBackgroundCssClass=function(e){switch(e){case this.PowerBIModels.BackgroundType.Default:return"";case this.PowerBIModels.BackgroundType.Transparent:return"transparent";default:return""}},o.prototype.interpretQnaUtteranceInternal=function(r){var o={utterance:r.question,datasetIds:r.datasetIds},i=this.services.telemetryService.startEvent(e.telemetry.QnaEmbedInterpretUtterance,e.getHashCode(r.question),r.datasetIds?r.datasetIds[0]:null,this.embedType,this.embedUrl,this.embedReferrer);return this.services.lazyScoped("qnaService").then((function(e){e.interpretInputUtterance(o).then((function(e){return e?void i.resolve():void i.reject(t.HostCommunicationHelper.prepareEmbedTelemetryErrorDetails(n.interpretQnaUtteranceFailed))}),(function(e){throw i.reject(t.HostCommunicationHelper.prepareEmbedTelemetryErrorDetails(n.interpretQnaUtteranceFailed)),e}))}))},o.prototype.getSectionByName=function(e){var r=t.ExplorationHelper.getPageIndexByName(e,this.exploration);return this.exploration.sections[r]},o.prototype.setExploreConfiguration=function(r,o,i){return void 0===r&&(r=!0),void 0===o&&(o=!1),__awaiter(this,void 0,e.Promise,(function(){var e,s,n,a;return __generator(this,(function(l){switch(l.label){case 0:return e=this.currentSettings.layoutType,[4,this.services.lazyScoped("reportEmbedMobileService")];case 1:return s=l.sent(),e!==this.PowerBIModels.LayoutType.MobilePortrait&&e!==this.PowerBIModels.LayoutType.MobileLandscape?(s.enableMobileCapabilities(),[2,e]):(n=i?t.ExplorationHelper.getSectionByName(this.exploration,i):this.exploration.sections[this.exploration.activeSectionIndex],s.hasPortraitLayout(this.exploration,n)||(e=this.PowerBIModels.LayoutType.MobileLandscape,this.services.embedMessageProxyService.postErrorMobileLayoutNotFound(n.name)),a=s.setExploreConfiguration(this.PowerBIModels,e),r&&s.setFormFactor(this.scope.exploreContainer,a),o&&s.adjustMobileLayout(this.exploration),[2,e])}}))}))},Object.defineProperty(o.prototype,"customLayoutService",{get:function(){return this.services.lazyScoped("reportEmbedCustomLayout")},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"visualSettingsService",{get:function(){return this.services.lazy("reportEmbedVisualSettings")},enumerable:!0,configurable:!0}),o.prototype.showSignIn=function(r,t){this.services.telemetryService.logEvent(e.telemetry.ReportEmbedLoadSecurePublishToWeb,t,this.embedType,this.embedUrl,this.embedReferrer),_.isEmpty(r)?this.hideLoadingSplash():(this.refreshTokenWatcher(),loadReport(t,r))},o.prototype.setHideErrors=function(e){e&&null!=e.hideErrors&&(this.services.errorService.hideErrors=e.hideErrors)},o.prototype.clickToInteract=function(){this.scope.optimizePublishToWeb=!1,this.loadReport(window.powerBIResourceKey)},o.prototype.refreshTokenWatcher=function(){var e=this,r=jsCommon.DateExtensions.parseIsoDate(window.powerBIAccessTokenExpiry);r&&(this.reportEmbedState.refreshTokenInterval=r.getTime()-(new Date).getTime()-d.bufferTimeToCheckTokenExpiry,this.reportEmbedState.refreshTokenInterval<=0?(this.services.windowService.self!==this.services.windowService.top?this.scope.isAccessTokenExpired=!0:this.refreshTokenHandler(),setTimeout((function(){e.refreshTokenWatcher()}),d.minimumRefreshTokenInterval)):setTimeout((function(){e.refreshTokenWatcher()}),this.reportEmbedState.refreshTokenInterval))},o.prototype.refreshTokenHandler=function(){e.common.tokenService.refreshToken(this.services.$timeout,this.services.featureSwitchService,(function(){}))},o.prototype.shouldLoadCachedData=function(){var e=this.reportEmbedState;return!(e.additionalODataFilter||e.additionalJsonFilters||e.bookmark||e.slicers)},Object.defineProperty(o.prototype,"embedReferrer",{get:function(){return this.services.embedModeService.getPublicEmbedReferrer()},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"embedUrl",{get:function(){return this.services.embedModeService.getPublicEmbedUrl()},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"isMobile",{get:function(){return this.services.embedModeService.isMobile()},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"reportEmbedState",{get:function(){return this.services.reportEmbedState},enumerable:!0,configurable:!0}),o})();o.ReportEmbedController=y})(o=t.controllers||(t.controllers={}))})(t=r.reportembed||(r.reportembed={}))})(r=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var r;!(function(r){var t;!(function(r){var t;!(function(t){var o=(function(){function t(){this.restrict="E",this.templateUrl="views/logoBarNavigation.html",this.scope={isSmallScreen:"=",isMediumScreen:"=",mailToLink:"=",showAboutDialog:"&",showFullScreen:"=",isFullScreen:"&",toggleFullScreenMode:"&"},this.controller=e.common.createController(r.controllers.LogoBarNavigationController)}return t})();t.LogoBarNavigation=o;var i=(function(){function e(){var e=this;this.restrict="A",this.link=function(r,t,o){var i=o;r.$watch(i.textSlideAnimation,(function(){e.clearAllTimeouts();var o=document.getElementById("flyoutElement");o&&o.setAttribute("flyout-visible",String(r.showOverlay)),t.children("li").each((function(t,o){if(r.showOverlay){var i=setTimeout((function(){$(o).addClass("slideUp").removeClass("slideDown sectionItemHidden")}),Math.min(50*t,500));e.addTimeout(i)}else $(o).removeClass("slideUp").addClass("sectionItemHidden")}))}))}}return e.prototype.addTimeout=function(e){(this.timeoutIDs=this.timeoutIDs||[]).push(e)},e.prototype.clearAllTimeouts=function(){this.timeoutIDs instanceof Array&&this.timeoutIDs.forEach((function(e){"number"==typeof e&&window.clearTimeout(e)}))},e})();t.TextSlideAnimation=i})(t=r.directives||(r.directives={}))})(t=r.reportembed||(r.reportembed={}))})(r=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var r;!(function(r){var t;!(function(r){var t;!(function(t){var o=(function(){function t(){this.restrict="E",this.templateUrl="views/logoBarSocialSharing.html",this.scope=!0,this.controller=e.common.createController(r.controllers.LogoBarSocialSharingController)}return t})();t.LogoBarSocialSharing=o})(t=r.directives||(r.directives={}))})(t=r.reportembed||(r.reportembed={}))})(r=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var r;!(function(r){var t;!(function(r){var t;!(function(t){var o=e.explore.reportembed.constants.CssStyles,i=(function(){function t(){this.restrict="E",this.replace=!0,this.templateUrl="views/logoBar.html",this.controller=e.common.createController(r.controllers.LogoBarController),this.link=function(e){function r(){var r=window.innerWidth>0?window.innerWidth:screen.width,t=window.innerHeight>0?window.innerHeight:screen.height;e.isSmallScreen=r<=o.maxWidthMobileUI||t<=o.maxHeightMobileUI,e.isMediumScreen=!e.isSmallScreen&&(r<=o.maxSizeTabletUI||t<=o.maxSizeTabletUI)}var t=document;t.fullscreenEnabled||t.webkitFullscreenEnabled||t.mozFullScreenEnabled||t.msFullscreenEnabled||window.setTimeout((function(){var e=document.getElementById("fullScreenIcon");e&&(e.setAttribute("target","_blank"),e.setAttribute("href",document.URL))}),0),r(),window.addEventListener("resize",(function(){r(),e.$apply()}))}}return t})();t.LogoBar=i})(t=r.directives||(r.directives={}))})(t=r.reportembed||(r.reportembed={}))})(r=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var r;!(function(r){var t;!(function(t){var o;!(function(o){var i=e.explore.reportembed.constants,s=e.explore.services.events,n=e.explore.helpers.ReportUtility,a=e.dataServices.models.ContentPackItems,l=jsCommon.TraceType;o.ReportAuthoringMixinFactory={ng:["$scope","embedModeService","embedRouter","errorService","explorationSerializer","featureSwitchService","localizationService","moduleLoader","promiseFactory","reportEmbedExplorationService","reportEmbedState","telemetryService","visualPlugin"],scoped:["eventBridge","lazyScoped"],fn:function(e){return new c(e)}};var c=(function(){function o(e){this.services=e}return o.prototype.update=function(e){this.explorationContainer=e,this.PowerBIModelsModule=this.services.moduleLoader.require({javascript:"powerbi-models"}),this.services.embedRouter.setupBlock(this),this.setEventListeners()},o.prototype.destroy=function(){this.channelSubscriptionManager.unsubscribeAll(),this.bubblingSubscriptionManager.unsubscribeAll()},o.prototype.setEventListeners=function(){var e=this;this.channelSubscriptionManager=this.services.eventBridge.createChannelSubscriptionManager().subscribe(r.services.events.saveReportCompleted,(function(r,t){return e.onReportSave(t)})).subscribe(r.services.events.customSaveAsTriggered,(function(r){return e.onSaveDialogRequested()})),this.bubblingSubscriptionManager=this.services.eventBridge.setBubblingScope(this.services.$scope).subscribe(s.saveExploration,(function(r,t){return e.save(r,t)})).subscribe(s.saveAsExploration,(function(r,t){return e.saveAs(r,t)}))},o.prototype.setupRoutes=function(r){var o=this;r.post("/report/save",(function(r,s){if(o.services.embedModeService.isAnonymousLiveEmbed()){var n=t.HostCommunicationHelper.buildNotSupportedByPublishToWebMessage();return s.send(i.StatusCodes.BadRequest,n)}o.saveReport().catch((function(r){o.services.telemetryService.logEvent(e.telemetry.ReportEmbedSDKError,o.requestId,o.services.reportEmbedState.reportObjectId,o.services.embedModeService.getEmbedTypeDescription()),o.services.embedRouter.postError("reports",r)})),o.services.telemetryService.logEvent(e.telemetry.ReportEmbedSDKSaveExploration,o.requestId,o.services.reportEmbedState.reportObjectId,o.services.embedModeService.getEmbedTypeDescription());var a=o.requestId?void 0:i.WarningMessages.loadReportUIDMissingWarning;return s.send(i.StatusCodes.Accepted,a)})),r.post("/report/saveAs",(function(r,s){return __awaiter(o,void 0,e.Promise,(function(){var o,n,a,l=this;return __generator(this,(function(c){switch(c.label){case 0:return this.services.embedModeService.isAnonymousLiveEmbed()?(o=t.HostCommunicationHelper.buildNotSupportedByPublishToWebMessage(),[2,s.send(i.StatusCodes.BadRequest,o)]):(n=r.body,[4,this.validateSaveAsParameters(n)]);case 1:return(a=c.sent())?[2,s.send(i.StatusCodes.BadRequest,a)]:(this.saveReportAs(n).catch((function(r){l.services.telemetryService.logEvent(e.telemetry.ReportEmbedSDKError,l.requestId,n.name,l.services.embedModeService.getEmbedTypeDescription()),l.services.embedRouter.postError("reports",r)})),this.services.telemetryService.logEvent(e.telemetry.ReportEmbedSDKSaveAsExploration,this.requestId,n.name,this.services.embedModeService.getEmbedTypeDescription()),[2,s.send(i.StatusCodes.Accepted)])}}))}))}))},o.prototype.save=function(e,r){return r&&r.overrideSaveRouting?this.saveReport():this.services.promiseFactory.reject(t.HostCommunicationHelper.createError(i.ErrorCodes.saveReportFailed,i.ErrorMessages.saveExplorationFailed,{level:l.Error}))},o.prototype.saveReport=function(){var e=this.isSaveEnabled();return e?this.services.promiseFactory.reject(e):this.services.reportEmbedState.baseExploration?this.saveReportInternal():this.saveAs(null,{overrideSaveRouting:!0})},o.prototype.saveAs=function(r,t){var o=this;if(t&&t.overrideSaveRouting){var i=this.services.promiseFactory.defer(),n=this.isSaveAsEnabled();return n?(i.reject(n),i.promise):this.services.reportEmbedState.useCustomSaveAsDialog?void this.services.eventBridge.publishToChannel(s.customSaveAsTriggered):(e.explore.controllers.showSaveAsDialog(this.services.errorService,this.services.localizationService).then((function(e){var r={name:e};return o.saveReportAsInternal(r).then((function(){i.resolve(null)}),(function(e){return i.reject(e),e}))}),(function(){})),i.promise)}},o.prototype.saveReportAs=function(e){var r=this.isSaveAsEnabled();return r?this.services.promiseFactory.reject(r):this.saveReportAsInternal(e)},o.prototype.saveReportInternal=function(){var o=this,s=this.services.reportEmbedState.baseExploration,c=this.services.reportEmbedState.reportObjectId,d=this.explorationContainer.viewModel.exploration.contract,p=s.reportId;if(n.HasUnsupportedExploreVisuals(d,this.services.visualPlugin))return this.services.promiseFactory.reject(t.HostCommunicationHelper.createError(i.ErrorCodes.saveReportFailed,i.ErrorMessages.unsupportedVisuals,{level:l.Error}));this.showSaveMask();var u=this.services.embedModeService,m=this.services.telemetryService.startEvent(e.telemetry.ReportEmbedSaveExploration,c,u.getEmbedTypeDescription(),u.getPublicEmbedUrl(),u.getPublicEmbedReferrer()),v=this.services.explorationSerializer.stringifyExplorationConfigs(this.services.explorationSerializer.serializeExploration(s,r.proxies.saveExplorationSerializationOptions));return this.services.reportEmbedExplorationService.save(v,d,p).then((function(r){var t=r&&r.exploration;if(!t)return void m.reject();o.services.reportEmbedState.reportContainer.report.contract.hasExploration=!0;var i=o.services.reportEmbedState.reportContainer.report;return i&&i.isUsedByContentPack&&o.services.$scope.$emit(e.constants.contentPackDirtyShowNotification,p,a.Report),o.onSaveSuccess(t,o.services.reportEmbedState.reportObjectId,!1,m)}),(function(e){throw o.onSaveFailure(o.services.reportEmbedState.reportObjectId,!1,m,void 0,e)}))},o.prototype.saveReportAsInternal=function(r){var o=this,s=this.services.reportEmbedState.reportObjectId,a=this.explorationContainer.viewModel.exploration.contract;if(n.HasUnsupportedExploreVisuals(a,this.services.visualPlugin))return this.services.promiseFactory.reject(t.HostCommunicationHelper.createError(i.ErrorCodes.saveReportFailed,i.ErrorMessages.unsupportedVisuals,{level:l.Error}));this.showSaveMask();var c=this.services.embedModeService,d=this.services.telemetryService.startEvent(e.telemetry.ReportEmbedSaveAsExploration,this.services.reportEmbedState.useCustomSaveAsDialog,s,c.getEmbedTypeDescription(),c.getPublicEmbedUrl(),c.getPublicEmbedReferrer());return this.services.reportEmbedExplorationService.saveAs(a,r.name,this.services.reportEmbedState.model.id,this.services.reportEmbedState.model.packageId).then((function(e){var t=e&&e.exploration;if(!t)return void o.onSaveFailure(o.services.reportEmbedState.reportObjectId,!0,d,void 0);o.services.reportEmbedState.reportContainer.report.contract.hasExploration=!0;var i=t.report?t.report.objectId:o.services.reportEmbedState.reportObjectId;return o.onSaveSuccess(t,i,!0,d,r.name)}),(function(e){throw o.onSaveFailure(o.services.reportEmbedState.reportObjectId,!0,d,void 0,e)}))},o.prototype.publishSaveReportCompleted=function(e,r,t,o){var i={reportObjectId:e,reportName:t,saveAs:r,error:o,originalReportObjectId:r?this.services.reportEmbedState.reportObjectId:void 0};this.services.eventBridge.publishToChannel(s.saveReportCompleted,i)},o.prototype.isSaveAsEnabled=function(){return this.services.embedModeService.isAnonymousLiveEmbed()?t.HostCommunicationHelper.buildNotSupportedByPublishToWebMessage():this.services.reportEmbedState.model?null:t.HostCommunicationHelper.createError(i.ErrorCodes.saveReportFailed,i.ErrorMessages.reportNotFound,{level:l.Error})},o.prototype.isSaveEnabled=function(){return this.services.reportEmbedState.isEditing?this.services.embedModeService.isAnonymousLiveEmbed()?t.HostCommunicationHelper.buildNotSupportedByPublishToWebMessage():null:t.HostCommunicationHelper.createError(i.ErrorCodes.saveReportFailed,i.ErrorMessages.saveReportNotAllowedInViewMode,{level:l.Error})},o.prototype.onSaveSuccess=function(r,t,o,i,n){this.synchronizeExplorationIds(r,this.explorationContainer.viewModel.exploration.contract);var a={featureUsage:{}},l=this.services.explorationSerializer;this.services.reportEmbedState.baseExploration=l.deepCopyExploration(r,a),this.services.reportEmbedState.baseExploration&&(this.services.reportEmbedState.baseExploration.report=r.report),this.services.$scope.$emit(e.common.constants.onReportChangedEventName,!1),this.services.eventBridge.publishToChannel(s.onReportChanged),this.publishSaveReportCompleted(t,o,n),i.resolve(),this.hideSaveMask()},o.prototype.onSaveFailure=function(e,r,o,s,n){var a=n&&401===n.httpStatusCode?"ReportEmbed_ErrorDialogHelperText_Permissions":"ErrorDialogHelperText";this.showModalError(n,this.services.localizationService.get("ExplorationContainer_FailedToSaveReport"),"ExplorationContainer_FailedToSaveReportDefaultDetails",this.services.localizationService.get(a)),o.reject(t.HostCommunicationHelper.prepareEmbedTelemetryErrorDetails(i.ErrorCodes.saveReportFailed,n?n.error:null,n?n.httpStatusCode:null));var c=t.HostCommunicationHelper.buildErrorObjectFromResult(n,i.ErrorCodes.saveReportFailed,i.ErrorMessages.saveExplorationFailed,l.Warning);return this.publishSaveReportCompleted(e,r,s,c),this.hideSaveMask(),c},o.prototype.synchronizeExplorationIds=function(e,t){t.id=e.id,t.reportId=e.reportId,r.SectionUtils.synchronizeSectionsIds(e.sections,t.sections)},o.prototype.showSaveMask=function(){this.explorationContainer.viewModel.showMask=!0},o.prototype.hideSaveMask=function(){this.explorationContainer.viewModel.showMask=!1},o.prototype.showModalError=function(e,r,t,o){this.services.errorService.error(r,t,{requestId:e?e.requestId:void 0,customErrorDialogHelperText:o,level:l.Warning},null,"PowerBI")},o.prototype.onReportSave=function(e){e.error?this.services.embedRouter.postError("reports",e.error):this.services.embedRouter.postEvent("/reports/"+this.requestId+"/events/saved",e)},o.prototype.onSaveDialogRequested=function(){this.services.embedRouter.postEvent("/reports/"+this.requestId+"/events/saveAsTriggered",{})},o.prototype.validateSaveAsParameters=function(r){return __awaiter(this,void 0,e.Promise,(function(){var e;return __generator(this,(function(t){switch(t.label){case 0:return[4,this.PowerBIModelsModule];case 1:return e=t.sent(),[2,e.validateSaveAsParameters(r)]}}))}))},Object.defineProperty(o.prototype,"requestId",{get:function(){return this.services.embedRouter.requestId},enumerable:!0,configurable:!0}),o})()})(o=t.mixins||(t.mixins={}))})(t=r.reportembed||(r.reportembed={}))})(r=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var r;!(function(r){var t;!(function(t){var o;!(function(o){var i=jsCommon.TraceType,s=e.explore.reportembed.constants;o.BookmarksMessageProxyMixinFactory={ng:["embedModeService","embedRouter","moduleLoader","reportEmbedState","sdkModelsConverter","telemetryService"],scoped:["eventBridge","lazyScoped"],fn:function(e){
return new n(e)}};var n=(function(){function o(e){this.services=e}return o.prototype.update=function(r){return __awaiter(this,void 0,e.Promise,(function(){return __generator(this,(function(e){return this.PowerBIModelsModule=this.services.moduleLoader.require({javascript:"powerbi-models"}),this.setEventListeners(),this.services.embedRouter.setupBlock(this),[2]}))}))},o.prototype.setEventListeners=function(){var e=this;this.services.eventBridge.createChannelSubscriptionManager().subscribe(r.services.events.bookmarkApplied,(function(r,t){return e.onBookmarkApplied(t)}))},o.prototype.onBookmarkApplied=function(r){this.services.telemetryService.logEvent(e.telemetry.ReportEmbedSDKBookmarkApplied,this.requestId,this.services.reportEmbedState.reportObjectId,this.services.embedModeService.getEmbedTypeDescription()),this.services.embedRouter.postEvent("/reports/"+this.requestId+"/events/bookmarkApplied",r)},o.prototype.setupRoutes=function(r){var o=this;r.get("/report/bookmarks",(function(r,i){return __awaiter(o,void 0,e.Promise,(function(){var r,r,o,n;return __generator(this,(function(a){switch(a.label){case 0:return this.services.embedModeService.isAnonymousLiveEmbed()?(r=t.HostCommunicationHelper.buildNotSupportedByPublishToWebMessage(),[2,i.send(s.StatusCodes.BadRequest,r)]):this.services.embedModeService.isAppTokenEmbed()?(r=t.HostCommunicationHelper.buildNotSupportedByAppTokenEmbedMessage(),[2,i.send(s.StatusCodes.BadRequest,r)]):[4,this.getBookmarkService()];case 1:return o=a.sent(),n=_.map(o.bookmarks,this.services.sdkModelsConverter.getSdkBookmark),this.services.telemetryService.logEvent(e.telemetry.ReportEmbedSDKGetBookmarks,this.requestId,this.services.reportEmbedState.reportObjectId,this.services.embedModeService.getEmbedTypeDescription()),[2,i.send(s.StatusCodes.OK,n)]}}))}))})),r.post("/report/bookmarks/applyByName",(function(r,n){return __awaiter(o,void 0,e.Promise,(function(){var o,o,a,l,c,o,d,p,o;return __generator(this,(function(u){switch(u.label){case 0:return this.services.embedModeService.isAnonymousLiveEmbed()?(o=t.HostCommunicationHelper.buildNotSupportedByPublishToWebMessage(),[2,n.send(s.StatusCodes.BadRequest,o)]):this.services.embedModeService.isAppTokenEmbed()?(o=t.HostCommunicationHelper.buildNotSupportedByAppTokenEmbedMessage(),[2,n.send(s.StatusCodes.BadRequest,o)]):(a=r.body,[4,this.PowerBIModelsModule]);case 1:return l=u.sent(),c=l.validateApplyBookmarkByNameRequest(a),c?(o=t.HostCommunicationHelper.createError(s.ErrorCodes.applyBookmarkFailed,s.ErrorMessages.invalidBookmarkRequest,{level:i.Error}),[2,n.send(s.StatusCodes.BadRequest,o)]):[4,this.getBookmarkService()];case 2:return d=u.sent(),[4,d.applyByName(a.name)];case 3:return(p=u.sent())?(this.services.reportEmbedState.loadCachedData=!1,this.services.telemetryService.logEvent(e.telemetry.ReportEmbedSDKApplyBookmarkByName,this.requestId,this.services.reportEmbedState.reportObjectId,this.services.embedModeService.getEmbedTypeDescription()),[2,n.send(s.StatusCodes.OK)]):(o=t.HostCommunicationHelper.createError(s.ErrorCodes.applyBookmarkFailed,s.ErrorMessages.bookmarkNotFound,{level:i.Error}),[2,n.send(s.StatusCodes.BadRequest,o)])}}))}))})),r.post("/report/bookmarks/applyState",(function(r,n){return __awaiter(o,void 0,e.Promise,(function(){var o,o,a,l,c,o,d,o,p,u;return __generator(this,(function(m){switch(m.label){case 0:return this.services.embedModeService.isAnonymousLiveEmbed()?(o=t.HostCommunicationHelper.buildNotSupportedByPublishToWebMessage(),[2,n.send(s.StatusCodes.BadRequest,o)]):this.services.embedModeService.isAppTokenEmbed()?(o=t.HostCommunicationHelper.buildNotSupportedByAppTokenEmbedMessage(),[2,n.send(s.StatusCodes.BadRequest,o)]):(a=r.body,[4,this.PowerBIModelsModule]);case 1:return l=m.sent(),(c=l.validateApplyBookmarkStateRequest(a))?(o=t.HostCommunicationHelper.createError(s.ErrorCodes.applyBookmarkFailed,s.ErrorMessages.invalidBookmarkRequest,{level:i.Error}),[2,n.send(s.StatusCodes.BadRequest,o)]):(d=this.services.sdkModelsConverter.getBookmarkFromBase64State(a.state),d?[4,this.getBookmarkService()]:(o=t.HostCommunicationHelper.createError(s.ErrorCodes.applyBookmarkFailed,s.ErrorMessages.invalidBookmarkState,{level:i.Error}),[2,n.send(s.StatusCodes.BadRequest,o)]));case 2:return p=m.sent(),[4,p.create(d.displayName,d.explorationState,d.options)];case 3:return u=m.sent(),[4,p.applyBookmark(u)];case 4:return m.sent(),this.services.reportEmbedState.loadCachedData=!1,this.services.telemetryService.logEvent(e.telemetry.ReportEmbedSDKApplyBookmarkState,this.requestId,this.services.reportEmbedState.reportObjectId,this.services.embedModeService.getEmbedTypeDescription()),[2,this.createBookmarkResponse(n,u)]}}))}))})),r.post("/report/bookmarks/add",(function(r,n){return __awaiter(o,void 0,e.Promise,(function(){var o,o,a,l,c,o,d,p,u,o,m,v;return __generator(this,(function(h){switch(h.label){case 0:return this.services.embedModeService.isAnonymousLiveEmbed()?(o=t.HostCommunicationHelper.buildNotSupportedByPublishToWebMessage(),[2,n.send(s.StatusCodes.BadRequest,o)]):this.services.embedModeService.isAppTokenEmbed()?(o=t.HostCommunicationHelper.buildNotSupportedByAppTokenEmbedMessage(),[2,n.send(s.StatusCodes.BadRequest,o)]):(a=r.body,[4,this.PowerBIModelsModule]);case 1:if(l=h.sent(),c=l.validateAddBookmarkRequest(a))return o=t.HostCommunicationHelper.createError(s.ErrorCodes.addBookmarkFailed,s.ErrorMessages.invalidBookmarkRequest,{level:i.Error}),[2,n.send(s.StatusCodes.BadRequest,o)];if(a.state){if(u=this.services.sdkModelsConverter.getBookmarkFromBase64State(a.state),!u)return o=t.HostCommunicationHelper.createError(s.ErrorCodes.addBookmarkFailed,s.ErrorMessages.invalidBookmarkState,{level:i.Error}),[2,n.send(s.StatusCodes.BadRequest,o)];d=u.explorationState,p=u.options}return[4,this.getBookmarkService()];case 2:return m=h.sent(),[4,m.add(a.displayName,d,p,a.apply)];case 3:return v=h.sent(),a.apply&&(this.services.reportEmbedState.loadCachedData=!1),this.services.telemetryService.logEvent(e.telemetry.ReportEmbedSDKAddBookmark,this.requestId,this.services.reportEmbedState.reportObjectId,this.services.embedModeService.getEmbedTypeDescription()),[2,this.createBookmarkResponse(n,v)]}}))}))})),r.post("/report/bookmarks/capture",(function(r,i){return __awaiter(o,void 0,e.Promise,(function(){var r,r,o,n;return __generator(this,(function(a){switch(a.label){case 0:return this.services.embedModeService.isAnonymousLiveEmbed()?(r=t.HostCommunicationHelper.buildNotSupportedByPublishToWebMessage(),[2,i.send(s.StatusCodes.BadRequest,r)]):this.services.embedModeService.isAppTokenEmbed()?(r=t.HostCommunicationHelper.buildNotSupportedByAppTokenEmbedMessage(),[2,i.send(s.StatusCodes.BadRequest,r)]):[4,this.getBookmarkService()];case 1:return o=a.sent(),[4,o.create()];case 2:return n=a.sent(),this.services.telemetryService.logEvent(e.telemetry.ReportEmbedSDKCaptureBookmark,this.requestId,this.services.reportEmbedState.reportObjectId,this.services.embedModeService.getEmbedTypeDescription()),[2,this.createBookmarkResponse(i,n)]}}))}))})),r.post("/report/bookmarks/play",(function(r,n){return __awaiter(o,void 0,e.Promise,(function(){var o,o,a,l,c,o,d,p;return __generator(this,(function(u){switch(u.label){case 0:return this.services.embedModeService.isAnonymousLiveEmbed()?(o=t.HostCommunicationHelper.buildNotSupportedByPublishToWebMessage(),[2,n.send(s.StatusCodes.BadRequest,o)]):this.services.embedModeService.isAppTokenEmbed()?(o=t.HostCommunicationHelper.buildNotSupportedByAppTokenEmbedMessage(),[2,n.send(s.StatusCodes.BadRequest,o)]):(a=r.body,[4,this.PowerBIModelsModule]);case 1:return l=u.sent(),(c=l.validatePlayBookmarkRequest(a))?(o=t.HostCommunicationHelper.createError(s.ErrorCodes.playBookmarkFailed,s.ErrorMessages.invalidBookmarkRequest,{level:i.Error}),[2,n.send(s.StatusCodes.BadRequest,o)]):(d=a.playMode===l.BookmarksPlayMode.Presentation,[4,this.getBookmarkService()]);case 2:return p=u.sent(),p.setPlayMode(d),this.services.telemetryService.logEvent(e.telemetry.ReportEmbedSDKPlayBookmarks,a.playMode,this.requestId,this.services.reportEmbedState.reportObjectId,this.services.embedModeService.getEmbedTypeDescription()),[2,n.send(s.StatusCodes.OK)]}}))}))}))},o.prototype.getBookmarkService=function(){return __awaiter(this,void 0,e.Promise,(function(){return __generator(this,(function(e){switch(e.label){case 0:return[4,this.services.lazyScoped("bookmark")];case 1:return[2,e.sent()]}}))}))},o.prototype.createBookmarkResponse=function(e,r){var t=this.services.sdkModelsConverter.getSdkBookmark(r);e.send(s.StatusCodes.OK,t)},Object.defineProperty(o.prototype,"requestId",{get:function(){return this.services.embedRouter.requestId},enumerable:!0,configurable:!0}),o})()})(o=t.mixins||(t.mixins={}))})(t=r.reportembed||(r.reportembed={}))})(r=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var r;!(function(r){var t;!(function(r){var t;!(function(t){var o=e.explore.reportembed.constants.ErrorCodes,i=e.explore.reportembed.constants.ErrorMessages,s=e.explore.reportembed.constants.ExportDataErrorMessages,n=e.explore.reportembed.constants.StatusCodes,a=jsCommon.StringExtensions,l=jsCommon.TraceType;t.ExportDataMessageProxyMixinFactory={ng:["conceptualSchemaProxy","embedModeService","embedRouter","moduleLoader","reportEmbedState","promiseFactory","telemetryService"],scoped:["lazyScoped","filterGenerator","lazyScopedSync"],fn:function(e){return new c(e)}};var c=(function(){function t(e){this.services=e}return t.prototype.update=function(r){return __awaiter(this,void 0,e.Promise,(function(){return __generator(this,(function(e){return this.explorationContainer=r,this.PowerBIModelsModule=this.services.moduleLoader.require({javascript:"powerbi-models"}),this.services.embedRouter.setupBlock(this),[2]}))}))},t.prototype.setupRoutes=function(r){var t=this;r.post("/report/pages/:pageName/visuals/:visualName/exportData",(function(r,o){return __awaiter(t,void 0,e.Promise,(function(){return __generator(this,(function(e){switch(e.label){case 0:return[4,this.validateExportToCsvRequest(r,o)];case 1:return e.sent()?[4,this.exportToCsv(r,o)]:[3,3];case 2:return[2,e.sent()];case 3:return[2]}}))}))}))},t.prototype.validateExportToCsvRequest=function(t,a){return __awaiter(this,void 0,e.Promise,(function(){var c,c,d,p,c,u,m,c,c;return __generator(this,(function(v){switch(v.label){case 0:if(this.services.embedModeService.isAnonymousLiveEmbed())return c=r.HostCommunicationHelper.buildNotSupportedByPublishToWebMessage(),a.send(n.BadRequest,c),[2,!1];if(this.services.embedModeService.isAppTokenEmbed())return c=r.HostCommunicationHelper.buildNotSupportedByAppTokenEmbedMessage(),a.send(n.BadRequest,c),[2,!1];v.label=1;case 1:return v.trys.push([1,3,,4]),[4,this.PowerBIModelsModule];case 2:return d=v.sent(),p=d.validateExportDataRequest(t.body),p?(c=r.HostCommunicationHelper.createError(o.exportDataFailed,s.invalidRequest,{level:l.Error}),a.send(n.BadRequest,c),[2,!1]):[3,4];case 3:return u=v.sent(),[3,4];case 4:return m=r.ExplorationHelper.getPageIndexByName(t.params.pageName,this.explorationViewModel.contract),m<0?(this.services.telemetryService.logEvent(e.telemetry.ReportEmbedSDKError,this.requestId,this.services.reportEmbedState.reportObjectId,this.services.embedModeService.getEmbedTypeDescription(),o.pageNotFound),c=r.HostCommunicationHelper.buildPageNotFoundErrorMessage(t.params.pageName),a.send(n.BadRequest,c),[2]):m!==this.explorationViewModel.contract.activeSectionIndex?(this.services.telemetryService.logEvent(e.telemetry.ReportEmbedSDKError,this.requestId,this.services.reportEmbedState.reportObjectId,this.services.embedModeService.getEmbedTypeDescription(),o.pageNotActive),c=r.HostCommunicationHelper.createError(o.exportDataFailed,i.pageNotActive,{level:l.Error}),a.send(n.BadRequest,c),[2]):[2,!0]}}))}))},t.prototype.exportToCsv=function(t,a){return __awaiter(this,void 0,e.Promise,(function(){var c,d,p,d,u,m,v,h,g,b,y,f,S=this;return __generator(this,(function(E){switch(E.label){case 0:return c=this.getRowsLimit(t.body),c<=0?(d=r.HostCommunicationHelper.createError(o.exportDataFailed,s.invalidRequest,{level:l.Error}),a.send(n.BadRequest,d),[2]):(p=r.ExplorationHelper.getVisualContainerViewModel(this.explorationViewModel,t.params.visualName),p?this.canExportData(p)?[4,this.getConceptualSchema()]:(u=r.HostCommunicationHelper.createError(o.exportDataFailed,s.notSupportedForVisual,{level:l.Error}),a.send(n.BadRequest,u),[2]):(this.services.telemetryService.logEvent(e.telemetry.ReportEmbedSDKError,this.requestId,this.services.reportEmbedState.reportObjectId,this.services.embedModeService.getEmbedTypeDescription(),o.visualNotFound),d=r.HostCommunicationHelper.buildVisualNotFoundErrorMessage(t.params.visualName,t.params.pageName),a.send(n.BadRequest,d),[2]));case 1:return(m=E.sent())?(h=this.exploration.dataSources,g=p.visualTitle?p.visualTitle.text:null,[4,this.PowerBIModelsModule]):(v=r.HostCommunicationHelper.createError(o.exportDataFailed,i.failedGettingSchema,{level:l.Error}),a.send(n.InternalServerError,v),[2]);case 2:return b=E.sent(),y=t.body&&t.body.exportDataType,f=y===b.ExportDataType.Underlying?this.exportUnderlyingDataToCsv(p,m,g,h,c):this.exportSummarizedDataToCsv(p,m,g,h,c),[4,f.then((function(e){S.sendExportDataResponse(a,e)}),(function(e){S.sendExportDataErrorResponse(a,e)}))];case 3:return[2,E.sent()]}}))}))},t.prototype.exportSummarizedDataToCsv=function(r,t,o,i,s){return __awaiter(this,void 0,e.Promise,(function(){var e,n,a,l;return __generator(this,(function(c){switch(c.label){case 0:return[4,r.hostServices.getFilters(this.services.filterGenerator,t)];case 1:return e=c.sent(),n=r.contract.config.singleVisual,a=r.getRunningVisual(),[4,this.services.lazyScoped("exportVisualData")];case 2:return l=c.sent(),[4,l.exportToCsv(o,{data:a&&a.getData(),dataTransforms:a&&a.getDataTransforms()},i,n,e,s)];case 3:return[2,c.sent()]}}))}))},t.prototype.exportUnderlyingDataToCsv=function(r,t,o,i,s){return __awaiter(this,void 0,e.Promise,(function(){var e,n,a,l,c,d;return __generator(this,(function(p){switch(p.label){case 0:return e=r.contract.config.singleVisual,n=this.services.lazyScopedSync("drillToDetails"),a=n.getDetailsTableTargetMeasures(e),l=n.generateDetailsTable(e,t,a),l?[4,r.hostServices.getFilters(this.services.filterGenerator,t)]:[2,this.services.promiseFactory.reject({blob:null,error:4})];case 1:return c=p.sent(),[4,this.services.lazyScoped("exportVisualData")];case 2:return d=p.sent(),[4,d.exportToCsv(o,null,i,l,c,s)];case 3:return[2,p.sent()]}}))}))},t.prototype.canExportData=function(e){var r=e.getRunningVisual(),t=r&&r.getData();return null!=(t&&t.dataViewSource)},t.prototype.getRowsLimit=function(e){return e&&e.rows?Math.min(e.rows,r.constants.ExportDataLimits.maxRowsLimit):r.constants.ExportDataLimits.maxRowsLimit},t.prototype.sendExportDataErrorResponse=function(t,i){var c=i&&i.error?a.format("ExportDataError. error type: {0}",i.error.toString()):"ExportDataError";if(this.services.telemetryService.logEvent(e.telemetry.ReportEmbedSDKError,this.requestId,this.services.reportEmbedState.reportObjectId,this.services.embedModeService.getEmbedTypeDescription(),c),!i||!i.error){var d=r.HostCommunicationHelper.createError(o.exportDataFailed,s.generalFailure,{level:l.Error});return t.send(n.InternalServerError,d)}var p=s.generalFailure,u=n.InternalServerError;switch(i.error){case 4:p=s.generateDetailsTable;break;case 5:p=s.generateFiltersDescription;break;case 1:u=n.BadRequest,p=s.noData;break;case 2:p=s.queryError;break;case 3:p=s.schemaLoadingError;break;case 6:p=s.columnNameCannotBeEmpty}var m=r.HostCommunicationHelper.createError(o.exportDataFailed,p,{level:l.Error});return t.send(u,m)},t.prototype.sendExportDataResponse=function(r,t){return t.error?void this.sendExportDataErrorResponse(r,t):(this.services.telemetryService.logEvent(e.telemetry.ReportEmbedSDKExportData,t.isPartialResult,this.requestId,this.services.reportEmbedState.reportObjectId,this.services.embedModeService.getEmbedTypeDescription()),void r.send(n.OK,{data:t.blob}))},t.prototype.getConceptualSchema=function(){if(!this.exploration)return this.services.promiseFactory.reject();var e=this.exploration.dataSources;return this.services.conceptualSchemaProxy.get(e)},Object.defineProperty(t.prototype,"explorationViewModel",{get:function(){return this.explorationContainer&&this.explorationContainer.viewModel&&this.explorationContainer.viewModel.exploration},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"exploration",{get:function(){return this.explorationViewModel.contract},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"requestId",{get:function(){return this.services.embedRouter.requestId},enumerable:!0,configurable:!0}),t})()})(t=r.mixins||(r.mixins={}))})(t=r.reportembed||(r.reportembed={}))})(r=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var r;!(function(r){var t;!(function(r){var t;!(function(t){var o=e.explore.reportembed.constants;t.FiltersMessageProxyMixinFactory={ng:["embedModeService","embedRouter","moduleLoader","reportEmbedState","promiseFactory","telemetryService"],scoped:["reportEmbedFilterService"],fn:function(e){return new i(e)}};var i=(function(){function t(e){this.services=e}return t.prototype.update=function(r){return __awaiter(this,void 0,e.Promise,(function(){return __generator(this,(function(e){return this.explorationContainer=r,this.PowerBIModelsModule=this.services.moduleLoader.require({javascript:"powerbi-models"}),this.services.embedRouter.setupBlock(this),[2]}))}))},t.prototype.setupRoutes=function(t){var i=this;t.put("/report/filters",(function(t,s){return __awaiter(i,void 0,e.Promise,(function(){var i,n,a,l;return __generator(this,(function(c){switch(c.label){case 0:return this.services.embedModeService.isAnonymousLiveEmbed()?(i=r.HostCommunicationHelper.buildNotSupportedByPublishToWebMessage(),[2,s.send(o.StatusCodes.BadRequest,i)]):(this.services.reportEmbedState.loadCachedData=!1,n=t.body,[4,this.validateFilters(n)]);case 1:if(a=c.sent())return[2,s.send(o.StatusCodes.BadRequest,a)];c.label=2;case 2:return c.trys.push([2,4,,5]),[4,this.services.reportEmbedFilterService.setFilters(n)];case 3:return c.sent(),this.services.telemetryService.logEvent(e.telemetry.ReportEmbedSDKSetReportLevelFilters,this.requestId,this.services.reportEmbedState.reportObjectId,this.services.embedModeService.getEmbedTypeDescription()),[2,s.send(o.StatusCodes.Accepted)];case 4:return l=c.sent(),this.services.telemetryService.logEvent(e.telemetry.ReportEmbedSDKError,this.requestId,this.services.reportEmbedState.reportObjectId,this.services.embedModeService.getEmbedTypeDescription(),l.message),[2,s.send(o.StatusCodes.BadRequest,l)];case 5:return[2]}}))}))})),t.get("/report/filters",(function(t,s){return __awaiter(i,void 0,void 0,(function(){var t,i,n;return __generator(this,(function(a){switch(a.label){case 0:if(this.services.embedModeService.isAnonymousLiveEmbed())return t=r.HostCommunicationHelper.buildNotSupportedByPublishToWebMessage(),[2,s.send(o.StatusCodes.BadRequest,t)];a.label=1;case 1:return a.trys.push([1,3,,4]),[4,this.services.reportEmbedFilterService.getFilters()];case 2:return i=a.sent(),this.services.telemetryService.logEvent(e.telemetry.ReportEmbedSDKGetReportLevelFilters,this.requestId,this.services.reportEmbedState.reportObjectId,this.services.embedModeService.getEmbedTypeDescription()),[2,s.send(o.StatusCodes.OK,i)];case 3:return n=a.sent(),this.services.telemetryService.logEvent(e.telemetry.ReportEmbedSDKError,this.requestId,this.services.reportEmbedState.reportObjectId,this.services.embedModeService.getEmbedTypeDescription(),n.message),[2,s.send(o.StatusCodes.BadRequest,n)];case 4:return[2]}}))}))})),t.put("/report/pages/:pageName/filters",(function(t,s){return __awaiter(i,void 0,e.Promise,(function(){var i,n,a,l,c,d,p;return __generator(this,(function(u){switch(u.label){case 0:return this.services.embedModeService.isAnonymousLiveEmbed()?(i=r.HostCommunicationHelper.buildNotSupportedByPublishToWebMessage(),[2,s.send(o.StatusCodes.BadRequest,i)]):(this.services.reportEmbedState.loadCachedData=!1,n=t.params.pageName,a=t.body,l={name:n},c=this.validatePageLevel(l),c?[2,s.send(o.StatusCodes.BadRequest,c)]:[4,this.validateFilters(a)]);case 1:if(d=u.sent())return[2,s.send(o.StatusCodes.BadRequest,d)];u.label=2;case 2:return u.trys.push([2,4,,5]),[4,this.services.reportEmbedFilterService.setFilters(a,l)];case 3:return u.sent(),this.services.telemetryService.logEvent(e.telemetry.ReportEmbedSDKSetPageLevelFilters,this.requestId,this.services.reportEmbedState.reportObjectId,this.services.embedModeService.getEmbedTypeDescription()),[2,s.send(o.StatusCodes.Accepted)];case 4:return p=u.sent(),this.services.telemetryService.logEvent(e.telemetry.ReportEmbedSDKError,this.requestId,this.services.reportEmbedState.reportObjectId,this.services.embedModeService.getEmbedTypeDescription(),p.message),[2,s.send(o.StatusCodes.BadRequest,p)];case 5:return[2]}}))}))})),t.get("/report/pages/:pageName/filters",(function(t,s){return __awaiter(i,void 0,void 0,(function(){var i,n,a,l,c,d;return __generator(this,(function(p){switch(p.label){case 0:if(this.services.embedModeService.isAnonymousLiveEmbed())return i=r.HostCommunicationHelper.buildNotSupportedByPublishToWebMessage(),[2,s.send(o.StatusCodes.BadRequest,i)];if(n=t.params.pageName,a={name:n},l=this.validatePageLevel(a))return[2,s.send(o.StatusCodes.BadRequest,l)];p.label=1;case 1:return p.trys.push([1,3,,4]),[4,this.services.reportEmbedFilterService.getFilters(a)];case 2:return c=p.sent(),this.services.telemetryService.logEvent(e.telemetry.ReportEmbedSDKGetPageLevelFilters,this.requestId,this.services.reportEmbedState.reportObjectId,this.services.embedModeService.getEmbedTypeDescription()),[2,s.send(o.StatusCodes.OK,c)];case 3:return d=p.sent(),this.services.telemetryService.logEvent(e.telemetry.ReportEmbedSDKError,this.requestId,this.services.reportEmbedState.reportObjectId,this.services.embedModeService.getEmbedTypeDescription(),d.message),[2,s.send(o.StatusCodes.BadRequest,d)];case 4:return[2]}}))}))})),t.put("/report/pages/:pageName/visuals/:visualName/filters",(function(t,s){return __awaiter(i,void 0,e.Promise,(function(){var i,n,a,l,c,d,p,u;return __generator(this,(function(m){switch(m.label){case 0:return this.services.embedModeService.isAnonymousLiveEmbed()?(i=r.HostCommunicationHelper.buildNotSupportedByPublishToWebMessage(),[2,s.send(o.StatusCodes.BadRequest,i)]):(this.services.reportEmbedState.loadCachedData=!1,n=t.params.pageName,a=t.params.visualName,l=t.body,c={visualName:a,pageName:n},d=this.validateVisualLevel(c),d?[2,s.send(o.StatusCodes.BadRequest,d)]:[4,this.validateFilters(l)]);case 1:if(p=m.sent())return[2,s.send(o.StatusCodes.BadRequest,p)];m.label=2;case 2:return m.trys.push([2,4,,5]),[4,this.services.reportEmbedFilterService.setFilters(l,c)];case 3:return m.sent(),this.services.telemetryService.logEvent(e.telemetry.ReportEmbedSDKSetVisualLevelFilters,this.requestId,this.services.reportEmbedState.reportObjectId,this.services.embedModeService.getEmbedTypeDescription()),[2,s.send(o.StatusCodes.Accepted)];case 4:return u=m.sent(),this.services.telemetryService.logEvent(e.telemetry.ReportEmbedSDKError,this.requestId,this.services.reportEmbedState.reportObjectId,this.services.embedModeService.getEmbedTypeDescription(),u.message),[2,s.send(o.StatusCodes.BadRequest,u)];case 5:return[2]}}))}))})),t.get("/report/pages/:pageName/visuals/:visualName/filters",(function(t,s){return __awaiter(i,void 0,void 0,(function(){var i,n,a,l,c,d,p;return __generator(this,(function(u){switch(u.label){case 0:if(this.services.embedModeService.isAnonymousLiveEmbed())return i=r.HostCommunicationHelper.buildNotSupportedByPublishToWebMessage(),[2,s.send(o.StatusCodes.BadRequest,i)];if(n=t.params.pageName,a=t.params.visualName,l={visualName:a,pageName:n},c=this.validateVisualLevel(l))return[2,s.send(o.StatusCodes.BadRequest,c)];u.label=1;case 1:return u.trys.push([1,3,,4]),[4,this.services.reportEmbedFilterService.getFilters(l)];case 2:return d=u.sent(),this.services.telemetryService.logEvent(e.telemetry.ReportEmbedSDKGetVisualLevelFilters,this.requestId,this.services.reportEmbedState.reportObjectId,this.services.embedModeService.getEmbedTypeDescription()),[2,s.send(o.StatusCodes.OK,d)];case 3:return p=u.sent(),this.services.telemetryService.logEvent(e.telemetry.ReportEmbedSDKError,this.requestId,this.services.reportEmbedState.reportObjectId,this.services.embedModeService.getEmbedTypeDescription(),p.message),[2,s.send(o.StatusCodes.BadRequest,p)];case 4:return[2]}}))}))}))},t.prototype.validateFilters=function(r){return __awaiter(this,void 0,e.Promise,(function(){var e,t,o,i,s,n;return __generator(this,(function(a){switch(a.label){case 0:return[4,this.PowerBIModelsModule];case 1:for(t=a.sent(),o=0,i=r;o<i.length;o++)s=i[o],n=t.validateFilter(s),n&&(e=e||[],e=e.concat(n));return[2,e]}}))}))},t.prototype.validatePageLevel=function(e){var t;return r.ExplorationHelper.isPageExists(e.name,this.exploration)||(t=[],t.push({message:o.ErrorMessages.invalidPageName})),t},t.prototype.validateVisualLevel=function(e){return r.ExplorationHelper.isPageExists(e.pageName,this.exploration)?r.ExplorationHelper.isVisualExists(e.pageName,e.visualName,this.exploration)?null:[{message:o.ErrorMessages.invalidVisualName}]:[{message:o.ErrorMessages.invalidPageName}]},Object.defineProperty(t.prototype,"exploration",{get:function(){return this.explorationContainer.viewModel.exploration.contract},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"requestId",{get:function(){return this.services.embedRouter.requestId},enumerable:!0,configurable:!0}),t})()})(t=r.mixins||(r.mixins={}))})(t=r.reportembed||(r.reportembed={}))})(r=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var r;!(function(r){var t;!(function(t){var o;!(function(o){var i=e.explore.services.events,s=e.explore.reportembed.constants,n=jsCommon.TraceType;o.InteractivityMessageProxyMixinFactory={ng:["conceptualSchemaProxy","embedModeService","embedRouter","featureSwitchService","moduleLoader","reportEmbedState","telemetryService","promiseFactory"],scoped:["eventBridge","explorationCapabilities","lazyScoped"],fn:function(e){return new a(e)}};var a=(function(){function o(e){this.services=e}return o.prototype.update=function(e){this.explorationContainer=e,this.services.embedRouter.setupBlock(this),this.setEventListeners()},Object.defineProperty(o.prototype,"exploration",{get:function(){return this.explorationContainer.viewModel.exploration.contract},enumerable:!0,configurable:!0}),o.prototype.setEventListeners=function(){var e=this;this.services.eventBridge.createChannelSubscriptionManager().subscribe(r.services.events.sectionChanged,(function(r,t){return e.onSectionChange(t)})).subscribe(r.services.events.dataPointsSelected,(function(r,t){return e.onDataPointsSelection(t)})).subscribe(r.services.events.visualCustomCommand,(function(r,t){return e.onVisualCustomCommand(t)}))},o.prototype.setupRoutes=function(r){var o=this;r.post("/report/switchMode/:viewMode",(function(r,i){return __awaiter(o,void 0,e.Promise,(function(){var o,n,a,l;return __generator(this,(function(c){switch(c.label){case 0:return this.services.embedModeService.isAnonymousLiveEmbed()?(o=t.HostCommunicationHelper.buildNotSupportedByPublishToWebMessage(),[2,i.send(s.StatusCodes.BadRequest,o)]):(n=r.params.viewMode,null==n||"edit"!==n.toLowerCase()&&"view"!==n.toLowerCase()?[2,i.send(s.StatusCodes.BadRequest,s.ErrorMessages.invalidViewMode)]:(a="edit"===n.toLowerCase(),[4,this.changeViewMode(a)]));case 1:return l=c.sent(),l?(this.services.telemetryService.logEvent(e.telemetry.ReportEmbedSDKError,this.services.embedRouter.requestId,this.services.reportEmbedState.reportObjectId,this.services.embedModeService.getEmbedTypeDescription()),[2,i.send(s.StatusCodes.BadRequest,l)]):(this.services.telemetryService.logEvent(e.telemetry.ReportEmbedSDKChangeViewMode,this.services.embedRouter.requestId,this.services.reportEmbedState.reportObjectId,this.services.embedModeService.getEmbedTypeDescription()),[2,i.send(s.StatusCodes.OK)])}}))}))}))},o.prototype.changeViewMode=function(r){return __awaiter(this,void 0,e.Promise,(function(){var e;return __generator(this,(function(o){return this.exploration?this.services.embedModeService.isAnonymousLiveEmbed()?e=t.HostCommunicationHelper.buildNotSupportedByPublishToWebMessage():r&&1===this.services.reportEmbedState.report.permissions?e=t.HostCommunicationHelper.createError(s.ErrorCodes.insufficientPermissions,s.ErrorMessages.insufficientPermissions,{level:n.Error}):r&&this.services.embedModeService.isMobile()?e=t.HostCommunicationHelper.createError(s.ErrorCodes.insufficientPermissions,s.ErrorMessages.mobileLayoutPermissionNotSupported,{level:n.Error}):this.services.reportEmbedState.isEditing!==r&&(this.services.reportEmbedState.isEditing=r,this.updateSettings({filterPaneEnabled:this.services.reportEmbedState.currentSettings.filterPaneEnabled,navContentPaneEnabled:this.services.reportEmbedState.currentSettings.navContentPaneEnabled}),this.services.eventBridge.publishToChannel(i.requestViewModeChange,r?1:0)):e=t.HostCommunicationHelper.createError(s.ErrorCodes.noExploration,s.ErrorMessages.changeViewModeFailed,{level:n.Error}),[2,e]}))}))},o.prototype.updateSettings=function(e){var r=this.services.explorationCapabilities.getCapabilities(),t=this.services.reportEmbedState.currentSettings;t.filterPaneEnabled=null!=e.filterPaneEnabled?e.filterPaneEnabled:t.filterPaneEnabled,t.navContentPaneEnabled=null!=e.navContentPaneEnabled?e.navContentPaneEnabled:t.navContentPaneEnabled,this.services.reportEmbedState.isEditing&&(e.filterPaneEnabled=!0,e.navContentPaneEnabled=!0),r.showVisualizationPane=void 0!==e.filterPaneEnabled?e.filterPaneEnabled:r.showVisualizationPane,r.showNavContentPane=void 0!==e.navContentPaneEnabled?e.navContentPaneEnabled:r.showNavContentPane,r.showAppBar=this.services.reportEmbedState.isEditing,r.disableCustomVisualPluginActions=!0,this.services.explorationCapabilities.setCapabilities(r),_.merge(this.explorationContainer.viewModel.options,r)},o.prototype.onSectionChange=function(e){var r=this.getPageByName(e.name);this.services.embedRouter.postEvent("/reports/"+this.services.embedRouter.requestId+"/events/pageChanged",{initiator:void 0,newPage:r})},o.prototype.onDataPointsSelection=function(r){return __awaiter(this,void 0,e.Promise,(function(){var e,t,o,i,s;return __generator(this,(function(n){switch(n.label){case 0:return n.trys.push([0,3,,4]),[4,this.services.promiseFactory.all([this.getJsonFilterParser(),this.getConceptualSchema()])];case 1:return e=n.sent(),t=e[0],o=e[1],[4,t.tryGetSelectedDataPoints(this.exploration,o,r.dataPointsDescriptions,r.visualContainer,r.visualTitleText)];case 2:return(i=n.sent())?(this.services.embedRouter.postEvent("/reports/"+this.requestId+"/events/dataSelected",i),[3,4]):[2];case 3:return s=n.sent(),this.services.embedRouter.postError("reports",s),[3,4];case 4:return[2]}}))}))},o.prototype.onVisualCustomCommand=function(r){return __awaiter(this,void 0,e.Promise,(function(){var e,o,i,a,l,e,c,d;return __generator(this,(function(p){switch(p.label){case 0:if(!r)return e=t.HostCommunicationHelper.createError(s.ErrorCodes.commandFailed,s.ErrorMessages.commandFailed,{level:n.Error}),this.services.embedRouter.postError("reports",e),[2];p.label=1;case 1:return p.trys.push([1,4,,5]),[4,this.services.promiseFactory.all([this.getJsonFilterParser(),this.getConceptualSchema()])];case 2:return o=p.sent(),i=o[0],a=o[1],[4,i.tryGetSelectedDataPoints(this.exploration,a,r.dataPointsDescriptions,r.visualContainer,null)];case 3:return(l=p.sent())?(c={report:l.report,page:l.page,visual:l.visual,dataPoints:l.dataPoints,command:r.command},this.services.embedRouter.postEvent("/reports/"+this.requestId+"/events/commandTriggered",c),[3,5]):(e=t.HostCommunicationHelper.createError(s.ErrorCodes.commandFailed,s.ErrorMessages.commandFailed,{level:n.Error}),this.services.embedRouter.postError("reports",e),[2]);case 4:return d=p.sent(),this.services.embedRouter.postError("reports",d),[3,5];case 5:return[2]}}))}))},o.prototype.getPageByName=function(e){
var r,t=this.exploration&&this.exploration.sections?this.exploration.sections.filter((function(r){return r.name===e})):null;return t&&t.length>0&&(r={name:t[0].name,displayName:t[0].displayName}),r},o.prototype.getConceptualSchema=function(){try{if(!this.exploration)return this.services.promiseFactory.reject();var e=this.exploration.dataSources;return this.services.conceptualSchemaProxy.get(e)}catch(e){throw t.HostCommunicationHelper.buildIErrorFromConceptualSchemaError(e)}},o.prototype.getJsonFilterParser=function(){return __awaiter(this,void 0,e.Promise,(function(){var e,r;return __generator(this,(function(o){switch(o.label){case 0:return e=this,r=this.jsonFilterParser,r?[3,2]:[4,t.JsonFilterHelper.createJsonFilterParser(this.services.promiseFactory,this.services.moduleLoader,this.services.telemetryService)];case 1:r=o.sent(),o.label=2;case 2:return e.jsonFilterParser=r,[2,this.jsonFilterParser]}}))}))},Object.defineProperty(o.prototype,"requestId",{get:function(){return this.services.embedRouter.requestId},enumerable:!0,configurable:!0}),o})()})(o=t.mixins||(t.mixins={}))})(t=r.reportembed||(r.reportembed={}))})(r=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var r;!(function(r){var t;!(function(r){var t;!(function(r){r.SlicerMessageProxyMixinFactory={ng:["embedRouter","reportEmbedState"],scoped:["lazyScoped"],fn:function(e){return new t(e)}};var t=(function(){function r(e){this.services=e}return r.prototype.update=function(e){var r=this;this.explorationContainer=e,e.extensions.slicers={init:function(e){return r.init(e)}},this.services.embedRouter.setupBlock(this)},r.prototype.setupRoutes=function(r){var t=this;r.put("/report/pages/:pageName/visuals/:visualName/slicer",(function(r,o){return __awaiter(t,void 0,e.Promise,(function(){var e;return __generator(this,(function(t){switch(t.label){case 0:return[4,this.getSlicersApiService()];case 1:return e=t.sent(),[4,e.putSlicer(this.explorationContainer,r,o)];case 2:return[2,t.sent()]}}))}))})),r.get("/report/pages/:pageName/visuals/:visualName/slicer",(function(r,o){return __awaiter(t,void 0,e.Promise,(function(){var e;return __generator(this,(function(t){switch(t.label){case 0:return[4,this.getSlicersApiService()];case 1:return e=t.sent(),[4,e.getSlicer(this.explorationContainer,r,o)];case 2:return[2,t.sent()]}}))}))}))},r.prototype.init=function(r){return __awaiter(this,void 0,e.Promise,(function(){var e;return __generator(this,(function(t){switch(t.label){case 0:return[4,this.getSlicersApiService()];case 1:return e=t.sent(),[4,e.applySlicers(r,this.services.reportEmbedState.slicers)];case 2:return[2,t.sent()]}}))}))},r.prototype.getSlicersApiService=function(){return __awaiter(this,void 0,e.Promise,(function(){var e;return __generator(this,(function(r){switch(r.label){case 0:return this._reportEmbedSlicersApiService?[3,2]:(e=this,[4,this.services.lazyScoped("reportEmbedSlicersApiService")]);case 1:e._reportEmbedSlicersApiService=r.sent(),r.label=2;case 2:return[2,this._reportEmbedSlicersApiService]}}))}))},r})()})(t=r.mixins||(r.mixins={}))})(t=r.reportembed||(r.reportembed={}))})(r=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var r;!(function(e){var r;!(function(e){var r;!(function(e){var r=(function(){function e(){}return e.prototype.getModelContracts=function(){return[]},e.prototype.updateContractModel=function(e){},e.prototype.addContractModel=function(e){},e.prototype.addModel=function(e){},e.prototype.deleteModel=function(e,r){},e.prototype.deleteModelForPackage=function(e){},e.prototype.getModelIndex=function(e,r){return 0},e.prototype.getModelIndices=function(e){return[]},e.prototype.getModelRefreshSchedule=function(e,r){},e.prototype.findModel=function(e,r){},e.prototype.findModels=function(e,r){return[]},e.prototype.findModelByDBName=function(e){},e.prototype.findFirstOwnedModelByDBName=function(e){},e.prototype.findFirstExplorableModelByDBName=function(e){},e.prototype.findModelsByDBName=function(e){return[]},e.prototype.findModelByPackageId=function(e){},e.prototype.findModelsByPackageId=function(e){return[]},e.prototype.renameModel=function(e,r,t){},e.prototype.isExplorableNonLegacySampleModel=function(e){return!0},e.prototype.isActionAllowed=function(e,r){return!0},e.prototype.isModelNameValid=function(e){},e.prototype.removeModels=function(e){},e.prototype.updateDatasetCollection=function(e){},e.prototype.mergeDatasetCollection=function(e){},e.prototype.onModelAdded=function(e,r){},e.prototype.onModelDeleted=function(e,r){},e.prototype.onModelUpdated=function(e,r){},e.prototype.onModelsUpdated=function(e){},e.prototype.updateModelQnaFeatures=function(e,r){},e.prototype.updateFeaturedQuestions=function(e,r){},e.prototype.addModelUpdateListener=function(e){},e.prototype.removeModelUpdateListener=function(e){},e.prototype.subscribe=function(e){},e.prototype.unsubscribe=function(e){},e.prototype.canReshare=function(e){return!1},e.prototype.populateSharedModelInfo=function(){},e})();e.MockModelService=r})(r=e.services||(e.services={}))})(r=e.reportembed||(e.reportembed={}))})(r=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var r;!(function(r){var t;!(function(t){var o;!(function(o){function i(e,r,t,i,s,n,a,l,c){return new o.ReportEmbedMessageProxyService(e,r,t,i,s,n,a,l,c)}var s=e.explore.reportembed.constants,n=jsCommon.StringExtensions,a=e.common.events,l=jsCommon.Base64Utils,c=e.explore.constants,d=e.common.constants.ExploreGestures,p=jsCommon.TraceType,u=(function(){function o(e,r,t,o,i,s,n,a,l){this.rootScope=e,this.moduleLoader=r,this.embedModeService=t,this.conceptualSchemaProxy=o,this.promiseFactory=i,this.embedRouter=s,this.reportEmbedStateService=n,this.telemetryService=a,this.pbiLazyLoad=l,this.PowerBIModelsModule=this.moduleLoader.require({javascript:"powerbi-models"}),this.nextAllowedRefreshTime=new Date(1970,1,1).getTime()}return Object.defineProperty(o.prototype,"exploration",{get:function(){return this.explorationContract?this.explorationContract:this.reportEmbedStateService.baseExploration},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"requestId",{get:function(){return this.embedRouter.requestId},enumerable:!0,configurable:!0}),o.prototype.setupRequestId=function(e){this.embedRouter.requestId=e},o.prototype.startListening=function(){var e=this;this.embedRouter.setupBlock(this),this.rootScope.$on(r.services.events.reportVisualError.name,(function(r,t){return e.onReportRendered(t)})),this.rootScope.$on(c.openReportFinished,(function(r,t,o){return e.onReportLoaded(o)})),this.rootScope.$on(t.constants.reportRenderFinished,(function(r){return e.onReportRendered()})),this.rootScope.$on(a.loadPowerViewReportEventName,(function(r,t){e.explorationContract=t.exploration,e.reportEmbedStateService.reportObjectId=e.getReportObjectId()})),this.embedModeService.isMobile()&&(this.rootScope.$on(d.swipeStartEvent,(function(r,t){return e.onSwipeEvent(t,s.Events.SwipeStart)})),this.rootScope.$on(d.swipeEndEvent,(function(r,t){return e.onSwipeEvent(t,s.Events.SwipeEnd)})))},o.prototype.setupController=function(e){this.embedController=e},o.prototype.handleLoadRequest=function(r,t,o,i){return __awaiter(this,void 0,e.Promise,(function(){var e,n;return __generator(this,(function(a){switch(a.label){case 0:return this.setupRequestId(r.headers.uid),e=r.body,[4,this.handleLoad(e,o,i)];case 1:return a.sent(),n=this.requestId?void 0:s.WarningMessages.loadReportUIDMissingWarning,t.send(s.StatusCodes.Accepted,n),[2]}}))}))},o.prototype.handleLoad=function(r,t,o){return __awaiter(this,void 0,e.Promise,(function(){var i,n,a,l,c,d,p,u;return __generator(this,(function(m){n=jsCommon.QueryStringUtil.parseQueryString(),a=n.$filter||n.filter,this.embedRouter.hasLoaded=!1,this.currentConfig=r,this.id=r.id;try{i=this.embedController.load(r,t,a,o)}catch(t){this.telemetryService.logEvent(e.telemetry.ReportEmbedSDKError,this.requestId,r.id,this.embedModeService.getEmbedTypeDescription(),t.message),this.embedRouter.postError("reports",t)}return l=this.embedModeService.getEmbedTypeDescription(),c=t?e.telemetry.ReportEmbedSDKPrepareReport:e.telemetry.ReportEmbedSDKLoadReport,this.telemetryService.logEvent(c,this.requestId,r.id,l),r.settings&&(r.settings.customLayout&&(d=r.settings.customLayout,p=void 0!==d.pageSize?d.pageSize.type:void 0,this.telemetryService.logEvent(e.telemetry.ReportEmbedSDKCustomLayout,p,d.displayOption,this.requestId,r.id,l)),null!=r.settings.layoutType&&this.telemetryService.logEvent(e.telemetry.ReportEmbedSDKLoadedWithLayoutType,r.settings.layoutType)),u={statusCode:s.StatusCodes.Accepted,headers:{id:this.embedRouter.requestId},body:this.requestId?void 0:s.WarningMessages.createReportUIDMissingWarning},this.embedRouter.sendResponse(u),[2,i]}))}))},o.prototype.handleCreate=function(r,t){return __awaiter(this,void 0,e.Promise,(function(){var o,i,i;return __generator(this,(function(n){switch(n.label){case 0:return[4,this.validateCreateReport(r)];case 1:if(o=n.sent(),this.embedRouter.hasLoaded=!1,o)i={statusCode:s.StatusCodes.BadRequest,headers:{id:this.embedRouter.requestId},body:o},this.embedRouter.sendResponse(i);else{this.currentConfig=r;try{this.embedController.create(r,t)}catch(t){this.telemetryService.logEvent(e.telemetry.ReportEmbedSDKError,this.requestId,r.datasetId,this.embedModeService.getEmbedTypeDescription(),t.message),this.embedRouter.postError("reports",t)}i={statusCode:s.StatusCodes.Accepted,headers:{id:this.embedRouter.requestId},body:this.requestId?void 0:s.WarningMessages.createReportUIDMissingWarning},this.embedRouter.sendResponse(i)}return[2]}}))}))},o.prototype.setupRoutes=function(r){var o=this;r.post("/frontload/config",(function(r,t){var i=r.body;o.telemetryService.logEvent(e.telemetry.ReportEmbedLateFrontLoad,r.headers.uid,i.id)})),r.post("/report/load",(function(r,t){return __awaiter(o,void 0,e.Promise,(function(){var e;return __generator(this,(function(o){switch(o.label){case 0:return e=r.headers&&r.headers.sdkSessionId,[4,this.handleLoadRequest(r,t,!1,e)];case 1:return[2,o.sent()]}}))}))})),r.post("/report/prepare",(function(r,t){return __awaiter(o,void 0,e.Promise,(function(){return __generator(this,(function(e){switch(e.label){case 0:return[4,this.handleLoadRequest(r,t,!0)];case 1:return[2,e.sent()]}}))}))})),r.post("/report/render",(function(r,t){return __awaiter(o,void 0,e.Promise,(function(){var o,i,n;return __generator(this,(function(a){this.setupRequestId(r.headers.uid),o=r.body||this.currentConfig;try{this.embedController.render(o)}catch(r){this.telemetryService.logEvent(e.telemetry.ReportEmbedSDKError,this.requestId,this.id,this.embedModeService.getEmbedTypeDescription(),r.message),this.embedRouter.postError("reports",r)}return i=this.embedModeService.getEmbedTypeDescription(),this.telemetryService.logEvent(e.telemetry.ReportEmbedSDKRenderReport,this.requestId,this.id,i),n=this.requestId?void 0:s.WarningMessages.loadReportUIDMissingWarning,t.send(s.StatusCodes.Accepted,n),[2]}))}))})),r.post("/report/create",(function(r,t){return __awaiter(o,void 0,e.Promise,(function(){var e,o,i,n;return __generator(this,(function(a){switch(a.label){case 0:return this.setupRequestId(r.headers.uid),e=r.headers&&r.headers.sdkSessionId,o=r.body,[4,this.validateCreateReport(o)];case 1:return(i=a.sent())?(t.send(s.StatusCodes.BadRequest,i),[3,4]):[3,2];case 2:return[4,this.handleCreate(o,e)];case 3:a.sent(),n=this.requestId?void 0:s.WarningMessages.createReportUIDMissingWarning,t.send(s.StatusCodes.Accepted,n),a.label=4;case 4:return[2]}}))}))})),r.get("/report/pages",(function(r,t){var i=o.embedController.getPages();return void 0!==i?(o.telemetryService.logEvent(e.telemetry.ReportEmbedSDKGetAllPages,o.requestId,o.getReportObjectId(),o.embedModeService.getEmbedTypeDescription()),t.send(s.StatusCodes.OK,i)):(o.telemetryService.logEvent(e.telemetry.ReportEmbedSDKError,o.requestId,o.getReportObjectId(),o.embedModeService.getEmbedTypeDescription(),s.ErrorMessages.getAllPagesFailed),t.send(s.StatusCodes.InternalServerError,s.ErrorMessages.getAllPagesFailed))})),r.put("/report/pages/active",(function(r,t){return __awaiter(o,void 0,e.Promise,(function(){var o,i,n;return __generator(this,(function(a){switch(a.label){case 0:return o=r.body,[4,this.validatePage(o)];case 1:return(i=a.sent())?(t.send(s.StatusCodes.BadRequest,i),[3,4]):[3,2];case 2:return[4,this.embedController.setPage(o.name)];case 3:n=a.sent(),n&&(this.telemetryService.logEvent(e.telemetry.ReportEmbedSDKError,this.requestId,this.getReportObjectId(),this.embedModeService.getEmbedTypeDescription(),n.message),this.embedRouter.postError("reports",n)),this.telemetryService.logEvent(e.telemetry.ReportEmbedSDKSetActivePage,this.requestId,this.getReportObjectId(),this.embedModeService.getEmbedTypeDescription()),t.send(s.StatusCodes.Accepted),a.label=4;case 4:return[2]}}))}))})),r.get("/report/pages/:pageName/visuals",(function(r,i){return __awaiter(o,void 0,e.Promise,(function(){var o,n,a;return __generator(this,(function(l){switch(l.label){case 0:return this.embedModeService.isAnonymousLiveEmbed()?(o=t.HostCommunicationHelper.buildNotSupportedByPublishToWebMessage(),[2,i.send(s.StatusCodes.BadRequest,o)]):[4,this.getConceptualSchema()];case 1:return n=l.sent(),a=this.embedController.getVisuals(r.params.pageName,n),a?(this.telemetryService.logEvent(e.telemetry.ReportEmbedSDKGetAllVisuals,this.requestId,this.getReportObjectId(),this.embedModeService.getEmbedTypeDescription()),[2,i.send(s.StatusCodes.OK,a)]):(this.telemetryService.logEvent(e.telemetry.ReportEmbedSDKError,this.requestId,this.getReportObjectId(),this.embedModeService.getEmbedTypeDescription(),s.ErrorMessages.getAllVisualsFailed),[2,i.send(s.StatusCodes.InternalServerError,s.ErrorMessages.getAllVisualsFailed)])}}))}))})),r.get("/report/pages/:pageName/layoutTypes/:layoutType",(function(r,i){return __awaiter(o,void 0,e.Promise,(function(){var o,n,a,l,c;return __generator(this,(function(d){switch(d.label){case 0:return this.embedModeService.isAnonymousLiveEmbed()?(o=t.HostCommunicationHelper.buildNotSupportedByPublishToWebMessage(),[2,i.send(s.StatusCodes.BadRequest,o)]):(n=r.params.pageName,[4,this.PowerBIModelsModule]);case 1:return a=d.sent(),l=a.LayoutType[r.params.layoutType],[4,this.embedController.hasLayout(n,l)];case 2:return c=d.sent(),this.telemetryService.logEvent(e.telemetry.ReportEmbedSDKCheckPageLayoutType,l,this.requestId,this.getReportObjectId(),this.embedModeService.getEmbedTypeDescription()),[2,i.send(s.StatusCodes.OK,c)]}}))}))})),r.patch("/report/settings",(function(r,t){return __awaiter(o,void 0,e.Promise,(function(){var o,i,n=this;return __generator(this,(function(a){switch(a.label){case 0:return o=r.body,[4,this.validateSettings(o)];case 1:return(i=a.sent())?(t.send(s.StatusCodes.BadRequest,i),[2]):(t.send(s.StatusCodes.Accepted),this.embedController.updateSettings(o).then((function(r){n.telemetryService.logEvent(e.telemetry.ReportEmbedSDKUpdateSettings,n.requestId,n.getReportObjectId(),n.embedModeService.getEmbedTypeDescription()),n.embedRouter.postEvent("/reports/"+n.requestId+"/events/settingsUpdated",r)}),(function(r){n.telemetryService.logEvent(e.telemetry.ReportEmbedSDKError,n.requestId,n.getReportObjectId(),n.embedModeService.getEmbedTypeDescription(),r.message),n.embedRouter.postError("reports",r)})),[2])}}))}))})),r.post("/report/print",(function(e,r){window.print(),r.send(s.StatusCodes.Accepted)})),r.post("/report/refresh",(function(e,r){var t=Date.now();if(t>o.nextAllowedRefreshTime)o.embedController.refreshReportData(),o.nextAllowedRefreshTime=t+1e3*s.ThrottlingLimits.refreshFrequencyInSeconds,r.send(s.StatusCodes.Accepted);else{var i={message:n.format(s.ErrorMessages.tooManyRefreshRequests,s.ThrottlingLimits.refreshFrequencyInSeconds.toString())};r.headers={"Retry-After":Math.ceil((o.nextAllowedRefreshTime-t)/1e3)},r.send(s.StatusCodes.TooManyRequests,i)}})),r.post("/report/token",(function(r,t){return __awaiter(o,void 0,e.Promise,(function(){var o,i,a,l,c;return __generator(this,(function(d){switch(d.label){case 0:return o=!n.isNullOrUndefinedOrWhiteSpaceString(window.powerBIEmbedToken),[4,this.PowerBIModelsModule];case 1:return i=d.sent(),a=o?i.TokenType.Embed:null,l=r.body,(c=this.embedController.setAccessToken(l,a))?(this.telemetryService.logEvent(e.telemetry.ReportEmbedSDKError,this.requestId,this.getReportObjectId(),this.embedModeService.getEmbedTypeDescription()),[2,t.send(s.StatusCodes.BadRequest,c)]):(this.telemetryService.logEvent(e.telemetry.ReportEmbedSDKSetAccessToken,this.requestId,this.getReportObjectId(),this.embedModeService.getEmbedTypeDescription()),[2,t.send(s.StatusCodes.Accepted)])}}))}))})),r.post("/qna/load",(function(r,t){return __awaiter(o,void 0,e.Promise,(function(){var o,i,n,a,l,c=this;return __generator(this,(function(d){switch(d.label){case 0:return this.setupRequestId(r.headers.uid),o=r.headers&&r.headers.sdkSessionId,i=r.body,[4,this.validateLoadQna(i)];case 1:return n=d.sent(),n?t.send(s.StatusCodes.BadRequest,n):(a=i.datasetIds&&!_.isEmpty(i.datasetIds)?i.datasetIds[0]:"",this.currentConfig=i,this.embedController.loadQnaView(i,o).catch((function(r){c.telemetryService.logEvent(e.telemetry.QnaEmbedSDKError,c.requestId,a,r.message),c.embedRouter.postError("qna",r)})),this.telemetryService.logEvent(e.telemetry.QnaEmbedSDKLoadQna,this.requestId,a),l=this.requestId?void 0:s.WarningMessages.loadQnaUIDMissingWarning,t.send(s.StatusCodes.Accepted,l)),[2]}}))}))})),r.post("/qna/interpret",(function(r,t){return __awaiter(o,void 0,e.Promise,(function(){var o,i,n,a=this;return __generator(this,(function(l){switch(l.label){case 0:return this.ensureQnaAllowed(t),o=r.body,[4,this.validateQnaInterpretInputData(o)];case 1:return i=l.sent(),i&&t.send(s.StatusCodes.BadRequest,i),n=o.datasetIds&&!_.isEmpty(o.datasetIds)?o.datasetIds[0]:"",this.embedController.interpretQnaUtterance(o).catch((function(r){a.telemetryService.logEvent(e.telemetry.QnaEmbedSDKError,a.requestId,n,r.message),a.embedRouter.postError("qna",r)})),this.telemetryService.logEvent(e.telemetry.QnaEmbedSDKInterpretUtterance,this.requestId,n),t.send(s.StatusCodes.Accepted),[2]}}))}))})),r.post("/qna/visualize",(function(r,t){return __awaiter(o,void 0,e.Promise,(function(){var o,i;return __generator(this,(function(n){switch(n.label){case 0:this.ensureQnaAllowed(t),o=r.body,n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.embedController.visualizeQna(o)];case 2:return n.sent(),[3,4];case 3:return i=n.sent(),this.telemetryService.logEvent(e.telemetry.QnaEmbedSDKError,this.requestId,"",i.message),this.embedRouter.postError("qna",i),[3,4];case 4:return t.send(s.StatusCodes.Accepted),[2]}}))}))}))},o.prototype.getReportObjectId=function(){return this.exploration&&this.exploration.report?this.exploration.report.objectId:s.ErrorCodes.missingReportId},o.prototype.validateIcon=function(e){if(!e)return!0;var r="data:image/png;base64,";return 0===e.indexOf(r)&&l.isBase64(e.substr(r.length))},o.prototype.validateMenuExtension=function(e){var r;return e?this.validateIcon(e.icon)?r:[{message:s.ErrorMessages.invalidIcon}]:r},o.prototype.validateCommandExtension=function(e){var r;return e?this.validateIcon(e.icon)?(r=this.validateMenuExtension(e.extend.visualContextMenu),r?r:this.validateMenuExtension(e.extend.visualOptionsMenu)):[{message:s.ErrorMessages.invalidIcon}]:r},o.prototype.validateExtensions=function(e){var r;if(!e)return r;for(var t=0,o=e;t<o.length;t++){var i=o[t];if(r=this.validateCommandExtension(i.command))return r}return r},o.prototype.validateSettings=function(r){return __awaiter(this,void 0,e.Promise,(function(){var e,t;return __generator(this,(function(o){switch(o.label){case 0:return[4,this.PowerBIModelsModule];case 1:return e=o.sent(),t=e.validateSettings(r),t?[2,t]:[4,this.validateExtensions(r.extensions)];case 2:return[2,o.sent()]}}))}))},o.prototype.validatePage=function(r){return __awaiter(this,void 0,e.Promise,(function(){var e,o;return __generator(this,(function(i){switch(i.label){case 0:return[4,this.PowerBIModelsModule];case 1:return e=i.sent(),o=e.validatePage(r),o||t.ExplorationHelper.isPageExists(r.name,this.exploration)||(o=[{message:s.ErrorMessages.invalidPageName,errorCode:s.ErrorCodes.powerBIEntityNotFound}]),[2,o]}}))}))},o.prototype.validateCreateReport=function(r){return __awaiter(this,void 0,e.Promise,(function(){var e;return __generator(this,(function(t){switch(t.label){case 0:return[4,this.PowerBIModelsModule];case 1:return e=t.sent(),[2,e.validateCreateReport(r)]}}))}))},o.prototype.validateLoadQna=function(r){return __awaiter(this,void 0,e.Promise,(function(){var e;return __generator(this,(function(t){switch(t.label){case 0:return[4,this.PowerBIModelsModule];case 1:return e=t.sent(),[2,e.validateLoadQnaConfiguration(r)]}}))}))},o.prototype.validateQnaInterpretInputData=function(r){return __awaiter(this,void 0,e.Promise,(function(){var e;return __generator(this,(function(t){switch(t.label){case 0:return[4,this.PowerBIModelsModule];case 1:return e=t.sent(),[2,e.validateQnaInterpretInputData(r)]}}))}))},o.prototype.postErrorMessage=function(e){var r=t.HostCommunicationHelper.buildErrorMessage(e);window.parent.postMessage(JSON.stringify(r),"*")},o.prototype.postErrorInvalidReportId=function(){var e=s.ErrorCodes.missingReportId;this.postReportErrorEvent(t.HostCommunicationHelper.createError(e,s.ErrorMessages.missingReportId,{level:p.Fatal})),this.postErrorMessage(e)},o.prototype.postErrorInvalidVisualSettings=function(){this.postReportErrorEvent(t.HostCommunicationHelper.createError(s.ErrorCodes.invalidVisualSettings,s.ErrorMessages.invalidVisualSettings,{level:p.Error}))},o.prototype.postErrorInvalidVisualHeader=function(){this.postReportErrorEvent(t.HostCommunicationHelper.createError(s.ErrorCodes.invalidVisualHeader,s.ErrorMessages.invalidVisualHeader,{level:p.Error}))},o.prototype.postErrorInvalidAccessToken=function(){var e=s.ErrorCodes.missingAccessToken;this.postReportErrorEvent(t.HostCommunicationHelper.createError(e,s.ErrorMessages.invalidAccessToken,{level:p.Fatal})),this.postErrorMessage(e)},o.prototype.postErrorInvalidFilter=function(){var e=s.ErrorCodes.filterError;this.postReportErrorEvent(t.HostCommunicationHelper.createError(e,s.ErrorMessages.invalidFilter,{level:p.Error})),this.postErrorMessage(e)},o.prototype.postReportErrorEvent=function(e){return this.embedRouter.postError("reports",e)},o.prototype.postErrorMobileLayoutNotFound=function(e){var r=n.format(s.ErrorMessages.mobileLayoutNotFound,e);this.postReportErrorEvent(t.HostCommunicationHelper.createError(s.ErrorCodes.mobileLayoutError,r,{level:p.Warning}))},o.prototype.postErrorPageNotFound=function(e){var r=n.format(s.ErrorMessages.pageNotFound,e);this.postReportErrorEvent(t.HostCommunicationHelper.createError(s.ErrorCodes.powerBIEntityNotFound,r,{level:p.Error})),this.postErrorMessage(r)},o.prototype.isEmbedMessageProxyServiceUsed=function(){return this.requestId!==s.defaultId},o.prototype.notifyQnaVisualRendered=function(e){if(e.error){var r=t.HostCommunicationHelper.createError(s.ErrorCodes.qnaRenderFailed,n.format(s.ErrorMessages.renderQnaVisualFailed,e.userQuestion),{level:p.Error});this.embedRouter.postError("qna",r)}else{var o={question:e.userQuestion,normalizedQuestion:e.restatement};this.embedRouter.postEvent("/qna/"+this.requestId+"/events/visualRendered",o)}},o.prototype.onReportLoaded=function(e){this.loadPostReportLoadModules(),this.isEmbedMessageProxyServiceUsed()&&(e?this.postReportErrorEvent(t.HostCommunicationHelper.createError(s.ErrorCodes.reportLoadFailed,s.ErrorMessages.loadReportFailed,{level:p.Fatal})):this.embedRouter.hasLoaded||(this.embedRouter.postEvent("/reports/"+this.requestId+"/events/loaded",{initiator:void 0}),this.embedRouter.hasLoaded=!0))},o.prototype.loadPostReportLoadModules=function(){return __awaiter(this,void 0,e.Promise,(function(){return __generator(this,(function(e){return this.pbiLazyLoad.load(t.modules.InfoNavBootstrapModule),[2]}))}))},o.prototype.onSwipeEvent=function(e,r){if(this.isEmbedMessageProxyServiceUsed()){var t={currentPosition:e.currentPosition,startPosition:e.startPosition};this.embedRouter.postEvent("/reports/"+this.requestId+"/events/"+r,{initiator:void 0,swipeEvent:t})}},o.prototype.onReportRendered=function(r){var o=this.getReportObjectId();if(this.telemetryService.logEvent(e.telemetry.ReportEmbedAllVisualsRendered,this.requestId,o,this.embedModeService.getEmbedTypeDescription(),void 0!==r&&null!==r),this.isEmbedMessageProxyServiceUsed()&&o!==s.ErrorCodes.missingReportId)if(r){var i=t.HostCommunicationHelper.buildRenderedFailedError(r.error);this.embedRouter.postError("reports",i)}else this.embedRouter.postEvent("/reports/"+this.requestId+"/events/rendered",{initiator:void 0})},o.prototype.getConceptualSchema=function(){if(!this.exploration)return this.promiseFactory.reject();var e=this.exploration.dataSources;return this.conceptualSchemaProxy.get(e)},o.prototype.ensureQnaAllowed=function(e){if(this.embedModeService.isAnonymousLiveEmbed()){var r=t.HostCommunicationHelper.buildNotSupportedByPublishToWebMessage();e.send(s.StatusCodes.BadRequest,r)}if(this.embedModeService.isAppTokenEmbed()){var r=t.HostCommunicationHelper.buildNotSupportedByAppTokenEmbedMessage();e.send(s.StatusCodes.BadRequest,r)}},o})();o.ReportEmbedMessageProxyService=u,o.createEmbedMessageProxyService=i})(o=t.services||(t.services={}))})(t=r.reportembed||(r.reportembed={}))})(r=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var r;!(function(e){var r;!(function(e){var r;!(function(e){function r(){return new t}e.createExplorationContainerScopedServices=r;var t=(function(){function e(){}return e.prototype.getExplorationCapabilities=function(){return this.get("explorationCapabilities")},e.prototype.getEventBridge=function(){return this.get("eventBridge")},e.prototype.getLazyScopedService=function(){return this.get("lazyScoped")},e.prototype.getViewModeStateService=function(){return this.get("viewModeState")},e.prototype.getFormFactorProvider=function(){return this.get("formFactor")},e.prototype.setScopedProviderInstance=function(e){this.scopedProvider=e},e.prototype.get=function(e){return this.scopedProvider?this.scopedProvider.get(e):null},e})()})(r=e.services||(e.services={}))})(r=e.reportembed||(e.reportembed={}))})(r=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var r;!(function(r){var t;!(function(r){var t;!(function(r){var t=e.errorDetailsHelper,o=e.explore.reportembed.constants,i=(function(){function r(e,r,t,o,i,s,n,a,l){this.promiseFactory=e,this.httpService=r,this.telemetryService=t,this.serializer=o,this.embedModeService=i,this.editableFeatureSwitchService=s,this.explorationProxy=n,this.rootScope=a,this.uriPrefix=l,this.isInitialRequest=!0}return r.prototype.getModelsAndExplorationInternal=function(r,o){var i=this,s=this.embedModeService.getEmbedTypeDescription(),n=this.embedModeService.getPublicEmbedUrl(),a=this.embedModeService.getPublicEmbedReferrer(),l=this.telemetryService.startEvent(e.telemetry.ReportEmbedGetExplorationAndModel,this.uriPrefix,!0,null,!!window.modelsAndExplorationPromise,window.modelsAndExplorationFrontLoadStartTime?new Date(window.modelsAndExplorationFrontLoadStartTime).toISOString():null,null,r,s,n,a),c=this.promiseFactory.defer(),d=this.uriPrefix+"reports/"+r+"/modelsAndExploration?preferReadOnlySession="+o;return(window.modelsAndExplorationPromise||this.httpService.get(d,this.httpService.powerbiRequestOptions())).then((function(e){window.modelsAndExplorationPromise=null;var r=jsCommon.HttpUtils.clientAndServerRequestIdMatch(e);return r&&(l.event.info.clientAndServerRequestIdMatch=r),l.event.info.responseRequestId=window.modelsAndExplorationRequestId||jsCommon.HttpUtils.getResponseRequestId(e),l.event.info.frontLoadEnd=window.modelsAndExplorationFrontLoadEndTime?new Date(window.modelsAndExplorationFrontLoadEndTime).toISOString():null,l.resolve(),i.deserializeModelsAndExploration(e.data,c)}),(function(e){return window.modelsAndExplorationPromise=null,window.conceptualSchemaPromise=null,e&&e.error&&jsCommon.StringExtensions.isNullOrUndefinedOrWhiteSpaceString(e.error.code)&&(e.error.code="Fail to load - Could not retrieve models and explorations."),l.reject(t.getTelemetryErrorDetails(e.error,e.status)),c.reject(e?{error:e.error,requestId:e.requestId,httpStatusCode:e.status}:{})})),c.promise},r.prototype.getModelsAndExploration=function(r,t){var i=this;if("undefined"==typeof window.modelsAndExplorationResponse||this.isInitialRequest===!1)return this.getModelsAndExplorationInternal(r,t);this.isInitialRequest=!1;var s=this.promiseFactory.defer();if(window.modelsAndExplorationResponse){if(window.modelsAndExplorationResponse===o.ModelsAndExplorationState.Loading)var n=this.rootScope.$on(o.modelsAndExplorationReadyEventName,(function(){window.modelsAndExplorationResponse!==o.ModelsAndExplorationState.Error?(i.deserializeModelsAndExploration(window.modelsAndExplorationResponse,s),i.logPreloadedModelsAndExplorationTelemetryEvent(r)):e.common.shouldRetryRequest(window.frontLoadStatus)?i.getModelsAndExplorationInternal(r,t).then((function(e){return s.resolve(e)})).catch((function(e){return s.reject(e)})):(i.logPreloadedModelsAndExplorationTelemetryEvent(r),s.reject({error:window.frontLoadError,httpStatusCode:window.frontLoadStatus})),n()}));else if(window.modelsAndExplorationResponse!==o.ModelsAndExplorationState.Error)this.deserializeModelsAndExploration(window.modelsAndExplorationResponse,s),this.logPreloadedModelsAndExplorationTelemetryEvent(r);else{if(e.common.shouldRetryRequest(window.frontLoadStatus))return this.getModelsAndExplorationInternal(r,t);this.logPreloadedModelsAndExplorationTelemetryEvent(r),s.reject({error:window.frontLoadError,httpStatusCode:window.frontLoadStatus})}return s.promise}return this.getModelsAndExplorationInternal(r,t)},r.prototype.save=function(e,r,t){return this.explorationProxy.save(e,r,t)},r.prototype.saveAs=function(e,r,t,o){return this.explorationProxy.saveAs(e,r,t,o)},r.prototype.logPreloadedModelsAndExplorationTelemetryEvent=function(r){var t=this.embedModeService.getEmbedTypeDescription(),i=this.embedModeService.getPublicEmbedUrl(),s=this.embedModeService.getPublicEmbedReferrer(),n=this.telemetryService.startEvent(e.telemetry.ReportEmbedGetExplorationAndModel,this.uriPrefix,!window.isModelsAndExplorationCached,window.modelsAndExplorationRequestId,!0,window.modelsAndExplorationFrontLoadStartTime?new Date(window.modelsAndExplorationFrontLoadStartTime).toISOString():null,window.modelsAndExplorationFrontLoadEndTime?new Date(window.modelsAndExplorationFrontLoadEndTime).toISOString():null,r,t,i,s),a=Date.now()-window.modelsAndExplorationFrontLoadEndTime+window.modelsAndExplorationFrontLoadStartTime;n.event.time=a,window.modelsAndExplorationResponse!==o.ModelsAndExplorationState.Error?n.resolve():n.reject(e.errorDetailsHelper.getTelemetryErrorDetails(window.frontLoadError,window.frontLoadStatus))},r.prototype.deserializeModelsAndExploration=function(e,r){this.editableFeatureSwitchService.registerFeatureSwitches(e.featureSwitches||{});var t;t={package:e.package,models:e.models,exploration:null},t.exploration=this.serializer.deserializeExploration(this.serializer.parseExplorationConfigs(e.exploration),[],!0),this.exploration=t.exploration,r.resolve(t)},r})();r.ReportEmbedExplorationService=i})(t=r.services||(r.services={}))})(t=r.reportembed||(r.reportembed={}))})(r=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var r;!(function(r){var t;!(function(t){var o;!(function(o){function i(e,r,t,i,s,n,a,l,c){return new o.ReportEmbedFilterService(e,r,t,i,s,n,a,l,c)}var s=e.explore.reportembed.constants,n=e.common.events,a=jsCommon.TraceType,l=r.util.VisualContainerUtils,c=(function(){function o(e,r,t,o,i,s,a,l,c){var d=this;this.rootScope=e,this.promiseFactory=r,this.moduleLoader=t,this.conceptualSchemaProxy=o,this.telemetryService=i,this.aggrOps=s,this.eventBridge=a,this.filterGenerator=l,this.visualPluginOps=c,this.rootScope.$on(n.loadPowerViewReportEventName,(function(e,r){e.stopPropagation(),d.onLoadPowerViewReport(r)}))}return o.prototype.setFilters=function(r,o){return __awaiter(this,void 0,e.Promise,(function(){var e,i,n,c,d,p,u,m,v,h,g,b,y,f,S,E,C,I,w,P,x,M,R,F,T;
return __generator(this,(function(L){switch(L.label){case 0:return[4,this.getFilterContainerWithScope(o)];case 1:if(e=L.sent(),!e||!e.contract)throw t.HostCommunicationHelper.createError(s.ErrorCodes.filterError,s.ErrorMessages.setFilterFailed,{level:a.Error});return i=e.contract,[4,this.promiseFactory.all([this.getJsonFilterParser(),this.getConceptualSchema()])];case 2:return n=L.sent(),c=n[0],d=n[1],[4,this.isVisualLevelFilter(o)];case 3:if(p=L.sent(),m=[],p&&(u=l.getAutoVisualFilterContainers(this.getVisualContainer(o),this.visualPluginOps,this.filterGenerator,d,this.aggrOps)),!(r&&r.length>0))return[3,8];v=[],h=0,g=r,L.label=4;case 4:return h<g.length?(b=g[h],[4,c.tryCreateFilterContainer(i,d,b)]):[3,7];case 5:if(y=L.sent(),!y)throw t.HostCommunicationHelper.createError(s.ErrorCodes.invalidFilter,s.ErrorMessages.invalidFilter,{level:a.Error});y.howCreated=1,v.push(y),L.label=6;case 6:return h++,[3,4];case 7:if(f=i.filters,i.filters=[],f)for(S=0,E=f;S<E.length;S++)C=E[S],p&&this.checkIfAutoFilterAndPushToArray(u,C,m),this.raiseFilterChangeEvent(i,e.scopeType,C,0);if(i.filters=v,I={filters:m.concat(v)},I.filters)for(w=0,P=I.filters;w<P.length;w++)x=P[w],this.raiseFilterChangeEvent(i,e.scopeType,x,1);return[3,9];case 8:for(;i.filters&&i.filters.length>0;)M=i.filters[0],i.filters.splice(0,1),this.raiseFilterChangeEvent(i,e.scopeType,M,0),p&&this.checkIfAutoFilterAndPushToArray(u,M,m);for(R=0,F=m;R<F.length;R++)T=F[R],this.raiseFilterChangeEvent(i,e.scopeType,T,1);L.label=9;case 9:return[2]}}))}))},o.prototype.getFilters=function(r){return __awaiter(this,void 0,e.Promise,(function(){var e,o,i,n,l;return __generator(this,(function(c){switch(c.label){case 0:return[4,this.getFilterContainerWithScope(r)];case 1:if(e=c.sent(),!e||!e.contract)throw t.HostCommunicationHelper.createError(s.ErrorCodes.filterError,s.ErrorMessages.getFiltersFailed,{level:a.Error});return[4,this.promiseFactory.all([this.getJsonFilterParser(),this.getConceptualSchema()])];case 2:return o=c.sent(),i=o[0],n=o[1],l={filters:e.contract.filters},[4,this.isVisualLevelFilter(r)];case 3:return c.sent()&&this.updateContractAutoFilters(r,l,n),[2,i.tryGetFilters(l,n)]}}))}))},o.prototype.onLoadPowerViewReport=function(e){this.exploration=e.exploration},o.prototype.getConceptualSchema=function(){try{if(!this.exploration)return;var e=this.exploration.dataSources;return this.conceptualSchemaProxy.get(e)}catch(e){throw t.HostCommunicationHelper.buildIErrorFromConceptualSchemaError(e)}},o.prototype.getFilterContainerWithScope=function(r){return __awaiter(this,void 0,e.Promise,(function(){var e,o;return __generator(this,(function(i){switch(i.label){case 0:return[4,this.isVisualLevelFilter(r)];case 1:return i.sent()?(e={contract:this.getVisualContainer(r),scopeType:0},[3,4]):[3,2];case 2:return[4,this.isPageLevelFilter(r)];case 3:i.sent()?(o=r,e={contract:t.ExplorationHelper.getSectionByName(this.exploration,o.name),scopeType:1}):e={contract:this.exploration,scopeType:2},i.label=4;case 4:return[2,e]}}))}))},o.prototype.raiseFilterChangeEvent=function(e,t,o,i){var s={container:e,scopeType:t},n={filter:o,changeType:i,scope:s};this.eventBridge.publishToChannel(r.services.events.filterContainerChanged,n)},o.prototype.getVisualContainer=function(e){var r=e,o=t.ExplorationHelper.getSectionByName(this.exploration,r.pageName);return t.ExplorationHelper.getVisualContainerByName(o,r.visualName)},o.prototype.isVisualLevelFilter=function(t){return __awaiter(this,void 0,e.Promise,(function(){return __generator(this,(function(e){switch(e.label){case 0:return[4,this.loadJsonFilterModule()];case 1:return e.sent(),[2,t&&r.jsonFilter.instanceOfIVisualLevel(t)]}}))}))},o.prototype.isPageLevelFilter=function(t){return __awaiter(this,void 0,e.Promise,(function(){return __generator(this,(function(e){switch(e.label){case 0:return[4,this.loadJsonFilterModule()];case 1:return e.sent(),[2,t&&r.jsonFilter.instanceOfIPageLevel(t)]}}))}))},o.prototype.loadJsonFilterModule=function(){return __awaiter(this,void 0,e.Promise,(function(){return __generator(this,(function(e){switch(e.label){case 0:return[4,this.moduleLoader.require({javascript:"JSONFilter/services/jsonFilterParser"})];case 1:return[2,e.sent()]}}))}))},o.prototype.updateContractAutoFilters=function(e,r,t){var o=l.getAutoVisualFilterContainers(this.getVisualContainer(e),this.visualPluginOps,this.filterGenerator,t,this.aggrOps);if(!o)return[];for(var i=function(e){0===e.howCreated&&(o=o.filter((function(r){return r.expression.ref!==e.expression.ref})))},s=0,n=r.filters;s<n.length;s++){i(n[s])}return r.filters=o.concat(r.filters),o},o.prototype.checkIfAutoFilterAndPushToArray=function(r,t,o){var i=_.findIndex(r,(function(r){return e.data.SQExpr.equals(r.expression,t.expression)&&0===t.howCreated}));i!==-1&&o.push(r[i])},o.prototype.getJsonFilterParser=function(){return __awaiter(this,void 0,e.Promise,(function(){var e,r;return __generator(this,(function(o){switch(o.label){case 0:return e=this,r=this.jsonFilterParser,r?[3,2]:[4,t.JsonFilterHelper.createJsonFilterParser(this.promiseFactory,this.moduleLoader,this.telemetryService)];case 1:r=o.sent(),o.label=2;case 2:return e.jsonFilterParser=r,[2,this.jsonFilterParser]}}))}))},o})();o.ReportEmbedFilterService=c,o.createReportEmbedFilterService=i})(o=t.services||(t.services={}))})(t=r.reportembed||(r.reportembed={}))})(r=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var r;!(function(r){var t;!(function(r){var t;!(function(r){function t(e,r,t,o){return new s(e,r,t,o)}var o=e.data.dsr,i=e.explore.reportembed.constants;r.createConceptualSchemaProxyHttpCommunication=t;var s=(function(){function e(e,r,t,i){this.httpService=e,this.promiseFactory=r,this.uri=t,this.$rootScope=i,this.isInitialRequest=!0,this.proxy=o.createConceptualSchemaProxyHttpCommunication(this.httpService,this.promiseFactory,this.uri)}return e.prototype.execute=function(e,r){var t=this;if(r.event.info.endPoint=this.uri,"undefined"==typeof window.conceptualSchemaResponse||this.isInitialRequest===!1)return window.conceptualSchemaPromise?(window.conceptualSchemaPromise.then((function(){t.logPreloadedConceptualSchemaTelemetryEvent(r)})).catch((function(){t.logPreloadedConceptualSchemaTelemetryEvent(r)})),window.conceptualSchemaPromise):this.proxy.execute(e,r);this.isInitialRequest=!1;var o=this.promiseFactory.defer();if(window.conceptualSchemaResponse){if(window.conceptualSchemaResponse===i.ConceptualSchemaState.Loading)var s=this.$rootScope.$on(i.conceptualSchemaReadyEventName,(function(){window.conceptualSchemaResponse!==i.ConceptualSchemaState.Error?(t.resolvePreloadedConceptualSchema(o),t.logPreloadedConceptualSchemaTelemetryEvent(r)):t.proxy.execute(e,r).then((function(e){return o.resolve(e)})).catch((function(e){return o.reject(e)})),s()}));else{if(window.conceptualSchemaResponse===i.ConceptualSchemaState.Error)return this.proxy.execute(e,r);this.resolvePreloadedConceptualSchema(o),this.logPreloadedConceptualSchemaTelemetryEvent(r)}return o.promise}return this.proxy.execute(e,r)},e.prototype.resolvePreloadedConceptualSchema=function(e){var r={requestId:window.conceptualSchemaResponseRequestId,schemas:window.conceptualSchemaResponse.schemas};e.resolve(r)},e.prototype.logPreloadedConceptualSchemaTelemetryEvent=function(e){var r=Date.now()-window.conceptualSchemaDuration;e.event.time=r,e.event.info.clientAndServerRequestIdMatch=!window.isConceptualSchemaCached,e.event.info.responseRequestId=window.isConceptualSchemaCached?window.conceptualSchemaResponseRequestId:window.conceptualSchemaRequestId,e.event.info.requestId=window.conceptualSchemaRequestId},e})()})(t=r.services||(r.services={}))})(t=r.reportembed||(r.reportembed={}))})(r=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var r;!(function(r){var t;!(function(r){var t;!(function(r){function t(e,r,t,o,i){return new h(e,r,t,o,i)}function o(e,r,t){var o=e?s.dynamicGridWidth:s.dynamicGridHeight,i=0;t&&(i=e?p+u:m+v);var n=e?0:d;return o*r+2*s.dynamicGridItemSpacing*(r-1)-i-n}function i(r,t,o,i){var s=t.tooltipsEnabled;i=i?_.clone(i):{};var a=i.steppedLine;switch(r){case e.visuals.plugins.barChart.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.barChart,(function(e){var r=e.module;return r.createCartesianChart({chartType:6,tooltipsEnabled:s,animator:r.createDashboardColumnChartAnimator(),animateCategoryAxis:!0,animateValueAxis:!0})}),i);case e.visuals.plugins.clusteredBarChart.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.clusteredBarChart,(function(e){var r=e.module;return r.createCartesianChart({chartType:5,tooltipsEnabled:s,animator:r.createDashboardColumnChartAnimator(),animateCategoryAxis:!0,animateValueAxis:!0})}),i);case e.visuals.plugins.clusteredColumnChart.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.clusteredColumnChart,(function(e){var r=e.module;return r.createCartesianChart({chartType:3,tooltipsEnabled:s,animator:r.createDashboardColumnChartAnimator(),animateCategoryAxis:!0,animateValueAxis:!0})}),i);case e.visuals.plugins.columnChart.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.columnChart,(function(e){var r=e.module;return r.createCartesianChart({chartType:4,tooltipsEnabled:s,animator:r.createDashboardColumnChartAnimator(),animateCategoryAxis:!0,animateValueAxis:!0})}),i);case e.visuals.plugins.dataDotClusteredColumnComboChart.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.dataDotClusteredColumnComboChart,(function(e){return e.module.createCartesianChart({chartType:16,tooltipsEnabled:s,animateCategoryAxis:!0,animateValueAxis:!0})}),i);case e.visuals.plugins.dataDotStackedColumnComboChart.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.dataDotStackedColumnComboChart,(function(e){return e.module.createCartesianChart({chartType:17,tooltipsEnabled:s,animateCategoryAxis:!0,animateValueAxis:!0})}),i);case e.visuals.plugins.donutChart.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.donutChart,(function(){return new e.visuals.DonutChart({tooltipsEnabled:s})}),i);case e.visuals.plugins.funnel.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.funnel,(function(){return new e.visuals.FunnelChart({tooltipsEnabled:s})}),i);case e.visuals.plugins.gauge.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.gauge,(function(r){return r.module.createGauge({animator:new e.visuals.BaseAnimator,tooltipsEnabled:s})}),i);case e.visuals.plugins.hundredPercentStackedBarChart.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.hundredPercentStackedBarChart,(function(e){return e.module.createCartesianChart({chartType:7,tooltipsEnabled:s,animateCategoryAxis:!0,animateValueAxis:!0})}),i);case e.visuals.plugins.hundredPercentStackedColumnChart.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.hundredPercentStackedColumnChart,(function(e){return e.module.createCartesianChart({chartType:8,tooltipsEnabled:s,animateCategoryAxis:!0,animateValueAxis:!0})}),i);case e.visuals.plugins.lineChart.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.lineChart,(function(e){return e.module.createCartesianChart({chartType:0,tooltipsEnabled:s,animateCategoryAxis:!0,animateValueAxis:!0,steppedLine:a})}),i);case e.visuals.plugins.areaChart.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.areaChart,(function(e){return e.module.createCartesianChart({chartType:1,tooltipsEnabled:s,animateCategoryAxis:!0,animateValueAxis:!0,steppedLine:a})}),i);case e.visuals.plugins.stackedAreaChart.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.stackedAreaChart,(function(e){return e.module.createCartesianChart({chartType:2,tooltipsEnabled:s,animateCategoryAxis:!0,animateValueAxis:!0,steppedLine:a})}),i);case e.visuals.plugins.lineClusteredColumnComboChart.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.lineClusteredColumnComboChart,(function(e){return e.module.createCartesianChart({chartType:14,tooltipsEnabled:s,animateCategoryAxis:!0,animateValueAxis:!0,steppedLine:a})}),i);case e.visuals.plugins.lineStackedColumnComboChart.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.lineStackedColumnComboChart,(function(e){return e.module.createCartesianChart({chartType:15,tooltipsEnabled:s,animateCategoryAxis:!0,animateValueAxis:!0,steppedLine:a})}),i);case e.visuals.plugins.pieChart.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.pieChart,(function(){return new e.visuals.DonutChart({sliceWidthRatio:0,tooltipsEnabled:s})}),i);case e.visuals.plugins.ribbonChart.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.ribbonChart,(function(e){var r=e.module;return r.createCartesianChart({chartType:9,tooltipsEnabled:s,animator:r.createDashboardColumnChartAnimator(),animateCategoryAxis:!0,animateValueAxis:!0})}),i);case e.visuals.plugins.scatterChart.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.scatterChart,(function(e){return e.module.createCartesianChart({chartType:10,tooltipsEnabled:s,animateCategoryAxis:!0,animateValueAxis:!0,scatterWithMatrixDV:i&&i.scatterWithMatrixDV,scatterXYGrouping:i&&i.scatterXYGrouping})}),i);case e.visuals.plugins.treemap.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.treemap,(function(e){return new e.module.Treemap({isScrollable:!1,tooltipsEnabled:s})}),i);case e.visuals.plugins.waterfallChart.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.waterfallChart,(function(e){return e.module.createCartesianChart({chartType:13,tooltipsEnabled:s,animateCategoryAxis:!0,animateValueAxis:!0,waterfallBreakdown:i&&i.waterfallBreakdown})}),i);case e.visuals.plugins.map.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.map,(function(){return new e.visuals.Map({tooltipsEnabled:s,disableZooming:!0,disablePanning:!0})}),i);case e.visuals.plugins.filledMap.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.filledMap,(function(){return new e.visuals.Map({filledMap:!0,tooltipsEnabled:s,disableZooming:!0,disablePanning:!0})}),i);case e.visuals.plugins.shapeMap.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.shapeMap,(function(e){return new e.module.ShapeMap({tooltipsEnabled:s})}),i);case e.visuals.plugins.matrix.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.matrix,(function(){return new e.visuals.Matrix}),i);case e.visuals.plugins.tableEx.name:var c=l.createDashboardConstructorOptions();return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.tableEx,(function(){return new e.visuals.TableEx(c,i)}),i);case e.visuals.plugins.pivotTable.name:var d=n.createDashboardConstructorOptions();return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.pivotTable,(function(){return new e.visuals.PivotTable(d,i)}),i);case e.visuals.plugins.realTimeLineChart.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.realTimeLineChart,(function(e){var r=e.module;return r.createCartesianChart({chartType:18,animator:r.createRealTimeLineChartAnimator(),animateCategoryAxis:!0,animateValueAxis:!0})}),i);case e.visuals.plugins.table.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.table,(function(){return new e.visuals.Table}),i);case e.visuals.plugins.card.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.card,(function(e){return e.module.createCard({cardSmallViewportProperties:o.cardSmallViewportProperties,tooltipsEnabled:s})}),i);case e.visuals.plugins.textbox.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.textbox,(function(e){var r=e.module;return r.createTextbox({viewModelAdapter:r.createTextboxViewModelAdapter(o.textboxSmallViewportProperties),disableScrollingInViewMode:!0})}),i);case e.visualHost.EsriVisual:return e.visuals.plugins[e.visualHost.EsriVisual]?e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins[e.visualHost.EsriVisual],e.visuals.plugins[e.visualHost.EsriVisual].create,i):null;default:return e.Prototype.inherit(e.visuals.plugins[r])}}var s=e.common.GridLayoutConstants,n=e.visuals.PivotTableOptions,a=e.visualHost.utils.ResourcePackageUtils,l=e.visuals.TableExOptions,c=e.visualHost.visualPluginServiceHelpers.VisualPluginStorage,d=42,p=10,u=10,m=0,v=8;r.createVisualPluginService=t;var h=(function(){function r(r,t,s,n,a){var l=this;this.asyncFeatureSwitchService=r,this.promiseFactory=t,this.resourceLoader=s,this.telemetryService=n,this.storage=new c;var d=o(!0,2,!1),p=o(!0,4,!0),u=o(!1,3,!0),m={cardSmallViewportProperties:{cardSmallViewportWidth:d},textboxSmallViewportProperties:{minWidthToScaleFontSize:p,minHeightToScaleFontSize:u}};this.initBuiltInPlugins=this.asyncFeatureSwitchService.getFeatureSwitches().then((function(r){for(var t in e.visuals.plugins)l.storage.loadPlugin(t,i(t,a,m,r))}))}return r.prototype.ensureBuiltInPlugins=function(){return this.initBuiltInPlugins},r.prototype.getVisuals=function(){return this.storage.getLoadedPlugins()},r.prototype.ensureTrustedVisualPlugins=function(e){c.ensureTrustedVisualPlugins(this.storage,e)},r.prototype.ensurePlugins=function(e,r){var t=[];if(e&&e.length)for(var o=0,i=e;o<i.length;o++){var s=i[o];a.isCustomVisualResourcePackage(s)&&t.push(this.ensurePlugin(s,!1))}return this.promiseFactory.allSettled(t)},r.prototype.ensurePlugin=function(e,r){return c.ensurePlugin(this.storage,this.promiseFactory,this.resourceLoader,e,!1,this.telemetryService)},r.prototype.getPlugin=function(r){var t=this.storage.getLoadedPlugin(r);return!t&&e.visuals.plugins[r]&&(this.storage.loadPlugin(r,e.Prototype.inherit(e.visuals.plugins[r])),t=this.storage.getLoadedPlugin(r)),t},r.prototype.capabilities=function(e){var r=this.getPlugin(e);return r?r.capabilities:void 0},r.prototype.isCustomVisual=function(r){return e.visualHost.utils.isCustomVisual(this.getPlugin(r),r)},r.prototype.getInteractivityOptions=function(){return{overflow:"hidden",isVisualInteractive:!1}},r.prototype.getTelemetryHostInformation=function(){return{name:"ReportEmbed"}},r.prototype.isScriptVisual=function(r){return e.visualHost.utils.isScriptVisual(this.getPlugin(r))},r.prototype.isScriptVisualQueryable=function(r){return e.visualHost.utils.isScriptVisualQueryable(r,this.asyncFeatureSwitchService.featureSwitches)},r.prototype.isLightWeightRenderingVisual=function(r){return e.visualHost.utils.isLightWeightRenderingVisual(this.getPlugin(r))},r.prototype.getStorage=function(){return this.storage},r})()})(t=r.services||(r.services={}))})(t=r.reportembed||(r.reportembed={}))})(r=e.explore||(e.explore={}))})(powerbi||(powerbi={})),define("PowerBIReportEmbed/services/qnaService",["require","exports"],(function(e,r){function t(e,r,t,o,i,s){return new c(e,r,t,o,i,s)}Object.defineProperty(r,"__esModule",{value:!0});var o=powerbi.explore.reportembed.constants,i=powerbi.explore.infonav,s=powerbi.explore.infonav.util.InterpretResultUtility,n=powerbi.infonav.utils.InterpretUtil,a=powerbi.explore.reportembed.HostCommunicationHelper,l=1e4;r.create=t;var c=(function(){function e(e,r,t,o,i,s){this.promiseFactory=e,this.timeoutService=r,this.interpretService=t,this.telemetryService=o,this.editableFeatureSwitchService=i,this.embedMessageProxyService=s,this.interpretListener=null,this.data=null}return e.prototype.interpretInputUtterance=function(e){var r=this.data.models;if(!_.isEmpty(e.datasetIds)){var t=_.map(this.data.models,(function(e){return e.dbName}));if(!_.isEmpty(_.difference(e.datasetIds,t)))return this.promiseFactory.reject(a.buildInterpretUtteranceFailedError(e.utterance,o.ErrorMessages.interpretUtteranceNonValidDatasetCollection));r=_.filter(this.data.models,(function(r){return _.some(e.datasetIds,(function(e){return e===r.dbName}))}))}return this.interpretUtteranceInternal(r,e.utterance)},e.prototype.visualizeQna=function(e){var r=new i.models.InterpretResponse(e.utterance,[]);this.interpretListener.onInterpretSuccess(r,e,null,!0)},e.prototype.interpretUtterance=function(){return this.interpretUtteranceInternal(this.data.models,this.data.utterance)},e.prototype.interpretUtteranceInternal=function(e,r){var t,o=this,i={};return t=this.interpretService.interpret(r,70,_.map(e,(function(e){return n.createInterpretRequestScope(e)})),null,i,this.timeoutService(_.noop,l),"Embedded",!0),t.then((function(e){var t=null;return!e||e.isEmpty(!0)||e.result.isEmpty(!0)?o.interpretListener.onInterpretError(r,!1):(o.editableFeatureSwitchService.registerFeatureSwitches(e.featureSwitches),t=s.parseInterpret(e.result),t?o.interpretListener.onInterpretSuccess(e,t,null,!0):o.interpretListener.onInterpretError(e?e.utterance:null,!1)),t}),(function(){throw o.interpretListener.onInterpretError(r,!1),a.buildInterpretUtteranceFailedError(r)}))},e.prototype.setInterpretListener=function(e){this.interpretListener=e},e.prototype.notifyQnaVisualRendered=function(e){return __awaiter(this,void 0,powerbi.Promise,(function(){return __generator(this,(function(r){return this.embedMessageProxyService.notifyQnaVisualRendered(e),[2]}))}))},Object.defineProperty(e.prototype,"InputData",{get:function(){return this.data},set:function(e){this.data=e},enumerable:!0,configurable:!0}),e})()})),define("PowerBIReportEmbed/services/reportEmbedMobileService",["require","exports"],(function(e,r){function t(e){return new n(e)}Object.defineProperty(r,"__esModule",{value:!0});var o=powerbi.explore.constants.ExploreCanvasConstants,i=powerbi.explore.viewModels;r.create=t;var s;!(function(e){e.PortraitTemplateName="PortraitExploreConfiguration",e.LandscapeTemplateName="LandscapeExploreConfiguration"})(s||(s={}));var n=(function(){function e(e){this.scopedServices=e,this.exploreTemplates=this.getExploreTemplates()}return e.prototype.setExploreConfiguration=function(e,r){var t=this.findTemplate(e,r);this.handleViewport(t.disableTouchZoom);var o=this.scopedServices.getViewModeStateService();return o&&o.updateConfig((function(e){var r=e.displayOptions,o=e.touchOptions;e.visualDoubleClickEnabled=t.visualDoubleClickEnabled,r.hideNavigationPane=t.hideFooter,r.hideInFocusBar=t.hideInFocusBar,r.hideTileMenu=t.hideTileMenu,r.hideInFocusTileMenu=t.hideInFocusTileMenu,r.canShowCanvasWatermark=t.canShowCanvasWatermark,r.disableFadeout=t.disableFadeout,r.hideCanvasSwipeHandles=t.hideCanvasSwipeHandles,r.extendBackgroundToWholeCanvas=t.extendBackgroundToWholeCanvas,r.showVisualBordersInViewMode=!t.hideVisualBordersInViewMode,o.deselectVisualOnCanvasScroll=t.deselectVisualOnCanvasScroll,o.disableCanvasPinch=t.disableCanvasPinch,o.disableCanvasScrollOnSelectedVisual=t.disableCanvasScrollOnSelectedVisual,o.isCanvasSwipeable=t.isCanvasSwipeable,o.touchEventsOnSelectedVisualOnly=t.touchEventsOnSelectedVisualOnly,o.disableTouchZoom=!1})),t},e.prototype.enableMobileCapabilities=function(){var e=this.scopedServices.getViewModeStateService();e&&e.updateConfig((function(e){e.visualDoubleClickEnabled=!0,e.touchOptions.isCanvasSwipeable=!0}))},e.prototype.setFormFactor=function(e,r){if(e&&e.exploration&&e.exploration.contract){var t=this.scopedServices.getFormFactorProvider();t&&(this.updateDisplayOptions(e.exploration,r),t.changeFormFactor(r.canvasLayout,e))}},e.prototype.hasPortraitLayout=function(e,r){var t;return t=r?r:e.sections[e.activeSectionIndex],_.some(t.visualContainers,(function(e){return e.layouts.withId(1)}))},e.prototype.adjustMobileLayout=function(e){var r=this.adjustCanvas(e),t=e.sections[e.activeSectionIndex];this.adjustMobileCanvasSize(t,r)},e.prototype.getExploreCapabilityOptions=function(e,r,t){var o=this.findTemplate(e,t);return r.visualContainerOptions.showContextMenu=!o.hideVisualContextMenu,r.visualContainerOptions.hideHeader=o.hideTileMenu,r.showVisualizationPane=!o.hideFilterPane,r.visualContainerOptions.disableInFocus=!o.disableTouchZoom,r},e.prototype.handleViewport=function(e){var r=e?1:3,t=e?"no":"yes";this.setViewPort(1,r,t,t)},e.prototype.setViewPort=function(e,r,t,o){var i='<meta name="viewport" content="initial-scale='+e+", maximum-scale="+r+", user-scalable="+t+", shrink-to-fit="+o+'">',s=$('head [name="viewport"]');0!==s.length&&s.remove(),$("head").append(i)},e.prototype.findTemplate=function(e,r){var t;switch(r){case e.LayoutType.MobilePortrait:t=s.PortraitTemplateName;break;case e.LayoutType.MobileLandscape:t=s.LandscapeTemplateName}for(var o=0,i=this.exploreTemplates;o<i.length;o++){var n=i[o];if(n.templateName===t)return n}},e.prototype.adjustMobileCanvasSize=function(e,r){if(e){for(var t=0,s=0,n=0,a=e.visualContainers;n<a.length;n++){var l=a[n],c=l.layouts.withId(1);if(c){t=r;var d=c.position,p=d.y+d.height;s=Math.max(s,p)}}i.FixedPhoneCanvasSettings.phoneHeight=Math.max(s,o.PhoneAuthoringViewportHeight)+t}},e.prototype.adjustCanvas=function(r){for(var t=0,s=Math.min(innerHeight,innerWidth),n=0,a=r.sections;n<a.length;n++){var l=a[n],c=(s-o.ScrollbarOffset)/l.size.width;this.adjustLayout(l,{layout:0,scale:c,visualShiftDown:e.UnscaledExplorationHeaderMargin,canvasBottomMargin:e.UnscaledExplorationFooterMargin});var d=(s-o.ScrollbarOffset)/i.FixedPhoneCanvasSettings.phoneWidth;t=this.adjustLayout(l,{layout:1,scale:d,visualShiftDown:e.UnscaledExplorationHeaderMargin,canvasBottomMargin:e.UnscaledExplorationFooterMargin+e.PhoneCanvasBottomVisualMargin})}return t},e.prototype.adjustLayout=function(e,r){for(var t=(r.visualShiftDown||0)/r.scale,o=(r.canvasBottomMargin||0)/r.scale,i=0,s=e.visualContainers;i<s.length;i++){var n=s[i],a=n.layouts.withId(r.layout);if(a){a.position.y+=t}}var l=t+o;return 0===r.layout&&(e.size.height+=l),l},e.prototype.updateDisplayOptions=function(e,r){for(var t=0,o=e.contract.sections;t<o.length;t++){var i=o[t];_.isNumber(r.sectionDisplayOption)?i.size.displayOption=r.sectionDisplayOption:0===i.size.displayOption&&(i.size.displayOption=2)}},e.prototype.getExploreTemplates=function(){return[{templateName:s.PortraitTemplateName,canShowCanvasWatermark:!0,canvasLayout:1,disableCanvasPinch:!0,hideFilterPane:!0,hideFooter:!0,hideTileMenu:!1,sectionDisplayOption:2,hideInFocusBar:!1,hideInFocusTileMenu:!0,isCanvasSwipeable:!0,deselectVisualOnCanvasScroll:!0,disableCanvasScrollOnSelectedVisual:!0,touchEventsOnSelectedVisualOnly:!0,visualDoubleClickEnabled:!0,hideVisualContextMenu:!0,disableFadeout:!1,disableTouchZoom:!0,hideCanvasSwipeHandles:!1,extendBackgroundToWholeCanvas:!0,hideVisualBordersInViewMode:!1},{templateName:s.LandscapeTemplateName,canShowCanvasWatermark:!1,canvasLayout:0,disableCanvasPinch:!1,hideFilterPane:!0,hideFooter:!0,hideTileMenu:!1,sectionDisplayOption:2,hideInFocusBar:!1,hideInFocusTileMenu:!0,isCanvasSwipeable:!0,deselectVisualOnCanvasScroll:!1,disableCanvasScrollOnSelectedVisual:!1,touchEventsOnSelectedVisualOnly:!0,visualDoubleClickEnabled:!1,hideVisualContextMenu:!0,disableFadeout:!1,disableTouchZoom:!1,hideCanvasSwipeHandles:!1,extendBackgroundToWholeCanvas:!1,hideVisualBordersInViewMode:!0}]},e.UnscaledExplorationHeaderMargin=10,e.PhoneCanvasBottomVisualMargin=3,e.UnscaledExplorationFooterMargin=1,e})()})),define("PowerBIReportEmbed/services/reportEmbedVisualSettingsService",["require","exports"],(function(e,r){function t(e){return new s(e)}Object.defineProperty(r,"__esModule",{value:!0});var o=powerbi.explore.viewModels.PropertyCardNames,i=powerbi.explore.reportembed.SelectorsHelper;r.create=t;var s=(function(){function e(e){this.embedMessageProxyService=e}return e.prototype.applySettings=function(e,r,t){var o=t&&t.visualSettings;if(o)return this.validateVisualSettings(e,o),this.applyVisualSettings(r,o)},e.prototype.validateVisualSettings=function(e,r){var t=e.validateVisualSettings(r);if(t)throw this.embedMessageProxyService.postErrorInvalidVisualSettings(),t;for(var o=[],i=0,s=r.visualHeaders;i<s.length;i++){var n=s[i];e.validateVisualHeader(n)?this.embedMessageProxyService.postErrorInvalidVisualHeader():o.push(n)}r.visualHeaders=o},e.prototype.applyVisualSettings=function(e,r){for(var t=e&&e.settings&&e.settings.hideVisualContainerHeader,o=[],s=0,n=0,a=e.sections;n<a.length;n++){for(var l=a[n],c=s===e.activeSectionIndex,d=0,p=l.visualContainers;d<p.length;d++){var u=p[d],m=!1,v=void 0;t&&(v=v||{},v.visible=!1,m=!0);for(var h=0,g=r.visualHeaders;h<g.length;h++){var b=g[h];i.match(u,b.selector)&&(v=v||{},_.merge(v,b.settings),m=!0)}this.updateVisualContainerObjects(u,v),c&&m&&o.push(u)}s++}return t&&r.visualHeaders&&r.visualHeaders.length>0&&(e.settings.hideVisualContainerHeader=!1),o},e.prototype.updateVisualContainerObjects=function(e,r){e&&e.config&&e.config.singleVisual&&r&&Object.keys(r).length>0&&(e.config.singleVisual.vcObjects=e.config.singleVisual.vcObjects||{},powerbi.explore.services.applyPropertyChanges({merge:[{objectName:o.VisualHeader,properties:{show:r.visible},selector:void 0}]},powerbi.explore.contracts.VisualContainer.CommonObjectDescriptors,e.config.singleVisual.vcObjects))},e})()}));var reportEmbedController,globalErrorService,globalWindowService,globalEmbedModeService,isShowSignInMessagePending,tokenPassedFromView,reportIdPassedFromView,perfMarkers=powerbi.common.perfMarkers,telemetry=powerbi.telemetry,powerbi;!(function(e){var r;!(function(r){var t;!(function(r){function t(r){var t=[{name:"LogoBar",blockType:1,consumerHostFlags:10},{name:"LogoBarNavigation",blockType:1,consumerHostFlags:10},{name:"LogoBarSocialSharing",blockType:1,consumerHostFlags:10},{name:"QnaContainer",blockType:2,consumerHostFlags:10},{name:"TextSlideAnimation",blockType:1,consumerHostFlags:10}];e.common.registerBuildingBlocksForHost(r,t,{componentsTarget:"powerbi.reportembed",componentsMap:e.explore.reportembed.components,directivesTarget:"powerbi.reportembed",directivesMap:e.explore.reportembed.directives})}var o=e.common.helpers.LoadQna,i=jsCommon.QueryStringUtil,s=e.explore.services.undoRedoStrategy.UndoRedoNoOp,n=["ui.router","powerbi.common","powerbi.explore","powerbi.connectivity","powerbi.dataServices","ngSanitize"];window.isMobile&&n.push("powerbi.mobileOptimization");var a=i.getQueryStringValue("isE2ERun")||i.getQueryStringValue("isE2ERun2")||window.DEBUG||window.isMobile,l=2;angular.module("powerbi.reportembed",n).config(["$compileProvider",function(e){a||e.debugInfoEnabled(!1),e.commentDirectivesEnabled(!1),e.cssClassDirectivesEnabled(!1)}]).config(["$httpProvider",function(e){e.useApplyAsync(!0)}]).config(["$stateProvider","$urlRouterProvider","$locationProvider",function(t,i,s){s.html5Mode(!0),i.otherwise("/reportEmbed"),t.state("reportEmbed",{url:"/reportEmbed?&unmin&reportId",templateUrl:"views/interactiveEmbed.html",reloadOnSearch:!1,controller:"ReportEmbedController",resolve:e.common.helpers.LoadJQueryUI}).state("embedLive/live/report",{url:"/embedLive/live/report.html?unmin&key",templateUrl:"views/interactiveEmbed.html",reloadOnSearch:!1,controller:"ReportEmbedController",resolve:e.common.helpers.LoadJQueryUI}).state("view",{url:"/view?unmin&key&r",templateUrl:"views/interactiveEmbed.html",reloadOnSearch:!1,controller:"ReportEmbedController",resolve:e.common.helpers.LoadJQueryUI}).state("appTokenReportEmbed",{url:"/appTokenReportEmbed?unmin&reportid",templateUrl:"views/interactiveEmbed.html",
reloadOnSearch:!1,controller:"ReportEmbedController"}).state(r.constants.Embed.States.QnA.Interactive,{name:r.constants.Embed.States.QnA.Interactive,template:"<qna-container></qna-container>",data:{qnaInputControl:!0},resolve:o}).state(r.constants.Embed.States.QnA.EmbedResult,{name:r.constants.Embed.States.QnA.EmbedResult,template:"<qna-container></qna-container>",data:{qnaInputControl:!1},resolve:o})}]).config(["pbiLazyLoadProvider",function(e){e.setHostEnv(l)}]).config(["lazyProvider",function(r){var t=r.factories;t.reportEmbedVisualSettings={source:{javascript:"PowerBIReportEmbed/services/reportEmbedVisualSettingsService"},ng:["embedMessageProxyService"],fn:function(e,r){return e.create(r)}},t.odataFilterParserService={source:{javascript:"ODataFilterParser/services/odataFilterParserService"},ng:["featureSwitchService","telemetryService"],fn:function(e,r,t){return e.create(r,t)}},t.pushAccessHttp={source:{javascript:"Sharing/proxies/pushAccessHttp"},fn:function(r){return r.create(e.common.httpService)}}}]).run(["lazyScopedFactories",function(t){t.loadProgressNotification={source:{javascript:"PowerBICommon/services/loadProgressNotificationService"},ng:["$timeout","$rootScope","ngZone"],fn:function(e,t,o,i){var s=function(){o.$emit(r.constants.reportRenderFinished)},n=_.noop;return e.create(t,s,n,i)}},t.reportEmbedMobileService={source:{javascript:"PowerBIReportEmbed/services/reportEmbedMobileService"},ng:["explorationContainerScopedServices"],fn:function(e,r){return e.create(r)}},t.reportEmbedCustomLayout={source:{javascript:"PowerBIReportEmbed/services/reportEmbedCustomLayoutService"},ng:["explorationContainerScopedServices","embedMessageProxyService","sdkModelsConverter"],fn:function(e,r,t,o){return e.create(r,t,o)}},t.interpretProxy={source:{javascript:"QnaWeb/proxies/interpretHttpProxy"},ng:["$timeout","promiseFactory","impersonationService"],fn:function(r,t,o,i){return r.create(t,o,e.common.httpService,i)}},t.qnaService={source:{javascript:"PowerBIReportEmbed/services/qnaService"},ng:["promiseFactory","$timeout","telemetryService","editableFeatureSwitchService","$rootScope","embedMessageProxyService"],scoped:["interpretService"],fn:function(e,r,t,o,i,s,n,a){return e.create(r,t,a,o,i,n)}},t.reportEmbedSlicersApiService={source:{javascript:"PowerBIReportEmbed/services/reportEmbedSlicersApiService"},ng:["conceptualSchemaProxy","embedModeService","embedRouter","moduleLoader","reportEmbedState","promiseFactory","telemetryService"],scoped:["dataSources","eventBridge","filterCapabilitiesService","filterGenerator","visualAuthoring","visualPlugin"],fn:function(e,r,t,o,i,s,n,a,l,c,d,p,u,m){return e.create({conceptualSchemaProxy:r,embedModeService:t,embedRouter:o,moduleLoader:i,reportEmbedState:s,promiseFactory:n,telemetryService:a,dataSources:l,eventBridge:c,filterCapabilitiesService:d,filterGenerator:p,visualAuthoring:u,visualPlugin:m})}}}]).factory("explorationProxy",["promiseFactory","explorationSerializer","telemetryService","featureSwitchService","activeFolderId",function(r,t,o,i,s){var n=window.getExplorationUrl||"explore/";return e.explore.proxies.createExplorationProxy(r,e.common.httpService,t,o,i,n)}]).factory("explorationContainerScopedServices",(function(){return r.services.createExplorationContainerScopedServices()})).service("reportEmbedExplorationService",["telemetryService","$rootScope","promiseFactory","explorationSerializer","embedModeService","editableFeatureSwitchService","explorationProxy",function(t,o,i,s,n,a,l){var c=window.getExplorationUrl||"explore/";return new r.services.ReportEmbedExplorationService(i,e.common.httpService,t,s,n,a,l,o,c)}]).factory("syncService",["$timeout","promiseFactory","delayedQueryResultHandler","telemetryService","httpService",function(r,t,o,i,s){var n=e.common.createSyncService(r,t,i,s),a=e.common.createDelayedQueryResultResolver(n,r,i,s);return o.setQueryResolver(a),n}]).factory("folderService",(function(){return[]})).factory("contentPackService",(function(){return[]})).factory("reportService",(function(){return[]})).factory("dashboardService",(function(){return[]})).factory("workbookService",(function(){return[]})).factory("userNotificationInfo",(function(){return[]})).factory("usageMetricsReport",(function(){return[]})).factory("selectGatewayService",(function(){return[]})).factory("appService",["promiseFactory",function(r){return e.dataServices.createMockAppService(r)}]).factory("fullScreen",["$rootScope","$document",function(e,t){return r.services.createFullScreenService(e,t)}]).factory("visualPlugin",["asyncFeatureSwitchService","promiseFactory","resourceLoader","telemetryService",function(e,t,o,i){return r.services.createVisualPluginService(e,t,o,i,{tooltipsEnabled:!0})}]).factory("modelService",(function(){return new r.services.MockModelService})).factory("geolocationService",e.visuals.services.createGeolocation).factory("modelConverter",["dataServiceModelConverter",function(e){return r.models.createModelConverter(e)}]).factory("licenseEnforcementService",(function(){return[]})).factory("trustedVisual",["promiseFactory","localizationService","visualConsent","approvedResourceService","visualSandbox","resourceLoader","telemetryService",function(r,t,o,i,s,n,a){var l=e.visualHost.createTrustedVisualService(r,a,o,i,s,n);return l.registerTrustedVisual([e.visualHost.EsriVisual],e.explore.utils.EsriVisualHelper.createEmbedRegisterTrustedVisualOptions(r,t)),l.registerTrustedVisual([e.visualHost.VisioVisual,e.visualHost.VisioDFVisual],e.explore.utils.VisioVisualHelper.createVisioVisualRegisterOptions()),l.registerTrustedVisual([e.visualHost.PowerAppsVisual],e.explore.utils.PowerAppsVisualHelper.createPowerAppsVisualRegisterOptions()),l.registerTrustedVisual([e.visualHost.GlobeMapVisual],e.explore.utils.GlobeMapVisualHelper.createGlobeMapVisualRegisterOptions()),l.registerTrustedVisual([e.visualHost.MapboxVisual],e.explore.utils.MapboxVisualHelper.createMapboxVisualRegisterOptions()),l.registerTrustedVisual([e.visualHost.PowerOnDEMatrixV2Visual],e.explore.utils.PowerOnDEMatrixV2VisualHelper.createDEMatrixV2VisualRegisterOptions()),l.registerTrustedVisual([e.visualHost.PowerOnDEMatrixV3Visual],e.explore.utils.PowerOnDEMatrixV3VisualHelper.createDEMatrixV3VisualRegisterOptions()),l.registerTrustedVisual([e.visualHost.PowerOnDetailReportVisual],e.explore.utils.PowerOnDetailReportVisualHelper.createDetailReportVisualRegisterOptions()),l.registerTrustedVisual([e.visualHost.PowerOnSmartFilterVisual],e.explore.utils.PowerOnSmartFilterVisualHelper.createSmartFilterVisualRegisterOptions()),l.registerTrustedVisual([e.visualHost.PowerOnTableEditorVisual],e.explore.utils.PowerOnTableEditorVisualHelper.createTableEditorVisualRegisterOptions()),l.registerTrustedVisual([e.visualHost.PowerOnTableEditorV2Visual],e.explore.utils.PowerOnTableEditorV2VisualHelper.createTableEditorV2VisualRegisterOptions()),l.registerTrustedVisual([e.visualHost.PowerOnForecasterVisual],e.explore.utils.PowerOnForecasterVisualHelper.createForecasterVisualRegisterOptions()),l.registerTrustedVisual([e.visualHost.PowerOnDraggableChartVisual],e.explore.utils.PowerOnDraggableChartVisualHelper.createDraggableChartVisualRegisterOptions()),l}]).factory("activeFolderId",(function(){return e.common.createEmbedActiveFolderIdService()})).factory("packageCollection",[function(){return e.dataServices.createPackageCollectionService()}]).factory("focus",["$rootElement","modalDialogService","embedModeService",function(r,t,o){return e.explore.services.createFocusService(r,t,[],!o.isAnonymousLiveEmbed())}]).factory("embedMessageProxyService",["$rootScope","moduleLoader","embedModeService","conceptualSchemaProxy","promiseFactory","embedRouter","reportEmbedState","telemetryService","pbiLazyLoad",function(e,t,o,i,s,n,a,l,c){return r.services.createEmbedMessageProxyService(e,t,o,i,s,n,a,l,c)}]).run(["$rootScope","scopedProvider","telemetryService",function(t,o,i){o.register("undoRedo",{services:["$rootScope","$timeout","logger"],scopedServices:["eventBridge"],fn:function(r,t,o,i){var n=e.explore.services.createUndoRedoService(r,t,i,o);return n.setStrategy(new s),n}}).register("reportEmbedFilterService",{services:["$rootScope","promiseFactory","moduleLoader","conceptualSchemaProxy","telemetryService","aggrOps"],scopedServices:["eventBridge","filterGenerator","visualPluginOps"],fn:function(e,t,o,i,s,n,a,l,c){return r.services.createReportEmbedFilterService(e,t,o,i,s,n,a,l,c)}});for(var n=perfMarkers.getJsParseTimes(window.parseTimeMarkers),a=0,l=n;a<l.length;a++){var c=l[a];i.logEvent(e.telemetry.AppJavaScriptParse,c.fileName,c.startEval,c.start,c.end)}e.explore.reportembed.notifyModelsAndExplorationReady=function(e){t.$emit(r.constants.modelsAndExplorationReadyEventName,e)},e.explore.reportembed.notifyConceptualSchemaReady=function(e){t.$emit(r.constants.conceptualSchemaReadyEventName,e)}}]).provider("dataReaderProvider",(function(){var t=window.queryDataUrl||"explore/querydata",o=window.getConceptualSchemaUrl||"explore/conceptualschema",i=this;return i.$get=["promiseFactory","featureSwitchService","delayedQueryResultHandler","localizationService","telemetryService","$rootScope","timeoutService",function(i,s,n,a,l,c,d){var p=e.common.httpService,u={bingSocialDataReader:{name:"bingSocialDataReader",reader:function(r){return new e.data.bingSocial.BingSocialDataReader(r,p)}}};e.data.dsr.registerDsrPlugin(u,{promiseFactory:i,telemetryService:l,reader:{communication:{httpService:p,uri:t},delayedQueryResultHandler:n,featureSwitches:function(){return e.common.utils.getDsrReaderSwitches(s.featureSwitches)},preferredMaxConnections:4,timeoutService:d},schemaReader:{communication:r.services.createConceptualSchemaProxyHttpCommunication(e.common.httpService,i,o,c),localizationOptions:e.data.dsr.ConceptualSchemaFactory.createLocOptions(a)}});var m={};return e.explore.dataReaderPlugins.registerExplorationDataReaderExtension(m,i,!1),e.data.createDataReaderProvider(e.data.createDataReaderFactory(u,m),{promiseFactory:function(){return i}})}],i})).factory("checkSigninService",[function(){return new e.common.DefaultCheckSigninService}]).factory("httpRequestWorker",["promiseFactory","telemetryService","localizationService","errorService","$timeout","$window","featureSwitchService","embedModeService","checkSigninService","clusterUriRetriever","httpUriRedirector","urlInterceptor","userActivityContextService","logger",function(r,t,o,i,s,n,a,l,c,d,p,u,m,v){return e.common.createHttpRequestWorker(r,t,o,i,s,n,a,l,null,c,d,p,u,m,v)}]).run(["promiseFactory","telemetryService","httpService",function(r,t,o){e.common.httpService=o,e.common.localize=e.common.createLocalizationService(t,r),e.visuals&&e.explore.services.VisualHostServices.initialize(e.common.localize)}]).run(["mixinScopedFactories",function(t){t.explorationContainer=[e.mixins.ExportDataMixinFactory,r.mixins.BookmarksMessageProxyMixinFactory,r.mixins.ExplorationEmbedStateProxyFactory,r.mixins.ExportDataMessageProxyMixinFactory,r.mixins.FiltersMessageProxyMixinFactory,r.mixins.InteractivityMessageProxyMixinFactory,r.mixins.ReportAuthoringMixinFactory,r.mixins.ScopedServicesMixinFactory,r.mixins.SlicerMessageProxyMixinFactory,r.mixins.VisualsAuthoringMessageProxyMixinFactory]}]).run(["printService",function(){}]).controller("ReportEmbedController",["$rootScope","$window","promiseFactory","embedModeService","embedMessageProxyService","embedRouter","errorService","explorationContainerScopedServices","explorationSerializer","explorationExtensibilityService","modelConverter","telemetryService","telemetryHostService","localizationService","$timeout","reportEmbedState","reportEmbedExplorationService","reportEmbedModelService","navigation","activeFolderId","clusterResolverService","scopedProvider","visualPlugin","moduleLoader","modalDialogService","displayNameService","packageCollection","lazy","pbiLazyLoad","featureSwitchService","sdkModelsConverter","lazyProviderModern",function(e,t,o,i,s,n,a,l,c,d,p,u,m,v,h,g,b,y,f,S,E,C,I,w,P,x,M,R,F,T,L,A){globalErrorService=a,globalWindowService=t,globalEmbedModeService=i,C.attachTo(e);var k=C.find(e).get("lazyScoped",e),_={$timeout:h,activeFolderIdService:S,clusterResolverService:E,displayNameService:x,embedMessageProxyService:s,embedModeService:i,errorService:a,explorationSerializer:c,explorationExtensibilityService:d,lazy:R,lazyScoped:k,localizationService:v,modalDialogService:P,modelConverter:p,moduleLoader:w,packageCollection:M,pbiLazyLoad:F,promiseFactory:o,reportEmbedExplorationService:b,reportEmbedModelService:y,reportEmbedNavigationService:f,reportEmbedState:g,scopedServices:l,telemetryService:u,telemetryHostService:m,visualPlugin:I,windowService:t,featureSwitchService:T,sdkModelsConverter:L,lazyProviderModern:A};return reportEmbedController=new r.controllers.ReportEmbedController(e,_),s.startListening(),window.isReportControllerInitialized=!0,isShowSignInMessagePending&&(showSignIn(tokenPassedFromView,reportIdPassedFromView),isShowSignInMessagePending=!1),window.isLoadReportMessagePending?(window.legacyEmbedMessage?loadReport(window.reportObjectId,window.accessToken,window.oDataFilter):(s.setupRequestId(window.uid),s.handleLoad(window.loadReportConfiguration,window.phasedRender,window.sdkSessionId)),window.isLoadReportMessagePending=!1):window.isCreateReportMessagePending?(s.setupRequestId(window.uid),s.handleCreate(window.createReportConfiguration,window.sdkSessionId),window.isCreateReportMessagePending=!1):i.isAnonymousLiveEmbed()?loadReport("any","any",void 0):window.isLoadQnaMessagePending&&(s.setupRequestId(window.uid),reportEmbedController.loadQnaView(window.loadQnaConfiguration,window.sdkSessionId),window.isLoadQnaMessagePending=!1),reportEmbedController}]),window.isMobile&&(e.mobileOptimization.doubleClick.plugin.register(),e.mobileOptimization.swipeable.plugin.register(),e.mobileOptimization.initialize()),e.common.registerPBICommonBuildingBlocksForHost(l),e.visualHost.registerBuildingBlocksForHost(l),e.explore.registerBuildingBlocksForHost(l),e.explore.exploration.registerBuildingBlocksForHost(l),r.registerBuildingBlocksForHost=t,r.registerBuildingBlocksForHost(l)})(t=r.reportembed||(r.reportembed={}))})(r=e.explore||(e.explore={}))})(powerbi||(powerbi={})),angular.module("powerbi.reportembed").run(["$templateCache",function(e){e.put("components/qnaContainer/qnaContainer.html",'<div><div ng-hide="showErrorMessage" id="reportLandingContainer" class="embedQna"><div class="embedInfoNavContainer" ng-class="{ interpretResultView: inputControlDisabled }"><info-nav-container host-service="infoNavHostService" info-nav-container-options="infoNavContainerOptions" question-box-output="questionBoxOutput" interpret-listener="infoNavContainerInterpretListener" usage-reporting-enabled="allowQnaDataCollection" models="models" get-additional-o-data-filter="getAdditionalODataFilter"></info-nav-container></div></div><div ng-if="showErrorMessage" class="qnaError"><span ng-bind="errorMessage" class="errorText"/></div></div>'),e.put("views/interactiveEmbed.html",'<embed-thumbnail (interact)="clickToInteract()" ng-if="optimizePublishToWeb"></embed-thumbnail><auto-auth ng-if="promptForLogin()"></auto-auth><request-access ng-if="isUserUnauthorized"></request-access><div><div ng-if="!showErrorMessage && !promptForLogin() && !optimizePublishToWeb && !isUserUnauthorized" class="landingController fillAvailableSpace"><div class="landingContainer"><div id="reportLandingContainer" class="embeddedLandingRootContent reportContainerContent isActive embeddedPV" ng-class="backgroundCssClass + (showLogoBar ? \' embeddedLandingRootContentLogoVisible\' : \' embeddedLandingRootContentLogoHidden\')"><div class="embeddedPV"><exploration-container view-model="exploreContainer" ng-if="exploreContainer" canvas-options="canvasOptions" exploration-container-options="explorationContainerOptions"></exploration-container></div></div></div></div><div ng-if="showErrorMessage" class="embedError" ng-class="showLogoBar ? \'embeddedLandingRootContentLogoVisible\' : \'embeddedLandingRootContentLogoHidden\'"><span ng-bind="errorMessage" class="errorText"/><br/><a target="_blank" ng-href="{{errorLink}}"><span localize="PowerBI_Learn_More_Message" class="errorText"></span></a></div></div><logo-bar ng-if="showLogoBar"></logo-bar>'),e.put("views/logoBar.html",'<div class="unselectable"><div class="logoBar"><div class="logo"><a ng-if="useTitleForAnchor()"><span localize="ReportEmbed_Logobar_MarketingText" class="text" onclick="window.open(this.title, \'_blank\');" title="{{powerbiLink}}"></span></a><a target="_blank" ng-if="!useTitleForAnchor()" ng-href="{{powerbiLink}}"><span localize="ReportEmbed_Logobar_MarketingText" class="text"></span></a><logo-bar-navigation is-small-screen="isSmallScreen" show-about-dialog="showAboutDialog()" mail-to-link="mailToLink" show-full-screen="showFullScreen" is-full-Screen="isFullScreen()" toggle-full-screen-mode="toggleFullScreenMode()"/><a ng-if="!isSmallScreen && showFullScreen" id="fullScreenIcon"><i class="glyphicon glyph-small pbi-glyph-fullscreen icon" ng-if="!isFullScreen()" ng-click="toggleFullScreenMode()" localize-tooltip="ReportEmbed_Logobar_FullScreen_Enter"></i><i class="glyphicon glyph-small pbi-glyph-fullscreenexit icon" ng-if="isFullScreen()" ng-click="toggleFullScreenMode()" localize-tooltip="FullScreen_Exit"></i></a><i ng-if="!isSmallScreen && !socialSharingFeatureEnabled" class="glyphicon pbi-glyph-info glyph-small icon" ng-click="showAboutDialog()" localize-tooltip="ReportEmbed_Logobar_AboutPowerBI"></i><a ng-if="!isSmallScreen && !socialSharingFeatureEnabled" ng-show="showFlag" ng-href="{{mailToLink}}" localize-tooltip="ReportEmbed_Logobar_InappropriateContent"><i class="glyphicon pbi-glyph-flag glyph-small icon"></i></a><span ng-if="!isSmallScreen && socialSharingFeatureEnabled"><logo-bar-social-sharing></logo-bar-social-sharing></span></div></div></div>'),e.put("views/logoBarNavigation.html",' <span class="navigation-wrapper" keyboard-shortcuts="ctrl-F6" focus-nav-mode="Group" tabindex="0" ng-class="{\'navigation-wrapper-big\': !isSmallScreen}"><a><i class="glyphicon glyph-small pbi-glyph-chevronleftmedium middleIcon" accessible-click="navigateTo(\'left\')" ng-show="allPagesCount !==undefined && allPagesCount>1" ng-class="chevronLeftArrowClass()" focus-element tabindex="0" localize-tooltip="{{isRtl ? \'ReportEmbed_Logobar_Navigation_NextPage\' : \'ReportEmbed_Logobar_Navigation_PreviousPage\'}}"></i></a> <a class="middleText" ng-click="toggleOverlay()" ng-if="!isSmallScreen" ng-show="allPagesCount !==undefined && (allPagesCount>1 || currentPageNumber === -1)"><span ng-if="currentPageNumber !== -1"><span class="innerText" ng-bind="leftPageNumber()"></span><span localize="ReportEmbed_Logobar_PagesOf" class="innerText"></span><span class="innerText" ng-bind="rightPageNumber()"></span></span><span ng-if="currentPageNumber === -1" localize="Pages" class="innerText"></span></a> <a><i class="glyphicon glyph-small pbi-glyph-chevronrightmedium middleIcon" accessible-click="navigateTo(\'right\')" ng-show="allPagesCount !==undefined && allPagesCount>1" ng-class="chevronRightArrowClass()" localize-tooltip="{{isRtl ? \'ReportEmbed_Logobar_Navigation_PreviousPage\' : \'ReportEmbed_Logobar_Navigation_NextPage\'}}" focus-element tabindex="0"></i></a> <a ng-if="isSmallScreen" ng-show="allPagesCount !==undefined && allPagesCount>= 1" ng-click="toggleOverlay()" localize-tooltip="ReportEmbed_Logobar_MoreOptions"><i class="glyphicon pbi-glyph-more glyph-small icon"></i></a></span><section class="navOverlay" id="flyoutElement" flyout-visible="false" ng-if="isSmallScreen"><div class="pageContainer" ng-hide="hidePageNavigationFlyout"><div class="overlayContent"><div class="overlaySections"><ul text-slide-animation="showOverlay" class="list"><li ng-repeat="(key, section) in sections track by key" class="sectionItemHidden animated"> <a ng-click="goToSection(section)" class="sectionItem" ng-class="$index === (currentPageNumber) ? \'selected\' : \'\'" title="{{section.displayName}}">{{section.displayName}}</a></li></ul></div></div></div><div class="iconContainer"><div ng-if="socialSharingFeatureEnabled"><logo-bar-social-sharing></logo-bar-social-sharing></div><div class="rightIcons"><i class="glyphicon pbi-glyph-info glyph-small overlayIcon" ng-click="showAboutDialog()"></i><a ng-href="{{mailToLink}}"><i class="glyphicon pbi-glyph-flag glyph-small overlayIcon"></i></a><a ng-if="showFullScreen" id="fullScreenIcon"><i class="glyphicon glyph-small pbi-glyph-fullscreen overlayIcon" ng-if="!isFullScreen()" ng-click="toggleFullScreenMode()" localize-tooltip="ReportEmbed_Logobar_FullScreen_Enter"></i><i class="glyphicon glyph-small pbi-glyph-fullscreenexit overlayIcon" ng-if="isFullScreen()" ng-click="toggleFullScreenMode()" localize-tooltip="FullScreen_Exit"></i></a></div></div><a class="overlay-close" ng-click="toggleOverlay()" ng-hide="hidePageNavigationFlyout"><i class="glyphicon glyph-small pbi-glyph-close"></i></a></section><section ng-if="!isSmallScreen" id="flyoutElement" flyout-visible="false" class="navFlyout" ng-attr-style="height: {{40+allPagesCount*29}}px"><div class="wrapper"><div class="textContainer"><div class="flyoutSections"><ul text-slide-animation="showOverlay" class="list"><li ng-repeat="(key, section) in sections track by key" class="sectionItemHidden animated"> <a ng-click="goToSection(section)" class="sectionItem" ng-class="$index === (currentPageNumber) ? \'selected\' : \'\'" title="{{section.displayName}}">{{section.displayName}}</a></li></ul></div></div></div><div class="arrow"></div></section>'),e.put("views/logoBarSocialSharing.html",'<span class="leftIcons" ng-if="isSmallScreen"><a class="socialShare" ng-click="toggleSocialSharing()"><i class="glyphicon pbi-glyph-share glyph-small glyphicon-social-share"></i></a><span localize="ReportEmbed_Logobar_Share" class="shareText"></span></span><span class="navigation-wrapper"><a ng-click="toggleSocialSharing()" ng-if="!isSmallScreen" localize-tooltip="ReportEmbed_Logobar_Share"><i class="glyphicon pbi-glyph-share glyph-small icon"></i></a><a ng-if="!isSmallScreen && !isMediumScreen" ng-href="https://www.facebook.com/sharer/sharer.php?u={{shareLink}}" ng-attr-target="{{\'_blank\'}}" ng-click="openUsingWindow($event)" localize-tooltip="ReportEmbed_Logobar_Facebook"><div class="glyphicon glyphicon-share-facebook glyph-small icon"/></a><a ng-if="!isSmallScreen && !isMediumScreen" ng-href="https://twitter.com/intent/tweet?text={{shareLink}}" ng-attr-target="{{\'_blank\'}}" ng-click="openUsingWindow($event)" localize-tooltip="ReportEmbed_Logobar_Twitter"><div class="glyphicon glyphicon-share-twitter glyph-small icon"/></a><a ng-if="!isSmallScreen && !isMediumScreen" ng-href="https://www.linkedin.com/shareArticle?mini=true&url={{shareLink}}" ng-attr-target="{{\'_blank\'}}" ng-click="openUsingWindow($event)" localize-tooltip="ReportEmbed_Logobar_LinkedIn"><div class="glyphicon glyphicon-share-linkedIn glyph-small icon"/></a></span><section ng-if="isSmallScreen && socialSharingVisible" id="socialSharingflyoutElement" class="navOverlay"><div class="pageContainer"><div class="sharingContainerSmallScreen"><header localize="ReportEmbed_Logobar_Share" class="sharingFlyoutHeader"></header><p localize="ReportEmbed_Logobar_ShareUrl" class="sharingUrlText"></p> <input class="sharingUrlBox" readonly onClick="this.setSelectionRange(0, this.value.length); event.stopPropagation(); " ng-model=\'textShareLink\' autofocus/><span class="smallScreenSocialIcons"><a ng-href="https://www.facebook.com/sharer/sharer.php?u={{shareLink}}" ng-attr-target="{{\'_blank\'}}" ng-click="openUsingWindow($event)"><div class="glyphicon glyphicon-share-facebook-large"/></a><a ng-href="https://twitter.com/intent/tweet?text={{shareLink}}" ng-attr-target="{{\'_blank\'}}" ng-click="openUsingWindow($event)"><div class="glyphicon glyphicon-share-twitter-large"/></a><a ng-href="https://www.linkedin.com/shareArticle?mini=true&url={{shareLink}}" ng-attr-target="{{\'_blank\'}}" ng-click="openUsingWindow($event)"><div class="glyphicon glyphicon-share-linkedIn-large"/></a><a ng-href="{{socialSharingEmailLink}}"><div class="glyphicon pbi-glyph-mail emailOverlayLarge"/></a></span></div></div><div class="iconContainer"><span class="leftIcons"><a class="socialShare" ng-click="toggleSocialSharing()"><i class="glyphicon pbi-glyph-share glyph-small glyphicon-social-share"></i></a><span localize="ReportEmbed_Logobar_Share" class="shareText"></span></span><span class="rightIcons"><i class="glyphicon pbi-glyph-info glyph-small overlayIcon" ng-click="showAboutDialog()"></i><a ng-href="{{mailToLink}}"><i class="glyphicon pbi-glyph-flag glyph-small overlayIcon"></i></a></span></div><a class="overlay-close" ng-click="closeSocialSharing()"><i class="glyphicon glyph-small pbi-glyph-close"></i></a></section><section ng-if="!isSmallScreen && socialSharingVisible" id="socialSharingflyoutElement" class="socialSharingFlyout"><header localize="ReportEmbed_Logobar_Share" class="sharingFlyoutHeader"></header><p localize="ReportEmbed_Logobar_ShareUrl" class="sharingUrlText"></p> <input class="sharingUrlBox" readonly onClick="this.setSelectionRange(0, this.value.length); event.stopPropagation(); " ng-model=\'textShareLink\' autofocus/><span class="urlTextIcons"><a ng-if="isMediumScreen" ng-href="https://www.facebook.com/sharer/sharer.php?u={{shareLink}}" ng-attr-target="{{\'_blank\'}}" ng-click="openUsingWindow($event)" localize-tooltip="ReportEmbed_Logobar_Facebook"><div class="glyphicon glyphicon-share-facebook-medium glyph-small shareFlyoutIcon"/></a><a ng-if="isMediumScreen" ng-href="https://twitter.com/intent/tweet?text={{shareLink}}" ng-attr-target="{{\'_blank\'}}" ng-click="openUsingWindow($event)" localize-tooltip="ReportEmbed_Logobar_Twitter"><div class="glyphicon glyphicon-share-twitter-medium glyph-small shareFlyoutIcon"/></a><a ng-if="isMediumScreen" ng-href="https://www.linkedin.com/shareArticle?mini=true&url={{shareLink}}" ng-attr-target="{{\'_blank\'}}" ng-click="openUsingWindow($event)" localize-tooltip="ReportEmbed_Logobar_LinkedIn"><div class="glyphicon glyphicon-share-linkedIn-medium glyph-small shareFlyoutIcon"/></a><a ng-href="{{socialSharingEmailLink}}" localize-tooltip="ReportEmbed_Logobar_ShareViaEmail"><i class="glyphicon pbi-glyph-mail glyph-small shareFlyoutIcon"></i></a><i class="glyphicon pbi-glyph-info glyph-small shareFlyoutIcon" ng-click="showAboutDialog()" localize-tooltip="ReportEmbed_Logobar_AboutPowerBI"></i><a ng-href="{{mailToLink}}" localize-tooltip="ReportEmbed_Logobar_InappropriateContent"><i class="glyphicon pbi-glyph-flag glyph-small shareFlyoutIcon"></i></a></span><div class="arrow"></div></section>')}]);var powerbi;!(function(e){var r;!(function(e){var r;!(function(e){var r;!(function(e){e.InfoNavBootstrapModule={name:"powerbi.infonavbootstrap",namespace:"powerbi.infonav",dependency:{javascript:"infoNavBootstrap",css:["infoNavBootstrap"]}},e.QnaCoreModule={name:"powerbi.qnacore",namespace:"powerbi.explore.infonav",dependency:{javascript:"qnacore",css:["qnacore"]}},e.QnaWebModule={name:"powerbi.qnaweb",namespace:"powerbi.explore.infonav",dependency:{javascript:"qnaweb",css:["qnaweb"]}}})(r=e.modules||(e.modules={}))})(r=e.reportembed||(e.reportembed={}))})(r=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var r;!(function(e){var r;!(function(e){var r;!(function(e){var r=(function(){function e(){}return e.isAnonymousLiveEmbed=function(){return"undefined"!=typeof isAnonymousEmbed&&isAnonymousEmbed===!0},e})();e.AnonymousLiveEmbedHelper=r})(r=e.controllers||(e.controllers={}))})(r=e.reportembed||(e.reportembed={}))})(r=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var r;!(function(e){var r;!(function(e){var r;!(function(e){e.ExplorationEmbedStateProxyFactory={ng:["reportEmbedState"],fn:function(e){return new r(e)}};var r=(function(){function e(e){this.services=e}return e.prototype.update=function(e){this.services.reportEmbedState.explorationContainer=e},e})()})(r=e.mixins||(e.mixins={}))})(r=e.reportembed||(e.reportembed={}))})(r=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var r;!(function(e){var r;!(function(e){var r;!(function(e){e.ScopedServicesMixinFactory={ng:["$scope","scopedProvider","explorationContainerScopedServices"],scoped:[],fn:function(e){return new r(e)}};var r=(function(){function e(e){this.services=e}return e.prototype.update=function(e){this.setScopedServicesProvider()},e.prototype.setScopedServicesProvider=function(){var e=this.services.scopedProvider.find(this.services.$scope);this.services.explorationContainerScopedServices.setScopedProviderInstance(e)},e})()})(r=e.mixins||(e.mixins={}))})(r=e.reportembed||(e.reportembed={}))})(r=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var r;!(function(r){var t;!(function(t){var o;!(function(o){var i=e.explore.reportembed.constants;o.VisualsAuthoringMessageProxyMixinFactory={ng:["conceptualSchemaProxy","embedModeService","embedRouter","pbiLazyLoad","moduleLoader","promiseFactory","telemetryService","sdkModelsConverter"],scoped:["dataSources","visualAuthoringOperations"],fn:function(e){return new s(e)}};var s=(function(){function o(e){this.services=e}return o.prototype.update=function(e){this.explorationContainer=e,this.services.embedRouter.setupBlock(this)},o.prototype.setupRoutes=function(r){var t=this;r.post("/report/pages/:pageName/visuals/:visualName/clone",(function(r,o){return __awaiter(t,void 0,e.Promise,(function(){return __generator(this,(function(e){switch(e.label){case 0:return[4,this.handleCloneVisual(r,o)];case 1:return[2,e.sent()]}}))}))}))},o.prototype.handleCloneVisual=function(o,s){return __awaiter(this,void 0,e.Promise,(function(){var e,n,n,a,l,c,d,p,u,m,v,h,g,b,y,f,S,E,C,I;return __generator(this,(function(w){switch(w.label){case 0:return this.services.embedModeService.isAnonymousLiveEmbed()?(n=t.HostCommunicationHelper.buildNotSupportedByPublishToWebMessage(),[2,s.send(i.StatusCodes.BadRequest,n)]):this.services.embedModeService.isAppTokenEmbed()?(n=t.HostCommunicationHelper.buildNotSupportedByAppTokenEmbedMessage(),[2,s.send(i.StatusCodes.BadRequest,n)]):(a=o.body)?(l=o.params&&o.params.visualName,c=o.params&&o.params.pageName,d=this.tryGetVisualContainer(c,l,s),d?[4,this.services.pbiLazyLoad.load(r.modules.ExploreUIShellModule)]:[2]):[2,s.send(i.StatusCodes.BadRequest,{message:i.ErrorCodes.invalidCloneVisualRequest,detailedMessage:i.ErrorMessages.invalidCloneVisualRequest})];case 1:if(w.sent(),p=d.filters,!a.filters)return[3,9];p=[],u=void 0,m=void 0,w.label=2;case 2:return w.trys.push([2,4,,5]),[4,this.services.promiseFactory.all([this.getJsonFilterParser(),this.getConceptualSchema()])];case 3:return e=w.sent(),u=e[0],m=e[1],[3,5];case 4:return v=w.sent(),[2,s.send(i.StatusCodes.InternalServerError,v)];case 5:h={filters:[]},g=0,b=a.filters,w.label=6;case 6:return g<b.length?(y=b[g],[4,u.tryCreateFilterContainer(h,m,y)]):[3,9];case 7:f=w.sent(),f?p.push(f):this.services.embedRouter.postError("report",{message:i.ErrorCodes.invalidFilter,detailedMessage:i.ErrorMessages.invalidFilter}),w.label=8;case 8:return g++,[3,6];case 9:return a.layout&&(S=this.services.sdkModelsConverter.getVisualContainerPosition(a.layout)),E=d.layouts&&d.layouts.withId(0),C=_.cloneDeep(E.position),S=_.merge(C,S),I=this.services.visualAuthoringOperations.addVisualContainerFromConfig(d.config,p,this.explorationViewModel.exploreCanvas,S),[2,s.send(i.StatusCodes.OK,{visualName:I.name})]}}))}))},o.prototype.tryGetVisualContainer=function(e,r,o){var s;if(r){var n=t.ExplorationHelper.getSectionByName(this.exploration,e);if(!n)return o.send(i.StatusCodes.BadRequest,t.HostCommunicationHelper.buildPageNotFoundErrorMessage(e)),null;s=t.ExplorationHelper.getVisualContainerByName(n,r)}return null==s?(o.send(i.StatusCodes.BadRequest,t.HostCommunicationHelper.buildVisualNotFoundErrorMessage(r,e)),null):s},Object.defineProperty(o.prototype,"explorationViewModel",{get:function(){return this.explorationContainer&&this.explorationContainer.viewModel&&this.explorationContainer.viewModel.exploration;
},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"exploration",{get:function(){return this.explorationViewModel.contract},enumerable:!0,configurable:!0}),o.prototype.getConceptualSchema=function(){return __awaiter(this,void 0,e.Promise,(function(){var e,r,t;return __generator(this,(function(o){switch(o.label){case 0:return e=this.services.dataSources.get(),[4,this.services.conceptualSchemaProxy.get(e)];case 1:if(r=o.sent(),!r)throw t={message:i.ErrorCodes.failedGettingSchema,detailedMessage:i.ErrorMessages.failedGettingSchema};return[2,r]}}))}))},o.prototype.getJsonFilterParser=function(){return __awaiter(this,void 0,e.Promise,(function(){var e,r;return __generator(this,(function(o){switch(o.label){case 0:return e=this,r=this.jsonFilterParser,r?[3,2]:[4,t.JsonFilterHelper.createJsonFilterParser(this.services.promiseFactory,this.services.moduleLoader,this.services.telemetryService)];case 1:r=o.sent(),o.label=2;case 2:return e.jsonFilterParser=r,[2,this.jsonFilterParser]}}))}))},o})()})(o=t.mixins||(t.mixins={}))})(t=r.reportembed||(r.reportembed={}))})(r=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var r;!(function(r){var t;!(function(r){var t;!(function(r){function t(e){return new i(e)}var o=e.common.models.ReportContainer;r.createModelConverter=t;var i=(function(){function e(e){this.dataServiceModelConverter=e}return e.prototype.convertModel=function(e){return this.dataServiceModelConverter.convertModel(e)},e.prototype.convertPackage=function(e){return this.dataServiceModelConverter.convertPackage(e)},e.prototype.convertReport=function(e){return this.dataServiceModelConverter.convertReport(e)},e.prototype.convertReportContainer=function(e){var r=new o(e);return this.fillReportContainerChildren(r,e),r},e.prototype.fillReport=function(e,r){this.dataServiceModelConverter.fillReport(e,r)},e.prototype.fillReportContainerChildren=function(e,r){r&&(e.report=this.convertReport(r),this.fillReport(e.report,r))},e})()})(t=r.models||(r.models={}))})(t=r.reportembed||(r.reportembed={}))})(r=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var r;!(function(r){var t;!(function(r){var t;!(function(r){function t(e,r){return new i(e,r)}var o;!(function(e){e[e.None=0]="None",e[e.FitToContent=1]="FitToContent",e[e.FitToWidth=2]="FitToWidth"})(o=r.FullScreenFitStyle||(r.FullScreenFitStyle={})),r.createFullScreenService=t;var i=(function(){function r(e,r){var t=this;this.$rootScope=e,this.changeListeners=[],this.document=r.get(0);for(var i=["fullscreenchange","webkitfullscreenchange","MSFullscreenChange","mozfullscreenchange"],s=0,n=i;s<n.length;s++){var a=n[s];this.document.addEventListener(a,(function(e){return t.updateFullScreenFromBrowser()}))}this._fullScreenModeEnabled=!1,this.fitStyle=o.None}return r.prototype.subscribe=function(e){this.changeListeners.push(e)},r.prototype.unsubscribe=function(e){_.pull(this.changeListeners,e)},r.prototype.enterFullScreen=function(){this.fullScreenMode||(this.setFullScreenMode(!0),this.fitStyle=o.None)},r.prototype.exitFullScreen=function(){this.fullScreenMode&&(this.setFullScreenMode(!1),this.fitStyle=o.None)},r.prototype.toggleFullScreen=function(){this.fullScreenMode?this.exitFullScreen():this.enterFullScreen()},r.prototype.fullScreenPreviousPage=function(){this.$rootScope.$emit(e.explore.constants.explorationPreviousPageEvent)},r.prototype.fullScreenNextPage=function(){this.$rootScope.$emit(e.explore.constants.explorationNextPageEvent)},Object.defineProperty(r.prototype,"enterFullScreenSupported",{get:function(){return!0},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"fullScreenMode",{get:function(){return this._fullScreenModeEnabled},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"fitStyle",{get:function(){return this._fitStyle},set:function(e){this._fitStyle!==e&&(this._fitStyle=e,this.notifyListeners((function(e){return e.onFitStyleChanged()})))},enumerable:!0,configurable:!0}),r.prototype.notifyListeners=function(e){var r=this.changeListeners;if(!_.isEmpty(r)&&e)for(var t=r.length-1;t>=0;t--)e(r[t])},r.prototype.updateFullScreenFromBrowser=function(){var e=this,r=this.document,t=null!=(r.fullScreenElement||r.msFullscreenElement||r.mozFullScreenElement||r.webkitFullscreenElement);t!==this.fullScreenMode&&this.$rootScope.$applyAsync((function(){t?e.enterFullScreen():e.exitFullScreen()}))},r.prototype.setFullScreenMode=function(e){var t=$("html"),o=$("body");if(!(t.length<=0||o.length<=0)){if(e){o.addClass(r.fullScreenCSSClass);var i=t.get(0);if(i){var s=i.requestFullscreen||i.msRequestFullscreen||i.webkitRequestFullscreen||i.mozRequestFullScreen;s&&s.call(i)}}else{o.removeClass(r.fullScreenCSSClass),$(".enterFullScreenBtn").blur();var n=this.document,a=n.exitFullscreen||n.msExitFullscreen||n.webkitExitFullscreen||n.mozCancelFullScreen;a&&a.call(n)}this._fullScreenModeEnabled=e,this.notifyListeners((function(e){return e.onFullScreenModeChanged()}))}},r.fullScreenCSSClass="fullScreen",r})()})(t=r.services||(r.services={}))})(t=r.reportembed||(r.reportembed={}))})(r=e.explore||(e.explore={}))})(powerbi||(powerbi={})),define("PowerBIReportEmbed/services/reportEmbedCustomLayoutService",["require","exports"],(function(e,r){function t(e,r,t){return new a(e,r,t)}Object.defineProperty(r,"__esModule",{value:!0});var o=powerbi.explore.reportembed.ExplorationHelper,i=powerbi.explore.constants.ExploreCanvasConstants,s=powerbi.explore.util.PropertyPaneUtils,n=powerbi.explore.services.events;r.create=t;var a=(function(){function e(e,r,t){this.scopedServices=e,this.embedMessageProxyService=r,this.sdkModelsConverter=t}return e.prototype.getAvailableDisplayAreaSize=function(e){var r={width:e.size.width,height:e.size.height},t=this.getAutoLayoutVisualVCHeader();return r.height-=t,r},e.prototype.setCustomLayout=function(e,r,t,o){return __awaiter(this,void 0,powerbi.Promise,(function(){var e,i,s,n,a;return __generator(this,(function(l){switch(l.label){case 0:if(!o.customLayout||!o.customLayout.pagesLayout)return[2];e=o.customLayout.pagesLayout,i=[];for(s in e)i.push(s);n=0,l.label=1;case 1:return n<i.length?(a=i[n],[4,this.applyCustomPageLayout(r,t,e,a)]):[3,4];case 2:l.sent(),l.label=3;case 3:return n++,[3,1];case 4:return[2]}}))}))},e.prototype.getSectionSize=function(e,r){var t=r.pageSize,o=r.displayOption;if(!t&&void 0===o)return null;var i={};if(t){var n=e.PageSizeType[t.type];if(!n)return null;if(i=s.getDefaultSectionSize(n),!i)return null;if(t.type===e.PageSizeType.Custom){var a=t;if(e.validateCustomPageSize(a))return null;void 0!==a.width&&(i.width=a.width),void 0!==a.height&&(i.height=a.height)}}return void 0!==o&&(i.displayOption=this.sdkModelsConverter.getSectionDisplayOption(o)),i},e.prototype.getAutoLayoutVisualVCHeader=function(){var e=this.scopedServices.getFormFactorProvider();return e&&e.getCurrentLayoutCapabilities().canShowVisualContainerHeaderInset()?0:i.AutoLayoutVisualVCHeader},e.prototype.applyCustomPageLayout=function(e,r,t,i){return __awaiter(this,void 0,powerbi.Promise,(function(){var s,a,l,c=this;return __generator(this,(function(d){return(s=o.getSectionByName(e,i))?(a=t[i].visualsLayout,l=t[i].defaultLayout,!l&&_.isEmpty(a)?[2]:(s.visualContainers.forEach((function(e){var t={},o=a[e.name];if(l||o){l&&_.assign(t,l),o&&_.assign(t,o);var i=e.layouts&&e.layouts.withId(0);c.applyVisualCustomLayout(i,t),t.displayState&&(e.config.singleVisual.display=c.sdkModelsConverter.getDisplayState(t.displayState)),r||c.scopedServices.getEventBridge().publishToChannel(n.visualContainerChanged,{affectContainer:function(r){return r===e}})}})),[2])):(this.embedMessageProxyService.postErrorPageNotFound(i),[2])}))}))},e.prototype.applyVisualCustomLayout=function(e,r){null!=r.x&&(e.position.x=r.x),null!=r.y&&(e.position.y=r.y),null!=r.z&&(e.position.z=r.z),null!=r.width&&(e.position.width=r.width),null!=r.height&&(e.position.height=r.height)},e})()})),define("PowerBIReportEmbed/services/reportEmbedSlicersApiService",["require","exports"],(function(e,r){function t(e){return new v(e)}Object.defineProperty(r,"__esModule",{value:!0});var o=powerbi.data.DataViewTransform,i=powerbi.explore.reportembed.constants.ErrorCodes,s=powerbi.explore.reportembed.constants.ErrorMessages,n=powerbi.explore.reportembed.ExplorationHelper,a=powerbi.explore,l=powerbi.explore.reportembed.HostCommunicationHelper,c=powerbi.explore.reportembed,d=c.constants,p=powerbi.visuals.slicerProps,u=d.StatusCodes,m=jsCommon.TraceType;r.create=t;var v=(function(){function e(e){this.services=e}return e.prototype.putSlicer=function(e,r,t){return __awaiter(this,void 0,powerbi.Promise,(function(){var o=this;return __generator(this,(function(i){switch(i.label){case 0:return[4,this.handleSlicerRequest(e,r,t,(function(t,i){return __awaiter(o,void 0,powerbi.Promise,(function(){return __generator(this,(function(o){switch(o.label){case 0:return[4,this.handlePutSlicerRequest(r,e,t,i)];case 1:return[2,o.sent()]}}))}))}))];case 1:return[2,i.sent()]}}))}))},e.prototype.getSlicer=function(e,r,t){return __awaiter(this,void 0,powerbi.Promise,(function(){var o=this;return __generator(this,(function(i){switch(i.label){case 0:return[4,this.handleSlicerRequest(e,r,t,(function(t,i){return __awaiter(o,void 0,powerbi.Promise,(function(){return __generator(this,(function(o){switch(o.label){case 0:return[4,this.handleGetSlicerRequest(r,e,t,i)];case 1:return[2,o.sent()]}}))}))}))];case 1:return[2,i.sent()]}}))}))},e.prototype.handleSlicerRequest=function(e,r,t,o){return __awaiter(this,void 0,powerbi.Promise,(function(){var s,n,a,a,c;return __generator(this,(function(p){switch(p.label){case 0:return this.services.embedModeService.isAnonymousLiveEmbed()?[2,t.send(d.StatusCodes.BadRequest,l.buildNotSupportedByPublishToWebMessage())]:this.services.embedModeService.isAppTokenEmbed()?[2,t.send(u.BadRequest,l.buildNotSupportedByAppTokenEmbedMessage())]:(s=this.tryGetVisualContainer(e,r,t),n=s&&s.config&&s.config.singleVisual,n?this.services.filterCapabilitiesService.hasFilterCapabilities(n.visualType)?[4,o(s,n)]:(this.services.telemetryService.logEvent(telemetry.ReportEmbedSDKError,this.requestId,this.services.reportEmbedState.reportObjectId,this.services.embedModeService.getEmbedTypeDescription(),i.visualIsNotASlicer),a={message:d.ErrorCodes.operationIsSupportedOnlyForSlicers,detailedMessage:d.ErrorMessages.operationIsSupportedOnlyForSlicers},[2,t.send(d.StatusCodes.BadRequest,a)]):(a={message:d.ErrorCodes.visualConfigIsNotInitialized,detailedMessage:d.ErrorMessages.visualContainerConfigIsNotInitialized},[2,t.send(d.StatusCodes.InternalServerError,a)]));case 1:return c=p.sent(),t.send(c.statusCode,c.body),[2]}}))}))},e.prototype.handleGetSlicerRequest=function(e,r,t,o){return __awaiter(this,void 0,powerbi.Promise,(function(){var e,r,t,s,n;return __generator(this,(function(a){switch(a.label){case 0:e=null,a.label=1;case 1:return a.trys.push([1,3,,4]),[4,this.getSlicerSelection(o)];case 2:return e=a.sent(),null==e?(this.services.telemetryService.logEvent(telemetry.ReportEmbedSDKError,this.requestId,this.services.reportEmbedState.reportObjectId,this.services.embedModeService.getEmbedTypeDescription(),i.getSlicerFiltersFailed),r={message:d.ErrorCodes.slicerSerializationFailed,detailedMessage:d.ErrorMessages.slicerSerializationFailed},[2,{statusCode:d.StatusCodes.InternalServerError,body:r}]):[3,4];case 3:return t=a.sent(),[2,{statusCode:d.StatusCodes.InternalServerError,body:t}];case 4:return[4,this.getSlicerTargets(o)];case 5:return s=a.sent(),n={filters:e,targets:s},[2,{statusCode:d.StatusCodes.OK,body:n}]}}))}))},e.prototype.handlePutSlicerRequest=function(e,r,t,o){return __awaiter(this,void 0,powerbi.Promise,(function(){var r,s,n,a,l,c,u,m,v,n,h,g,b,y,f,S,E,C,I;return __generator(this,(function(w){switch(w.label){case 0:return this.services.reportEmbedState.loadCachedData=!1,s=e.body,s?[4,this.validateSlicerState(s)]:(n={message:d.ErrorCodes.invalidSlicerRequest,detailedMessage:d.ErrorMessages.invalidSlicerRequest},[2,{statusCode:d.StatusCodes.BadRequest,body:n}]);case 1:return(a=w.sent())?[2,{statusCode:d.StatusCodes.BadRequest,body:a}]:(l=s.filters,_.isEmpty(l)?(u=this.services.visualPlugin.capabilities(o.visualType),m=this.services.filterGenerator.tryGetFilterPropertyIdentifier(u),c={remove:[{objectName:m.objectName,selector:null,properties:{}}]},c.remove[0].properties[m.propertyName]=!0,v=this.getSlicerMode(o),v&&v.value&&(c.replace=[{objectName:p.data.mode.objectName,selector:null,properties:(r={},r[p.data.mode.propertyName]=v.value,r)}]),[3,7]):[3,2]);case 2:return 1!==l.length?(this.services.telemetryService.logEvent(telemetry.ReportEmbedSDKError,this.requestId,this.services.reportEmbedState.reportObjectId,this.services.embedModeService.getEmbedTypeDescription(),i.slicerSupportsOnlyOneFilter),n={message:d.ErrorCodes.slicerSupportsOnlyOneFilter,detailedMessage:d.ErrorMessages.slicerSupportsOnlyOneFilter},[2,{statusCode:d.StatusCodes.BadRequest,body:n}]):[4,this.getSlicerTargets(o)];case 3:for(h=w.sent(),g=_.map(l,(function(e){return e.target})),b=function(e){if(!_.some(h,(function(r){return _.isEqual(r,e)}))){y.services.telemetryService.logEvent(telemetry.ReportEmbedSDKError,y.requestId,y.services.reportEmbedState.reportObjectId,y.services.embedModeService.getEmbedTypeDescription(),i.slicerTargetDoesNotMatch);var r={message:d.ErrorCodes.slicerTargetDoesNotMatch,detailedMessage:d.ErrorMessages.slicerTargetDoesNotMatch};return{value:{statusCode:d.StatusCodes.BadRequest,body:r}}}},y=this,f=0,S=g;f<S.length;f++)if(E=S[f],C=b(E),"object"==typeof C)return[2,C.value];w.label=4;case 4:return w.trys.push([4,6,,7]),[4,this.createPersistedPropertiesChanges(o,l[0])];case 5:return c=w.sent(),[3,7];case 6:return I=w.sent(),[2,{statusCode:d.StatusCodes.BadRequest,body:I}];case 7:return this.services.visualAuthoring.persistProperties(c,t,!1),this.services.eventBridge.publishToChannel(powerbi.explore.services.events.visualContainerChanged,{affectContainer:function(e){return e===t}}),this.logTelemetryEvent(l.length,telemetry.ReportEmbedSDKSetSlicer),[2,{statusCode:d.StatusCodes.OK,body:void 0}]}}))}))},e.prototype.getSlicerTargets=function(e){return __awaiter(this,void 0,powerbi.Promise,(function(){var r,t,o,i,s,n;return __generator(this,(function(l){switch(l.label){case 0:return r=[],null==e.getCurrentDataViews?[2,r]:(t=powerbi.visuals.SlicerUtil.getSlicerTargets(e.getCurrentDataViews()),[4,this.services.promiseFactory.all([this.loadJsonFilterModule(),this.getConceptualSchema()])]);case 1:return o=l.sent(),i=o[0],s=o[1],n=new a.jsonFilter.JsonFilterBuilder.SemanticFilterFieldVisitor,r=_.map(t,(function(e){return a.jsonFilter.JsonFilterBuilder.getTarget(e,n,s)})),[2,r]}}))}))},e.prototype.getSlicerMode=function(e){var r=e.objects,t=r[p.data.mode.objectName];if(_.isEmpty(t))return null;for(var o=0,i=t;o<i.length;o++){var s=i[o],n=s.properties[p.data.mode.propertyName];if(null!=n)return n}return null},e.prototype.createPersistedPropertiesChanges=function(e,r){return __awaiter(this,void 0,powerbi.Promise,(function(){var t,i,s,n,a,l,c,p,u,m,v;return __generator(this,(function(h){switch(h.label){case 0:return[4,this.services.promiseFactory.all([this.getJsonFilterParser(),this.getConceptualSchema()])];case 1:return t=h.sent(),i=t[0],s=t[1],[4,i.tryCreateSemanticFilter("Filter",s,r)];case 2:if(n=h.sent(),!n)throw a={message:d.ErrorCodes.filterError,detailedMessage:d.ErrorMessages.invalidFilter};return l=this.services.visualPlugin.capabilities(e.visualType),c=e.objects||{},p=powerbi.data.createStaticEvalContext(powerbi.visuals.visualStyles.create()),u=o.evaluateMetadataOnceDataViewObjectDefinitions(c,l.objects,p),m=this.services.filterGenerator.tryGetFilterPropertyIdentifier(l),v={objects:u,changes:{}},v.changes[m.objectName]={},v.changes[m.objectName][m.propertyName]=n,[2,powerbi.visuals.SlicerPluginMethods.mergeObjects(v)]}}))}))},e.prototype.applySlicers=function(e,r){return __awaiter(this,void 0,powerbi.Promise,(function(){var t,o,i,s,n,a=this;return __generator(this,(function(l){switch(l.label){case 0:if(_.isEmpty(r))return[2];t=0,o=r,l.label=1;case 1:if(!(t<o.length))return[3,7];i=o[t],l.label=2;case 2:return l.trys.push([2,5,,6]),[4,this.validateSlicer(i)];case 3:return s=l.sent(),_.isEmpty(s)?[4,this.persistSlicer(e,i)]:(s.forEach((function(e){a.services.embedRouter.postError("reports",e)})),[3,6]);case 4:return l.sent(),[3,6];case 5:return n=l.sent(),this.services.embedRouter.postError("reports",n),[3,6];case 6:return t++,[3,1];case 7:return[2]}}))}))},e.prototype.persistSlicer=function(e,r){return __awaiter(this,void 0,powerbi.Promise,(function(){var t,o,n,o,a;return __generator(this,(function(l){switch(l.label){case 0:if(t=this.getVisual(e,r),null==t)throw o={message:i.visualNameIsMissing,detailedMessage:s.visualNameIsMissingInSlicerSelector};if(n=this.getSlicerFilter(e,r),null==n)throw o={message:i.slicerFilterIsRequired,detailedMessage:s.slicerFilterIsRequired};return[4,this.createPersistedPropertiesChanges(t.config.singleVisual,n)];case 1:return a=l.sent(),a&&this.services.visualAuthoring.persistProperties(a,t,!1),[2]}}))}))},e.prototype.getVisual=function(e,r){for(var t=r&&r.selector&&r.selector.visualName,o=0,i=e.sections;o<i.length;o++){var s=i[o],a=n.getVisualContainerByName(s,t);if(a)return a}return null},e.prototype.getSlicerFilter=function(e,r){var t=r&&r.state&&r.state.filters;if(_.isEmpty(t))return null;if(1!==t.length){throw{message:i.slicerSupportsOnlyOneFilter,detailedMessage:s.slicerSupportsOnlyOneFilter}}return t[0]},e.prototype.logTelemetryEvent=function(e,r){this.services.telemetryService.logEvent(r,e,this.requestId,this.services.reportEmbedState.reportObjectId,this.services.embedModeService.getEmbedTypeDescription())},e.prototype.getSlicerSelection=function(e){return __awaiter(this,void 0,powerbi.Promise,(function(){var r,t,o,i,s,n,a,l,c;return __generator(this,(function(d){switch(d.label){case 0:return r=this.getPersistedFilters(e),_.isEmpty(r)?(this.logTelemetryEvent(0,telemetry.ReportEmbedSDKGetSlicer),[2,[]]):[4,this.services.promiseFactory.all([this.getJsonFilterParser(),this.getConceptualSchema()])];case 1:t=d.sent(),o=t[0],i=t[1],s=[],n=0,a=r,d.label=2;case 2:return n<a.length?(l=a[n],[4,o.tryCreateJSONFilter(l,i)]):[3,5];case 3:c=d.sent(),s.push(c[0]),d.label=4;case 4:return n++,[3,2];case 5:return this.logTelemetryEvent(r.length,telemetry.ReportEmbedSDKGetSlicer),[2,s.map((function(e){return e?e:null}))]}}))}))},e.prototype.validateSlicer=function(e){return __awaiter(this,void 0,powerbi.Promise,(function(){var r;return __generator(this,(function(t){switch(t.label){case 0:return[4,this.services.moduleLoader.require({javascript:"powerbi-models"})];case 1:return r=t.sent(),[2,r.validateSlicer(e)]}}))}))},e.prototype.validateSlicerState=function(e){return __awaiter(this,void 0,powerbi.Promise,(function(){var r;return __generator(this,(function(t){switch(t.label){case 0:return[4,this.services.moduleLoader.require({javascript:"powerbi-models"})];case 1:return r=t.sent(),[2,r.validateSlicerState(e)]}}))}))},e.prototype.tryGetVisualContainer=function(e,r,t){var o=this.getExploration(e),s=this.getExplorationViewModel(e);if(null==n.getSectionByName(o,r.params.pageName)){var a={message:d.ErrorCodes.pageNotFound,detailedMessage:d.ErrorMessages.invalidPageName};return t.send(d.StatusCodes.BadRequest,a),null}var c=n.getPageIndexByName(r.params.pageName,s.contract);if(c<0)return this.services.telemetryService.logEvent(telemetry.ReportEmbedSDKError,this.requestId,this.services.reportEmbedState.reportObjectId,this.services.embedModeService.getEmbedTypeDescription(),i.pageNotFound),t.send(u.BadRequest,l.buildPageNotFoundErrorMessage(r.params.pageName)),null;if(c!==s.contract.activeSectionIndex)return this.services.telemetryService.logEvent(telemetry.ReportEmbedSDKError,this.requestId,this.services.reportEmbedState.reportObjectId,this.services.embedModeService.getEmbedTypeDescription(),i.pageNotActive),t.send(u.BadRequest,l.createError(d.ErrorCodes.pageNotActive,d.ErrorMessages.pageNotActive,{level:m.Error})),null;var p=n.getVisualContainerViewModel(s,r.params.visualName);if(null==p){var a={message:d.ErrorCodes.visualNotFound,detailedMessage:d.ErrorMessages.invalidVisualName};return t.send(d.StatusCodes.BadRequest,a),null}return p.contract},e.prototype.getPersistedFilters=function(e){var r=[],t=this.services.visualPlugin.capabilities(e.visualType),o=this.services.filterGenerator.tryGetFilterPropertyIdentifier(t),i=e.objects,s=i[o.objectName];if(!_.isEmpty(s))for(var n=0,a=s;n<a.length;n++){var l=a[n],c=l.properties[o.propertyName];null!=c&&r.push(c)}return r},e.prototype.getExplorationViewModel=function(e){return e&&e.viewModel&&e.viewModel.exploration},e.prototype.getExploration=function(e){return e.viewModel.exploration.contract},e.prototype.getConceptualSchema=function(){return __awaiter(this,void 0,powerbi.Promise,(function(){var e,r,t;return __generator(this,(function(o){switch(o.label){case 0:return e=this.services.dataSources.get(),[4,this.services.conceptualSchemaProxy.get(e)];case 1:if(r=o.sent(),!r)throw t={message:d.ErrorCodes.failedGettingSchema,detailedMessage:d.ErrorMessages.failedGettingSchema};return[2,r]}}))}))},e.prototype.getJsonFilterParser=function(){return __awaiter(this,void 0,powerbi.Promise,(function(){var e,r;return __generator(this,(function(t){switch(t.label){case 0:return e=this,r=this.jsonFilterParser,r?[3,2]:[4,c.JsonFilterHelper.createJsonFilterParser(this.services.promiseFactory,this.services.moduleLoader,this.services.telemetryService)];case 1:r=t.sent(),t.label=2;case 2:return e.jsonFilterParser=r,[2,this.jsonFilterParser]}}))}))},e.prototype.loadJsonFilterModule=function(){return __awaiter(this,void 0,powerbi.Promise,(function(){return __generator(this,(function(e){switch(e.label){case 0:return[4,this.services.moduleLoader.require({javascript:"JSONFilter/services/jsonFilterParser"})];case 1:return[2,e.sent()]}}))}))},Object.defineProperty(e.prototype,"requestId",{get:function(){return this.services.embedRouter.requestId},enumerable:!0,configurable:!0}),e})()}));var powerbi;!(function(e){var r;!(function(r){function t(t,o,i,s,n,a,l,c,d,p,u,m,v,h,g,b){var y=r.CustomerAction(n,a,l,c,d,p,u,m,v,h,g,b),f=me(y.info,{reportId:t,embedType:o,embedUrl:i,referrer:s});return{name:"EmbedCustomerAction",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:pe(),formatted:function(){return e.extendFormatted({reportId:f.reportId,embedType:f.embedType,embedUrl:f.embedUrl,referrer:f.referrer},null,y.formatted())},info:f,loggers:r.EmbedCustomerActionLoggers}}function o(t,o,i,s,n,a,l,c,d,p,u,m,v,h,g,b){var y=r.CustomerAction(n,a,l,c,d,p,u,m,v,h,g,b),f=me(y.info,{datasetId:t,embedType:o,embedUrl:i,referrer:s});return{name:"EmbedCustomerCreateAction",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:pe(),formatted:function(){return e.extendFormatted({datasetId:f.datasetId,embedType:f.embedType,embedUrl:f.embedUrl,referrer:f.referrer},null,y.formatted())},info:f,loggers:r.EmbedCustomerCreateActionLoggers}}function i(t,o,i,s,n,a,l,c,d,p,u,m,v,h,g,b){var y=r.CustomerAction(n,a,l,c,d,p,u,m,v,h,g,b),f=me(y.info,{datasetId:t,embedType:o,embedUrl:i,referrer:s});return{name:"EmbedCustomerQnaAction",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:pe(),formatted:function(){return e.extendFormatted({datasetId:f.datasetId,embedType:f.embedType,embedUrl:f.embedUrl,referrer:f.referrer},null,y.formatted())},info:f,loggers:r.EmbedCustomerQnaActionLoggers}}function s(t,o,i,s,n,a,l,c,d,p,u,m,v,h,g){var b=r.CustomerAction(s,n,a,l,c,d,p,u,m,v,h,g),y=me(b.info,{requestId:t,reportId:o,embedType:i});return{name:"EmbedSDKCustomerAction",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:pe(),formatted:function(){return e.extendFormatted({requestId:y.requestId,reportId:y.reportId,embedType:y.embedType},null,b.formatted())},info:y,loggers:r.EmbedSDKCustomerActionLoggers}}function n(t,o,i,s,n,a,l,c,d,p,u,m,v,h){var g=r.CustomerAction(i,s,n,a,l,c,d,p,u,m,v,h),b=me(g.info,{requestId:t,datasetId:o});return{name:"EmbedSDKCustomerQnaAction",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:pe(),formatted:function(){return e.extendFormatted({requestId:b.requestId,datasetId:b.datasetId},null,g.formatted())},info:b,loggers:r.EmbedSDKCustomerQnaActionLoggers}}function a(t,o,i,s,n,a,l,c,d,p,u,m,v,h,g,b,y){var f={sdkSessionId:t,datasetId:o,embedType:i,embedUrl:s,referrer:n,parentId:a,isError:l,errorSource:c,errorCode:d,activityName:p,activityId:u,isCancelled:m,pingLatency:v,isInCapacity:h,isAppInactive:g,errorMessage:b,folderId:y};return{name:"PBI.ReportEmbed.CreateReport",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:pe(),formatted:function(){return e.extendFormatted({sdkSessionId:f.sdkSessionId,datasetId:f.datasetId,embedType:f.embedType,embedUrl:f.embedUrl,referrer:f.referrer,parentId:f.parentId},{isError:f.isError,errorSource:f.errorSource,errorCode:f.errorCode,activityName:f.activityName,activityId:f.activityId,isCancelled:f.isCancelled,pingLatency:f.pingLatency,isInCapacity:f.isInCapacity,isAppInactive:f.isAppInactive,errorMessage:f.errorMessage,folderId:f.folderId})},info:f,loggers:r.ReportEmbedCreateReportLoggers}}function l(t,o,i,s,n,a,l,c,d,p,u,m,v,h,g,b,y,f,S,E,C,I,w,P,x,M){var R={frontload:t,filtersCount:o,slicersCount:i,hasBookmark:s,hasPageName:n,isPhasedRender:a,viewMode:l,hasVisualSettings:c,hasODataFilters:d,sdkSessionId:p,reportId:u,embedType:m,embedUrl:v,referrer:h,parentId:g,isError:b,errorSource:y,errorCode:f,activityName:S,activityId:E,isCancelled:C,pingLatency:I,isInCapacity:w,isAppInactive:P,errorMessage:x,folderId:M};return{name:"PBI.ReportEmbed.LoadEmbeddedReport",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:pe(),formatted:function(){return e.extendFormatted({frontload:R.frontload,filtersCount:R.filtersCount,slicersCount:R.slicersCount,hasBookmark:R.hasBookmark,hasPageName:R.hasPageName,isPhasedRender:R.isPhasedRender,viewMode:R.viewMode,hasVisualSettings:R.hasVisualSettings,hasODataFilters:R.hasODataFilters,sdkSessionId:R.sdkSessionId,reportId:R.reportId,embedType:R.embedType,embedUrl:R.embedUrl,referrer:R.referrer,parentId:R.parentId},{isError:R.isError,errorSource:R.errorSource,errorCode:R.errorCode,activityName:R.activityName,activityId:R.activityId,isCancelled:R.isCancelled,pingLatency:R.pingLatency,isInCapacity:R.isInCapacity,isAppInactive:R.isAppInactive,errorMessage:R.errorMessage,folderId:R.folderId})},info:R,loggers:r.ReportEmbedLoadEmbeddedReportLoggers}}function c(t,o,i,s,n,a,l,c,d,p,u,m,v,h,g,b,y){var f={isExplorationCopied:t,reportId:o,embedType:i,embedUrl:s,referrer:n,parentId:a,isError:l,errorSource:c,errorCode:d,activityName:p,activityId:u,isCancelled:m,pingLatency:v,isInCapacity:h,isAppInactive:g,errorMessage:b,folderId:y};return{name:"PBI.ReportEmbed.ExplorationDeepCopy",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:pe(),formatted:function(){return e.extendFormatted({isExplorationCopied:f.isExplorationCopied,reportId:f.reportId,embedType:f.embedType,embedUrl:f.embedUrl,referrer:f.referrer,parentId:f.parentId},{isError:f.isError,errorSource:f.errorSource,errorCode:f.errorCode,activityName:f.activityName,activityId:f.activityId,isCancelled:f.isCancelled,pingLatency:f.pingLatency,isInCapacity:f.isInCapacity,isAppInactive:f.isAppInactive,errorMessage:f.errorMessage,folderId:f.folderId})},info:f,loggers:r.ReportEmbedExplorationDeepCopyLoggers}}function d(t,o,i,s,n,a,l,c,d,p,u,m,v,h,g,b){var y={reportId:t,embedType:o,embedUrl:i,referrer:s,parentId:n,isError:a,errorSource:l,errorCode:c,activityName:d,activityId:p,isCancelled:u,pingLatency:m,isInCapacity:v,isAppInactive:h,errorMessage:g,folderId:b};return{name:"PBI.ReportEmbed.LoadSecurePublishToWeb",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:pe(),formatted:function(){return e.extendFormatted({reportId:y.reportId,embedType:y.embedType,embedUrl:y.embedUrl,referrer:y.referrer,parentId:y.parentId},{isError:y.isError,errorSource:y.errorSource,errorCode:y.errorCode,activityName:y.activityName,activityId:y.activityId,isCancelled:y.isCancelled,pingLatency:y.pingLatency,isInCapacity:y.isInCapacity,isAppInactive:y.isAppInactive,errorMessage:y.errorMessage,folderId:y.folderId})},info:y,loggers:r.ReportEmbedLoadSecurePublishToWebLoggers}}function p(t,o,i,s,n,a,l,c,d,p,u,m,v,h,g,b,y,f,S,E,C,I){var w={endPoint:t,clientAndServerRequestIdMatch:o,responseRequestId:i,IsResolvedDuringScriptLoad:s,frontLoadStart:n,frontLoadEnd:a,reportId:l,embedType:c,embedUrl:d,referrer:p,parentId:u,isError:m,errorSource:v,errorCode:h,activityName:g,activityId:b,isCancelled:y,pingLatency:f,isInCapacity:S,isAppInactive:E,errorMessage:C,folderId:I};return{name:"PBI.ReportEmbed.GetExplorationAndModel",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:pe(),formatted:function(){return e.extendFormatted({endPoint:w.endPoint,clientAndServerRequestIdMatch:w.clientAndServerRequestIdMatch,responseRequestId:w.responseRequestId,IsResolvedDuringScriptLoad:w.IsResolvedDuringScriptLoad,frontLoadStart:w.frontLoadStart,frontLoadEnd:w.frontLoadEnd,reportId:w.reportId,embedType:w.embedType,embedUrl:w.embedUrl,referrer:w.referrer,parentId:w.parentId},{isError:w.isError,errorSource:w.errorSource,errorCode:w.errorCode,activityName:w.activityName,activityId:w.activityId,isCancelled:w.isCancelled,pingLatency:w.pingLatency,isInCapacity:w.isInCapacity,isAppInactive:w.isAppInactive,errorMessage:w.errorMessage,folderId:w.folderId})},info:w,loggers:r.ReportEmbedGetExplorationAndModelLoggers}}function u(t,o,i,s,n,a,l,c,d,p,u,m,v,h,g,b){var y={reportId:t,embedType:o,embedUrl:i,referrer:s,parentId:n,isError:a,errorSource:l,errorCode:c,activityName:d,activityId:p,isCancelled:u,pingLatency:m,isInCapacity:v,isAppInactive:h,errorMessage:g,folderId:b};return{name:"PBI.ReportEmbed.LoadingStarted",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:pe(),formatted:function(){return e.extendFormatted({reportId:y.reportId,embedType:y.embedType,embedUrl:y.embedUrl,referrer:y.referrer,parentId:y.parentId},{isError:y.isError,errorSource:y.errorSource,errorCode:y.errorCode,activityName:y.activityName,activityId:y.activityId,isCancelled:y.isCancelled,pingLatency:y.pingLatency,isInCapacity:y.isInCapacity,isAppInactive:y.isAppInactive,errorMessage:y.errorMessage,folderId:y.folderId})},info:y,loggers:r.ReportEmbedLoadingStartedLoggers}}function m(t,o,i,s,n,a,l,c,d,p,u,m,v,h,g,b){var y={reportId:t,embedType:o,embedUrl:i,referrer:s,parentId:n,isError:a,errorSource:l,errorCode:c,activityName:d,activityId:p,isCancelled:u,pingLatency:m,isInCapacity:v,isAppInactive:h,errorMessage:g,folderId:b};return{name:"PBI.ReportEmbed.PageLoaded",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:pe(),formatted:function(){return e.extendFormatted({reportId:y.reportId,embedType:y.embedType,embedUrl:y.embedUrl,referrer:y.referrer,parentId:y.parentId},{isError:y.isError,errorSource:y.errorSource,errorCode:y.errorCode,activityName:y.activityName,activityId:y.activityId,isCancelled:y.isCancelled,pingLatency:y.pingLatency,isInCapacity:y.isInCapacity,isAppInactive:y.isAppInactive,errorMessage:y.errorMessage,folderId:y.folderId})},info:y,loggers:r.ReportEmbedPageLoadedLoggers}}function v(t,o,i,s,n,a,l,c,d,p,u,m,v,h,g,b){var y={reportId:t,embedType:o,embedUrl:i,referrer:s,parentId:n,isError:a,errorSource:l,errorCode:c,activityName:d,activityId:p,isCancelled:u,pingLatency:m,isInCapacity:v,isAppInactive:h,errorMessage:g,folderId:b};return{name:"PBI.ReportEmbed.ScriptLoaded",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:pe(),formatted:function(){return e.extendFormatted({reportId:y.reportId,embedType:y.embedType,embedUrl:y.embedUrl,referrer:y.referrer,parentId:y.parentId},{isError:y.isError,errorSource:y.errorSource,errorCode:y.errorCode,activityName:y.activityName,activityId:y.activityId,isCancelled:y.isCancelled,pingLatency:y.pingLatency,isInCapacity:y.isInCapacity,isAppInactive:y.isAppInactive,errorMessage:y.errorMessage,folderId:y.folderId})},info:y,loggers:r.ReportEmbedScriptLoadedLoggers}}function h(t,o,i,s,n,a,l,c,d,p,u,m){var v=r.CustomerAction(t,o,i,s,n,a,l,c,d,p,u,m),h=me(v.info,{});
return{name:"PBI.ReportEmbed.EnterFullScreen",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:pe(),formatted:function(){return e.extendFormatted(null,null,v.formatted())},info:h,loggers:r.ReportEmbedEnterFullScreenLoggers}}function g(t){var o={message:t};return{name:"PBI.ReportEmbed.InvalidReportResourceKey",category:e.TelemetryCategory.CriticalError,time:Date.now(),id:pe(),formatted:function(){return e.extendFormatted({message:o.message},null)},info:o,loggers:r.ReportEmbedInvalidReportResourceKeyLoggers}}function b(t,o,i,s,n,a,l,c,d,p,u,m,v,h,g,b){void 0===o&&(o=void 0);var y=r.CustomerAction(n,a,l,c,d,p,u,m,v,h,g,b),f=me(y.info,{IsResolvedDuringScriptLoad:t,backendUrl:o,frontLoadStart:i,frontLoadEnd:s});return{name:"PBI.ReportEmbed.ClusterResolved",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:pe(),formatted:function(){return e.extendFormatted({IsResolvedDuringScriptLoad:f.IsResolvedDuringScriptLoad,frontLoadStart:f.frontLoadStart,frontLoadEnd:f.frontLoadEnd},{backendUrl:f.backendUrl},y.formatted())},info:f,loggers:r.ReportEmbedClusterResolvedLoggers}}function y(t,o,i,s,n,a,l,c,d,p,u,m,v,h,g){var b=r.CustomerAction(s,n,a,l,c,d,p,u,m,v,h,g),y=me(b.info,{embedType:t,embedUrl:o,referrer:i});return{name:"PBI.ReportEmbed.SwitchPage",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:pe(),formatted:function(){return e.extendFormatted({embedType:y.embedType,embedUrl:y.embedUrl,referrer:y.referrer},null,b.formatted())},info:y,loggers:r.ReportEmbedSwitchPageLoggers}}function f(t,o,i,s,n,a,l,c,d,p,u,m,v,h,g,b,y){void 0===t&&(t=void 0);var f={platformUrl:t,reportId:o,embedType:i,embedUrl:s,referrer:n,parentId:a,isError:l,errorSource:c,errorCode:d,activityName:p,activityId:u,isCancelled:m,pingLatency:v,isInCapacity:h,isAppInactive:g,errorMessage:b,folderId:y};return{name:"PBI.ReportEmbed.SocialSharing",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:pe(),formatted:function(){return e.extendFormatted({reportId:f.reportId,embedType:f.embedType,embedUrl:f.embedUrl,referrer:f.referrer,parentId:f.parentId},{platformUrl:f.platformUrl,isError:f.isError,errorSource:f.errorSource,errorCode:f.errorCode,activityName:f.activityName,activityId:f.activityId,isCancelled:f.isCancelled,pingLatency:f.pingLatency,isInCapacity:f.isInCapacity,isAppInactive:f.isAppInactive,errorMessage:f.errorMessage,folderId:f.folderId})},info:f,loggers:r.ReportEmbedSocialSharingLoggers}}function S(t,o,i,s,n,a,l,c,d,p,u,m,v,h,g,b){var y={reportId:t,embedType:o,embedUrl:i,referrer:s,parentId:n,isError:a,errorSource:l,errorCode:c,activityName:d,activityId:p,isCancelled:u,pingLatency:m,isInCapacity:v,isAppInactive:h,errorMessage:g,folderId:b};return{name:"PBI.ReportEmbed.SaveExploration",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:pe(),formatted:function(){return e.extendFormatted({reportId:y.reportId,embedType:y.embedType,embedUrl:y.embedUrl,referrer:y.referrer,parentId:y.parentId},{isError:y.isError,errorSource:y.errorSource,errorCode:y.errorCode,activityName:y.activityName,activityId:y.activityId,isCancelled:y.isCancelled,pingLatency:y.pingLatency,isInCapacity:y.isInCapacity,isAppInactive:y.isAppInactive,errorMessage:y.errorMessage,folderId:y.folderId})},info:y,loggers:r.ReportEmbedSaveExplorationLoggers}}function E(t,o,i,s,n,a,l,c,d,p,u,m,v,h,g,b,y){var f={customDialogUsed:t,reportId:o,embedType:i,embedUrl:s,referrer:n,parentId:a,isError:l,errorSource:c,errorCode:d,activityName:p,activityId:u,isCancelled:m,pingLatency:v,isInCapacity:h,isAppInactive:g,errorMessage:b,folderId:y};return{name:"PBI.ReportEmbed.SaveAsExploration",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:pe(),formatted:function(){return e.extendFormatted({customDialogUsed:f.customDialogUsed,reportId:f.reportId,embedType:f.embedType,embedUrl:f.embedUrl,referrer:f.referrer,parentId:f.parentId},{isError:f.isError,errorSource:f.errorSource,errorCode:f.errorCode,activityName:f.activityName,activityId:f.activityId,isCancelled:f.isCancelled,pingLatency:f.pingLatency,isInCapacity:f.isInCapacity,isAppInactive:f.isAppInactive,errorMessage:f.errorMessage,folderId:f.folderId})},info:f,loggers:r.ReportEmbedSaveAsExplorationLoggers}}function C(t,o,i,s,n,a,l,c,d,p,u,m,v,h,g,b,y,f){var S={qnaMode:t,sdkSessionId:o,datasetId:i,embedType:s,embedUrl:n,referrer:a,parentId:l,isError:c,errorSource:d,errorCode:p,activityName:u,activityId:m,isCancelled:v,pingLatency:h,isInCapacity:g,isAppInactive:b,errorMessage:y,folderId:f};return{name:"PBI.QnaEmbed.LoadQna",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:pe(),formatted:function(){return e.extendFormatted({qnaMode:S.qnaMode,sdkSessionId:S.sdkSessionId,datasetId:S.datasetId,embedType:S.embedType,embedUrl:S.embedUrl,referrer:S.referrer,parentId:S.parentId},{isError:S.isError,errorSource:S.errorSource,errorCode:S.errorCode,activityName:S.activityName,activityId:S.activityId,isCancelled:S.isCancelled,pingLatency:S.pingLatency,isInCapacity:S.isInCapacity,isAppInactive:S.isAppInactive,errorMessage:S.errorMessage,folderId:S.folderId})},info:S,loggers:r.QnaEmbedLoadQnaLoggers}}function I(t,o,i,s,n,a,l,c,d,p,u,m,v,h,g,b,y){var f={hashedUtterance:t,datasetId:o,embedType:i,embedUrl:s,referrer:n,parentId:a,isError:l,errorSource:c,errorCode:d,activityName:p,activityId:u,isCancelled:m,pingLatency:v,isInCapacity:h,isAppInactive:g,errorMessage:b,folderId:y};return{name:"PBI.QnaEmbed.InterpretUtterance",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:pe(),formatted:function(){return e.extendFormatted({hashedUtterance:f.hashedUtterance,datasetId:f.datasetId,embedType:f.embedType,embedUrl:f.embedUrl,referrer:f.referrer,parentId:f.parentId},{isError:f.isError,errorSource:f.errorSource,errorCode:f.errorCode,activityName:f.activityName,activityId:f.activityId,isCancelled:f.isCancelled,pingLatency:f.pingLatency,isInCapacity:f.isInCapacity,isAppInactive:f.isAppInactive,errorMessage:f.errorMessage,folderId:f.folderId})},info:f,loggers:r.QnaEmbedInterpretUtteranceLoggers}}function w(t,o,i,s,n,a,l,c,d,p,u,m,v,h,g){var b={requestId:t,reportId:o,embedType:i,parentId:s,isError:n,errorSource:a,errorCode:l,activityName:c,activityId:d,isCancelled:p,pingLatency:u,isInCapacity:m,isAppInactive:v,errorMessage:h,folderId:g};return{name:"PBI.ReportEmbed.SDK.PrepareReport",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:pe(),formatted:function(){return e.extendFormatted({requestId:b.requestId,reportId:b.reportId,embedType:b.embedType,parentId:b.parentId},{isError:b.isError,errorSource:b.errorSource,errorCode:b.errorCode,activityName:b.activityName,activityId:b.activityId,isCancelled:b.isCancelled,pingLatency:b.pingLatency,isInCapacity:b.isInCapacity,isAppInactive:b.isAppInactive,errorMessage:b.errorMessage,folderId:b.folderId})},info:b,loggers:r.ReportEmbedSDKPrepareReportLoggers}}function P(t,o,i,s,n,a,l,c,d,p,u,m,v,h,g){var b={requestId:t,reportId:o,embedType:i,parentId:s,isError:n,errorSource:a,errorCode:l,activityName:c,activityId:d,isCancelled:p,pingLatency:u,isInCapacity:m,isAppInactive:v,errorMessage:h,folderId:g};return{name:"PBI.ReportEmbed.SDK.RenderReport",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:pe(),formatted:function(){return e.extendFormatted({requestId:b.requestId,reportId:b.reportId,embedType:b.embedType,parentId:b.parentId},{isError:b.isError,errorSource:b.errorSource,errorCode:b.errorCode,activityName:b.activityName,activityId:b.activityId,isCancelled:b.isCancelled,pingLatency:b.pingLatency,isInCapacity:b.isInCapacity,isAppInactive:b.isAppInactive,errorMessage:b.errorMessage,folderId:b.folderId})},info:b,loggers:r.ReportEmbedSDKRenderReportLoggers}}function x(t,o,i,s,n,a,l,c,d,p,u,m,v,h,g){var b={requestId:t,reportId:o,embedType:i,parentId:s,isError:n,errorSource:a,errorCode:l,activityName:c,activityId:d,isCancelled:p,pingLatency:u,isInCapacity:m,isAppInactive:v,errorMessage:h,folderId:g};return{name:"PBI.ReportEmbed.SDK.LoadReport",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:pe(),formatted:function(){return e.extendFormatted({requestId:b.requestId,reportId:b.reportId,embedType:b.embedType,parentId:b.parentId},{isError:b.isError,errorSource:b.errorSource,errorCode:b.errorCode,activityName:b.activityName,activityId:b.activityId,isCancelled:b.isCancelled,pingLatency:b.pingLatency,isInCapacity:b.isInCapacity,isAppInactive:b.isAppInactive,errorMessage:b.errorMessage,folderId:b.folderId})},info:b,loggers:r.ReportEmbedSDKLoadReportLoggers}}function M(t,o,i,s,n,a,l,c,d,p,u,m,v,h,g){var b={requestId:t,reportId:o,embedType:i,parentId:s,isError:n,errorSource:a,errorCode:l,activityName:c,activityId:d,isCancelled:p,pingLatency:u,isInCapacity:m,isAppInactive:v,errorMessage:h,folderId:g};return{name:"PBI.ReportEmbed.SDK.SetActivePage",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:pe(),formatted:function(){return e.extendFormatted({requestId:b.requestId,reportId:b.reportId,embedType:b.embedType,parentId:b.parentId},{isError:b.isError,errorSource:b.errorSource,errorCode:b.errorCode,activityName:b.activityName,activityId:b.activityId,isCancelled:b.isCancelled,pingLatency:b.pingLatency,isInCapacity:b.isInCapacity,isAppInactive:b.isAppInactive,errorMessage:b.errorMessage,folderId:b.folderId})},info:b,loggers:r.ReportEmbedSDKSetActivePageLoggers}}function R(t,o,i,s,n,a,l,c,d,p,u,m,v,h,g){var b={requestId:t,reportId:o,embedType:i,parentId:s,isError:n,errorSource:a,errorCode:l,activityName:c,activityId:d,isCancelled:p,pingLatency:u,isInCapacity:m,isAppInactive:v,errorMessage:h,folderId:g};return{name:"PBI.ReportEmbed.SDK.GetAllPages",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:pe(),formatted:function(){return e.extendFormatted({requestId:b.requestId,reportId:b.reportId,embedType:b.embedType,parentId:b.parentId},{isError:b.isError,errorSource:b.errorSource,errorCode:b.errorCode,activityName:b.activityName,activityId:b.activityId,isCancelled:b.isCancelled,pingLatency:b.pingLatency,isInCapacity:b.isInCapacity,isAppInactive:b.isAppInactive,errorMessage:b.errorMessage,folderId:b.folderId})},info:b,loggers:r.ReportEmbedSDKGetAllPagesLoggers}}function F(t,o,i,s,n,a,l,c,d,p,u,m,v,h,g){var b={requestId:t,reportId:o,embedType:i,parentId:s,isError:n,errorSource:a,errorCode:l,activityName:c,activityId:d,isCancelled:p,pingLatency:u,isInCapacity:m,isAppInactive:v,errorMessage:h,folderId:g};return{name:"PBI.ReportEmbed.SDK.GetAvailableDisplayArea",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:pe(),formatted:function(){return e.extendFormatted({requestId:b.requestId,reportId:b.reportId,embedType:b.embedType,parentId:b.parentId},{isError:b.isError,errorSource:b.errorSource,errorCode:b.errorCode,activityName:b.activityName,activityId:b.activityId,isCancelled:b.isCancelled,pingLatency:b.pingLatency,isInCapacity:b.isInCapacity,isAppInactive:b.isAppInactive,errorMessage:b.errorMessage,folderId:b.folderId})},info:b,loggers:r.ReportEmbedSDKGetAvailableDisplayAreaLoggers}}function T(t,o,i,s,n,a,l,c,d,p,u,m,v,h,g){var b={requestId:t,reportId:o,embedType:i,parentId:s,isError:n,errorSource:a,errorCode:l,activityName:c,activityId:d,isCancelled:p,pingLatency:u,isInCapacity:m,isAppInactive:v,errorMessage:h,folderId:g};return{name:"PBI.ReportEmbed.SDK.GetAllVisuals",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:pe(),formatted:function(){return e.extendFormatted({requestId:b.requestId,reportId:b.reportId,embedType:b.embedType,parentId:b.parentId},{isError:b.isError,errorSource:b.errorSource,errorCode:b.errorCode,activityName:b.activityName,activityId:b.activityId,isCancelled:b.isCancelled,pingLatency:b.pingLatency,isInCapacity:b.isInCapacity,isAppInactive:b.isAppInactive,errorMessage:b.errorMessage,folderId:b.folderId})},info:b,loggers:r.ReportEmbedSDKGetAllVisualsLoggers}}function L(t,o,i,s,n,a,l,c,d,p,u,m,v,h,g,b){var y={partial:t,requestId:o,reportId:i,embedType:s,parentId:n,isError:a,errorSource:l,errorCode:c,activityName:d,activityId:p,isCancelled:u,pingLatency:m,isInCapacity:v,isAppInactive:h,errorMessage:g,folderId:b};return{name:"PBI.ReportEmbed.SDK.ExportData",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:pe(),formatted:function(){return e.extendFormatted({partial:y.partial,requestId:y.requestId,reportId:y.reportId,embedType:y.embedType,parentId:y.parentId},{isError:y.isError,errorSource:y.errorSource,errorCode:y.errorCode,activityName:y.activityName,activityId:y.activityId,isCancelled:y.isCancelled,pingLatency:y.pingLatency,isInCapacity:y.isInCapacity,isAppInactive:y.isAppInactive,errorMessage:y.errorMessage,folderId:y.folderId})},info:y,loggers:r.ReportEmbedSDKExportDataLoggers}}function A(t,o,i,s,n,a,l,c,d,p,u,m,v,h,g){var b={requestId:t,reportId:o,embedType:i,parentId:s,isError:n,errorSource:a,errorCode:l,activityName:c,activityId:d,isCancelled:p,pingLatency:u,isInCapacity:m,isAppInactive:v,errorMessage:h,folderId:g};return{name:"PBI.ReportEmbed.SDK.SetReportLevelFilters",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:pe(),formatted:function(){return e.extendFormatted({requestId:b.requestId,reportId:b.reportId,embedType:b.embedType,parentId:b.parentId},{isError:b.isError,errorSource:b.errorSource,errorCode:b.errorCode,activityName:b.activityName,activityId:b.activityId,isCancelled:b.isCancelled,pingLatency:b.pingLatency,isInCapacity:b.isInCapacity,isAppInactive:b.isAppInactive,errorMessage:b.errorMessage,folderId:b.folderId})},info:b,loggers:r.ReportEmbedSDKSetReportLevelFiltersLoggers}}function k(t,o,i,s,n,a,l,c,d,p,u,m,v,h,g){var b={requestId:t,reportId:o,embedType:i,parentId:s,isError:n,errorSource:a,errorCode:l,activityName:c,activityId:d,isCancelled:p,pingLatency:u,isInCapacity:m,isAppInactive:v,errorMessage:h,folderId:g};return{name:"PBI.ReportEmbed.SDK.GetReportLevelFilters",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:pe(),formatted:function(){return e.extendFormatted({requestId:b.requestId,reportId:b.reportId,embedType:b.embedType,parentId:b.parentId},{isError:b.isError,errorSource:b.errorSource,errorCode:b.errorCode,activityName:b.activityName,activityId:b.activityId,isCancelled:b.isCancelled,pingLatency:b.pingLatency,isInCapacity:b.isInCapacity,isAppInactive:b.isAppInactive,errorMessage:b.errorMessage,folderId:b.folderId})},info:b,loggers:r.ReportEmbedSDKGetReportLevelFiltersLoggers}}function _(t,o,i,s,n,a,l,c,d,p,u,m,v,h,g){var b={requestId:t,reportId:o,embedType:i,parentId:s,isError:n,errorSource:a,errorCode:l,activityName:c,activityId:d,isCancelled:p,pingLatency:u,isInCapacity:m,isAppInactive:v,errorMessage:h,folderId:g};return{name:"PBI.ReportEmbed.SDK.GetBookmarks",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:pe(),formatted:function(){return e.extendFormatted({requestId:b.requestId,reportId:b.reportId,embedType:b.embedType,parentId:b.parentId},{isError:b.isError,errorSource:b.errorSource,errorCode:b.errorCode,activityName:b.activityName,activityId:b.activityId,isCancelled:b.isCancelled,pingLatency:b.pingLatency,isInCapacity:b.isInCapacity,isAppInactive:b.isAppInactive,errorMessage:b.errorMessage,folderId:b.folderId})},info:b,loggers:r.ReportEmbedSDKGetBookmarksLoggers}}function D(t,o,i,s,n,a,l,c,d,p,u,m,v,h,g){var b={requestId:t,reportId:o,embedType:i,parentId:s,isError:n,errorSource:a,errorCode:l,activityName:c,activityId:d,isCancelled:p,pingLatency:u,isInCapacity:m,isAppInactive:v,errorMessage:h,folderId:g};return{name:"PBI.ReportEmbed.SDK.ApplyBookmarkByName",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:pe(),formatted:function(){return e.extendFormatted({requestId:b.requestId,reportId:b.reportId,embedType:b.embedType,parentId:b.parentId},{isError:b.isError,errorSource:b.errorSource,errorCode:b.errorCode,activityName:b.activityName,activityId:b.activityId,isCancelled:b.isCancelled,pingLatency:b.pingLatency,isInCapacity:b.isInCapacity,isAppInactive:b.isAppInactive,errorMessage:b.errorMessage,folderId:b.folderId})},info:b,loggers:r.ReportEmbedSDKApplyBookmarkByNameLoggers}}function B(t,o,i,s,n,a,l,c,d,p,u,m,v,h,g){var b={requestId:t,reportId:o,embedType:i,parentId:s,isError:n,errorSource:a,errorCode:l,activityName:c,activityId:d,isCancelled:p,pingLatency:u,isInCapacity:m,isAppInactive:v,errorMessage:h,folderId:g};return{name:"PBI.ReportEmbed.SDK.ApplyBookmarkState",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:pe(),formatted:function(){return e.extendFormatted({requestId:b.requestId,reportId:b.reportId,embedType:b.embedType,parentId:b.parentId},{isError:b.isError,errorSource:b.errorSource,errorCode:b.errorCode,activityName:b.activityName,activityId:b.activityId,isCancelled:b.isCancelled,pingLatency:b.pingLatency,isInCapacity:b.isInCapacity,isAppInactive:b.isAppInactive,errorMessage:b.errorMessage,folderId:b.folderId})},info:b,loggers:r.ReportEmbedSDKApplyBookmarkStateLoggers}}function N(t,o,i,s,n,a,l,c,d,p,u,m,v,h,g){var b={requestId:t,reportId:o,embedType:i,parentId:s,isError:n,errorSource:a,errorCode:l,activityName:c,activityId:d,isCancelled:p,pingLatency:u,isInCapacity:m,isAppInactive:v,errorMessage:h,folderId:g};return{name:"PBI.ReportEmbed.SDK.AddBookmark",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:pe(),formatted:function(){return e.extendFormatted({requestId:b.requestId,reportId:b.reportId,embedType:b.embedType,parentId:b.parentId},{isError:b.isError,errorSource:b.errorSource,errorCode:b.errorCode,activityName:b.activityName,activityId:b.activityId,isCancelled:b.isCancelled,pingLatency:b.pingLatency,isInCapacity:b.isInCapacity,isAppInactive:b.isAppInactive,errorMessage:b.errorMessage,folderId:b.folderId})},info:b,loggers:r.ReportEmbedSDKAddBookmarkLoggers}}function q(t,o,i,s,n,a,l,c,d,p,u,m,v,h,g){var b={requestId:t,reportId:o,embedType:i,parentId:s,isError:n,errorSource:a,errorCode:l,activityName:c,activityId:d,isCancelled:p,pingLatency:u,isInCapacity:m,isAppInactive:v,errorMessage:h,folderId:g};return{name:"PBI.ReportEmbed.SDK.CaptureBookmark",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:pe(),formatted:function(){return e.extendFormatted({requestId:b.requestId,reportId:b.reportId,embedType:b.embedType,parentId:b.parentId},{isError:b.isError,errorSource:b.errorSource,errorCode:b.errorCode,activityName:b.activityName,activityId:b.activityId,isCancelled:b.isCancelled,pingLatency:b.pingLatency,isInCapacity:b.isInCapacity,isAppInactive:b.isAppInactive,errorMessage:b.errorMessage,folderId:b.folderId})},info:b,loggers:r.ReportEmbedSDKCaptureBookmarkLoggers}}function H(t,o,i,s,n,a,l,c,d,p,u,m,v,h,g,b){var y={playMode:t,requestId:o,reportId:i,embedType:s,parentId:n,isError:a,errorSource:l,errorCode:c,activityName:d,activityId:p,isCancelled:u,pingLatency:m,isInCapacity:v,isAppInactive:h,errorMessage:g,folderId:b};return{name:"PBI.ReportEmbed.SDK.PlayBookmarks",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:pe(),formatted:function(){return e.extendFormatted({playMode:y.playMode,requestId:y.requestId,reportId:y.reportId,embedType:y.embedType,parentId:y.parentId},{isError:y.isError,errorSource:y.errorSource,errorCode:y.errorCode,activityName:y.activityName,activityId:y.activityId,isCancelled:y.isCancelled,pingLatency:y.pingLatency,isInCapacity:y.isInCapacity,isAppInactive:y.isAppInactive,errorMessage:y.errorMessage,folderId:y.folderId})},info:y,loggers:r.ReportEmbedSDKPlayBookmarksLoggers}}function V(t,o,i,s,n,a,l,c,d,p,u,m,v,h,g,b){var y={filtersCount:t,requestId:o,reportId:i,embedType:s,parentId:n,isError:a,errorSource:l,errorCode:c,activityName:d,activityId:p,isCancelled:u,pingLatency:m,isInCapacity:v,isAppInactive:h,errorMessage:g,folderId:b};return{name:"PBI.ReportEmbed.SDK.GetSlicer",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:pe(),formatted:function(){return e.extendFormatted({filtersCount:y.filtersCount,requestId:y.requestId,reportId:y.reportId,embedType:y.embedType,parentId:y.parentId},{isError:y.isError,errorSource:y.errorSource,errorCode:y.errorCode,activityName:y.activityName,activityId:y.activityId,isCancelled:y.isCancelled,pingLatency:y.pingLatency,isInCapacity:y.isInCapacity,isAppInactive:y.isAppInactive,errorMessage:y.errorMessage,folderId:y.folderId})},info:y,loggers:r.ReportEmbedSDKGetSlicerLoggers}}function O(t,o,i,s,n,a,l,c,d,p,u,m,v,h,g,b){var y={filtersCount:t,requestId:o,reportId:i,embedType:s,parentId:n,isError:a,errorSource:l,errorCode:c,activityName:d,activityId:p,isCancelled:u,pingLatency:m,isInCapacity:v,isAppInactive:h,errorMessage:g,folderId:b};return{name:"PBI.ReportEmbed.SDK.SetSlicer",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:pe(),formatted:function(){return e.extendFormatted({filtersCount:y.filtersCount,requestId:y.requestId,reportId:y.reportId,embedType:y.embedType,parentId:y.parentId},{isError:y.isError,errorSource:y.errorSource,errorCode:y.errorCode,activityName:y.activityName,activityId:y.activityId,isCancelled:y.isCancelled,pingLatency:y.pingLatency,isInCapacity:y.isInCapacity,isAppInactive:y.isAppInactive,errorMessage:y.errorMessage,folderId:y.folderId})},info:y,loggers:r.ReportEmbedSDKSetSlicerLoggers}}function U(t,o,i,s,n,a,l,c,d,p,u,m,v,h,g){var b={requestId:t,reportId:o,embedType:i,parentId:s,isError:n,errorSource:a,errorCode:l,activityName:c,activityId:d,isCancelled:p,pingLatency:u,isInCapacity:m,isAppInactive:v,errorMessage:h,folderId:g};return{name:"PBI.ReportEmbed.SDK.SetPageLevelFilters",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:pe(),formatted:function(){return e.extendFormatted({requestId:b.requestId,reportId:b.reportId,embedType:b.embedType,parentId:b.parentId},{isError:b.isError,errorSource:b.errorSource,errorCode:b.errorCode,activityName:b.activityName,activityId:b.activityId,isCancelled:b.isCancelled,pingLatency:b.pingLatency,isInCapacity:b.isInCapacity,isAppInactive:b.isAppInactive,errorMessage:b.errorMessage,folderId:b.folderId})},info:b,loggers:r.ReportEmbedSDKSetPageLevelFiltersLoggers}}function j(t,o,i,s,n,a,l,c,d,p,u,m,v,h,g){var b={requestId:t,reportId:o,embedType:i,parentId:s,isError:n,errorSource:a,errorCode:l,activityName:c,activityId:d,isCancelled:p,pingLatency:u,isInCapacity:m,isAppInactive:v,errorMessage:h,folderId:g};return{name:"PBI.ReportEmbed.SDK.GetPageLevelFilters",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:pe(),formatted:function(){return e.extendFormatted({requestId:b.requestId,reportId:b.reportId,embedType:b.embedType,parentId:b.parentId},{isError:b.isError,errorSource:b.errorSource,errorCode:b.errorCode,activityName:b.activityName,activityId:b.activityId,isCancelled:b.isCancelled,pingLatency:b.pingLatency,isInCapacity:b.isInCapacity,isAppInactive:b.isAppInactive,errorMessage:b.errorMessage,folderId:b.folderId})},info:b,loggers:r.ReportEmbedSDKGetPageLevelFiltersLoggers}}function z(t,o,i,s,n,a,l,c,d,p,u,m,v,h,g){var b={requestId:t,reportId:o,embedType:i,parentId:s,isError:n,errorSource:a,errorCode:l,activityName:c,activityId:d,isCancelled:p,pingLatency:u,isInCapacity:m,isAppInactive:v,errorMessage:h,folderId:g};return{name:"PBI.ReportEmbed.SDK.SetVisualLevelFilters",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:pe(),formatted:function(){return e.extendFormatted({requestId:b.requestId,reportId:b.reportId,embedType:b.embedType,parentId:b.parentId},{isError:b.isError,errorSource:b.errorSource,errorCode:b.errorCode,activityName:b.activityName,activityId:b.activityId,isCancelled:b.isCancelled,pingLatency:b.pingLatency,isInCapacity:b.isInCapacity,isAppInactive:b.isAppInactive,errorMessage:b.errorMessage,folderId:b.folderId})},info:b,loggers:r.ReportEmbedSDKSetVisualLevelFiltersLoggers}}function K(t,o,i,s,n,a,l,c,d,p,u,m,v,h,g){var b={requestId:t,reportId:o,embedType:i,parentId:s,isError:n,errorSource:a,errorCode:l,activityName:c,activityId:d,isCancelled:p,pingLatency:u,isInCapacity:m,isAppInactive:v,errorMessage:h,folderId:g};return{name:"PBI.ReportEmbed.SDK.GetVisualLevelFilters",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:pe(),formatted:function(){return e.extendFormatted({requestId:b.requestId,reportId:b.reportId,embedType:b.embedType,parentId:b.parentId},{isError:b.isError,errorSource:b.errorSource,errorCode:b.errorCode,activityName:b.activityName,activityId:b.activityId,isCancelled:b.isCancelled,pingLatency:b.pingLatency,isInCapacity:b.isInCapacity,isAppInactive:b.isAppInactive,errorMessage:b.errorMessage,folderId:b.folderId})},info:b,loggers:r.ReportEmbedSDKGetVisualLevelFiltersLoggers}}function W(t,o,i,s,n,a,l,c,d,p,u,m,v,h,g,b){var y={layoutType:t,requestId:o,reportId:i,embedType:s,parentId:n,isError:a,errorSource:l,errorCode:c,activityName:d,activityId:p,isCancelled:u,pingLatency:m,isInCapacity:v,isAppInactive:h,errorMessage:g,folderId:b};return{name:"PBI.ReportEmbed.SDK.CheckPageLayoutType",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:pe(),formatted:function(){return e.extendFormatted({layoutType:y.layoutType,requestId:y.requestId,reportId:y.reportId,embedType:y.embedType,parentId:y.parentId},{isError:y.isError,errorSource:y.errorSource,errorCode:y.errorCode,activityName:y.activityName,activityId:y.activityId,isCancelled:y.isCancelled,pingLatency:y.pingLatency,isInCapacity:y.isInCapacity,isAppInactive:y.isAppInactive,errorMessage:y.errorMessage,folderId:y.folderId})},info:y,loggers:r.ReportEmbedSDKCheckPageLayoutTypeLoggers}}function Q(t,o,i,s,n,a,l,c,d,p,u,m,v,h,g){var b={requestId:t,reportId:o,embedType:i,parentId:s,isError:n,errorSource:a,errorCode:l,activityName:c,activityId:d,isCancelled:p,pingLatency:u,isInCapacity:m,isAppInactive:v,errorMessage:h,folderId:g};return{name:"PBI.ReportEmbed.SDK.UpdateSettings",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:pe(),formatted:function(){return e.extendFormatted({requestId:b.requestId,reportId:b.reportId,embedType:b.embedType,parentId:b.parentId},{isError:b.isError,errorSource:b.errorSource,errorCode:b.errorCode,activityName:b.activityName,activityId:b.activityId,isCancelled:b.isCancelled,pingLatency:b.pingLatency,isInCapacity:b.isInCapacity,isAppInactive:b.isAppInactive,errorMessage:b.errorMessage,folderId:b.folderId})},info:b,loggers:r.ReportEmbedSDKUpdateSettingsLoggers}}function $(t,o,i,s,n,a,l,c,d,p,u,m,v,h,g){var b={requestId:t,reportId:o,embedType:i,parentId:s,isError:n,errorSource:a,errorCode:l,activityName:c,activityId:d,isCancelled:p,pingLatency:u,isInCapacity:m,isAppInactive:v,errorMessage:h,folderId:g};return{name:"PBI.ReportEmbed.SDK.BookmarkApplied",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:pe(),formatted:function(){return e.extendFormatted({requestId:b.requestId,reportId:b.reportId,embedType:b.embedType,parentId:b.parentId},{isError:b.isError,errorSource:b.errorSource,errorCode:b.errorCode,activityName:b.activityName,activityId:b.activityId,isCancelled:b.isCancelled,pingLatency:b.pingLatency,isInCapacity:b.isInCapacity,isAppInactive:b.isAppInactive,errorMessage:b.errorMessage,folderId:b.folderId})},info:b,loggers:r.ReportEmbedSDKBookmarkAppliedLoggers}}function G(t,o,i,s,n,a,l,c,d,p,u,m,v,h,g,b,y){var f={pageSizeType:t,displayOption:o,requestId:i,reportId:s,embedType:n,parentId:a,isError:l,errorSource:c,errorCode:d,activityName:p,activityId:u,isCancelled:m,pingLatency:v,isInCapacity:h,isAppInactive:g,errorMessage:b,folderId:y};return{name:"PBI.ReportEmbed.SDK.CustomLayout",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:pe(),formatted:function(){return e.extendFormatted({pageSizeType:f.pageSizeType,displayOption:f.displayOption,requestId:f.requestId,reportId:f.reportId,embedType:f.embedType,parentId:f.parentId},{isError:f.isError,errorSource:f.errorSource,errorCode:f.errorCode,activityName:f.activityName,activityId:f.activityId,isCancelled:f.isCancelled,pingLatency:f.pingLatency,isInCapacity:f.isInCapacity,isAppInactive:f.isAppInactive,errorMessage:f.errorMessage,folderId:f.folderId})},info:f,loggers:r.ReportEmbedSDKCustomLayoutLoggers}}function J(t,o,i,s,n,a,l,c,d,p,u,m,v,h,g){var b={requestId:t,reportId:o,embedType:i,parentId:s,isError:n,errorSource:a,errorCode:l,activityName:c,activityId:d,isCancelled:p,pingLatency:u,isInCapacity:m,isAppInactive:v,errorMessage:h,folderId:g};return{name:"PBI.ReportEmbed.SDK.ChangeViewMode",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:pe(),formatted:function(){return e.extendFormatted({requestId:b.requestId,reportId:b.reportId,embedType:b.embedType,parentId:b.parentId},{isError:b.isError,errorSource:b.errorSource,errorCode:b.errorCode,activityName:b.activityName,activityId:b.activityId,isCancelled:b.isCancelled,pingLatency:b.pingLatency,isInCapacity:b.isInCapacity,isAppInactive:b.isAppInactive,errorMessage:b.errorMessage,folderId:b.folderId})},info:b,loggers:r.ReportEmbedSDKChangeViewModeLoggers}}function Z(t,o,i,s,n,a,l,c,d,p,u,m,v,h,g){var b={requestId:t,reportId:o,embedType:i,parentId:s,isError:n,errorSource:a,errorCode:l,activityName:c,activityId:d,isCancelled:p,pingLatency:u,isInCapacity:m,isAppInactive:v,errorMessage:h,folderId:g};return{name:"PBI.ReportEmbed.SDK.SaveExploration",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:pe(),formatted:function(){return e.extendFormatted({requestId:b.requestId,reportId:b.reportId,embedType:b.embedType,parentId:b.parentId},{isError:b.isError,errorSource:b.errorSource,errorCode:b.errorCode,activityName:b.activityName,activityId:b.activityId,isCancelled:b.isCancelled,pingLatency:b.pingLatency,isInCapacity:b.isInCapacity,isAppInactive:b.isAppInactive,errorMessage:b.errorMessage,folderId:b.folderId})},info:b,loggers:r.ReportEmbedSDKSaveExplorationLoggers}}function Y(t,o,i,s,n,a,l,c,d,p,u,m,v,h,g){var b={requestId:t,reportId:o,embedType:i,parentId:s,isError:n,errorSource:a,errorCode:l,activityName:c,activityId:d,isCancelled:p,pingLatency:u,isInCapacity:m,isAppInactive:v,errorMessage:h,folderId:g};return{name:"PBI.ReportEmbed.SDK.SaveAsExploration",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:pe(),formatted:function(){return e.extendFormatted({requestId:b.requestId,reportId:b.reportId,embedType:b.embedType,parentId:b.parentId},{isError:b.isError,errorSource:b.errorSource,errorCode:b.errorCode,activityName:b.activityName,activityId:b.activityId,isCancelled:b.isCancelled,pingLatency:b.pingLatency,isInCapacity:b.isInCapacity,isAppInactive:b.isAppInactive,errorMessage:b.errorMessage,folderId:b.folderId})},info:b,loggers:r.ReportEmbedSDKSaveAsExplorationLoggers}}function X(t,o,i,s,n,a,l,c,d,p,u,m,v,h,g){var b={requestId:t,reportId:o,embedType:i,parentId:s,isError:n,errorSource:a,errorCode:l,activityName:c,activityId:d,isCancelled:p,pingLatency:u,isInCapacity:m,isAppInactive:v,errorMessage:h,folderId:g};return{name:"PBI.ReportEmbed.SDK.SetAccessToken",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:pe(),formatted:function(){return e.extendFormatted({requestId:b.requestId,reportId:b.reportId,embedType:b.embedType,parentId:b.parentId},{isError:b.isError,errorSource:b.errorSource,errorCode:b.errorCode,activityName:b.activityName,activityId:b.activityId,isCancelled:b.isCancelled,pingLatency:b.pingLatency,isInCapacity:b.isInCapacity,isAppInactive:b.isAppInactive,errorMessage:b.errorMessage,folderId:b.folderId})},info:b,loggers:r.ReportEmbedSDKSetAccessTokenLoggers}}function ee(t,o,i,s,n,a,l,c,d,p,u,m,v,h){var g={requestId:t,datasetId:o,parentId:i,isError:s,errorSource:n,errorCode:a,activityName:l,activityId:c,isCancelled:d,pingLatency:p,isInCapacity:u,isAppInactive:m,errorMessage:v,folderId:h};return{name:"PBI.QnaEmbed.SDK.LoadQna",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:pe(),formatted:function(){return e.extendFormatted({requestId:g.requestId,datasetId:g.datasetId,parentId:g.parentId},{isError:g.isError,errorSource:g.errorSource,errorCode:g.errorCode,activityName:g.activityName,activityId:g.activityId,isCancelled:g.isCancelled,pingLatency:g.pingLatency,isInCapacity:g.isInCapacity,isAppInactive:g.isAppInactive,errorMessage:g.errorMessage,folderId:g.folderId})},info:g,loggers:r.QnaEmbedSDKLoadQnaLoggers}}function re(t,o,i,s,n,a,l,c,d,p,u,m,v,h){
var g={requestId:t,datasetId:o,parentId:i,isError:s,errorSource:n,errorCode:a,activityName:l,activityId:c,isCancelled:d,pingLatency:p,isInCapacity:u,isAppInactive:m,errorMessage:v,folderId:h};return{name:"PBI.QnaEmbed.SDK.InterpretUtterance",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:pe(),formatted:function(){return e.extendFormatted({requestId:g.requestId,datasetId:g.datasetId,parentId:g.parentId},{isError:g.isError,errorSource:g.errorSource,errorCode:g.errorCode,activityName:g.activityName,activityId:g.activityId,isCancelled:g.isCancelled,pingLatency:g.pingLatency,isInCapacity:g.isInCapacity,isAppInactive:g.isAppInactive,errorMessage:g.errorMessage,folderId:g.folderId})},info:g,loggers:r.QnaEmbedSDKInterpretUtteranceLoggers}}function te(t,o,i,s,n,a,l,c,d,p,u,m,v,h,g,b){var y={filterType:t,requestId:o,reportId:i,embedType:s,parentId:n,isError:a,errorSource:l,errorCode:c,activityName:d,activityId:p,isCancelled:u,pingLatency:m,isInCapacity:v,isAppInactive:h,errorMessage:g,folderId:b};return{name:"PBI.ReportEmbed.SDK.UnsupportedFilterType",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:pe(),formatted:function(){return e.extendFormatted({filterType:y.filterType,requestId:y.requestId,reportId:y.reportId,embedType:y.embedType,parentId:y.parentId},{isError:y.isError,errorSource:y.errorSource,errorCode:y.errorCode,activityName:y.activityName,activityId:y.activityId,isCancelled:y.isCancelled,pingLatency:y.pingLatency,isInCapacity:y.isInCapacity,isAppInactive:y.isAppInactive,errorMessage:y.errorMessage,folderId:y.folderId})},info:y,loggers:r.ReportEmbedSDKUnsupportedFilterTypeLoggers}}function oe(t,o,i,s,n,a,l,c,d,p,u,m,v){var h=r.Verbose(o,i,s,n,a,l,c,d,p,u,m,v),g=me(h.info,{layout:t});return{name:"PBI.ReportEmbed.SDK.LoadedWithLayoutType",category:e.TelemetryCategory.Verbose,time:Date.now(),id:pe(),formatted:function(){return e.extendFormatted({layout:g.layout},null,h.formatted())},info:g,loggers:r.ReportEmbedSDKLoadedWithLayoutTypeLoggers}}function ie(t,o,i,s){var n={requestId:t,reportId:o,embedType:i,message:s};return{name:"PBI.ReportEmbed.SDK.Error",category:e.TelemetryCategory.CriticalError,time:Date.now(),id:pe(),formatted:function(){return e.extendFormatted({requestId:n.requestId,reportId:n.reportId,embedType:n.embedType,message:n.message},null)},info:n,loggers:r.ReportEmbedSDKErrorLoggers}}function se(t,o,i,s,n,a){var l={reportId:t,embedType:o,errorCode:i,detailedMessage:s,technicalDetails:n,message:a};return{name:"PBI.ReportEmbed.SDK.ReportedError",category:e.TelemetryCategory.CriticalError,time:Date.now(),id:pe(),formatted:function(){return e.extendFormatted({reportId:l.reportId,embedType:l.embedType,errorCode:l.errorCode,detailedMessage:l.detailedMessage,technicalDetails:l.technicalDetails,message:l.message},null)},info:l,loggers:r.ReportEmbedSDKReportedErrorLoggers}}function ne(t,o,i){var s={requestId:t,datasetId:o,message:i};return{name:"PBI.QnaEmbed.SDK.Error",category:e.TelemetryCategory.CriticalError,time:Date.now(),id:pe(),formatted:function(){return e.extendFormatted({requestId:s.requestId,datasetId:s.datasetId,message:s.message},null)},info:s,loggers:r.QnaEmbedSDKErrorLoggers}}function ae(t,o,i,s,n,a,l,c,d,p,u,m,v,h,g,b){var y=r.Verbose(n,a,l,c,d,p,u,m,v,h,g,b),f=me(y.info,{requestId:t,reportId:o,embedType:i,renderErrorOccurred:s});return{name:"PBI.ReportEmbed.AllVisualsRendered",category:e.TelemetryCategory.Verbose,time:Date.now(),id:pe(),formatted:function(){return e.extendFormatted({requestId:f.requestId,reportId:f.reportId,embedType:f.embedType},{renderErrorOccurred:f.renderErrorOccurred},y.formatted())},info:f,loggers:r.ReportEmbedAllVisualsRenderedLoggers}}function le(t,o,i,s,n,a,l,c,d,p,u,m,v,h){var g=r.Verbose(i,s,n,a,l,c,d,p,u,m,v,h),b=me(g.info,{requestId:t,reportId:o});return{name:"PBI.ReportEmbed.LateFrontLoad",category:e.TelemetryCategory.Verbose,time:Date.now(),id:pe(),formatted:function(){return e.extendFormatted({requestId:b.requestId,reportId:b.reportId},null,g.formatted())},info:b,loggers:r.ReportEmbedLateFrontLoadLoggers}}function ce(t,o,i,s,n,a,l,c,d,p,u,m,v,h,g,b,y,f){var S={hasAccess:t,modelsAndExplorationSucceed:o,reportId:i,embedType:s,embedUrl:n,referrer:a,parentId:l,isError:c,errorSource:d,errorCode:p,activityName:u,activityId:m,isCancelled:v,pingLatency:h,isInCapacity:g,isAppInactive:b,errorMessage:y,folderId:f};return{name:"PBI.ReportEmbed.PushAccess",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:pe(),formatted:function(){return e.extendFormatted({hasAccess:S.hasAccess,modelsAndExplorationSucceed:S.modelsAndExplorationSucceed,reportId:S.reportId,embedType:S.embedType,embedUrl:S.embedUrl,referrer:S.referrer,parentId:S.parentId},{isError:S.isError,errorSource:S.errorSource,errorCode:S.errorCode,activityName:S.activityName,activityId:S.activityId,isCancelled:S.isCancelled,pingLatency:S.pingLatency,isInCapacity:S.isInCapacity,isAppInactive:S.isAppInactive,errorMessage:S.errorMessage,folderId:S.folderId})},info:S,loggers:r.ReportEmbedPushAccessLoggers}}function de(t,o,i,s,n,a,l,c,d,p,u,m,v,h,g,b){var y={reportId:t,embedType:o,embedUrl:i,referrer:s,parentId:n,isError:a,errorSource:l,errorCode:c,activityName:d,activityId:p,isCancelled:u,pingLatency:m,isInCapacity:v,isAppInactive:h,errorMessage:g,folderId:b};return{name:"PBI.ReportEmbed.CommandsSettings",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:pe(),formatted:function(){return e.extendFormatted({reportId:y.reportId,embedType:y.embedType,embedUrl:y.embedUrl,referrer:y.referrer,parentId:y.parentId},{isError:y.isError,errorSource:y.errorSource,errorCode:y.errorCode,activityName:y.activityName,activityId:y.activityId,isCancelled:y.isCancelled,pingLatency:y.pingLatency,isInCapacity:y.isInCapacity,isAppInactive:y.isAppInactive,errorMessage:y.errorMessage,folderId:y.folderId})},info:y,loggers:r.ReportEmbedCommandsSettingsLoggers}}var pe,ue=jsCommon.Utility,me=jsCommon.UnionExtensions.mergeUnionType;pe=ue?ue.generateGuid:Function.prototype,r.EmbedCustomerAction=t,r.EmbedCustomerCreateAction=o,r.EmbedCustomerQnaAction=i,r.EmbedSDKCustomerAction=s,r.EmbedSDKCustomerQnaAction=n,r.ReportEmbedCreateReport=a,r.ReportEmbedLoadEmbeddedReport=l,r.ReportEmbedExplorationDeepCopy=c,r.ReportEmbedLoadSecurePublishToWeb=d,r.ReportEmbedGetExplorationAndModel=p,r.ReportEmbedLoadingStarted=u,r.ReportEmbedPageLoaded=m,r.ReportEmbedScriptLoaded=v,r.ReportEmbedEnterFullScreen=h,r.ReportEmbedInvalidReportResourceKey=g,r.ReportEmbedClusterResolved=b,r.ReportEmbedSwitchPage=y,r.ReportEmbedSocialSharing=f,r.ReportEmbedSaveExploration=S,r.ReportEmbedSaveAsExploration=E,r.QnaEmbedLoadQna=C,r.QnaEmbedInterpretUtterance=I,r.ReportEmbedSDKPrepareReport=w,r.ReportEmbedSDKRenderReport=P,r.ReportEmbedSDKLoadReport=x,r.ReportEmbedSDKSetActivePage=M,r.ReportEmbedSDKGetAllPages=R,r.ReportEmbedSDKGetAvailableDisplayArea=F,r.ReportEmbedSDKGetAllVisuals=T,r.ReportEmbedSDKExportData=L,r.ReportEmbedSDKSetReportLevelFilters=A,r.ReportEmbedSDKGetReportLevelFilters=k,r.ReportEmbedSDKGetBookmarks=_,r.ReportEmbedSDKApplyBookmarkByName=D,r.ReportEmbedSDKApplyBookmarkState=B,r.ReportEmbedSDKAddBookmark=N,r.ReportEmbedSDKCaptureBookmark=q,r.ReportEmbedSDKPlayBookmarks=H,r.ReportEmbedSDKGetSlicer=V,r.ReportEmbedSDKSetSlicer=O,r.ReportEmbedSDKSetPageLevelFilters=U,r.ReportEmbedSDKGetPageLevelFilters=j,r.ReportEmbedSDKSetVisualLevelFilters=z,r.ReportEmbedSDKGetVisualLevelFilters=K,r.ReportEmbedSDKCheckPageLayoutType=W,r.ReportEmbedSDKUpdateSettings=Q,r.ReportEmbedSDKBookmarkApplied=$,r.ReportEmbedSDKCustomLayout=G,r.ReportEmbedSDKChangeViewMode=J,r.ReportEmbedSDKSaveExploration=Z,r.ReportEmbedSDKSaveAsExploration=Y,r.ReportEmbedSDKSetAccessToken=X,r.QnaEmbedSDKLoadQna=ee,r.QnaEmbedSDKInterpretUtterance=re,r.ReportEmbedSDKUnsupportedFilterType=te,r.ReportEmbedSDKLoadedWithLayoutType=oe,r.ReportEmbedSDKError=ie,r.ReportEmbedSDKReportedError=se,r.QnaEmbedSDKError=ne,r.ReportEmbedAllVisualsRendered=ae,r.ReportEmbedLateFrontLoad=le,r.ReportEmbedPushAccess=ce,r.ReportEmbedCommandsSettings=de})(r=e.telemetry||(e.telemetry={}))})(powerbi||(powerbi={}));
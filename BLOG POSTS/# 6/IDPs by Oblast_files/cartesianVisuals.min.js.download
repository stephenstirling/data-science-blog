"use strict";var __assign=this&&this.__assign||Object.assign||function(e){for(var t,a=1,i=arguments.length;a<i;a++){t=arguments[a];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},__extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])};return function(t,a){function i(){this.constructor=t}e(t,a),t.prototype=null===a?Object.create(a):(i.prototype=a.prototype,new i)}}(),powerbi;!function(e){var t;!function(e){var t=e.Units.FontSize;e.cartesianLegacyResponsiveViewportsBreakpoints={legendWidth:76,legendHeight:58,axesTitleWidth:128,axesTitleHeight:58,axesHeight:58,axesMedWidth:128,axesWidth:76,maxWidthForMediumFont:180,maxWidthForSmallFont:128};var a;!function(a){function i(e,t){o(e,t),r(e,t)}function r(a,i){var r=i.legendData.position,o=a.width<=e.cartesianLegacyResponsiveViewportsBreakpoints.legendWidth&&e.Legend.isLeftOrRight(r),n=a.height<=e.cartesianLegacyResponsiveViewportsBreakpoints.legendHeight&&e.Legend.isTopOrBottom(r);if((o||n)&&(i.legendData.show=!1),a.width<=e.cartesianLegacyResponsiveViewportsBreakpoints.maxWidthForMediumFont){var s=i.legendData.fontProperties.size.pt,l=void 0;l=a.width<=e.cartesianLegacyResponsiveViewportsBreakpoints.maxWidthForSmallFont?Math.min(s,e.Legend.LegendSmallFontSmallViewportInPt):Math.min(s,e.Legend.LegendMediumFontSmallViewportInPt),i.legendData.fontProperties=e.FontProperties.inherit(i.legendData.fontProperties,{size:t.createFromPt(l)})}}function o(a,i){var r=i.axesData;if(a.height<=e.cartesianLegacyResponsiveViewportsBreakpoints.axesTitleHeight&&(r.x.showAxisTitle=!1,r.y.showAxisTitle=!1,r.y2.showAxisTitle=!1),a.width<=e.cartesianLegacyResponsiveViewportsBreakpoints.axesTitleWidth&&(r.y.showAxisTitle=!1,r.y2.showAxisTitle=!1),a.height<=e.cartesianLegacyResponsiveViewportsBreakpoints.axesHeight&&(r.x.show=!1),a.width<=e.cartesianLegacyResponsiveViewportsBreakpoints.axesWidth&&(r.y.show=!1,r.y2.show=!1),a.width<=e.cartesianLegacyResponsiveViewportsBreakpoints.axesMedWidth&&e.Legend.isLeftOrRight(i.legendData.position)&&(r.y.show=!1,r.y2.show=!1),a.width<=e.cartesianLegacyResponsiveViewportsBreakpoints.maxWidthForMediumFont){var o={x:{tickLabels:e.CartesianChart.xAxisSmallFontSizeInPx,title:e.CartesianChart.xAxisSmallFontSizeInPx},y:{tickLabels:e.CartesianChart.yAxisMediumFontSizeInPx,title:e.CartesianChart.yAxisMediumFontSizeInPx},y2:{tickLabels:e.CartesianChart.yAxisMediumFontSizeInPx,title:e.CartesianChart.yAxisMediumFontSizeInPx}};a.width<=e.cartesianLegacyResponsiveViewportsBreakpoints.maxWidthForSmallFont&&(o.y.tickLabels=e.CartesianChart.yAxisSmallFontSizeInPx,o.y.title=e.CartesianChart.yAxisSmallFontSizeInPx,o.y2.tickLabels=e.CartesianChart.yAxisSmallFontSizeInPx,o.y2.title=e.CartesianChart.yAxisSmallFontSizeInPx),r.x.titleFontProperties=e.FontProperties.inherit(r.x.titleFontProperties,{size:t.createFromPx(o.x.title)}),r.y.titleFontProperties=e.FontProperties.inherit(r.y.titleFontProperties,{size:t.createFromPx(o.y.title)}),r.y2.titleFontProperties=e.FontProperties.inherit(r.y2.titleFontProperties,{size:t.createFromPx(o.y2.title)}),r.x.labelFontProperties=e.FontProperties.inherit(r.x.labelFontProperties,{size:t.createFromPx(o.x.tickLabels)}),r.y.labelFontProperties=e.FontProperties.inherit(r.y.labelFontProperties,{size:t.createFromPx(o.y.tickLabels)}),r.y2.labelFontProperties=e.FontProperties.inherit(r.y2.labelFontProperties,{size:t.createFromPx(o.y2.tickLabels)})}}a.applyLegacyResponsiveChanges=i}(a=e.CartesianLegacyResponsiveApplier||(e.CartesianLegacyResponsiveApplier={}))}(t=e.visuals||(e.visuals={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(e){e.cartesianResponsiveBreakpoints={legendPositionWidth:210,legendPositionHeight:100,legendHeight:70,legendWidth:80,xAxesHeight:100,yAxesTitleWidth:210,yAxesWidth:100,xAxesTitleHeight:145,iconWidth:50,iconHeight:50};var t=function(){function t(){this.responsiveFontHelper=new e.ResponsiveCartesianFontHelper}return t.prototype.applyChanges=function(t,a,i){var r=e.ViewModelAdapterUtils.getResponsiveVisualProperties(i,e.cartesianChartProps),o=r.responsive,n=r.responsiveLegacy;return(o||n)&&(a=this.applyResponsiveChanges(t,a,o,n)),a},t.prototype.enumerateObjectInstances=function(e,t,a){"general"===e.objectName&&this.enumerateGeneral(t,a)},t.prototype.createCartesianChartLayerViewModelAdapter=function(t){switch(t){case 5:return new e.ColumnChartLayerViewModelAdapter;case 0:return new e.LineChartLayerViewModelAdapter;case 2:return new e.ScatterChartLayerViewModelAdapter;case 3:return new e.WaterfallChartLayerViewModelAdapter}},t.prototype.enumerateGeneral=function(t,a){var i=e.ViewModelAdapterUtils.getResponsiveVisualProperties(a,e.cartesianChartProps);t.pushInstance({selector:null,properties:{responsive:i.responsive},objectName:"general"})},t.prototype.applyResponsiveChanges=function(a,i,r,o){var n=e.ViewModelAdapterUtils.cloneData(i),s=n.legendData.position;return r?(this.applyIconResponsiveChanges(a,n),this.applyLegendResponsiveChanges(a,s,n),this.applyAxesResponsiveChanges(a,n),this.applyFontSizesChanges(a,n),t.applyScrollbarChanges(a,n)):o&&e.CartesianLegacyResponsiveApplier.applyLegacyResponsiveChanges(a,n),this.updateResponsiveWarnings(n.warningObjectCollection,n,i),n},t.prototype.applyIconResponsiveChanges=function(t,a){(t.height<=e.cartesianResponsiveBreakpoints.iconHeight||t.width<=e.cartesianResponsiveBreakpoints.iconWidth)&&(a.showIcon=!0)},t.prototype.applyLegendResponsiveChanges=function(t,a,i){(t.width<e.cartesianResponsiveBreakpoints.legendPositionWidth||t.height<e.cartesianResponsiveBreakpoints.legendPositionHeight)&&e.Legend.isLeftOrRight(a)&&(i.legendData.position=e.LegendPosition.Top),(t.height<e.cartesianResponsiveBreakpoints.legendHeight||t.width<e.cartesianResponsiveBreakpoints.legendWidth)&&(i.legendData.show=!1),i.legendData.useLargeArrowHitArea=!0},t.applyScrollbarChanges=function(e,a){a.scrollbarOptions=t.ScrollbarOptions},t.prototype.applyAxesResponsiveChanges=function(t,a){t.height<e.cartesianResponsiveBreakpoints.xAxesHeight&&(a.axesData.x.show=!1),t.width<e.cartesianResponsiveBreakpoints.yAxesTitleWidth&&(a.axesData.y.showAxisTitle=!1,a.axesData.y2.showAxisTitle=!1),t.width<e.cartesianResponsiveBreakpoints.yAxesWidth&&(a.axesData.y.show=!1,a.axesData.y2.show=!1),t.height<e.cartesianResponsiveBreakpoints.xAxesTitleHeight&&(a.axesData.x.showAxisTitle=!1)},t.prototype.applyFontSizesChanges=function(e,t){t.legendData&&t.legendData.fontProperties&&(t.legendData.fontProperties=this.responsiveFontHelper.adjustFontSize(e,t.legendData.fontProperties));var a=t.axesData;a.x.labelFontProperties=this.responsiveFontHelper.adjustFontSize(e,a.x.labelFontProperties),a.x.titleFontProperties=this.responsiveFontHelper.adjustFontSize(e,a.x.titleFontProperties),a.y.labelFontProperties=this.responsiveFontHelper.adjustFontSize(e,a.y.labelFontProperties),a.y.titleFontProperties=this.responsiveFontHelper.adjustFontSize(e,a.y.titleFontProperties),a.y2.labelFontProperties=this.responsiveFontHelper.adjustFontSize(e,a.y2.labelFontProperties),a.y2.titleFontProperties=this.responsiveFontHelper.adjustFontSize(e,a.y2.titleFontProperties)},t.prototype.updateResponsiveWarnings=function(t,a,i){var r={},o=a.legendData,n=i.legendData;if(a.showIcon)r.legend=new e.LegendNotRenderedWarning,r.categoryAxis=new e.AxisAndAxisLabelsNotRenderedWarning,r.valueAxis=new e.AxisAndAxisLabelsNotRenderedWarning;else{o.show!==n.show?r.legend=new e.LegendNotRenderedWarning:o.position!==n.position?r.legend=new e.LegendLocationWarning:_.isEqual(o.fontProperties.size,n.fontProperties.size)||(r.legend=new e.LegendFontSizeWarning);var s=a.axesData,l=i.axesData;s.categoryAxis.show!==l.categoryAxis.show?r.categoryAxis=new e.AxisAndAxisLabelsNotRenderedWarning:s.categoryAxis.showAxisTitle!==l.categoryAxis.showAxisTitle?r.categoryAxis=new e.AxisLabelsNotRenderedWarning:_.isEqual(s.categoryAxis.labelFontProperties.size,l.categoryAxis.labelFontProperties.size)&&_.isEqual(s.categoryAxis.titleFontProperties.size,l.categoryAxis.titleFontProperties.size)||(r.categoryAxis=new e.AxisFontSizeWarning),s.valueAxis.show!==l.valueAxis.show?r.valueAxis=new e.AxisAndAxisLabelsNotRenderedWarning:s.valueAxis.showAxisTitle!==l.valueAxis.showAxisTitle?r.valueAxis=new e.AxisLabelsNotRenderedWarning:_.isEqual(s.valueAxis.labelFontProperties.size,l.valueAxis.labelFontProperties.size)&&_.isEqual(s.valueAxis.titleFontProperties.size,l.valueAxis.titleFontProperties.size)||(r.valueAxis=new e.AxisFontSizeWarning)}for(var c in r){var u=r[c],h={selector:null,warnings:[u]};t.addForVisualObject(c,h)}},t.ScrollbarOptions={scrollbarWidth:8,scrollbarRadius:4,scrollbarClass:"responsive"},t}();e.CartesianViewModelAdapter=t}(t=e.visuals||(e.visuals={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(t){var a=function(){function a(){this.responsiveFontHelper=new t.ResponsiveCartesianFontHelper}return a.prototype.applyChanges=function(e,a,i){return t.ViewModelAdapterUtils.shouldApplyResponsiveChanges(i,t.cartesianChartProps)?this.applyResponsiveChanges(e,a):a},a.prototype.getCartesianChartLayerType=function(){return 5},a.prototype.addWarnings=function(e,t,a){if(t&&a){var i=this.responsiveFontHelper.getFontSizeSeriesLabelWarning(t,a);i&&e.addForVisualObject("labels",i)}},a.prototype.applyResponsiveChanges=function(t,a){var i=e.Prototype.inherit(a);return this.applyDataLabelFontSizesChanges(t,i),this.applySeriesDataLabelFontSizeChanges(t,i),i},a.prototype.applyDataLabelFontSizesChanges=function(t,a){a.dataLabelsSettings=e.Prototype.inherit(a.dataLabelsSettings),this.updateLabelSettings(t,a.dataLabelsSettings)},a.prototype.applySeriesDataLabelFontSizeChanges=function(t,a){for(var i=a.series=e.Prototype.inherit(a.series),r=0;r<i.length;r++)if(i[r].labelSettings){var o=i[r]=e.Prototype.inherit(i[r]);o.labelSettings=e.Prototype.inherit(o.labelSettings),this.updateLabelSettings(t,o.labelSettings)}},a.prototype.updateLabelSettings=function(e,t){var a=t.fontProperties;t.fontProperties=this.responsiveFontHelper.adjustFontSize(e,t.fontProperties),a!==t.fontProperties&&(t.labelOverflow=!0)},a}();t.ColumnChartLayerViewModelAdapter=a}(t=e.visuals||(e.visuals={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(t){var a=function(){function a(){this.responsiveFontHelper=new t.ResponsiveCartesianFontHelper}return a.prototype.applyChanges=function(e,a,i){return t.ViewModelAdapterUtils.shouldApplyResponsiveChanges(i,t.cartesianChartProps)?this.applyResponsiveChanges(e,a):a},a.prototype.getCartesianChartLayerType=function(){return 0},a.prototype.addWarnings=function(e,t,a){if(t&&a){var i=this.responsiveFontHelper.getFontSizeSeriesLabelWarning(t,a);i&&e.addForVisualObject("labels",i)}},a.prototype.applyResponsiveChanges=function(t,a){var i=e.Prototype.inherit(a);return this.applyDataLabelFontSizesChanges(t,i),this.applySeriesDataLabelFontSizeChanges(t,i),i},a.prototype.applyDataLabelFontSizesChanges=function(t,a){a.dataLabelsSettings=e.Prototype.inherit(a.dataLabelsSettings),this.updateLabelSettings(t,a.dataLabelsSettings)},a.prototype.applySeriesDataLabelFontSizeChanges=function(t,a){for(var i=a.series=e.Prototype.inherit(a.series),r=0;r<i.length;r++)if(i[r].labelSettings){var o=i[r]=e.Prototype.inherit(i[r]);o.labelSettings=e.Prototype.inherit(o.labelSettings),this.updateLabelSettings(t,o.labelSettings)}},a.prototype.updateLabelSettings=function(e,t){t.fontProperties=this.responsiveFontHelper.adjustFontSize(e,t.fontProperties)},a}();t.LineChartLayerViewModelAdapter=a}(t=e.visuals||(e.visuals={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(t){var a=function(){function a(){this.responsiveFontHelper=new t.ResponsiveCartesianFontHelper}return a.prototype.applyChanges=function(e,a,i){return t.ViewModelAdapterUtils.shouldApplyResponsiveChanges(i,t.cartesianChartProps)?this.applyResponsiveChanges(e,a):a},a.prototype.getCartesianChartLayerType=function(){return 2},a.prototype.addWarnings=function(e,t,a){if(t&&a){var i=this.responsiveFontHelper.getFontSizeLabelWarning(t.dataLabelsSettings,a.dataLabelsSettings);i&&e.addForVisualObject("categoryLabels",i)}},a.prototype.applyResponsiveChanges=function(t,a){var i=e.Prototype.inherit(a);return this.applyDataLabelFontSizesChanges(t,i),i},a.prototype.applyDataLabelFontSizesChanges=function(t,a){a.dataLabelsSettings=e.Prototype.inherit(a.dataLabelsSettings);var i=a.dataLabelsSettings.fontProperties;a.dataLabelsSettings.fontProperties=this.responsiveFontHelper.adjustFontSize(t,i)},a}();t.ScatterChartLayerViewModelAdapter=a}(t=e.visuals||(e.visuals={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(t){var a=function(){function a(){this.responsiveFontHelper=new t.ResponsiveCartesianFontHelper}return a.prototype.applyChanges=function(e,a,i){return t.ViewModelAdapterUtils.shouldApplyResponsiveChanges(i,t.cartesianChartProps)?this.applyResponsiveChanges(e,a):a},a.prototype.getCartesianChartLayerType=function(){return 3},a.prototype.addWarnings=function(e,t,a){if(t&&a){var i=this.responsiveFontHelper.getFontSizeLabelWarning(t.dataLabelsSettings,a.dataLabelsSettings);i&&e.addForVisualObject("labels",i)}},a.prototype.applyResponsiveChanges=function(t,a){var i=e.Prototype.inherit(a);return this.applyDataLabelFontSizesChanges(t,i),i},a.prototype.applyDataLabelFontSizesChanges=function(t,a){a.dataLabelsSettings=e.Prototype.inherit(a.dataLabelsSettings);var i=a.dataLabelsSettings.fontProperties;a.dataLabelsSettings.fontProperties=this.responsiveFontHelper.adjustFontSize(t,i)},a}();t.WaterfallChartLayerViewModelAdapter=a}(t=e.visuals||(e.visuals={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(t){var a=t.AxisDataModel.AxesData,i=e.visuals.DataViewConcatenateUtil,r=e.visuals.controls.SvgScrollbar,o=6,n=function(){function n(e){var a=!1,i=!1,o=!1;this.trimOrdinalDataOnOverflow=!0,e&&(this.tooltipsEnabled=e.tooltipsEnabled,this.type=e.chartType,this.isLabelInteractivityEnabled=e.isLabelInteractivityEnabled,this.binnedLineSampling=e.binnedLineSamplingSupported,this.scatterWithMatrixDV=e.scatterWithMatrixDV,this.scatterXYGrouping=e.scatterXYGrouping,this.waterfallBreakdown=e.waterfallBreakdown,void 0!==e.trimOrdinalDataOnOverflow&&(this.trimOrdinalDataOnOverflow=e.trimOrdinalDataOnOverflow),e.isScrollable&&(a=e.isScrollable),this.animator=e.animator,e.behavior&&(this.behavior=e.behavior),this.lassoSelectEnabled=e.lassoSelectEnabled,i=e.animateCategoryAxis,o=e.animateValueAxis,this.viewMode=0,this.steppedLine=e.steppedLine),this.isCartesianChartVisible=!0,this.axes=new t.CartesianAxes(a,c.ScrollbarWidth,this.trimOrdinalDataOnOverflow),this.svgAxes=new t.SvgCartesianAxes(this.axes),this.svgScrollbar=new r({scrollbarWidth:c.ScrollbarWidth}),this.scrollableAxes=new c(this.axes,this.svgScrollbar,i,o),this.viewModelAdapter=new t.CartesianViewModelAdapter,this.lassoSelectEnabled&&(this.lassoManager=new t.LassoManager),this.dataPointNavigationHelper=new s(this.scrollableAxes)}return n.shouldYAxisBeCategorical=function(e){switch(e){case 6:case 5:case 7:return!0}return!1},n.prototype.init=function(i){this.visualInitOptions=i,this.layers=[];var r=this.element=i.element;this.visibilityHelper=e.requireSync("Visuals/common/responsiveVisualUtil").visibilityHelper(this.element,n.IconClassName),this.currentViewport=i.viewport,this.hostServices=i.host;var o=this.chartAreaSvg=d3.select(r.get(0)).append("svg");o.classed(n.ClassName,!0),o.style("position","absolute"),this.behavior&&(this.clearCatcher=t.appendClearCatcher(o),this.interactivityService=t.createInteractivityService(this.hostServices),this.lassoSelectEnabled&&(this.lassoManager.init(o),this.lassoSelectionBehavior=new t.LassoSelectionBehavior(this.behavior),this.lassoManager.behaviors.push(this.lassoSelectionBehavior)));var s=this.visualInitOptions.style,l=e.Prototype.inherit(s);l.colorPalette=e.Prototype.inherit(s.colorPalette),l.colorPalette.dataColors=new d(s.colorPalette.dataColors),this.layerStyle=l;var c=a.createDefault(s);this.axes.init({axesData:c,isYAxisCategorical:n.shouldYAxisBeCategorical(this.type)}),this.svgAxes.init(o,c),this.svgScrollbar.init(o),this.legend=t.createLegend(r,i.interactivity&&i.interactivity.isInteractiveLegend,13!==this.type?this.interactivityService:void 0,this.axes.isScrollable,void 0,s,this.hostServices),this.isMobileChart=i.interactivity&&i.interactivity.isInteractiveLegend,this.tooltipService=t.createTooltipService(i.host),this.viewMode=i.host.getViewMode()},n.prototype.isPlayAxis=function(){if(!this.dataViews||!this.dataViews[0])return!1;var t=this.dataViews[0];return 10===this.type&&(this.animator||this.isMobileChart)&&e.data.DataRoleHelper.hasRoleInDataView(t,"Play")},n.populateObjectProperties=function(e,t,a,i){if(e&&e.length>0){var r=e[0],o=r.metadata;if(o){var s=n.supportsStaticReferenceLines(e,i);t.push.apply(t,n.getStaticReferenceLines(o,a,s))}}},n.getStaticReferenceLines=function(a,i,r){var o=t.ColorHelper.getDataColorByIndex(i,0,t.ForegroundColorName),n=[];if(r){var s=e.DataViewObjects.getUserDefinedObjects(a.objects,"xAxisReferenceLine");n.push.apply(n,t.ReferenceLineHelper.readDataView(s,o,"xAxisReferenceLine",0,i))}var l=e.DataViewObjects.getUserDefinedObjects(a.objects,"y1AxisReferenceLine");return n.push.apply(n,t.ReferenceLineHelper.readDataView(l,o,"y1AxisReferenceLine",1,i)),n},n.getDataBoundReferenceLines=function(a,i,r,o){var s=[],l=[];if(a)if(!o&&a.categorical&&a.categorical.values){var c=_.head(a.categorical.values.grouped());if(c)for(var u=0,h=c.values;u<h.length;u++){var d=h[u];l.push(d.source)}}else if(a.matrix&&a.matrix.valueSources){var p=a.matrix;if(p.valueSources&&l.push.apply(l,a.matrix.valueSources),p.rows&&p.rows.levels)for(var g=0,y=p.rows.levels;g<y.length;g++){var v=y[g];l.push.apply(l,v.sources)}}for(var m=t.ColorHelper.getDataColorByIndex(r,0,t.ForegroundColorName),f=0,x=l;f<x.length;f++){var C=x[f],S=e.DataViewObjects.getUserDefinedObjects(C.objects,"referenceLine"),b=n.getCartesianRoleKind(C,i);s.push.apply(s,t.ReferenceLineHelper.readDataView(S,m,"referenceLine",b,r,C.queryName))}return s},n.getCartesianRoleKind=function(e,t){var a=e.roles;if(t.getAxisLocationForRole&&a)for(var i in a)if(a[i])return t.getAxisLocationForRole(i);return 1},n.converter=function(e){var i,r=e.dataViews,o=e.layers,s=e.layerStyle,l=e.categoryAxisTitleOnByDefault,u=e.valueAxisTitleOnByDefault,h=e.chartType,d=e.hasDataChanged,p={scrollbarWidth:c.ScrollbarWidth},g=[],y=[],v=!1,m=n.getLayerDataViews(r),f=_.filter(r,t.ForecastHelper.isDataViewForForecast),x=[],C=o.length>1&&!!(r[0]&&r[0].categorical&&r[0].categorical.values),S=s.colorPalette.dataColors;S.clearPreferredScale();for(var b=_.filter(r,t.TrendLineHelper.isDataViewForRegression),w=new t.VisualWarningBuilder,D=0,P=o.length;D<P;D++){var L=m[D],A=o[D],V=L?[L]:[];null!=f[D]&&V.push(f[D]),o[D].setData(V);var M=n.getLegendDataForLayer(A,L,s,C);if(M&&x.push(M),y.push.apply(y,n.getDataBoundReferenceLines(L,o[D],s,e.readMatrix)),n.supportsTrendLines(r,o,D)){var T=b[D];if(T){var k=D>0,F=t.TrendLineHelper.readDataView(T,L,k,s,e.readMatrix);g.push.apply(g,F)}}P>1&&S.rotateScale()}i=x.length>1?t.Legend.mergeLegendData(x,!0):1===x.length?x[0]:t.Legend.getDefaultLegendData(s);var I;if(_.isEmpty(r))I=a.createDefault(s);else{var N=r[0],H=N.metadata,O=!1;H&&N.categorical&&!_.isEmpty(N.categorical.categories)&&(O=!!t.ScalarUtils.getScalarKeys(N.categorical.categories[0]));var R=t.CartesianHelper.getCategoryAxisProperties(H,O||l);I=new a({valueAxisProperties:t.CartesianHelper.getValueAxisProperties(H,u),categoryAxisProperties:R,isYCategorical:n.shouldYAxisBeCategorical(h),isValueAxisDisabled:!n.supportsValueAxis(r,o),isScatter:10===h,style:s}),d&&n.populateObjectProperties(r,y,s,o)}return{legendData:i,trendLines:g,referenceLines:y,axesData:I,warningObjectCollection:w,showIcon:v,scrollbarOptions:p}},n.getLegendDataForLayer=function(e,a,i,r){var o;return e.calculateCustomLegend?o=e.calculateCustomLegend():a&&(o=t.Legend.buildSeriesLegendData({dataView:a,showByDefault:!0,staticSeriesRole:e.getStaticSeriesRole(),style:i,allowLegendWithNoSeries:r})),o},n.prototype.updateInternal=function(a,r){var o=this.dataViews=a.dataViews;if(this.currentViewport=a.viewport,this.shouldResetLegendScrollPosition=null==a.resizeMode||a.isInFocus,o){if(0===this.layers.length){var s=this.extractMetadataObjects(o);this.layers=this.createAndInitLayers(s)}var c,u=this.layers,h=_.some(u,function(e){return e.categoryAxisTitleOnByDefault&&e.categoryAxisTitleOnByDefault()}),d=_.some(u,function(e){return e.valueAxisTitleOnByDefault&&e.valueAxisTitleOnByDefault()});if(null!=r){if(!_.isEmpty(o)){for(var g=n.getLayerDataViews(o),y=void 0,v=0,m=u.length;v<m;v++){var f=g[v];if(null!=f){var x=u[v],C=x.getCartesianVisualCapabilities();this.cartesianVisualCapabilities?this.cartesianVisualCapabilities.supportsHierarchicalCategoryAxis=this.cartesianVisualCapabilities.supportsHierarchicalCategoryAxis&&C.supportsHierarchicalCategoryAxis:this.cartesianVisualCapabilities=e.Prototype.inherit(C);var S=new l(f,C.supportsHierarchicalCategoryAxis).getRenderModes();y=y?_.intersection(y,S):S}}c=this.categoryAxisRenderMode=_.head(y),2===c&&(o=o.map(function(e){return i.concatenateCategories(e,t.columnChartProps.general.formatString,t.cartesianRoleNames.category)}))}this.cartesianData=this.originalCartesianData=n.converter({layerStyle:this.layerStyle,chartType:this.type,dataViews:o,categoryAxisTitleOnByDefault:h,valueAxisTitleOnByDefault:d,layers:u,readMatrix:this.scatterWithMatrixDV,hasDataChanged:null!=r})}if(this.viewModelAdapter&&!_.isEmpty(o)&&(this.cartesianData=this.viewModelAdapter.applyChanges(this.currentViewport,this.originalCartesianData,o[0])),null==r&&this.cartesianData&&this.cartesianData.axesData)this.axes.updateResize(this.cartesianData.axesData,this.cartesianData.scrollbarOptions.scrollbarWidth),this.svgAxes.update(this.cartesianData.axesData);else if(null!=r&&!_.isEmpty(o)){var b=o[0];b.metadata&&(this.background={image:e.DataViewObjects.getValue(b.metadata.objects,t.scatterChartProps.plotArea.image),transparency:e.DataViewObjects.getValue(b.metadata.objects,t.scatterChartProps.plotArea.transparency,t.visualBackgroundHelper.getDefaultTransparency())},0===c&&this.loadMoreDataHandler?this.loadMoreDataHandler=null:0===c||this.loadMoreDataHandler||(this.loadMoreDataHandler=new p(null,this.hostServices.loadMoreData,n.LoadMoreThreshold))),this.axes.update(b.categorical?b.categorical.categories:null,this.cartesianData.axesData,c,this.cartesianData.scrollbarOptions.scrollbarWidth),this.svgAxes.update(this.cartesianData.axesData)}this.cartesianData&&this.svgScrollbar.updateScrollbarOptions(this.cartesianData.scrollbarOptions),this.loadMoreDataHandler&&null!=r&&this.loadMoreDataHandler.onLoadMoreDataCompleted(),this.render(!this.hasSetData||a.suppressAnimations,a.resizeMode,r),this.hasSetData=this.hasSetData||!_.isEmpty(o),this.updateWarnings(this.cartesianData.warningObjectCollection)}},n.prototype.updateWarnings=function(e){var a;if(!_.isEmpty(this.dataViews)){var i=this.dataViews,r=t.getInvalidValueWarnings(i,!1,!1,!1,["Tooltips"],this.scatterWithMatrixDV);if(_.isEmpty(r)||e.add.apply(e,r),this.axes.addWarnings(e),this.noLabelsCanBeRendered){var o={selector:null,warnings:[new t.DataLabelsNotRenderedWarning]};e.addForVisualObject("labels",o)}else{e.removeForVisualObject("labels");for(var n=0,s=this.layers;n<s.length;n++){var c=s[n];c.addWarnings&&c.addWarnings(e)}}for(var u=[],h=this.cartesianVisualCapabilities&&this.cartesianVisualCapabilities.supportsHierarchicalCategoryAxis,d=0,p=i;d<p.length;d++){new l(p[d],h).addObjectWarnings(u)}_.isEmpty(u)||(a=this.cartesianData.warningObjectCollection).addForVisualObject.apply(a,["categoryAxis"].concat(u)),this.hostServices.setWarnings(this.cartesianData.warningObjectCollection.complete())}},n.prototype.update=function(t){null!=t.resizeMode?this.updateInternal(t):this.updateInternal(t,null!=t.operationKind?t.operationKind:e.VisualDataChangeOperationKind.Create)},n.prototype.onViewModeChanged=function(e){this.viewMode=e},n.prototype.bindTouchEvents=function(e,t){var a=this,i={x:0,y:0};t.on("touchstart",function(){if(0===a.viewMode&&(e.isXScrollBarVisible||e.isYScrollBarVisible)){var t=d3.event,r=t.changedTouches[0];i.x=r.pageX,i.y=r.pageY}}),t.on("touchmove",function(){var t=a.hostServices&&a.hostServices.tooltips();if(!(0!==a.viewMode||!e.isXScrollBarVisible&&!e.isYScrollBarVisible||t&&t.isTouchScreenOptimizedEnabled()&&t.visible())){a.tooltipService.hide();var r=d3.event,o=r.changedTouches[0],n=i.x-o.pageX,s=i.y-o.pageY,l=e.isXScrollBarVisible?n:s;a.scrollableAxes.scrollDelta(l),i.x=o.pageX,i.y=o.pageY,r.preventDefault()}})},n.prototype.bindScrollWheelEvents=function(e,t){var a=this;t.on("wheel",function(){if(e.isXScrollBarVisible||e.isYScrollBarVisible){a.tooltipService.hide();var t=d3.event,i=t.deltaX,r=t.deltaY,o=Math.abs(i)>Math.abs(r)?i:r;a.scrollableAxes.scrollDelta(o),t.preventDefault()}})},n.prototype.scrollTo=function(e){this.scrollableAxes.scrollTo(e)},n.prototype.enumerateObjectInstances=function(e){var a=new t.ObjectEnumerationBuilder,i=this.layers?this.layers.length:0;if("legend"===e.objectName){if(!this.shouldShowLegendCard())return;for(var r={enumeration:a,legendData:this.originalCartesianData.legendData},o=0,s=this.layers;o<s.length;o++){var l=s[o];l.enumerateCustomLegend?l.enumerateCustomLegend(r):t.Legend.enumerate(r)}}else"categoryAxis"===e.objectName&&this.axes.hasCategoryAxis()?this.enumerateCategoryAxis(a):"valueAxis"===e.objectName?this.enumerateValueAxis(a):"y1AxisReferenceLine"===e.objectName?this.enumerateReferenceLines(a,e.objectName):"xAxisReferenceLine"===e.objectName?n.supportsStaticReferenceLines(this.dataViews,this.layers)&&this.enumerateReferenceLines(a,e.objectName):"referenceLine"===e.objectName?n.supportsDataBoundReferenceLines(this.dataViews,this.layers)&&this.enumerateReferenceLines(a,e.objectName):"trend"===e.objectName?n.supportsTrendLines(this.dataViews,this.layers)&&t.TrendLineHelper.enumerateObjectInstances(a,this.originalCartesianData.trendLines,this.layerStyle):"plotArea"===e.objectName&&t.visualBackgroundHelper.enumeratePlot(a,this.background);if("dataPoint"===e.objectName&&t.ComboChart.isComboChart(this.type))t.ComboChart.enumerateDataPoints(a,e,this.layers);else for(var c=0,u=i;c<u;c++){var l=this.layers[c];l.enumerateObjectInstances&&l.enumerateObjectInstances(a,e)}if(this.dataViews&&this.dataViews[0]){var h=this.dataViews[0];this.viewModelAdapter.enumerateObjectInstances(e,a,h)}return a.complete()},n.prototype.enumerateReferenceLines=function(e,a){var i=t.ColorHelper.getDataColorByIndex(this.layerStyle,0,t.ForegroundColorName),r=_.filter(this.originalCartesianData.referenceLines,function(e){return e.type===a});t.ReferenceLineHelper.enumerateObjectInstances(e,r,i,a,this.originalCartesianData.axesData.isValueAxisDisabled)},n.supportsTrendLines=function(e,t,a){return n.allLayerSupports(function(e){return e.supportsTrendLine&&e.supportsTrendLine()},e,t,a)},n.supportsValueAxis=function(e,t,a){return n.allLayerSupports(function(e){var t=e.getCartesianVisualCapabilities().supportsValueAxis;return void 0===t||t},e,t,a)},n.supportsDataBoundReferenceLines=function(e,t,a){return n.allLayerSupports(function(e){return!e.isStacked||!e.isStacked()},e,t,a)},n.supportsStaticReferenceLines=function(e,t,a){return n.allLayerSupports(function(e){return!e.supportsStaticReferenceLines||e.supportsStaticReferenceLines()},e,t,a)},n.allLayerSupports=function(e,t,a,i){var r=n.getLayerDataViews(t);if(_.isEmpty(a))return!1;var o=null==i?a:[a[i]];return _.every(o,function(t,a){return!r[a]||e(t)})},n.prototype.shouldShowLegendCard=function(){var e=this.layers,t=this.dataViews;if(e&&t)for(var a=e.length,i=0,r=0;r<a;r++){if(e[r].hasLegend())return!0;var o=t[r];if(o&&o.categorical&&o.categorical.values&&o.categorical.values.length>0&&(i++,i>1))return!0}return!1},n.prototype.getAxisScaleOptions=function(e,a){void 0===e&&(e=!1),void 0===a&&(a=!1);var i,r=this.axes.isYAxisCategorical;i=e?r?0:a?2:1:r?1:0;var o=[t.DEFAULT_AXIS_SCALE_TYPE];return this.axes.isLogScaleAllowed(i)&&o.push(t.axisScale.log),o},n.prototype.enumerateCategoryAxis=function(e){if(this.originalCartesianData&&this.originalCartesianData.axesData&&this.originalCartesianData.axesData.isCategoryAxisSet){var a=this.originalCartesianData.axesData.categoryAxis,i=t.cartesianChartProps.categoryAxis,r=3===this.categoryAxisRenderMode,o=r?t.axisType.categorical:t.axisType.both,n=!1,s=this.getAxisScaleOptions(!1);o===t.axisType.both&&this.layers&&this.layers[0].getSupportedCategoryAxisType&&(o=this.layers[0].getSupportedCategoryAxisType(),o===t.axisType.scalar?n=!0:(n=t.CartesianHelper.isScalar(o===t.axisType.both,a),n&&(n=this.layers&&this.layers[0].getVisualCategoryAxisIsScalar?this.layers[0].getVisualCategoryAxisIsScalar():0===this.categoryAxisRenderMode)));var l={selector:null,properties:{},objectName:"categoryAxis",validValues:{axisScale:s,axisStyle:this.axes.categoryAxisHasUnitType?[t.axisStyle.showTitleOnly,t.axisStyle.showUnitOnly,t.axisStyle.showBoth]:[t.axisStyle.showTitleOnly]},propertyTypes:{}};if(l.properties[i.show.propertyName]=a.show,this.axes.isYAxisCategorical&&(l.properties[i.position.propertyName]=a.position),o===t.axisType.both&&(l.properties[i.axisType.propertyName]=n?t.axisType.scalar:t.axisType.categorical),n&&(l.properties[i.axisScale.propertyName]=a.axisScale,l.properties[i.start.propertyName]=a.start,l.properties[i.end.propertyName]=a.end),l.properties[i.labelColor.propertyName]=t.AxisDataModel.toColorFill(a.labelFontProperties.color),l.properties[i.fontSize.propertyName]=a.labelFontProperties.size.px,l.properties[i.fontFamily.propertyName]=a.labelFontProperties.family,n){l.properties[i.labelDisplayUnits.propertyName]=a.labelDisplayUnits,l.properties[i.labelPrecision.propertyName]=a.labelPrecision;var c={numberRange:{min:0,max:t.dataLabelUtils.MaxLabelPrecision}};l.validValues[i.labelPrecision.propertyName]=c}if(this.axes.isCategoryAxisDateTime()?(l.propertyTypes[i.start.propertyName]={dateTime:!0},l.propertyTypes[i.end.propertyName]={dateTime:!0}):(l.propertyTypes[i.start.propertyName]={numeric:!0},l.propertyTypes[i.end.propertyName]={numeric:!0}),n||(l.properties[i.preferredCategoryWidth.propertyName]=a.preferredCategoryWidth,l.properties[i.maxMarginFactor.propertyName]=Math.round(100*a.maxMarginFactor),l.validValues[i.maxMarginFactor.propertyName]={numberRange:{min:15,max:50},unitSymbol:"Slider_Percent"},9!==this.type&&(l.properties[i.innerPadding.propertyName]=Math.round(100*a.innerPadding),l.validValues[i.innerPadding.propertyName]={numberRange:{min:0,max:50},unitSymbol:"Slider_Percent"})),this.cartesianVisualCapabilities.supportsHierarchicalCategoryAxis&&!n){var u=i.concatenateLabels.propertyName;l.properties[u]=a.concatenateLabels}l.properties[i.showAxisTitle.propertyName]=a.showAxisTitle,l.properties[i.showAxisTitle.propertyName]&&(l.properties[i.axisStyle.propertyName]=a.axisStyle,l.properties[i.titleColor.propertyName]=t.AxisDataModel.toColorFill(a.titleFontProperties.color),l.properties[i.titleText.propertyName]=a.titleText,l.properties[i.titleFontSize.propertyName]=a.titleFontProperties.size.px,l.properties[i.titleFontFamily.propertyName]=a.titleFontProperties.family),(n||r)&&(l.properties[i.gridlineShow.propertyName]=a.gridlineShow,a.gridlineShow&&(l.properties[i.gridlineColor.propertyName]=t.AxisDataModel.toColorFill(a.gridlineColor),l.properties[i.gridlineThickness.propertyName]=a.gridlineThickness,l.validValues.gridlineThickness=["1","2","3","4"],l.properties[i.gridlineStyle.propertyName]=a.gridlineStyle)),e.pushInstance(l)}},n.prototype.enumerateValueAxis=function(e){if(this.originalCartesianData&&this.originalCartesianData.axesData&&this.originalCartesianData.axesData.isValueAxisSet&&!this.originalCartesianData.axesData.isValueAxisDisabled){var a={numberRange:{min:0,max:t.dataLabelUtils.MaxLabelPrecision}},i=this.originalCartesianData.axesData.valueAxis,r=t.cartesianChartProps.valueAxis,o=this.getAxisScaleOptions(!0),n=this.getAxisScaleOptions(!0,!0),s={
selector:null,properties:{},objectName:"valueAxis",validValues:{axisScale:o,secAxisScale:n,axisStyle:this.axes.valueAxisHasUnitType?[t.axisStyle.showTitleOnly,t.axisStyle.showUnitOnly,t.axisStyle.showBoth]:[t.axisStyle.showTitleOnly],secAxisStyle:this.axes.secondaryValueAxisHasUnitType?[t.axisStyle.showTitleOnly,t.axisStyle.showUnitOnly,t.axisStyle.showBoth]:[t.axisStyle.showTitleOnly]},propertyTypes:{}};s.properties[r.show.propertyName]=i.show,s.properties[r.axisLabel.propertyName]=i.axisLabel,this.axes.isYAxisCategorical||(s.properties[r.position.propertyName]=i.position),s.properties[r.axisScale.propertyName]=i.axisScale,s.properties[r.start.propertyName]=i.start,s.properties[r.end.propertyName]=i.end,s.propertyTypes[r.start.propertyName]={numeric:!0},s.propertyTypes[r.end.propertyName]={numeric:!0},s.properties[r.labelColor.propertyName]=t.AxisDataModel.toColorFill(i.labelFontProperties.color),s.properties[r.fontSize.propertyName]=i.labelFontProperties.size.px,s.properties[r.fontFamily.propertyName]=i.labelFontProperties.family,7!==this.type&&8!==this.type&&(s.properties[r.labelDisplayUnits.propertyName]=i.labelDisplayUnits,s.properties[r.labelPrecision.propertyName]=i.labelPrecision,s.validValues[r.labelPrecision.propertyName]=a),s.properties[r.showAxisTitle.propertyName]=i.showAxisTitle,s.properties[r.showAxisTitle.propertyName]&&(s.properties[r.axisStyle.propertyName]=i.axisStyle,s.properties[r.titleColor.propertyName]=t.AxisDataModel.toColorFill(i.titleFontProperties.color),s.properties[r.titleText.propertyName]=i.titleText,s.properties[r.titleFontSize.propertyName]=i.titleFontProperties.size.px,s.properties[r.titleFontFamily.propertyName]=i.titleFontProperties.family),s.properties[r.gridlineShow.propertyName]=i.gridlineShow,i.gridlineShow&&(s.properties[r.gridlineColor.propertyName]=t.AxisDataModel.toColorFill(i.gridlineColor),s.properties[r.gridlineThickness.propertyName]=i.gridlineThickness,s.validValues.gridlineThickness=["1","2","3","4"],s.properties[r.gridlineStyle.propertyName]=i.gridlineStyle);var l=this.originalCartesianData.axesData.y2;2===this.layers.length&&(s.properties[r.secShow.propertyName]=void 0!==l.show?l.show:this.axes.hasY2Axis()),this.axes.hasY2Axis()&&s.properties[r.secShow.propertyName]&&(s.properties[r.alignZeros.propertyName]=i.alignZeros,s.properties.secAxisLabel="",s.properties[r.secPosition.propertyName]=l.position,s.properties[r.secAxisScale.propertyName]=l.axisScale,s.properties[r.secStart.propertyName]=l.start,s.properties[r.secEnd.propertyName]=l.end,s.propertyTypes[r.secStart.propertyName]={numeric:!0},s.propertyTypes[r.secEnd.propertyName]={numeric:!0},s.properties[r.secLabelColor.propertyName]=t.AxisDataModel.toColorFill(l.labelFontProperties.color),s.properties[r.secFontSize.propertyName]=l.labelFontProperties.size.px,s.properties[r.secFontFamily.propertyName]=l.labelFontProperties.family,s.properties[r.secLabelDisplayUnits.propertyName]=l.labelDisplayUnits,s.properties[r.secShowAxisTitle.propertyName]=l.showAxisTitle,s.properties[r.secLabelPrecision.propertyName]=l.labelPrecision,s.validValues[r.secLabelPrecision.propertyName]=a,s.properties[r.secShowAxisTitle.propertyName]&&(s.properties[r.secAxisStyle.propertyName]=l.axisStyle,s.properties[r.secTitleColor.propertyName]=t.AxisDataModel.toColorFill(l.titleFontProperties.color),s.properties[r.secTitleText.propertyName]=l.titleText,s.properties[r.secTitleFontSize.propertyName]=l.titleFontProperties.size.px,s.properties[r.secTitleFontFamily.propertyName]=l.titleFontProperties.family)),e.pushInstance(s)}},n.prototype.onClearSelection=function(){if(this.hasSetData)for(var e=0,t=this.layers.length;e<t;e++){var a=this.layers[e];a.onClearSelection(),a.render(!0)}},n.prototype.onRestoreSelection=function(e){return!!this.interactivityService&&this.interactivityService.restoreSelection(e.selection)},n.prototype.extractMetadataObjects=function(e){var t;if(e&&e.length>0){var a=e[0].metadata;a&&(t=a.objects)}return t},n.prototype.createAndInitLayers=function(t){var a=this,i=new h(this.viewModelAdapter),r=i.createLayers({type:this.type,objects:t,interactivityService:this.interactivityService,animator:this.animator,isScrollable:this.axes.isScrollable,tooltipsEnabled:this.tooltipsEnabled,featureSwitches:{binnedLineSamplingSupported:this.binnedLineSampling,scatterWithMatrixDV:this.scatterWithMatrixDV,scatterXYGrouping:this.scatterXYGrouping,waterfallBreakdown:this.waterfallBreakdown,steppedLine:this.steppedLine}}),o=e.Prototype.inherit(this.visualInitOptions);o.svg=this.svgAxes.getScrollableRegion(),o.labelsContext=this.svgAxes.getLabelsRegion(),o.cartesianHost={updateLegend:function(e){return a.legend.drawLegend(e,a.currentViewport,a.shouldResetLegendScrollPosition)},triggerRender:function(e){return a.render(e)}},o.chartType=this.type,o.services={tooltips:this.tooltipService},o.style=this.layerStyle;for(var n=0,s=r.length;n<s;n++)r[n].init(o);return r},n.prototype.renderLegend=function(){var a=e.Prototype.inherit(this.cartesianData.legendData);null!=a.position?this.legend.changeOrientation(a.position):this.legend.changeOrientation(t.LegendPosition.Top),1!==a.dataPoints.length||a.grouped||(a.dataPoints=[]),this.legend.drawLegend(a,this.currentViewport,this.shouldResetLegendScrollPosition)},n.prototype.isSideLegendExists=function(){return this.legend.isVisible()&&t.Legend.isLeftOrRight(this.legend.getOrientation())},n.prototype.render=function(e,t,a){this.cartesianData.showIcon?this.visibilityHelper.updateVisibility({showIcon:this.cartesianData.showIcon,viewport:this.currentViewport}):(this.visibilityHelper.updateVisibility({showIcon:this.cartesianData.showIcon}),this.renderCartesianChart(e,t,a))},n.prototype.renderCartesianChart=function(a,i,r){var o=this;this.visualInitOptions.interactivity&&this.visualInitOptions.interactivity.isInteractiveLegend||this.renderLegend();var s,l=this.legendMargins=this.legend.getMargins(),c=this.legend.getOrientation(),u=this.showAxisTitles(this.cartesianData.axesData),h=this.shouldRenderAxis(this.cartesianData.axesData),d=this.getAxesFontProperties(),p={height:this.currentViewport.height-l.height,width:this.currentViewport.width-l.width},g=e.Prototype.inherit(t.SvgCartesianAxes.AxisPadding);this.isPlayAxis()&&(p.height-=n.PlayAxisBottomMargin,s={left:t.Legend.isLeft(c)?l.width:0,top:t.Legend.isTop(c)?l.height+p.height:p.height,height:n.PlayAxisBottomMargin,width:p.width}),this.chartAreaSvg.attr({width:p.width,height:p.height}),t.Legend.positionChartArea(this.chartAreaSvg,this.legend);var y=this.calculateInteractivityRightMargin(),v=this.getMinimumDomainExtents(),m=v[0],f=v[1],x=!this.renderedPlotArea||this.renderedPlotArea.height!==p.height||this.renderedPlotArea.width!==p.width;a=a||x;var C=this.axes.negotiateAxes(this.layers,p,g,s,u,h,d,y,m,f),S=C.axes.x.isCategoryAxis?C.axes.x:C.axes.y1;if(this.loadMoreDataHandler&&this.loadMoreDataHandler.setScale(S.scale),this.lassoSelectionBehavior&&this.lassoSelectionBehavior.update(C),this.renderedPlotArea=p,!(C.plotArea.width<1||C.plotArea.height<1)){var b=this.layers,w=function(e,t,a,r,n){return o.renderPlotArea(e,t,a,l,d,i,r,n)},D=this.loadMoreDataHandler,P=r===e.VisualDataChangeOperationKind.Append||null!=i;this.scrollableAxes.render(C,b,a,w,D,P),this.bindScrollWheelEvents(C,this.chartAreaSvg),this.bindTouchEvents(C,this.chartAreaSvg)}},n.prototype.getMinimumDomainExtents=function(){var e=[],a=[];return t.ReferenceLineHelper.gatherDomainExtents(this.cartesianData.referenceLines,e,a),[{min:d3.min(e),max:d3.max(e)},{min:d3.min(a),max:d3.max(a)}]},n.prototype.getPlotAreaRect=function(e,a){var i={left:e.margin.left,top:e.margin.top,width:e.plotArea.width,height:e.plotArea.height};if(this.legend){var r=this.legend.getOrientation();t.Legend.isTop(r)?i.top+=a.height:t.Legend.isLeft(r)&&(i.left+=a.width)}return i},n.prototype.renderBackgroundImage=function(e){t.visualBackgroundHelper.renderBackgroundImage(this.background,this.element,e)},n.prototype.showAxisTitles=function(e){return{x:e.x.showAxisTitle,y:e.y.showAxisTitle,y2:e.y2.showAxisTitle}},n.prototype.shouldRenderAxis=function(e){return{x:e.x.show,y:e.y.show,y2:e.y.show&&e.y2.show!==!1}},n.prototype.getAxesFontProperties=function(){var e=this.cartesianData.axesData.x,t={tickLabels:e.labelFontProperties,title:e.titleFontProperties},a=this.cartesianData.axesData.y,i={tickLabels:a.labelFontProperties,title:a.titleFontProperties},r=this.cartesianData.axesData.y2;return{x:t,y:i,y2:{tickLabels:r.labelFontProperties,title:r.titleFontProperties}}},n.prototype.calculateInteractivityRightMargin=function(){return this.visualInitOptions.interactivity&&this.visualInitOptions.interactivity.isInteractiveLegend&&!this.trimOrdinalDataOnOverflow?o:0},n.prototype.renderPlotArea=function(e,a,i,r,o,n,s,l){i=i||_.some(e,function(e){return e.shouldSuppressAnimation&&e.shouldSuppressAnimation()});var c=a.axes,u=a.plotArea,h=this.getPlotAreaRect(a,r),d=t.AnimatorCommon.GetAnimationDuration(this.animator,i),p=this.animator&&this.animator.getEasing();this.renderBackgroundImage(h),this.svgAxes.renderAxes({axesLayout:a,duration:d,axesFontProperties:o,animateCategoryAxis:s,animateValueAxis:l,easing:_.isEmpty(p)?void 0:p}),this.renderReferenceLines(a),this.renderLayers(e,u,c,i,n),this.renderTrendLines(a)},n.prototype.renderTrendLines=function(e){var a=this.svgAxes.getScrollableRegion();t.TrendLineHelper.render(this.cartesianData.trendLines,a,e.axes,e.plotArea)},n.prototype.renderReferenceLines=function(e){var a={graphicContext:this.svgAxes.getScrollableRegion(),axes:e.axes,viewport:e.plotArea,referenceLines:this.cartesianData.referenceLines};t.ReferenceLineHelper.render(a)},n.prototype.getReferenceLineLabels=function(e,a){var i={axes:e,viewport:a,referenceLines:this.cartesianData.referenceLines,hostServices:this.hostServices};return t.ReferenceLineHelper.createLabelDataPoint(i)},n.prototype.renderDataLabels=function(a,i,r,o,n,s){var l=this.svgAxes.getLabelBackground(),c=this.svgAxes.getLabelsRegion(),u=[];if(this.behavior){var h=t.LabelUtils.getDataLabelLayoutOptions(this.type),d=new e.LabelLayout(h);u=d.layout(a,r);var p=void 0,g=this.animator;if(g&&!o&&s){var y=this.isPlayAxis(),v=y?t.PlayChart.FrameAnimationDuration:g.getDuration();p=t.NewDataLabelUtils.animateLabelsAndBackgrounds({labelContext:c,dataLabels:t.LabelUtils.downgradeToOldLabels(u),duration:v,numeric:i,easeType:y?"linear":g.getEasing(),backgroundContext:l})}else p=t.NewDataLabelUtils.drawLabelsAndBackgrounds({labelContext:c,dataLabels:t.LabelUtils.downgradeToOldLabels(u),numeric:i,backgroundContext:l});if(h.allowLeaderLines){var m=_.filter(u,function(e){return null!=e.leaderLinePoints&&!_.isEmpty(e.leaderLinePoints)&&null!=e.identity});t.LabelUtils.drawLabelLeaderLines(c,m,function(e){return e.identity.getKey()})}if(this.interactivityService&&this.isLabelInteractivityEnabled){var f={labelItems:p};this.interactivityService.bind(u,new t.LabelsBehavior,f,{isLabels:!0})}}else{var d=new e.LabelLayout({maximumOffset:t.LabelUtils.maxLabelOffset,startingOffset:t.LabelUtils.startingLabelOffset,attemptToMoveLabelsIntoViewport:!0});u=d.layout(a,r),t.NewDataLabelUtils.drawLabelsAndBackgrounds({labelContext:c,dataLabels:t.LabelUtils.downgradeToOldLabels(u),numeric:i,backgroundContext:l})}for(var x,C=0,S=a;C<S.length;C++){var b=S[C];if(!_.isEmpty(b.labelDataPoints)){x=!0;break}}return!_.isEmpty(u)||!x},n.prototype.renderLayers=function(e,a,i,r,o){var n,s=[],l=[],c=[],u=!0;r=r||_.some(e,function(e){return e.shouldSuppressAnimation&&e.shouldSuppressAnimation()});for(var h=!0,d=0,p=e;d<p.length;d++){var g=p[d],y=g.render(r,o);if(y){if(y.animateLabels||(h=!1),this.behavior&&(l=l.concat(y.dataPoints),c.push(y.behaviorOptions),y.navigationOptions&&(n={navigationOptions:{navigationStrategy:y.navigationOptions.navigationStrategy,helper:this.dataPointNavigationHelper}},this.dataPointNavigationHelper.clearNavigationLayers(),this.dataPointNavigationHelper.addNavigationLayer(y.navigationOptions.helper))),y.labelDataPointGroups)for(var v=y.labelDataPointGroups,m=0,f=v;m<f.length;m++){var x=f[m];x&&s.push({labelDataPoints:t.LabelUtils.removeDuplicates(x.labelDataPoints||[]),maxNumberOfLabels:x.maxNumberOfLabels,labelOrientation:y.labelOrientation})}else{var C=y.labelDataPoints||[];s.push({labelDataPoints:t.LabelUtils.removeDuplicates(C),maxNumberOfLabels:C.length,labelOrientation:y.labelOrientation})}u=u&&y.labelsAreNumeric}}var S=this.getReferenceLineLabels(i,a);if(_.isEmpty(S)||s.unshift({labelDataPoints:S,maxNumberOfLabels:S.length}),this.noLabelsCanBeRendered=!this.renderDataLabels(s,u,a,r,t.ComboChart.isComboChart(this.type),h),this.dataPointNavigationHelper.getPendingFocusElement&&n&&(n.navigationOptions.focusElement=this.dataPointNavigationHelper.getPendingFocusElement(),this.dataPointNavigationHelper.getPendingFocusElement=void 0),this.interactivityService){var b={layerOptions:c,clearCatcher:this.clearCatcher,root:this.chartAreaSvg};this.interactivityService.bind(l,this.behavior,b,n)}},n.getPreferredPlotArea=function(e,t,a,i,r,o,s){o||(o={top:0,right:0,bottom:0,left:0});var l={height:a.height-o.top-o.bottom,width:a.width-o.left-o.right};if(!r&&i){var c=n.getPreferredCategorySpan(e,t,s);l.width=Math.max(c,l.width)}return l},n.getPreferredCategorySpan=function(e,t,a){return t*e+t*(a||0)*2},n.getLayout=function(t,a){var i=a.categoryCount,r=a.availableWidth,o=!!a.isScalar,s=!!a.isScrollable,l=n.getCategoryWidth(t?t.series:null,a),c=n.getCustomizedCategoryWidthInfo(l,a),u=c.categoryWidth,h=c.outerPaddingRatio,d=u*h*2,p=e.Double.floorWithPrecision((r-d)/u),g=Math.min(p,i),y=g<i&&s;if(!o&&!y){var v=(r-u*g)/2;h=Math.max(0,v/u),h=e.Double.equalWithPrecision(h,0)?0:h}return!o&&s&&(g=i),{categoryCount:g,categoryThickness:u,outerPaddingRatio:h,innerPaddingRatio:a.innerPaddingRatio,isScalar:o}},n.getCustomizedCategoryWidthInfo=function(e,t){var a=e,i=t.categoryCount,r=t.availableWidth,o=t.isScalar,n=t.preferredCategoryWidth,s=t.outerPaddingRatio;if(o||null==n||n<e)return{categoryWidth:a,outerPaddingRatio:s};var l=Math.floor((r-n*s*2)/n);return l<=0?a=r/(1+2*s):l<i?(s=(r-n*l)/(2*n),a=n):a=Math.min(n,r),{categoryWidth:a,outerPaddingRatio:s}},n.getCategoryWidth=function(e,a){var i,r=a.categoryCount,o=a.availableWidth,s=a.domain,l=a.isScalar,c=a.trimOrdinalDataOnOverflow,u=a.outerPaddingRatio;if(r<2)i=o*(1-u);else if(l&&s&&s.length>1){var h=n.getMinInterval(e),d=s[s.length-1]-s[0],p=h/(d+h*u*2);i=o*p,i=Math.max(i,n.MinScalarRectThickness)}else i=o/(r+2*u),c&&(i=Math.max(i,t.CartesianHelper.MinOrdinalRectThickness));var g=o/(3+2*u);return i=Math.min(i,g),!l&&r>=3&&c?Math.max(i,t.CartesianHelper.MinOrdinalRectThickness):i},n.getMinInterval=function(e){var t=Number.MAX_VALUE;if(e.length>0)for(var a=e[0].data.filter(function(e){return!e.highlight}),i=0,r=a.length-1;i<r;i++)t=Math.min(t,Math.abs(a[i+1].categoryValue-a[i].categoryValue));return t},n.getLayerDataViews=function(e){return _.isEmpty(e)?[]:_.filter(e,function(e){return!t.TrendLineHelper.isDataViewForRegression(e)&&!t.ForecastHelper.isDataViewForForecast(e)})},n.MinScalarRectThickness=2,n.LoadMoreThreshold=1,n.xAxisSmallFontSizeInPx=9,n.yAxisSmallFontSizeInPx=9,n.yAxisMediumFontSizeInPx=11,n.ClassName="cartesianChart",n.IconClassName="cartesianChartResponsiveIcon",n.PlayAxisBottomMargin=80,n}();t.CartesianChart=n;var s=function(){function e(e){this.scrollableAxes=e,this.navigationLayers=[],this.currentNavigationLayerIndex=0}return e.prototype.clearNavigationLayers=function(){this.navigationLayers=[]},e.prototype.addNavigationLayer=function(e){this.navigationLayers.push(e)},e.prototype.getFirstElement=function(){return this.currentNavigationLayerIndex=0,this.navigationLayers[this.currentNavigationLayerIndex].getFirstElement()},e.prototype.getNextDataPoint=function(e,t,a){var i=this.navigationLayers[this.currentNavigationLayerIndex],r=i.getNextDataPoint(e,t,a);return r.element||null==r.targetCategoryIndex||(this.getPendingFocusElement=function(){return i.getNextDataPoint(e,t,a).element},this.scrollableAxes.scrollBy(r.targetCategoryIndex-e)),r},e}();t.CartesianChartNavigationHelper=s;var l=function(){function a(e,t){this.processDataView(e,t)}return a.prototype.processDataView=function(i,r){if(this.renderModes=[],!i||!i.metadata||!i.categorical||_.isEmpty(i.categorical.categories))return void this.renderModes.push(2);var o=i.metadata,n=i.categorical.categories,s=_.head(n),l=t.ScalarUtils.getScalarKeys(s),c=t.CartesianHelper.hasCategoryHierarchy(i),u=t.ScalarUtils.shouldDrawScalar(o.objects,t.columnChartProps.categoryAxis.axisType,s.source.type,l,c);if(c){var h=a.areNonLeafLevelsFilteredToUniqueValue(n),d=e.DataViewObjects.getValue(o.objects,t.cartesianChartProps.categoryAxis.concatenateLabels,t.CartesianHelper.DefaultConcatenateLabelsValue);if(h&&d)this.renderModes.unshift(1);else{var p=a.isSortedByCategoryFirst(i),g=_.some(i.categorical.categories,function(e){return e.source&&e.source.identityExprs}),y=r&&!d&&g&&(p||h);this.renderModes.unshift(2),y&&this.renderModes.unshift(3),d||g||(this.warnings=[{selector:null,warnings:[new t.NoIdentityExprWarning]}])}u&&this.renderModes.unshift(0)}else this.renderModes.unshift(1),u&&this.renderModes.unshift(0)},a.prototype.getRenderMode=function(){return _.head(this.renderModes)},a.prototype.getRenderModes=function(){return this.renderModes},a.prototype.addObjectWarnings=function(e){this.warnings&&e.push.apply(e,this.warnings)},a.isSortedByCategoryFirst=function(e){return!(!e||!e.categorical||_.isEmpty(e.categorical.categories)||!e.metadata||_.isEmpty(e.metadata.columns))&&_.every(e.categorical.categories,function(e,t){var a=e.source;return a&&null!=a.sort&&a.sortOrder===t})},a.areNonLeafLevelsFilteredToUniqueValue=function(a){if(_.isEmpty(a))return!1;for(var i=a.length-1,r=0;r<i;r++){var o=a[r].source;if(!o||!e.DataViewObjects.getValue(o.objects,t.cartesianChartProps.filters.filteredToUniqueValue,!1))return!1}return!0},a}();t.CartesianAxisRenderModeSelector=l;var c=function(){function a(e,t,a,i){this.cartesianAxes=e,this.scrollbar=t,this.animateCategoryAxis=a,this.animateValueAxis=i}return a.filterDataToViewport=function(e){if(e&&e.scrollScale){var i,r=e.scrollScale,o=e.mainAxisScale,n=t.AxisHelper.invertOrdinalScale(r,e.extent.start),s=n+e.visibleCategoryCount;if(i=r.domain().slice(n,s),!_.isEqual(i,o.domain())){if(i&&i.length>0){for(var l=e.layers,c=0,u=l;c<u.length;c++){u[c].setFilteredData(i[0],i[i.length-1]+1)}o.domain(i);var h=e.axesLayout.axes,d=void 0;d=e.axesLayout.isXScrollBarVisible?h.x:h.y1,d.axis.scale(o),d.scale(o),d.axis.ticks(i.length),d.axis.tickValues(i);var p=t.SvgCartesianAxes.getTickFormatter(d.axis);if(d.values=_.map(i,function(e){return p(e)}),!_.isEmpty(h.xStack))for(var g=e.axesLayout.tickLabelMargins,y=t.CartesianAxes.getLeafHeight(g.xMax,g.stackHeight,h.xStack.length),v=function(e){var r=h.xStack[e],o=t.AxisHelper.getCategoryThickness(r.scale),n=r.values,s=a.setLabelsAtEdges(i,n);if(r.axis.ticks(i.length).tickValues(i).tickFormat(function(e){var a=n[s[i.indexOf(e)]];return a===t.CartesianAxes.hierarchyPlaceholder?"":_.isString(a)?a:a+""}),0===e)return"continue";for(var l=[],c=[],u=[],d=void 0,p=0;p<s.length;p++){var v=i[p],m=s[p];if(r.values[m]!==t.CartesianAxes.hierarchyPlaceholder){if(null!=d){var f=v-d;l[d]=t.CartesianAxes.getMaxCategoryWidth(f,o),c[d]=t.CartesianAxes.getHierarchyLineStyleInfo({levelIndex:e,stackHeight:g.stackHeight,leafHeight:y,categorySpanCount:f,categoryWidth:o})}u[v]=n[m],d=v}else u[v]=t.CartesianAxes.hierarchyPlaceholder}if(null!=d){var f=i[s.length-1]-d+1;l[d]=t.CartesianAxes.getMaxCategoryWidth(f,o),c[d]=t.CartesianAxes.getHierarchyLineStyleInfo({levelIndex:e,stackHeight:g.stackHeight,leafHeight:y,categorySpanCount:f,categoryWidth:o})}r.xLabelMaxWidths=l,r.lineStyleInfo=c,r.adjustedValues=u},m=0;m<h.xStack.length;m++)v(m)}return{startIndex:n,endIndex:s-1}}}},a.prototype.render=function(t,i,r,o,n,s){var l=this,c=t.plotArea;this.axisScale=null;var h,d,p,g,y,v,m,f,x=t.isXScrollBarVisible||t.isYScrollBarVisible;if(n||x)if(this.cartesianAxes.isYAxisCategorical){this.axisScale=t.axes.y1.scale,h=t.viewport.width,d=t.margin.top,y=t.axes.y1.categoryThickness,v=t.axes.y1.outerPaddingRatio,m=t.axes.y1.innerPaddingRatio;var C=y*v;f=c.height,g=Math.max(1,e.Double.floorWithPrecision((f-2*C)/y)),p=f}else{this.axisScale=t.axes.x.scale,h=t.margin.left,d=t.viewport.height,y=t.axes.x.categoryThickness,v=t.axes.x.outerPaddingRatio,m=t.axes.x.innerPaddingRatio;var C=y*v;f=c.width,g=Math.max(1,e.Double.floorWithPrecision((f-2*C)/y)),p=f}if(!x)return n&&(n.viewportDataRange={startIndex:0,endIndex:g},n.shouldLoadMoreData()&&n.loadMoreData()),this.scrollbar.remove(),void o(i,t,r,this.animateCategoryAxis,this.animateValueAxis);this.scrollScale=this.axisScale.copy(),this.scrollScale.rangeBands([0,p],.1,0),this.extentLength=this.scrollScale(g-1)+this.scrollScale.rangeBand(),this.scrollHandler=new u({visibleScale:this.axisScale,fullScale:this.scrollScale,onScroll:function(e){var t=l.scrollScale(e),a={start:t,end:null};l.scrollbar.setExtent(a),l.scrollbar.refreshExtentAndVisual()}}),this.axisScale.rangeBands([0,f],m,v),this.scrollbar.setOrientation(t.isXScrollBarVisible),this.scrollbar.setScale(this.scrollScale),this.scrollbar.scrollBarLength=p,this.scrollbar.setExtentLength(this.extentLength),s||this.scrollbar.setExtent({start:0,end:null}),this.renderVisualOptions={axesLayout:t,layers:i,loadMoreDataHandler:n,mainAxisScale:this.axisScale,renderDelegate:o,scrollScale:this.scrollScale,visibleCategoryCount:g,animateCategoryAxis:this.animateCategoryAxis,animateValueAxis:this.animateValueAxis};var S=function(){return l.onRefreshVisual(function(e,t){return a.renderVisual(l.renderVisualOptions,e,t)})};if(this.scrollbar.render(h,d,S),s&&n){var b=n.viewportDataRange?n.viewportDataRange.startIndex:0;this.scrollTo(b)}else a.renderVisual(this.renderVisualOptions,this.scrollbar.getExtent(),r)},a.prototype.scrollDelta=function(e){this.scrollHandler.scrollDelta(e)},a.prototype.scrollTo=function(e){this.scrollHandler.scrollTo(e)},a.prototype.scrollBy=function(e){var t=this.axisScale.domain();_.isEmpty(t)||this.scrollHandler.scrollTo(t[0]+e)},a.prototype.onRefreshVisual=function(e){e(this.scrollbar.getExtent(),!0)},a.setLabelsAtEdges=function(e,a){if(e.length<=1||a[e[0]]!==t.CartesianAxes.hierarchyPlaceholder)return e;var i=e[0],r=e.slice();if(i<a.length&&i>=0){for(;a[i]===t.CartesianAxes.hierarchyPlaceholder&&i>=0;i--);r[0]=i}return r},a.renderVisual=function(e,t,i){var r=a.filterDataToViewport({mainAxisScale:e.mainAxisScale,layers:e.layers,scrollScale:e.scrollScale,extent:t,visibleCategoryCount:e.visibleCategoryCount,axesLayout:e.axesLayout,animateCategoryAxis:e.animateCategoryAxis,animateValueAxis:e.animateValueAxis});if(r){if(e.loadMoreDataHandler){var o=e.loadMoreDataHandler;o.viewportDataRange=r,o.shouldLoadMoreData()&&o.loadMoreData()}e.renderDelegate(e.layers,e.axesLayout,i,e.animateCategoryAxis,e.animateValueAxis)}},a.ScrollbarWidth=10,a}();t.ScrollableAxes=c;var u=function(){function e(t){this.visibleScale=t.visibleScale,this.fullScale=t.fullScale,this.onScroll=t.onScroll;var a=jsCommon.Utility.valueOrDefault(t.timeout,e.defaultTimeoutMs);this.extendScrollTimeout=_.debounce(this.onTimeout,a),this.totalScrollDistance=0}return e.prototype.scrollDelta=function(t){if(!_.isEmpty(this.visibleScale.domain())){this.totalScrollDistance<0&&t>0||this.totalScrollDistance>0&&t<0?this.totalScrollDistance=t:this.totalScrollDistance+=t;var a=e.getStepSize(this.visibleScale);if(Math.abs(this.totalScrollDistance)>=a){this.extendScrollTimeout&&this.extendScrollTimeout.cancel();var i=this.getNewStartIndex(this.totalScrollDistance);this.scrollTo(i),this.totalScrollDistance=0}else this.extendScrollTimeout()}},e.prototype.scrollTo=function(e){var t=this.clampIndex(e);this.onScroll(t)},e.getStepSize=function(e){var t=e.range();if(t.length>1)return t[1]-t[0];var a=e.rangeExtent();return a[1]-a[0]},e.prototype.getNewStartIndex=function(e){var a=e>=0;e=a?e:-e;var i,r=this.visibleScale,o=r.range(),n=r.domain(),s=n[0],l=o[0],c=l+e,u=r.rangeExtent()[1];if(c>u){i=n.length}else{i=t.AxisHelper.invertOrdinalScale(r,c)-s}return(a?1:-1)*i+s},e.prototype.clampIndex=function(e){var t=this.fullScale.domain(),a=_.head(t),i=_.last(t);return Math.max(a,Math.min(i,e))},e.prototype.onTimeout=function(){this.totalScrollDistance=0},e.defaultTimeoutMs=1e3,e}();t.AxisScrollHandler=u;var h=function(){function e(e){this.layerViewModelAdapterFactory=e,this.layerViewModelAdapterFactory||(this.layerViewModelAdapterFactory={createCartesianChartLayerViewModelAdapter:function(e){}})}return e.prototype.createLayers=function(e){var t=null!=e.isScrollable&&e.isScrollable,a=[],i={isScrollable:t,animator:e.animator,interactivityService:e.interactivityService,tooltipsEnabled:e.tooltipsEnabled,featureSwitches:e.featureSwitches};switch(e.type){case 1:a.push(this.createLineChartLayer(2,!1,i));break;case 0:a.push(this.createLineChartLayer(1,!1,i));break;case 2:a.push(this.createLineChartLayer(16,!1,i));break;case 18:a.push(this.createRealTimeLayer(i));break;case 10:a.push(this.createScatterChartLayer(i));break;case 13:a.push(this.createWaterfallChartLayer(i));break;case 12:a.push(this.createDataDotChartLayer(i));break;case 4:a.push(this.createColumnChartLayer(20,i));break;case 3:a.push(this.createColumnChartLayer(12,i));break;case 8:a.push(this.createColumnChartLayer(52,i));break;case 6:a.push(this.createColumnChartLayer(18,i));break;case 5:a.push(this.createColumnChartLayer(10,i));break;case 7:a.push(this.createColumnChartLayer(50,i));break;case 9:a.push(this.createColumnChartLayer(68,i));break;case 11:var r=this.getComboColumnType();a.push(this.createColumnChartLayer(r,i)),a.push(this.createLineChartLayer(1,!0,i));break;case 14:a.push(this.createColumnChartLayer(12,i)),a.push(this.createLineChartLayer(1,!0,i));break;case 15:a.push(this.createColumnChartLayer(20,i)),a.push(this.createLineChartLayer(1,!0,i));break;case 16:a.push(this.createColumnChartLayer(12,i)),a.push(this.createDataDotChartLayer(i));break;case 17:a.push(this.createColumnChartLayer(20,i)),a.push(this.createDataDotChartLayer(i))}return a},e.prototype.createLineChartLayer=function(e,a,i){var r={animator:i.animator,interactivityService:i.interactivityService,isScrollable:i.isScrollable,tooltipsEnabled:i.tooltipsEnabled,chartType:e,featureSwitches:i.featureSwitches,viewModelAdapter:this.layerViewModelAdapterFactory.createCartesianChartLayerViewModelAdapter(0)};return a&&(r.chartType=8|r.chartType),new t.LineChart(r)},e.prototype.createRealTimeLayer=function(e){return e.isScrollable=!1,new t.RealTimeLineChart(e)},e.prototype.createScatterChartLayer=function(e){var a=__assign({},e);return a.viewModelAdapter=this.layerViewModelAdapterFactory.createCartesianChartLayerViewModelAdapter(2),new t.ScatterChart(a)},e.prototype.createWaterfallChartLayer=function(e){var a=__assign({},e);return a.viewModelAdapter=this.layerViewModelAdapterFactory.createCartesianChartLayerViewModelAdapter(3),new t.WaterfallChart(a)},e.prototype.createDataDotChartLayer=function(e){return new t.DataDotChart(e)},e.prototype.createColumnChartLayer=function(e,a){var i={animator:a.animator,interactivityService:a.interactivityService,isScrollable:a.isScrollable,tooltipsEnabled:a.tooltipsEnabled,featureSwitches:a.featureSwitches,chartType:e,viewModelAdapter:this.layerViewModelAdapterFactory.createCartesianChartLayerViewModelAdapter(5)};return new t.ColumnChart(i)},e.prototype.getComboColumnType=function(e){var t=12;if(e){var a=e.general;if(a){switch(a.visualType1){case"Column":t=12;break;case"ColumnStacked":t=20}a.visualType2}}return t},e}(),d=function(){function e(e){this.palette=e,this.clearPreferredScale()}return e.prototype.getAllColors=function(){return this.palette.getAllColors()},e.prototype.getColorScaleByKey=function(e){return this.setPreferredScale(e),this.preferredScale},e.prototype.getNewColorScale=function(){return this.preferredScale},e.prototype.getColorByIndex=function(e){return this.palette.getColorByIndex(e)},e.prototype.getSentimentColors=function(){return this.palette.getSentimentColors()},e.prototype.getGradientColors=function(){return this.palette.getGradientColors()},e.prototype.getBasePickerColors=function(){return this.palette.getBasePickerColors()},e.prototype.clearPreferredScale=function(){this.preferredScale=this.palette.getNewColorScale(),this.rotated=!1},e.prototype.rotateScale=function(){this.preferredScale=this.preferredScale.clone(),this.preferredScale.clearAndRotateScale(),this.rotated=!0},e.prototype.setPreferredScale=function(e){this.rotated||(this.preferredScale=this.palette.getColorScaleByKey(e))},e}();t.SharedColorPalette=d;var p=function(){function e(e,t,a){void 0===a&&(a=0),this.loadMoreThreshold=a,this.loadMoreCallback=t,this.setScale(e)}return e.prototype.setScale=function(e){e&&(this.loadMoreThresholdIndex=e.domain().length-1-this.loadMoreThreshold)},e.prototype.isLoadingMoreData=function(){return this.loadingMoreData},e.prototype.onLoadMoreDataCompleted=function(){this.loadingMoreData=!1},e.prototype.shouldLoadMoreData=function(){var e=this.viewportDataRange;return!(!e||this.isLoadingMoreData())&&e.endIndex>=this.loadMoreThresholdIndex},e.prototype.loadMoreData=function(){this.isLoadingMoreData()||(this.loadingMoreData=!0,this.loadMoreCallback())},e}();t.CartesianLoadMoreDataHandler=p}(t=e.visuals||(e.visuals={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(e){var t=jsCommon.BrowserUtils,a=function(){function e(e){this.behaviors=e}return e.prototype.bindEvents=function(e,a,i){for(var r=this.behaviors,o=0,n=r.length;o<n;o++)r[o].bindEvents(e.layerOptions[o],a,i);this.selectionHandler=a,e.clearCatcher.on("click",function(){t.isCtrlOrMeta(d3.event)||a.handleClearSelection()})},e.prototype.renderSelection=function(e){for(var t=0,a=this.behaviors;t<a.length;t++){a[t].renderSelection(e)}},e.prototype.renderFocus=function(e){for(var t=0,a=this.behaviors;t<a.length;t++){a[t].renderFocus(e)}},e.prototype.hoverLassoRegion=function(e,t){for(var a=0,i=this.behaviors;a<i.length;a++){var r=i[a];r.hoverLassoRegion&&r.hoverLassoRegion(e,t)}},e.prototype.lassoSelect=function(e,t){for(var a=0,i=this.behaviors;a<i.length;a++){var r=i[a];r.lassoSelect&&r.lassoSelect(e,t)}},e}();e.CartesianChartBehavior=a}(t=e.visuals||(e.visuals={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(t){var a=jsCommon.EnumExtensions,i=e.data.DataRoleHelper,r=jsCommon.CssConstants.createClassAndSelector,o=function(){function o(e){var t=e.chartType;this.chartType=t,this.categoryAxisType=null,this.animator=e.animator,this.isScrollable=e.isScrollable,this.tooltipsEnabled=e.tooltipsEnabled,this.interactivityService=e.interactivityService,this.ribbonChart=68===this.chartType,this.viewModelAdapter=e.viewModelAdapter}return o.prototype.init=function(e){if(this.style=e.style,this.currentViewport=e.viewport,this.hostService=e.host,this.interactivity=e.interactivity,this.cartesianVisualHost=e.cartesianHost,this.options=e,this.isComboChart=t.ComboChart.isComboChart(e.chartType),this.element=e.element,this.tooltipService=e.services.tooltips,this.svg=e.svg,this.svg.classed(o.ColumnChartClassName,!0),this.unclippedGraphicsContext=this.svg.append("g").classed("columnChartUnclippedGraphicsContext",!0),this.mainGraphicsContext=this.unclippedGraphicsContext.append("svg").classed("mainGraphicsContext",!0),this.interactivityService){var a=jsCommon.BrowserUtils.isInternetExplorerOrEdge();this.mainGraphicsContext.attr({tabindex:0,focusable:!0,"aria-label":this.hostService.getLocalizedString("Visual_Plot")}).classed(t.SetFocusRingClassName,!a)}},o.prototype.getCategoryLayout=function(e,a){var i;i=o.isBar(this.chartType)?this.currentViewport.height-(this.margin.top+this.margin.bottom):this.currentViewport.width-(this.margin.left+this.margin.right),i=Math.max(0,i);var r=this.data?this.data.preferredCategoryWidth:null,n=this.data?this.data.categoryMetadata:void 0,s=t.AxisHelper.getCategoryValueType(n),l=this.getVisualCategoryAxisIsScalar(),c=t.AxisHelper.createDomain(this.data.series,s,l,a.forcedXDomain,a.ensureXDomain);
return t.CartesianChart.getLayout(this.data,{availableWidth:i,categoryCount:e,preferredCategoryWidth:r,domain:c,isScalar:l,isScrollable:this.isScrollable,trimOrdinalDataOnOverflow:a.trimOrdinalDataOnOverflow,outerPaddingRatio:a.outerPaddingRatio,innerPaddingRatio:a.innerPaddingRatio})},o.getDefaultColumnLabelSettings=function(e,a){void 0===a&&(a=!1);var i=t.LabelUtils.getDefaultLabelSettings(!1,void 0,void 0,void 0,e);return i.position=null,i.fontProperties=t.LabelUtils.defaultFontProperties,i.labelDensity=t.LabelUtils.defaultLabelDensity,i.labelOrientation=1,a?(i.enableBackground=!0,i.backgroundColor=t.ColorHelper.getThemeColor(e,t.BackgroundColorName),i.backgroundTransparency=t.ComboChart.defaultLabelBackgroundOpacity):i.enableBackground=!1,i},o.converter=function(e,a,i,r,s,l,c,u,h,d,p){void 0===i&&(i=!1),void 0===r&&(r=!1),void 0===s&&(s=null),void 0===u&&(u=!0);var g=t.CartesianHelper.getCategoryAxisProperties(s,!1),y=t.CartesianHelper.getPreferredCategoryWidth(g);r=t.CartesianHelper.isScalar(r,g);var v=e.categorical,m=new n(e,a),f=t.converterHelper.getPivotedCategories(v,t.columnChartProps.general.formatString),x=f.categories,C=f.categoryFormatter,S=t.CartesianHelper.getScalarKeyinfo(v,r),b=S.category.source,w=o.getDefaultColumnLabelSettings(a,p);if(s&&s.objects){var D=s.objects,P=D.labels;t.LabelUtils.updateLabelSettingsFromLabelsObjectWithLabelDensity(P,w,!o.isBar(l),a)}var L;d&&(L=o.getRibbonsUtils().getRibbonOptionsFromDataviewObjects(s,t.columnChartProps));var A=m.getLegend(),V=A.legend.dataPoints,M=A.seriesSources,T=o.createDataPoints({dataView:e,categories:x,legend:V,converterStrategy:m,defaultDataLabelsSettings:w,is100PercentStacked:i,isScalar:r,style:a,chartType:l,categoryMetadata:b,tooltipsEnabled:u,ribbonChart:d,hostServices:h,ribbonOptions:L}),k=T.series;this.canSupportOutsidePosition(l,k.length)?null!=w.position&&_.includes(this.clusteredValidLabelPositionOptions,w.position)||(w.position=t.labelPosition.auto):null!=w.position&&_.includes(this.stackedValidLabelPositionOptions,w.position)||(w.position=t.labelPosition.auto);for(var F=[],I=0,N=V.length;I<N;I++)F.push(M[I]);if(c){for(var H=0,O=k;H<O.length;H++){var R=O[H];c.applySelectionStateToData(R.data)}c.applySelectionStateToData(A.legend.dataPoints)}var B;return a.isHighContrast&&(B={visible:!0,color:t.ColorHelper.getThemeColor(a,t.ForegroundColorName),width:t.CartesianHelper.defaultLineStrokeWidth}),{categories:x,categoryFormatter:C,preferredCategoryWidth:y,series:k,valuesMetadata:F,legendData:A.legend,hasHighlights:T.hasHighlights,categoryMetadata:b,scalarCategoryAxis:r,dataLabelsSettings:w,hasDynamicSeries:T.hasDynamicSeries,isMultiMeasure:T.isMultiMeasure,ribbonChartData:d?{ribbonChartDataPoints:T.ribbonChartDataPoints,ribbonOptions:L}:void 0,strokeSettings:B}},o.canSupportOutsidePosition=function(e,t){return!o.isStacked(e)&&!o.isRibbon(e)||1===t},o.createDataPoints=function(a){var r=a.dataView,n=r.categorical,s=e.data.createDataViewCategoricalReaderAdvanced(r,{staticSeriesRole:t.cartesianRoleNames.y,colorOptions:{valueRole:t.cartesianRoleNames.y,visualStyle:a.style}}),l=n&&n.values?n.values.grouped():void 0,c=a.categories.length,u=s.data.hasValues("Y")?s.data.getSeriesCount():void 0,h=[];if(u<1||c<1)return{series:h,ribbonChartDataPoints:null,hasHighlights:!1,hasDynamicSeries:!1,isMultiMeasure:!1};var d=n.categories,p=a.categoryMetadata;p=_.isEmpty(d)?null:_.last(d).source;for(var g=t.AxisHelper.getCategoryValueType(p),y=t.AxisHelper.isDateTime(g),v=[],m=[],f=[],x=[],C=!(!n.values||!n.values.source),S=!C&&u>1,b=!1,w=s.data.hasHighlights(),D=a.converterStrategy,P=0;P<u;P++){for(var L=[],A=[],V=0;V<c;V++){var M=D.getValueBySeriesAndCategory(P,V);if(L[V]=M,w){var T=D.getHighlightBySeriesAndCategory(P,V);A[V]=T,M>=0&&T>=0&&e.Double.greaterOrEqualWithPrecision(M,T)||M<=0&&T<=0&&e.Double.lessOrEqualWithPrecision(M,T)||(b=!0)}}f.push(L),w&&x.push(A)}var k=a.chartType;b&&!o.canSupportOutsidePosition(k,u)&&(b=!1,w=!1,f=x);for(var F=t.columnChartProps.general.formatString,P=0;P<u;P++){var I=[],N=a.legend[P],H=void 0;if(!C){var O=!_.isEmpty(l)&&l[0].values?l[0].values[P]:null,R=O&&O.source&&O.source.objects?O.source.objects.labels:null;R&&(H=e.Prototype.inherit(a.defaultDataLabelsSettings),t.LabelUtils.updateLabelSettingsFromLabelsObjectWithLabelDensity(R,H,void 0,a.style))}var B=s.columns.getValueMetadataColumn("Y",P),E={displayName:N.label,key:"series"+P,index:P,data:I,identity:N.identity,color:N.color,labelSettings:H,type:B.type};h.push(E);for(var U=t.GradientUtils.getGradientMeasureIndex(n),z=t.GradientUtils.getGradientValueColumn(n),G=i.getMeasureIndexOfRole(l,"Y"),W=t.valueFormatter.getLocalizedString("Percentage"),V=0;V<c;V++){0===P&&(v.push(0),m.push(0));var M=t.AxisHelper.normalizeNonFiniteNumber(f[P][V]);if(!(null==M&&P>0)){var j=M,X=a.categories[V];if((!y||null==X||X instanceof Date)&&(y&&X&&(X=X.getTime()),!a.isScalar||null!=X&&!isNaN(X))){var Y=void 0,q=a.is100PercentStacked;q&&(Y=t.StackedUtil.getStackedMultiplier(f,V));var K=M,Z=M<0;Y&&(M*=Z?Y.neg:Y.pos);var $=Math.abs(M),J=void 0;Z?(J=m[V],isNaN($)||(m[V]-=$)):(isNaN($)||(v[V]+=$),J=v[V]);var Q=l&&l.length>P&&l[P].values?l[P].values[G]:null,ee=_.isEmpty(n.categories)?null:n.categories[0],te=t.SelectionIdBuilder.builder().withCategory(ee,V).withSeries(n.values,Q).withMeasure(s.columns.getValueMetadataColumn("Y",P).queryName).createSelectionId(),ae=s.colors.createBySeries(P,V),ie=0===U?null:z,re=void 0,oe=void 0,ne=void 0,T=void 0,se=void 0,le=void 0;if(w){re=s.data.getHighlight("Y",V,P),oe=re;var ce=!0;null===re&&(re=0,ce=!1),q&&(re*=re>0?Y.pos:Y.neg),ne=Math.abs(re),se=J,re>0?se-=$-ne:0===re&&M>0&&(se-=$),le=t.SelectionId.createWithHighlight(te);var ue=void 0,he=void 0;if(ce&&null!=oe&&null!=re){var de=t.valueFormatter.format(re,W);he=t.converterHelper.formatFromMetadataColumn(oe,B,F,!1),ue=he+" ("+de+")"}T=q?ue:he}var pe=void 0;if(a.tooltipsEnabled){if(pe=[],ee){var ge=t.CategoryLevelUtils.getCategoryLevels(r.categorical.categories,V,F),ye=t.CategoryLevelUtils.concatenateCategoryLevels(ge);pe.push({displayName:ye.displayName,value:ye.value})}if(C&&(ee&&ee.source===n.values.source||pe.push({displayName:n.values.source.displayName,value:t.converterHelper.formatFromMetadataColumn(l[P].name,n.values.source,F)})),null!=j){var ve=void 0,me=t.converterHelper.formatFromMetadataColumn(j,B,F,!1);if(q){ve=me+" ("+t.valueFormatter.format($,W)+")"}else ve=me;pe.push({displayName:B.displayName,value:ve})}null!=T&&pe.push({displayName:t.ToolTipComponent.localizationOptions.highlightedValueDisplayName,value:T}),ie&&null!=ie.values[V]&&pe.push({displayName:ie.source.displayName,value:t.converterHelper.formatFromMetadataColumn(ie.values[V],ie.source,F,!1)}),t.TooltipBuilder.addTooltipMeasures(s,pe,V,C?P:void 0,F)}var fe=h[P],xe=fe.labelSettings?fe.labelSettings:a.defaultDataLabelsSettings,Ce=xe.fontProperties.color,Se=void 0;o.isStacked(k)&&(Se=this.getStackedLabelColor(Z,P,u,V,f),Ce=Se||P===u-1&&!Z?Ce:t.ColorHelper.getThemeColor(a.style,t.LabelUtils.DefaultInsideLabelColorName));var be={categoryValue:X,value:M,position:J,valueAbsolute:$,valueOriginal:K,seriesIndex:P,labelSettings:xe,categoryIndex:V,color:ae,selected:!1,originalValue:M,originalPosition:J,originalValueAbsolute:$,identity:te,key:te.getKey(),tooltipInfo:pe,formattedTooltip:t.tooltipUtils.formatTooltipInfo(pe),labelFill:Ce,labelFormatString:B.format,lastSeries:Se,chartType:k};if(I.push(be),w){var we={categoryValue:X,value:re,position:se,valueAbsolute:ne,valueOriginal:oe,seriesIndex:P,labelSettings:xe,categoryIndex:V,color:ae,selected:!1,highlight:!0,originalValue:M,originalPosition:J,originalValueAbsolute:$,drawThinner:b,identity:le,key:le.getKey(),tooltipInfo:pe,formattedTooltip:t.tooltipUtils.formatTooltipInfo(pe),labelFormatString:B.format,labelFill:Ce,lastSeries:Se,chartType:k};I.push(we)}}}}}var De;return u>1&&c>1&&a.ribbonChart&&(De=o.getRibbonsUtils().createRibbonChartDataPoints({dataView:r,columnSeries:h,hasHighlights:w,hasDynamicSeries:C,ribbonChartDataPoints:De,categoryCount:c,formatStringProp:F,reader:s,hostServices:a.hostServices,ribbonOptions:a.ribbonOptions})),{series:h,ribbonChartDataPoints:De,hasHighlights:w,hasDynamicSeries:C,isMultiMeasure:S}},o.getStackedLabelColor=function(e,a,i,r,o){for(var n=!(e&&a===i-1&&1!==i),s=a+1;s<i;s++){var l=t.AxisHelper.normalizeNonFiniteNumber(o[s][r]);if(null!==l&&((!e||e&&0===a)&&l>0||e&&0!==a)){n=!1;break}}return n},o.sliceSeries=function(t,a,i){void 0===i&&(i=0);var r=[];if(t&&t.length>0)for(var o=0,n=t.length;o<n;o++){var s=r[o]=e.Prototype.inherit(t[o]);s.data=t[o].data.filter(function(e){return e.categoryIndex>=i&&e.categoryIndex<a})}return r},o.getInteractiveColumnChartDomElement=function(e){return e.children("svg").get(0)},o.prototype.setData=function(e){var a=o.isStacked100(this.chartType);if(this.data=this.originalData={categories:[],categoryFormatter:null,series:[],valuesMetadata:[],legendData:null,hasHighlights:!1,categoryMetadata:null,scalarCategoryAxis:!1,dataLabelsSettings:o.getDefaultColumnLabelSettings(this.style),hasDynamicSeries:!1,isMultiMeasure:!1},e.length>0){var i=this.dataView=e[0];if(i&&i.categorical){var r=i.categorical.categories,n=r&&r.length>0?r[0].source:null,s=t.AxisHelper.getCategoryValueType(n),l=t.CartesianHelper.hasCategoryHierarchy(i),c=t.ScalarUtils.shouldDrawScalar(i.metadata?i.metadata.objects:null,t.columnChartProps.categoryAxis.axisType,s,void 0,l);this.data=this.originalData=o.converter(i,this.style,a,c,i.metadata,this.chartType,this.interactivityService,this.tooltipsEnabled,this.hostService,this.ribbonChart,this.isComboChart)}}this.setChartStrategy()},o.prototype.setChartStrategy=function(){switch(this.chartType){case 10:this.columnChart=new t.ClusteredBarChartStrategy;break;case 12:this.columnChart=new t.ClusteredColumnChartStrategy;break;case 18:case 50:this.columnChart=new t.StackedBarChartStrategy;break;case 20:case 52:case 68:this.columnChart=new t.StackedColumnChartStrategy;break;default:this.columnChart=new t.StackedColumnChartStrategy}if(o.isStacked(this.chartType)&&1===this.data.series.length)switch(this.chartType){case 18:this.columnChart=new t.ClusteredBarChartStrategy;break;case 20:this.columnChart=new t.ClusteredColumnChartStrategy}},o.prototype.calculateLegend=function(){if(this.interactivity&&this.interactivity.isInteractiveLegend)return this.createInteractiveLegendDataPoints(0);var e=this.data?this.data.legendData:null,t=e?e.dataPoints:[];return _.isEmpty(t)?null:e},o.prototype.hasLegend=function(){return this.data&&(this.data.hasDynamicSeries||this.data.series&&this.data.series.length>1)},o.prototype.enumerateObjectInstances=function(e,a){switch(a.objectName){case"dataPoint":this.dataView&&!t.GradientUtils.hasGradientRole(this.dataView.categorical)&&this.enumerateDataPoints(e);break;case"labels":this.enumerateDataLabels(e);break;case"ribbonChart":o.getRibbonsUtils().enumerateRibbonChart(e,this.data.ribbonChartData,this.ribbonChart)}},o.prototype.enumerateDataLabels=function(e){var a,i=this.originalData,r=i.dataLabelsSettings,n=i.series.length,s=!i.hasDynamicSeries&&(n>1||!i.categoryMetadata||this.isComboChart),l=i.dataLabelsSettings.position!==t.labelPosition.outsideEnd;if(a=o.canSupportOutsidePosition(this.chartType,i.series.length)?o.clusteredValidLabelPositionOptions:o.stackedValidLabelPositionOptions,t.LabelUtils.enumerateDataLabels(this.getLabelSettingsOptions(e,r,null,s,a,l)),n>0&&s&&r.showLabelPerSeries)for(var c=0;c<n;c++){var u=i.series[c],h=u.labelSettings?u.labelSettings:i.dataLabelsSettings;e.pushContainer({displayName:u.displayName}),t.LabelUtils.enumerateDataLabels(this.getLabelSettingsOptions(e,h,u)),e.popContainer()}},o.prototype.getLabelSettingsOptions=function(e,t,a,i,r,n){var s=!!a;return{enumeration:e,dataLabelsSettings:t,show:!0,positionObject:r,labelOrientation:!o.isBar(this.chartType)&&!s,position:!s,displayUnits:!o.isStacked100(this.chartType),precision:!0,selector:a&&a.identity?a.identity.getSelector():null,showAll:i,fontSize:!0,fontFamily:!0,labelDensity:this.data&&this.data.scalarCategoryAxis,labelOverflow:!s&&n,enableBackground:t.enableBackground,backgroundColor:t.backgroundColor,backgroundTransparency:t.backgroundTransparency,style:this.style}},o.prototype.enumerateDataPoints=function(t){var a=this.originalData;if(a){var i=a.series.length;0!==i&&(a.hasDynamicSeries||i>1||!a.categoryMetadata?e.requireSync("PowerBIVisuals/Visuals/common/colorEnumerationHelper").enumerateSeriesDataColors({enumeration:t,dataPoints:a.series}):e.requireSync("PowerBIVisuals/Visuals/common/colorEnumerationHelper").enumerateCategoryDataColors({enumeration:t,dataView:this.dataView,style:this.style,dataPoints:_.map(a.series[0].data,function(e){return{color:e.color,displayName:a.categoryFormatter.format(a.categories[e.categoryIndex]),identity:e.identity}}),fillInstanceKind:3}))}},o.prototype.getValueDomain=function(e,a){var i,r=o.isStacked100(this.chartType);if(this.isStacked()){var n=t.StackedUtil.calcValueDomain(this.data.series,r);i=[n.min,n.max]}else i=t.AxisHelper.createValueDomain(this.data.series,!0)||t.emptyDomain;return t.AxisHelper.combineDomain(e.forcedYDomain,i,e.ensureYDomain)},o.prototype.calculateAxesProperties=function(a){this.currentViewport=a.viewport,this.viewModelAdapter&&this.originalData&&(this.data=this.viewModelAdapter.applyChanges(this.currentViewport,this.originalData,this.dataView));var i=this.data,r=this.margin=a.margin,n=this.ribbonChart?o.ribbonChartInnerPaddingRatio:a.innerPaddingRatio,s=e.Prototype.inherit(a);s.innerPaddingRatio=n;var l=i&&i.categories?i.categories.length:0,c=i?this.getCategoryLayout(l,s):{categoryCount:0,categoryThickness:t.CartesianHelper.MinOrdinalRectThickness,outerPaddingRatio:a.outerPaddingRatio,innerPaddingRatio:n,isScalar:!1};if(this.categoryAxisType=c.isScalar?t.axisType.scalar:null,this.scrolledData=void 0,i&&!c.isScalar&&!this.isScrollable&&a.trimOrdinalDataOnOverflow){var u=Math.min(l,c.categoryCount);u!==l&&(i=this.scrolledData=e.Prototype.inherit(i),i.series=o.sliceSeries(i.series,u),i.categories=i.categories.slice(0,u))}this.columnChart.setData(i);var h=this.getPreferredPlotArea(c.isScalar,c.categoryCount,c.categoryThickness,c.outerPaddingRatio),d=o.isStacked100(this.chartType),p={height:h.height,width:h.width,duration:0,hostService:this.hostService,unclippedGraphicsContext:this.unclippedGraphicsContext,mainGraphicsContext:this.mainGraphicsContext,margin:this.margin,layout:c,animator:this.animator,interactivityService:this.interactivityService,viewportHeight:this.currentViewport.height-(r.top+r.bottom),viewportWidth:this.currentViewport.width-(r.left+r.right),is100Pct:d,isComboChart:this.isComboChart};this.ApplyInteractivity(p),this.columnChart.setupVisualProps(p);var g,y,v=o.isBar(this.chartType);if(v){var m=a.forcedXDomain;a.forcedXDomain=a.forcedYDomain,a.forcedYDomain=m;var f=a.preventNiceX;a.preventNiceX=a.preventNiceY,a.preventNiceY=f,g=a.ensureYDomain}else y=a.ensureYDomain;return this.xAxisProperties=this.columnChart.setXScale({is100Pct:d,forcedTickCount:a.forcedTickCount,forcedXDomain:a.forcedXDomain,axisScaleType:v?a.valueAxisScaleType:a.categoryAxisScaleType,axisDisplayUnits:v?a.valueAxisDisplayUnits:a.categoryAxisDisplayUnits,axisPrecision:v?a.valueAxisPrecision:a.categoryAxisPrecision,ensureXDomain:g,outerPaddingRatio:v?0:c.outerPaddingRatio,margin:r,preventNice:a.preventNiceX,innerPaddingRatio:n}),this.yAxisProperties=this.columnChart.setYScale({is100Pct:d,forcedTickCount:a.forcedTickCount,forcedYDomain:a.forcedYDomain,axisScaleType:v?a.categoryAxisScaleType:a.valueAxisScaleType,axisDisplayUnits:v?a.categoryAxisDisplayUnits:a.valueAxisDisplayUnits,axisPrecision:v?a.categoryAxisPrecision:a.valueAxisPrecision,ensureYDomain:y,outerPaddingRatio:v?c.outerPaddingRatio:0,margin:r,preventNice:a.preventNiceY,innerPaddingRatio:n}),[this.xAxisProperties,this.yAxisProperties]},o.prototype.getPreferredPlotArea=function(e,a,i,r){var n={height:this.currentViewport.height-this.margin.top-this.margin.bottom,width:this.currentViewport.width-this.margin.left-this.margin.right};if(this.isScrollable&&!e){var s=t.CartesianChart.getPreferredCategorySpan(a,i,r);o.isBar(this.chartType)?n.height=Math.max(s,n.height):n.width=Math.max(s,n.width)}return n},o.prototype.ApplyInteractivity=function(e){var t=this,a=this.interactivity;if(a&&(a.dragDataPoint&&(e.onDragStart=function(e){e.identity&&t.hostService.onDragStart({event:d3.event,data:{data:e.identity.getSelector()}})}),a.isInteractiveLegend)){var i=function(){var e=d3.mouse(t.mainGraphicsContext[0][0]),a=e[0],i=e[1],r=t.columnChart.getClosestColumnIndex(a,i);t.selectColumn(r)},r=o.getInteractiveColumnChartDomElement(this.element);this.svg.on("click",i),d3.select(r).on("click",i).style("touch-action","none");var n=d3.behavior.drag().origin(Object).on("drag",i);this.svg.call(n),d3.select(r).call(n)}},o.prototype.selectLastSelectedColumnOrDefault=function(e){void 0===e&&(e=!1);var a=void 0===this.lastInteractiveSelectedColumnIndex,i=a?t.CartesianHelper.findMaxCategoryIndex(this.data.series):this.lastInteractiveSelectedColumnIndex;this.selectColumn(i,e)},o.prototype.selectColumn=function(e,t){if(void 0===t&&(t=!1),t||this.lastInteractiveSelectedColumnIndex!==e){var a=this.createInteractiveLegendDataPoints(e);this.columnChart.selectColumn(e,this.lastInteractiveSelectedColumnIndex,t),this.cartesianVisualHost.updateLegend(a),this.lastInteractiveSelectedColumnIndex=e}},o.prototype.createInteractiveLegendDataPoints=function(e){var a=this.data,i=t.Legend.getDefaultLegendData(this.style);if(!a||_.isEmpty(a.series))return i;for(var r=t.columnChartProps.general.formatString,o=[],s=a.categories&&a.categories[e],l=a.series,c=a.legendData&&a.legendData.dataPoints,u=new n(this.dataView,this.style),h=0,d=l.length;h<d;h++){var p=u.getValueBySeriesAndCategory(h,e),g=a.valuesMetadata[h],y=t.converterHelper.getFormattedLegendLabel(g,this.dataView.categorical.values,r),v=void 0;if(1===l.length){var m=l[0];v=m.data.length>e&&m.data[e].color}else v=c.length>h&&c[h].color;o.push({color:v,icon:t.LegendIcon.Box,label:y,category:a.categoryFormatter?a.categoryFormatter.format(s):s,measure:t.valueFormatter.format(p,t.valueFormatter.getFormatString(g,r)),identity:t.SelectionId.createNull(),selected:!1})}return i.dataPoints=o,i},o.prototype.overrideXScale=function(e){this.xAxisProperties=e},o.prototype.render=function(e){var a=this.columnChart.drawColumns(!e,this.style),i=this.data,r=this.margin,o=this.currentViewport,n=o.height-(r.top+r.bottom),s=o.width-(r.left+r.right);this.mainGraphicsContext.attr("height",n).attr("width",s),this.tooltipsEnabled&&this.tooltipService.addTooltip(a.eventGroup,function(e){return e.data&&e.data.tooltipInfo},function(e){return e.data&&e.data.identity}),this.tooltipsEnabled&&a.ribbonChartEventGroup&&this.tooltipService.addTooltip(a.ribbonChartEventGroup,function(e){return e.data&&e.data.tooltipInfo},function(e){return t.SelectionId.createNull()});var l,c,u=[];if(this.interactivityService){for(var h=0,d=i.series.length;h<d;h++)u=u.concat(i.series[h].data);l={datapoints:u,columnChartDrawInfo:a,hasHighlights:i.hasHighlights,mainGraphicsContext:this.mainGraphicsContext,showLabel:i.dataLabelsSettings.show,bandsTransparency:this.data.ribbonChartData?this.data.ribbonChartData.ribbonOptions.bandsTransparency:30,visualInstanceId:this.hostService.instanceId},c={navigationStrategy:i.series.length>1?t.DataPointNavigationStrategy.CategoryFirst:t.DataPointNavigationStrategy.CategoryOnly,helper:this}}return this.interactivity&&this.interactivity.isInteractiveLegend&&this.selectLastSelectedColumnOrDefault(!0),t.SVGUtil.flushAllD3TransitionsIfNeeded(this.options),{dataPoints:u,behaviorOptions:l,navigationOptions:c,labelDataPoints:[],labelDataPointGroups:a.labelDataPointGroups,labelsAreNumeric:!0,labelOrientation:i.dataLabelsSettings.labelOrientation,animateLabels:a.animateLabels}},o.prototype.getFirstElement=function(){var e=(this.scrolledData||this.data).series[0].data[0].categoryIndex,t=this.findSeriesIndex(0,e,!0);return this.getDataPointElement(t,e)},o.prototype.getNextDataPoint=function(e,a,i){switch(i){case t.DataDirection.NextCategory:e=this.findCategoryIndex(this.data.series[a].data,e,!0);break;case t.DataDirection.PreviousCategory:e=this.findCategoryIndex(this.data.series[a].data,e,!1);break;case t.DataDirection.NextSeries:a=this.findSeriesIndex(a+1,e,!0),a<0&&(e=this.loopIndex(e+1,this.data.categories.length),a=this.findSeriesIndex(0,e,!0));break;case t.DataDirection.PreviousSeries:a=a>0?this.findSeriesIndex(a-1,e,!1):-1,a<0&&(e=this.loopIndex(e-1,this.data.categories.length),a=this.findSeriesIndex(this.data.series.length-1,e,!1))}return{element:this.getDataPointElement(a,e),targetCategoryIndex:e}},o.prototype.getDataPointElement=function(e,t){var a=o.isColumn(this.chartType)?".column":".bar";return this.mainGraphicsContext.selectAll(a).filter(function(a){return a.categoryIndex===t&&a.seriesIndex===e}).node()},o.prototype.findSeriesIndex=function(e,t,a){return(a?_.findIndex:_.findLastIndex)(this.data.series,function(e){return _.some(e.data,function(e){return e.categoryIndex===t&&null!=e.value})},e)},o.prototype.findCategoryIndex=function(e,t,a){var i=a?1:-1,r=_.findIndex(e,function(e){return e.categoryIndex===t&&null!=e.value});return r=this.loopIndex(r+i,e.length),e[r].categoryIndex},o.prototype.loopIndex=function(e,t){return e>=t?0:e<0?t-1:e},o.prototype.onClearSelection=function(){this.interactivityService&&this.interactivityService.clearSelection()},o.prototype.getVisualCategoryAxisIsScalar=function(){return!!this.data&&this.data.scalarCategoryAxis},o.prototype.getSupportedCategoryAxisType=function(){var e=this.data?this.data.categoryMetadata:void 0,a=t.AxisHelper.getCategoryValueType(e);return t.AxisHelper.isOrdinal(a)?t.axisType.categorical:t.axisType.both},o.prototype.setFilteredData=function(t,a){var i=this.scrolledData=e.Prototype.inherit(this.data);return i.series=o.sliceSeries(i.series,a,t),i.categories=i.categories.slice(t,a),this.columnChart.setData(i),i},o.prototype.supportsTrendLine=function(){var t=this.dataView,a=e.data.createDataViewCategoricalReader(t),i=this.getVisualCategoryAxisIsScalar();return 12===this.chartType&&i&&a.data.hasValues("Y")},o.prototype.supportsStaticReferenceLines=function(){return 68!==this.chartType},o.prototype.supportsValueAxis=function(){return 68!==this.chartType},o.prototype.isStacked=function(){return o.isStacked(this.chartType)},o.isBar=function(e){return a.hasFlag(e,2)},o.isColumn=function(e){return a.hasFlag(e,4)},o.isClustered=function(e){return a.hasFlag(e,8)},o.isStacked=function(e){return a.hasFlag(e,16)},o.isStacked100=function(e){return a.hasFlag(e,48)},o.isRibbon=function(e){return a.hasFlag(e,64)},o.prototype.getCartesianVisualCapabilities=function(){return{supportsHierarchicalCategoryAxis:o.isColumn(this.chartType),supportsValueAxis:this.supportsValueAxis()}},o.prototype.getStaticSeriesRole=function(){return"Y"},o.getRibbonsUtils=function(){return e.requireSync("PowerBIVisuals/visuals/common/ribbonChartUtils")},o.prototype.addWarnings=function(e){this.viewModelAdapter&&this.viewModelAdapter.addWarnings(e,this.originalData,this.data)},o.ColumnChartClassName="columnChart",o.AutoLabelPosition="Auto",o.clusteredValidLabelPositionOptions=[o.AutoLabelPosition,t.labelPosition.outsideEnd,t.labelPosition.insideEnd,t.labelPosition.insideCenter,t.labelPosition.insideBase],o.stackedValidLabelPositionOptions=[o.AutoLabelPosition,t.labelPosition.insideCenter,t.labelPosition.insideEnd,t.labelPosition.insideBase],o.RibbonChartItemClasses=r("ribbonChartArea"),o.RibbonChartLayerClasses=r("ribbonChartLayer"),o.ribbonChartInnerPaddingRatio=.6,o}();t.ColumnChart=o;var n=function(){function a(t,a){this.visualStyle=a,this.dataView=t&&t.categorical,this.reader=e.data.createDataViewCategoricalReaderAdvanced(t,{staticSeriesRole:"Y",colorOptions:{valueRole:"Y",visualStyle:a}})}return a.prototype.getLegend=function(){var e,a=[],r=[],o=[],n=!1,s=this.reader;if(this.dataView&&this.dataView.values){for(var l=this.dataView.values,c=l.grouped(),u=t.columnChartProps.general.formatString,h=0,d=c.length;h<d;h++)for(var p=c[h],g=p.values,y=0,v=g.length;y<v;y++){var m=g[y],f=m.source;if(!i.hasRole(f,"Gradient")&&!i.hasRole(f,"Tooltips")||i.hasRole(f,"Y")){r.push(f),o.push(m.objects);var x=new t.SelectionIdBuilder;x=x.withMeasure(f.queryName),s.columns.hasDynamicSeries()&&(x=x.withSeries(s.columns.getSeriesValueColumns(),s.columns.getSeriesValueColumnGroup(h)));var C=x.createSelectionId(),S=t.converterHelper.getFormattedLegendLabel(f,l,u),b=s.colors.createBySeries(s.columns.hasDynamicSeries()?h:y);a.push({icon:t.LegendIcon.Box,color:b,label:S,identity:C,selected:!1}),m.identity&&void 0!==f.groupName&&(n=!0)}}var w=this.dataView.values;e=w&&w.source?w.source.displayName:""}var D=t.Legend.getDefaultLegendData(this.visualStyle);return D.title=e,D.dataPoints=a,D.grouped=n,{legend:D,seriesSources:r,seriesObjects:o}},a.prototype.getValueBySeriesAndCategory=function(e,t){return this.reader.data.getValue("Y",t,e)},a.prototype.getHighlightBySeriesAndCategory=function(e,t){return this.reader.data.getHighlight("Y",t,e)},a}()}(t=e.visuals||(e.visuals={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(e){var t=function(t){function a(e){return t.call(this,e)||this}return __extends(a,t),a.prototype.animate=function(t){var a={failed:!0,shapes:null},i=t.viewModel,r=this.previousViewModel;return i.categories.length*i.series.length>e.AnimatorCommon.MaxDataPointsToAnimate||r&&r.categories.length!==i.categories.length?a:(r&&(i.hasHighlights&&!r.hasHighlights?a=this.animateNormalToHighlighted(t):i.hasHighlights&&r.hasHighlights?a=this.animateHighlightedToHighlighted(t):!i.hasHighlights&&r.hasHighlights&&(a=this.animateHighlightedToNormal(t))),this.previousViewModel=i,a)},a.prototype.animateNormalToHighlighted=function(t){var a=t.viewModel,i=t.itemCS,r=t.series.selectAll(i.selector),o=r.data(function(e){return e.data},function(e){return e.key}),n=t.interactivityService&&t.interactivityService.hasSelection(),s=a.hasHighlights;return o.enter().append("rect").attr("class",function(e){return i.class.concat(e.highlight?" highlight":"")}).attr(t.layout.shapeLayoutWithoutHighlights),o.style("fill",function(e){return e.color}).style("fill-opacity",function(t){return e.ColumnUtil.getFillOpacity(t.selected,t.highlight,n,s)}).transition().duration(this.animationDuration).attr(t.layout.shapeLayout),o.exit().remove(),{failed:!1,shapes:o}},a.prototype.animateHighlightedToHighlighted=function(e){return{failed:!1,shapes:this.animateDefaultShapes(e.viewModel,e.series,e.layout,e.itemCS,e.interactivityService&&e.interactivityService.hasSelection())}},a.prototype.animateHighlightedToNormal=function(t){var a=t.itemCS,i=t.series.selectAll(a.selector),r=i.data(function(e){return e.data},function(e){return e.key}),o=t.interactivityService&&t.interactivityService.hasSelection();return r.enter().append("rect").attr("class",function(e){return a.class.concat(e.highlight?" highlight":"")}),r.style("fill",function(e){return e.color}).style("fill-opacity",function(t){return e.ColumnUtil.getFillOpacity(t.selected,t.highlight,t.selected,!t.selected)}).transition().duration(this.animationDuration).attr(t.layout.shapeLayout).transition().duration(0).delay(this.animationDuration).style("fill-opacity",function(t){return e.ColumnUtil.getFillOpacity(t.selected,t.highlight,o,!1)}),r.exit().transition().duration(this.animationDuration).attr(o?t.layout.zeroShapeLayout:t.layout.shapeLayoutWithoutHighlights).remove(),{failed:!1,shapes:r}},a.prototype.animateDefaultShapes=function(t,a,i,r,o){var n=a.selectAll(r.selector),s=n.data(function(e){return e.data},function(e){return e.key});return s.enter().append("rect").attr("class",function(e){return r.class.concat(e.highlight?" highlight":"")}),s.style("fill",function(e){return e.color}).style("fill-opacity",function(a){return e.ColumnUtil.getFillOpacity(a.selected,a.highlight,o,t.hasHighlights)}).transition().duration(this.animationDuration).attr(i.shapeLayout),s.exit().remove(),s},a}(e.BaseAnimator);e.WebColumnChartAnimator=t}(t=e.visuals||(e.visuals={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(e){var t=jsCommon.BrowserUtils,a=function(){function a(){}return a.prototype.bindEvents=function(a,i,r){var o=this;this.options=a;var n=a.columnChartDrawInfo.eventGroup;if(r&&!r.isEmpty()){var s=a.mainGraphicsContext;e.InteractivityUtils.appendUseElementForFocus(s,a.visualInstanceId),e.InteractivityUtils.registerEnterPlotAreaHandler(s,r),e.InteractivityUtils.registerDataPointNavigationHandler(s,r),e.InteractivityUtils.registerClearCatcherShortcut(s,i)}n.on("click",function(){return o.handleSelection(i)}).on("keydown.select",function(){var e=d3.event.keyCode;32!==e&&13!==e||(d3.event.preventDefault(),d3.event.stopPropagation(),o.handleSelection(i))},!0),n.on("contextmenu",function(){if(!t.isCtrlOrMeta(d3.event)){d3.event.preventDefault(),e.EventBubblingUtil.markAsHandled(d3.event);var a=e.InteractivityUtils.getPositionOfLastInputEvent();e.InteractivityUtils.tryToSelectD3Target(function(e){return i.handleContextMenu(e,a)})}})},a.prototype.renderSelection=function(t){var a=this.options;if(a.columnChartDrawInfo.ribbonChartEventGroup){var i=(100-a.bandsTransparency)/100,r=e.ColumnUtil.getFillOpacity(!1,!1,t,a.hasHighlights,i);a.columnChartDrawInfo.ribbonChartEventGroup.style("fill-opacity",r).style("stroke-opacity",r)}a.columnChartDrawInfo.shapesSelection.style("fill-opacity",function(i){return e.ColumnUtil.getFillOpacity(i.selected,i.highlight,t,a.hasHighlights)}).style("stroke-opacity",function(i){return e.ColumnUtil.getFillOpacity(i.selected,i.highlight,t,a.hasHighlights)})},a.prototype.renderFocus=function(t){var a=e.CurrentFocusDataPointId+"-"+this.options.visualInstanceId;this.options.mainGraphicsContext.select("#"+a).attr("id",null),t&&(t.setAttribute("id",a),t.focus())},a.prototype.handleSelection=function(a){var i=e.InteractivityUtils.getPositionOfLastInputEvent();e.InteractivityUtils.tryToSelectD3Target(function(e){return a.handleSelection(e,t.isCtrlOrMeta(d3.event),i)})},a}();e.ColumnChartWebBehavior=a}(t=e.visuals||(e.visuals={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(e){var t=function(){function t(){}return t.prototype.setupVisualProps=function(e){this.graphicsContext=e,this.margin=e.margin,this.width=this.graphicsContext.width,this.height=this.graphicsContext.height,this.categoryLayout=e.layout,this.animator=e.animator,this.interactivityService=e.interactivityService,this.viewportHeight=e.viewportHeight,this.viewportWidth=e.viewportWidth,this.isComboChart=e.isComboChart},t.prototype.setData=function(e){this.data=e},t.prototype.setXScale=function(t){var a,i,r=t.forcedXDomain,o=t.axisScaleType,n=t.axisDisplayUnits,s=t.axisPrecision,l=t.ensureXDomain,c=t.margin,u=this.width;r&&2===r.length&&(a=r[0],i=r[1]);var h=this.xProps=e.ColumnUtil.getCategoryAxis(this.data,u,this.categoryLayout,!1,a,i,o,n,s,l,c,t.preventNice,t.innerPaddingRatio),d=this.data.series.length,p=this.categoryLayout.categoryThickness*(1-t.innerPaddingRatio)/d;return this.seriesOffsetScale=d3.scale.ordinal().domain(this.data.series.map(function(e){return e.index})).rangeBands([0,d*p]),h},t.prototype.setYScale=function(t){var a=(t.is100Pct,t.forcedTickCount),i=t.forcedYDomain,r=t.axisScaleType,o=t.axisDisplayUnits,n=t.axisPrecision,s=t.ensureYDomain,l=t.outerPaddingRatio,c=t.margin,u=this.viewportHeight,h=e.AxisHelper.createValueDomain(this.data.series)||e.emptyDomain,d=e.AxisHelper.combineDomain(i,h,s),p=e.AxisHelper.scaleShouldClamp(d,h),g=!(i&&2===i.length&&(i[0]>0||i[1]<0));return this.yProps=e.AxisHelper.createAxis({pixelSpan:u,dataDomain:d,zeroScalarDomain:[0,1],metaDataColumn:this.data.valuesMetadata,formatString:e.valueFormatter.getFormatString(this.data.valuesMetadata[0],e.columnChartProps.general.formatString),outerPadding:0,isScalar:!0,isVertical:!0,forcedTickCount:a,useTickIntervalForDisplayUnits:!0,isCategoryAxis:!1,scaleType:r,axisDisplayUnits:o,axisPrecision:n,
shouldClamp:p,outerPaddingRatio:l,margin:c,preventNice:t.preventNice,includeZero:g}),this.yProps},t.prototype.createLabelDataPoints=function(t){return e.ColumnUtil.createLabelDataPoints(this.data,this.layout,this.graphicsContext,this.yProps,!1,!0,t)},t.prototype.drawColumns=function(a,i){var r=this.data;this.columnsCenters=null;var o,n=this.categoryLayout.categoryThickness*(1-this.categoryLayout.innerPaddingRatio),s=n/r.series.length,l={columnWidth:s,categoryWidth:n,xScale:this.xProps.scale,yScale:this.yProps.scale,seriesOffsetScale:this.seriesOffsetScale,isScalar:this.categoryLayout.isScalar,margin:this.margin},c=this.layout=t.getLayout(r,l),u=r.dataLabelsSettings;u&&u.show&&(o=this.createLabelDataPoints(i));var h,d,p=e.ColumnUtil.drawSeries(r,this.graphicsContext.mainGraphicsContext,l);return this.animator&&a&&(h=this.animator.animate({viewModel:r,series:p,layout:c,itemCS:t.classes.item,interactivityService:this.interactivityService,mainGraphicsContext:this.graphicsContext.mainGraphicsContext,viewPort:{height:this.height,width:this.width}}),d=h.shapes),this.animator&&a&&!h.failed||(d=e.ColumnUtil.drawDefaultShapes(r,p,c,t.classes.item,!this.animator,this.interactivityService)),e.ColumnUtil.applyInteractivity(d,this.graphicsContext.onDragStart),{eventGroup:this.graphicsContext.mainGraphicsContext,shapesSelection:d,viewport:{height:this.height,width:this.width},axisOptions:l,labelDataPointGroups:o,animateLabels:h&&!h.failed}},t.prototype.selectColumn=function(a,i,r){e.ColumnUtil.setSelectedColumnOpacity(this.graphicsContext.mainGraphicsContext,t.classes.item.selector,a,i,r),this.moveHandle(a)},t.prototype.getClosestColumnIndex=function(t,a){return e.ColumnUtil.getClosestColumnIndex(t,this.getColumnsCenters())},t.prototype.getColumnsCenters=function(){var e=this;if(!this.columnsCenters){var t=this.categoryLayout.categoryThickness*(1-this.categoryLayout.innerPaddingRatio);if(this.data.series.length>0){var a=0;this.categoryLayout.isScalar||(a=t/2);var i=this.data.series[0];this.columnsCenters=i.data.map(function(t){return e.xProps.scale(e.categoryLayout.isScalar?t.categoryValue:t.categoryIndex)+a})}}return this.columnsCenters},t.prototype.moveHandle=function(e){var t=this.getColumnsCenters(),a=d3.select(".interactive-hover-line");if(a.empty()||this.columnSelectionLineHandle||(this.columnSelectionLineHandle=d3.select(a.node().parentNode)),!t||t.length<=1)return void(this.columnSelectionLineHandle&&this.columnSelectionLineHandle.remove());var i=t[e];if(this.columnSelectionLineHandle){var r=this.columnSelectionLineHandle;r.select("line").attr({x1:i,x2:i}),r.select("circle").attr({cx:i})}else{var r=this.columnSelectionLineHandle=this.graphicsContext.unclippedGraphicsContext.append("g");r.append("line").classed("interactive-hover-line",!0).attr({x1:i,x2:i,y1:0,y2:this.height}),r.append("circle").attr({cx:i,cy:this.height,r:"6px"}).classed("drag-handle",!0)}},t.getLayout=function(t,a){var i=a.columnWidth,r=.5*i,o=r/2,n=a.isScalar,s=a.xScale,l=a.yScale,c=a.seriesOffsetScale,u=l(0),h=0;return n&&(h=a.categoryWidth/2),{shapeLayout:{width:function(e){return e.drawThinner?r:i},x:function(e){return s(n?e.categoryValue:e.categoryIndex)+c(e.seriesIndex)-h+(e.drawThinner?o:0)},y:function(t){return u+e.AxisHelper.diffScaled(l,Math.max(0,t.value),0)},height:function(t){return Math.abs(e.AxisHelper.diffScaled(l,0,t.value))}},shapeLayoutWithoutHighlights:{width:function(e){return i},x:function(e){return s(n?e.categoryValue:e.categoryIndex)+c(e.seriesIndex)-h},y:function(t){return u+e.AxisHelper.diffScaled(l,Math.max(0,t.originalValue),0)},height:function(t){return Math.abs(e.AxisHelper.diffScaled(l,0,t.originalValue))}},zeroShapeLayout:{width:function(e){return e.drawThinner?r:i},x:function(e){return s(n?e.categoryValue:e.categoryIndex)+c(e.seriesIndex)-h+(e.drawThinner?o:0)},y:function(e){return u},height:function(e){return 0}}}},t.classes={item:{class:"column",selector:".column"}},t}();e.ClusteredColumnChartStrategy=t;var a=function(){function t(){}return t.prototype.setupVisualProps=function(e){this.graphicsContext=e,this.margin=e.margin,this.width=this.graphicsContext.width,this.height=this.graphicsContext.height,this.categoryLayout=e.layout,this.animator=e.animator,this.interactivityService=e.interactivityService,this.viewportHeight=e.viewportHeight,this.viewportWidth=e.viewportWidth,this.isComboChart=e.isComboChart},t.prototype.setData=function(e){this.data=e},t.prototype.setYScale=function(t){var a,i,r=t.forcedYDomain,o=t.axisScaleType,n=t.axisDisplayUnits,s=t.axisPrecision,l=t.ensureYDomain,c=t.margin,u=this.height;r&&2===r.length&&(a=r[0],i=r[1]);var h=this.yProps=e.ColumnUtil.getCategoryAxis(this.data,u,this.categoryLayout,!0,a,i,o,n,s,l,c,t.preventNice,t.innerPaddingRatio),d=this.data.series.length,p=this.categoryLayout.categoryThickness*(1-t.innerPaddingRatio)/d;return this.seriesOffsetScale=d3.scale.ordinal().domain(this.data.series.map(function(e){return e.index})).rangeBands([0,d*p]),h},t.prototype.setXScale=function(t){var a=(t.is100Pct,t.forcedTickCount),i=t.forcedXDomain,r=t.axisScaleType,o=t.axisDisplayUnits,n=t.axisPrecision,s=t.ensureXDomain,l=t.outerPaddingRatio,c=t.margin,u=this.width,h=e.AxisHelper.createValueDomain(this.data.series)||e.emptyDomain,d=e.AxisHelper.combineDomain(i,h,s),p=e.AxisHelper.scaleShouldClamp(d,h),g=!(i&&2===i.length&&(i[0]>0||i[1]<0));return this.xProps=e.AxisHelper.createAxis({pixelSpan:u,dataDomain:d,zeroScalarDomain:[0,1],metaDataColumn:this.data.valuesMetadata,formatString:e.valueFormatter.getFormatString(this.data.valuesMetadata[0],e.columnChartProps.general.formatString),outerPadding:0,isScalar:!0,isVertical:!1,forcedTickCount:a,useTickIntervalForDisplayUnits:!0,isCategoryAxis:!1,scaleType:r,axisDisplayUnits:o,axisPrecision:n,shouldClamp:p,outerPaddingRatio:l,margin:c,preventNice:t.preventNice,includeZero:g}),this.xProps.axis.tickSize(-this.viewportHeight,0),this.xProps},t.prototype.createLabelDataPoints=function(t){return e.ColumnUtil.createLabelDataPoints(this.data,this.layout,this.graphicsContext,this.xProps,!0,!0,t)},t.prototype.drawColumns=function(a,i){var r=this.data;this.barsCenters=null;var o,n=this.categoryLayout.categoryThickness*(1-this.categoryLayout.innerPaddingRatio),s=n/r.series.length,l={columnWidth:s,categoryWidth:n,xScale:this.xProps.scale,yScale:this.yProps.scale,seriesOffsetScale:this.seriesOffsetScale,isScalar:this.categoryLayout.isScalar,margin:this.margin},c=this.layout=t.getLayout(r,l),u=r.dataLabelsSettings;u&&u.show&&(o=this.createLabelDataPoints(i));var h,d,p=e.ColumnUtil.drawSeries(r,this.graphicsContext.mainGraphicsContext,l);return this.animator&&a&&(h=this.animator.animate({viewModel:r,series:p,layout:c,itemCS:t.classes.item,interactivityService:this.interactivityService,mainGraphicsContext:this.graphicsContext.mainGraphicsContext,viewPort:{height:this.height,width:this.width}}),d=h.shapes),this.animator&&a&&!h.failed||(d=e.ColumnUtil.drawDefaultShapes(r,p,c,t.classes.item,!this.animator,this.interactivityService)),e.ColumnUtil.applyInteractivity(d,this.graphicsContext.onDragStart),{eventGroup:this.graphicsContext.mainGraphicsContext,shapesSelection:d,viewport:{height:this.height,width:this.width},axisOptions:l,labelDataPointGroups:o,animateLabels:h&&!h.failed}},t.prototype.selectColumn=function(a,i,r){e.ColumnUtil.setSelectedColumnOpacity(this.graphicsContext.mainGraphicsContext,t.classes.item.selector,a,i,r),this.moveHandle(a)},t.prototype.getClosestColumnIndex=function(t,a){return e.ColumnUtil.getClosestColumnIndex(a,this.getBarsCenters())},t.prototype.getBarsCenters=function(){var e=this;if(!this.barsCenters){var t=this.categoryLayout.categoryThickness*(1-this.categoryLayout.innerPaddingRatio);if(this.data.series.length>0){var a=0;this.categoryLayout.isScalar||(a=t/2);var i=this.data.series[0];this.barsCenters=i.data.map(function(t){return e.yProps.scale(e.categoryLayout.isScalar?t.categoryValue:t.categoryIndex)+a})}}return this.barsCenters},t.prototype.moveHandle=function(e){var t=this.getBarsCenters(),a=d3.select(".interactive-hover-line");if(a.empty()||this.columnSelectionLineHandle||(this.columnSelectionLineHandle=d3.select(a.node().parentNode)),!t||t.length<=1)return void(this.columnSelectionLineHandle&&this.columnSelectionLineHandle.remove());var i=t[e];if(this.columnSelectionLineHandle){var r=this.columnSelectionLineHandle;r.select("line").attr({y1:i,y2:i}),r.select("circle").attr({cy:i})}else{var r=this.columnSelectionLineHandle=this.graphicsContext.unclippedGraphicsContext.append("g");r.append("line").classed("interactive-hover-line",!0).attr({x1:0,x2:this.width,y1:i,y2:i}),r.append("circle").attr({cx:0,cy:i,r:"6px"}).classed("drag-handle",!0)}},t.getLayout=function(t,a){var i=a.columnWidth,r=.5*i,o=r/2,n=a.isScalar,s=a.xScale,l=a.yScale,c=a.seriesOffsetScale,u=s(0),h=0;return n&&(h=a.categoryWidth/2),{shapeLayout:{width:function(t){return Math.abs(e.AxisHelper.diffScaled(s,0,t.value))},x:function(t){return u+e.AxisHelper.diffScaled(s,Math.min(0,t.value),0)},y:function(e){return l(n?e.categoryValue:e.categoryIndex)+c(e.seriesIndex)-h+(e.drawThinner?o:0)},height:function(e){return e.drawThinner?r:i}},shapeLayoutWithoutHighlights:{width:function(t){return Math.abs(e.AxisHelper.diffScaled(s,0,t.originalValue))},x:function(t){return u+e.AxisHelper.diffScaled(s,Math.min(0,t.originalValue),0)},y:function(e){return l(n?e.categoryValue:e.categoryIndex)+c(e.seriesIndex)-h},height:function(e){return i}},zeroShapeLayout:{width:function(e){return 0},x:function(t){return u+e.AxisHelper.diffScaled(s,Math.min(0,t.value),0)},y:function(e){return l(n?e.categoryValue:e.categoryIndex)+c(e.seriesIndex)-h+(e.drawThinner?o:0)},height:function(e){return e.drawThinner?r:i}}}},t.classes={item:{class:"bar",selector:".bar"}},t}();e.ClusteredBarChartStrategy=a}(t=e.visuals||(e.visuals={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(e){var t=function(){function t(){}return t.prototype.setupVisualProps=function(e){this.graphicsContext=e,this.margin=e.margin,this.width=this.graphicsContext.width,this.height=this.graphicsContext.height,this.categoryLayout=e.layout,this.animator=e.animator,this.interactivityService=e.interactivityService,this.viewportHeight=e.viewportHeight,this.viewportWidth=e.viewportWidth,this.isComboChart=e.isComboChart},t.prototype.setData=function(e){this.data=e},t.prototype.setXScale=function(t){var a,i,r=t.forcedXDomain,o=t.axisScaleType,n=t.axisDisplayUnits,s=t.axisPrecision,l=t.xReferenceLineValue,c=t.margin,u=this.width;return r&&2===r.length&&(a=r[0],i=r[1]),this.xProps=e.ColumnUtil.getCategoryAxis(this.data,u,this.categoryLayout,!1,a,i,o,n,s,l,c,t.preventNice,t.innerPaddingRatio)},t.prototype.setYScale=function(t){var a=t.is100Pct,i=t.forcedTickCount,r=t.forcedYDomain,o=t.axisScaleType,n=t.axisDisplayUnits,s=t.axisPrecision,l=t.ensureYDomain,c=t.outerPaddingRatio,u=t.margin,h=this.viewportHeight,d=e.StackedUtil.calcValueDomain(this.data.series,a),p=[d.min,d.max],g=e.AxisHelper.combineDomain(r,p,l),y=e.AxisHelper.scaleShouldClamp(g,p),v=this.data.valuesMetadata[0],m=a?this.graphicsContext.hostService.getLocalizedString("Percentage"):e.valueFormatter.getFormatString(v,e.columnChartProps.general.formatString);return this.yProps=e.AxisHelper.createAxis({pixelSpan:h,dataDomain:g,zeroScalarDomain:[0,1],metaDataColumn:this.data.valuesMetadata,formatString:m,outerPadding:0,outerPaddingRatio:c,isScalar:!0,isVertical:!0,forcedTickCount:i,useTickIntervalForDisplayUnits:!0,isCategoryAxis:!1,scaleType:o,axisDisplayUnits:n,axisPrecision:s,is100Pct:a,shouldClamp:y,margin:u,preventNice:t.preventNice}),this.yProps},t.prototype.createLabelDataPoints=function(t){return e.ColumnUtil.createLabelDataPoints(this.data,this.layout,this.graphicsContext,this.yProps,!1,!1,t)},t.prototype.drawColumns=function(a,i){var r=this.data;this.columnsCenters=null;var o,n={columnWidth:this.categoryLayout.categoryThickness*(1-this.categoryLayout.innerPaddingRatio),xScale:this.xProps.scale,yScale:this.yProps.scale,isScalar:this.categoryLayout.isScalar,margin:this.margin},s=this.layout=t.getLayout(r,n),l=r.dataLabelsSettings;l&&l.show&&(o=this.createLabelDataPoints(i));var c,u,h=e.ColumnUtil.drawSeries(r,this.graphicsContext.mainGraphicsContext,n);this.animator&&a&&(c=this.animator.animate({viewModel:r,series:h,layout:s,itemCS:t.classes.item,interactivityService:this.interactivityService,mainGraphicsContext:this.graphicsContext.mainGraphicsContext,viewPort:{height:this.height,width:this.width}}),u=c.shapes),this.animator&&a&&!c.failed||(u=e.ColumnUtil.drawDefaultShapes(r,h,s,t.classes.item,!this.animator,this.interactivityService));var d,p,g=this.data.ribbonChartData;if(g&&g.ribbonChartDataPoints){var y=e.ColumnChart.getRibbonsUtils().getRibbonChartAreaLayout(this.layout,g.ribbonChartDataPoints,!0);d={graphicsContext:this.graphicsContext.mainGraphicsContext,layout:y,ribbonChartAreaSelector:e.ColumnChart.RibbonChartItemClasses,ribbonChartGroupSelector:e.ColumnChart.RibbonChartLayerClasses,isColumn:!0,colorBands:g.ribbonOptions.colorBands,bandsTransparency:g.ribbonOptions.bandsTransparency,showBorder:g.ribbonOptions.showBorder,style:i},p=e.ColumnChart.getRibbonsUtils().drawRibbonChartAreaSmooth(d)}else d={graphicsContext:this.graphicsContext.mainGraphicsContext,layout:[],ribbonChartAreaSelector:e.ColumnChart.RibbonChartItemClasses,ribbonChartGroupSelector:e.ColumnChart.RibbonChartLayerClasses,isColumn:!0,colorBands:!1,bandsTransparency:t.defaultBandsTransparency,showBorder:!1,style:i},p=e.ColumnChart.getRibbonsUtils().drawRibbonChartAreaSmooth(d);return e.ColumnUtil.applyInteractivity(u,this.graphicsContext.onDragStart),{eventGroup:this.graphicsContext.mainGraphicsContext,ribbonChartEventGroup:p,shapesSelection:u,viewport:{height:this.height,width:this.width},axisOptions:n,labelDataPointGroups:o,animateLabels:c&&!c.failed}},t.prototype.selectColumn=function(a,i,r){e.ColumnUtil.setSelectedColumnOpacity(this.graphicsContext.mainGraphicsContext,t.classes.item.selector,a,i,r),this.moveHandle(a)},t.prototype.getClosestColumnIndex=function(t,a){return e.ColumnUtil.getClosestColumnIndex(t,this.getColumnsCenters())},t.prototype.getColumnsCenters=function(){var e=this;if(!this.columnsCenters){var t=this.categoryLayout.categoryThickness*(1-this.categoryLayout.innerPaddingRatio);if(this.data.series.length>0){var a=0;this.categoryLayout.isScalar||(a=t/2);var i=this.data.series[0];this.columnsCenters=i.data.map(function(t){return e.xProps.scale(e.categoryLayout.isScalar?t.categoryValue:t.categoryIndex)+a})}}return this.columnsCenters},t.prototype.moveHandle=function(e){var t=this.getColumnsCenters(),a=d3.select(".interactive-hover-line");if(a.empty()||this.columnSelectionLineHandle||(this.columnSelectionLineHandle=d3.select(a.node().parentNode)),!t||t.length<=1)return void(this.columnSelectionLineHandle&&this.columnSelectionLineHandle.remove());var i=t[e];if(this.columnSelectionLineHandle){var r=this.columnSelectionLineHandle;r.select("line").attr({x1:i,x2:i}),r.select("circle").attr({cx:i})}else{var r=this.columnSelectionLineHandle=this.graphicsContext.unclippedGraphicsContext.append("g");r.append("line").classed("interactive-hover-line",!0).attr({x1:i,x2:i,y1:0,y2:this.height}),r.append("circle").attr({cx:i,cy:this.height,r:"6px"}).classed("drag-handle",!0)}},t.getLayout=function(e,t){var a=t.columnWidth,i=t.isScalar,r=t.xScale,o=t.yScale,n=0;return i&&(n=a/2),{shapeLayout:{width:function(e){return a},x:function(e){return r(i?e.categoryValue:e.categoryIndex)-n},y:function(e){return o(e.position)},height:function(e){return o(e.position-e.valueAbsolute)-o(e.position)}},shapeLayoutWithoutHighlights:{width:function(e){return a},x:function(e){return r(i?e.categoryValue:e.categoryIndex)-n},y:function(e){return o(e.originalPosition)},height:function(e){return o(e.originalPosition-e.originalValueAbsolute)-o(e.originalPosition)}},zeroShapeLayout:{width:function(e){return a},x:function(e){return r(i?e.categoryValue:e.categoryIndex)-n},y:function(e){return o(e.value>=0?e.position-e.valueAbsolute:e.position)},height:function(e){return 0}}}},t.classes={item:{class:"column",selector:".column"},highlightItem:{class:"highlightColumn",selector:".highlightColumn"}},t.defaultBandsTransparency=30,t}();e.StackedColumnChartStrategy=t;var a=function(){function t(){}return t.prototype.setupVisualProps=function(e){this.graphicsContext=e,this.margin=e.margin,this.width=this.graphicsContext.width,this.height=this.graphicsContext.height,this.categoryLayout=e.layout,this.animator=e.animator,this.interactivityService=e.interactivityService,this.viewportHeight=e.viewportHeight,this.viewportWidth=e.viewportWidth,this.isComboChart=e.isComboChart},t.prototype.setData=function(e){this.data=e},t.prototype.setYScale=function(t){var a,i,r=t.forcedYDomain,o=t.axisScaleType,n=t.axisDisplayUnits,s=t.axisPrecision,l=t.ensureYDomain,c=t.margin,u=this.height;return r&&2===r.length&&(a=r[0],i=r[1]),this.yProps=e.ColumnUtil.getCategoryAxis(this.data,u,this.categoryLayout,!0,a,i,o,n,s,l,c,t.preventNice,t.innerPaddingRatio)},t.prototype.setXScale=function(t){var a=t.is100Pct,i=t.forcedTickCount,r=t.forcedXDomain,o=t.axisScaleType,n=t.axisDisplayUnits,s=t.axisPrecision,l=t.ensureXDomain,c=t.outerPaddingRatio,u=t.margin,h=this.width,d=e.StackedUtil.calcValueDomain(this.data.series,a),p=[d.min,d.max],g=e.AxisHelper.combineDomain(r,p,l),y=e.AxisHelper.scaleShouldClamp(g,p),v=this.data.valuesMetadata[0],m=a?this.graphicsContext.hostService.getLocalizedString("Percentage"):e.valueFormatter.getFormatString(v,e.columnChartProps.general.formatString);return this.xProps=e.AxisHelper.createAxis({pixelSpan:h,dataDomain:g,zeroScalarDomain:[0,1],metaDataColumn:this.data.valuesMetadata,formatString:m,outerPadding:0,outerPaddingRatio:c,isScalar:!0,isVertical:!1,forcedTickCount:i,useTickIntervalForDisplayUnits:!0,isCategoryAxis:!1,scaleType:o,axisDisplayUnits:n,axisPrecision:s,is100Pct:a,shouldClamp:y,margin:u,preventNice:t.preventNice}),this.xProps.axis.tickSize(-this.viewportHeight,0),this.xProps},t.prototype.createLabelDataPoints=function(t){return e.ColumnUtil.createLabelDataPoints(this.data,this.layout,this.graphicsContext,this.xProps,!0,!1,t)},t.prototype.drawColumns=function(a,i){var r=this.data;this.barsCenters=null;var o,n={columnWidth:this.categoryLayout.categoryThickness*(1-this.categoryLayout.innerPaddingRatio),xScale:this.xProps.scale,yScale:this.yProps.scale,isScalar:this.categoryLayout.isScalar,margin:this.margin},s=this.layout=t.getLayout(r,n),l=r.dataLabelsSettings;l&&l.show&&(o=this.createLabelDataPoints(i));var c,u,h=e.ColumnUtil.drawSeries(r,this.graphicsContext.mainGraphicsContext,n);return this.animator&&a&&(c=this.animator.animate({viewModel:r,series:h,layout:s,itemCS:t.classes.item,interactivityService:this.interactivityService,mainGraphicsContext:this.graphicsContext.mainGraphicsContext,viewPort:{height:this.height,width:this.width}}),u=c.shapes),this.animator&&a&&!c.failed||(u=e.ColumnUtil.drawDefaultShapes(r,h,s,t.classes.item,!this.animator,this.interactivityService)),e.ColumnUtil.applyInteractivity(u,this.graphicsContext.onDragStart),{eventGroup:this.graphicsContext.mainGraphicsContext,shapesSelection:u,viewport:{height:this.height,width:this.width},axisOptions:n,labelDataPointGroups:o,animateLabels:c&&!c.failed}},t.prototype.selectColumn=function(a,i,r){e.ColumnUtil.setSelectedColumnOpacity(this.graphicsContext.mainGraphicsContext,t.classes.item.selector,a,i,r),this.moveHandle(a)},t.prototype.getClosestColumnIndex=function(t,a){return e.ColumnUtil.getClosestColumnIndex(a,this.getBarsCenters())},t.prototype.getBarsCenters=function(){var e=this;if(!this.barsCenters){var t=this.categoryLayout.categoryThickness*(1-this.categoryLayout.innerPaddingRatio);if(this.data.series.length>0){var a=0;this.categoryLayout.isScalar||(a=t/2);var i=this.data.series[0];this.barsCenters=i.data.map(function(t){return e.yProps.scale(e.categoryLayout.isScalar?t.categoryValue:t.categoryIndex)+a})}}return this.barsCenters},t.prototype.moveHandle=function(e){var t=this.getBarsCenters(),a=d3.select(".interactive-hover-line");if(a.empty()||this.columnSelectionLineHandle||(this.columnSelectionLineHandle=d3.select(a.node().parentNode)),!t||t.length<=1)return void(this.columnSelectionLineHandle&&this.columnSelectionLineHandle.remove());var i=t[e];if(this.columnSelectionLineHandle){var r=this.columnSelectionLineHandle;r.select("line").attr({y1:i,y2:i}),r.select("circle").attr({cy:i})}else{var r=this.columnSelectionLineHandle=this.graphicsContext.unclippedGraphicsContext.append("g");r.append("line").classed("interactive-hover-line",!0).attr({x1:0,x2:this.width,y1:i,y2:i}),r.append("circle").classed("drag-handle",!0).attr({cx:0,cy:i,r:"6px"})}},t.getLayout=function(e,t){var a=t.columnWidth,i=t.isScalar,r=t.xScale,o=t.yScale,n=0;return i&&(n=a/2),{shapeLayout:{width:function(e){return r(e.position)-r(e.position-e.valueAbsolute)},x:function(e){return r(e.position-e.valueAbsolute)},y:function(e){return o(i?e.categoryValue:e.categoryIndex)-n},height:function(e){return a}},shapeLayoutWithoutHighlights:{width:function(e){return r(e.originalPosition)-r(e.originalPosition-e.originalValueAbsolute)},x:function(e){return r(e.originalPosition-e.originalValueAbsolute)},y:function(e){return o(i?e.categoryValue:e.categoryIndex)-n},height:function(e){return a}},zeroShapeLayout:{width:function(e){return 0},x:function(e){return r(e.value>=0?e.position-e.valueAbsolute:e.position)},y:function(e){return o(i?e.categoryValue:e.categoryIndex)-n},height:function(e){return a}}}},t.classes={item:{class:"bar",selector:".bar"},highlightItem:{class:"highlightBar",selector:".highlightBar"}},t}();e.StackedBarChartStrategy=a}(t=e.visuals||(e.visuals={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(e){var t;!function(t){function a(t,a,i){if(i){for(var r,o=i.length,n=0;n<o;n++){var s=i[n];if(s.enumerateObjectInstances){if(s instanceof e.ColumnChart){r=n;continue}s.enumerateObjectInstances(t,a)}}void 0!==r&&i[r].enumerateObjectInstances(t,a)}}function i(e){return 11===e||14===e||15===e||16===e||17===e}t.defaultLabelBackgroundOpacity=.3,t.enumerateDataPoints=a,t.isComboChart=i}(t=e.ComboChart||(e.ComboChart={}))}(t=e.visuals||(e.visuals={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(t){var a=function(){function a(e){this.isScrollable=e.isScrollable,this.interactivityService=e.interactivityService}return a.prototype.init=function(e){this.options=e,this.svg=e.svg,this.svg.classed(a.ClassName,!0),this.mainGraphicsG=this.svg.append("g").classed("dataDotChartMainGraphicsContext",!0),this.mainGraphicsContext=this.mainGraphicsG.append("svg"),this.currentViewport=e.viewport,this.hostService=e.host,this.cartesianVisualHost=e.cartesianHost,this.style=e.style,this.colors=this.style.colorPalette.dataColors,this.interactivity=e.interactivity,this.element=e.element},a.prototype.setData=function(i){if(this.data={series:{data:[]},hasHighlights:!1,hasDynamicSeries:!1},i.length>0){var r=i[0];if(r&&r.categorical){var o=this.dataViewCategorical=r.categorical,n=o.categories,s=e.ValueType.fromDescriptor({text:!0});n&&n.length>0&&n[0].source&&n[0].source.type&&(s=n[0].source.type),this.data=a.converter(r,t.valueFormatter.format(null),this.interactivityService)}}},a.prototype.setFilteredData=function(t,a){var i=this.clippedData=e.Prototype.inherit(this.data);return i&&i.series&&i.series.data&&(i.series={data:i.series.data.slice(t,a),xCol:i.series.xCol,yCol:i.series.yCol}),i},a.prototype.calculateAxesProperties=function(i){var r=this;this.currentViewport=i.viewport,this.margin=i.margin;var o=this.clippedData=this.data,n=this.currentViewport,s=this.margin,l=o?o.series:null,c=l&&l.data&&l.data.length>0?[l]:[],u=l&&l.data?l.data.length:0;o.hasHighlights&&(u/=2);var h,d,p=n.width-(s.left+s.right),g=n.height-(s.top+s.bottom);a.hasDataPoint(l)&&(h=l.xCol,d=l.yCol);var y=t.CartesianChart.getLayout(null,{availableWidth:p,categoryCount:u,domain:null,isScalar:!1,isScrollable:this.isScrollable,trimOrdinalDataOnOverflow:i.trimOrdinalDataOnOverflow,outerPaddingRatio:i.outerPaddingRatio,innerPaddingRatio:i.innerPaddingRatio}),v=y.categoryThickness*y.outerPaddingRatio;this.isScrollable||(this.clippedData=a.createClippedDataIfOverflowed(o,y.categoryCount));var m=t.AxisHelper.createValueDomain(c),f=t.AxisHelper.combineDomain(i.forcedYDomain,m,i.ensureYDomain);this.yAxisProperties=t.AxisHelper.createAxis({pixelSpan:g,dataDomain:f,metaDataColumn:d,formatString:t.valueFormatter.getFormatString(d,a.formatStringProp),outerPadding:0,isScalar:!0,isVertical:!0,forcedTickCount:i.forcedTickCount,useTickIntervalForDisplayUnits:!0,isCategoryAxis:!1,margin:s,preventNice:i.preventNiceY,includeZero:!0});var x=this.xAxisProperties?this.xAxisProperties.axisType:e.ValueType.fromDescriptor({text:!0}),C=t.AxisHelper.createDomain(c,x,!1,i.forcedXDomain,i.ensureXDomain);return this.xAxisProperties=t.AxisHelper.createAxis({pixelSpan:p,dataDomain:C,metaDataColumn:h,formatString:t.valueFormatter.getFormatString(h,a.formatStringProp),outerPadding:v,isScalar:!1,isVertical:!1,forcedTickCount:i.forcedTickCount,useTickIntervalForDisplayUnits:!0,categoryThickness:y.categoryThickness,getValueFn:function(e,t){return r.lookupXValue(e,t)},isCategoryAxis:!0,margin:s,preventNice:i.preventNiceX,innerPaddingRatio:i.innerPaddingRatio}),[this.xAxisProperties,this.yAxisProperties]},a.createClippedDataIfOverflowed=function(t,a){var i=t.hasHighlights?Math.min(t.series.data.length,2*a):Math.min(t.series.data.length,a);if(i>=t.series.data.length)return t;var r=e.Prototype.inherit(t);return r.series=e.Prototype.inherit(t.series),r.series.data=r.series.data.slice(0,i),r},a.hasDataPoint=function(e){return e&&e.data&&e.data.length>0},a.prototype.lookupXValue=function(e,a){var i=this.data;if(t.AxisHelper.isDateTime(a))return new Date(e);if(i&&i.series){var r=i.series.data;if(r){var o=r[e];if(o)return o.categoryValue}}return e},a.prototype.overrideXScale=function(e){this.xAxisProperties=e},a.prototype.render=function(i){var r=this;if(this.clippedData){var o=this.clippedData,n=o.series.data,s=o.hasHighlights,l=this.margin,c=this.currentViewport,u=c.width-(l.left+l.right),h=c.height-(l.top+l.bottom),d=this.xAxisProperties.scale,p=this.yAxisProperties.scale,g=this.xAxisProperties.categoryThickness*(1-this.xAxisProperties.innerPaddingRatio),y=g/2,v=this.style.colorPalette.dataColors.getNewColorScale().getColor(a.DotColorKey),m=!!this.interactivityService&&this.interactivityService.hasSelection();this.mainGraphicsContext.attr("width",u).attr("height",h);var f=this.mainGraphicsContext.selectAll(a.DotClassSelector).data(n,function(e){return e.identity.getKey()});f.enter().append("circle").classed(a.DotClassName,!0),f.style({fill:v.value}).style("fill-opacity",function(e){return t.ColumnUtil.getFillOpacity(e.selected,e.highlight,m,s)}).classed("null-value",function(e){return null===e.value}).attr({r:function(e){return y},cx:function(e){return d(e.categoryIndex)+y},cy:function(e){return p(e.value)}}),f.exit().remove();var x=this.mainGraphicsContext.selectAll(a.DotLabelClassSelector).data(n,function(e){return e.identity.getKey()});x.enter().append("text").classed(a.DotLabelClassName,!0).attr({"text-anchor":a.DotLabelTextAnchor,dy:a.DotLabelVerticalOffset}),x.classed("null-value",function(e){return null===e.value}).classed("overflowed",!1).attr({x:function(e){return d(e.categoryIndex)+y},y:function(e){return p(e.value)}}).text(function(e){return r.yAxisProperties.formatter.format(e.value)});var C=!1;x.each(function(){if(!C&&!$("<div>").addClass($(this).attr("class")).hasClass("null-value")){e.TextMeasurementService.measureSvgTextElementWidth(this)>g&&(x.classed("overflowed",!0),C=!0)}}),x.exit().remove();var S;return this.interactivityService&&(S={dots:f,dotLabels:x,datapoints:n}),t.SVGUtil.flushAllD3TransitionsIfNeeded(this.options),{dataPoints:n,behaviorOptions:S,labelDataPoints:[],labelsAreNumeric:!0,animateLabels:!1}}},a.prototype.calculateLegend=function(){return this.createLegendDataPoints(0)},a.prototype.hasLegend=function(){return this.data&&this.data.hasDynamicSeries},a.prototype.createLegendDataPoints=function(i){var r=this.data;if(!r)return null;var o,n=r.series,s=n.data,l=t.Legend.getDefaultLegendData(this.style),c=[],u=this.xAxisProperties?this.xAxisProperties.axisType:e.ValueType.fromDescriptor({text:!0});if(r.series&&r.series.data){var h=r.series.data[0];o=h&&this.lookupXValue(h.categoryValue,u)}if(n.yCol){var d=a.formatStringProp,p=s[i],g=p&&p.value,y=t.converterHelper.getFormattedLegendLabel(n.yCol,this.dataViewCategorical.values,d),v=this.style.colorPalette.dataColors.getNewColorScale().getColor(a.DotColorKey),m=this.dataViewCategorical.values,f=m&&m.length>i?t.SelectionId.createWithIdAndMeasure(m[i].identity,m[i].source.queryName):t.SelectionId.createWithMeasure(m.source.queryName);c.push({color:v.value,icon:t.LegendIcon.Line,label:y,category:t.valueFormatter.format(o,t.valueFormatter.getFormatString(n.xCol,d)),measure:t.valueFormatter.format(g,t.valueFormatter.getFormatString(n.yCol,d)),identity:f,selected:!1})}return l.dataPoints=c,l},a.prototype.onClearSelection=function(){this.interactivityService&&this.interactivityService.clearSelection()},a.converter=function(e,a,i){var r=e.categorical,o=r.categories&&r.categories.length>0?r.categories[0]:{source:void 0,values:[a],identity:void 0},n=t.AxisHelper.getCategoryValueType(o.source),s=t.AxisHelper.isDateTime(n),l=o.values;if(!_.isEmpty(r.values)){for(var c=r.values[0],u=!!c.highlights,h=[],d=0,p=c.values.length;d<p;d++){var g=new t.SelectionIdBuilder;o.identity&&(g=g.withCategory(o,d));var y=g.withMeasure(c.source.queryName).createSelectionId(),v=l[d];if((!s||null==v||v instanceof Date)&&(h.push({categoryValue:s&&v?v.getTime():v,value:c.values[d],categoryIndex:d,seriesIndex:0,selected:!1,identity:y,highlight:!1}),u)){var m=t.SelectionId.createWithHighlight(y),f=c.highlights[d];h.push({categoryValue:s&&v?v.getTime():v,value:f,categoryIndex:d,seriesIndex:0,selected:!1,identity:m,highlight:!0})}}return i&&i.applySelectionStateToData(h),{series:{xCol:o.source,yCol:c.source,data:h},hasHighlights:u,hasDynamicSeries:!0}}return{series:{data:[]},hasHighlights:!1,hasDynamicSeries:!1}},a.prototype.getCartesianVisualCapabilities=function(){return{supportsHierarchicalCategoryAxis:!1}},a.prototype.getStaticSeriesRole=function(){},a.formatStringProp={objectName:"general",propertyName:"formatString"},a.ClassName="dataDotChart",a.DotClassName="dot",a.DotClassSelector=".dot",a.DotColorKey="dataDot",a.DotLabelClassName="label",a.DotLabelClassSelector=".label",a.DotLabelVerticalOffset="0.4em",a.DotLabelTextAnchor="middle",a}();t.DataDotChart=a}(t=e.visuals||(e.visuals={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(e){var t=function(){function t(){}return t.prototype.bindEvents=function(t,a){var i=this.dots=t.dots,r=t.dotLabels;e.InteractivityUtils.registerStandardInteractivityHandlers(i,a),r&&e.InteractivityUtils.registerStandardInteractivityHandlers(r,a)},t.prototype.renderSelection=function(t){this.dots.style("fill-opacity",function(a){return e.ColumnUtil.getFillOpacity(a.selected,a.highlight,t,!1)})},t}();e.DataDotChartWebBehavior=t}(t=e.visuals||(e.visuals={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(t){var a=jsCommon.EnumExtensions,i=jsCommon.CssConstants.createClassAndSelector,r=function(){function r(e){var t=this;this.pathXAdjustment=0,this.deferDragMoveOperation=jsCommon.DeferUtility.deferUntilNextFrame(function(){if(t.lastDragMoveXPosition&&t.data&&t.margin){var e=r.findCategoryIndex({pointX:t.lastDragMoveXPosition-t.margin.left,offsetX:0,categoryData:t.data.categoryData,scaleDetector:t.scaleDetector,scale:t.xAxisProperties.scale,categoryThickness:t.xAxisProperties.categoryThickness,isScalar:t.data.isScalar});t.selectColumn(e),t.lastDragMoveXPosition=void 0}}),this.isScrollable=!!e.isScrollable&&e.isScrollable,this.tooltipsEnabledOnHost=e.tooltipsEnabled,this.lineType=e.chartType?e.chartType:1,this.interactivityService=e.interactivityService,
this.animator=e.animator,this.lineClassAndSelector=r.LineClassSelector,this.binnedLineSamplingSupported=e.featureSwitches.binnedLineSamplingSupported,this.steppedLineEnabled=e.featureSwitches.steppedLine,this.viewModelAdapter=e.viewModelAdapter}return r.convertCategoryValue=function(e,t,a){return(t||a)&&e?e.getTime():e},r.getDefaultLineChartLabelSettings=function(e,a){void 0===a&&(a=!1);var i=t.ColorHelper.getThemeColor(e,t.LabelUtils.DefaultLabelColorName),r={show:!1,position:0,displayUnits:0,precision:t.dataLabelUtils.defaultLabelPrecision,fontProperties:t.FontProperties.inherit(t.LabelUtils.defaultFontProperties,{color:i}),labelDensity:t.LabelUtils.defaultLabelDensity};return a?(r.enableBackground=!0,r.backgroundColor=t.ColorHelper.getThemeColor(e,t.BackgroundColorName),r.backgroundTransparency=t.ComboChart.defaultLabelBackgroundOpacity):r.enableBackground=!1,r},r.converter=function(a){var i=a.dataView,o=a.style,n=a.interactivityService,s=a.shouldCalculateStacked,l=a.isComboChart,c=a.forecastDataView,u=a.tooltipsEnabled;null==u&&(u=!0);var h,d=t.CartesianHelper.getCategoryAxisProperties(i.metadata),p=t.CartesianHelper.isScalar(a.isScalar,d),g=a.isComboChart?"Y2":"Y",y=i.categorical,v=e.data.createDataViewCategoricalReaderAdvanced(i,{staticSeriesRole:g,colorOptions:{visualStyle:o,valueRole:g,ignoreDefaultColor:a.isComboChart,ignoreDefaultCategoryColor:!0}}),m=v.data,f=v.columns,x=t.CartesianHelper.getScalarKeyinfo(y,p),C=x.category,S=x.useScalarKeys,b=x.scalarKeys;S&&(h=e.Prototype.inherit(C.source),h.type={dateTime:!0});var w,D=t.lineChartProps.general.formatString,P=t.AxisHelper.getCategoryValueType(C.source,p),L=t.AxisHelper.isDateTime(P),A=C.values,V=[],M=[],T=[],k=m.hasCategories()?m.getCategoryCount():1,F=m.getSeriesCount(),I=y.values,N=!(!I||!I.source),H=r.getDefaultLineChartLabelSettings(o,a.isComboChart),O=v.objects.getStaticObjects();if(i.metadata&&i.metadata.objects){w=i.metadata.objects;var R=w.labels;t.LabelUtils.updateLabelSettingsFromLabelsObjectWithLabelDensity(R,H,void 0,o)}var B;I&&(B=I.grouped());var E;s&&(E=I&&I.length>0?_.times(I[0].values.length,function(){return 0}):[]);var U=!p&&e.DataViewObjects.getValue(w,t.lineChartProps.lineStyles.showMarker,!1),z=t.LineStyle.readFromStaticObjects(O,U,o);if(m.hasValues(g))for(var G=0;G<F;G++){var W=f.getValueColumn(g,G),j=W.source,X=[],Y=t.SelectionIdBuilder.builder().withSeries(I,W).withMeasure(f.getValueMetadataColumn(g,G).queryName).createSelectionId(),q=Y.getKey(),K=v.colors.createBySeries(G,void 0,t.ForegroundColorName),Z=o.isHighContrast?t.ColorHelper.getThemeColor(o,t.BackgroundColorName):K,$=void 0;if(!N){var J=B&&B.length>0&&B[0].values?B[0].values[G]:null,Q=J&&J.source&&J.source.objects?J.source.objects.labels:null;Q&&($=e.Prototype.inherit(H),t.LabelUtils.updateLabelSettingsFromLabelsObjectWithLabelDensity(Q,$,void 0,o))}for(var ee=$?$:H,te=W.highlights&&W.highlights.length>0,ae=e.DataViewObjects.getValue(w,t.lineChartProps.lineStyles.showSeries,!1),ie=!p&&ae,re=t.LineStyle.readFromSeriesObjects(v,z,G,ie,ae,o),oe=-1,ne=0;ne<k;ne++){var se=A[ne],le=S?b.values[ne].min:se,ce=t.AxisHelper.normalizeNonFiniteNumber(te?m.getHighlight(g,ne,G):m.getValue(g,ne,G));if(!(p&&(null==le||null==ce)||L&&null!=se&&!(se instanceof Date)||(oe++,null==ce&&G>0))){var ue=void 0,he=void 0,de=void 0;if(u){if(ue=[],C.source){de=t.CategoryLevelUtils.getCategoryLevels(i.categorical.categories,ne,D);var pe=t.CategoryLevelUtils.concatenateCategoryLevels(de);ue.push({displayName:pe.displayName,value:pe.value})}N&&(C.source&&C.source===I.source||ue.push({displayName:I.source.displayName,value:t.converterHelper.formatFromMetadataColumn(B[G].name,I.source,D)})),null!=ce&&ue.push({displayName:j.displayName,value:t.converterHelper.formatFromMetadataColumn(ce,j,D,!1)}),he=[],t.TooltipBuilder.addTooltipMeasures(v,he,ne,N?G:void 0,D),he=_.isEmpty(he)?void 0:he}var ge=new t.SelectionIdBuilder;m.hasCategories()&&(ge=ge.withCategory(f.getCategoryColumn("Category"),ne)),N&&(ge=ge.withSeries(I,f.getValueColumn(g,G)));var ye=ge.withMeasure(f.getValueMetadataColumn(g,G).queryName).createSelectionId(),ve=C&&!_.isEmpty(C.identity)&&C.identity[ne]?C.identity[ne].key:ne,me={categoryValue:r.convertCategoryValue(le,L,S),value:ce,categoryIndex:ne,seriesIndex:G,tooltipInfo:ue,selected:!1,identity:Y,specificIdentity:ye,key:JSON.stringify({series:q,category:ve}),labelFill:ee.fontProperties.color,labelFormatString:j.format,labelSettings:ee,additionalTooltipItems:he,hierarchyCategoryLevels:de,lineStyle:re};if(s&&(E[ne]+=ce,me.stackedValue=E[ne]),C.objects&&C.objects[ne]){var fe=t.ColorHelper.create(o);me.pointColor=fe.getColorForProperty(C.objects[ne],t.lineChartProps.dataPoint.fill,void 0)}if(X[oe]=me,V[ne]||(V[ne]=t.CartesianHelper.extractCategoryFromDataPoint(me)),V[ne]&&!V[ne].hasData&&(V[ne].hasData=null!=me.value),!M[ne]&&m.hasCategories()){var xe=new t.SelectionIdBuilder;M[ne]=xe.withCategory(f.getCategoryColumn("Category"),ne).withMeasure(f.getValueMetadataColumn(g,G).queryName).createSelectionId()}}}n&&n.applySelectionStateToData(_.filter(X,function(e){return null!=e}));var Ce=void 0;Ce=v.columns.hasDynamicSeries()?t.valueFormatter.format(v.data.getSeriesName(G),v.objects.getSeriesFormatString(G)):v.columns.hasStaticSeries()?v.data.getSeriesName(G):v.data.getValueDisplayName(g),X.length>0&&T.push({seriesName:Ce,key:q,lineIndex:G,color:K,areaColor:Z,xCol:S?h:C.source,yCol:f.getValueMetadataColumn(g,G),data:X,identity:Y,selected:!1,labelSettings:$,type:j.type,lineStyle:re})}var Se;if(c&&p&&!s&&!l){Se=t.ForecastHelper.readDataView(c,i,o);for(var be=_.last(V),we=0,De=Se;we<De.length;we++)for(var Pe=De[we],ne=be.categoryIndex,Le=0,Ae=Pe.points;Le<Ae.length;Le++){var Ve=Ae[Le];Ve.point.x=r.convertCategoryValue(Ve.point.x,L,S),Ve.upperBound.x=r.convertCategoryValue(Ve.upperBound.x,L,S),Ve.lowerBound.x=r.convertCategoryValue(Ve.lowerBound.x,L,S);var Me=Ve.point.x;Me<=be.categoryValue||(ne++,V[ne]||(V[ne]={categoryIndex:ne,categoryValue:Me,hasData:null!=Ve.point.y}),M[ne]||(M[ne]=null))}}var Te=!1,ke=i.metadata&&i.metadata.dataReduction;ke&&ke.categorical&&(ke.categorical.metadata&&ke.categorical.metadata.binnedLineSample||ke.categorical.categories&&ke.categorical.categories.binnedLineSample||ke.categorical.values&&ke.categorical.values.binnedLineSample)&&(Te=!0),d=t.CartesianHelper.getCategoryAxisProperties(i.metadata);var Fe=t.CartesianHelper.getPreferredCategoryWidth(d),Ie=f.getAllValueMetadataColumnsForRole(g);return n&&n.applySelectionStateToData(T),{series:T,forecastLines:Se,isScalar:p,dataLabelsSettings:H,hasDynamicSeries:N,categoryMetadata:C.source,valuesMetadata:Ie,preferredCategoryWidth:Fe,scalarMetadata:h,scalarKeyCount:S?b.values.length:void 0,categories:A,categoryData:V,seriesDisplayName:N&&m.hasValues(g)?t.converterHelper.formatFromMetadataColumn(m.getSeriesDisplayName(),f.getSeriesMetadataColumn(),D):void 0,hasValues:m.hasValues(g),categoryIdentities:M,lineStyle:z,binnedLineSamplingApplied:Te,legendMarkerRendering:e.DataViewObjects.getValue(O,t.lineChartProps.legend.legendMarkerRendering,t.legendMarkerRendering.markerOnly),matchLineColor:e.DataViewObjects.getValue(O,t.lineChartProps.legend.matchLineColor,!0),defaultToCircle:e.DataViewObjects.getValue(O,t.lineChartProps.legend.defaultToCircle,!0)}},r.getInteractiveLineChartDomElement=function(e){return e.children("svg").get(0)},r.createStackedValueDomain=function(e){return 0===e.length?null:[d3.min(e,function(e){return d3.min(e.data,function(e){return e&&e.stackedValue})}),d3.max(e,function(e){return d3.max(e.data,function(e){return e&&e.stackedValue})})]},r.prototype.init=function(e){var a=this;this.options=e,this.element=e.element,this.cartesainSVG=e.svg,this.host=e.host,this.currentViewport=e.viewport,this.style=e.style,this.isInteractiveChart=e.interactivity&&e.interactivity.isInteractiveLegend,this.cartesianVisualHost=e.cartesianHost,this.scaleDetector=new t.SVGScaleDetector(this.cartesainSVG);var i=e.chartType;this.isComboChart=11===i||14===i||15===i;var n=e.svg;n.classed(r.ClassName,!0);var s=this.mainGraphicsSVG=n.append("svg").classed("lineChartSVG",!0);this.svgDefs=s.append("defs");var l=!this.isComboChart&&!this.isInteractiveChart;this.tooltipService=new o(e.services.tooltips,s,l),this.mainGraphicsContext=s.append("g").classed(r.MainGraphicsContextClassName,!0),this.hoverLineContext=n.append("g").classed("hover-line",!0),this.hoverLineContext.append(r.LineElementName).attr("x1",0).attr("x2",0).attr("y1",0).attr("y2",0);var c=this.hoverLine=this.hoverLineContext.select(r.LineElementName);if(this.isInteractiveChart&&c.classed("interactive",!0),c.style("opacity",t.SVGUtil.AlmostZero),c.style("stroke",t.ColorHelper.getThemeColor(this.style,"foregroundNeutralSecondary")),this.selectionCircles=[],this.xAxisProperties={axis:null,scale:null,axisType:null,formatter:null,graphicsContext:null,values:null,axisLabel:null,isCategoryAxis:!0},this.isInteractiveChart){var u=r.getInteractiveLineChartDomElement(this.element),h=function(){a.lastDragMoveXPosition=d3.mouse(u)[0],a.deferDragMoveOperation()},d=d3.behavior.drag().origin(Object).on("drag",h);d3.select(u).style("touch-action","none").call(d).on("click",h)}this.markerRenderer=new t.MarkerRenderer},r.prototype.setData=function(e){if(this.data=this.originalData={series:[],dataLabelsSettings:r.getDefaultLineChartLabelSettings(this.style),hasDynamicSeries:!1,categories:[],categoryMetadata:void 0,valuesMetadata:[],categoryData:[],categoryIdentities:[],lineStyle:t.LineStyle.getDefault(),binnedLineSamplingApplied:!1,legendMarkerRendering:t.legendMarkerRendering.markerOnly,matchLineColor:!1,defaultToCircle:!0},e.length>0){var i=e[0],o=_.find(e,function(e){return t.ForecastHelper.isDataViewForForecast(e)});if(i&&i.categorical){this.dataView=i;var n=i.categorical,s=n.categories,l={text:!0},c=void 0;s&&!_.isEmpty(s)&&(s[0].source&&s[0].source.type&&(l=s[0].source.type),c=t.ScalarUtils.getScalarKeys(s[0]));var u=t.CartesianHelper.hasCategoryHierarchy(i),h=t.ScalarUtils.shouldDrawScalar(i.metadata?i.metadata.objects:null,t.lineChartProps.categoryAxis.axisType,l,c,u),d=this.host&&this.host.tooltips(),p=!(!d||!d.enabled()),g=this.tooltipsEnabled=this.tooltipsEnabledOnHost&&(!d||p);this.data=this.originalData=r.converter({dataView:i,style:this.style,isScalar:h,interactivityService:this.interactivityService,isComboChart:this.isComboChart,tooltipsEnabled:g,forecastDataView:o,shouldCalculateStacked:a.hasFlag(this.lineType,16)});var y=this.previousCategoryIds,v=this.data.categoryIdentities;this.suppressAnimation=r.shouldSuppressAnimations(y,v),this.previousCategoryIds=v}}else this.dataView=void 0},r.shouldSuppressAnimations=function(e,a){var i;if(null!=e&&!(e.length>t.AnimatorCommon.MaxDataPointsToAnimate||a.length>t.AnimatorCommon.MaxDataPointsToAnimate))if(i=!1,0===e.length)i=!0;else for(var r=0,o=Math.min(e.length,a.length);r<o;r++)if(!t.SelectionId.isEqual(e[r],a[r])){i=!0;break}return i},r.prototype.getValueDomain=function(e,i){var o=this.data,n=this.ensureDomainsIncludeForecast(o.forecastLines,e.ensureXDomain,e.ensureYDomain).y,s=a.hasFlag(this.lineType,16)?r.createStackedValueDomain(o.series):t.AxisHelper.createValueDomain(o.series,i);return t.AxisHelper.combineDomain(e.forcedYDomain,s,n)},r.prototype.calculateLegend=function(){return this.createLegendDataPoints(0)},r.prototype.hasLegend=function(){return this.data&&(this.data.hasDynamicSeries||this.data.series&&this.data.series.length>1)},r.prototype.setFilteredData=function(t,a){var i=a-t,o=this.scrolledData=e.Prototype.inherit(this.data);return o.series=r.sliceSeries(o.series,i,t),o.categories=o.categories.slice(t,a),o},r.prototype.ensureDomainsIncludeForecast=function(e,t,a){if(_.isEmpty(e))return{x:t,y:a};for(var i=[t.min,t.max],r=[a.min,a.max],o=0,n=e;o<n.length;o++){var s=n[o];_.isEmpty(s.points)||(i.push.apply(i,_.map(s.points,function(e){return e.point.x})),r.push.apply(r,_.map(s.points,function(e){return e.point.y})),i.push.apply(i,_.map(s.points,function(e){return e.upperBound.x})),r.push.apply(r,_.map(s.points,function(e){return e.upperBound.y})),i.push.apply(i,_.map(s.points,function(e){return e.lowerBound.x})),r.push.apply(r,_.map(s.points,function(e){return e.lowerBound.y})))}return{x:{min:d3.min(i),max:d3.max(i)},y:{min:d3.min(r),max:d3.max(r)}}},r.prototype.calculateAxesProperties=function(i){var o=this,n=i.viewport;this.currentViewport=n,this.viewModelAdapter&&this.originalData&&(this.data=this.viewModelAdapter.applyChanges(this.currentViewport,this.originalData,this.dataView));var s=this.data,l=i.margin;this.margin=l;var c=s.series&&s.series.length>0?s.series[0].data.length:0,u=s?this.getCategoryLayout(c,i):{categoryCount:0,categoryThickness:t.CartesianHelper.MinOrdinalRectThickness,outerPaddingRatio:i.outerPaddingRatio,innerPaddingRatio:i.innerPaddingRatio,isScalar:!1},h=this.data.isScalar;this.trimOrdinalDataOnOverflow=i.trimOrdinalDataOnOverflow;var d=this.getPreferredPlotArea(u.isScalar,u.categoryCount,u.categoryThickness,u.outerPaddingRatio);if(this.scrolledData=void 0,s&&!h&&!this.isScrollable&&this.trimOrdinalDataOnOverflow){var p=Math.min(c,u.categoryCount);p!==c&&(s=this.scrolledData=e.Prototype.inherit(s),this.scrolledData.series=r.sliceSeries(s.series,p),this.scrolledData.categories=s.categories.slice(0,p))}var g,y;s.series&&s.series.length>0&&(g=s.series[0].xCol,y=s.series[0].yCol);var v=this.ensureDomainsIncludeForecast(s.forecastLines,i.ensureXDomain,i.ensureYDomain),m=v.x,f=v.y,x=a.hasFlag(this.lineType,16)?r.createStackedValueDomain(s.series):t.AxisHelper.createValueDomain(s.series),C=t.AxisHelper.combineDomain(i.forcedYDomain,x,f);this.yAxisProperties=t.AxisHelper.createAxis({pixelSpan:d.height,dataDomain:C,zeroScalarDomain:[-1,1],metaDataColumn:this.data.valuesMetadata,formatString:t.valueFormatter.getFormatString(y,t.lineChartProps.general.formatString),outerPadding:0,isScalar:!0,isVertical:!0,forcedTickCount:i.forcedTickCount,useTickIntervalForDisplayUnits:!0,isCategoryAxis:!1,scaleType:i.valueAxisScaleType,axisDisplayUnits:i.valueAxisDisplayUnits,axisPrecision:i.valueAxisPrecision,shouldClamp:!1,outerPaddingRatio:0,margin:l,preventNice:i.preventNiceY});var S=s.scalarMetadata?s.scalarMetadata:s.categoryMetadata,b=t.AxisHelper.getCategoryValueType(S),w=t.AxisHelper.createDomain(s.series,b,this.data.isScalar,i.forcedXDomain,m);return this.xAxisProperties=t.AxisHelper.createAxis({pixelSpan:d.width,dataDomain:w,zeroScalarDomain:[-1,1],metaDataColumn:g,formatString:t.valueFormatter.getFormatString(g,t.lineChartProps.general.formatString),outerPadding:this.data.isScalar?r.ScalarOuterPadding:0,isScalar:this.data.isScalar,isVertical:!1,forcedTickCount:i.forcedTickCount,maxTickCount:s.scalarKeyCount,useTickIntervalForDisplayUnits:!0,getValueFn:function(e,a){return t.CartesianHelper.lookupXValue(o.data,e,a,o.data.isScalar)},categoryThickness:u.categoryThickness,isCategoryAxis:!0,scaleType:i.categoryAxisScaleType,axisDisplayUnits:i.categoryAxisDisplayUnits,axisPrecision:i.categoryAxisPrecision,outerPaddingRatio:u.outerPaddingRatio,margin:l,allowSingleScalarTick:this.data.isScalar,preventNice:i.preventNiceX}),[this.xAxisProperties,this.yAxisProperties]},r.prototype.getCategoryLayout=function(e,a){var i=this.getAvailableWidth(),r=this.data?this.data.preferredCategoryWidth:null,o=this.data?this.data.categoryMetadata:void 0,n=t.AxisHelper.getCategoryValueType(o),s=this.getVisualCategoryAxisIsScalar(),l=t.AxisHelper.createDomain(this.data.series,n,s,a.forcedXDomain,a.ensureXDomain);return t.CartesianChart.getLayout(this.data,{availableWidth:i,categoryCount:e,preferredCategoryWidth:r,domain:l,isScalar:s,isScrollable:this.isScrollable,trimOrdinalDataOnOverflow:a.trimOrdinalDataOnOverflow,outerPaddingRatio:a.outerPaddingRatio,innerPaddingRatio:a.innerPaddingRatio})},r.prototype.enumerateObjectInstances=function(e,a){var i=this.originalData;if(i)switch(a.objectName){case"dataPoint":this.enumerateDataPoints(e);break;case"labels":this.enumerateDataLabels(e);break;case t.lineChartProps.lineStyles.strokeLineJoin.objectName:r.enumerateLineStyles(e,i,this.dataView,this.steppedLineEnabled);break;case t.ForecastHelper.forecastObjectName:this.supportsForecast()&&t.ForecastHelper.enumerateObjectInstances(e,i.forecastLines,this.style)}},r.prototype.enumerateDataPoints=function(t){var a=this.originalData;a&&a.series&&0!==a.series.length&&e.requireSync("PowerBIVisuals/Visuals/common/colorEnumerationHelper").enumerateSeriesDataColors({enumeration:t,dataPoints:_.map(a.series,function(e){return{color:e.color,displayName:e.seriesName,identity:e.identity}})})},r.prototype.enumerateDataLabels=function(e){var a=this.originalData,i=a.dataLabelsSettings,r=a.series.length,o=this.showLabelPerSeries();if(t.LabelUtils.enumerateDataLabels(this.getLabelSettingsOptions(e,i,null,o)),0!==r&&o&&i.showLabelPerSeries)for(var n=0;n<r;n++){var s=a.series[n],l=s.labelSettings?s.labelSettings:a.dataLabelsSettings;e.pushContainer({displayName:s.seriesName}),t.LabelUtils.enumerateDataLabels(this.getLabelSettingsOptions(e,l,s)),e.popContainer()}},r.enumerateLineStyles=function(a,i,r,o){var n;i.series.length>1&&(n=e.DataViewObjects.getValue(r&&r.metadata&&r.metadata.objects,t.lineChartProps.lineStyles.showSeries,!1));var s=!i.isScalar;if(t.LineStyle.enumerate({enumeration:a,style:i.lineStyle,showSeries:n,enumerateMarkers:s,enumerateSteppedLine:o}),n)for(var l=0,c=i.series.length;l<c;l++){var u=i.series[l];a.pushContainer({displayName:u.seriesName}),t.LineStyle.enumerate({enumeration:a,style:u.lineStyle,enumerateMarkers:s,selector:u.identity.getSelector(),enumerateSteppedLine:o}),a.popContainer()}},r.prototype.supportsTrendLine=function(){var e=this.getVisualCategoryAxisIsScalar();return!a.hasFlag(this.lineType,16)&&e&&this.data.hasValues},r.prototype.supportsForecast=function(){var e=this.getVisualCategoryAxisIsScalar();return!a.hasFlag(this.lineType,16)&&e&&this.data.hasValues&&1===this.data.series.length&&!this.hasLegend()},r.prototype.isStacked=function(){return a.hasFlag(this.lineType,16)},r.prototype.shouldSuppressAnimation=function(){return!!this.suppressAnimation},r.prototype.showLabelPerSeries=function(){var e=this.originalData;return!e.hasDynamicSeries&&(e.series.length>1||!e.categoryMetadata||this.isComboChart)},r.prototype.getLabelSettingsOptions=function(e,t,a,i){return{enumeration:e,dataLabelsSettings:t,show:!0,displayUnits:!0,precision:!0,selector:a&&a.identity?a.identity.getSelector():null,showAll:i,fontSize:!0,fontFamily:!0,labelDensity:this.data.isScalar,enableBackground:t.enableBackground,backgroundColor:t.backgroundColor,backgroundTransparency:t.backgroundTransparency,style:this.style}},r.prototype.overrideXScale=function(e){this.xAxisProperties=e},r.prototype.onClearSelection=function(){this.interactivityService&&this.interactivityService.clearSelection()},r.prototype.render=function(e){var a=t.AnimatorCommon.GetAnimationDuration(this.animator,e);this.suppressAnimation&&(a=0),this.previousCategoryCount=this.data.categoryData.length;var i,o=this.buildViewModel(a),n={hoverLine:this.hoverLine,hoverLineContext:this.hoverLineContext,mainGraphicsContext:this.mainGraphicsContext,svgDefs:this.svgDefs,mainGraphicsSVG:this.mainGraphicsSVG};if(this.isInteractiveChart){var s=$.extend(n,{dragHandle:this.dragHandle,selectionCircles:this.selectionCircles});i=r.renderOld(o,s,this.interactivityService,this,this,this.isInteractiveChart,e,this.markerRenderer,this.style),s.dragHandle&&(this.dragHandle=s.dragHandle)}else i=r.renderNew({viewModel:o,renderContext:n,interactivityService:this.interactivityService,plotAreaHelper:this,tooltipService:this.tooltipService,tooltipInteractivity:this,markerRenderer:this.markerRenderer,style:this.style});return t.ForecastHelper.render(this.data.forecastLines,n.mainGraphicsSVG,o.xAxisProperties.scale,o.yAxisProperties.scale,o.currentViewport,o.animationDuration),t.SVGUtil.flushAllD3TransitionsIfNeeded(this.options),i},r.prototype.buildViewModel=function(e){return{currentViewport:this.currentViewport,data:this.scrolledData||this.data,animationDuration:e,horizontalOffset:this.getXOfFirstCategory(),isComboChart:this.isComboChart,lineClassAndSelector:this.lineClassAndSelector,lineType:this.lineType,margin:this.margin,scale:this.scaleDetector.getScale(),tooltipsEnabled:this.tooltipsEnabled,xAxisProperties:this.xAxisProperties,yAxisProperties:this.yAxisProperties}},r.renderNew=function(e){var i=e.viewModel,o=e.renderContext,n=e.plotAreaHelper,s=e.tooltipService,l=e.tooltipInteractivity,c=e.viewModel.data,u=e.markerRenderer,h=e.style;if(c){u.ensureMarkers(e.renderContext.svgDefs,_.map(i.data.series,function(e){return e.lineStyle.markerProperties}));var d=a.hasFlag(i.lineType,16),p=i.margin,g=i.currentViewport,y=g.height-(p.top+p.bottom),v=g.width-(p.left+p.right),m=i.xAxisProperties.scale,f=i.yAxisProperties.scale,x=i.horizontalOffset,C=c.isScalar,S=e.interactivityService&&e.interactivityService.hasSelection(),b=a.hasFlag(i.lineType,2)||a.hasFlag(i.lineType,16),w=b||c.lineStyle.shadeArea||_.some(c.series,function(e){return e.lineStyle.shadeArea}),D=i.animationDuration;(c.categories.length*c.series.length>t.AnimatorCommon.MaxDataPointsToAnimate||u.shouldDisableAnimations()&&_.some(i.data.series,function(e){return e.lineStyle.markerProperties.showMarker})||w)&&(D=0);var P,L,A=function(e){return m(r.getXValue(e,C))+x};d?(P=function(e){return f(e.stackedValue-e.value)},L=function(e){return f(e.stackedValue)}):(P=f(0),L=function(e){return f(e.value)});var V,M;w&&(V=r.getAreaGenerator(A,P,L),M=r.getAreaGenerator(A,P,L),M.interpolate("step"));var T=r.getLineGenerator(A,L),k=r.getLineGenerator(A,L);k.interpolate("step"),a.hasFlag(i.lineType,4)&&(T.interpolate("basis"),V&&V.interpolate("basis")),o.mainGraphicsSVG.attr("height",y).attr("width",v);var F;w?(F=o.mainGraphicsContext.selectAll(r.CategoryAreaSelector.selector).data(_.filter(c.series,function(e){return b||e.lineStyle&&e.lineStyle.shadeArea}),function(e){return e.identity.getKey()}),F.enter().append(r.PathElementName).classed(r.CategoryAreaSelector.class,!0),F.style("fill",function(e){return e.areaColor}).style("fill-opacity",function(e){return S&&!e.selected?r.DimmedAreaFillOpacity:r.AreaFillOpacity}),D?F.transition().ease("linear").duration(D).attr("d",function(e){return e.lineStyle.stepped?M(e.data):V(e.data)}):F.attr("d",function(e){return e.lineStyle.stepped?M(e.data):V(e.data)}),F.exit().remove()):F=o.mainGraphicsContext.selectAll(r.CategoryAreaSelector.selector).remove();var I=o.mainGraphicsContext.selectAll(i.lineClassAndSelector.selector).data(c.series,function(e){return e.identity.getKey()});I.enter().append(r.PathElementName).classed(i.lineClassAndSelector.class,!0),I.style("stroke",function(e){return e.color}).style("stroke-opacity",function(e){return t.ColumnUtil.getFillOpacity(e.selected,!1,S,!1)}).style("stroke-width",function(e){return e.lineStyle.strokeWidth}).style("stroke-linejoin",function(e){return e.lineStyle.lineJoin}).style("stroke-dasharray",function(e){return t.LineStyle.getStrokeDashArrayFromLineStyle(e.lineStyle.style)}),D?I.transition().ease("linear").duration(D).attr("d",function(e){return e.lineStyle.stepped?k(e.data):T(e.data)}):I.attr("d",function(e){return e.lineStyle.stepped?k(e.data):T(e.data)}),I.exit().remove();var N=o.mainGraphicsContext.selectAll(r.MarkerLineClassSelector.selector).data(_.filter(c.series,function(e){return e.lineStyle.markerProperties.showMarker}),function(e){return e.identity.getKey()});N.enter().append(r.PathElementName).classed(r.MarkerLineClassSelector.class,!0).style("stroke","#ffffff").style("stroke-width",t.CartesianHelper.defaultLineStrokeWidth).style("stroke-opacity",0);var H;D?H=N.transition().ease("linear").duration(D).attr("d",function(e){return T(e.data)}).style("opacity",function(e){return t.ColumnUtil.getFillOpacity(e.selected,!1,S,!1)}).style("pointer-events","none"):N.attr("d",function(e){return T(e.data)}).style("opacity",function(e){return t.ColumnUtil.getFillOpacity(e.selected,!1,S,!1)}).style("pointer-events","none"),u.renderMarkers(H||N),N.exit().remove();var O=o.mainGraphicsContext.selectAll(r.InteractivityLineClassSelector.selector).data(c.series,function(e){return e.identity.getKey()});O.enter().append(r.PathElementName).classed(r.InteractivityLineClassSelector.class,!0).style("stroke-width",r.interactivityStrokeWidth).style("stroke-linejoin",t.strokeLineJoin.round),O.attr("d",function(e){if(!C){var t=r.getFirstPathPointFromSeriesData(e);if(t){var a=_.find(e.data,function(e){return e&&null!=e.value});if(a&&a.categoryIndex!==t.categoryIndex){var i=e.data.slice(t.categoryIndex-a.categoryIndex);return e.lineStyle.stepped?k(i):T(i)}}}return e.lineStyle.stepped?k(e.data):T(e.data)}),O.exit().remove();var R=o.mainGraphicsContext.selectAll(r.CategorySelector.selector).data(c.series,function(e){return e.identity.getKey()});R.enter().append("g").classed(r.CategorySelector.class,!0),R.exit().remove();var B=R.selectAll(r.CategoryValuePoint.selector).data(function(e){return e.data.filter(function(t,a){return r.shouldDrawCircle(e,a)})},function(e){return e.key});B.enter().append(r.CircleElementName).classed(r.CategoryValuePoint.class,!0),B.style("fill",function(){return d3.select(this.parentNode).datum().color}).style("fill-opacity",function(){var e=d3.select(this.parentNode).datum();return e.lineStyle.markerProperties.showMarker?0:t.ColumnUtil.getFillOpacity(e.selected,!1,S,!1)}),D?B.transition().duration(D).attr({cx:function(e,t){return m(r.getXValue(e,C))+x},cy:function(e,t){return f(d?e.stackedValue:e.value)},r:c.lineStyle.strokeWidth/2+r.CircleRadiusExtra}):B.attr({cx:function(e,t){return m(r.getXValue(e,C))+x},cy:function(e,t){return f(d?e.stackedValue:e.value)},r:c.lineStyle.strokeWidth/2+r.CircleRadiusExtra}),B.exit().remove();var E=R.selectAll(r.CategoryPointSelector.selector).data(function(e){return!i.isComboChart&&C?_.filter(e.data,function(e){return e&&null!=e.pointColor}):[]},function(e){return e.key});E.enter().append(r.CircleElementName).classed(r.CategoryPointSelector.class,!0),E.style("fill",function(e){return e.pointColor}),D?E.transition().duration(D).attr({cx:function(e){return m(r.getXValue(e,C))},cy:function(e){return f(d?e.stackedValue:e.value)},r:c.lineStyle.strokeWidth/2+r.PointRadiusExtra}):E.attr({cx:function(e){return m(r.getXValue(e,C))},cy:function(e){return f(d?e.stackedValue:e.value)},r:c.lineStyle.strokeWidth/2+r.PointRadiusExtra}),E.exit().remove();var U;c.dataLabelsSettings.show&&(U=r.createLabelDataPoints(i,h));var z={width:v,height:y,interactivityLines:O,dots:B,explicitDots:E,isComboChart:i.isComboChart,binnedLineSamplingApplied:c.binnedLineSamplingApplied,hasDynamicSeries:c.hasDynamicSeries};s.removeTooltips(z,l),i.tooltipsEnabled&&s.applyTooltips(z,n,l);var G,W;if(e.interactivityService){G=c.series.slice();for(var j=0,X=c.series.length;j<X;j++)for(var Y=0,q=c.series[j].data;Y<q.length;Y++){var K=q[Y];null!=K&&G.push(K)}W={lines:I,interactivityLines:O,dots:B,areas:F,tooltipOverlay:s.getTooltipOverlayElement(),getCategoryIndex:function(e,t,a){return a=a&&!s.usingHoverLine,n.getCategoryIndexFromSeriesAndPointX(e,t,a)},categoryIdentities:c.categoryIdentities,markerPaths:N}}return{dataPoints:G,behaviorOptions:W,labelDataPoints:[],labelsAreNumeric:!0,labelDataPointGroups:U,animateLabels:!1}}},r.getAreaGenerator=function(e,t,a){return d3.svg.area().x(e).y0(t).y1(a).defined(function(e){return e&&null!==e.value})},r.getLineGenerator=function(e,t){return d3.svg.line().x(e).y(t).defined(function(e){return e&&null!==e.value})},r.renderOld=function(e,i,o,n,s,l,c,u,h){var d=e.data;if(d){var p=e.margin,g=e.currentViewport,y=g.height-(p.top+p.bottom),v=e.xAxisProperties.scale,m=e.yAxisProperties.scale,f=d.isScalar,x=e.animationDuration;u.shouldDisableAnimations()&&(x=0);var C,S=g.width-(p.left+p.right),b=g.height-(p.top+p.bottom),w=o&&o.hasSelection(),D=a.hasFlag(e.lineType,16)||a.hasFlag(e.lineType,2),P=D||d.lineStyle.shadeArea||_.some(d.series,function(e){return e.lineStyle.shadeArea});P&&(C=d3.svg.area().x(function(e){return v(r.getXValue(e,f))}).y0(y).y1(function(e){return m(e.value)}).defined(function(e){return null!==e.value}));var L=d3.svg.line().x(function(e){return v(r.getXValue(e,f))}).y(function(e){return m(e.value)}).defined(function(e){return!!e&&null!==e.value});a.hasFlag(e.lineType,4)&&(L.interpolate("basis"),C&&C.interpolate("basis"));var A=e.horizontalOffset;if(i.mainGraphicsContext.attr("transform",t.SVGUtil.translate(A,0)),i.mainGraphicsSVG.attr("height",b).attr("width",S),i.hoverLineContext.attr("transform",t.SVGUtil.translate(A,0)),P){var V=i.mainGraphicsContext.selectAll(r.CategoryAreaSelector.selector).data(_.filter(d.series,function(e){return D||e.lineStyle&&e.lineStyle.shadeArea}),function(e){return e.identity.getKey()});V.enter().append("g").classed(r.CategoryAreaSelector.class,!0).append(r.PathElementName);i.mainGraphicsContext.selectAll(r.CategoryAreaSelector.selector).select(r.PathElementName).transition().ease("linear").duration(x).attr("d",function(e){return C(e.data)}).style("fill",function(e){return e.areaColor}).style("fill-opacity",function(e){return w&&!e.selected?r.DimmedAreaFillOpacity:r.AreaFillOpacity}),V.exit().remove()}else i.mainGraphicsContext.selectAll(r.CategoryAreaSelector.selector).remove();var M=i.mainGraphicsContext.selectAll(r.CategorySelector.selector).data(d.series,function(e){return e.identity.getKey()}),T=M.enter().append("g").classed(r.CategorySelector.class,!0);if(T.append(r.PathElementName),T.selectAll(r.CategoryValuePoint.selector).data(function(e){return e.data}).enter().append(r.CircleElementName).classed(r.CategoryValuePoint.class,!0),M.exit().remove(),l&&!i.dragHandle){var k=b;i.dragHandle=i.hoverLineContext.append("circle").attr("cx",0).attr("cy",k).attr("r","6px").classed("drag-handle",!0)}for(var F=M.data().length;i.selectionCircles.length<F;){var I=i.hoverLineContext.append(r.CircleElementName).classed(r.CircleClassName,!0).attr("r",d.lineStyle.strokeWidth/2+r.CircleRadiusExtra).style("opacity",0);i.selectionCircles.push(I)}for(;i.selectionCircles.length>F;)i.selectionCircles.pop().remove();var N=i.mainGraphicsContext.selectAll(r.CategorySelector.selector);N.select(r.PathElementName).classed(e.lineClassAndSelector.class,!0).style("stroke",function(e){return e.color}).style("stroke-opacity",function(e){return t.ColumnUtil.getFillOpacity(e.selected,!1,w,!1)}).style("stroke-width",d.lineStyle.strokeWidth).style("stroke-linejoin",d.lineStyle.lineJoin).transition().ease("linear").duration(x).attr("d",function(e){return L(e.data)}),u.ensureMarkers(i.svgDefs,_.map(e.data.series,function(e){return e.lineStyle.markerProperties}));var H=i.mainGraphicsContext.selectAll(r.MarkerLineClassSelector.selector).data(_.filter(d.series,function(e){return e.lineStyle.markerProperties.showMarker}),function(e){return e.identity.getKey()});H.enter().append(r.PathElementName).classed(r.MarkerLineClassSelector.class,!0).style("stroke","#ffffff").style("stroke-width",t.CartesianHelper.defaultLineStrokeWidth).style("stroke-opacity",0);var O=H.transition().ease("linear").duration(x).attr("d",function(e){return L(e.data)}).style("opacity",function(e){return t.ColumnUtil.getFillOpacity(e.selected,!1,w,!1)}).style("pointer-events","none");u.renderMarkers(O),H.exit().remove();var R=this,B=N.selectAll(r.CategoryValuePoint.selector),E=B.style("fill",function(){return d3.select(this.parentNode).datum().color}).style("fill-opacity",function(){var e=d3.select(this.parentNode).datum();return t.ColumnUtil.getFillOpacity(e.selected,!1,w,!1)}).transition().duration(x).attr({cx:function(e,t){var a=d3.select(this.parentNode).datum();return R.shouldDrawCircle(a,t)?v(R.getXValue(e,f)):0},cy:function(e,t){var a=d3.select(this.parentNode).datum();return R.shouldDrawCircle(a,t)?m(e.value):0},r:function(e,t){var a=d3.select(this.parentNode).datum();return R.shouldDrawCircle(a,t)?d.lineStyle.strokeWidth/2+r.CircleRadiusExtra:0}});if(l&&r.hasDataPoint(d.series)){var U=B.size(),z=0;E.each("end",function(){z++,z===U&&s.selectColumn(t.CartesianHelper.findMaxCategoryIndex(d.series),!0);
})}var G=null;if(d.dataLabelsSettings.show){G=[];for(var W=0,j=d.series.length;W<j;W++)Array.prototype.push.apply(G,d.series[W].data)}M.exit().remove();var X;return d.dataLabelsSettings.show&&(X=r.createLabelDataPoints(e,h)),null==G?null:{dataPoints:G,behaviorOptions:null,labelDataPoints:null,labelsAreNumeric:null,labelDataPointGroups:X,animateLabels:!c}}},r.getFirstPathPointFromSeriesData=function(e){return _.find(e.data,function(e,t,a){var i=a[t+1];return null!=e&&null!=e.value&&null!=i&&null!=i.value})},r.getSeriesTooltipInfo=function(e){if(!e)return null;var a=e.dataPoints;if(_.isEmpty(a))return null;var i="#000000",r="0",o=10,n=!_.isEmpty(a)&&a[0].seriesDisplayName,s=[],l=0,c=e.legendMarkerRendering,u=c!==t.legendMarkerRendering.markerOnly;if(_.some(a,function(e){return!_.isEmpty(e.additionalTooltipItems)}))for(var h=0,d=a;h<d.length;h++){var p=d[h];if(l>=o)break;if(null!=p.value&&(n&&(s.push({header:p.category,displayName:p.seriesDisplayName,value:p.seriesName,markerShape:p.markerShape,lineStyle:u?p.lineStyle:void 0,lineColor:p.lineColor}),l++),s.push({header:p.category,color:p.color,displayName:p.measureDisplayName,value:p.measure,markerShape:p.markerShape,lineStyle:u?p.lineStyle:void 0,lineColor:p.lineColor}),l++,!_.isEmpty(p.additionalTooltipItems)))for(var g=0,y=p.additionalTooltipItems;g<y.length;g++){var v=y[g];if(l>=o)break;s.push({header:p.category,color:i,displayName:v.displayName,value:v.value,opacity:r,markerShape:t.markerShape.none}),l++}}else for(var m=0,f=a;m<f.length;m++){var p=f[m];if(l>=o)break;null!=p.value&&(s.push({header:p.category,color:p.color,displayName:p.seriesName||p.measureDisplayName,value:p.measure,markerShape:p.markerShape,lineStyle:u?p.lineStyle:void 0,lineColor:p.lineColor}),l++)}if(!_.isEmpty(e.additionalTooltipItems))for(var x=0,C=e.additionalTooltipItems;x<C.length;x++){var v=C[x];if(l>=o)break;s.push({header:a[0].category,color:i,displayName:v.displayName,value:v.value,opacity:r,markerShape:t.markerShape.none}),l++}return 0===s.length?null:s},r.prototype.getTooltipInfoForPoint=function(e,t){var a,i=e.data,r=this.getCategoryIndexFromSeriesAndPointX(i,t,!0,e.context);if(i&&i.data&&i.data.length&&(a=_.find(i.data,function(e){return e&&e.categoryIndex===r})),a)return a.tooltipInfo},r.isDataPointData=function(e){return e&&null!=e.categoryIndex},r.isForecastPoint=function(e){return e&&null!=e.points},r.prototype.getCategoryIndexFromTooltipEvent=function(e,t){var a=e.data;if(!r.isForecastPoint(a))return r.isDataPointData(a)?a.categoryIndex:this.getCategoryIndexFromSeriesAndPointX(a,t,!1)},r.prototype.getCategoryIndexFromSeriesAndPointX=function(e,a,i,o){var n=0,s=this.data.categoryData;if(e&&!_.isEmpty(e.data)&&this.xAxisProperties){a=this.adjustPathXCoordinate(a,o);var l=r.getFirstPathPointFromSeriesData(e);l&&(n=this.xAxisProperties.scale(r.getXValue(l,this.data.isScalar))+this.getXOfFirstCategory()),i&&(s=_.map(e.data,function(e){return t.CartesianHelper.extractCategoryFromDataPoint(e)}))}return r.findCategoryIndex({pointX:a,offsetX:n,categoryData:s,scaleDetector:this.scaleDetector,scale:this.xAxisProperties.scale,categoryThickness:this.xAxisProperties.categoryThickness,isScalar:this.data.isScalar})},r.prototype.getVisualCategoryAxisIsScalar=function(){return!!this.data&&this.data.isScalar},r.prototype.getSupportedCategoryAxisType=function(){var e=this.dataView&&this.dataView.categorical?this.dataView.categorical.categories:void 0,a={text:!0};return _.isEmpty(e)&&t.AxisHelper.isOrdinal(a)?t.axisType.categorical:t.axisType.both},r.prototype.getPreferredPlotArea=function(e,a,i,r){return void 0===r&&(r=0),t.CartesianChart.getPreferredPlotArea(a,i,this.currentViewport,this.isScrollable,e,this.margin,r)},r.prototype.getAvailableWidth=function(){var e=this.currentViewport.width-(this.margin.left+this.margin.right);return Math.max(0,e)},r.prototype.getAvailableHeight=function(){var e=this.currentViewport.height-(this.margin.top+this.margin.bottom);return Math.max(0,e)},r.sliceSeries=function(t,a,i){void 0===i&&(i=0);var r=[];if(t&&t.length>0)for(var o=0,n=t.length;o<n;o++){var s=t[o];r[o]=e.Prototype.inherit(s);for(var l=[],c=i,u=i+a;c<u;c++)l.push(s.data[c]);r[o].data=l}return r},r.prototype.getXOfFirstCategory=function(){if(!this.data.isScalar){var e=this.xAxisProperties.scale;if(e.rangeBand)return e.rangeBand()/2}return 0},r.hasDataPoint=function(e){if(0===e.length)return!1;for(var t=0,a=e.length;t<a;t++)if(e[t].data.length>0)return!0;return!1},r.getXValue=function(e,t){return t?e.categoryValue:e.categoryIndex},r.shouldDrawCircle=function(e,t){var a=e.data[t];if(null==a||null===a.value)return!1;var i=e.data[t-1],r=null==i||null===i.value,o=e.data[t+1],n=null==o||null===o.value;return r&&n},r.prototype.getHoverLineDataForCategory=function(e,t){void 0===t&&(t=!1);var a=this.getChartX(e)+this.getXOfFirstCategory(),i=this.createTooltipData(e);if(i){var o=i.dataPoints;return i.dataPoints.length>0&&this.setHoverLineForTooltip(a),this.setDotsForTooltip(a,o,this.data.lineStyle.strokeWidth/2+r.TooltipCircleRadiusExtra),i}},r.prototype.getHoverLineIdentity=function(e){return this.data&&this.data.categoryIdentities&&this.data.categoryIdentities[e]},r.prototype.setHoverLineForTooltip=function(e){e=e||0,this.hoverLine.attr("x1",e).attr("x2",e).attr("y1",0).attr("y2",this.getAvailableHeight()).style("opacity",1)},r.prototype.clearHoverLine=function(){this.hoverLine.style("opacity",t.SVGUtil.AlmostZero),this.hoverLineContext.selectAll(r.HoverLineCircleDot.selector).remove()},r.prototype.setDotsForTooltip=function(e,t,i){var o=this;void 0===i&&(i=3);var n=a.hasFlag(this.lineType,16),s=n?function(e){return o.yAxisProperties.scale(e.stackedValue)}:function(e){return o.yAxisProperties.scale(e.value)},l=this.hoverLineContext.selectAll(r.HoverLineCircleDot.selector).data(_.filter(t,function(e){return e.showDot}));l.enter().append(r.CircleElementName).classed(r.HoverLineCircleDot.class,!0),l.filter(function(e){return e.value}).attr("fill",function(e){return e.color}).attr("r",i).attr("cx",e).attr("cy",s),l.exit().remove()},r.prototype.selectColumn=function(e,t){if(void 0===t&&(t=!1),t||this.lastInteractiveSelectedColumnIndex!==e){this.lastInteractiveSelectedColumnIndex=e;var a=this.getChartX(e);this.setHoverLine(a,e);var i=this.createLegendDataPoints(e);i&&this.options.cartesianHost.updateLegend(i)}},r.prototype.setHoverLine=function(e,t){this.hoverLine.attr("x1",e).attr("x2",e).attr("y1",0).attr("y2",this.getAvailableHeight()).style("opacity",1);var a=this;this.mainGraphicsContext.selectAll(r.CategorySelector.selector).selectAll(r.PathElementName).each(function(i){var r=this,o=i.color,n=a.selectionCircles[i.lineIndex];n&&n.attr({cx:e,cy:function(){var t=d3.select(r).node();return a.getPosition(e,t).y}}).style({opacity:function(){return _.some(i.data,function(e){return!!e&&e.categoryIndex===t})?1:0},fill:o}),a.dragHandle&&a.dragHandle.attr("cx",e)})},r.prototype.getChartX=function(t){var a=0;this.data.isScalar?t>=0&&t<this.data.categoryData.length&&(a=Math.max(0,this.xAxisProperties.scale(this.data.categoryData[t].categoryValue))):a=Math.max(0,this.xAxisProperties.scale(t));var i=e.visuals.AxisHelper.extent(this.xAxisProperties.scale)[1];return a=Math.min(a,i),isNaN(a)?0:a},r.findCategoryIndex=function(a){var i=a.pointX,r=a.offsetX,o=a.categoryData,n=a.scale,s=a.scaleDetector.getScale().x;e.Double.equalWithPrecision(s,1,1e-5)||(i/=s),r&&(i+=r);var l=e.visuals.AxisHelper.invertScale(n,i);if(a.isScalar){var c=t.AxisHelper.findClosestXAxisIndex(l,o);return c>=0?o[c].categoryIndex:-1}if(o[l]&&!o[l].hasData){for(var u=-1,h=l;h>0&&u===-1&&o[--h].hasData;)u=h;for(var d=-1,p=l,g=o.length-1;p<g&&d===-1&&o[++p].hasData;)d=p;var y=Math.abs(u-l),v=Math.abs(d-l);if(y<v)l=u;else if(y>v)l=d;else if(y===v){var m=n(l)+a.categoryThickness/2;l=i>m?d:u}}return l},r.prototype.getPosition=function(e,a){for(var i,r,o=a.getTotalLength(),n=0,s=o;;){if(r=n+s>>1,i=a.getPointAtLength(r),t.SVGUtil.ensureValidSVGPoint(i),(r===s||r===n)&&i.x!==e)break;if(i.x>e)s=r;else{if(!(i.x<e))break;n=r}}return i},r.prototype.createTooltipData=function(e){var a=this.data;if(a&&0!==a.series.length&&a.categories&&a.categoryData){var i,r=[],o=a.categoryData[e];this.data.isScalar?o&&(i=t.AxisHelper.isDateTime(this.xAxisProperties.axisType)&&!a.scalarMetadata?t.CartesianHelper.lookupXValue(this.data,o.categoryValue,this.xAxisProperties.axisType,this.data.isScalar):a.categories[e]):i=t.CartesianHelper.lookupXValue(this.data,e,this.xAxisProperties.axisType,this.data.isScalar);for(var n,s=t.lineChartProps.general.formatString,l=0,c=a.series;l<c.length;l++){var u=c[l],h=u.data,d=void 0;this.data.isScalar?o&&(d=h.filter(function(e){return e.categoryValue===o.categoryValue})[0]):d=h[e];var p=d&&d.value;if(null!=p){var g=t.CategoryLevelUtils.concatenateCategoryLevels(o.hierarchyCategoryLevels),y=u.lineStyle.markerProperties,v={color:t.Markers.resolveMarkerColor(y,u.color,a.legendMarkerRendering,a.matchLineColor),category:g.value,measureDisplayName:u.seriesName,measure:t.valueFormatter.format(p,t.valueFormatter.getFormatString(u.yCol,s)),value:p,stackedValue:d.stackedValue,showDot:!y.showMarker,markerShape:t.Markers.resolveMarkerShape(y,a.legendMarkerRendering,a.defaultToCircle?t.markerShape.circle:t.markerShape.longDash),lineStyle:u.lineStyle.style,lineColor:u.color};a.hasDynamicSeries?(v.seriesDisplayName=a.seriesDisplayName,v.seriesName=u.seriesName,v.additionalTooltipItems=d.additionalTooltipItems):n||(n=d.additionalTooltipItems),r.push(v)}}if(!_.isEmpty(a.forecastLines))for(var u=_.head(a.series),m=0,f=a.forecastLines;m<f.length;m++){var x=f[m],C=_(x.points).filter(function(e){return e.point.x===o.categoryValue}).first(),p=C&&C.point.y;if(null!=p){var v={color:x.lineColor.solid.color,category:t.valueFormatter.format(i,t.valueFormatter.getFormatString(u.xCol,s)),measureDisplayName:x.displayName,measure:t.valueFormatter.format(p,t.valueFormatter.getFormatString(u.yCol,s)),value:p,stackedValue:void 0,additionalTooltipItems:[{displayName:this.host.getLocalizedString("Visual_Confidence_Band_Upper"),value:t.valueFormatter.format(C.upperBound.y,t.valueFormatter.getFormatString(u.yCol,s))},{displayName:this.host.getLocalizedString("Visual_Confidence_Band_Lower"),value:t.valueFormatter.format(C.lowerBound.y,t.valueFormatter.getFormatString(u.yCol,s))}],showDot:!0,markerShape:t.markerShape.circle,lineStyle:void 0,lineColor:void 0};r.push(v)}}return{dataPoints:r,additionalTooltipItems:n,legendMarkerRendering:a.legendMarkerRendering}}},r.prototype.createLegendDataPoints=function(e){var a=this.data;if(a&&a.series&&!(a.series.length<1)){var i,r=[],o=a.categoryData[e];this.isInteractiveChart&&o&&(this.data.isScalar?(i=o.categoryValue,t.AxisHelper.isDateTime(this.xAxisProperties.axisType)&&(i=new Date(i))):i=t.CartesianHelper.lookupXValue(this.data,e,this.xAxisProperties.axisType,this.data.isScalar));for(var n=t.lineChartProps.general.formatString,s=null,l=0,c=a.series.length;l<c;l++){var u=a.series[l],h=u.data,d=void 0;if(this.isInteractiveChart){var p=void 0;if(this.data.isScalar){if(o)for(var g=o.categoryValue,y=0;y<h.length;y++)if(h[y].categoryValue===g){p=h[y];break}}else p=h[e];d=p&&p.value}var v=t.converterHelper.getFormattedLegendLabel(u.yCol,this.dataView.categorical.values,n);s=u.yCol,r.push({color:u.color,icon:t.LegendIcon.Line,label:v,category:t.valueFormatter.format(i,t.valueFormatter.getFormatString(u.xCol,n)),measure:t.valueFormatter.format(d,t.valueFormatter.getFormatString(u.yCol,n)),identity:u.identity,selected:u.selected})}var m=this.dataView&&this.dataView.categorical?this.dataView.categorical.values:null,f=m&&m.source?m.source.displayName:"",x=t.Legend.getDefaultLegendData(this.style);return x.title=f,x.dataPoints=r,x.grouped=a.hasDynamicSeries,x}},r.createLabelDataPoints=function(i,o){for(var n,s,l=i.xAxisProperties.scale,c=i.yAxisProperties.scale,u=i.data,h=u.series,d=u.dataLabelsSettings,p=t.LabelUtils.createColumnFormatterCacheManager(),g=a.hasFlag(i.lineType,16),y=[],v=u.isScalar,m=function(a,u){s=h[a],n=s.labelSettings||d;var m=100===n.labelDensity,x=t.LabelUtils.getNumberOfLabelsToRender(i.currentViewport.width,n.labelDensity,f.minimumLabelsToRender,t.MinMaxLabelDataPointSorter.estimatedLabelWidth),C=!m&&v?x:s.data.length;if(!n.show)return y[a]={labelDataPoints:[],maxNumberOfLabels:0},"continue";var S=t.LabelUtils.getLabelUnitAndPrecisionForAxis(i.yAxisProperties,n),b=s.data,w=[],D=function(a,u,h){var d,y=u.labelFormatString,f=p.getOrCreate(y,n,S.units,S.getPrecision(!!y,a.type)),x=t.LabelUtils.getLabelFormattedText(f.format(u.value)),C=n?n.fontProperties:t.LabelUtils.defaultFontProperties,b=t.FontProperties.toTextProperties(C,x),w=e.TextMeasurementService.measureSvgTextWidth(b)+t.LabelUtils.LabelDensityPadding,D=e.TextMeasurementService.estimateSvgTextHeight(b,!0),P=!1,L=i.horizontalOffset;if(g){var A=Math.max(u.stackedValue-u.value,c.domain()[0]),V=i.currentViewport.width;d={rect:{left:l(r.getXValue(u,v))+L-V/2,top:c(Math.max(u.stackedValue,u.stackedValue-u.value)),width:V,height:Math.abs(c(u.stackedValue)-c(A))},orientation:u.value>=0?1:2,validPositions:r.validStackedLabelPositions},P=!0}else{var M=a.lineStyle.markerProperties;d={point:{x:l(r.getXValue(u,v))+L,y:c(u.value)},radius:M.showMarker?M.size:0,validPositions:m?[1]:r.getValidLabelPositions(s,h)}}return{isPreferred:!1,text:x,textSize:{width:w,height:D},outsideFill:C.color?C.color:t.ColorHelper.getThemeColor(o,t.LabelUtils.DefaultLabelColorName),insideFill:C.color&&g?C.color:t.ColorHelper.getThemeColor(o,t.LabelUtils.DefaultInsideLabelColorName),parentType:P?1:0,parentShape:d,fontProperties:C,identity:u.identity,key:u.key,hasBackground:n.enableBackground,backgroundColor:n.backgroundColor,backgroundTransparency:n.backgroundTransparency}};if(!_.isEmpty(b))for(var P=0,L=b.length;P<L;P++){var A=b[P];if(null!=A&&null!=A.value){var V=D(s,A,P);w.push(V)}}y[a]={labelDataPoints:w,maxNumberOfLabels:C}},f=this,x=0,C=h.length;x<C;x++)m(x,C);return new t.MinMaxLabelDataPointSorter({unsortedLabelDataPointGroups:y,series:h,viewport:i.currentViewport,yAxisProperties:i.yAxisProperties}).getSortedDataLabels()},r.prototype.adjustPathXCoordinate=function(t,a){jsCommon.BrowserUtils.isFirefox()&&null!=a&&(this.pathXAdjustment=this.getPathXAdjustmentForFirefox(a)),jsCommon.BrowserUtils.isInternetExplorerOrEdge()&&(this.pathXAdjustment=r.interactivityStrokeWidth/2);var i=this.scaleDetector.getScale().x;return t-=e.Double.equalWithPrecision(i,1,1e-5)?this.pathXAdjustment:this.pathXAdjustment*i},r.prototype.getPathXAdjustmentForFirefox=function(e){var a=e.getBoundingClientRect(),i=t.SVGUtil.tryGetBBox(e);if(i.height>0&&i.width>0)return(a.width/this.scaleDetector.getScale().x-i.width)/2},r.getValidLabelPositions=function(e,t){var a=e.data,i=a.length,r=t===i-1,o=0===t,n=a[t].value,s=a[t-1]&&a[t-1].value,l=a[t+1]&&a[t+1].value,c=1,u=1;if(null==s?c=0:s>n?c=3:s<n&&(c=2),null===l?u=0:l>n?u=3:l<n&&(u=2),o)switch(u){case 3:return[2,1];default:return[1,2]}if(r)switch(c){case 3:return[2,1];default:return[1,2]}switch(c){case 0:switch(u){case 0:return[1,2,8,4];case 1:return[1,2,4,8];case 3:return[2,1,4,8];case 2:return[1,2,4,8]}case 1:switch(u){case 0:return[1,2,8,4];case 1:return[1,2,8,4];case 3:return[2,1,8,4];case 2:return[1,2,8,4]}case 3:switch(u){case 0:return[2,1,8,4];case 1:return[2,1,4,8];case 3:return[2,1,8,4];case 2:return[1,2,8,4]}case 2:switch(u){case 0:return[1,2,8,4];case 1:return[1,2,4,8];case 3:return[1,2,8,4];case 2:return[1,2,8,4]}}},r.prototype.getCartesianVisualCapabilities=function(){return{supportsHierarchicalCategoryAxis:!0}},r.prototype.getStaticSeriesRole=function(){return this.isComboChart?"Y2":"Y"},r.prototype.calculateCustomLegend=function(){if(!this.dataView)return t.Legend.getDefaultLegendData(this.style);var e=this.data;return t.Legend.buildSeriesLegendData({dataView:this.dataView,allowLegendWithNoSeries:this.isComboChart,showByDefault:!0,staticSeriesRole:this.getStaticSeriesRole(),style:this.style,ignoreDefaultColor:this.isComboChart,ignoreDefaultCategoryColor:!0,lineAndMarkerOptions:{renderMarkers:!e.isScalar,renderLineStyle:!0,legendMarkerRendering:e.legendMarkerRendering,matchSeriesColor:e.matchLineColor,defaultMarkerShape:e.defaultToCircle?t.markerShape.circle:t.markerShape.longDash}})},r.prototype.enumerateCustomLegend=function(e){var a=this.originalData,i=a.legendMarkerRendering,r=__assign({},e,{legendMarkerRendering:i,matchLineColor:i===t.legendMarkerRendering.markerOnly?a.matchLineColor:void 0,defaultToCircle:i===t.legendMarkerRendering.markerOnly?a.defaultToCircle:void 0});t.Legend.enumerate(r)},r.prototype.addWarnings=function(e){this.viewModelAdapter&&this.viewModelAdapter.addWarnings(e,this.originalData,this.data)},r.ClassName="lineChart",r.MainGraphicsContextClassName="mainGraphicsContext",r.CategorySelector=i("cat"),r.CategoryValuePoint=i("dot"),r.CategoryPointSelector=i("point"),r.CategoryAreaSelector=i("catArea"),r.HoverLineCircleDot=i("circle-item"),r.LineClassSelector=i("line"),r.MarkerLineClassSelector=i("marker-line"),r.InteractivityLineClassSelector=i("interactivity-line"),r.PointRadiusExtra=4,r.CircleRadiusExtra=3,r.TooltipCircleRadiusExtra=2,r.PathElementName="path",r.CircleElementName="circle",r.CircleClassName="selection-circle",r.LineElementName="line",r.ScalarOuterPadding=10,r.interactivityStrokeWidth=10,r.minimumLabelsToRender=4,r.AreaFillOpacity=.4,r.DimmedAreaFillOpacity=.2,r.defaultLineStrokeWidth=2,r.validStackedLabelPositions=[1,4,2],r}();t.LineChart=r;var o=function(){function e(e,t,a){this.tooltipService=e,this.mainGraphicsSVG=t,a&&(this.tooltipOverlay=t.append("rect").classed("tooltip-overlay",!0)),this.showHoverLine=!1}return Object.defineProperty(e.prototype,"usingHoverLine",{get:function(){return this.showHoverLine},enumerable:!0,configurable:!0}),e.prototype.getTooltipOverlayElement=function(){if(this.showHoverLine)return this.tooltipOverlay},e.prototype.applyTooltips=function(e,t,a){!this.tooltipOverlay||e.binnedLineSamplingApplied&&e.hasDynamicSeries?this.applyPointTooltip(e,t,a):this.applyHoverLineTooltip(e,t,a)},e.prototype.removeTooltips=function(e,t){this.removePointTooltip(e),this.removeHoverLineTooltip(t)},e.prototype.applyHoverLineTooltip=function(t,a,i){if(this.tooltipOverlay){this.showHoverLine||this.removePointTooltip(t),this.tooltipOverlay.attr({x:0,width:t.width,height:t.height});var o=function(e){var t=e.elementCoordinates[0],o=a.getCategoryIndexFromTooltipEvent(e,t),n=i.getHoverLineDataForCategory(o);return r.getSeriesTooltipInfo(n)};this.tooltipService.addTooltip(this.mainGraphicsSVG,o,function(t){return e.getCategoryIdentityForHoverLineTooltipEvent(a,i,t)},!0),this.mainGraphicsSVG.on("mouseout.hoverline",function(){return i.clearHoverLine()}),this.mainGraphicsSVG.on("touchmove.hoverline",function(){return i.clearHoverLine()}),this.showHoverLine=!0}},e.prototype.removeHoverLineTooltip=function(e){e.clearHoverLine(),this.tooltipService.removeTooltips(this.mainGraphicsSVG),this.mainGraphicsSVG.on(".hoverline",null),this.showHoverLine=!1},e.prototype.applyPointTooltip=function(t,a,i){this.showHoverLine&&this.removeHoverLineTooltip(i);var r,o=function(e){var t=e.elementCoordinates[0];return a.getTooltipInfoForPoint(e,t)};r=t.isComboChart?function(t){return e.getCategoryIdentityForHoverLineTooltipEvent(a,i,t)}:function(e){return e.data&&e.data.identity},this.tooltipService.addTooltip(t.interactivityLines,o,r,!0),this.tooltipService.addTooltip(t.dots,function(e){return e.data&&e.data.tooltipInfo},r,!0),t.explicitDots&&this.tooltipService.addTooltip(t.explicitDots,function(e){return e.data&&e.data.tooltipInfo},function(e){return e.data&&e.data.identity},!0),this.showHoverLine=!1},e.prototype.removePointTooltip=function(e){e.interactivityLines&&this.tooltipService.removeTooltips(e.interactivityLines),e.dots&&this.tooltipService.removeTooltips(e.dots),e.explicitDots&&this.tooltipService.removeTooltips(e.explicitDots)},e.getCategoryIdentityForHoverLineTooltipEvent=function(e,t,a){if(a){if(a.data&&r.isForecastPoint(a.data))return null;var i=a.elementCoordinates[0],o=e.getCategoryIndexFromTooltipEvent(a,i);return t.getHoverLineIdentity(o)}},e}()}(t=e.visuals||(e.visuals={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(e){function t(t,a,r,o,n){var s=t.getCategoryIndex(o,r,!0),l=e.InteractivityUtils.getPositionOfLastInputEvent(),c=_.find(o.data,function(e){return e&&e.categoryIndex===s});c?a.handleSelection(c,i.isCtrlOrMeta(d3.event),l):a.handleSelection({selected:o.selected,identity:o.identity,specificIdentity:t.categoryIdentities[s]},i.isCtrlOrMeta(d3.event),l)}function a(t,a,r,o,n){if(!i.isCtrlOrMeta(d3.event)){d3.event.preventDefault(),e.EventBubblingUtil.markAsHandled(d3.event);var s=e.InteractivityUtils.getPositionOfLastInputEvent(),l=t.getCategoryIndex(o,r,!0),c=_.find(o.data,function(e){return e&&e.categoryIndex===l});c?a.handleContextMenu(c,s):a.handleContextMenu({selected:o.selected,identity:o.identity,specificIdentity:t.categoryIdentities[l]},s)}}var i=jsCommon.BrowserUtils,r=function(){function r(){}return r.prototype.bindEvents=function(r,o){var n=this;this.lines=r.lines,this.markerPaths=r.markerPaths;var s=r.interactivityLines,l=this.dots=r.dots;this.areas=r.areas;var c=this.tooltipOverlay=r.tooltipOverlay,u=function(e){return n.getPointX(e)};s.on("click",function(e,a){t(r,o,u(this),e,a)}),s.on("contextmenu",function(e,t){a(r,o,u(this),e,t)}),e.InteractivityUtils.registerStandardInteractivityHandlers(l,o),c&&(_.isEmpty(r.categoryIdentities)?c.on("click",function(){i.isCtrlOrMeta(d3.event)||o.handleClearSelection()}):(c.on("click",function(){var t=r.getCategoryIndex(void 0,u(this),!1),a=e.InteractivityUtils.getPositionOfLastInputEvent();o.handleSelection({selected:!1,identity:void 0,specificIdentity:r.categoryIdentities[t]},i.isCtrlOrMeta(d3.event),a)}),c.on("contextmenu",function(){if(!i.isCtrlOrMeta(d3.event)){d3.event.preventDefault(),e.EventBubblingUtil.markAsHandled(d3.event);var t=e.InteractivityUtils.getPositionOfLastInputEvent(),a=r.getCategoryIndex(void 0,u(this),!1);o.handleContextMenu({selected:!1,identity:void 0,specificIdentity:r.categoryIdentities[a]},t)}})))},r.prototype.renderSelection=function(t){this.lines.style("stroke-opacity",function(a){return e.ColumnUtil.getFillOpacity(a.selected,!1,t,!1)}),this.dots.style("fill-opacity",function(a){return a.lineStyle.markerProperties.showMarker?0:e.ColumnUtil.getFillOpacity(a.selected,!1,t,!1)}),this.markerPaths&&this.markerPaths.style("opacity",function(a){return e.ColumnUtil.getFillOpacity(a.selected,!1,t,!1)}),this.areas&&this.areas.style("fill-opacity",function(a){return t&&!a.selected?e.LineChart.DimmedAreaFillOpacity:e.LineChart.AreaFillOpacity})},r.prototype.getPointX=function(e){for(var t,a=d3.event;t=a.sourceEvent;)a=t;var i=e.getBoundingClientRect();return a.clientX-i.left-e.clientLeft},r}();e.LineChartWebBehavior=r}(t=e.visuals||(e.visuals={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(t){var a=jsCommon.CssConstants.createClassAndSelector,i=e.data.createDataViewScopeIdentity,r=e.data.DataViewConcatenateCategoricalColumns,o=e.data.DataViewMatrixUtils,n=e.data.SQExprBuilder,s="drag-resize-disabled",l=function(){function i(e){e&&(this.interactivityService=e.interactivityService)}return i.prototype.init=function(e){var t=this;this.element=e.element,this.svg=e.svg,this.host=e.host,this.style=e.style,this.isMobileChart=e.interactivity&&e.interactivity.isInteractiveLegend,this.interactivityService&&(this.playControl=new u(this.element,function(e){return t.moveToFrameAndRender(e)},this.isMobileChart),this.playControl.onPlay(function(){return t.play()}))},i.prototype.setData=function(e,t){if(e){if(this.ridiculousFlagForPersistProperties&&e.metadata)return this.ridiculousFlagForPersistProperties=!1,this.playData;e.matrix||e.categorical?this.playData=c.converter(e,t,this.style):this.playData=c.getDefaultPlayData()}else this.playData=c.getDefaultPlayData();return this.lastViewport=void 0,this.playData},i.prototype.render=function(e,t,a,i){var r=this.playData,o=!this.lastViewport||this.lastViewport.height!==a.height||this.lastViewport.width!==a.width;if(this.lastViewport=a,o&&this.stop(),r){var n={data:this.playData,viewModel:t,viewport:a};if(this.interactivityService){var s=r.currentViewModel;this.interactivityService.applySelectionStateToData(s.dataPoints)}this.updateCallout(a,i),this.playControl&&o&&this.playControl.rebuild(r,a);var l=r.allViewModels.map(function(e){return e.dataPoints});return{allDataPoints:_.flatten(l),viewModel:n}}},i.prototype.updateCallout=function(a,r){var o=this.playData,n=o.frameData,s=o.currentFrameIndex,l=a.height,c=l-r.top-r.bottom,u=a.width,h=u-r.left-r.right,d=0,p=Math.min(l,1.3*u),g=Math.max(12,Math.round(p/7));g=Math.min(g,70);var y=[];if(s<n.length&&s>=0){var v={fontSize:jsCommon.PixelConverter.toString(g),text:n[s].text||"",fontFamily:t.Font.Family.regular.css};if(d=e.TextMeasurementService.estimateSvgTextHeight(v)-e.TextMeasurementService.estimateSvgTextBaselineDelta(v),d<c){var m=h-2*i.calloutOffsetMultiplier*d;y=[e.TextMeasurementService.getTailoredTextOrDefault(v,m)]}}var f=this.svg.selectAll(i.PlayCallout.selector).data(y);f.enter().append("text").classed(i.PlayCallout.class,!0),f.text(function(e){return e}).attr({x:h-i.calloutOffsetMultiplier*d,y:function(){return d}}).style({"font-size":g+"px","text-anchor":"end"}),f.exit().remove()},i.prototype.play=function(){var e=this.playData;if(this.isPlaying)this.stop();else if(this.playControl){this.isPlaying=!0,this.playControl.play();var t=this.playControl.getCurrentIndex();if(null==t)return;t=Math.round(t),t>=e.allViewModels.length-1?e.currentFrameIndex=-1:e.currentFrameIndex=t-1,this.playNextFrame(e)}},i.prototype.playNextFrame=function(e,t,a){var i=this;if(!this.isPlaying)return void this.stop();var r=e.currentFrameIndex+1;if(null!=t&&null!=a&&(r=Math.abs(a-t+1),t=r),r<e.allViewModels.length&&r>-1){var o=this.host.tooltips();o&&o.hide({immediately:!0,isTouchEvent:!1}),e.currentFrameIndex=r,e.currentViewModel=e.allViewModels[r],this.renderDelegate(e.currentViewModel),this.playControl.setFrame(r),r<e.allViewModels.length&&window.setTimeout(function(){i.playNextFrame(e,t,a)},c.FrameStepDuration)}else this.stop()},i.prototype.stop=function(){this.playControl&&this.playControl.pause(),this.isPlaying=!1},i.prototype.remove=function(){this.playControl&&this.playControl.remove(),d3.selectAll(i.PlayCallout.selector).remove()},i.prototype.setRenderFunction=function(e){this.renderDelegate=e},i.prototype.getCartesianExtents=function(e,t){return!this.playData||_.isEmpty(this.playData.allViewModels)||_.isEmpty(this.playData.frameData)?e:c.getMinMaxForAllFrames(this.playData,t)||e},i.prototype.setPlayControlPosition=function(e){if(this.playControl){var t=this.playControl.getContainer();t.css("left",e.left?e.left+"px":""),t.css("top",e.top?e.top+"px":"")}},i.prototype.moveToFrameAndRender=function(e){var t=this.playData;if(this.isPlaying=!0,t&&e>=0&&e<t.allViewModels.length&&e!==t.currentFrameIndex){t.currentFrameIndex=e;var a=t.allViewModels[e];t.currentViewModel=a,this.renderDelegate(a)}this.isPlaying=!1},i.prototype.isCurrentlyPlaying=function(){return this.isPlaying},i.PlayCallout=a("play-callout"),i.calloutOffsetMultiplier=.3,i}();t.PlayAxis=l;var c,u=function(){function e(e,t,a){this.isMobileChart=a,this.createSliderDOM(e),this.renderDelegate=t}return e.prototype.getContainer=function(){return this.playAxisContainer},e.prototype.remove=function(){this.playAxisContainer&&this.playAxisContainer.remove()},e.prototype.pause=function(){this.playButton.removeClass("pause").addClass("play")},e.prototype.play=function(){this.playButton.removeClass("play").addClass("pause")},e.prototype.getCurrentIndex=function(){if(this.noUiSlider)return Math.round(this.noUiSlider.get())},e.prototype.onPlay=function(e){this.playButtonCircle.off("click"),this.playButtonCircle.on("click",e)},e.prototype.setFrame=function(e){this.noUiSlider.set([e])},e.prototype.rebuild=function(t,a){var i=this,r=this.slider;this.playAxisContainer.css("width",a.width),this.noUiSlider&&this.noUiSlider.destroy();var o=t.labelData,n=e.calucalateSliderSize(o,a.width),s=this.getContainer();n.marginLeft>e.SliderMarginLeft&&(s.css("padding-left",n.marginLeft-e.SliderMarginLeft+"px"),s.css("box-sizing","border-box"));var l=this.updateSliderControl(t,n.width),c=e.adjustWidthRegardingLastItem(o,l,n.width);this.slider.css("width",c+"px"),this.noUiSlider.on("slide",function(){var e=i.getCurrentIndex();i.renderDelegate(e)});var u=0;$(".noUi-value",r).each(function(e,t){var a=o.labelInfo[u].labelWidth;$(t).width(a),$(t).css("margin-left",-a/2+"px"),u+=l})},e.prototype.updateSliderControl=function(t,a){var i=t.labelData,r=this.slider.get(0),o=t.frameData.length,n={start:0===o?0:t.currentFrameIndex,step:1,range:{min:0,max:0===o?0:o-1}},s=null,l=0;if(o>0){var c=e.createPipsFilterFn(t,a,i);l=c.skipStep,s={mode:"steps",density:Math.ceil(100/o),format:{to:function(e){return t.frameData[e].escapedText},from:function(e){return t.frameData.indexOf(e)}},filter:c.filter}}return n.pips=s,noUiSlider.create(r,n),this.noUiSlider=r.noUiSlider,l},e.createPipsFilterFn=function(e,t,a){var i=_.max(_.map(a.labelInfo,function(e){return e.labelWidth})),r=1,o=1,n=e.frameData.length>1?t/(e.frameData.length-1):t,s=i/n;return s>1.25?(o=Math.ceil(s),r=2):(s>1||a.anyWordBreaks)&&(r=2),{filter:function(e,t){return e%o===0?r:0},skipStep:o}},e.adjustWidthRegardingLastItem=function(t,a,i){if(_.isEmpty(t.labelInfo))return i;var r=t.labelInfo.length,o=Math.floor((r-1)/a)*a,n=i+e.SliderMarginRight-i/r*(o+1),s=t.labelInfo[o].labelWidth,l=s/2-n;if(l>0){var c=e.SliderMaxMargin-e.SliderMarginRight;return l=l>c?c:l,i-l}return i},e.prototype.createSliderDOM=function(t){this.playAxisContainer=$('<div class="play-axis-container"></div>').appendTo(t).css("height",e.PlayControlHeight+"px"),this.playButtonCircle=$('<div class="button-container"></div>').appendTo(this.playAxisContainer),this.isMobileChart&&this.playButtonCircle.addClass("mobile-button-container"),this.playButton=$('<div class="play"></div>').appendTo(this.playButtonCircle),this.slider=$('<div class="sliders"></div>').attr(s,"true").appendTo(this.playAxisContainer)},e.calucalateSliderSize=function(t,a){var i=0;_.isEmpty(t.labelInfo)||(i=_.head(t.labelInfo).labelWidth/2);var r=Math.max(i,e.SliderMarginLeft);return r=Math.min(e.SliderMaxMargin,r),{width:Math.max(a-r-e.SliderMarginRight,1),marginLeft:r}},e.SliderMarginLeft=44,e.SliderMarginRight=20,e.SliderMaxMargin=100,e.PlayControlHeight=80,e}();!function(a){function s(a,i){var n,s,u=a.matrix,h={categories:[],values:e.data.DataViewTransform.createValueColumns()};if(_.isEmpty(u.columns.levels)||u.rows.levels.length<2&&u.columns.levels.length<2)return(n=h.values).push.apply(n,l(u.valueSources)),{metadata:a.metadata,categorical:h};for(var d=1,p=[],g=d,y=u.rows.levels.length;g<y;g++){var v=u.rows.levels[g].sources[0];p.push({source:v,values:[],identity:[],objects:void 0})}var m=!_.isEmpty(u.rows.root.children),f=!_.isEmpty(u.columns.root.children),x=u.columns.levels.length>1&&f,C=u.rows.levels.length>1&&m;if(x&&!C){h.categories=void 0;var S=u.columns.root;h.values.source=u.columns.levels[0].sources[0];for(var b=u.valueSources.length,w=0,D=S.children.length;w<D;w++){var P=S.children[w];if(!P.isSubtotal)for(var L=0;L<b;L++){var A=_.create(u.valueSources[L],{groupName:void 0===P.value?null:P.value}),V={identity:P.identity,values:[],source:A};h.values.push(V)}}for(var M=u.rows.root.children[i],T=M.values,k=0,F=S.children.length;k<F;k++)if(!S.children[k].isSubtotal)for(var L=0;L<b;L++)h.values[k*b+L].values.push(T[k*b+L].value)}else if(x&&m){var M=u.rows.root.children[i];o.forEachLeafNode(M.children,function(e,t,a){e.isSubtotal||c(a,p)}),h.categories=p,h.values.source=u.columns.levels[0].sources[0];for(var I=[],P=u.columns.root,N=-1;P;)if(!P.isSubtotal){if(P.children&&P.children[0].children)for(var L=0,H=P.children.length;L<H;L++)P.children[L].isSubtotal||I.push(P.children[L]);else if(P.children&&M.children){for(var O=P.children.length,L=0;L<O;L++){
var A=_.create(u.valueSources[L],{groupName:P.value}),V={identity:P.identity,values:[],source:A};h.values.push(V)}o.forEachLeafNode(M.children,function(e){if(!e.isSubtotal)for(var t=0;t<O;t++)h.values[N*O+t].values.push(e.values[N*O+t].value)})}I.length>0?(P=I[0],I=I.splice(1),N++):P=void 0}}else if(C){var M=u.rows.root.children[i],R=u.valueSources.length;(s=h.values).push.apply(s,l(u.valueSources)),o.forEachLeafNode(M.children,function(e,t,a){if(!e.isSubtotal){c(a,p);for(var i=0;i<R;i++)h.values[i].values.push(e.values[i].value)}}),h.categories=p}return r.applyToPlayChartCategorical(a.metadata,t.getScatterChartObjectDescriptors(),"Category",h)}function l(e){return _.isEmpty(e)?[]:_.map(e,function(e){return{identity:void 0,values:[],source:e}})}function c(e,t){var a=e[0].identity;if(e.length>1){for(var r=a.expr,o=1,s=e.length;o<s;o++){var l=e[o].identity.expr;r=n.and(r,l)}a=i(r)}for(var c=0,u=t.length;c<u;c++){t[c].identity.push(a);var h=e[c];t[c].values.push(h.value)}}function u(a,i){var r={};if(a&&a.objects){var o=a.objects;r.currentFrameIndex=e.DataViewObjects.getValue(o,t.scatterChartProps.currentFrameIndex.index,null)}return r}function h(e,a,i){var r,o,n=e.metadata,l=t.LabelUtils.getDefaultPointLabelSettings(i),c=u(n,l),h=m(e),d=[],p=[],y=e.matrix.rows,v=y.root.children?y.root.children.length:0;if(e.matrix&&v>0&&!_.isEmpty(y.levels)&&!_.isEmpty(y.levels[0].sources)){o=y.levels[0].sources[0];var f=t.valueFormatter.getFormatString(o,t.scatterChartProps.general.formatString),x=void 0;if(o.type.numeric){var C=Math.abs(y.root.children[v-1].value-y.root.children[0].value);x=t.valueFormatter.create({format:f,value:C,value2:0,columnType:o.type})}else x=t.valueFormatter.createDefaultFormatter(f,!0);for(var S=0,b=v;S<b;S++){var w=y.root.children[S];if(!w.isSubtotal){var D=x.format(w.value),P=$("<div/>").text(D).html();p.push({escapedText:P,text:D});var L=s(e,S);r=a(L,{label:P,column:o,identity:w.identity},h),d.push(r)}}}else{var L=s(e,0);r=a(L,void 0,h),d.push(r)}return c.currentFrameIndex=p.length-1,{allViewModels:d,currentViewModel:r,frameData:p,currentFrameIndex:c.currentFrameIndex,labelData:g(p,o)}}function d(){return{frameData:[],allViewModels:[],currentFrameIndex:0,currentViewModel:void 0,labelData:{anyWordBreaks:!1,labelInfo:[]}}}function p(e,t){var a={minY:null,maxY:null,minX:null,maxX:null},i=!1;if(e.allViewModels&&e.allViewModels.length>0)for(var r=0,o=e.allViewModels.length;r<o;r++){var n=e.allViewModels[r];if(!_.isEmpty(n.dataPoints)){i=!0;var s=t(n);a={minY:d3.min([s.minY,a.minY]),maxY:d3.max([s.maxY,a.maxY]),minX:d3.min([s.minX,a.minX]),maxX:d3.max([s.maxX,a.maxX])}}}return i?a:null}function g(a,i){for(var r={fontFamily:t.Font.Family.regular.css,fontSize:jsCommon.PixelConverter.toString(14)},o=[],n=!1,s=0,l=a;s<l.length;s++){var c=l[s],u=jsCommon.WordBreaker.getMaxWordWidth(c.escapedText,e.TextMeasurementService.measureSvgTextWidth,r);n=n||jsCommon.WordBreaker.hasBreakers(c.escapedText)||c.escapedText.indexOf("-")>-1,o.push({label:c.escapedText,labelWidth:u})}return{labelInfo:o,anyWordBreaks:n,labelFieldName:i&&i.displayName}}function y(e,t){void 0===t&&(t="Play");var a=e.matrix&&e.matrix.rows&&e.matrix.rows.levels&&e.matrix.rows.levels[0]&&e.matrix.rows.levels[0].sources&&e.matrix.rows.levels[0].sources[0]&&e.matrix.rows.levels[0].sources[0].roles;return a&&a[t]}function v(e,t,a){var i=_.filter(e,function(e){return e.selected});i=_.uniqBy(i,function(e){return e.identity.getKey()}),t.render(i,a)}function m(e){if(e&&e.matrix){var a=_.find(e.matrix.rows.root.children,function(e){return e.isSubtotal});if(a){for(var i=_.size(a.values),r=_.size(e.matrix.valueSources),o={},n=0;n<r;n++){var s=e.matrix.valueSources[n].roles,l=t.AxisHelper.normalizeNonFiniteNumber(a.values[i-r+n].value);for(var c in s)o[c]=l}return o}}}a.FrameStepDuration=800,a.FrameAnimationDuration=750,a.ClassName="playChart",a.convertMatrixToCategorical=s,a.converter=h,a.getDefaultPlayData=d,a.getMinMaxForAllFrames=p,a.isDataViewPlayable=y,a.renderTraceLines=v,a.getSubtotals=m}(c=t.PlayChart||(t.PlayChart={}))}(t=e.visuals||(e.visuals={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(t){var a="realTimeLineChart",i=1.5,r=3e5,o=function(){function o(e){this.animator=e.animator,this.maxDataValue=Number.MIN_VALUE,this.newDataInterval=0,this.duration=r}return o.prototype.init=function(e){this.options=e;var i=this.cartesianSVG=e.svg;this.host=e.host,this.currentViewport=e.viewport,this.cartesianVisualHost=e.cartesianHost,this.style=e.style,i.classed(a,!0).classed("cartesianChart",!0);var r=this.mainGraphicsSVG=i.append("svg");r.classed("mainGraphicsSVG",!0),this.mainGraphicsContext=r.append("g").classed("mainGraphicsContext",!0),this.data={series:[],dataLabelsSettings:t.LineChart.getDefaultLineChartLabelSettings(this.style),hasDynamicSeries:!1,categories:[],categoryMetadata:void 0,valuesMetadata:[],categoryData:[],lineStyle:t.LineStyle.getDefault()}},o.prototype.setData=function(a){if(this.data||(this.data={series:[],dataLabelsSettings:t.LineChart.getDefaultLineChartLabelSettings(this.style),hasDynamicSeries:!1,categories:[],categoryMetadata:void 0,valuesMetadata:[],categoryData:[],lineStyle:t.LineStyle.getDefault()}),!_.isEmpty(a)){var i=_.head(a);if(i.categorical){var r=t.CartesianHelper.getCategoryAxisProperties(i.metadata),o=r.duration;o&&(this.duration=o);var n=this.dataViewCat=i.categorical;this.removeOldData();var s=n.categories,l=e.ValueType.fromDescriptor({text:!0});s&&s.length>0&&s[0].source&&s[0].source.type&&(l=s[0].source.type);var c=t.ScalarUtils.canHaveScalarAxis(i.metadata?i.metadata.objects:null,t.lineChartProps.categoryAxis.axisType,l),u=t.LineChart.converter({dataView:i,style:this.style,isScalar:c});this.mergeNewData(u),this.removeOldData(this.newDataInterval)}}},o.prototype.hasLegend=function(){return this.data&&(this.data.hasDynamicSeries||!_.isEmpty(this.data.series))},o.prototype.calculateAxesProperties=function(e){return this.currentViewport=e.viewport,this.margin=e.margin,this.newAxisData&&(this.axisData=this.newAxisData),this.newAxisData=this.createAxisData(e),this.axisData||(this.axisData=this.newAxisData),[this.xAxisProperties,this.yAxisProperties]},o.prototype.overrideXScale=function(e){this.xAxisProperties=e},o.prototype.render=function(e,t){if(!this.containsEmptySeries())return this.renderLines(),this.animator&&this.animator.refreshLastUpdate(),{dataPoints:[],behaviorOptions:[],labelDataPoints:[],labelsAreNumeric:!0,labelDataPointGroups:[],animateLabels:!1}},o.prototype.calculateLegend=function(){var e=t.Legend.getDefaultLegendData(this.style);if(this.containsEmptySeries())return e;var a=this.data,i=this.dataViewCat,r=[],o=t.lineChartProps.general.formatString,n=null;if(i.values)for(var s=0,l=a.series;s<l.length;s++){var c=l[s],u=t.converterHelper.getFormattedLegendLabel(c.yCol,i.values,o);n=c.yCol,r.push({color:c.color,icon:t.LegendIcon.Line,label:u,identity:c.identity,selected:c.selected})}var h=i?i.values:null,d=h&&h.source?h.source.displayName:"";return e.title=d,e.dataPoints=r,e},o.prototype.onClearSelection=function(){},o.prototype.createAxisData=function(a){var i=this.data;if(i){var r;this.containsEmptySeries()||(r=i.series[0].yCol);var o=this.truncateSeries(),n=t.AxisHelper.createDomain(o,i.categoryMetadata?i.categoryMetadata.type:e.ValueType.fromDescriptor({text:!0}),!0,[this.getMinData()+this.newDataInterval,null]),s=a.viewport,l=s.width,c=this.xAxisProperties=t.AxisHelper.createAxis({pixelSpan:l,dataDomain:n,metaDataColumn:i.categoryMetadata,formatString:t.valueFormatter.getFormatString(i.categoryMetadata,t.columnChartProps.general.formatString),outerPadding:10,isCategoryAxis:!0,isScalar:!0,isVertical:!1,categoryThickness:null,useTickIntervalForDisplayUnits:!0,getValueFn:function(e,a){return t.CartesianHelper.lookupXValue(i,e,a,!0)},scaleType:t.axisScale.linear,margin:a.margin,preventNice:a.preventNiceX}),u=t.AxisHelper.createValueDomain(o),h=this.margin,d=this.yAxisProperties=t.AxisHelper.createAxis({pixelSpan:s.height-h.top-h.bottom,dataDomain:u,metaDataColumn:r,formatString:t.valueFormatter.getFormatString(r,t.columnChartProps.general.formatString),outerPadding:0,isScalar:!0,isVertical:!0,useTickIntervalForDisplayUnits:!0,isCategoryAxis:!1,scaleType:t.axisScale.linear,margin:a.margin,preventNice:a.preventNiceY});return d.axis.orient("left").tickSize(-l),{x:c,y1:d}}},o.prototype.truncateSeries=function(){var t=this.getMinData(),a=this.data.series;return a?_.map(a,function(a,i){a=e.Prototype.inherit(a),a.data=e.Prototype.inherit(a.data);var r=_.findIndex(a.data,function(e){return e&&e.categoryValue>=t}),o=0;return r>0&&o++,a.data=a.data.slice(o),a}):[]},o.prototype.removeOldData=function(e){if(void 0===e&&(e=0),!this.containsEmptySeries()){for(var t=this.getMinData(e),a=this.data,i=0,r=a.series;i<r.length;i++){var o=r[i],n=_.findIndex(o.data,function(e){return e&&e.categoryValue>t});n>0&&(o.data=o.data.slice(n))}var s=_.findIndex(a.categoryData,function(e){return e&&e.categoryValue>t});s>0&&(a.categoryData=this.data.categoryData.slice(s),a.categories=this.data.categories.slice(s))}},o.prototype.mergeNewData=function(e){if(this.containsEmptySeries())return this.data=e,void(this.maxDataValue=this.getMaxData());this.data.series=o.mergeSeries(this.data.series,e.series,this.maxDataValue),o.mergeCategories(this.data,e,this.maxDataValue);var t=this.getMaxData();this.newDataInterval=this.maxDataValue&&t?t-this.maxDataValue:0,this.maxDataValue=t},o.prototype.getMaxData=function(){for(var e=0,t=0,a=this.data.series;t<a.length;t++){var i=a[t];i.data.length&&(e=Math.max(_.last(i.data).categoryValue,e))}return e},o.prototype.getMinData=function(e){return void 0===e&&(e=0),this.maxDataValue-this.duration-e*i},o.prototype.renderLines=function(){var e=this.axisData.x.scale,a=this.axisData.y1.scale,i=this.currentViewport,r=this.margin,o=i.height-r.top-r.bottom,n=i.width-r.left-r.right,s=e(e.domain()[0]+this.newDataInterval)-e(e.domain()[0]),l=d3.svg.line().x(function(t,a){return e(t.categoryValue)}).y(function(e,t){return a(e.value)});this.mainGraphicsSVG.attr({x:0,height:o,width:n}),this.mainGraphicsContext.attr("transform",t.SVGUtil.translate(0,0));var c=this.mainGraphicsContext.selectAll(".line").data(this.data.series,function(e){return e.identity.getKey()});c.enter().append("path").classed("line",!0),c.style("stroke",function(e){return e.color}).attr("d",function(e){return l(e.data)}),c.exit().remove(),this.animator&&this.animator.animate({mainGraphicsContext:this.mainGraphicsContext,interactivityService:null,xTranslation:s})},o.prototype.containsEmptySeries=function(){return!this.data||_.isEmpty(this.data.series)},o.mergeCategories=function(e,t,a){var i=t.categories,r=_.findIndex(i,function(e){return e&&e.categoryValue>a});r>-1?(e.categories=e.categories.concat(t.categories.slice(r)),e.categoryData=e.categoryData.concat(t.categoryData.slice(r))):(e.categories=t.categories,e.categoryData=t.categoryData)},o.mergeSeries=function(e,t,a){for(var i=[],r=0,o=t;r<o.length;r++){var n=o[r],s=_.find(e,function(e){return e.identity.equals(n.identity)});if(s){i.push(s);for(var l=0,c=n.data;l<c.length;l++){var u=c[l];u.categoryValue>a&&s.data.push(u)}}else i.push(n)}return i},o.prototype.getCartesianVisualCapabilities=function(){return{supportsHierarchicalCategoryAxis:!1}},o.prototype.getStaticSeriesRole=function(){return"Y"},o}();t.RealTimeLineChart=o}(t=e.visuals||(e.visuals={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(e){var t=1500,a="linear",i=function(i){function r(e){var t=i.call(this,e)||this;return t.lastUpdateTime=null,t}return __extends(r,i),r.prototype.refreshLastUpdate=function(){this.lastUpdateTime=Date.now()},r.prototype.getDuration=function(){if(this.lastUpdateTime){var e=Math.min(Date.now()-this.lastUpdateTime,t);return Math.max(this.animationDuration,e)}return this.animationDuration},r.prototype.getEasing=function(){return a},r.prototype.animate=function(t){var a=t.mainGraphicsContext,i=this.getDuration();return a.transition().duration(i).ease(this.getEasing()).attrTween("transform",function(a,i,r){return function(a){return e.SVGUtil.translate(-(t.xTranslation*a),0)}}),{failed:!1}},r}(e.BaseAnimator);e.RealTimeLineChartAnimator=i;var r=function(t){function i(e){return t.call(this,e)||this}return __extends(i,t),i.prototype.animate=function(t){var a={failed:!0,shapes:null},i=t.viewModel,r=this.previousViewModel;return i.categories.length*i.series.length>e.AnimatorCommon.MaxDataPointsToAnimate?a:(r&&(a=this.animateDefaultShapes(t.viewModel,t.series,t.layout,t.itemCS)),this.previousViewModel=i,a)},i.prototype.getEasing=function(){return a},i.prototype.animateDefaultShapes=function(t,a,i,r){var o=a.selectAll(r.selector),n=o.data(function(e){return e.data},function(e){return e.key});return n.enter().append("rect").attr("class",function(e){return r.class.concat(e.highlight?" highlight":"")}),n.style("fill",function(e){return e.color}).style("fill-opacity",function(a){return e.ColumnUtil.getFillOpacity(a.selected,a.highlight,!1,t.hasHighlights)}).transition().ease(this.getEasing()).duration(this.animationDuration).attr(i.shapeLayout),n.exit().remove(),{failed:!1,shapes:n}},i}(e.BaseAnimator);e.DashboardColumnChartAnimator=r}(t=e.visuals||(e.visuals={}))}(powerbi||(powerbi={})),powerbi.define("PowerBIVisuals/visuals/scatter/scatterChart.converter",function(e){function t(e,t,r,o){return t.useMatrixDV?i(e,t,r):e.categorical&&e.categorical.values?a(e,t,r,o):void 0}function a(e,t,a,i){var n,s,l=powerbi.data.createDataViewCategoricalReaderAdvanced(e,{colorOptions:{valueRole:"Size",visualStyle:t.style}}),c=t.style,u=t.interactivityService,h=t.categoryAxisProperties,p=t.valueAxisProperties,y=e.categorical,v=k.getGradientValueColumn(y);y.categories&&y.categories.length>0?(n=y.categories[0].values,s=E.create({format:E.getFormatString(y.categories[0].source,H.general.formatString),value:n[0],value2:n[n.length-1],columnType:l.data.getCategoryType("Category")})):(n=[null],s=E.createDefaultFormatter(null));var m,f=y.categories,x=y.values,C=!!x.source,S=x.grouped(),b=x.source,w=g(S,b),D=F.getDefaultPointLabelSettings(c),P=r(S,w.idx.size),L=d(e,D,!1,c),A=o(l,x,w,f,n,s,C,D,v,L.colorByCategory,a,t.tooltipsEnabled),V=_.reduce(A,function(e,t){return e.concat(t.dataPoints)},[]);m=C?I.buildSeriesLegendData({dataView:e,style:t.style,showByDefault:!0,simpleMarkerProp:H.bubbles.markerShape}):I.getDefaultLegendData(),h&&null!==h.showAxisTitle&&h.showAxisTitle===!1&&(w.axesLabels.x=null),p&&null!==p.showAxisTitle&&p.showAxisTitle===!1&&(w.axesLabels.y=null),u&&(u.applySelectionStateToData(V),u.applySelectionStateToData(m.dataPoints));var M=l.data.hasCategories();return{xCol:w.cols.x,yCol:w.cols.y,hasCategory:M,hasSize:!!w.cols.size,dataPoints:V,dataPointSeries:A,legendData:m,axesLabels:w.axesLabels,size:w.cols.size,sizeRange:P,dataLabelsSettings:D,hasDynamicSeries:C,fillPoint:L.fillPoint,colorBorder:L.colorBorder,colorByCategory:L.colorByCategory,multiplier:L.bubbleSizeMultiplier,xSubtotal:i&&i[O.x],ySubtotal:i&&i[O.y],plotAreaShadingSettings:L.plotAreaShadingSettings,ratioLineSettings:L.ratioLineSettings,markerShape:L.markerShape,dataVolume:L.dataVolume}}function i(e,t,a){if(e&&e.matrix&&(0!==_.size(e.matrix.valueSources)||0!==_.size(e.matrix.rows.levels))){var i=t.interactivityService,r=F.getDefaultPointLabelSettings(t.style),o=d(e,r,!0,t.style),s=m(e,o),l={min:Number.MAX_VALUE,max:Number.MIN_VALUE},c=s.cols.size;c&&c.aggregates&&(l={min:c.aggregates.minLocal||c.aggregates.min,max:c.aggregates.maxLocal||c.aggregates.max});for(var u=e.matrix.valueSources,h=[],p=0;p<u.length;p++)L.hasRole(u[p],"Tooltips")&&h.push(p);var g,y={colorHelper:D.create(t.style,H.dataPoint.fill,o.defaultDataPointColor,o.fill),metadata:s,hasDynamicSeries:L.hasRoleInDataView(e,"Series"),tooltipsEnabled:t.tooltipsEnabled,sizeRange:l,dataLabelSettings:r,playFrameInfo:a,tooltipValuesIndices:h,gradientIndex:_.findIndex(u,function(e){return L.hasRole(e,"Gradient")}),objProps:o},v=n(e,y),f=_.reduce(v.series,function(e,t){return e.concat(t.dataPoints)},[]);if(y.hasDynamicSeries){var x={dataView:e,colorHelper:y.colorHelper,style:t.style,formatStringProp:null,showByDefault:!0,markerShapePropIdentifier:H.bubbles.markerShape},C=y.metadata.xGroupMetadata;g=C&&C.isCategoricalAxis?I.buildFromFirstMatrixColumnLevel(x):I.buildFromFirstMatrixRowLevel(x)}else g=I.getDefaultLegendData(t.style);i&&(i.applySelectionStateToData(f),i.applySelectionStateToData(g.dataPoints));var S=!!(s.xGroupMetadata||s.yGroupMetadata||s.categoryLevel);return{xCol:s.cols.x,yCol:s.cols.y,hasCategory:S,hasSize:!!s.cols.size,dataPoints:f,dataPointSeries:v.series,legendData:g,axesLabels:s.axesLabels,size:s.cols.size,sizeRange:l,dataLabelsSettings:r,hasDynamicSeries:y.hasDynamicSeries,fillPoint:o.fillPoint,colorBorder:o.colorBorder,colorByCategory:o.colorByCategory,multiplier:o.bubbleSizeMultiplier,xSubtotal:v.xSubtotal,ySubtotal:v.ySubtotal,plotAreaShadingSettings:o.plotAreaShadingSettings,ratioLineSettings:o.ratioLineSettings,markerShape:o.markerShape,dataVolume:o.dataVolume,xGroupMetadata:s.xGroupMetadata,yGroupMetadata:s.yGroupMetadata,treatNullsAsZero:s.treatNullsAsZero}}}function r(e,t){var a={};return e&&e.forEach(function(e){var i=N.getMeasureValue(t,e.values),r=C.getRangeForColumn(i);(null==a.min||a.min>r.min)&&(a.min=r.min),(null==a.max||a.max<r.max)&&(a.max=r.max)}),a}function o(e,t,a,i,r,o,n,s,l,c,u,h){var d=e.data.hasValues("X"),p=e.data.hasValues("Y");if(!d&&!p)return[];for(var g=[],y=a.idx,m=H.general.formatString,f=t.source,S=t.grouped(),b=_.isEmpty(i)?null:i[0],D=e.objects.getStaticObjects(),P=V.getValue(D,H.bubbles.markerShape,x.markerShape.circle),L=v(a),A=0,k=S.length;A<k;A++){var F=S[A],I=F.values,B=N.getMeasureValue(_.first(y.x),I),U=N.getMeasureValue(y.y,I),z=N.getMeasureValue(y.size,I),G=void 0;n&&(G=e.colors.createBySeries(A,void 0,M));var W=void 0;W=e.data.hasSeries()&&V.getValue(D,H.bubbles.showSeries)?V.getValue(e.objects.getSeriesDataObjects(A),H.bubbles.markerShape,P):P;var j=e.identities.createForSeries(A,[O.size]),X={identityKey:F&&F.identity&&F.identity.key||"",dataPoints:[],hasSize:!(!z||!z.values),fill:G,identity:j,markerShape:W,name:n?E.format(e.data.getSeriesName(A),e.objects.getSeriesFormatString()):void 0};g.push(X);for(var Y=function(a,g){var y=r[a],v=d?C.normalizeNonFiniteNumber(e.data.getValue("X",a,A)):0,x=p?C.normalizeNonFiniteNumber(e.data.getValue("Y",a,A)):0,S=C.normalizeNonFiniteNumber(e.data.getValue("Size",a,A));if(null==v||null==x)return"continue";var D=void 0;D=c&&!n?e.colors.createByCategory(a,M):e.colors.createBySeries(A,a,M);var P=R.builder().withCategory(b,a).withSeries(t,F).withMeasures(L),V=void 0;u&&(V=P.clone(),P.withColumnIdentity(u.identity,u.column.queryName));var k=P.createSelectionId(),I=V?V.createSelectionId():k,H=new w(e.columns);if(h){var O=T.defaultFormatter(m),E=T.fallbackBasedOnType(m);H.withColumnValueByIndex(b,a,!0,O),n&&H.withColumnValue(f,F.name,!0,O),H.withColumnValueByIndex(B,a,!1,E).withColumnValueByIndex(U,a,!1,E).withColumnValueByIndex(z,a,!1,E).withColumnValueByIndex(l,a,!1,E),u&&H.withValue(u.column.displayName,u.label),H.withAllValuesForRole("Tooltips",a,A,!1,E)}var _={x:v,y:x,size:S,radius:{sizeMeasure:z,index:a},fill:D,formattedCategory:N.createLazyFormattedCategory(o,null!=i?y:F.name),selected:!1,identity:k,renderIdentity:I,tooltipInfo:function(){return H.getTooltipItems()},labelFill:s.fontProperties.color,markerShape:W,categoryIndex:a,seriesIndex:A};X.dataPoints.push(_)},q=0,K=r.length;q<K;q++)Y(q,K)}return g}function n(e,t){var a=[],i=[],r=e.matrix;if(!r.rows.root||0===_.size(r.rows.root.children))return{series:a};var o,n=t.metadata,u=n.seriesLevel,d=n.categoryLevel,p=n.seriesNode,g=n.idx.size!==-1?r.valueSources[n.idx.size]:void 0;if(p){for(var y=0;y<p.children.length;y++){var m=p.children[y];if(!m.isSubtotal){var f=t.colorHelper.getColorForSeriesValue(m.objects,p.childIdentityFields,m.value,M),x=(new R).withColumnIdentity(m.identity,u.sources[0].queryName).createSelectionId(),C=void 0;C=t.objProps.markerShapeShowAllSeries?powerbi.DataViewObjects.getValue(m.objects,H.bubbles.markerShape,t.objProps.markerShape):t.objProps.markerShape;var S=E.format(m.value,powerbi.DataViewObjects.getValue(u.sources[0].objects,H.general.formatString)),b={identityKey:m.identity&&m.identity.key||"",dataPoints:[],hasSize:!!g,fill:f,identity:x,markerShape:C,name:S};a.push(b);var w={currentSeries:m,currentSeriesColor:f,seriesShape:C,seriesIndex:y};if(b.dataPoints=l(e,w,t,i),!d&&0===_.size(b.dataPoints)){var D=u.sources[0],P=c(void 0,D),L={category:m,categoryMetadataColumns:[D],categoryIdentityFields:m.childIdentityFields,currentSeries:m,currentSeriesMetadata:D,currentSeriesColor:f,categoryFormatter:P,valueColumnIds:v(t.metadata),seriesShape:C,currentSeriesIndex:y},A=h(e,L,t,i);A&&b.dataPoints.push(A)}}}var V=e.matrix.rows.root.children,T=_.find(V,function(e){return e.isSubtotal});T&&(o=s(n,T))}else if(d){var k=null!=g?g.queryName:"",f=t.colorHelper.getColorForMeasure(null,k,M),b={identityKey:"",dataPoints:[],hasSize:!!g,fill:f,markerShape:t.objProps.markerShape};a.push(b);var w={currentSeries:r.rows.root,currentSeriesColor:f,seriesShape:t.objProps.markerShape};b.dataPoints=l(e,w,t,i);var V=e.matrix.rows.root.children,T=_.find(V,function(e){return e.isSubtotal});T&&(o=s(t.metadata,T))}else{var k=null!=g?g.queryName:"",f=t.colorHelper.getColorForMeasure(null,k,M),F={identityKey:"",dataPoints:[],hasSize:!!g,fill:f};a.push(F);var w={currentSeries:r.rows.root,currentSeriesColor:f,seriesShape:t.objProps.markerShape};F.dataPoints=l(e,w,t,i);var I=t.metadata;I.xGroupMetadata||I.yGroupMetadata||(o=s(I,e.matrix.rows.root.children[0]))}return{series:a,xSubtotal:o&&o.xSubtotal,ySubtotal:o&&o.ySubtotal}}function s(e,t){var a,i=e.idx.x,r=e.idx.y,o=_.first(i);o!==-1&&(a=C.normalizeNonFiniteNumber(t.values[o].value));var n;return r!==-1&&(n=C.normalizeNonFiniteNumber(t.values[r].value)),{xSubtotal:a,ySubtotal:n}}function l(e,t,a,i){var r=[],o=t.currentSeries,n=a.metadata.seriesLevel?a.metadata.seriesLevel.sources[0]:void 0,s=v(a.metadata),l=u(e,t,a);if(_.isEmpty(l.categories))return r;for(var c=0,d=l.categories;c<d.length;c++){var p=d[c],g={category:p,categoryMetadataColumns:l.categoryMetadataColumns,categoryIdentityFields:o.childIdentityFields,currentSeries:o,currentSeriesMetadata:n,currentSeriesColor:t.currentSeriesColor,categoryFormatter:l.formatter,valueColumnIds:s,seriesShape:t.seriesShape,currentSeriesIndex:t.seriesIndex},y=h(e,g,a,i);y&&r.push(y)}return r}function c(e,t){var a;if(e){var i=e.levelValues;a=E.create({format:E.getFormatString(t,H.general.formatString),value:i[0],value2:i[_.size(e.values)-1],columnType:null})}else a=E.createDefaultFormatter(null);return a}function u(e,t,a){var i,r,o=a.metadata.seriesLevel?a.metadata.seriesLevel.sources[0]:void 0,n=t.currentSeries,s=E.createDefaultFormatter(null);if(a.metadata.xGroupMetadata&&a.metadata.xGroupMetadata.isCategoricalAxis){var l=e.matrix.rows;i=l.root.children,r=l.levels[0].sources,s=c(i[0],r[0])}else n.children?(i=n.children,r=e.matrix.rows.levels.length>0?e.matrix.rows.levels[i[0].level].sources:void 0,o&&(s=c(i[0],r[0]))):o&&L.hasRole(o,"Category")&&(i=[n],r=[o],s=c(i[0],r[0]));return{categories:i,categoryMetadataColumns:r,formatter:s}}function h(e,t,a,i){if(!t.category.isSubtotal){var r=a.metadata,o=e.matrix,n=r.idx.x,s=r.idx.y,l=r.idx.size,c=_.size(o.valueSources),u=r.xGroupMetadata,h=r.yGroupMetadata,d=_.first(n),p=0;u||d===-1||(p=C.normalizeNonFiniteNumber(t.category.values[d].value),p=r.treatNullsAsZero&&r.treatNullsAsZero.x&&null==p?0:p);var g=null==p?null:[p];u&&(g=_.map(n,function(e){return t.category.levelValues[e].value}));var y=0,v=r.xGroupMetadata&&r.xGroupMetadata.isCategoricalAxis;if(h||s===-1)h&&(y=t.category.levelValues[s].value);else{var m=v&&null!=t.currentSeriesIndex?t.currentSeriesIndex*c+s:s;y=C.normalizeNonFiniteNumber(t.category.values[m].value),y=r.treatNullsAsZero&&r.treatNullsAsZero.y&&null==y?0:y}if(null!=g&&null!=y){var f;if(l!==-1){var m=null!=t.currentSeriesIndex&&v?t.currentSeriesIndex*c+l:l;f=C.normalizeNonFiniteNumber(t.category.values[m].value)}var x,S=R.builder();if(!_.isEmpty(t.categoryMetadataColumns))for(var b=0,D=t.categoryMetadataColumns;b<D.length;b++){var P=D[b];S.withColumnIdentity(t.category.identity,P.queryName)}if(t.currentSeriesMetadata&&!_.some(t.categoryMetadataColumns,function(e){return e===t.currentSeriesMetadata})&&S.withColumnIdentity(t.currentSeries.identity,t.currentSeriesMetadata.queryName),_.isEmpty(t.valueColumnIds)||S.withMeasures(t.valueColumnIds),a.playFrameInfo){var L=a.playFrameInfo;x=S.clone(),S.withColumnIdentity(L.identity,L.column.queryName)}var V=S.createSelectionId(),k=x?x.createSelectionId():V,F=a.sizeRange;F.min>f&&(F.min=f),F.max<f&&(F.max=f);var I;if(a.hasDynamicSeries)I=t.currentSeriesColor;else if(a.objProps.colorByCategory)I=a.colorHelper.getColorForSeriesValue(t.category.objects,t.categoryIdentityFields,t.category.value,M);else{var O=null!=a.metadata.cols.size?a.metadata.cols.size.queryName:"";I=a.colorHelper.getColorForMeasure(t.category.objects,O,M)}var B=H.general.formatString,E=T.defaultFormatter(B),U=function(){var e=t.category.levelValues,a=t.currentSeries.value;if(e){a=_.size(e)>1?A.concatenateValues(_.map(e,function(e,a){return E(e.value,t.categoryMetadataColumns[a])})):e[0].value}return a},z=new w((void 0));if(a.tooltipsEnabled){var G=T.fallbackBasedOnType(B),W=t.category.levelValues,j=_.size(t.categoryMetadataColumns)>1;u||h||(j?z.withMultipleColumnAndValues(t.categoryMetadataColumns,_.map(W,function(e){return e.value}),!0,E):W&&z.withColumnValue(_.head(t.categoryMetadataColumns),W[0].value,!0,E)),a.hasDynamicSeries&&z.withColumnValue(t.currentSeriesMetadata,t.currentSeries.value,!0,E),u&&a.metadata.xGroupMetadata.isCategoricalAxis?z.withMultipleColumnAndValues(t.categoryMetadataColumns,g,!0,E):z.withColumnValue(r.cols.x,g[0],!1,G),z.withColumnValue(r.cols.y,y,!1,G).withColumnValue(r.cols.size,f,!1,G);var X=a.gradientIndex,Y=o.valueSources;X>=0&&z.withColumnValue(Y[X],t.category.values[X].value,!1,G);var L=a.playFrameInfo;L&&z.withValue(L.column.displayName,L.label);for(var q=0,K=a.tooltipValuesIndices;q<K.length;q++){var m=K[q];z.withColumnValue(Y[m],t.category.values[m].value,!1,G)}}var Z,$=_.size(g)>1?g.join(" "):g[0];if(v)Z=$;else{var W=t.category.levelValues;Z=_.isEmpty(W)?"":W[0].value}var J=_.findIndex(i,function(e){return e===Z});J===-1&&(J=i.length,i.push(Z));return{x:$,y:y,size:f,radius:{sizeMeasure:null,index:-1,value:f},fill:I,formattedCategory:N.createLazyFormattedLazyValue(t.categoryFormatter,function(){return U()}),selected:!1,identity:V,renderIdentity:k,tooltipInfo:function(){return z.getTooltipItems()},labelFill:a.dataLabelSettings.fontProperties.color,markerShape:t.seriesShape,categoryIndex:J,seriesIndex:t.currentSeriesIndex||0}}}}function d(e,t,a,i){var r={};e&&e.metadata&&e.metadata.objects&&(r=e.metadata.objects);var o={};o.defaultDataPointColor=powerbi.DataViewObjects.getFillColor(r,P.dataPoint.defaultColor),o.fill=powerbi.DataViewObjects.getFillColor(r,P.dataPoint.fill);var n=r.categoryLabels;n&&t&&F.updateLabelSettingsFromLabelsObject(n,t,void 0,i);var s=!1;s=a?e&&k.hasGradientRoleInMatrix(e.matrix):e&&k.hasGradientRole(e.categorical),o.fillPoint=powerbi.DataViewObjects.getValue(r,H.fillPoint.show,s),o.colorBorder=powerbi.DataViewObjects.getValue(r,H.colorBorder.show,!1),o.colorByCategory=powerbi.DataViewObjects.getValue(r,H.colorByCategory.show,!1),o.bubbleSizeMultiplier=B.getBubbleSizeMultiplier(powerbi.DataViewObjects.getValue(r,H.bubbles.bubbleSize)),o.markerShape=powerbi.DataViewObjects.getValue(r,H.bubbles.markerShape,x.markerShape.circle),o.markerShapeShowAllSeries=V.getValue(r,H.bubbles.showSeries);var l=D.create(i);o.plotAreaShadingSettings={show:powerbi.DataViewObjects.getValue(r,H.plotAreaShading.show,N.DefaultPlotAreaShadingSettings.show),upperShadingColor:p(l,r,H.plotAreaShading.upperShadingColor,N.DefaultPlotAreaShadingSettings.upperShadingColor),lowerShadingColor:p(l,r,H.plotAreaShading.lowerShadingColor,N.DefaultPlotAreaShadingSettings.lowerShadingColor),transparency:powerbi.DataViewObjects.getValue(r,H.plotAreaShading.transparency,N.DefaultPlotAreaShadingSettings.transparency)};var c=b.getDefaultScatterRatioLineSettings(i);return o.ratioLineSettings={show:powerbi.DataViewObjects.getValue(r,H.ratioLine.show,c.show),lineColor:p(l,r,H.ratioLine.lineColor,c.lineColor),transparency:powerbi.DataViewObjects.getValue(r,H.ratioLine.transparency,c.transparency),style:powerbi.DataViewObjects.getValue(r,H.ratioLine.style,c.style)},o.dataVolume=powerbi.DataViewObjects.getValue(r,H.general.dataVolume,N.DefaultDataVolume),o.categoryAxisType=powerbi.DataViewObjects.getValue(r,S.categoryAxis.axisType),o.xValuesTreatNullsAsZero=powerbi.DataViewObjects.getValue(r,H.categoryAxis.treatNullsAsZero,!1),o.yValuesTreatNullsAsZero=powerbi.DataViewObjects.getValue(r,H.valueAxis.treatNullsAsZero,!1),o}function p(e,t,a,i){return{solid:{color:e.getColorForPropertyWithDefaultColor(t,a,i?i.solid.color:void 0)}}}function g(e,t){var a,i,r,o=L.getMeasureIndexOfRole(e,"X"),n=L.getMeasureIndexOfRole(e,"Y"),s=L.getMeasureIndexOfRole(e,"Size"),l="",c="";if(e&&e.length){var u=e[0];o>=0&&(a=u.values[o].source,l=u.values[o].source.displayName),n>=0&&(i=u.values[n].source,c=u.values[n].source.displayName),s>=0&&(r=u.values[s].source)}return{idx:{x:[o],y:n,size:s},cols:{x:a,y:i,size:r},axesLabels:{x:l,y:c}}}function y(e,t){for(var a=0,i=e.levels.length;a<i;a++){var r=e.levels[a],o=_.chain(r.sources).map(function(e,t){return{levelSource:e,index:t}}).filter(function(e){return L.hasRole(e.levelSource,t)}).map(function(e){return e.index}).value();if(!_.isEmpty(o))return{levelIndex:a,levelSourceIndices:o,column:r.sources[_.first(o)]}}}function v(e){var t=[],a=e.cols;return!e.xGroupMetadata&&a.x&&t.push(a.x.queryName),!e.yGroupMetadata&&a.y&&t.push(a.y.queryName),a.size&&t.push(a.size.queryName),t}function m(e,t){var a,i,r,o=e.matrix,n=o.valueSources,s=!1,l=!1,c=[_.findIndex(n,function(e){return L.hasRole(e,"X")})],u=_.findIndex(n,function(e){return L.hasRole(e,"Y")}),h=_.findIndex(n,function(e){return L.hasRole(e,"Size")}),d="",p="";if(c[0]>=0)a=n[c[0]],d=a.displayName;else{var g=y(o.rows,O.x);g&&(a=g.column,c=g.levelSourceIndices,d=a.displayName,s=!0)}if(u>=0)i=n[u],p=i.displayName;else{var g=y(o.rows,O.y);g&&(i=g.column,u=g.levelSourceIndices[0],p=i.displayName,l=!0)}h>=0&&(r=n[h]);var v,m=_.find(o.rows.levels,function(e){return!_.isEmpty(e.sources)&&L.hasRole(e.sources[0],O.series)});m?v=o.rows.root:(m=_.find(o.columns.levels,function(e){return!_.isEmpty(e.sources)&&L.hasRole(e.sources[0],O.series)}),m&&(v=o.columns.root));var f=!1,x=!1;if(a){var C=a.type;f=_.size(c)<=1&&!(!C.integer&&!C.numeric),x=t.categoryAxisType===powerbi.visuals.axisType.categorical||!f}var S;return S=s?_.find(o.rows.levels,function(e){return L.hasRole(e.sources[0],O.x)}):l?_.find(o.rows.levels,function(e){return L.hasRole(e.sources[0],O.y)}):_.find(o.rows.levels,function(e){return L.hasRole(e.sources[0],O.category)}),{idx:{x:c,y:u,size:h},cols:{x:a,y:i,size:r},axesLabels:{x:d,y:p},xGroupMetadata:s?{isCategoricalAxis:x,isScalarType:f}:void 0,yGroupMetadata:l?{isCategoricalAxis:!1,isScalarType:!0}:void 0,seriesLevel:m,seriesNode:v,categoryLevel:S,treatNullsAsZero:{x:t.xValuesTreatNullsAsZero,y:t.yValuesTreatNullsAsZero}}}var f=powerbi.data,x=powerbi.visuals,C=x.AxisHelper,S=x.cartesianChartProps,b=powerbi.visuals.CartesianHelper,w=x.CategoricalLazyTooltipBuilder,D=powerbi.visuals.ColorHelper,P=x.columnChartProps,L=f.DataRoleHelper,A=x.DataViewConcatenateUtil,V=powerbi.DataViewObjects,M=x.ForegroundColorName,T=x.FormattingStrategies,k=x.GradientUtils,F=x.LabelUtils,I=x.Legend,N=x.ScatterChart,H=x.scatterChartProps,O=x.scatterRoleNames,R=x.SelectionIdBuilder,B=x.shapeUtil,E=x.valueFormatter;return{scatterConverter:function(e,a,i,r){return t(e,a,i,r)}}}),powerbi.define("PowerBIVisuals/visuals/scatter/scatterChart.render",function(e){function t(e,t){if(t)for(var a in e)e[a]===t[a]&&(e[a]=null);
}function a(e,t){for(var a in t){var i=e.style[a],r=t[a];if(null==r){if(""===i)continue}else if(r=r.toString(),r===i)continue;e.style[a]=r}}var i=powerbi.visuals,r=i.CartesianHelper,o=jsCommon.CssConstants.createClassAndSelector,n=powerbi.visuals.DataDirection,s=i.LineStyle,l=i.PlayChart,c=i.ScatterChart,u=powerbi.visuals.SetFocusRingClassName,h=i.SVGUtil,d=o("scatterMarker"),p=o("mainGraphicsContext"),g=o("scatterMarkerSeriesGroup"),y=o("plotAreaShadingLayer"),v=o("upperShadingArea"),m=o("lowerShadingArea"),f=o("ratioLineLayer"),x=o("ratioLine"),C=function(){function e(){}return e.prototype.init=function(e,t,a,i,r,o,n){this.axisGraphicsContext=e,this.mainGraphicsG=e.append("g").classed(p.class,!0),this.isMobileChart=a,a&&(this.mainGraphicsBackgroundRect=this.mainGraphicsG.append("rect").classed("backgroundRect",!0).attr({width:"100%",height:"100%"})),this.mainGraphicsContext=this.mainGraphicsG.append("svg"),this.labelGraphicsContext=t,this.tooltipsEnabled=i,this.tooltipService=r;var s=jsCommon.BrowserUtils.isInternetExplorerOrEdge();this.mainGraphicsContext.attr("stroke-width","1").classed(u,!s&&o),o&&this.mainGraphicsContext.attr("tabindex",0).attr("aria-label",n.getLocalizedString("Visual_Plot"))},e.prototype.markersHaveChanged=function(e){var t=_.map(e.data.dataPointSeries,function(e){return e.markerShape}),a=this.previousMarkers;if(!a)return this.previousMarkers=t,!1;for(var i=0,r=Math.min(t.length,a.length);i<r;i++)if(t[i]!==a[i])return this.previousMarkers=t,!0;return this.previousMarkers=t,!1},e.prototype.render=function(e,t,a){var i=e.plotArea,r=jsCommon.BrowserUtils.isInternetExplorerOrEdge();this.mainGraphicsContext.attr({width:i.width,height:i.height}).classed(u,!r&&t),this.drawRatioLine(e,a),this.drawShadedBackground(e);var o;return o=e.suppressDataPointRendering?this.removeScatterMarkers():e.animationDuration>0&&!this.markersHaveChanged(e)?this.drawScatterMarkers(e,t):this.drawScatterMarkersNoAnimation(e,e.drawBubbles,t),e.drawBubbles&&o.order(),this.tooltipsEnabled&&this.tooltipService.addTooltip(this.mainGraphicsContext,function(e){return e.data&&e.data.tooltipInfo()},function(e){return e.data&&e.data.identity}),h.flushAllD3TransitionsIfNeeded(e.animationOptions),this.numSeries=e.data.dataPointSeries.length,{dataPointsSelection:o,eventGroup:this.mainGraphicsG,data:e.data,plotContext:this.mainGraphicsContext}},e.prototype.getNextDataPoint=function(e,t,a){var i,r,o,s,l=this.mainGraphicsContext.selectAll(d.selector),c=l.data().map(function(e){return{categoryIndex:e.categoryIndex,seriesIndex:e.seriesIndex}}),u=e,h=t;switch(a){case n.PreviousCategory:case n.NextCategory:s=a===n.PreviousCategory?-1:1,o=_.sortBy(_.filter(c,function(e){return e.seriesIndex===t}),"categoryIndex");var p=s+_.findIndex(o,function(t){return t.categoryIndex===e});p>=o.length||p<0?(i=this.rollToNextSeries(c,t,a),u=i[0],h=i[1]):u=o[p].categoryIndex;break;case n.PreviousSeries:case n.NextSeries:s=a===n.PreviousSeries?-1:1,o=_.sortBy(_.filter(c,function(t){return t.categoryIndex===e}),"seriesIndex");var g=s+_.findIndex(o,function(e){return e.seriesIndex===t});g>=o.length||g<0?(r=this.rollToNextCategory(c,e,a),u=r[0],h=r[1]):h=o[g].seriesIndex}return{element:l.filter(function(e,t){return e.seriesIndex===h&&e.categoryIndex===u}).node()}},e.prototype.rollToNextSeries=function(e,t,a){var i=a===n.PreviousCategory?-1:1,r=a===n.PreviousCategory?_.last:_.first;return t+=i,t>=this.numSeries?t=0:t<0&&(t=this.numSeries-1),[r(_.sortBy(_.filter(e,function(e){return e.seriesIndex===t}),"categoryIndex")).categoryIndex,t]},e.prototype.rollToNextCategory=function(e,t,a){var i=d3.max(e,function(e){return e.categoryIndex})+1,r=a===n.PreviousSeries?-1:1,o=a===n.PreviousSeries?_.last:_.first;return t+=r,t>=i?t=0:t<0&&(t=i-1),[t,o(_.sortBy(_.filter(e,function(e){return e.categoryIndex===t}),"seriesIndex")).seriesIndex]},e.prototype.getFirstElement=function(){return this.mainGraphicsContext.selectAll(d.selector).filter(function(e){return 0===e.categoryIndex&&0===e.seriesIndex}).node()},e.prototype.createTraceLineRenderer=function(e){return new w(e,this.mainGraphicsContext,this.tooltipsEnabled,this.tooltipService)},e.prototype.drawShadedBackground=function(e){var t=e.data.plotAreaShadingSettings||c.DefaultPlotAreaShadingSettings,a=this.axisGraphicsContext.select(y.selector);if(!t.show)return void(a.empty()||a.remove());a.empty()&&(a=this.axisGraphicsContext.insert("svg",":first-child").classed(y.class,!0).style("pointer-events","none")),a.attr({height:e.plotArea.height,width:e.plotArea.width});var i=e.xAxisProperties.scale,r=e.yAxisProperties.scale,o=i.domain(),n=r.domain(),s=[Math.min(o[0],n[0]),Math.max(o[1],n[1])],l=[{x:i(s[0]),y:r(s[0])},{x:i(s[1]),y:r(s[1])}],u=t.show?[[{x:l[0].x,y:l[0].y},{x:l[0].x,y:l[1].y}],[{x:l[1].x,y:l[1].y},{x:l[1].x,y:l[1].y}]]:[];this.drawArea(v,a,u,t.upperShadingColor,t.transparency);var h=t.show?[[{x:l[0].x,y:l[0].y},{x:l[0].x,y:l[0].y}],[{x:l[1].x,y:l[0].y},{x:l[1].x,y:l[1].y}]]:[];this.drawArea(m,a,h,t.lowerShadingColor,t.transparency)},e.prototype.drawRatioLine=function(e,t){var a=e.data.ratioLineSettings||r.getDefaultScatterRatioLineSettings(t),i=this.axisGraphicsContext.select(f.selector);if(!a.show)return void(i.empty()||i.remove());i.empty()&&(i=this.axisGraphicsContext.append("svg").classed(f.class,!0)),i.attr({height:e.plotArea.height,width:e.plotArea.width});var o=e.xAxisProperties.scale,n=e.yAxisProperties.scale,s=o.domain(),l=n.domain(),c=e.data.xSubtotal,u=e.data.ySubtotal,h=[];if(a.show&&_.isFinite(c)&&_.isFinite(u))if(0!==c&&0!==u){var d=u/c;h=[{x:o(s[0]),y:n(s[0]*d)},{x:o(s[1]),y:n(s[1]*d)}]}else 0!==u?h=[{x:o(0),y:n(l[0])},{x:o(0),y:n(l[1])}]:0!==c&&(h=[{x:o(s[0]),y:n(0)},{x:o(s[1]),y:n(0)}]);this.drawLine(x,i,h,a)},e.prototype.removeScatterMarkers=function(){return this.mainGraphicsContext.selectAll(g.selector).remove(),this.mainGraphicsContext.selectAll(d.selector)},e.prototype.getXOfFirstCategory=function(e){var t=e.data.xGroupMetadata;if(t&&t.isCategoricalAxis){var a=e.xAxisProperties.scale;if(a.rangeBand)return a.rangeBand()/2}return 0},e.prototype.drawScatterMarkers=function(e,t){var a=e.data,i=e.xAxisProperties.scale,o=e.yAxisProperties.scale,n=a.xGroupMetadata&&a.xGroupMetadata.isCategoricalAxis,s=this.getXOfFirstCategory(e),l=[{identityKey:"",dataPoints:a.dataPoints}],p=this.mainGraphicsContext.selectAll(g.selector).data(l,function(e){return e.identityKey});p.enter().append("g").classed(g.class,!0),p.exit().remove();var y=p.selectAll(d.selector).data(function(e){return e.dataPoints},function(e){return e.renderIdentity.getKey()}),v=jsCommon.BrowserUtils.isInternetExplorerOrEdge();return y.enter().append("path").classed(d.class,!0).classed(u,!v&&t).style("opacity",0).attr({transform:function(e){return h.translate(i(n?e.categoryIndex:e.x)+s,o(e.y))},tabindex:t?0:null}),y.style({"stroke-opacity":function(t){return c.getMarkerStrokeOpacity(null!=t.size,a.colorBorder,e.hasSelection,t.selected)},stroke:function(e){return c.getStrokeFill(e,a.colorBorder)},fill:function(e){return e.fill},"fill-opacity":function(t){return c.getMarkerFillOpacity(null!=t.size,e.fillMarkers,e.hasSelection,t.selected)}}).transition().ease(e.easeType).duration(e.animationDuration).style("opacity",1).attr({d:function(t){return powerbi.visuals.Markers.getPathWithRadius(t.markerShape,r.getBubbleRadius(t.radius,a.sizeRange,e.plotArea,a.multiplier))},transform:function(e){return h.translate(i(n?e.categoryIndex:e.x)+s,o(e.y))}}),y.exit().transition().ease(e.easeType).duration(e.animationDuration).style("opacity",0).attr("r",0).remove(),y},e.prototype.drawScatterMarkersNoAnimation=function(e,i,o){var n,s=e.data,l=e.xAxisProperties.scale,p=e.yAxisProperties.scale,y=s.xGroupMetadata&&s.xGroupMetadata.isCategoricalAxis,v=this.getXOfFirstCategory(e);if(i){var m=[{identityKey:"",dataPoints:s.dataPoints}];n=this.mainGraphicsContext.selectAll(g.selector).data(m,function(e){return e.identityKey})}else n=this.mainGraphicsContext.selectAll(g.selector).data(s.dataPointSeries,function(e){return e.identityKey});return n.enter().append("g").classed(g.class,!0),n.exit().remove(),n.each(function(i){var n=c.getSeriesStyle(i.hasSize,s.colorBorder,e.hasSelection,e.fillMarkers,i.fill),g=d3.select(this);a(this,n);var m=g.selectAll(d.selector).data(i.dataPoints,function(e){return e.renderIdentity.getKey()});m.interrupt(),m.enter().append("path").classed(d.class,!0),m.exit().remove(),m.each(function(i){var r=c.getMarkerStyle(i,s.colorBorder,e.hasSelection,e.fillMarkers);t(r,n),a(this,r)});var f=jsCommon.BrowserUtils.isInternetExplorerOrEdge();m.classed(u,!f&&o).attr({d:function(t){return powerbi.visuals.Markers.getPathWithRadius(t.markerShape,r.getBubbleRadius(t.radius,s.sizeRange,e.plotArea,s.multiplier))},transform:function(e){return h.translate(l(y?e.categoryIndex:e.x)+v,p(e.y))},tabindex:o?0:null}).style("opacity",null)}),this.mainGraphicsContext.selectAll(d.selector)},e.prototype.drawLine=function(e,t,a,i){var r={};r.stroke=i.lineColor.solid.color,r["stroke-width"]=2,r["stroke-opacity"]=(100-i.transparency)/100,r["stroke-dasharray"]=s.getStrokeDashArrayFromLineStyle(i.style),r["stroke-linecap"]=s.getStrokeLineCapFromLineStyle(i.style),r.fill="none",r["stroke-width"]="3px";var o=d3.svg.line().x(function(e){return e.x}).y(function(e){return e.y}),n=t.selectAll(e.selector).data([a]);return n.enter().append("path").classed(e.class,!0),n.attr("d",function(e){return o(e)}).style(r),n.exit().remove(),t},e.prototype.drawArea=function(e,t,a,i,r){var o=d3.svg.area().x0(function(e){return e[0].x}).y0(function(e){return e[0].y}).x1(function(e){return e[1].x}).y1(function(e){return e[1].y}),n=t.selectAll(e.selector).data([a]);n.enter().append("path").classed(e.class,!0),n.attr("d",function(e){return o(e)}).style({fill:i.solid.color,"fill-opacity":(100-r)/100}),n.exit().remove()},e}(),S=o("traceLine"),b=o("traceBubble"),w=function(){function e(e,t,a,i){this.viewModel=e,this.element=t,this.tooltipsEnabled=a,this.tooltipService=i}return e.prototype.remove=function(){this.element.selectAll(S.selector).remove(),this.element.selectAll(b.selector).remove()},e.prototype.render=function(e,t){var a=this.viewModel,i=a.data.currentViewModel,o=a.viewModel,n=[];if(_.isEmpty(e)||o.suppressDataPointRendering)this.remove();else{for(var s=a.data.currentFrameIndex,u=[],h=0,d=e.length;h<d;h++){n[h]=[],u[h]=!1;for(var p=0,g=a.data.allViewModels.length;p<g&&p<=s;p++){var y=_.find(a.data.allViewModels[p].dataPoints,function(t,a){var i=e[h],r=i;return r.renderIdentity?t.renderIdentity.getKey()===r.renderIdentity.getKey():t.identity.getKey()===e[h].identity.getKey()});null!=y&&(y.frameIndex=p,n[h].push(y),p===s&&(u[h]=!0))}}var v=o.xAxisProperties.scale,m=o.yAxisProperties.scale,f=d3.svg.line().x(function(e){return v(e.x)}).y(function(e){return m(e.y)}).defined(function(e){return null!==e.x&&null!==e.y}),x=this.element.selectAll(S.selector).data(e,function(e){return e.renderIdentity.getKey()});x.enter().append("path").classed(S.class,!0);var C=[],w=[],D=!1;x.each(function(e,t){var a=this,i=a.hasAttribute("d")?a.getTotalLength():0;C.push(i);var r=$("<svg><path></path></svg>"),o=$("path",r);o.attr("d",f(n[t]));var s=n[t].length>0?o.get()[0].getTotalLength():0;w.push(s),D=D||s<i}),D?t?x.transition().ease("linear").duration(l.FrameAnimationDuration).attr("stroke-dashoffset",function(e,t){return C[t]-w[t]}).transition().ease("linear").duration(1).delay(l.FrameAnimationDuration).style("stroke",function(e){return c.getStrokeFill(e,!0)}).attr({d:function(e,t){return f(n[t])},"stroke-dasharray":function(e,t){return w[t]+" "+w[t]},"stroke-dashoffset":0}):x.style("stroke",function(e){return c.getStrokeFill(e,!0)}).attr({d:function(e,t){return f(n[t])},"stroke-dasharray":function(e,t){return w[t]+" "+w[t]},"stroke-dashoffset":0}):(x.style("stroke",function(e){return c.getStrokeFill(e,!0)}).attr({d:function(e,t){return f(n[t])},"stroke-dasharray":function(e,t){return w[t]+" "+w[t]},"stroke-dashoffset":function(e,t){return w[t]-C[t]}}),t?x.transition().ease("linear").duration(l.FrameAnimationDuration).attr("stroke-dashoffset",0):x.attr("stroke-dashoffset",0)),x.exit().remove();for(var P=[],L=0;L<n.length;L++){var A=n[L],V=u[L]?A.slice(0,A.length-1):A;P=P.concat(V)}var M=this.element.selectAll(b.selector).data(P,function(e){return e.renderIdentity.getKey()+e.x+e.y+e.size});M.enter().append("circle").style("opacity",0).classed(b.class,!0),M.attr("cx",function(e){return v(e.x)}).attr("cy",function(e){return m(e.y)}).attr("r",function(e){return r.getBubbleRadius(e.radius,i.sizeRange,o.plotArea,i.multiplier)}).style({"stroke-opacity":function(e){return c.getBubbleOpacity(e,!0)},stroke:function(e){return c.getStrokeFill(e,i.colorBorder)},fill:function(e){return e.fill},"fill-opacity":function(e){return null!=e.size?.2+e.frameIndex/s*.6:0}}).transition().ease("linear").duration(l.FrameAnimationDuration).style("opacity",1),M.exit().transition().ease("linear").duration(l.FrameAnimationDuration).style("opacity",0).remove(),this.tooltipsEnabled&&this.tooltipService.addTooltip(M,function(e){return e.data&&e.data.tooltipInfo()},function(e){return e.data&&e.data.identity}),M.sort(function(e,t){return t.size-e.size})}},e}();return{create:function(){return new C}}});var powerbi;!function(e){var t;!function(t){var a=jsCommon.Color,i=function(){function i(t){t&&(this.tooltipsEnabled=t.tooltipsEnabled,this.interactivityService=t.interactivityService,this.animator=t.animator,this.scatterWithMatrixDV=t.featureSwitches.scatterWithMatrixDV,this.viewModelAdapter=t.viewModelAdapter,this.isScrollable=t.isScrollable),this.renderer=e.requireSync("PowerBIVisuals/visuals/scatter/scatterChart.render").create()}return i.prototype.init=function(e){this.options=e,this.element=e.element,this.currentViewport=e.viewport,this.style=e.style,this.colors=this.style.colorPalette.dataColors,this.hostService=e.host,this.cartesianVisualHost=e.cartesianHost,this.isMobileChart=e.interactivity&&e.interactivity.isInteractiveLegend,this.tooltipService=e.services.tooltips;var a=this.svg=e.svg;a.classed(i.ClassName+" "+t.PlayChart.ClassName,!0),this.renderer.init(a,e.labelsContext,this.isMobileChart,this.tooltipsEnabled,this.tooltipService,this.interactivityService,this.hostService),i.DefaultPlotAreaShadingSettings.upperShadingColor={solid:{color:t.ColorHelper.getDataColorByIndex(this.style,3)}},i.DefaultPlotAreaShadingSettings.lowerShadingColor={solid:{color:t.ColorHelper.getDataColorByIndex(this.style,5)}}},i.createLazyFormattedCategory=function(e,t){return new jsCommon.Lazy(function(){return e.format(t)})},i.createLazyFormattedLazyValue=function(e,t){return new jsCommon.Lazy(function(){return e.format(t())})},i.getMeasureValue=function(e,t){return e>=0?t[e]:null},i.getDefaultData=function(e){return{xCol:void 0,yCol:void 0,hasCategory:void 0,dataPoints:[],dataPointSeries:[],legendData:t.Legend.getDefaultLegendData(e),axesLabels:{x:"",y:""},sizeRange:{min:void 0,max:void 0},dataLabelsSettings:t.LabelUtils.getDefaultPointLabelSettings(e),hasDynamicSeries:!1,plotAreaShadingSettings:i.DefaultPlotAreaShadingSettings,ratioLineSettings:t.CartesianHelper.getDefaultScatterRatioLineSettings(e),markerShape:t.markerShape.circle,dataVolume:i.DefaultDataVolume,multiplier:t.shapeUtil.MinBubbleMultiplier}},i.prototype.renderAtFrame=function(e){this.data=this.originalData=e,this.viewModelAdapter&&this.originalData&&(this.data=this.viewModelAdapter.applyChanges(this.currentViewport,this.originalData,this.dataView)),this.cartesianVisualHost.triggerRender(!1)},i.prototype.setData=function(a){var r=this;if(this.data=i.getDefaultData(this.style),this.playAxis&&this.playAxis.isCurrentlyPlaying()&&this.playAxis.stop(),a.length>0){var o=a[0]||a[1];if(o){this.categoryAxisProperties=t.CartesianHelper.getCategoryAxisProperties(o.metadata,!0),this.valueAxisProperties=t.CartesianHelper.getValueAxisProperties(o.metadata,!0),this.dataView=o;var n={viewport:this.currentViewport,colors:this.colors,interactivityService:this.interactivityService,categoryAxisProperties:this.categoryAxisProperties,valueAxisProperties:this.valueAxisProperties,style:this.style,tooltipsEnabled:this.tooltipsEnabled,useMatrixDV:this.scatterWithMatrixDV},s=e.requireSync("PowerBIVisuals/visuals/scatter/scatterChart.converter");if(t.PlayChart.isDataViewPlayable(o)){this.playAxis||(this.playAxis=new t.PlayAxis({animator:this.animator,interactivityService:this.interactivityService,isScrollable:!1,featureSwitches:{}}),this.playAxis.init(this.options)),n.useMatrixDV=!1;var l=this.playAxis.setData(o,function(e,t,a){return s.scatterConverter(e,n,t,a)});this.mergeSizeRanges(l),this.data=l.currentViewModel,this.playAxis.setRenderFunction(function(e){return r.renderAtFrame(e)})}else{this.playAxis&&(this.playAxis.remove(),this.playAxis=null);var c=s.scatterConverter(o,n);c&&(this.data=c)}}}else this.playAxis&&(this.playAxis.remove(),this.playAxis=null);this.originalData=this.data},i.prototype.mergeSizeRanges=function(e){if(e&&e.currentViewModel){for(var t=e.currentViewModel.sizeRange,a=0,i=e.allViewModels;a<i.length;a++){var r=i[a],o=r.sizeRange;null!=o.min&&(t.min=Math.min(t.min,o.min)),null!=o.max&&(t.max=Math.max(t.max,o.max))}for(var n=0,s=e.allViewModels;n<s.length;n++){s[n].sizeRange=t}}},i.prototype.calculateLegend=function(){return this.data&&this.data.legendData},i.prototype.calculateCustomLegend=function(){return this.data&&this.data.legendData},i.prototype.hasLegend=function(){return this.data&&this.data.hasDynamicSeries},i.prototype.enumerateObjectInstances=function(e,a){var r=this.originalData;switch(a.objectName){case"colorByCategory":r&&(r.hasDynamicSeries||e.pushInstance({objectName:"colorByCategory",selector:null,properties:{show:r.colorByCategory}}));break;case"dataPoint":if(!this.playAxis&&this.dataView&&(this.scatterWithMatrixDV&&!t.GradientUtils.hasGradientRoleInMatrix(this.dataView.matrix)||!this.scatterWithMatrixDV&&!t.GradientUtils.hasGradientRole(this.dataView.categorical)))return this.enumerateDataPoints(e);break;case"categoryAxis":e.pushInstance({selector:null,properties:{showAxisTitle:!this.categoryAxisProperties||null==this.categoryAxisProperties.showAxisTitle||this.categoryAxisProperties.showAxisTitle},objectName:"categoryAxis"}),r.xGroupMetadata||e.pushInstance({selector:null,properties:{treatNullsAsZero:!(!r.treatNullsAsZero||!r.treatNullsAsZero.x)},objectName:"categoryAxis"});break;case"valueAxis":e.pushInstance({selector:null,properties:{showAxisTitle:!this.valueAxisProperties||null==this.valueAxisProperties.showAxisTitle||this.valueAxisProperties.showAxisTitle},objectName:"valueAxis"}),r.yGroupMetadata||e.pushInstance({selector:null,properties:{treatNullsAsZero:!(!r.treatNullsAsZero||!r.treatNullsAsZero.y)},objectName:"valueAxis"});break;case"categoryLabels":if(this.data&&this.data.xGroupMetadata&&this.data.xGroupMetadata.isCategoricalAxis)return;this.data?t.LabelUtils.enumerateCategoryLabels(e,r.dataLabelsSettings,!0,void 0,void 0,this.style):t.LabelUtils.enumerateCategoryLabels(e,null,!0,void 0,void 0,this.style);break;case"fillPoint":if(r.hasSize)return;e.pushInstance({objectName:"fillPoint",selector:null,properties:{show:r.fillPoint}});break;case"colorBorder":r.hasSize&&e.pushInstance({objectName:"colorBorder",selector:null,properties:{show:r.colorBorder}});break;case"bubbles":i.enumerateBubbles(e,r,this.dataView);break;case"plotAreaShading":this.isCategoryAxisCategorical()||e.pushInstance({selector:null,objectName:"plotAreaShading",properties:{show:r.plotAreaShadingSettings.show,upperShadingColor:r.plotAreaShadingSettings.upperShadingColor,lowerShadingColor:r.plotAreaShadingSettings.lowerShadingColor,transparency:r.plotAreaShadingSettings.transparency}});break;case"ratioLine":r.xCol&&r.yCol&&r.xCol.isMeasure&&r.yCol.isMeasure&&e.pushInstance({selector:null,objectName:"ratioLine",properties:{show:r.ratioLineSettings.show,lineColor:r.ratioLineSettings.lineColor,transparency:r.ratioLineSettings.transparency,style:r.ratioLineSettings.style}});break;case"general":!r||this.playAxis||this.isCategoryAxisCategorical()||e.pushInstance({selector:null,objectName:"general",properties:{dataVolume:r.dataVolume},validValues:{dataVolume:{numberRange:{min:i.DefaultDataVolume,max:i.MaximumDataVolume}}}})}},i.prototype.enumerateDataPoints=function(a){var i=this.originalData;i&&(i.hasDynamicSeries?e.requireSync("PowerBIVisuals/Visuals/common/colorEnumerationHelper").enumerateSeriesDataColors({enumeration:a,dataPoints:t.LegendData.toIEnumerableDataPoints(i.legendData)}):e.requireSync("PowerBIVisuals/Visuals/common/colorEnumerationHelper").enumerateCategoryDataColors({enumeration:a,dataView:this.dataView,style:this.style,dataPoints:_.map(i.dataPoints,function(e){return{color:e.fill,displayName:e.formattedCategory.getValue(),identity:e.identity}}),fillInstanceKind:3}))},i.enumerateBubbles=function(a,i,r){var o;i.dataPointSeries.length>1&&(o=e.DataViewObjects.getValue(r&&r.metadata&&r.metadata.objects,t.scatterChartProps.bubbles.showSeries,!1));var n={selector:null,properties:{bubbleSize:t.shapeUtil.invertBubbleSizeMultiplier(i.multiplier),markerShape:i.markerShape},validValues:{markerShape:[t.markerShape.circle,t.markerShape.square,t.markerShape.diamond,t.markerShape.triangle]},objectName:t.scatterChartProps.bubbles.markerShape.objectName};if(null!=o&&(n.properties[t.scatterChartProps.bubbles.showSeries.propertyName]=o),a.pushInstance(n),o)for(var s=0,l=i.dataPointSeries.length;s<l;s++){var c=i.dataPointSeries[s];a.pushContainer({displayName:c.name}),a.pushInstance({selector:e.data.Selector.normalizeSelector(c.identity.getSelector()),properties:{markerShape:c.markerShape},validValues:{markerShape:[t.markerShape.circle,t.markerShape.square,t.markerShape.diamond,t.markerShape.triangle]},objectName:t.scatterChartProps.bubbles.markerShape.objectName}),a.popContainer()}},i.prototype.supportsTrendLine=function(){var t=this.data;if(!t||this.isCategoryAxisCategorical()||this.playAxis)return!1;var a=this.dataView;if(this.scatterWithMatrixDV)return!t.hasSize&&(t.hasCategory||t.hasDynamicSeries)&&!!t.xCol&&!!t.yCol;var i=e.data.createDataViewCategoricalReader(a);return!t.hasSize&&(t.hasCategory||t.hasDynamicSeries)&&i.data.hasValues("X")&&i.data.hasValues("Y")},i.prototype.supportsStaticReferenceLines=function(){return this.data&&!this.isCategoryAxisCategorical()},i.prototype.getAxisLocationForRole=function(e){return"X"===e?0:1},i.getExtents=function(e){var t={},a=e.dataPoints;if(_.isEmpty(a))return{minY:0,maxY:0,minX:0,maxX:0};var i=!!e.xGroupMetadata,r=i&&e.xGroupMetadata.isCategoricalAxis;return r||(t.minX=d3.min(a,function(e){return e.x}),t.maxX=d3.max(a,function(e){return e.x})),i&&!r&&(a=_.filter(a,function(e){return null!=e.x})),t.minY=d3.min(a,function(e){return e.y}),t.maxY=d3.max(a,function(e){return e.y}),t},i.prototype.calculateAxesProperties=function(e){var a=this.currentViewport=e.viewport;this.viewModelAdapter&&this.originalData&&(this.data=this.viewModelAdapter.applyChanges(this.currentViewport,this.originalData,this.dataView));var r=this.data,o=e.margin;this.currentViewport=a,this.margin=o;var n=a.width-(o.left+o.right),s=a.height-(o.top+o.bottom),l={minY:0,maxY:10,minX:0,maxX:10};this.playAxis?(l=this.playAxis.getCartesianExtents(l,i.getExtents),this.playAxis.setPlayControlPosition(e.playAxisControlLayout)):_.isEmpty(r.dataPoints)||(l=i.getExtents(r));var c,u=this.isCategoryAxisCategorical();c=u?_.uniq(_.map(r.dataPoints,function(e){return e.categoryIndex})):t.AxisHelper.combineDomain(e.forcedXDomain,[l.minX,l.maxX],e.ensureXDomain);var h={pixelSpan:n,dataDomain:c,zeroScalarDomain:[-1,1],metaDataColumn:r.xCol,formatString:t.valueFormatter.getFormatString(r.xCol,t.scatterChartProps.general.formatString),outerPadding:0,isScalar:!u,isVertical:!1,forcedTickCount:e.forcedTickCount,useTickIntervalForDisplayUnits:!0,isCategoryAxis:u,scaleType:e.categoryAxisScaleType,axisDisplayUnits:e.categoryAxisDisplayUnits,axisPrecision:e.categoryAxisPrecision,margin:o,preventNice:e.preventNiceX};if(u){var d=this.getCategoryLayout(c,e);h.outerPadding=d.outerPaddingRatio,h.categoryThickness=d.categoryThickness,h.innerPaddingRatio=d.innerPaddingRatio,h.outerPaddingRatio=d.outerPaddingRatio,h.getValueFn=function(e,t){return _.find(r.dataPoints,function(t){return t.categoryIndex===e}).formattedCategory.getValue()}}this.xAxisProperties=t.AxisHelper.createAxis(h),this.xAxisProperties.axis.tickSize(-s,0),this.xAxisProperties.axisLabel=this.data.axesLabels.x;var p=t.AxisHelper.combineDomain(e.forcedYDomain,[l.minY,l.maxY],e.ensureYDomain);return this.yAxisProperties=t.AxisHelper.createAxis({pixelSpan:s,dataDomain:p,zeroScalarDomain:[-1,1],metaDataColumn:r.yCol,formatString:t.valueFormatter.getFormatString(r.yCol,t.scatterChartProps.general.formatString),outerPadding:0,isScalar:!0,isVertical:!0,forcedTickCount:e.forcedTickCount,useTickIntervalForDisplayUnits:!0,isCategoryAxis:!1,scaleType:e.valueAxisScaleType,axisDisplayUnits:e.valueAxisDisplayUnits,axisPrecision:e.valueAxisPrecision,margin:o,preventNice:e.preventNiceY}),this.yAxisProperties.axisLabel=this.data.axesLabels.y,[this.xAxisProperties,this.yAxisProperties]},i.prototype.getCategoryLayout=function(e,a){var i=this.data,r=this.currentViewport.width-(this.margin.left+this.margin.right),o=_.size(_.uniqBy(i.dataPoints,function(e){return e.categoryIndex})),n=t.CartesianHelper.getCategoryAxisProperties(this.dataView.metadata),s=t.CartesianHelper.getPreferredCategoryWidth(n),l=this.isCategoryAxisCategorical();return t.CartesianChart.getLayout(void 0,{availableWidth:r,categoryCount:o,preferredCategoryWidth:s,domain:e,isScalar:!l,isScrollable:this.isScrollable,trimOrdinalDataOnOverflow:a.trimOrdinalDataOnOverflow,outerPaddingRatio:a.outerPaddingRatio,innerPaddingRatio:a.innerPaddingRatio})},i.prototype.getPreferredPlotArea=function(e,a,i,r){return void 0===r&&(r=0),t.CartesianChart.getPreferredPlotArea(a,i,this.currentViewport,this.isScrollable,e,this.margin,r)},i.prototype.setFilteredData=function(t,a){if(this.isCategoryAxisCategorical()){var i=this.data=e.Prototype.inherit(this.originalData);i.dataPoints=_.filter(i.dataPoints,function(e){return e.categoryIndex>=t&&e.categoryIndex<a}),i.dataPointSeries=_.map(i.dataPointSeries,function(i){var r=e.Prototype.inherit(i),o=_.filter(i.dataPoints,function(e){return e.categoryIndex>=t&&e.categoryIndex<a});return r.dataPoints=o,r})}},i.prototype.overrideXScale=function(e){this.xAxisProperties=e},i.prototype.shouldSuppressAnimation=function(){return this.data&&this.data.dataPoints&&this.data.dataPoints.length>i.NoAnimationThreshold},i.prototype.categoryAxisTitleOnByDefault=function(){return!0},i.prototype.valueAxisTitleOnByDefault=function(){return!0},i.prototype.render=function(a,o){if(this.data){var n=this.data,s=this.margin,l=this.currentViewport,c=this.interactivityService&&this.interactivityService.hasSelection(),u={width:l.width-(s.left+s.right),height:l.height-(s.top+s.bottom)},h=t.AnimatorCommon.GetAnimationDuration(this.animator,a);this.playAxis&&this.playAxis.isCurrentlyPlaying()&&(this.isMobileChart||h>0)&&(h=t.PlayChart.FrameAnimationDuration);var d=this.playAxis?"linear":"cubic-in-out",p=this.data.hasSize,g=!p&&n.fillPoint,y=1===o&&n.dataPoints&&n.dataPoints.length>i.NoRenderResizeThreshold,v={data:n,drawBubbles:p,isPlay:!!this.playAxis,xAxisProperties:this.xAxisProperties,yAxisProperties:this.yAxisProperties,plotArea:u,hasSelection:c,animationDuration:h,animationOptions:this.options.animation,fillMarkers:g,easeType:d,suppressDataPointRendering:y};if(p&&(!n.xGroupMetadata||!n.xGroupMetadata.isCategoricalAxis)){var m=n.dataPoints.sort(i.sortBubbles);v.data=e.Prototype.inherit(v.data),v.data.dataPoints=m}var f=[];(n.dataLabelsSettings&&n.dataLabelsSettings.show||n.dataLabelsSettings.showCategory)&&(f=r.createLabelDataPoints(v,this.style));var x=this.renderer.render(v,this.interactivityService,this.style);this.isMobileChart&&(x={data:x.data,dataPointsSelection:x.dataPointsSelection,eventGroup:x.eventGroup,plotContext:x.plotContext,host:this.cartesianVisualHost,root:this.svg,visualInitOptions:this.options,xAxisProperties:this.xAxisProperties,yAxisProperties:this.yAxisProperties,background:d3.select(this.element.get(0))});var C;if(this.playAxis&&(C=this.playAxis.render(a,v,l,s),this.interactivityService)){var S={traceLineRenderer:this.renderer.createTraceLineRenderer(C.viewModel)};c&&t.PlayChart.renderTraceLines(C.allDataPoints,S.traceLineRenderer,!a),x.playOptions=S}var b;if(!this.playAxis&&this.interactivityService){var w=t.DataPointNavigationStrategy.SeriesFirst;n.xGroupMetadata&&n.xGroupMetadata.isCategoricalAxis?w=t.DataPointNavigationStrategy.CategoryFirst:this.data.hasDynamicSeries||(w=t.DataPointNavigationStrategy.CategoryOnly),b={navigationStrategy:w,helper:this.renderer}}return{dataPoints:C?C.allDataPoints:n.dataPoints,behaviorOptions:x,navigationOptions:b,labelDataPoints:f,labelsAreNumeric:!1,animateLabels:!0}}},i.getStrokeFill=function(e,t){if(null!=e.size&&t){var r=a.parseColorString(e.fill);return r?a.hexString(a.darken(r,i.StrokeDarkenColorValue)):e.fill}return e.fill},i.getMarkerFillOpacity=function(e,t,a,r){return e||t?a&&!r?i.DimmedBubbleOpacity:i.DefaultBubbleOpacity:0},i.getMarkerStrokeOpacity=function(e,t,a,r){return e&&t?1:a&&!r?i.DimmedBubbleOpacity:i.DefaultBubbleOpacity},i.getMarkerStrokeFill=function(e,t,r){if(e&&t){var o=a.parseColorString(r);return o?a.hexString(a.darken(o,i.StrokeDarkenColorValue)):r}return r},i.getMarkerStyle=function(e,t,a,r){return{"stroke-opacity":i.getMarkerStrokeOpacity(null!=e.size,t,a,e.selected),stroke:i.getMarkerStrokeFill(null!=e.size,t,e.fill),fill:e.fill,"fill-opacity":i.getMarkerFillOpacity(null!=e.size,r,a,e.selected)}},i.getSeriesStyle=function(e,t,a,r,o){return{"stroke-opacity":i.getMarkerStrokeOpacity(e,t,a,!1),stroke:i.getMarkerStrokeFill(e,t,o),fill:o,"fill-opacity":i.getMarkerFillOpacity(e,r,a,!1)}},i.getBubbleOpacity=function(e,t){return t&&!e.selected?i.DimmedBubbleOpacity:i.DefaultBubbleOpacity},i.prototype.onClearSelection=function(){this.interactivityService&&this.interactivityService.clearSelection()},i.prototype.getSupportedCategoryAxisType=function(){return this.data.xGroupMetadata?this.data.xGroupMetadata.isScalarType?t.axisType.both:t.axisType.categorical:t.axisType.scalar},i.prototype.getVisualCategoryAxisIsScalar=function(){return!this.isCategoryAxisCategorical()},i.sortBubbles=function(e,t){if(e.radius.sizeMeasure){var a=t.radius.sizeMeasure.values[t.radius.index]-e.radius.sizeMeasure.values[e.radius.index];if(0!==a)return a}else if(null!=e.radius.value)return t.radius.value-e.radius.value;return t.identity.getKey().localeCompare(e.identity.getKey())},i.prototype.getCartesianVisualCapabilities=function(){return{supportsHierarchicalCategoryAxis:!1}},i.prototype.getStaticSeriesRole=function(){},i.prototype.addWarnings=function(e){this.viewModelAdapter&&this.viewModelAdapter.addWarnings(e,this.originalData,this.data)},i.prototype.isCategoryAxisCategorical=function(){return this.data.xGroupMetadata&&this.data.xGroupMetadata.isCategoricalAxis},i.DefaultBubbleOpacity=.85,i.DimmedBubbleOpacity=.4,i.StrokeDarkenColorValue=63.75,i.ClassName="scatterChart",i.NoAnimationThreshold=1e3,i.NoRenderResizeThreshold=1e3,i.DefaultDataVolume=3500,i.MaximumDataVolume=1e4,i.DefaultPlotAreaShadingSettings={show:!1,upperShadingColor:null,lowerShadingColor:null,transparency:70},i}();t.ScatterChart=i;var r;!function(a){function i(a,i){for(var o=a.xAxisProperties.scale,n=a.yAxisProperties.scale,s=a.data.sizeRange,l=a.data.multiplier,h=[],d=a.data.dataPoints,p=a.data.dataLabelsSettings,g=r(a),y=0,v=d;y<v.length;y++){var m=v[y],f=m.formattedCategory.getValue(),x=p?p.fontProperties:t.LabelUtils.defaultFontProperties,C=t.FontProperties.toTextProperties(x,f),S=e.TextMeasurementService.measureSvgTextWidth(C),b=e.TextMeasurementService.estimateSvgTextHeight(C);h.push({isPreferred:!!g&&c(m.identity.getKey(),g),text:f,textSize:{width:S,height:b},outsideFill:x.color?x.color:t.ColorHelper.getThemeColor(i,t.LabelUtils.DefaultLabelColorName),insideFill:t.ColorHelper.getThemeColor(i,t.LabelUtils.DefaultInsideLabelColorName),
parentType:0,parentShape:{point:{x:o(m.x),y:n(m.y)},radius:t.CartesianHelper.getBubbleRadius(m.radius,s,a.plotArea,l),validPositions:u},identity:m.renderIdentity,fontProperties:x,hasBackground:p.enableBackground,backgroundColor:p.backgroundColor,backgroundTransparency:p.backgroundTransparency})}return h}function r(e){var a=e.plotArea.width,i=e.plotArea.height;return n(new t.Point(a/2,i/2),o(a,i),e)}function o(e,a){var i=[],r=e/4,o=a/4;return i.push(new t.Point(r,o)),i.push(new t.Point(3*r,o)),i.push(new t.Point(r,3*o)),i.push(new t.Point(3*r,3*o)),i}function n(e,t,a){for(var i,r=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],o=[],n=a.xAxisProperties.scale,c=a.yAxisProperties.scale,u=0,h=a.data.dataPoints;u<h.length;u++){var d=h[u],p=n(d.x),g=c(d.y),y=s(p,g,e);a.drawBubbles?o[y]||(o[y]=d.identity):(i=l(t[y].x,t[y].y,p,g),i<r[y]&&(o[y]=d.identity,r[y]=i))}for(var v=[],m=0,f=o;m<f.length;m++){var x=f[m];x&&v.push(x.getKey())}return v}function s(e,t,a){return e>a.x&&t<=a.y?0:e<=a.x&&t<=a.y?1:e<=a.x&&t>a.y?2:3}function l(e,t,a,i){return Math.sqrt((e-a)*(e-a)+(t-i)*(t-i))}function c(e,t){for(var a=0,i=t;a<i.length;a++){var r=i[a];if(0===e.localeCompare(r))return!0}return!1}var u=[2,1,8,4,16,32,64,128];a.createLabelDataPoints=i}(r||(r={}));var o=function(){function t(e){this.dataPoints=e}return t.prototype.queryRegion=function(t){return _.filter(this.dataPoints,function(a){return e.Double.lessOrEqualWithPrecision(t.left,a.x)&&e.Double.lessOrEqualWithPrecision(a.x,t.right)&&e.Double.lessOrEqualWithPrecision(t.bottom,a.y)&&e.Double.lessOrEqualWithPrecision(a.y,t.top)})},t}();t.ScatterChartHitTester=o}(t=e.visuals||(e.visuals={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(e){var t=jsCommon.CssConstants.createClassAndSelector,a=jsCommon.PerfTimer,i=function(){function t(){}return t.prototype.bindEvents=function(t,a,i){var r=this.bubbles=t.dataPointsSelection,o=t.data,n=t.eventGroup;if(!this.playOptions||!this.playOptions.traceLineRenderer||t.playOptions&&t.playOptions.traceLineRenderer||this.playOptions.traceLineRenderer.remove(),this.playOptions=t.playOptions,this.shouldEnableFill=!o.size&&o.fillPoint,this.colorBorder=o.colorBorder,this.hitTester=new e.ScatterChartHitTester(t.data.dataPoints),this.selectionHandler=a,n?e.InteractivityUtils.registerGroupInteractivityHandlers(n,a):e.InteractivityUtils.registerStandardInteractivityHandlers(r,a),i&&!i.isEmpty()){var s=t.plotContext;e.InteractivityUtils.registerEnterPlotAreaHandler(s,i),e.InteractivityUtils.registerDataPointNavigationHandler(s,i),e.InteractivityUtils.registerClearCatcherShortcut(s,a)}},t.prototype.renderSelection=function(t){var a=this.shouldEnableFill,i=this.colorBorder;if(this.bubbles.style({"fill-opacity":function(i){return e.ScatterChart.getMarkerFillOpacity(null!=i.size,a,t,i.selected)},"stroke-opacity":function(a){return e.ScatterChart.getMarkerStrokeOpacity(null!=a.size,i,t,a.selected)}}),this.playOptions&&this.bubbles){var r=this.bubbles.filter(function(e){return e.selected}).data(),o=this.playOptions.traceLineRenderer;r&&r.length>0&&null!=o?o.render(r,!0):o.remove()}},t.prototype.renderFocus=function(t){if(t){this.bubbles.attr("aria-label",null);var a=d3.select(t).datum();a&&t.setAttribute("aria-label",e.tooltipUtils.formatTooltipInfo(a.tooltipInfo())),t.focus()}},t.prototype.lassoSelect=function(e,t){var a=this.hitTester.queryRegion(t),i=0;e.ctrlKey?i=1:e.altKey?i=3:e.shiftKey&&(i=2),this.selectionHandler.handleMultipleSelection(a,i)},t}();e.ScatterChartWebBehavior=i;var r=function(){function i(){}return i.prototype.bindEvents=function(e,t){this.setOptions(e),e.visualInitOptions&&e.visualInitOptions.interactivity.isInteractiveLegend&&(this.makeDataPointsSelectable(e.dataPointsSelection),this.makeRootSelectable(e.root),this.makeDragable(e.root),this.disableDefaultTouchInteractions(e.root),this.selectRoot())},i.prototype.renderSelection=function(e){},i.prototype.setSelectionHandler=function(e){},i.prototype.makeDataPointsSelectable=function(){for(var e=this,t=[],a=0;a<arguments.length;a++)t[a]=arguments[a];for(var i=0,r=t.length;i<r;i++){t[i].on("click",function(t,a){e.select(a)})}},i.prototype.makeRootSelectable=function(e){var t=this;e.on("click",function(e,a){t.selectRoot()})},i.prototype.makeDragable=function(){for(var e=this,t=[],a=0;a<arguments.length;a++)t[a]=arguments[a];for(var i=0,r=t.length;i<r;i++){var o=t[i],n=d3.behavior.drag().on("drag",function(t){e.drag(0)}).on("dragend",function(t){e.drag(1)});o.call(n)}},i.prototype.disableDefaultTouchInteractions=function(e){e.style("touch-action","none")},i.prototype.setOptions=function(e){this.data=e.data,this.mainGraphicsContext=e.plotContext,this.xAxisProperties=e.xAxisProperties,this.yAxisProperties=e.yAxisProperties,this.host=e.host},i.prototype.select=function(e){this.selectDotByIndex(e)},i.prototype.selectRoot=function(){var e=a.start("selectRoot");this.onClick(),e()},i.prototype.drag=function(e){switch(e){case 0:this.onDrag();break;case 1:this.onClick()}},i.prototype.onDrag=function(){var e=this.getMouseCoordinates();this.moveCrosshairToXY(e.x,e.y);var t=this.findClosestDotIndex(e.x,e.y);this.selectDot(t),this.updateLegend(t)},i.prototype.onClick=function(){var e=this.getMouseCoordinates(),t=this.findClosestDotIndex(e.x,e.y);t!==-1&&this.selectDotByIndex(t)},i.prototype.getMouseCoordinates=function(){var e=this.mainGraphicsContext,t=0,a=parseInt(e.attr("height"),10);a=a||0;try{var i=d3.mouse(e.node());t=i[0],a=i[1]}catch(e){}return{x:t,y:a}},i.prototype.selectDotByIndex=function(e){this.selectDot(e),this.moveCrosshairToIndexDot(e),this.updateLegend(e)},i.prototype.selectDot=function(e){var t=this,a=this.mainGraphicsContext;a.selectAll(i.ScatterMarker.selector).classed({selected:!1,notSelected:!0}),a.selectAll(i.ScatterMarker.selector).filter(function(a,i){var r=t.data.dataPoints,o=r[e];return a.x===o.x&&a.y===o.y}).classed({selected:!0,notSelected:!1})},i.prototype.moveCrosshairToIndexDot=function(e){var t=this.data.dataPoints,a=this.mainGraphicsContext,r=this.xAxisProperties.scale(t[e].x),o=this.yAxisProperties.scale(t[e].y);if(null==this.crosshair){var n=+a.attr("width"),s=+a.attr("height");this.crosshair=this.drawCrosshair(a,r,o,n,s),this.crosshairHorizontal=this.crosshair.select(i.Horizontal.selector),this.crosshairVertical=this.crosshair.select(i.Vertical.selector)}else this.moveCrosshairToXY(r,o)},i.prototype.moveCrosshairToXY=function(e,t){this.crosshairHorizontal.attr({y1:t,y2:t}),this.crosshairVertical.attr({x1:e,x2:e})},i.prototype.drawCrosshair=function(e,t,a,r,o){var n=e.append("g");return n.classed(i.CrosshairClassName,!0),n.append("line").classed(i.Horizontal.class,!0).attr({x1:0,x2:r,y1:a,y2:a}),n.append("line").classed(i.Vertical.class,!0).attr({x1:t,x2:t,y1:o,y2:0}),n},i.prototype.findClosestDotIndex=function(e,t){var a=-1,i=Number.MAX_VALUE,r=this.data.dataPoints,o=this.xAxisProperties.scale,n=this.yAxisProperties.scale;for(var s in r){var l=r[s],c=o(l.x),u=n(l.y),h=c-e,d=u-t,p=h*h+d*d;i===Number.MAX_VALUE?(a=s,i=p):i&&i>p&&(a=s,i=p)}return a},i.prototype.updateLegend=function(e){if(null==this.lastDotIndex||this.lastDotIndex!==e){var t=this.createLegendDataPoints(e);this.host.updateLegend(t),this.lastDotIndex=e}},i.prototype.createLegendDataPoints=function(t){var a=e.scatterChartProps.general.formatString,i=[],r=this.data,o=r.dataPoints[t],n=e.valueFormatter.format(null),s=n,l=r.legendData,c=l.dataPoints,u=o.formattedCategory.getValue();u!==n?(s=u,null!=o&&null!=o.radius&&null!=o.radius.sizeMeasure&&(s+="; "+e.valueFormatter.format(o.radius.sizeMeasure.source.groupName))):null!=o.radius.sizeMeasure?s=e.valueFormatter.format(o.radius.sizeMeasure.source.groupName):c.length>0&&c.length>=t&&c[t].label!==n&&(s=c[t].label),null!=r.xCol&&i.push({category:s,color:o.fill,identity:e.SelectionIdBuilder.builder().withMeasure(r.xCol.queryName).createSelectionId(),selected:o.selected,icon:e.LegendIcon.Box,label:e.valueFormatter.format(this.data.axesLabels.x),measure:e.valueFormatter.format(o.x,e.valueFormatter.getFormatString(r.xCol,a)),iconOnlyOnLabel:!0}),null!=r.yCol&&i.push({category:s,color:o.fill,identity:e.SelectionIdBuilder.builder().withMeasure(r.yCol.queryName).createSelectionId(),selected:o.selected,icon:e.LegendIcon.Box,label:e.valueFormatter.format(r.axesLabels.y),measure:e.valueFormatter.format(o.y,e.valueFormatter.getFormatString(r.yCol,a)),iconOnlyOnLabel:!0}),null!=r.size&&i.push({category:s,color:o.fill,identity:e.SelectionIdBuilder.builder().withMeasure(r.size.queryName).createSelectionId(),selected:o.selected,icon:e.LegendIcon.Box,label:e.valueFormatter.format(r.size.displayName),measure:e.valueFormatter.format(o.radius.sizeMeasure&&o.radius.sizeMeasure.values[o.radius.index]||o.radius.value,e.valueFormatter.getFormatString(r.size,a)),iconOnlyOnLabel:!0});var h=e.Legend.getDefaultLegendData();return h.dataPoints=i,h},i.CrosshairClassName="crosshair",i.ScatterMarker=t("scatterMarker"),i.Horizontal=t("horizontal"),i.Vertical=t("vertical"),i}();e.ScatterChartMobileBehavior=r}(t=e.visuals||(e.visuals={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(t){var a=jsCommon.CssConstants.createClassAndSelector,i=t.labelPosition,r=jsCommon.Lazy,o=jsCommon.StringExtensions,n=function(){function n(e){this.isScrollable=e.isScrollable,this.tooltipsEnabled=null==e.tooltipsEnabled||e.tooltipsEnabled,this.interactivityService=e.interactivityService,this.waterfallBreakdown=e.featureSwitches.waterfallBreakdown,this.viewModelAdapter=e.viewModelAdapter}return n.prototype.init=function(e){if(this.svg=e.svg,this.svg.classed(n.WaterfallClassName,!0),this.style=e.style,this.currentViewport=e.viewport,this.hostServices=e.host,this.interactivity=e.interactivity,this.cartesianVisualHost=e.cartesianHost,this.options=e,this.element=e.element,this.tooltipService=e.services.tooltips,this.colors=this.style.colorPalette.dataColors,this.mainGraphicsSVG=this.svg.append("svg"),this.mainGraphicsContext=this.mainGraphicsSVG.append("g").classed(n.MainGraphicsContextClassName,!0),this.labelGraphicsContext=this.mainGraphicsSVG.append("g").classed(t.LabelUtils.labelGraphicsContextClass.class,!0),this.interactivityService){var a=jsCommon.BrowserUtils.isInternetExplorerOrEdge();this.mainGraphicsContext.attr({tabindex:0,focusable:!0,"aria-label":this.hostServices.getLocalizedString("Visual_Plot")}).classed(t.SetFocusRingClassName,!a)}},n.converter=function(t){var a=t.dataView;if(a)return a.categorical?n.categoricalConverter(t):a.matrix?e.requireSync("PowerBIVisuals/visuals/converter/waterfall.converter").matrixConverter(t):void 0},n.categoricalConverter=function(a){var i,r,o=a.dataView,s=a.hostServices,l=a.dataLabelSettings,c=a.sentimentColors,u=a.interactivityService,h=a.tooltipsEnabled,d=e.data.createDataViewCategoricalReaderAdvanced(o),p=d.data,g=n.formatStringProp,y=o.categorical.categories||[],v=s.getLocalizedString(n.TotalLabel),m=n.createLegend(c,s,d.objects.getStaticObjects(),a.style),f={current:0,min:0,max:0},x=[],C=[],S=[];if(p.hasValues("Tooltips")&&(r=d.columns.getAllValueMetadataColumnsForRole("Tooltips",void 0)),p.hasValues("Y")){S=[d.columns.getValueMetadataColumn("Y")];var b=S[0].format;if(_.isEmpty(y)){var w=p.getValue("Y",0);f={current:w,max:w,min:0}}else{var D=y[0];i=D.source,C=D.values.slice(),C.push(v);for(var P=0,L=p.getCategoryCount();P<L;P++){var A=C[P],w=p.getValue("Y",P)||0,V=t.SelectionIdBuilder.builder().withCategory(D,P).withMeasure(S[0].queryName).createSelectionId(),M=void 0;if(h){M=n.createCategoryTooltip(i?[i]:null,S[0],[A],w,g);var T=p.getAllValuesForRole("Tooltips",P);T&&r&&n.appendTooltipMeasures(T,M,r,g,s)}x.push(n.createDataPoint(w,f.current,c,A,P,V,M,l.fontProperties.color,b,0)),f=n.getNewPositionContext(f,w)}}var k=void 0;h&&(k=n.createCategoryTooltip(i?[i]:null,S[0],[v],f.current,g));var F=t.SelectionId.createNull();x.push(n.createDataPoint(f.current,0,c,v,P,F,k,l.fontProperties.color,b,1,{text:!0}))}u&&u.applySelectionStateToData(x);var I;a.style.isHighContrast&&(I={visible:!0,color:t.ColorHelper.getThemeColor(a.style,t.ForegroundColorName),width:t.CartesianHelper.defaultLineStrokeWidth});var N=t.CartesianHelper.getCategoryAxisProperties(o.metadata,void 0),H=t.CartesianHelper.getPreferredCategoryWidth(N);return{series:[{data:x,type:!_.isEmpty(S)&&S[0].type}],categories:C,categoryMetadata:i,preferredCategoryWidth:H,valuesMetadata:S,legend:m,hasHighlights:!1,positionMin:f.min,positionMax:f.max,dataLabelsSettings:l,sentimentColors:c,strokeSettings:I}},n.createDataPoint=function(t,a,i,r,o,n,s,l,c,u,h){var d;return d=1===u||2===u?i.totalFill:3===u?i.otherFill:t>0?i.increaseFill:i.decreaseFill,{value:t,position:a,color:d.solid.color,categoryValue:r,categoryIndex:o,identity:n,seriesIndex:0,selected:!1,highlight:!1,key:n.getKey(),tooltipInfo:s&&function(){return s.getTooltipItems()},labelFill:l,labelFormatString:c,type:e.ValueType.fromDescriptor(h),barType:u}},n.createCategoryTooltip=function(e,a,i,o,n){var s=new t.LazyTooltipBuilder;return _.isEmpty(e)||s.withLazyValue(new r(function(){return{displayName:_.map(e,function(e){return e.displayName}).join(" "),value:_.map(i,function(a,i){return t.converterHelper.formatFromMetadataColumn(a,e[i],n)}).join(" ")}})),null!=o&&a&&s.withLazyValue(new r(function(){return{displayName:a.displayName,value:t.converterHelper.formatFromMetadataColumn(o,a,n,!1)}})),s},n.appendTooltipMeasures=function(e,a,i,s,l,c,u,h){if(!_.isEmpty(e)&&!_.isEmpty(i))for(var d=function(d){if(null!=e[d]&&i[d]){var p=i[d].displayName,g=t.converterHelper.formatFromMetadataColumn(e[d],i[d],s,!1);if(_.isEmpty(c))a.withLazyValue(new r(function(){return{displayName:p,value:g}}));else{var y=e[d],v=c[d];if(_.isNumber(y)&&_.isNumber(v))p=o.format(l.getLocalizedString("Waterfall_BreakdownDifferenceTooltip"),p),g=n.createPercentTooltipValue(g,y,v),a.withLazyValue(new r(function(){return{displayName:p,value:g}}));else{if(null!=v){var m=t.converterHelper.formatFromMetadataColumn(v,i[d],s,!1);a.withLazyValue(new r(function(){return{displayName:h+" "+p,value:m}}))}null!=y&&a.withLazyValue(new r(function(){return{displayName:u+" "+p,value:g}}))}}}},p=0;p<e.length;p++)d(p)},n.createPercentTooltipValue=function(e,a,i){if(!i)return e;var r=a/Math.abs(i),o=t.valueFormatter.getLocalizedString("Percentage");return e+" ("+t.valueFormatter.format(r,o)+")"},n.createLegend=function(e,a,i,r,o){var s=e.increaseFill.solid.color,l=e.decreaseFill.solid.color,c=e.totalFill.solid.color,u=e.otherFill.solid.color,h=a.getLocalizedString(n.TotalLabel),d=a.getLocalizedString(n.IncreaseLabel),p=a.getLocalizedString(n.DecreaseLabel),g=a.getLocalizedString(n.OtherLabel),y=[{label:d,color:s,icon:t.LegendIcon.Box,identity:t.SelectionIdBuilder.builder().withMeasure("increase").createSelectionId(),selected:!1},{label:p,color:l,icon:t.LegendIcon.Box,identity:t.SelectionIdBuilder.builder().withMeasure("decrease").createSelectionId(),selected:!1},{label:h,color:c,icon:t.LegendIcon.Box,identity:t.SelectionIdBuilder.builder().withMeasure("total").createSelectionId(),selected:!1}];return o&&y.splice(2,0,{label:g,color:u,icon:t.LegendIcon.Box,identity:t.SelectionIdBuilder.builder().withMeasure("other").createSelectionId(),selected:!1}),t.LegendData.create(i,y,!0,"",!1,r)},n.getNewPositionContext=function(e,t){var a=e.current+t;return{current:a,min:Math.min(e.min,a),max:Math.max(e.max,a)}},n.getDefaultWaterfallLabelSettings=function(e,a,i,r){return void 0===a&&(a=!1),{show:a,labelOrientation:1,position:t.labelPosition.auto,displayUnits:0,precision:t.dataLabelUtils.defaultLabelPrecision,fontProperties:t.FontProperties.inherit(t.LabelUtils.defaultFontProperties,{size:r?t.Units.FontSize.createFromPt(r):void 0,color:i||t.ColorHelper.getThemeColor(e,t.LabelUtils.DefaultLabelColorName)}),enableBackground:!1}},n.doesDataLabelFitInShape=function(a,i,r){if(null==a||null===a.value)return!1;var o={text:r.labelText(a),fontFamily:t.dataLabelUtils.LabelTextProperties.fontFamily,fontSize:t.dataLabelUtils.LabelTextProperties.fontSize,fontWeight:t.dataLabelUtils.LabelTextProperties.fontWeight};if(t.CartesianHelper.getRectTop(i.scale,a.position,a.value)-t.dataLabelUtils.labelMargin>0)return!0;var n=e.TextMeasurementService.measureSvgTextWidth(o),s=e.TextMeasurementService.estimateSvgTextHeight(o),l=r.categoryWidth,c=Math.abs(t.AxisHelper.diffScaled(i.scale,Math.max(0,Math.abs(a.value)),0));return!(n>l||s>c)},n.prototype.setData=function(a){var i=this.getSentimentColorsFromObjects(null),r=n.DefaultBreakdowns,o=a.length>0?a[0]:void 0;if(this.data=this.originalData={series:[{data:[]}],categories:[],valuesMetadata:[],legend:t.Legend.getDefaultLegendData(this.style),hasHighlights:!1,categoryMetadata:null,scalarCategoryAxis:!1,positionMax:0,positionMin:0,dataLabelsSettings:n.getDefaultWaterfallLabelSettings(this.style,!1,void 0),sentimentColors:i,axesLabels:{x:null,y:null},numberOfBreakdowns:r,totalBreakdownCategories:0},o){if(this.dataView=o,o.metadata&&o.metadata.objects){var s=o.metadata.objects,l=s.labels;l&&t.LabelUtils.updateLabelSettingsFromLabelsObject(l,this.data.dataLabelsSettings,!0,this.style),i=this.getSentimentColorsFromObjects(s),r=e.DataViewObjects.getValue(s,t.waterfallChartProps.breakdown.maxBreakdowns,n.DefaultBreakdowns)}(o.categorical||o.matrix)&&(this.data=this.originalData=n.converter({dataView:o,style:this.style,hostServices:this.hostServices,dataLabelSettings:this.data.dataLabelsSettings,sentimentColors:i,interactivityService:this.interactivityService,tooltipsEnabled:this.tooltipsEnabled,numberOfBreakdowns:r}))}},n.prototype.enumerateObjectInstances=function(e,a){var i=this.originalData;switch(a.objectName){case"sentimentColors":this.enumerateSentimentColors(e);break;case"labels":var r=this.data.dataLabelsSettings,o={enumeration:e,dataLabelsSettings:i.dataLabelsSettings,positionObject:n.validLabelPositionsOptions,show:!0,displayUnits:!0,precision:!0,fontSize:!0,fontFamily:!0,labelOrientation:!0,position:!0,enableBackground:r.enableBackground,backgroundColor:r.backgroundColor,backgroundTransparency:r.backgroundTransparency,style:this.style};t.LabelUtils.enumerateDataLabels(o);break;case t.waterfallChartProps.breakdown.maxBreakdowns.objectName:this.enumerateBreakdown(e)}},n.prototype.enumerateSentimentColors=function(e){var t=this.originalData,a=t.sentimentColors,i={increaseFill:a.increaseFill,decreaseFill:a.decreaseFill};t.isBreakdown&&(i.otherFill=a.otherFill),i.totalFill=a.totalFill,e.pushInstance({selector:null,properties:i,objectName:"sentimentColors"})},n.prototype.enumerateBreakdown=function(e){var a=this.originalData;a.isBreakdown&&e.pushInstance({selector:null,properties:{maxBreakdowns:a.numberOfBreakdowns},validValues:{maxBreakdowns:{numberRange:{min:n.MinimumBreakdowns,max:Math.min(n.MaximumBreakdowns,a.totalBreakdownCategories)}}},objectName:t.waterfallChartProps.breakdown.maxBreakdowns.objectName})},n.prototype.calculateCustomLegend=function(){return this.data.legend},n.prototype.hasLegend=function(){return!0},n.createClippedDataIfOverflowed=function(t,a){var i=t,r=t.series[0].data;return t&&a<r.length&&(i=e.Prototype.inherit(t),i.series=[{data:r.slice(0,a)}],i.categories=t.categories.slice(0,a)),i},n.prototype.calculateAxesProperties=function(e){var a=this;this.currentViewport=e.viewport,this.viewModelAdapter&&this.originalData&&(this.data=this.viewModelAdapter.applyChanges(this.currentViewport,this.originalData,this.dataView)),this.margin=e.margin;var i=this.clippedData=this.data,r=i.series,o=i.categories.length,s=this.getPreferredPlotArea(!1,o,t.CartesianHelper.MinOrdinalRectThickness,e.outerPaddingRatio),l=i?i.preferredCategoryWidth:null,c=t.CartesianChart.getLayout(null,{availableWidth:s.width,categoryCount:o,preferredCategoryWidth:l,domain:null,isScalar:!1,isScrollable:this.isScrollable,trimOrdinalDataOnOverflow:e.trimOrdinalDataOnOverflow,outerPaddingRatio:e.outerPaddingRatio,innerPaddingRatio:e.innerPaddingRatio});this.isScrollable||(i=this.clippedData=n.createClippedDataIfOverflowed(i,c.categoryCount));var u=n.getXAxisCreationOptions(i,s.width,c,e),h=n.getYAxisCreationOptions(i,s.height,e),d=this.xAxisProperties=t.AxisHelper.createAxis(u),p=this.yAxisProperties=t.AxisHelper.createAxis(h);this.xAxisProperties.outerPaddingRatio=c.outerPaddingRatio;var g=this.xAxisProperties.categoryThickness*(1-e.innerPaddingRatio),y=t.LabelUtils.createColumnFormatterCacheManager(),v=i.dataLabelsSettings,m=t.LabelUtils.getLabelUnitAndPrecisionForAxis(p,v);return this.layout={categoryCount:c.categoryCount,categoryThickness:c.categoryThickness,isScalar:c.isScalar,outerPaddingRatio:c.outerPaddingRatio,categoryWidth:g,labelText:function(e){var a=r[e.seriesIndex].type,i=y.getOrCreate(e.labelFormatString,v,m.units,m.getPrecision(!!e.labelFormatString,a));return t.LabelUtils.getLabelTailoredText({label:i.format(e.value)})},labelLayout:t.CartesianHelper.getLabelLayoutXYForWaterfall(d,g,p,h.dataDomain),filter:function(e){return n.doesDataLabelFitInShape(e,p,a.layout)},style:{fill:function(e){return e.isLabelInside?t.ColorHelper.getThemeColor(a.style,t.LabelUtils.DefaultInsideLabelColorName):e.labelFill}}},[d,p]},n.lookupXValue=function(e,a,i){var r=e.series[0].data;return a===r.length-1?r[a].categoryValue:t.CartesianHelper.lookupXValue(e,a,r[a].type||i,!1)},n.getXAxisCreationOptions=function(e,a,i,r){var o=t.AxisHelper.getCategoryValueType(e.categoryMetadata),s=t.AxisHelper.createDomain(e.series,o,!1,r.forcedXDomain,r.ensureXDomain),l=i.categoryThickness,c=l*i.outerPaddingRatio;return{pixelSpan:a,dataDomain:s,metaDataColumn:e.categoryMetadata,formatString:t.valueFormatter.getFormatString(e.categoryMetadata,n.formatStringProp),isScalar:!1,outerPadding:c,categoryThickness:l,getValueFn:function(t,a){return n.lookupXValue(e,t,a)},forcedTickCount:r.forcedTickCount,isCategoryAxis:!0,axisDisplayUnits:r.categoryAxisDisplayUnits,axisPrecision:r.categoryAxisPrecision,outerPaddingRatio:i.outerPaddingRatio,preventNice:r.preventNiceX,innerPaddingRatio:r.innerPaddingRatio}},n.getYAxisCreationOptions=function(e,a,i){return{pixelSpan:a,dataDomain:t.AxisHelper.combineDomain(i.forcedYDomain,[e.positionMin,e.positionMax],i.ensureYDomain),zeroScalarDomain:[0,1],isScalar:!0,isVertical:!0,metaDataColumn:e.valuesMetadata,formatString:t.valueFormatter.getFormatString(e.valuesMetadata[0],n.formatStringProp),outerPadding:0,forcedTickCount:i.forcedTickCount,useTickIntervalForDisplayUnits:!0,isCategoryAxis:!1,axisDisplayUnits:i.valueAxisDisplayUnits,axisPrecision:i.valueAxisPrecision,outerPaddingRatio:0,preventNice:i.preventNiceY}},n.prototype.getPreferredPlotArea=function(e,a,i,r){return t.CartesianChart.getPreferredPlotArea(a,i,this.currentViewport,this.isScrollable,e,this.margin,r)},n.prototype.getVisualCategoryAxisIsScalar=function(){return!1},n.prototype.overrideXScale=function(e){this.xAxisProperties=e},n.prototype.setFilteredData=function(t,a){var i=this.clippedData=e.Prototype.inherit(this.data);return i.series=[{data:i.series[0].data.slice(t,a)}],i.categories=i.categories.slice(t,a),i},n.prototype.createRects=function(e){var t=this.mainGraphicsContext,a=t.selectAll(n.CategoryValueClasses.selector),i=a.data(e,function(e){return e.key});return i.enter().append("rect").attr("class",function(e){return n.CategoryValueClasses.class.concat(e.highlight?"highlight":"")}),i.exit().remove(),i},n.prototype.createConnectors=function(e){var t=this.mainGraphicsContext,a=t.selectAll(n.WaterfallConnectorClasses.selector),i=a.data(e.slice(0,e.length-1),function(e){return e.key});return i.enter().append("line").classed(n.WaterfallConnectorClasses.class,!0),i.exit().remove(),i},n.prototype.render=function(e){var a=this,i=this.clippedData.series[0].data,r=this.createRects(i),o=this.createConnectors(i),s=this.clippedData.strokeSettings;this.tooltipsEnabled&&this.tooltipService.addTooltip(r,function(e){return e.data&&e.data.tooltipInfo()},function(e){return e.data&&e.data.identity});var l=this.interactivityService&&this.interactivityService.hasSelection(),c=this.xAxisProperties.scale,u=this.yAxisProperties.scale,h=u(0);if(this.mainGraphicsSVG.attr("height",this.getAvailableHeight()).attr("width",this.getAvailableWidth()),s&&s.visible&&this.mainGraphicsSVG.style("stroke",s.color).style("stroke-width",s.width),r.style("fill",function(e){return e.color}).style("fill-opacity",function(e){return 1===e.barType?t.ColumnUtil.DefaultOpacity:t.ColumnUtil.getFillOpacity(e.selected,e.highlight,l,a.data.hasHighlights)}).attr("width",this.layout.categoryWidth).attr("x",function(e){return c(e.categoryIndex)}).attr("y",function(e){return t.CartesianHelper.getRectTop(u,e.position,e.value)}).attr("height",function(e){return h-u(Math.abs(e.value))}),this.interactivityService){var d=jsCommon.BrowserUtils.isInternetExplorerOrEdge();r.attr({tabindex:0,focusable:!0}).attr("aria-label",function(e){return t.tooltipUtils.formatTooltipInfo(e.tooltipInfo())}).classed(t.SetFocusRingClassName,!d)}o.style("stroke",t.ColorHelper.getThemeColor(this.style,n.DefaultWaterfallConnectorColorName)).attr({x1:function(e){return c(e.categoryIndex)},y1:function(e){return u(e.position+e.value)},x2:function(e){return c(e.categoryIndex+1)+a.layout.categoryWidth},y2:function(e){return u(e.position+e.value)}});var p=this.data.dataLabelsSettings,g=[];(p&&p.show||p.showCategory)&&(g=this.createLabelDataPoints());var y,v;return this.interactivityService&&(v={navigationStrategy:t.DataPointNavigationStrategy.CategoryOnly,helper:this},y={mainGraphicsContext:this.mainGraphicsContext,bars:r,isBreakdown:this.data.isBreakdown}),t.SVGUtil.flushAllD3TransitionsIfNeeded(this.options),{dataPoints:this.data.series[0].data,behaviorOptions:y,navigationOptions:v,labelDataPoints:g,labelsAreNumeric:!0,labelOrientation:p.labelOrientation,animateLabels:!e}},n.prototype.onClearSelection=function(){this.interactivityService&&this.interactivityService.clearSelection()},n.prototype.getSupportedCategoryAxisType=function(){return t.axisType.categorical},n.prototype.getFirstElement=function(){var e=this.clippedData.series[0].data[0].categoryIndex;return this.getHTMLElementFromCategoryIndex(e)},n.prototype.getNextDataPoint=function(e,a,i){switch(i){case t.DataDirection.NextCategory:e+=1,e>=this.data.categories.length&&(e=0);break;case t.DataDirection.PreviousCategory:e-=1,e<0&&(e=this.data.categories.length-1);break;case t.DataDirection.NextSeries:case t.DataDirection.PreviousSeries:break;default:debug.assertNever(i)}return{element:this.getHTMLElementFromCategoryIndex(e),targetCategoryIndex:e}},n.prototype.getHTMLElementFromCategoryIndex=function(e){return this.mainGraphicsContext.selectAll(n.CategoryValueClasses.selector).filter(function(t){return t.categoryIndex===e}).node()},n.prototype.getAvailableWidth=function(){return this.currentViewport.width-(this.margin.left+this.margin.right)},n.prototype.getAvailableHeight=function(){return this.currentViewport.height-(this.margin.top+this.margin.bottom)},n.prototype.getSentimentColorsFromObjects=function(e){var a=t.ColorHelper.create(this.style);return{increaseFill:{solid:{color:a.getColorForPropertyWithDefaultColor(e,t.waterfallChartProps.sentimentColors.increaseFill,t.ColorHelper.getSentimentColor(this.style,"good"))}},decreaseFill:{solid:{color:a.getColorForPropertyWithDefaultColor(e,t.waterfallChartProps.sentimentColors.decreaseFill,t.ColorHelper.getSentimentColor(this.style,"bad"))}},totalFill:{solid:{color:a.getColorForPropertyWithDefaultColor(e,t.waterfallChartProps.sentimentColors.totalFill,t.ColorHelper.getDataColorByIndex(this.style,0))}},otherFill:{solid:{color:a.getColorForPropertyWithDefaultColor(e,t.waterfallChartProps.sentimentColors.otherFill,t.ColorHelper.getSentimentColor(this.style,"neutral"))}}}},n.prototype.createLabelDataPoints=function(){for(var a=[],i=this.data,r=this.xAxisProperties.scale,o=this.yAxisProperties.scale,n=o(0),s=i.series,l=t.LabelUtils.createColumnFormatterCacheManager(),c=i.dataLabelsSettings,u=t.LabelUtils.getLabelUnitAndPrecisionForAxis(this.yAxisProperties,c),h=0,d=s;h<d.length;h++)for(var p=d[h],g=0,y=p.data;g<y.length;g++){var v=y[g],m={left:r(v.categoryIndex),top:t.CartesianHelper.getRectTop(o,v.position,v.value),width:this.layout.categoryWidth,height:n-o(Math.abs(v.value))},f=v.labelFormatString,x=l.getOrCreate(f,this.data.dataLabelsSettings,u.units,u.getPrecision(!!f,p.type)),C=t.LabelUtils.getLabelFormattedText(x.format(v.value)),S=c?c.fontProperties:t.LabelUtils.defaultFontProperties,b=t.FontProperties.toTextProperties(S,C),w=e.TextMeasurementService.measureSvgTextWidth(b),D=e.TextMeasurementService.estimateSvgTextHeight(b,!0),P=this.getValidPositions(c.position,v.value);a.push({isPreferred:!0,text:C,textSize:{width:w,height:D},outsideFill:S.color?S.color:t.ColorHelper.getThemeColor(this.style,t.LabelUtils.DefaultLabelColorName),insideFill:t.ColorHelper.getThemeColor(this.style,t.LabelUtils.DefaultInsideLabelColorName),parentType:1,parentShape:{rect:m,orientation:v.value>=0?1:2,validPositions:P},fontProperties:S,identity:void 0,hasBackground:c.enableBackground,backgroundColor:c.backgroundColor,backgroundTransparency:c.backgroundTransparency})}return a},n.prototype.getValidPositions=function(e,a){if(0===a)return n.validZeroLabelPosition;switch(e){case t.labelPosition.insideEnd:return[4];case t.labelPosition.insideCenter:return[1];case t.labelPosition.insideBase:return[2];case t.labelPosition.outsideEnd:return[16];default:return n.validLabelPositionsAuto}},n.prototype.getCartesianVisualCapabilities=function(){return{supportsHierarchicalCategoryAxis:!1}},n.prototype.getStaticSeriesRole=function(){},n.prototype.addWarnings=function(e){this.viewModelAdapter&&this.viewModelAdapter.addWarnings(e,this.originalData,this.data)},n.formatStringProp={objectName:"general",propertyName:"formatString"},n.WaterfallClassName="waterfallChart",n.MainGraphicsContextClassName="mainGraphicsContext",n.IncreaseLabel="Waterfall_IncreaseLabel",n.DecreaseLabel="Waterfall_DecreaseLabel",n.TotalLabel="Waterfall_TotalLabel",n.OtherLabel="Waterfall_OtherLabel",n.CategoryValueClasses=a("column"),n.WaterfallConnectorClasses=a("waterfall-connector"),n.AutoLabelPosition="Auto",n.DefaultWaterfallConnectorColorName="foregroundNeutralTertiary",n.MinimumBreakdowns=1,n.MaximumBreakdowns=20,n.DefaultBreakdowns=5,n.validLabelPositionsOptions=[n.AutoLabelPosition,i.outsideEnd,i.insideEnd,i.insideCenter,i.insideBase],n.validLabelPositionsAuto=[16,4,1,2],n.validZeroLabelPosition=[16,8],n}();t.WaterfallChart=n}(t=e.visuals||(e.visuals={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(e){var t=jsCommon.BrowserUtils,a=function(){function a(){}return a.prototype.bindEvents=function(a,i,r){var o=this,n=this.bars=a.bars;if(r&&!r.isEmpty()){var s=a.mainGraphicsContext;e.InteractivityUtils.registerEnterPlotAreaHandler(s,r),e.InteractivityUtils.registerDataPointNavigationHandler(s,r),e.InteractivityUtils.registerClearCatcherShortcut(s,i)}n.on("click",function(e){return o.handleSelection(e,i,a.isBreakdown)}).on("keydown",function(e){var t=d3.event.keyCode;32!==t&&13!==t||(d3.event.preventDefault(),d3.event.stopPropagation(),o.handleSelection(e,i,a.isBreakdown))}),n.on("contextmenu",function(a){if(!t.isCtrlOrMeta(d3.event)&&(d3.event.preventDefault(),e.EventBubblingUtil.markAsHandled(d3.event),1!==a.barType)){var r=e.InteractivityUtils.getPositionOfLastInputEvent();i.handleContextMenu(a,r)}})},a.prototype.renderSelection=function(t){this.bars.style("fill-opacity",function(a){return 1===a.barType?e.ColumnUtil.DefaultOpacity:e.ColumnUtil.getFillOpacity(a.selected,a.highlight,t,!1)}).style("stroke-opacity",function(a){return 1===a.barType?e.ColumnUtil.DefaultOpacity:e.ColumnUtil.getFillOpacity(a.selected,a.highlight,t,!1)})},a.prototype.renderFocus=function(e){e&&e.focus()},a.prototype.handleSelection=function(a,i,r){if(1!==a.barType){var o=e.InteractivityUtils.getPositionOfLastInputEvent();i.handleSelection(a,!r&&t.isCtrlOrMeta(d3.event),o)}},a}();e.WaterfallChartWebBehavior=a}(t=e.visuals||(e.visuals={}))}(powerbi||(powerbi={})),define("CartesianVisuals/cartesianModule",["require","exports"],function(e,t){
function a(e){return new g(e)}function i(e){return new D(e)}function r(e){return new y(e)}function o(){return new v}function n(){return new f}function s(){return new x}function l(){return new b}function c(){return new w}function u(e){return new C(e)}function h(e){return new m(e)}function d(){return new S}Object.defineProperty(t,"__esModule",{value:!0});var p=powerbi.visuals,g=p.CartesianChart,y=p.CartesianChartBehavior,v=p.ColumnChartWebBehavior,m=p.DashboardColumnChartAnimator,f=p.DataDotChartWebBehavior,x=p.LineChartWebBehavior,C=p.RealTimeLineChartAnimator,S=p.ScatterChartMobileBehavior,b=p.ScatterChartWebBehavior,w=p.WaterfallChartWebBehavior,D=p.WebColumnChartAnimator;t.createCartesianChart=a,t.createWebColumnChartAnimator=i,t.createCartesianChartBehavior=r,t.createColumnChartWebBehavior=o,t.createDataDotChartWebBehavior=n,t.createLineChartWebBehavior=s,t.createScatterChartWebBehavior=l,t.createWaterfallChartWebBehavior=c,t.createRealTimeLineChartAnimator=u,t.createDashboardColumnChartAnimator=h,t.createScatterChartMobileBehavior=d}),powerbi.define("PowerBIVisuals/visuals/converter/waterfall.converter",function(e){function t(e){var t,a=e.dataView,i=e.hostServices,r=e.dataLabelSettings,h=e.sentimentColors,g=e.interactivityService,y=e.tooltipsEnabled,f=e.numberOfBreakdowns,x=a.matrix,C=!_.isEmpty(x.columns.levels)&&x.columns.levels[0].sources[0],S=!_.isEmpty(x.rows.levels)&&x.rows.levels[0].sources,b=_.findIndex(x.valueSources,function(e){return c.hasRole(e,"Y")}),w=x.valueSources[b],D=_.filter(x.valueSources,function(e){return c.hasRole(e,"Tooltips")}),P=[],L=[],A={current:0,min:0,max:0},V=0;if(C&&S&&w){var M=new m(C,S,w),T=w.format,k=i.getLocalizedString("Waterfall_OtherLabel"),F=v.formatStringProp,I=x.rows.root.children,N=x.columns.root.children;if(!_.isEmpty(I)&&!_.isEmpty(N)){var H=I.length,O=N.length,R=0,B=void 0,E=void 0,U=_.size(D)+1;H>0&&(V=_.size(I[0].values)/U-1),f=Math.min(f,V);for(var z=0;z<H;z++){for(var G=I[z],W=z>0?I[z-1]:void 0,j=_.map(G.levelValues,function(e){return e.value}),X=_.map(j,function(e,t){return l.formatFromMetadataColumn(e,S[t],F)}).join(" "),Y=M.splitIdentity(G.identity.expr),q=[],K=_.size(G.values),Z=0;Z<K;Z+=U){for(var $=void 0,J=void 0,Q=[],ee=[],te=0;te<U;te++)te===b?($=o.normalizeNonFiniteNumber(G.values[Z+te].value),J=W&&o.normalizeNonFiniteNumber(W.values[Z+te].value)):(Q.push(G.values[Z+te].value),ee.push(W&&W.values[Z+te].value));q.push({key:Z,currentValue:$,previousValue:J,difference:($||0)-(J||0),column:N[Z/U],currentTooltipValues:Q,previousTooltipValues:ee})}q=_.sortBy(q,function(e){return Math.abs(e.difference)*-1});var ae=_.chain(q).filter(function(e){return!e.column.isSubtotal}).take(f).sortBy(function(e){return e.difference*-1}).value(),ie=_.find(q,function(e){return e.column.isSubtotal}),re=ie.currentValue,oe=ie.previousValue;if(W){var ne=_.sumBy(ae,function(e){return e.currentValue}),se=_.sumBy(ae,function(e){return e.previousValue}),le=_.chain(ae).map(function(e){return M.splitIdentity(e.column.identity.expr)}).flatten().value(),ce=O>f+1,ue=0,he=void 0,de=void 0;if(ce){var pe=re-ne,ge=oe-se;if(ue=pe-ge,he=M.createBreakdownOtherIdentity(le,Y,E),y){de=M.createBreakdownTooltip(X,B,k,pe,ge,ue,F,i);for(var ye=[],ve=[],me=function(e){var t=ie.currentTooltipValues[e],a=ie.previousTooltipValues[e];if(_.isNumber(t)&&_.isNumber(a)){var i=t-_.sumBy(ae,function(t){return t.currentTooltipValues[e]}),r=a-_.sumBy(ae,function(t){return t.previousTooltipValues[e]});ye.push(i-r),ve.push(r)}},fe=0;fe<ie.currentTooltipValues.length;fe++)me(fe);v.appendTooltipMeasures(ye,de,D,F,i,ve,X,B)}}for(var xe=!1,Ce=function(e){ce&&ue>e.difference&&!xe&&(xe=!0,P.push(v.createDataPoint(ue,A.current,h,k,R++,he,de,r.fontProperties.color,T,3,{text:!0})),L.push(k),A=v.getNewPositionContext(A,ue));var t=l.formatFromMetadataColumn(e.column.value,C,F),a=M.splitIdentity(e.column.identity.expr),o=M.createBreakdownIdentity(Y,E,a),n=void 0;if(y){n=M.createBreakdownTooltip(X,B,t,e.currentValue,e.previousValue,e.difference,F,i);var s=_.map(e.currentTooltipValues,function(t,a){return _.isNumber(t)?t-e.previousTooltipValues[a]:t});v.appendTooltipMeasures(s,n,D,F,i,e.previousTooltipValues,X,B)}P.push(v.createDataPoint(e.difference,A.current,h,t,R++,o,n,r.fontProperties.color,T,0,{text:!0})),L.push(t),A=v.getNewPositionContext(A,e.difference)},Se=0,be=ae;Se<be.length;Se++)Ce(be[Se]);ce&&!xe&&(xe=!0,P.push(v.createDataPoint(ue,A.current,h,k,R++,he,de,r.fontProperties.color,T,3,{text:!0})),L.push(k),A=v.getNewPositionContext(A,ue))}var we={dataMap:(t={},t[S[0].queryName]=[G.identity],t),metadata:[w.queryName]},De=p.convertSelectorsByColumnToSelector(we),Pe=new d(De,(!1),we),Le=void 0;y&&(Le=v.createCategoryTooltip(S,w,j,re,F),v.appendTooltipMeasures(ie.currentTooltipValues,Le,D,F,i)),P.push(v.createDataPoint(re,0,h,X,R++,Pe,Le,r.fontProperties.color,T,2,{text:!0})),L.push(X),0===z&&(A={current:re,max:re,min:re}),B=X,E=Y}}}g&&g.applySelectionStateToData(P);var Ae;e.style.isHighContrast&&(Ae={visible:!0,color:s.getThemeColor(e.style,u),width:n.defaultLineStrokeWidth});var Ve=n.getCategoryAxisProperties(a.metadata,void 0),Me=n.getPreferredCategoryWidth(Ve);return{series:[{data:P,type:w&&w.type}],categories:L,categoryMetadata:S[0],preferredCategoryWidth:Me,valuesMetadata:x.valueSources,legend:v.createLegend(h,i,a.metadata&&a.metadata.objects,e.style,!0),hasHighlights:!1,positionMin:A.min,positionMax:A.max,dataLabelsSettings:r,sentimentColors:h,isBreakdown:!0,numberOfBreakdowns:f,totalBreakdownCategories:V,strokeSettings:Ae}}var a=powerbi,i=a.data,r=a.visuals,o=r.AxisHelper,n=r.CartesianHelper,s=r.ColorHelper,l=r.converterHelper,c=i.DataRoleHelper,u=r.ForegroundColorName,h=jsCommon.Lazy,d=powerbi.visuals.SelectionId,p=i.Selector,g=i.SQExprBuilder,y=jsCommon.StringExtensions,v=powerbi.visuals.WaterfallChart,m=function(){function e(e,t,a){this.breakdownMetadata=e,this.categoryMetadata=t,this.valueMetadata=a}return e.prototype.splitIdentity=function(e){return i.ScopeIdentityExtractor.getKeyValuePairs(e)},e.prototype.createBreakdownIdentity=function(e,t,a){var r,o={dataMap:(r={},r[this.breakdownMetadata.queryName]=[i.createDataViewScopeIdentity(g.inValues(_.map(e,function(e){return e.left}).concat(_.map(a,function(e){return e.left})),[_.map(t,function(e){return e.right}).concat(_.map(a,function(e){return e.right})),_.map(e,function(e){return e.right}).concat(_.map(a,function(e){return e.right}))]))],r),metadata:[this.valueMetadata.queryName]};return new d(p.convertSelectorsByColumnToSelector(o),(!1),o)},e.prototype.createBreakdownOtherIdentity=function(e,t,a){var r,o={dataMap:(r={},r[this.breakdownMetadata.queryName]=[i.createDataViewScopeIdentity(g.not(g.inValues([this.breakdownMetadata.expr],_.map(e,function(e){return[e.right]}))))],r),metadata:[this.valueMetadata.queryName]};return o.dataMap[this.categoryMetadata[0].queryName]=[i.createDataViewScopeIdentity(g.inValues(_.map(t,function(e){return e.left}),[_.map(a,function(e){return e.right}),_.map(t,function(e){return e.right})]))],new d(p.convertSelectorsByColumnToSelector(o),(!1),o)},e.prototype.createBreakdownTooltip=function(e,t,a,i,o,n,s,c){var u=this,d=new r.LazyTooltipBuilder;if(this.breakdownMetadata&&d.withLazyValue(new h(function(){return{displayName:u.breakdownMetadata.displayName,value:l.formatFromMetadataColumn(a,u.breakdownMetadata,s)}})),this.valueMetadata&&(null!=o&&d.withLazyValue(new h(function(){return{displayName:t+" "+u.valueMetadata.displayName,value:l.formatFromMetadataColumn(o,u.valueMetadata,s,!1)}})),null!=i&&d.withLazyValue(new h(function(){return{displayName:e+" "+u.valueMetadata.displayName,value:l.formatFromMetadataColumn(i,u.valueMetadata,s,!1)}})),null!=n)){var p=l.formatFromMetadataColumn(n,this.valueMetadata,s,!1);p=v.createPercentTooltipValue(p,n,o),d.withLazyValue(new h(function(){return{displayName:y.format(c.getLocalizedString("Waterfall_BreakdownDifferenceTooltip"),u.valueMetadata.displayName),value:p}}))}return d},e}();return{matrixConverter:function(e){return t(e)}}});